var screenXs="480px";
var screenSm="640px";
var screenMd="1024px";
var screenLg="1400px";
  
var screenXsMin="480px";
var screenSmMin="640px";
var screenMdMin="1024px";
var screenLgMin="1400px";

var screenXsMax="639px";
var screenSmMax="1023px";
var screenMdMax="1399px";

if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one("bsTransitionEnd",function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b(),a.support.transition&&(a.event.special.bsTransitionEnd={bindType:a.support.transition.end,delegateType:a.support.transition.end,handle:function(b){if(a(b.target).is(this))return b.handleObj.handler.apply(this,arguments)}})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var c=a(this),e=c.data("bs.alert");e||c.data("bs.alert",e=new d(this)),"string"==typeof b&&e[b].call(c)})}var c='[data-dismiss="alert"]',d=function(b){a(b).on("click",c,this.close)};d.VERSION="3.3.7",d.TRANSITION_DURATION=150,d.prototype.close=function(b){function c(){g.detach().trigger("closed.bs.alert").remove()}var e=a(this),f=e.attr("data-target");f||(f=e.attr("href"),f=f&&f.replace(/.*(?=#[^\s]*$)/,""));var g=a("#"===f?[]:f);b&&b.preventDefault(),g.length||(g=e.closest(".alert")),g.trigger(b=a.Event("close.bs.alert")),b.isDefaultPrevented()||(g.removeClass("in"),a.support.transition&&g.hasClass("fade")?g.one("bsTransitionEnd",c).emulateTransitionEnd(d.TRANSITION_DURATION):c())};var e=a.fn.alert;a.fn.alert=b,a.fn.alert.Constructor=d,a.fn.alert.noConflict=function(){return a.fn.alert=e,this},a(document).on("click.bs.alert.data-api",c,d.prototype.close)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.button"),f="object"==typeof b&&b;e||d.data("bs.button",e=new c(this,f)),"toggle"==b?e.toggle():b&&e.setState(b)})}var c=function(b,d){this.$element=a(b),this.options=a.extend({},c.DEFAULTS,d),this.isLoading=!1};c.VERSION="3.3.7",c.DEFAULTS={loadingText:"loading..."},c.prototype.setState=function(b){var c="disabled",d=this.$element,e=d.is("input")?"val":"html",f=d.data();b+="Text",null==f.resetText&&d.data("resetText",d[e]()),setTimeout(a.proxy(function(){d[e](null==f[b]?this.options[b]:f[b]),"loadingText"==b?(this.isLoading=!0,d.addClass(c).attr(c,c).prop(c,!0)):this.isLoading&&(this.isLoading=!1,d.removeClass(c).removeAttr(c).prop(c,!1))},this),0)},c.prototype.toggle=function(){var a=!0,b=this.$element.closest('[data-toggle="buttons"]');if(b.length){var c=this.$element.find("input");"radio"==c.prop("type")?(c.prop("checked")&&(a=!1),b.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==c.prop("type")&&(c.prop("checked")!==this.$element.hasClass("active")&&(a=!1),this.$element.toggleClass("active")),c.prop("checked",this.$element.hasClass("active")),a&&c.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=b,a.fn.button.Constructor=c,a.fn.button.noConflict=function(){return a.fn.button=d,this},a(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(c){var d=a(c.target).closest(".btn");b.call(d,"toggle"),a(c.target).is('input[type="radio"], input[type="checkbox"]')||(c.preventDefault(),d.is("input,button")?d.trigger("focus"):d.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(b){a(b.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(b.type))})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},c.DEFAULTS,d.data(),"object"==typeof b&&b),g="string"==typeof b?b:f.slide;e||d.data("bs.carousel",e=new c(this,f)),"number"==typeof b?e.to(b):g?e[g]():f.interval&&e.pause().cycle()})}var c=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",a.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",a.proxy(this.pause,this)).on("mouseleave.bs.carousel",a.proxy(this.cycle,this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=600,c.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},c.prototype.keydown=function(a){if(!/input|textarea/i.test(a.target.tagName)){switch(a.which){case 37:this.prev();break;case 39:this.next();break;default:return}a.preventDefault()}},c.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},c.prototype.getItemIndex=function(a){return this.$items=a.parent().children(".item"),this.$items.index(a||this.$active)},c.prototype.getItemForDirection=function(a,b){var c=this.getItemIndex(b),d="prev"==a&&0===c||"next"==a&&c==this.$items.length-1;if(d&&!this.options.wrap)return b;var e="prev"==a?-1:1,f=(c+e)%this.$items.length;return this.$items.eq(f)},c.prototype.to=function(a){var b=this,c=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(a>this.$items.length-1||a<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){b.to(a)}):c==a?this.pause().cycle():this.slide(a>c?"next":"prev",this.$items.eq(a))},c.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},c.prototype.next=function(){if(!this.sliding)return this.slide("next")},c.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},c.prototype.slide=function(b,d){var e=this.$element.find(".item.active"),f=d||this.getItemForDirection(b,e),g=this.interval,h="next"==b?"left":"right",i=this;if(f.hasClass("active"))return this.sliding=!1;var j=f[0],k=a.Event("slide.bs.carousel",{relatedTarget:j,direction:h});if(this.$element.trigger(k),!k.isDefaultPrevented()){if(this.sliding=!0,g&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var l=a(this.$indicators.children()[this.getItemIndex(f)]);l&&l.addClass("active")}var m=a.Event("slid.bs.carousel",{relatedTarget:j,direction:h});return a.support.transition&&this.$element.hasClass("slide")?(f.addClass(b),f[0].offsetWidth,e.addClass(h),f.addClass(h),e.one("bsTransitionEnd",function(){f.removeClass([b,h].join(" ")).addClass("active"),e.removeClass(["active",h].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger(m)},0)}).emulateTransitionEnd(c.TRANSITION_DURATION)):(e.removeClass("active"),f.addClass("active"),this.sliding=!1,this.$element.trigger(m)),g&&this.cycle(),this}};var d=a.fn.carousel;a.fn.carousel=b,a.fn.carousel.Constructor=c,a.fn.carousel.noConflict=function(){return a.fn.carousel=d,this};var e=function(c){var d,e=a(this),f=a(e.attr("data-target")||(d=e.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,""));if(f.hasClass("carousel")){var g=a.extend({},f.data(),e.data()),h=e.attr("data-slide-to");h&&(g.interval=!1),b.call(f,g),h&&f.data("bs.carousel").to(h),c.preventDefault()}};a(document).on("click.bs.carousel.data-api","[data-slide]",e).on("click.bs.carousel.data-api","[data-slide-to]",e),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var c=a(this);b.call(c,c.data())})})}(jQuery),+function(a){"use strict";function b(b){var c,d=b.attr("data-target")||(c=b.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"");return a(d)}function c(b){return this.each(function(){var c=a(this),e=c.data("bs.collapse"),f=a.extend({},d.DEFAULTS,c.data(),"object"==typeof b&&b);!e&&f.toggle&&/show|hide/.test(b)&&(f.toggle=!1),e||c.data("bs.collapse",e=new d(this,f)),"string"==typeof b&&e[b]()})}var d=function(b,c){this.$element=a(b),this.options=a.extend({},d.DEFAULTS,c),this.$trigger=a('[data-toggle="collapse"][href="#'+b.id+'"],[data-toggle="collapse"][data-target="#'+b.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};d.VERSION="3.3.7",d.TRANSITION_DURATION=350,d.DEFAULTS={toggle:!0},d.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},d.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b,e=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(e&&e.length&&(b=e.data("bs.collapse"),b&&b.transitioning))){var f=a.Event("show.bs.collapse");if(this.$element.trigger(f),!f.isDefaultPrevented()){e&&e.length&&(c.call(e,"hide"),b||e.data("bs.collapse",null));var g=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[g](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var h=function(){this.$element.removeClass("collapsing").addClass("collapse in")[g](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return h.call(this);var i=a.camelCase(["scroll",g].join("-"));this.$element.one("bsTransitionEnd",a.proxy(h,this)).emulateTransitionEnd(d.TRANSITION_DURATION)[g](this.$element[0][i])}}}},d.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var e=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return a.support.transition?void this.$element[c](0).one("bsTransitionEnd",a.proxy(e,this)).emulateTransitionEnd(d.TRANSITION_DURATION):e.call(this)}}},d.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},d.prototype.getParent=function(){return a(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(a.proxy(function(c,d){var e=a(d);this.addAriaAndCollapsedClass(b(e),e)},this)).end()},d.prototype.addAriaAndCollapsedClass=function(a,b){var c=a.hasClass("in");a.attr("aria-expanded",c),b.toggleClass("collapsed",!c).attr("aria-expanded",c)};var e=a.fn.collapse;a.fn.collapse=c,a.fn.collapse.Constructor=d,a.fn.collapse.noConflict=function(){return a.fn.collapse=e,this},a(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(d){var e=a(this);e.attr("data-target")||d.preventDefault();var f=b(e),g=f.data("bs.collapse"),h=g?"toggle":e.data();c.call(f,h)})}(jQuery),+function(a){"use strict";function b(b){var c=b.attr("data-target");c||(c=b.attr("href"),c=c&&/#[A-Za-z]/.test(c)&&c.replace(/.*(?=#[^\s]*$)/,""));var d=c&&a(c);return d&&d.length?d:b.parent()}function c(c){c&&3===c.which||(a(e).remove(),a(f).each(function(){var d=a(this),e=b(d),f={relatedTarget:this};e.hasClass("open")&&(c&&"click"==c.type&&/input|textarea/i.test(c.target.tagName)&&a.contains(e[0],c.target)||(e.trigger(c=a.Event("hide.bs.dropdown",f)),c.isDefaultPrevented()||(d.attr("aria-expanded","false"),e.removeClass("open").trigger(a.Event("hidden.bs.dropdown",f)))))}))}function d(b){return this.each(function(){var c=a(this),d=c.data("bs.dropdown");d||c.data("bs.dropdown",d=new g(this)),"string"==typeof b&&d[b].call(c)})}var e=".dropdown-backdrop",f='[data-toggle="dropdown"]',g=function(b){a(b).on("click.bs.dropdown",this.toggle)};g.VERSION="3.3.7",g.prototype.toggle=function(d){var e=a(this);if(!e.is(".disabled, :disabled")){var f=b(e),g=f.hasClass("open");if(c(),!g){"ontouchstart"in document.documentElement&&!f.closest(".navbar-nav").length&&a(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(a(this)).on("click",c);var h={relatedTarget:this};if(f.trigger(d=a.Event("show.bs.dropdown",h)),d.isDefaultPrevented())return;e.trigger("focus").attr("aria-expanded","true"),f.toggleClass("open").trigger(a.Event("shown.bs.dropdown",h))}return!1}},g.prototype.keydown=function(c){if(/(38|40|27|32)/.test(c.which)&&!/input|textarea/i.test(c.target.tagName)){var d=a(this);if(c.preventDefault(),c.stopPropagation(),!d.is(".disabled, :disabled")){var e=b(d),g=e.hasClass("open");if(!g&&27!=c.which||g&&27==c.which)return 27==c.which&&e.find(f).trigger("focus"),d.trigger("click");var h=" li:not(.disabled):visible a",i=e.find(".dropdown-menu"+h);if(i.length){var j=i.index(c.target);38==c.which&&j>0&&j--,40==c.which&&j<i.length-1&&j++,~j||(j=0),i.eq(j).trigger("focus")}}}};var h=a.fn.dropdown;a.fn.dropdown=d,a.fn.dropdown.Constructor=g,a.fn.dropdown.noConflict=function(){return a.fn.dropdown=h,this},a(document).on("click.bs.dropdown.data-api",c).on("click.bs.dropdown.data-api",".dropdown form",function(a){a.stopPropagation()}).on("click.bs.dropdown.data-api",f,g.prototype.toggle).on("keydown.bs.dropdown.data-api",f,g.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",g.prototype.keydown)}(jQuery),+function(a){"use strict";function b(b,d){return this.each(function(){var e=a(this),f=e.data("bs.modal"),g=a.extend({},c.DEFAULTS,e.data(),"object"==typeof b&&b);f||e.data("bs.modal",f=new c(this,g)),"string"==typeof b?f[b](d):g.show&&f.show(d)})}var c=function(b,c){this.options=c,this.$body=a(document.body),this.$element=a(b),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,a.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};c.VERSION="3.3.7",c.TRANSITION_DURATION=300,c.BACKDROP_TRANSITION_DURATION=150,c.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},c.prototype.toggle=function(a){return this.isShown?this.hide():this.show(a)},c.prototype.show=function(b){var d=this,e=a.Event("show.bs.modal",{relatedTarget:b});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',a.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){d.$element.one("mouseup.dismiss.bs.modal",function(b){a(b.target).is(d.$element)&&(d.ignoreBackdropClick=!0)})}),this.backdrop(function(){var e=a.support.transition&&d.$element.hasClass("fade");d.$element.parent().length||d.$element.appendTo(d.$body),d.$element.show().scrollTop(0),d.adjustDialog(),e&&d.$element[0].offsetWidth,d.$element.addClass("in"),d.enforceFocus();var f=a.Event("shown.bs.modal",{relatedTarget:b});e?d.$dialog.one("bsTransitionEnd",function(){d.$element.trigger("focus").trigger(f)}).emulateTransitionEnd(c.TRANSITION_DURATION):d.$element.trigger("focus").trigger(f)}))},c.prototype.hide=function(b){b&&b.preventDefault(),b=a.Event("hide.bs.modal"),this.$element.trigger(b),this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),a(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),a.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",a.proxy(this.hideModal,this)).emulateTransitionEnd(c.TRANSITION_DURATION):this.hideModal())},c.prototype.enforceFocus=function(){a(document).off("focusin.bs.modal").on("focusin.bs.modal",a.proxy(function(a){document===a.target||this.$element[0]===a.target||this.$element.has(a.target).length||this.$element.trigger("focus")},this))},c.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",a.proxy(function(a){27==a.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},c.prototype.resize=function(){this.isShown?a(window).on("resize.bs.modal",a.proxy(this.handleUpdate,this)):a(window).off("resize.bs.modal")},c.prototype.hideModal=function(){var a=this;this.$element.hide(),this.backdrop(function(){a.$body.removeClass("modal-open"),a.resetAdjustments(),a.resetScrollbar(),a.$element.trigger("hidden.bs.modal")})},c.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},c.prototype.backdrop=function(b){var d=this,e=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var f=a.support.transition&&e;if(this.$backdrop=a(document.createElement("div")).addClass("modal-backdrop "+e).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",a.proxy(function(a){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(a.target===a.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),f&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!b)return;f?this.$backdrop.one("bsTransitionEnd",b).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):b()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var g=function(){d.removeBackdrop(),b&&b()};a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",g).emulateTransitionEnd(c.BACKDROP_TRANSITION_DURATION):g()}else b&&b()},c.prototype.handleUpdate=function(){this.adjustDialog()},c.prototype.adjustDialog=function(){var a=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&a?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!a?this.scrollbarWidth:""})},c.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},c.prototype.checkScrollbar=function(){var a=window.innerWidth;if(!a){var b=document.documentElement.getBoundingClientRect();a=b.right-Math.abs(b.left)}this.bodyIsOverflowing=document.body.clientWidth<a,this.scrollbarWidth=this.measureScrollbar()},c.prototype.setScrollbar=function(){var a=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",a+this.scrollbarWidth)},c.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},c.prototype.measureScrollbar=function(){var a=document.createElement("div");a.className="modal-scrollbar-measure",this.$body.append(a);var b=a.offsetWidth-a.clientWidth;return this.$body[0].removeChild(a),b};var d=a.fn.modal;a.fn.modal=b,a.fn.modal.Constructor=c,a.fn.modal.noConflict=function(){return a.fn.modal=d,this},a(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(c){var d=a(this),e=d.attr("href"),f=a(d.attr("data-target")||e&&e.replace(/.*(?=#[^\s]+$)/,"")),g=f.data("bs.modal")?"toggle":a.extend({remote:!/#/.test(e)&&e},f.data(),d.data());d.is("a")&&c.preventDefault(),f.one("show.bs.modal",function(a){a.isDefaultPrevented()||f.one("hidden.bs.modal",function(){d.is(":visible")&&d.trigger("focus")})}),b.call(f,g,this)})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",a,b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){if(this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(a.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusin"==b.type?"focus":"hover"]=!0),c.tip().hasClass("in")||"in"==c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show())},c.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);if(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),b instanceof a.Event&&(c.inState["focusout"==b.type?"focus":"hover"]=!1),!c.isInStateTrue())return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var d=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!d)return;var e=this,f=this.tip(),g=this.getUID(this.type);this.setContent(),f.attr("id",g),this.$element.attr("aria-describedby",g),this.options.animation&&f.addClass("fade");var h="function"==typeof this.options.placement?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,j=i.test(h);j&&(h=h.replace(i,"")||"top"),f.detach().css({top:0,left:0,display:"block"}).addClass(h).data("bs."+this.type,this),this.options.container?f.appendTo(this.options.container):f.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var k=this.getPosition(),l=f[0].offsetWidth,m=f[0].offsetHeight;if(j){var n=h,o=this.getPosition(this.$viewport);h="bottom"==h&&k.bottom+m>o.bottom?"top":"top"==h&&k.top-m<o.top?"bottom":"right"==h&&k.right+l>o.width?"left":"left"==h&&k.left-l<o.left?"right":h,f.removeClass(n).addClass(h)}var p=this.getCalculatedOffset(h,k,l,m);this.applyPlacement(p,h);var q=function(){var a=e.hoverState;e.$element.trigger("shown.bs."+e.type),e.hoverState=null,"out"==a&&e.leave(e)};a.support.transition&&this.$tip.hasClass("fade")?f.one("bsTransitionEnd",q).emulateTransitionEnd(c.TRANSITION_DURATION):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top+=g,b.left+=h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=/top|bottom/.test(c),m=l?2*k.left-e+i:2*k.top-f+j,n=l?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(m,d[0][n],l)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c?"left":"top",50*(1-a/b)+"%").css(c?"top":"left","")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(b){function d(){"in"!=e.hoverState&&f.detach(),e.$element&&e.$element.removeAttr("aria-describedby").trigger("hidden.bs."+e.type),b&&b()}var e=this,f=a(this.$tip),g=a.Event("hide.bs."+this.type);if(this.$element.trigger(g),!g.isDefaultPrevented())return f.removeClass("in"),a.support.transition&&f.hasClass("fade")?f.one("bsTransitionEnd",d).emulateTransitionEnd(c.TRANSITION_DURATION):d(),this.hoverState=null,this},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName,e=c.getBoundingClientRect();null==e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=window.SVGElement&&c instanceof window.SVGElement,g=d?{top:0,left:0}:f?null:b.offset(),h={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},i=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,h,i,g)},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.right&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a,b=this.$element,c=this.options;return a=b.attr("data-original-title")||("function"==typeof c.title?c.title.call(b[0]):c.title)},c.prototype.getUID=function(a){do a+=~~(1e6*Math.random());while(document.getElementById(a));return a},c.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&(c=a(b.currentTarget).data("bs."+this.type),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),b?(c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c)):c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a.type).removeData("bs."+a.type),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null,a.$element=null})};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.popover"),f="object"==typeof b&&b;!e&&/destroy|hide/.test(b)||(e||d.data("bs.popover",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.init("popover",a,b)};if(!a.fn.tooltip)throw new Error("Popover requires tooltip.js");c.VERSION="3.3.7",c.DEFAULTS=a.extend({},a.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),c.prototype=a.extend({},a.fn.tooltip.Constructor.prototype),c.prototype.constructor=c,c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle(),c=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b),a.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof c?"html":"append":"text"](c),a.removeClass("fade top bottom left right in"),a.find(".popover-title").html()||a.find(".popover-title").hide()},c.prototype.hasContent=function(){return this.getTitle()||this.getContent()},c.prototype.getContent=function(){var a=this.$element,b=this.options;return a.attr("data-content")||("function"==typeof b.content?b.content.call(a[0]):b.content)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var d=a.fn.popover;a.fn.popover=b,a.fn.popover.Constructor=c,a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(jQuery),+function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.7",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(c="position",d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){
this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tab");e||d.data("bs.tab",e=new c(this)),"string"==typeof b&&e[b]()})}var c=function(b){this.element=a(b)};c.VERSION="3.3.7",c.TRANSITION_DURATION=150,c.prototype.show=function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.data("target");if(d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,"")),!b.parent("li").hasClass("active")){var e=c.find(".active:last a"),f=a.Event("hide.bs.tab",{relatedTarget:b[0]}),g=a.Event("show.bs.tab",{relatedTarget:e[0]});if(e.trigger(f),b.trigger(g),!g.isDefaultPrevented()&&!f.isDefaultPrevented()){var h=a(d);this.activate(b.closest("li"),c),this.activate(h,h.parent(),function(){e.trigger({type:"hidden.bs.tab",relatedTarget:b[0]}),b.trigger({type:"shown.bs.tab",relatedTarget:e[0]})})}}},c.prototype.activate=function(b,d,e){function f(){g.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),b.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),h?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu").length&&b.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),e&&e()}var g=d.find("> .active"),h=e&&a.support.transition&&(g.length&&g.hasClass("fade")||!!d.find("> .fade").length);g.length&&h?g.one("bsTransitionEnd",f).emulateTransitionEnd(c.TRANSITION_DURATION):f(),g.removeClass("in")};var d=a.fn.tab;a.fn.tab=b,a.fn.tab.Constructor=c,a.fn.tab.noConflict=function(){return a.fn.tab=d,this};var e=function(c){c.preventDefault(),b.call(a(this),"show")};a(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',e).on("click.bs.tab.data-api",'[data-toggle="pill"]',e)}(jQuery),+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.affix"),f="object"==typeof b&&b;e||d.data("bs.affix",e=new c(this,f)),"string"==typeof b&&e[b]()})}var c=function(b,d){this.options=a.extend({},c.DEFAULTS,d),this.$target=a(this.options.target).on("scroll.bs.affix.data-api",a.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",a.proxy(this.checkPositionWithEventLoop,this)),this.$element=a(b),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};c.VERSION="3.3.7",c.RESET="affix affix-top affix-bottom",c.DEFAULTS={offset:0,target:window},c.prototype.getState=function(a,b,c,d){var e=this.$target.scrollTop(),f=this.$element.offset(),g=this.$target.height();if(null!=c&&"top"==this.affixed)return e<c&&"top";if("bottom"==this.affixed)return null!=c?!(e+this.unpin<=f.top)&&"bottom":!(e+g<=a-d)&&"bottom";var h=null==this.affixed,i=h?e:f.top,j=h?g:b;return null!=c&&e<=c?"top":null!=d&&i+j>=a-d&&"bottom"},c.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(c.RESET).addClass("affix");var a=this.$target.scrollTop(),b=this.$element.offset();return this.pinnedOffset=b.top-a},c.prototype.checkPositionWithEventLoop=function(){setTimeout(a.proxy(this.checkPosition,this),1)},c.prototype.checkPosition=function(){if(this.$element.is(":visible")){var b=this.$element.height(),d=this.options.offset,e=d.top,f=d.bottom,g=Math.max(a(document).height(),a(document.body).height());"object"!=typeof d&&(f=e=d),"function"==typeof e&&(e=d.top(this.$element)),"function"==typeof f&&(f=d.bottom(this.$element));var h=this.getState(g,b,e,f);if(this.affixed!=h){null!=this.unpin&&this.$element.css("top","");var i="affix"+(h?"-"+h:""),j=a.Event(i+".bs.affix");if(this.$element.trigger(j),j.isDefaultPrevented())return;this.affixed=h,this.unpin="bottom"==h?this.getPinnedOffset():null,this.$element.removeClass(c.RESET).addClass(i).trigger(i.replace("affix","affixed")+".bs.affix")}"bottom"==h&&this.$element.offset({top:g-b-f})}};var d=a.fn.affix;a.fn.affix=b,a.fn.affix.Constructor=c,a.fn.affix.noConflict=function(){return a.fn.affix=d,this},a(window).on("load",function(){a('[data-spy="affix"]').each(function(){var c=a(this),d=c.data();d.offset=d.offset||{},null!=d.offsetBottom&&(d.offset.bottom=d.offsetBottom),null!=d.offsetTop&&(d.offset.top=d.offsetTop),b.call(c,d)})})}(jQuery);


!function(a,b,c){var d=window.matchMedia;"undefined"!=typeof module&&module.exports?module.exports=c(d):"function"==typeof define&&define.amd?define(function(){return b[a]=c(d)}):b[a]=c(d)}("enquire",this,function(a){"use strict";function b(a,b){var c,d=0,e=a.length;for(d;e>d&&(c=b(a[d],d),c!==!1);d++);}function c(a){return"[object Array]"===Object.prototype.toString.apply(a)}function d(a){return"function"==typeof a}function e(a){this.options=a,!a.deferSetup&&this.setup()}function f(b,c){this.query=b,this.isUnconditional=c,this.handlers=[],this.mql=a(b);var d=this;this.listener=function(a){d.mql=a,d.assess()},this.mql.addListener(this.listener)}function g(){if(!a)throw new Error("matchMedia not present, legacy browsers require a polyfill");this.queries={},this.browserIsIncapable=!a("only all").matches}return e.prototype={setup:function(){this.options.setup&&this.options.setup(),this.initialised=!0},on:function(){!this.initialised&&this.setup(),this.options.match&&this.options.match()},off:function(){this.options.unmatch&&this.options.unmatch()},destroy:function(){this.options.destroy?this.options.destroy():this.off()},equals:function(a){return this.options===a||this.options.match===a}},f.prototype={addHandler:function(a){var b=new e(a);this.handlers.push(b),this.matches()&&b.on()},removeHandler:function(a){var c=this.handlers;b(c,function(b,d){return b.equals(a)?(b.destroy(),!c.splice(d,1)):void 0})},matches:function(){return this.mql.matches||this.isUnconditional},clear:function(){b(this.handlers,function(a){a.destroy()}),this.mql.removeListener(this.listener),this.handlers.length=0},assess:function(){var a=this.matches()?"on":"off";b(this.handlers,function(b){b[a]()})}},g.prototype={register:function(a,e,g){var h=this.queries,i=g&&this.browserIsIncapable;return h[a]||(h[a]=new f(a,i)),d(e)&&(e={match:e}),c(e)||(e=[e]),b(e,function(b){d(b)&&(b={match:b}),h[a].addHandler(b)}),this},unregister:function(a,b){var c=this.queries[a];return c&&(b?c.removeHandler(b):(c.clear(),delete this.queries[a])),this}},new g});
;(function (window, document) {
	'use strict';

	var  nextTick, addEvent;
	nextTick = window.requestAnimationFrame ||
			   window.mozRequestAnimationFrame ||
			   window.webkitRequestAnimationFrame ||
			   function (callback) {
				   window.setTimeout(callback, 1000 / 60);
			   };

	addEvent = (function(){
		if (document.addEventListener){
			return function addStandardEventListener(el, eventName, fn){
				return el.addEventListener(eventName, fn, false);
			};
		}
		else {
			return function addIEEventListener(el, eventName, fn){
				return el.attachEvent('on'+eventName, fn);
			};
		}
	})();

	function Imager (elements, opts) {
		var self = this,doc  = document;
		opts = opts || {};

		this.elements         = elements || '.js-responsive-image';
		this.className        = opts.className || 'js-responsive-image-replaced';
		this.onResize         = opts.hasOwnProperty('onResize') ? opts.onResize : true;
		this.onImagesReplaced = opts.onImagesReplaced || function () {};

		this.eles = $(elements);
		nextTick(function(){self.init();});
	}

	Imager.prototype.init = function(){
		this.checkImagesNeedReplacing(this.eles);
		if(this.onResize){this.registerResizeEvent();}
	};

	Imager.prototype.checkImagesNeedReplacing = function (images) {
		var self = this;

		if (!this.isResizing) {
			this.isResizing = true;

			images.each(function(){self.replaceImagesBasedOnScreenDimensions(this);});
			
			this.isResizing = false;
			this.onImagesReplaced(images);
		}
	};

	Imager.prototype.replaceImagesBasedOnScreenDimensions = function (image) {
		var src,availableWidths = [],srcARRAY,cwidth;

		if( $(image).attr("data-media")!=undefined){
			var eMedia = $(image).attr("data-media")
			$(image).removeAttr("data-media")
			eMedia = $.parseJSON(eMedia)
			$.each(eMedia, function(key, value) {
				  availableWidths.push(parseInt(key));
			});
			$(image).data("width",availableWidths);
			$(image).data("media",eMedia);
		}

		srcARRAY = $(image).data("media");
		cwidth = Imager.getClosestValue(window.innerWidth, $.extend([],$(image).data("width")));

		if(image.src == srcARRAY[cwidth]){return;}
		image.src = srcARRAY[cwidth];
	};

	Imager.getClosestValue = function getClosestValue(baseValue, candidates){
		if(baseValue >= candidates[0] && candidates.length > 1){
			candidates.shift()
			getClosestValue(baseValue,candidates)
		}
		return candidates[0];
	}

	Imager.prototype.registerResizeEvent = function(){
		var self = this;
		addEvent(window, 'resize', function(){
			self.checkImagesNeedReplacing(self.eles);
		});
	};

	if (typeof module === 'object' && typeof module.exports === 'object') {
		module.exports = exports = Imager;
	} else if (typeof define === 'function' && define.amd) {
		define(function () { return Imager; });
	} else if (typeof window === 'object') {
		window.Imager = Imager;
	}

}(window, document));


;(function() {
/*jshint eqeqeq:false curly:false latedef:false */
"use strict";

	function setup($) {
		$.fn._fadeIn = $.fn.fadeIn;

		var noOp = $.noop || function() {};

		// this bit is to ensure we don't call setExpression when we shouldn't (with extra muscle to handle
		// confusing userAgent strings on Vista)
		var msie = /MSIE/.test(navigator.userAgent);
		var ie6  = /MSIE 6.0/.test(navigator.userAgent) && ! /MSIE 8.0/.test(navigator.userAgent);
		var mode = document.documentMode || 0;
		var setExpr = $.isFunction( document.createElement('div').style.setExpression );

		// global $ methods for blocking/unblocking the entire page
		$.blockUI   = function(opts) { install(window, opts); };
		$.unblockUI = function(opts) { remove(window, opts); };

		// convenience method for quick growl-like notifications  
		$.growlUI = function(title, message, timeout, onClose) {
			var $m = $('<div class="growlUI"></div>');
			if (title) $m.append('<h1>'+title+'</h1>');
			if (message) $m.append('<h2>'+message+'</h2>');
			if (timeout === undefined) timeout = 3000;

			// Added by konapun: Set timeout to 30 seconds if this growl is moused over, like normal toast notifications
			var callBlock = function(opts) {
				opts = opts || {};

				$.blockUI({
					message: $m,
					fadeIn : typeof opts.fadeIn  !== 'undefined' ? opts.fadeIn  : 700,
					fadeOut: typeof opts.fadeOut !== 'undefined' ? opts.fadeOut : 1000,
					timeout: typeof opts.timeout !== 'undefined' ? opts.timeout : timeout,
					centerY: false,
					showOverlay: false,
					onUnblock: onClose,
					css: $.blockUI.defaults.growlCSS
				});
			};

			callBlock();
			var nonmousedOpacity = $m.css('opacity');
			$m.mouseover(function() {
				callBlock({
					fadeIn: 0,
					timeout: 30000
				});

				var displayBlock = $('.blockMsg');
				displayBlock.stop(); // cancel fadeout if it has started
				displayBlock.fadeTo(300, 1); // make it easier to read the message by removing transparency
			}).mouseout(function() {
				$('.blockMsg').fadeOut(1000);
			});
			// End konapun additions
		};

		// plugin method for blocking element content
		$.fn.block = function(opts) {
			if ( this[0] === window ) {
				$.blockUI( opts );
				return this;
			}
			var fullOpts = $.extend({}, $.blockUI.defaults, opts || {});
			this.each(function() {
				var $el = $(this);
				if (fullOpts.ignoreIfBlocked && $el.data('blockUI.isBlocked'))
					return;
				$el.unblock({ fadeOut: 0 });
			});

			return this.each(function() {
				if ($.css(this,'position') == 'static') {
					this.style.position = 'relative';
					$(this).data('blockUI.static', true);
				}
				this.style.zoom = 1; // force 'hasLayout' in ie
				install(this, opts);
			});
		};

		// plugin method for unblocking element content
		$.fn.unblock = function(opts) {
			if ( this[0] === window ) {
				$.unblockUI( opts );
				return this;
			}
			return this.each(function() {
				remove(this, opts);
			});
		};

		$.blockUI.version = 2.66; // 2nd generation blocking at no extra cost!

		// override these in your code to change the default behavior and style
		$.blockUI.defaults = {
			// message displayed when blocking (use null for no message)
			message:  '<h1>Please wait...</h1>',

			title: null,		// title string; only used when theme == true
			draggable: true,	// only used when theme == true (requires jquery-ui.js to be loaded)

			theme: false, // set to true to use with jQuery UI themes

			// styles for the message when blocking; if you wish to disable
			// these and use an external stylesheet then do this in your code:
			// $.blockUI.defaults.css = {};
			css: {
				padding:	0,
				margin:		0,
				width:		'30%',
				top:		'40%',
				left:		'35%',
				textAlign:	'center',
				color:		'#000',
				border:		'3px solid #aaa',
				backgroundColor:'#fff',
				cursor:		'wait'
			},

			// minimal style set used when themes are used
			themedCSS: {
				width:	'30%',
				top:	'40%',
				left:	'35%'
			},

			// styles for the overlay
			overlayCSS:  {
				backgroundColor:	'#000',
				opacity:			0.6,
				cursor:				'wait'
			},

			// style to replace wait cursor before unblocking to correct issue
			// of lingering wait cursor
			cursorReset: 'default',

			// styles applied when using $.growlUI
			growlCSS: {
				width:		'350px',
				top:		'10px',
				left:		'',
				right:		'10px',
				border:		'none',
				padding:	'5px',
				opacity:	0.6,
				cursor:		'default',
				color:		'#fff',
				backgroundColor: '#000',
				'-webkit-border-radius':'10px',
				'-moz-border-radius':	'10px',
				'border-radius':		'10px'
			},

			// IE issues: 'about:blank' fails on HTTPS and javascript:false is s-l-o-w
			// (hat tip to Jorge H. N. de Vasconcelos)
			/*jshint scripturl:true */
			iframeSrc: /^https/i.test(window.location.href || '') ? 'javascript:false' : 'about:blank',

			// force usage of iframe in non-IE browsers (handy for blocking applets)
			forceIframe: false,

			// z-index for the blocking overlay
			baseZ: 1000,

			// set these to true to have the message automatically centered
			centerX: true, // <-- only effects element blocking (page block controlled via css above)
			centerY: true,

			// allow body element to be stetched in ie6; this makes blocking look better
			// on "short" pages.  disable if you wish to prevent changes to the body height
			allowBodyStretch: true,

			// enable if you want key and mouse events to be disabled for content that is blocked
			bindEvents: true,

			// be default blockUI will supress tab navigation from leaving blocking content
			// (if bindEvents is true)
			constrainTabKey: true,

			// fadeIn time in millis; set to 0 to disable fadeIn on block
			fadeIn:  200,

			// fadeOut time in millis; set to 0 to disable fadeOut on unblock
			fadeOut:  400,

			// time in millis to wait before auto-unblocking; set to 0 to disable auto-unblock
			timeout: 0,

			// disable if you don't want to show the overlay
			showOverlay: true,

			// if true, focus will be placed in the first available input field when
			// page blocking
			focusInput: true,

            // elements that can receive focus
            focusableElements: ':input:enabled:visible',

			// suppresses the use of overlay styles on FF/Linux (due to performance issues with opacity)
			// no longer needed in 2012
			// applyPlatformOpacityRules: true,

			// callback method invoked when fadeIn has completed and blocking message is visible
			onBlock: null,

			// callback method invoked when unblocking has completed; the callback is
			// passed the element that has been unblocked (which is the window object for page
			// blocks) and the options that were passed to the unblock call:
			//	onUnblock(element, options)
			onUnblock: null,

			// callback method invoked when the overlay area is clicked.
			// setting this will turn the cursor to a pointer, otherwise cursor defined in overlayCss will be used.
			onOverlayClick: null,

			// don't ask; if you really must know: http://groups.google.com/group/jquery-en/browse_thread/thread/36640a8730503595/2f6a79a77a78e493#2f6a79a77a78e493
			quirksmodeOffsetHack: 4,

			// class name of the message block
			blockMsgClass: 'blockMsg',

			// if it is already blocked, then ignore it (don't unblock and reblock)
			ignoreIfBlocked: false
		};

		// private data and functions follow...

		var pageBlock = null;
		var pageBlockEls = [];

		function install(el, opts) {
			var css, themedCSS;
			var full = (el == window);
			var msg = (opts && opts.message !== undefined ? opts.message : undefined);
			opts = $.extend({}, $.blockUI.defaults, opts || {});

			if (opts.ignoreIfBlocked && $(el).data('blockUI.isBlocked'))
				return;

			opts.overlayCSS = $.extend({}, $.blockUI.defaults.overlayCSS, opts.overlayCSS || {});
			css = $.extend({}, $.blockUI.defaults.css, opts.css || {});
			if (opts.onOverlayClick)
				opts.overlayCSS.cursor = 'pointer';

			themedCSS = $.extend({}, $.blockUI.defaults.themedCSS, opts.themedCSS || {});
			msg = msg === undefined ? opts.message : msg;

			// remove the current block (if there is one)
			if (full && pageBlock)
				remove(window, {fadeOut:0});

			// if an existing element is being used as the blocking content then we capture
			// its current place in the DOM (and current display style) so we can restore
			// it when we unblock
			if (msg && typeof msg != 'string' && (msg.parentNode || msg.jquery)) {
				var node = msg.jquery ? msg[0] : msg;
				var data = {};
				$(el).data('blockUI.history', data);
				data.el = node;
				data.parent = node.parentNode;
				data.display = node.style.display;
				data.position = node.style.position;
				if (data.parent)
					data.parent.removeChild(node);
			}

			$(el).data('blockUI.onUnblock', opts.onUnblock);
			var z = opts.baseZ;

			// blockUI uses 3 layers for blocking, for simplicity they are all used on every platform;
			// layer1 is the iframe layer which is used to supress bleed through of underlying content
			// layer2 is the overlay layer which has opacity and a wait cursor (by default)
			// layer3 is the message content that is displayed while blocking
			var lyr1, lyr2, lyr3, s;
			if (msie || opts.forceIframe)
				lyr1 = $('<iframe class="blockUI" style="z-index:'+ (z++) +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>');
			else
				lyr1 = $('<div class="blockUI" style="display:none"></div>');

			if (opts.theme)
				lyr2 = $('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+ (z++) +';display:none"></div>');
			else
				lyr2 = $('<div class="blockUI blockOverlay" style="z-index:'+ (z++) +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');

			if (opts.theme && full) {
				s = '<div class="blockUI ' + opts.blockMsgClass + ' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:fixed">';
				if ( opts.title ) {
					s += '<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title || '&nbsp;')+'</div>';
				}
				s += '<div class="ui-widget-content ui-dialog-content"></div>';
				s += '</div>';
			}
			else if (opts.theme) {
				s = '<div class="blockUI ' + opts.blockMsgClass + ' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:absolute">';
				if ( opts.title ) {
					s += '<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title || '&nbsp;')+'</div>';
				}
				s += '<div class="ui-widget-content ui-dialog-content"></div>';
				s += '</div>';
			}
			else if (full) {
				s = '<div class="blockUI ' + opts.blockMsgClass + ' blockPage" style="z-index:'+(z+10)+';display:none;position:fixed"></div>';
			}
			else {
				s = '<div class="blockUI ' + opts.blockMsgClass + ' blockElement" style="z-index:'+(z+10)+';display:none;position:absolute"></div>';
			}
			lyr3 = $(s);

			// if we have a message, style it
			if (msg) {
				if (opts.theme) {
					lyr3.css(themedCSS);
					lyr3.addClass('ui-widget-content');
				}
				else
					lyr3.css(css);
			}

			// style the overlay
			if (!opts.theme /*&& (!opts.applyPlatformOpacityRules)*/)
				lyr2.css(opts.overlayCSS);
			lyr2.css('position', full ? 'fixed' : 'absolute');

			// make iframe layer transparent in IE
			if (msie || opts.forceIframe)
				lyr1.css('opacity',0.0);

			//$([lyr1[0],lyr2[0],lyr3[0]]).appendTo(full ? 'body' : el);
			var layers = [lyr1,lyr2,lyr3], $par = full ? $('body') : $(el);
			$.each(layers, function() {
				this.appendTo($par);
			});

			if (opts.theme && opts.draggable && $.fn.draggable) {
				lyr3.draggable({
					handle: '.ui-dialog-titlebar',
					cancel: 'li'
				});
			}

			// ie7 must use absolute positioning in quirks mode and to account for activex issues (when scrolling)
			var expr = setExpr && (!$.support.boxModel || $('object,embed', full ? null : el).length > 0);
			if (ie6 || expr) {
				// give body 100% height
				if (full && opts.allowBodyStretch && $.support.boxModel)
					$('html,body').css('height','100%');

				// fix ie6 issue when blocked element has a border width
				if ((ie6 || !$.support.boxModel) && !full) {
					var t = sz(el,'borderTopWidth'), l = sz(el,'borderLeftWidth');
					var fixT = t ? '(0 - '+t+')' : 0;
					var fixL = l ? '(0 - '+l+')' : 0;
				}

				// simulate fixed position
				$.each(layers, function(i,o) {
					var s = o[0].style;
					s.position = 'absolute';
					if (i < 2) {
						if (full)
							s.setExpression('height','Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:'+opts.quirksmodeOffsetHack+') + "px"');
						else
							s.setExpression('height','this.parentNode.offsetHeight + "px"');
						if (full)
							s.setExpression('width','jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"');
						else
							s.setExpression('width','this.parentNode.offsetWidth + "px"');
						if (fixL) s.setExpression('left', fixL);
						if (fixT) s.setExpression('top', fixT);
					}
					else if (opts.centerY) {
						if (full) s.setExpression('top','(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"');
						s.marginTop = 0;
					}
					else if (!opts.centerY && full) {
						var top = (opts.css && opts.css.top) ? parseInt(opts.css.top, 10) : 0;
						var expression = '((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + '+top+') + "px"';
						s.setExpression('top',expression);
					}
				});
			}

			// show the message
			if (msg) {
				if (opts.theme)
					lyr3.find('.ui-widget-content').append(msg);
				else
					lyr3.append(msg);
				if (msg.jquery || msg.nodeType)
					$(msg).show();
			}

			if ((msie || opts.forceIframe) && opts.showOverlay)
				lyr1.show(); // opacity is zero
			if (opts.fadeIn) {
				var cb = opts.onBlock ? opts.onBlock : noOp;
				var cb1 = (opts.showOverlay && !msg) ? cb : noOp;
				var cb2 = msg ? cb : noOp;
				if (opts.showOverlay)
					lyr2._fadeIn(opts.fadeIn, cb1);
				if (msg)
					lyr3._fadeIn(opts.fadeIn, cb2);
			}
			else {
				if (opts.showOverlay)
					lyr2.show();
				if (msg)
					lyr3.show();
				if (opts.onBlock)
					opts.onBlock();
			}

			// bind key and mouse events
			bind(1, el, opts);

			if (full) {
				pageBlock = lyr3[0];
				pageBlockEls = $(opts.focusableElements,pageBlock);
				if (opts.focusInput)
					setTimeout(focus, 20);
			}
			else
				center(lyr3[0], opts.centerX, opts.centerY);

			if (opts.timeout) {
				// auto-unblock
				var to = setTimeout(function() {
					if (full)
						$.unblockUI(opts);
					else
						$(el).unblock(opts);
				}, opts.timeout);
				$(el).data('blockUI.timeout', to);
			}
		}

		// remove the block
		function remove(el, opts) {
			var count;
			var full = (el == window);
			var $el = $(el);
			var data = $el.data('blockUI.history');
			var to = $el.data('blockUI.timeout');
			if (to) {
				clearTimeout(to);
				$el.removeData('blockUI.timeout');
			}
			opts = $.extend({}, $.blockUI.defaults, opts || {});
			bind(0, el, opts); // unbind events

			if (opts.onUnblock === null) {
				opts.onUnblock = $el.data('blockUI.onUnblock');
				$el.removeData('blockUI.onUnblock');
			}

			var els;
			if (full) // crazy selector to handle odd field errors in ie6/7
				els = $('body').children().filter('.blockUI').add('body > .blockUI');
			else
				els = $el.find('>.blockUI');

			// fix cursor issue
			if ( opts.cursorReset ) {
				if ( els.length > 1 )
					els[1].style.cursor = opts.cursorReset;
				if ( els.length > 2 )
					els[2].style.cursor = opts.cursorReset;
			}

			if (full)
				pageBlock = pageBlockEls = null;

			if (opts.fadeOut) {
				count = els.length;
				els.stop().fadeOut(opts.fadeOut, function() {
					if ( --count === 0)
						reset(els,data,opts,el);
				});
			}
			else
				reset(els, data, opts, el);
		}

		// move blocking element back into the DOM where it started
		function reset(els,data,opts,el) {
			var $el = $(el);
			if ( $el.data('blockUI.isBlocked') )
				return;

			els.each(function(i,o) {
				// remove via DOM calls so we don't lose event handlers
				if (this.parentNode)
					this.parentNode.removeChild(this);
			});

			if (data && data.el) {
				data.el.style.display = data.display;
				data.el.style.position = data.position;
				if (data.parent)
					data.parent.appendChild(data.el);
				$el.removeData('blockUI.history');
			}

			if ($el.data('blockUI.static')) {
				$el.css('position', 'static'); // #22
			}

			if (typeof opts.onUnblock == 'function')
				opts.onUnblock(el,opts);

			// fix issue in Safari 6 where block artifacts remain until reflow
			var body = $(document.body), w = body.width(), cssW = body[0].style.width;
			body.width(w-1).width(w);
			body[0].style.width = cssW;
		}

		// bind/unbind the handler
		function bind(b, el, opts) {
			var full = el == window, $el = $(el);

			// don't bother unbinding if there is nothing to unbind
			if (!b && (full && !pageBlock || !full && !$el.data('blockUI.isBlocked')))
				return;

			$el.data('blockUI.isBlocked', b);

			// don't bind events when overlay is not in use or if bindEvents is false
			if (!full || !opts.bindEvents || (b && !opts.showOverlay))
				return;

			// bind anchors and inputs for mouse and key events
			var events = 'mousedown mouseup keydown keypress keyup touchstart touchend touchmove';
			if (b)
				$(document).bind(events, opts, handler);
			else
				$(document).unbind(events, handler);

		// former impl...
		//		var $e = $('a,:input');
		//		b ? $e.bind(events, opts, handler) : $e.unbind(events, handler);
		}

		// event handler to suppress keyboard/mouse events when blocking
		function handler(e) {
			// allow tab navigation (conditionally)
			if (e.type === 'keydown' && e.keyCode && e.keyCode == 9) {
				if (pageBlock && e.data.constrainTabKey) {
					var els = pageBlockEls;
					var fwd = !e.shiftKey && e.target === els[els.length-1];
					var back = e.shiftKey && e.target === els[0];
					if (fwd || back) {
						setTimeout(function(){focus(back);},10);
						return false;
					}
				}
			}
			var opts = e.data;
			var target = $(e.target);
			if (target.hasClass('blockOverlay') && opts.onOverlayClick)
				opts.onOverlayClick(e);

			// allow events within the message content
			if (target.parents('div.' + opts.blockMsgClass).length > 0)
				return true;

			// allow events for content that is not being blocked
			return target.parents().children().filter('div.blockUI').length === 0;
		}

		function focus(back) {
			if (!pageBlockEls)
				return;
			var e = pageBlockEls[back===true ? pageBlockEls.length-1 : 0];
			if (e)
				e.focus();
		}

		function center(el, x, y) {
			var p = el.parentNode, s = el.style;
			var l = ((p.offsetWidth - el.offsetWidth)/2) - sz(p,'borderLeftWidth');
			var t = ((p.offsetHeight - el.offsetHeight)/2) - sz(p,'borderTopWidth');
			if (x) s.left = l > 0 ? (l+'px') : '0';
			if (y) s.top  = t > 0 ? (t+'px') : '0';
		}

		function sz(el, p) {
			return parseInt($.css(el,p),10)||0;
		}

	}


	/*global define:true */
	if (typeof define === 'function' && define.amd && define.amd.jQuery) {
		define(['jquery'], setup);
	} else {
		setup(jQuery);
	}

})();

(function(t,e,i){function n(i,n,o){var r=e.createElement(i);return n&&(r.id=Z+n),o&&(r.style.cssText=o),t(r)}function o(){return i.innerHeight?i.innerHeight:t(i).height()}function r(e,i){i!==Object(i)&&(i={}),this.cache={},this.el=e,this.value=function(e){var n;return void 0===this.cache[e]&&(n=t(this.el).attr("data-cbox-"+e),void 0!==n?this.cache[e]=n:void 0!==i[e]?this.cache[e]=i[e]:void 0!==X[e]&&(this.cache[e]=X[e])),this.cache[e]},this.get=function(e){var i=this.value(e);return t.isFunction(i)?i.call(this.el,this):i}}function h(t){var e=W.length,i=(z+t)%e;return 0>i?e+i:i}function a(t,e){return Math.round((/%/.test(t)?("x"===e?E.width():o())/100:1)*parseInt(t,10))}function s(t,e){return t.get("photo")||t.get("photoRegex").test(e)}function l(t,e){return t.get("retinaUrl")&&i.devicePixelRatio>1?e.replace(t.get("photoRegex"),t.get("retinaSuffix")):e}function d(t){"contains"in y[0]&&!y[0].contains(t.target)&&t.target!==v[0]&&(t.stopPropagation(),y.focus())}function c(t){c.str!==t&&(y.add(v).removeClass(c.str).addClass(t),c.str=t)}function g(e){z=0,e&&e!==!1&&"nofollow"!==e?(W=t("."+te).filter(function(){var i=t.data(this,Y),n=new r(this,i);return n.get("rel")===e}),z=W.index(_.el),-1===z&&(W=W.add(_.el),z=W.length-1)):W=t(_.el)}function u(i){t(e).trigger(i),ae.triggerHandler(i)}function f(i){var o;if(!G){if(o=t(i).data(Y),_=new r(i,o),g(_.get("rel")),!$){$=q=!0,c(_.get("className")),y.css({visibility:"hidden",display:"block",opacity:""}),L=n(se,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),b.css({width:"",height:""}).append(L),D=T.height()+k.height()+b.outerHeight(!0)-b.height(),j=C.width()+H.width()+b.outerWidth(!0)-b.width(),A=L.outerHeight(!0),N=L.outerWidth(!0);var h=a(_.get("initialWidth"),"x"),s=a(_.get("initialHeight"),"y"),l=_.get("maxWidth"),f=_.get("maxHeight");_.w=(l!==!1?Math.min(h,a(l,"x")):h)-N-j,_.h=(f!==!1?Math.min(s,a(f,"y")):s)-A-D,L.css({width:"",height:_.h}),J.position(),u(ee),_.get("onOpen"),O.add(F).hide(),y.focus(),_.get("trapFocus")&&e.addEventListener&&(e.addEventListener("focus",d,!0),ae.one(re,function(){e.removeEventListener("focus",d,!0)})),_.get("returnFocus")&&ae.one(re,function(){t(_.el).focus()})}var p=parseFloat(_.get("opacity"));v.css({opacity:p===p?p:"",cursor:_.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),_.get("closeButton")?B.html(_.get("close")).appendTo(b):B.appendTo("<div/>"),w()}}function p(){y||(V=!1,E=t(i),y=n(se).attr({id:Y,"class":t.support.opacity===!1?Z+"IE":"",role:"dialog",tabindex:"-1"}).hide(),v=n(se,"Overlay").hide(),S=t([n(se,"LoadingOverlay")[0],n(se,"LoadingGraphic")[0]]),x=n(se,"Wrapper"),b=n(se,"Content").append(F=n(se,"Title"),I=n(se,"Current"),P=t('<button type="button"/>').attr({id:Z+"Previous"}),K=t('<button type="button"/>').attr({id:Z+"Next"}),R=n("button","Slideshow"),S),B=t('<button type="button"/>').attr({id:Z+"Close"}),x.append(n(se).append(n(se,"TopLeft"),T=n(se,"TopCenter"),n(se,"TopRight")),n(se,!1,"clear:left").append(C=n(se,"MiddleLeft"),b,H=n(se,"MiddleRight")),n(se,!1,"clear:left").append(n(se,"BottomLeft"),k=n(se,"BottomCenter"),n(se,"BottomRight"))).find("div div").css({"float":"left"}),M=n(se,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),O=K.add(P).add(I).add(R)),e.body&&!y.parent().length&&t(e.body).append(v,y.append(x,M))}function m(){function i(t){t.which>1||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey||(t.preventDefault(),f(this))}return y?(V||(V=!0,K.click(function(){J.next()}),P.click(function(){J.prev()}),B.click(function(){J.close()}),v.click(function(){_.get("overlayClose")&&J.close()}),t(e).bind("keydown."+Z,function(t){var e=t.keyCode;$&&_.get("escKey")&&27===e&&(t.preventDefault(),J.close()),$&&_.get("arrowKey")&&W[1]&&!t.altKey&&(37===e?(t.preventDefault(),P.click()):39===e&&(t.preventDefault(),K.click()))}),t.isFunction(t.fn.on)?t(e).on("click."+Z,"."+te,i):t("."+te).live("click."+Z,i)),!0):!1}function w(){var e,o,r,h=J.prep,d=++le;if(q=!0,U=!1,u(he),u(ie),_.get("onLoad"),_.h=_.get("height")?a(_.get("height"),"y")-A-D:_.get("innerHeight")&&a(_.get("innerHeight"),"y"),_.w=_.get("width")?a(_.get("width"),"x")-N-j:_.get("innerWidth")&&a(_.get("innerWidth"),"x"),_.mw=_.w,_.mh=_.h,_.get("maxWidth")&&(_.mw=a(_.get("maxWidth"),"x")-N-j,_.mw=_.w&&_.w<_.mw?_.w:_.mw),_.get("maxHeight")&&(_.mh=a(_.get("maxHeight"),"y")-A-D,_.mh=_.h&&_.h<_.mh?_.h:_.mh),e=_.get("href"),Q=setTimeout(function(){S.show()},100),_.get("inline")){var c=t(e);r=t("<div>").hide().insertBefore(c),ae.one(he,function(){r.replaceWith(c)}),h(c)}else _.get("iframe")?h(" "):_.get("html")?h(_.get("html")):s(_,e)?(e=l(_,e),U=new Image,t(U).addClass(Z+"Photo").bind("error",function(){h(n(se,"Error").html(_.get("imgError")))}).one("load",function(){d===le&&setTimeout(function(){var e;t.each(["alt","longdesc","aria-describedby"],function(e,i){var n=t(_.el).attr(i)||t(_.el).attr("data-"+i);n&&U.setAttribute(i,n)}),_.get("retinaImage")&&i.devicePixelRatio>1&&(U.height=U.height/i.devicePixelRatio,U.width=U.width/i.devicePixelRatio),_.get("scalePhotos")&&(o=function(){U.height-=U.height*e,U.width-=U.width*e},_.mw&&U.width>_.mw&&(e=(U.width-_.mw)/U.width,o()),_.mh&&U.height>_.mh&&(e=(U.height-_.mh)/U.height,o())),_.h&&(U.style.marginTop=Math.max(_.mh-U.height,0)/2+"px"),W[1]&&(_.get("loop")||W[z+1])&&(U.style.cursor="pointer",U.onclick=function(){J.next()}),U.style.width=U.width+"px",U.style.height=U.height+"px",h(U)},1)}),U.src=e):e&&M.load(e,_.get("data"),function(e,i){d===le&&h("error"===i?n(se,"Error").html(_.get("xhrError")):t(this).contents())})}var v,y,x,b,T,C,H,k,W,E,L,M,S,F,I,R,K,P,B,O,_,D,j,A,N,z,U,$,q,G,Q,J,V,X={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return t(this).attr("href")},title:function(){return this.title}},Y="colorbox",Z="cbox",te=Z+"Element",ee=Z+"_open",ie=Z+"_load",ne=Z+"_complete",oe=Z+"_cleanup",re=Z+"_closed",he=Z+"_purge",ae=t("<a/>"),se="div",le=0,de={},ce=function(){function t(){clearTimeout(h)}function e(){(_.get("loop")||W[z+1])&&(t(),h=setTimeout(J.next,_.get("slideshowSpeed")))}function i(){R.html(_.get("slideshowStop")).unbind(s).one(s,n),ae.bind(ne,e).bind(ie,t),y.removeClass(a+"off").addClass(a+"on")}function n(){t(),ae.unbind(ne,e).unbind(ie,t),R.html(_.get("slideshowStart")).unbind(s).one(s,function(){J.next(),i()}),y.removeClass(a+"on").addClass(a+"off")}function o(){r=!1,R.hide(),t(),ae.unbind(ne,e).unbind(ie,t),y.removeClass(a+"off "+a+"on")}var r,h,a=Z+"Slideshow_",s="click."+Z;return function(){r?_.get("slideshow")||(ae.unbind(oe,o),o()):_.get("slideshow")&&W[1]&&(r=!0,ae.one(oe,o),_.get("slideshowAuto")?i():n(),R.show())}}();t[Y]||(t(p),J=t.fn[Y]=t[Y]=function(e,i){var n,o=this;if(e=e||{},t.isFunction(o))o=t("<a/>"),e.open=!0;else if(!o[0])return o;return o[0]?(p(),m()&&(i&&(e.onComplete=i),o.each(function(){var i=t.data(this,Y)||{};t.data(this,Y,t.extend(i,e))}).addClass(te),n=new r(o[0],e),n.get("open")&&f(o[0])),o):o},J.position=function(e,i){function n(){T[0].style.width=k[0].style.width=b[0].style.width=parseInt(y[0].style.width,10)-j+"px",b[0].style.height=C[0].style.height=H[0].style.height=parseInt(y[0].style.height,10)-D+"px"}var r,h,s,l=0,d=0,c=y.offset();if(E.unbind("resize."+Z),y.css({top:-9e4,left:-9e4}),h=E.scrollTop(),s=E.scrollLeft(),_.get("fixed")?(c.top-=h,c.left-=s,y.css({position:"fixed"})):(l=h,d=s,y.css({position:"absolute"})),d+=_.get("right")!==!1?Math.max(E.width()-_.w-N-j-a(_.get("right"),"x"),0):_.get("left")!==!1?a(_.get("left"),"x"):Math.round(Math.max(E.width()-_.w-N-j,0)/2),l+=_.get("bottom")!==!1?Math.max(o()-_.h-A-D-a(_.get("bottom"),"y"),0):_.get("top")!==!1?a(_.get("top"),"y"):Math.round(Math.max(o()-_.h-A-D,0)/2),y.css({top:c.top,left:c.left,visibility:"visible"}),x[0].style.width=x[0].style.height="9999px",r={width:_.w+N+j,height:_.h+A+D,top:l,left:d},e){var g=0;t.each(r,function(t){return r[t]!==de[t]?(g=e,void 0):void 0}),e=g}de=r,e||y.css(r),y.dequeue().animate(r,{duration:e||0,complete:function(){n(),q=!1,x[0].style.width=_.w+N+j+"px",x[0].style.height=_.h+A+D+"px",_.get("reposition")&&setTimeout(function(){E.bind("resize."+Z,J.position)},1),t.isFunction(i)&&i()},step:n})},J.resize=function(t){var e;$&&(t=t||{},t.width&&(_.w=a(t.width,"x")-N-j),t.innerWidth&&(_.w=a(t.innerWidth,"x")),L.css({width:_.w}),t.height&&(_.h=a(t.height,"y")-A-D),t.innerHeight&&(_.h=a(t.innerHeight,"y")),t.innerHeight||t.height||(e=L.scrollTop(),L.css({height:"auto"}),_.h=L.height()),L.css({height:_.h}),e&&L.scrollTop(e),J.position("none"===_.get("transition")?0:_.get("speed")))},J.prep=function(i){function o(){return _.w=_.w||L.width(),_.w=_.mw&&_.mw<_.w?_.mw:_.w,_.w}function a(){return _.h=_.h||L.height(),_.h=_.mh&&_.mh<_.h?_.mh:_.h,_.h}if($){var d,g="none"===_.get("transition")?0:_.get("speed");L.remove(),L=n(se,"LoadedContent").append(i),L.hide().appendTo(M.show()).css({width:o(),overflow:_.get("scrolling")?"auto":"hidden"}).css({height:a()}).prependTo(b),M.hide(),t(U).css({"float":"none"}),c(_.get("className")),d=function(){function i(){t.support.opacity===!1&&y[0].style.removeAttribute("filter")}var n,o,a=W.length;$&&(o=function(){clearTimeout(Q),S.hide(),u(ne),_.get("onComplete")},F.html(_.get("title")).show(),L.show(),a>1?("string"==typeof _.get("current")&&I.html(_.get("current").replace("{current}",z+1).replace("{total}",a)).show(),K[_.get("loop")||a-1>z?"show":"hide"]().html(_.get("next")),P[_.get("loop")||z?"show":"hide"]().html(_.get("previous")),ce(),_.get("preloading")&&t.each([h(-1),h(1)],function(){var i,n=W[this],o=new r(n,t.data(n,Y)),h=o.get("href");h&&s(o,h)&&(h=l(o,h),i=e.createElement("img"),i.src=h)})):O.hide(),_.get("iframe")?(n=e.createElement("iframe"),"frameBorder"in n&&(n.frameBorder=0),"allowTransparency"in n&&(n.allowTransparency="true"),_.get("scrolling")||(n.scrolling="no"),t(n).attr({src:_.get("href"),name:(new Date).getTime(),"class":Z+"Iframe",allowFullScreen:!0}).one("load",o).appendTo(L),ae.one(he,function(){n.src="//about:blank"}),_.get("fastIframe")&&t(n).trigger("load")):o(),"fade"===_.get("transition")?y.fadeTo(g,1,i):i())},"fade"===_.get("transition")?y.fadeTo(g,0,function(){J.position(0,d)}):J.position(g,d)}},J.next=function(){!q&&W[1]&&(_.get("loop")||W[z+1])&&(z=h(1),f(W[z]))},J.prev=function(){!q&&W[1]&&(_.get("loop")||z)&&(z=h(-1),f(W[z]))},J.close=function(){$&&!G&&(G=!0,$=!1,u(oe),_.get("onCleanup"),E.unbind("."+Z),v.fadeTo(_.get("fadeOut")||0,0),y.stop().fadeTo(_.get("fadeOut")||0,0,function(){y.hide(),v.hide(),u(he),L.remove(),setTimeout(function(){G=!1,u(re),_.get("onClosed")},1)}))},J.remove=function(){y&&(y.stop(),t[Y].close(),y.stop(!1,!0).remove(),v.remove(),G=!1,y=null,t("."+te).removeData(Y).removeClass(te),t(e).unbind("click."+Z).unbind("keydown."+Z))},J.element=function(){return t(_.el)},J.settings=X)})(jQuery,document,window);

!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(e){"use strict";function t(t){var r=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(r))}function r(t){var r=t.target,a=e(r);if(!a.is("[type=submit],[type=image]")){var n=a.closest("[type=submit]");if(0===n.length)return;r=n[0]}var i=this;if(i.clk=r,"image"==r.type)if(void 0!==t.offsetX)i.clk_x=t.offsetX,i.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var o=a.offset();i.clk_x=t.pageX-o.left,i.clk_y=t.pageY-o.top}else i.clk_x=t.pageX-r.offsetLeft,i.clk_y=t.pageY-r.offsetTop;setTimeout(function(){i.clk=i.clk_x=i.clk_y=null},100)}function a(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var n={};n.fileapi=void 0!==e("<input type='file'/>").get(0).files,n.formdata=void 0!==window.FormData;var i=!!e.fn.prop;e.fn.attr2=function(){if(!i)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function r(r){var a,n,i=e.param(r,t.traditional).split("&"),o=i.length,s=[];for(a=0;o>a;a++)i[a]=i[a].replace(/\+/g," "),n=i[a].split("="),s.push([decodeURIComponent(n[0]),decodeURIComponent(n[1])]);return s}function o(a){for(var n=new FormData,i=0;i<a.length;i++)n.append(a[i].name,a[i].value);if(t.extraData){var o=r(t.extraData);for(i=0;i<o.length;i++)o[i]&&n.append(o[i][0],o[i][1])}t.data=null;var s=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:u||"POST"});t.uploadProgress&&(s.xhr=function(){var r=e.ajaxSettings.xhr();return r.upload&&r.upload.addEventListener("progress",function(e){var r=0,a=e.loaded||e.position,n=e.total;e.lengthComputable&&(r=Math.ceil(a/n*100)),t.uploadProgress(e,a,n,r)},!1),r}),s.data=null;var c=s.beforeSend;return s.beforeSend=function(e,r){r.data=t.formData?t.formData:n,c&&c.call(this,e,r)},e.ajax(s)}function s(r){function n(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(r){a("cannot get iframe.contentWindow document: "+r)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(r){a("cannot get iframe.contentDocument: "+r),t=e.document}return t}function o(){function t(){try{var e=n(g).readyState;a("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(r){a("Server abort: ",r," (",r.name,")"),s(k),j&&clearTimeout(j),j=void 0}}var r=f.attr2("target"),i=f.attr2("action"),o="multipart/form-data",c=f.attr("enctype")||f.attr("encoding")||o;w.setAttribute("target",p),(!u||/post/i.test(u))&&w.setAttribute("method","POST"),i!=m.url&&w.setAttribute("action",m.url),m.skipEncodingOverride||u&&!/post/i.test(u)||f.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),m.timeout&&(j=setTimeout(function(){T=!0,s(D)},m.timeout));var l=[];try{if(m.extraData)for(var d in m.extraData)m.extraData.hasOwnProperty(d)&&l.push(e.isPlainObject(m.extraData[d])&&m.extraData[d].hasOwnProperty("name")&&m.extraData[d].hasOwnProperty("value")?e('<input type="hidden" name="'+m.extraData[d].name+'">').val(m.extraData[d].value).appendTo(w)[0]:e('<input type="hidden" name="'+d+'">').val(m.extraData[d]).appendTo(w)[0]);m.iframeTarget||v.appendTo("body"),g.attachEvent?g.attachEvent("onload",s):g.addEventListener("load",s,!1),setTimeout(t,15);try{w.submit()}catch(h){var x=document.createElement("form").submit;x.apply(w)}}finally{w.setAttribute("action",i),w.setAttribute("enctype",c),r?w.setAttribute("target",r):f.removeAttr("target"),e(l).remove()}}function s(t){if(!x.aborted&&!F){if(M=n(g),M||(a("cannot access response document"),t=k),t===D&&x)return x.abort("timeout"),void S.reject(x,"timeout");if(t==k&&x)return x.abort("server abort"),void S.reject(x,"error","server abort");if(M&&M.location.href!=m.iframeSrc||T){g.detachEvent?g.detachEvent("onload",s):g.removeEventListener("load",s,!1);var r,i="success";try{if(T)throw"timeout";var o="xml"==m.dataType||M.XMLDocument||e.isXMLDoc(M);if(a("isXml="+o),!o&&window.opera&&(null===M.body||!M.body.innerHTML)&&--O)return a("requeing onLoad callback, DOM not available"),void setTimeout(s,250);var u=M.body?M.body:M.documentElement;x.responseText=u?u.innerHTML:null,x.responseXML=M.XMLDocument?M.XMLDocument:M,o&&(m.dataType="xml"),x.getResponseHeader=function(e){var t={"content-type":m.dataType};return t[e.toLowerCase()]},u&&(x.status=Number(u.getAttribute("status"))||x.status,x.statusText=u.getAttribute("statusText")||x.statusText);var c=(m.dataType||"").toLowerCase(),l=/(json|script|text)/.test(c);if(l||m.textarea){var f=M.getElementsByTagName("textarea")[0];if(f)x.responseText=f.value,x.status=Number(f.getAttribute("status"))||x.status,x.statusText=f.getAttribute("statusText")||x.statusText;else if(l){var p=M.getElementsByTagName("pre")[0],h=M.getElementsByTagName("body")[0];p?x.responseText=p.textContent?p.textContent:p.innerText:h&&(x.responseText=h.textContent?h.textContent:h.innerText)}}else"xml"==c&&!x.responseXML&&x.responseText&&(x.responseXML=X(x.responseText));try{E=_(x,c,m)}catch(y){i="parsererror",x.error=r=y||i}}catch(y){a("error caught: ",y),i="error",x.error=r=y||i}x.aborted&&(a("upload aborted"),i=null),x.status&&(i=x.status>=200&&x.status<300||304===x.status?"success":"error"),"success"===i?(m.success&&m.success.call(m.context,E,"success",x),S.resolve(x.responseText,"success",x),d&&e.event.trigger("ajaxSuccess",[x,m])):i&&(void 0===r&&(r=x.statusText),m.error&&m.error.call(m.context,x,i,r),S.reject(x,"error",r),d&&e.event.trigger("ajaxError",[x,m,r])),d&&e.event.trigger("ajaxComplete",[x,m]),d&&!--e.active&&e.event.trigger("ajaxStop"),m.complete&&m.complete.call(m.context,x,i),F=!0,m.timeout&&clearTimeout(j),setTimeout(function(){m.iframeTarget?v.attr("src",m.iframeSrc):v.remove(),x.responseXML=null},100)}}}var c,l,m,d,p,v,g,x,y,b,T,j,w=f[0],S=e.Deferred();if(S.abort=function(e){x.abort(e)},r)for(l=0;l<h.length;l++)c=e(h[l]),i?c.prop("disabled",!1):c.removeAttr("disabled");if(m=e.extend(!0,{},e.ajaxSettings,t),m.context=m.context||m,p="jqFormIO"+(new Date).getTime(),m.iframeTarget?(v=e(m.iframeTarget),b=v.attr2("name"),b?p=b:v.attr2("name",p)):(v=e('<iframe name="'+p+'" src="'+m.iframeSrc+'" />'),v.css({position:"absolute",top:"-1000px",left:"-1000px"})),g=v[0],x={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var r="timeout"===t?"timeout":"aborted";a("aborting upload... "+r),this.aborted=1;try{g.contentWindow.document.execCommand&&g.contentWindow.document.execCommand("Stop")}catch(n){}v.attr("src",m.iframeSrc),x.error=r,m.error&&m.error.call(m.context,x,r,t),d&&e.event.trigger("ajaxError",[x,m,r]),m.complete&&m.complete.call(m.context,x,r)}},d=m.global,d&&0===e.active++&&e.event.trigger("ajaxStart"),d&&e.event.trigger("ajaxSend",[x,m]),m.beforeSend&&m.beforeSend.call(m.context,x,m)===!1)return m.global&&e.active--,S.reject(),S;if(x.aborted)return S.reject(),S;y=w.clk,y&&(b=y.name,b&&!y.disabled&&(m.extraData=m.extraData||{},m.extraData[b]=y.value,"image"==y.type&&(m.extraData[b+".x"]=w.clk_x,m.extraData[b+".y"]=w.clk_y)));var D=1,k=2,A=e("meta[name=csrf-token]").attr("content"),L=e("meta[name=csrf-param]").attr("content");L&&A&&(m.extraData=m.extraData||{},m.extraData[L]=A),m.forceSync?o():setTimeout(o,10);var E,M,F,O=50,X=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},C=e.parseJSON||function(e){return window.eval("("+e+")")},_=function(t,r,a){var n=t.getResponseHeader("content-type")||"",i="xml"===r||!r&&n.indexOf("xml")>=0,o=i?t.responseXML:t.responseText;return i&&"parsererror"===o.documentElement.nodeName&&e.error&&e.error("parsererror"),a&&a.dataFilter&&(o=a.dataFilter(o,r)),"string"==typeof o&&("json"===r||!r&&n.indexOf("json")>=0?o=C(o):("script"===r||!r&&n.indexOf("javascript")>=0)&&e.globalEval(o)),o};return S}if(!this.length)return a("ajaxSubmit: skipping submit process - no element selected"),this;var u,c,l,f=this;"function"==typeof t?t={success:t}:void 0===t&&(t={}),u=t.type||this.attr2("method"),c=t.url||this.attr2("action"),l="string"==typeof c?e.trim(c):"",l=l||window.location.href||"",l&&(l=(l.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:l,success:e.ajaxSettings.success,type:u||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var m={};if(this.trigger("form-pre-serialize",[this,t,m]),m.veto)return a("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return a("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var d=t.traditional;void 0===d&&(d=e.ajaxSettings.traditional);var p,h=[],v=this.formToArray(t.semantic,h);if(t.data&&(t.extraData=t.data,p=e.param(t.data,d)),t.beforeSubmit&&t.beforeSubmit(v,this,t)===!1)return a("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[v,this,t,m]),m.veto)return a("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var g=e.param(v,d);p&&(g=g?g+"&"+p:p),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+g,t.data=null):t.data=g;var x=[];if(t.resetForm&&x.push(function(){f.resetForm()}),t.clearForm&&x.push(function(){f.clearForm(t.includeHidden)}),!t.dataType&&t.target){var y=t.success||function(){};x.push(function(r){var a=t.replaceTarget?"replaceWith":"html";e(t.target)[a](r).each(y,arguments)})}else t.success&&x.push(t.success);if(t.success=function(e,r,a){for(var n=t.context||this,i=0,o=x.length;o>i;i++)x[i].apply(n,[e,r,a||f,f])},t.error){var b=t.error;t.error=function(e,r,a){var n=t.context||this;b.apply(n,[e,r,a,f])}}if(t.complete){var T=t.complete;t.complete=function(e,r){var a=t.context||this;T.apply(a,[e,r,f])}}var j=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}),w=j.length>0,S="multipart/form-data",D=f.attr("enctype")==S||f.attr("encoding")==S,k=n.fileapi&&n.formdata;a("fileAPI :"+k);var A,L=(w||D)&&!k;t.iframe!==!1&&(t.iframe||L)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){A=s(v)}):A=s(v):A=(w||D)&&k?o(v):e.ajax(t),f.removeData("jqxhr").data("jqxhr",A);for(var E=0;E<h.length;E++)h[E]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(n){if(n=n||{},n.delegation=n.delegation&&e.isFunction(e.fn.on),!n.delegation&&0===this.length){var i={s:this.selector,c:this.context};return!e.isReady&&i.s?(a("DOM not ready, queuing ajaxForm"),e(function(){e(i.s,i.c).ajaxForm(n)}),this):(a("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return n.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,r).on("submit.form-plugin",this.selector,n,t).on("click.form-plugin",this.selector,n,r),this):this.ajaxFormUnbind().bind("submit.form-plugin",n,t).bind("click.form-plugin",n,r)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,r){var a=[];if(0===this.length)return a;var i,o=this[0],s=this.attr("id"),u=t?o.getElementsByTagName("*"):o.elements;if(u&&!/MSIE [678]/.test(navigator.userAgent)&&(u=e(u).get()),s&&(i=e(':input[form="'+s+'"]').get(),i.length&&(u=(u||[]).concat(i))),!u||!u.length)return a;var c,l,f,m,d,p,h;for(c=0,p=u.length;p>c;c++)if(d=u[c],f=d.name,f&&!d.disabled)if(t&&o.clk&&"image"==d.type)o.clk==d&&(a.push({name:f,value:e(d).val(),type:d.type}),a.push({name:f+".x",value:o.clk_x},{name:f+".y",value:o.clk_y}));else if(m=e.fieldValue(d,!0),m&&m.constructor==Array)for(r&&r.push(d),l=0,h=m.length;h>l;l++)a.push({name:f,value:m[l]});else if(n.fileapi&&"file"==d.type){r&&r.push(d);var v=d.files;if(v.length)for(l=0;l<v.length;l++)a.push({name:f,value:v[l],type:d.type});else a.push({name:f,value:"",type:d.type})}else null!==m&&"undefined"!=typeof m&&(r&&r.push(d),a.push({name:f,value:m,type:d.type,required:d.required}));if(!t&&o.clk){var g=e(o.clk),x=g[0];f=x.name,f&&!x.disabled&&"image"==x.type&&(a.push({name:f,value:g.val()}),a.push({name:f+".x",value:o.clk_x},{name:f+".y",value:o.clk_y}))}return a},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var r=[];return this.each(function(){var a=this.name;if(a){var n=e.fieldValue(this,t);if(n&&n.constructor==Array)for(var i=0,o=n.length;o>i;i++)r.push({name:a,value:n[i]});else null!==n&&"undefined"!=typeof n&&r.push({name:this.name,value:n})}}),e.param(r)},e.fn.fieldValue=function(t){for(var r=[],a=0,n=this.length;n>a;a++){var i=this[a],o=e.fieldValue(i,t);null===o||"undefined"==typeof o||o.constructor==Array&&!o.length||(o.constructor==Array?e.merge(r,o):r.push(o))}return r},e.fieldValue=function(t,r){var a=t.name,n=t.type,i=t.tagName.toLowerCase();if(void 0===r&&(r=!0),r&&(!a||t.disabled||"reset"==n||"button"==n||("checkbox"==n||"radio"==n)&&!t.checked||("submit"==n||"image"==n)&&t.form&&t.form.clk!=t||"select"==i&&-1==t.selectedIndex))return null;if("select"==i){var o=t.selectedIndex;if(0>o)return null;for(var s=[],u=t.options,c="select-one"==n,l=c?o+1:u.length,f=c?o:0;l>f;f++){var m=u[f];if(m.selected){var d=m.value;if(d||(d=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),c)return d;s.push(d)}}return s}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var r=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var a=this.type,n=this.tagName.toLowerCase();r.test(a)||"textarea"==n?this.value="":"checkbox"==a||"radio"==a?this.checked=!1:"select"==n?this.selectedIndex=-1:"file"==a?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(a)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var r=this.type;if("checkbox"==r||"radio"==r)this.checked=t;else if("option"==this.tagName.toLowerCase()){var a=e(this).parent("select");t&&a[0]&&"select-one"==a[0].type&&a.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1});

(function($) {
    $.fn.hoverIntent = function(handlerIn,handlerOut,selector) {

        // default configuration values
        var cfg = {
            interval: 100,
            sensitivity: 6,
            timeout: 0
        };

        if ( typeof handlerIn === "object" ) {
            cfg = $.extend(cfg, handlerIn );
        } else if ($.isFunction(handlerOut)) {
            cfg = $.extend(cfg, { over: handlerIn, out: handlerOut, selector: selector } );
        } else {
            cfg = $.extend(cfg, { over: handlerIn, out: handlerIn, selector: handlerOut } );
        }

        // instantiate variables
        // cX, cY = current X and Y position of mouse, updated by mousemove event
        // pX, pY = previous X and Y position of mouse, set by mouseover and polling interval
        var cX, cY, pX, pY;

        // A private function for getting mouse position
        var track = function(ev) {
            cX = ev.pageX;
            cY = ev.pageY;
        };

        // A private function for comparing current and previous mouse position
        var compare = function(ev,ob) {
            ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t);
            // compare mouse positions to see if they've crossed the threshold
            if ( Math.sqrt( (pX-cX)*(pX-cX) + (pY-cY)*(pY-cY) ) < cfg.sensitivity ) {
                $(ob).off("mousemove.hoverIntent",track);
                // set hoverIntent state to true (so mouseOut can be called)
                ob.hoverIntent_s = true;
                return cfg.over.apply(ob,[ev]);
            } else {
                // set previous coordinates for next time
                pX = cX; pY = cY;
                // use self-calling timeout, guarantees intervals are spaced out properly (avoids JavaScript timer bugs)
                ob.hoverIntent_t = setTimeout( function(){compare(ev, ob);} , cfg.interval );
            }
        };

        // A private function for delaying the mouseOut function
        var delay = function(ev,ob) {
            ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t);
            ob.hoverIntent_s = false;
            return cfg.out.apply(ob,[ev]);
        };

        // A private function for handling mouse 'hovering'
        var handleHover = function(e) {
            // copy objects to be passed into t (required for event object to be passed in IE)
            var ev = $.extend({},e);
            var ob = this;

            // cancel hoverIntent timer if it exists
            if (ob.hoverIntent_t) { ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t); }

            // if e.type === "mouseenter"
            if (e.type === "mouseenter") {
                // set "previous" X and Y position based on initial entry point
                pX = ev.pageX; pY = ev.pageY;
                // update "current" X and Y position based on mousemove
                $(ob).on("mousemove.hoverIntent",track);
                // start polling interval (self-calling timeout) to compare mouse coordinates over time
                if (!ob.hoverIntent_s) { ob.hoverIntent_t = setTimeout( function(){compare(ev,ob);} , cfg.interval );}

                // else e.type == "mouseleave"
            } else {
                // unbind expensive mousemove event
                $(ob).off("mousemove.hoverIntent",track);
                // if hoverIntent state is true, then call the mouseOut function after the specified delay
                if (ob.hoverIntent_s) { ob.hoverIntent_t = setTimeout( function(){delay(ev,ob);} , cfg.timeout );}
            }
        };

        // listen for mouseenter and mouseleave
        return this.on({'mouseenter.hoverIntent':handleHover,'mouseleave.hoverIntent':handleHover}, cfg.selector);
    };
})(jQuery);

(function($){
	$.extend($.fn, {
		pstrength : function(options) {
			var options = $.extend({
				verdicts:	["Too Short!","Very Weak","Weak","Medium","Strong","Very Strong"],
				colors: 	["#ccc","#f00","#c06","#f60","#3c0","#3f0"],
				values: 	[20,30,40,60,80,100],
				scores: 	[10,15,30,40],
				minchar:	6,
				minCharText: "Minimum length is %d characters"
			},options);
			return this.each(function(){
				var infoarea = $(this).attr('id');


				$(this).after('<div id="' + infoarea + '_bar" class="progress" style="display: none;"><div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><span  id="' + infoarea + '_text">0%<span></div></div>');

				if(options.minchar>0){
					$(this).after('<div class="help-block" id="' + infoarea + '_minchar">' + options.minCharText.replace('%d', options.minchar) + '</div>');
				}


				options.$ctlBar = $("#" + infoarea + "_bar .progress-bar");
	    		options.$ctlText = $("#" + infoarea + "_text");

				$(this).keyup(function(){
					if(options.minchar <= $(this).val().length && $("#"+infoarea + '_bar:hidden')){
						$("#"+infoarea + '_bar').show()
					}

					$.fn.runPassword($(this).val(), infoarea, options);
				});
			});
		},
		runPassword : function (password, infoarea, options){

			nPerc = $.fn.checkPassword(password, options);
	    	var statusNum;

			if (nPerc < 0){
				statusNum=0
			}
			else if(nPerc <= options.scores[0]){
				statusNum=1
			}
			else if (nPerc > options.scores[0] && nPerc <= options.scores[1]){
				statusNum=2
			}
			else if (nPerc > options.scores[1] && nPerc <= options.scores[2]){
				statusNum=3
			}
			else if (nPerc > options.scores[2] && nPerc <= options.scores[3]){
				statusNum=4
			}
			else{
				statusNum=5
			}


			options.$ctlBar.css({width: options.values[statusNum]+"%"});
			options.$ctlBar.attr("aria-valuenow",options.values[statusNum]);
			options.$ctlBar.css({backgroundColor: options.colors[statusNum]});
			options.$ctlText.html(options.verdicts[statusNum]);

		},
		checkPassword : function(password, options)
		{
			var intScore = 0;
			var strVerdict = options.verdicts[0];
			
			if (password.length  < options.minchar){
				intScore = (intScore-100)
			}
			else if (password.length >options.minchar+1 && password.length <options.minchar+3){
				intScore = (intScore+6)
			}
			else if (password.length >options.minchar+2 && password.length <options.minchar+4){
				intScore = (intScore+12)
			}
			else if (password.length >options.minchar*2){
				intScore = (intScore+18)
			}

			if (password.match(/[a-z]/)){
				intScore = (intScore+1)
			}

			if (password.match(/[A-Z]/)){
				intScore = (intScore+5)
			}

			if (password.match(/\d+/)){
				intScore = (intScore+5)
			}

			if (password.match(/(.*[0-9].*[0-9].*[0-9])/)){
				intScore = (intScore+5)
			}

			if (password.match(/.[!,@,#,$,%,^,&,*,?,_,~]/)){
				intScore = (intScore+5)
			}

			if (password.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)){
				intScore = (intScore+5)
			}

			if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){
				intScore = (intScore+2)
			}

			if (password.match(/([a-zA-Z])/) && password.match(/([0-9])/)){
				intScore = (intScore+2)
			}

			if (password.match(/([a-zA-Z0-9].*[!,@,#,$,%,^,&,*,?,_,~])|([!,@,#,$,%,^,&,*,?,_,~].*[a-zA-Z0-9])/)){
				intScore = (intScore+2)
			}

			return intScore;

		}
	});
})(jQuery);


(function($) {
	var getHeightProperty = function() {
		var browser_id = 0;
		var property = [
			// To avoid content overflow in synchronised boxes on font scaling, we
			// use 'min-height' property for modern browsers ...
			['min-height','0px'],
			// and 'height' property for Internet Explorer.
			['height','1%']
		];

		var bMatch = /(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase()) || [],
			browser = bMatch[1] || "",
			browserVersion = bMatch[2] || "0";

		// check for IE6 ...
		if(browser === 'msie' && browserVersion < 7){
			browser_id = 1;
		}

		return {
			'name': property[browser_id][0],
			'autoheightVal': property[browser_id][1]
		};
	};

	$.getSyncedHeight = function(selector) {
		var max = 0;
		var heightProperty = getHeightProperty();
		// get maximum element height ...
		$(selector).each(function() {
			// fallback to auto height before height check ...
			$(this).css(heightProperty.name, heightProperty.autoheightVal);
			var val = parseInt($(this).css('height'),10);
			if(val > max){
				max = val;
			}
		});
		return max;
	};

	$.fn.syncHeight = function(config) {
		var defaults = {
			updateOnResize: false,  // re-sync element heights after a browser resize event (useful in flexible layouts)
			height: false
		};

		var options = $.extend(defaults, config);
		var e = this;
		var max = 0;
		var heightPropertyName = getHeightProperty().name;


		if(options.parent==true){

			$(this).each(function() {
				$(this).css(heightPropertyName, 0+'px');
			});

			$(this).each(function() {
				$(this).css(heightPropertyName, $(this).parent().innerHeight()+'px');
			});
		}else{

			 if(typeof(options.height) === "number") {
				max = options.height;
			} else {
				max = $.getSyncedHeight(this);
			}


			 // set synchronized element height ...
			$(this).each(function() {
				$(this).css(heightPropertyName, max+'px');
			});
		}
	 

		// optional sync refresh on resize event ...
		if (options.updateOnResize === true) {
			$(window).bind('resize.syncHeight', function(){
				options["updateOnResize"]=false;
				$(e).syncHeight(options);
			});
		}
		return this;
	};

	$.fn.unSyncHeight = function() {
		// unbind optional resize event ...
		$(window).unbind('resize.syncHeight');

		var heightPropertyName = getHeightProperty().name;
		$(this).each(function() {
			$(this).css(heightPropertyName, '');
		});
	};
})(jQuery);


(function($) {
	var debugMode = false;
	$.fn.extend({
		// We assume there could be multiple sets of tabs on a page, so,
		// the unique id for each invididual tab's heading is identified with params q and r (e.g., id="accessibletabscontent0-2")
		getUniqueId: function(p, q, r){
			if (r===undefined) {r='';} else {r='-'+r;}
			return p + q + r;
		},
		accessibleTabs: function(config) {
			var defaults = {
				wrapperClass: 'content', // Classname to apply to the div that is wrapped around the original Markup
				currentClass: 'current', // Classname to apply to the LI of the selected Tab
				tabhead: 'h4', // Tag or valid Query Selector of the Elements to Transform the Tabs-Navigation from (originals are removed)
				tabheadClass: 'tabhead', // Classname to apply to the target heading element for each tab div
				tabbody: '.tabbody', // Tag or valid Query Selector of the Elements to be treated as the Tab Body
				fx:'show', // can be "fadeIn", "slideDown", "show"
				fxspeed: 'normal', // speed (String|Number): "slow", "normal", or "fast") or the number of milliseconds to run the animation
				currentInfoText: 'current tab: ', // text to indicate for screenreaders which tab is the current one
				currentInfoPosition: 'prepend', // Definition where to insert the Info Text. Can be either "prepend" or "append"
				currentInfoClass: 'current-info', // Class to apply to the span wrapping the CurrentInfoText
				tabsListClass:'tabs-list', // Class to apply to the generated list of tabs above the content
				syncheights:false, // syncs the heights of the tab contents when the SyncHeight plugin is available
				syncHeightMethodName:'syncHeight', // set the Method name of the plugin you want to use to sync the tab contents. Defaults to the SyncHeight plugin: 
				cssClassAvailable:false, // Enable individual css classes for tabs. Gets the appropriate class name of a tabhead element and apply it to the tab list element. Boolean value
				saveState:false, // save the selected tab into a cookie so it stays selected after a reload. This requires that the wrapping div needs to have an ID (so we know which tab we're saving)
				autoAnchor:false, // will move over any existing id of a headline in tabs markup so it can be linked to it
				pagination:false, // adds buttons to each tab to switch to the next/previous tab
				position:'top', // can be 'top' or 'bottom'. Defines where the tabs list is inserted.
				wrapInnerNavLinks: '', // inner wrap for a-tags in tab navigation. See  for further informations
				firstNavItemClass: 'first', // Classname of the first list item in the tab navigation
				lastNavItemClass: 'last', // Classname of the last list item in the tab navigation
				clearfixClass: 'clearfix' // Name of the Class that is used to clear/contain floats
			};
			var keyCodes = {
				37 : -1, //LEFT
				38 : -1, //UP
				39 : +1, //RIGHT 
				40 : +1 //DOWN
			};
			var positions = {
				top : 'prepend',
				bottom : 'append'
			};
			this.options = $.extend(defaults, config);

			var tabsCount = 0;
			if($("body").data('accessibleTabsCount') !== undefined){
				tabsCount = $("body").data('accessibleTabsCount');
			}
			$("body").data('accessibleTabsCount',this.size()+tabsCount);

			var o = this;
			return this.each(function(t) {
				var el = $(this);
				var list = '';
				var tabCount = 0;
				var ids = [];

				$(el).wrapInner('<div class="'+o.options.wrapperClass+'"></div>');
				debug($(el).find(o.options.tabhead).children("a"))

				$(el).find(o.options.tabhead).each(function(i){

					debug($(this))
					var id = '';
					var elId = $(this).attr('id');
					if(elId){
						// Skip this item if it already exists.
						if(elId.indexOf('accessibletabscontent') === 0) {
							return;
						}
						id =' id="'+elId+'"';
					}
					var tabId = o.getUniqueId('accessibletabscontent', tabsCount+t, i);//get a unique id to assign to this tab's heading
					var navItemId = o.getUniqueId('accessibletabsnavigation', tabsCount+t, i);//get a unique id for this navigation item
					ids.push(tabId);
					

					// SNK: support tab head with links
					var navItemText = ($(this).children("a").length>0)? $(this).children("a").html() :$(this).html() ;


					var ariaLabel="";

					if($(this).attr("aria-label")){
						ariaLabel='aria-label="'+$(this).attr("aria-label")+'"'
					}


					if(o.options.cssClassAvailable === true) {
						var cssClass = '';
						if($(this).attr('class')) {
							cssClass = $(this).attr('class');
							cssClass = ' class="'+cssClass+'"';
						}
						list += '<li id="'+navItemId+'"><a'+id+''+cssClass+' href="#'+tabId+'" '+ariaLabel+'>'+navItemText+'</a></li>';
					} else {
					  list += '<li id="'+navItemId+'"><a'+id+' href="#'+tabId+'" '+ariaLabel+'>'+navItemText+'</a></li>';
					}


					$(this).attr({"id": tabId, "class": o.options.tabheadClass, "tabindex": "-1"});//assign the unique id and the tabheadClass class name to this tab's heading
					tabCount++;
				});

				if (o.options.syncheights && $.fn[o.options.syncHeightMethodName]) {
					$(el).find(o.options.tabbody)[o.options.syncHeightMethodName]();
					$(window).resize(function(){
						$(el).find(o.options.tabbody)[o.options.syncHeightMethodName]();
					});
				}

				// Ensure that the call to setup tabs is re-runnable
				var tabs_selector = '.' + o.options.tabsListClass;
				if(!$(el).find(tabs_selector).length) {
					$(el)[positions[o.options.position]]('<ul class="'+o.options.clearfixClass+' '+o.options.tabsListClass+' tabamount'+tabCount+'"></ul>');
				}

				$(el).find(tabs_selector).append(list);

				// initial show first content block and hide the others
				var content = $(el).find(o.options.tabbody);
				if (content.length > 0) {
					$(content).hide();
					$(content[0]).show();
				}
				$(el).find("ul."+o.options.tabsListClass+">li:first").addClass(o.options.currentClass).addClass(o.options.firstNavItemClass)
				  .find('a')[o.options.currentInfoPosition]('<span class="'+o.options.currentInfoClass+'">'+o.options.currentInfoText+'</span>')
				  .parents("ul."+o.options.tabsListClass).children('li:last').addClass(o.options.lastNavItemClass);



				// SNK: add first and last class to tabhead

				var tabheads = $(el).find(o.options.tabhead);
				if (tabheads.length > 0) {
					$(tabheads[0]).addClass(o.options.currentClass).addClass(o.options.firstNavItemClass);
					$(tabheads[tabheads.length-1]).addClass(o.options.lastNavItemClass);
				}











				if (o.options.wrapInnerNavLinks) {
				  $(el).find('ul.'+o.options.tabsListClass+'>li>a').wrapInner(o.options.wrapInnerNavLinks);
				}

				$(el).find('ul.'+o.options.tabsListClass+'>li>a').each(function(i){
					$(this).click(function(event){
						event.preventDefault();
						el.trigger("showTab.accessibleTabs", [$(event.target)]);
						if(o.options.saveState && $.cookie){
							$.cookie('accessibletab_'+el.attr('id')+'_active',i);
						}
						$(el).find('ul.'+o.options.tabsListClass+'>li.'+o.options.currentClass).removeClass(o.options.currentClass)
						.find("span."+o.options.currentInfoClass).remove();

						// SNK: remove current class from tabhead
						$(el).find(o.options.tabhead).removeClass(o.options.currentClass);
						


						$(this).blur();
						$(el).find(o.options.tabbody+':visible').hide();
						$(el).find(o.options.tabbody).eq(i)[o.options.fx](o.options.fxspeed);
						$(this)[o.options.currentInfoPosition]('<span class="'+o.options.currentInfoClass+'">'+o.options.currentInfoText+'</span>')
						.parent().addClass(o.options.currentClass);


						// SNK: add active class to current tabhead
						$($(this).attr("href")).addClass(o.options.currentClass);



						//now, only after writing the currentInfoText span to the tab list link, set focus to the tab's heading

						$($(this).attr("href")).focus().keyup(function(event){
							if(keyCodes[event.keyCode]){
								o.showAccessibleTab(i+keyCodes[event.keyCode]);
								$(this).unbind( "keyup" );
							}
						});

						// $(el).find('.accessibletabsanchor').keyup(function(event){
						//     if(keyCodes[event.keyCode]){
						//         o.showAccessibleTab(i+keyCodes[event.keyCode]);
						//     }
						// });
					});

					$(this).focus(function(){
						$(document).keyup(function(event){
							if(keyCodes[event.keyCode]){
								o.showAccessibleTab(i+keyCodes[event.keyCode]);
							}
						});
					});
					$(this).blur(function(){
						$(document).unbind( "keyup" );
					});

				});

				if(o.options.saveState && $.cookie){
					var savedState = $.cookie('accessibletab_'+el.attr('id')+'_active');
					debug($.cookie('accessibletab_'+el.attr('id')+'_active'));
					if(savedState !== null){
						o.showAccessibleTab(savedState,el.attr('id'));
					}
				}

				if(o.options.autoAnchor && window.location.hash){
					var anchorTab = $('.'+o.options.tabsListClass).find(window.location.hash);
					if(anchorTab.size()){
						anchorTab.click();
					}
				}

				if(o.options.pagination){
					var m = '<ul class="pagination">';
					m +='    <li class="previous"><a href="#{previousAnchor}"><span>{previousHeadline}</span></a></li>';
					m +='    <li class="next"><a href="#{nextAnchor}"><span>{nextHeadline}</span></a></li>';
					m +='</ul>';
					var tabs = $(el).find('.tabbody');
					var tabcount = tabs.size();
					tabs.each(function(idx){
						$(this).append(m);
						var next = idx+1;
						if(next>=tabcount){next = 0;}
						var previous = idx-1;
						if(previous<0){previous = tabcount-1;}
						var p = $(this).find('.pagination');
						var previousEl = p.find('.previous');
						previousEl.find('span').text($('#'+ids[previous]).text());
						previousEl.find('a').attr('href','#'+ids[previous])
						.click(function(event){
							event.preventDefault();
							$(el).find('.tabs-list a').eq(previous).click();
						});
						var nextEl = p.find('.next');
						nextEl.find('span').text($('#'+ids[next]).text());
						nextEl.find('a').attr('href','#'+ids[next])
						.click(function(event){
							event.preventDefault();
							$(el).find('.tabs-list a').eq(next).click();
						});
					});
				}
			});
		},
		showAccessibleTab: function(index,id){
			debug('showAccessibleTab');
			var o = this;
			if(id) {
				var el = $('#'+id);
				var links = el.find('ul.'+o.options.tabsListClass+'>li>a');
				el.trigger("showTab.accessibleTabs", [links.eq(index)]);
				links.eq(index).click();
			} else {
				return this.each(function() {
					var el = $(this);
					el.trigger("showTab.accessibleTabs");
					var links = el.find('ul.'+o.options.tabsListClass+'>li>a');
					el.trigger("showTab.accessibleTabs", [links.eq(index)]);
					links.eq(index).click();
				});
			}
		},
		showAccessibleTabSelector: function(selector){
			debug('showAccessibleTabSelector');
			var el = $(selector);
			if(el){
				if(el.get(0).nodeName.toLowerCase() === 'a'){
					el.click();
				}else{
					debug('the selector of a showAccessibleTabSelector() call needs to point to a tabs headline!');
				}
			}
		}
	});
	// private Methods
	function debug(msg,info){
		if(debugMode && window.console && window.console.log){
			if(info){
				window.console.log(info+': ',msg);
			}else{
				window.console.log(msg);
			}
		}
	}
})(jQuery);


(function( factory ) {
	if ( typeof define === "function" && define.amd ) {

		// AMD. Register as an anonymous module.
		define([ "jquery" ], factory );
	} else {

		// Browser globals
		factory( jQuery );
	}
}(function( $ ) {

$.ui = $.ui || {};

var version = $.ui.version = "1.12.1";






var widgetUuid = 0;
var widgetSlice = Array.prototype.slice;

$.cleanData = ( function( orig ) {
	return function( elems ) {
		var events, elem, i;
		for ( i = 0; ( elem = elems[ i ] ) != null; i++ ) {
			try {

				// Only trigger remove when necessary to save time
				events = $._data( elem, "events" );
				if ( events && events.remove ) {
					$( elem ).triggerHandler( "remove" );
				}

			} catch ( e ) {}
		}
		orig( elems );
	};
} )( $.cleanData );

$.widget = function( name, base, prototype ) {
	var existingConstructor, constructor, basePrototype;

	// ProxiedPrototype allows the provided prototype to remain unmodified
	// so that it can be used as a mixin for multiple widgets (#8876)
	var proxiedPrototype = {};

	var namespace = name.split( "." )[ 0 ];
	name = name.split( "." )[ 1 ];
	var fullName = namespace + "-" + name;

	if ( !prototype ) {
		prototype = base;
		base = $.Widget;
	}

	if ( $.isArray( prototype ) ) {
		prototype = $.extend.apply( null, [ {} ].concat( prototype ) );
	}

	// Create selector for plugin
	$.expr[ ":" ][ fullName.toLowerCase() ] = function( elem ) {
		return !!$.data( elem, fullName );
	};

	$[ namespace ] = $[ namespace ] || {};
	existingConstructor = $[ namespace ][ name ];
	constructor = $[ namespace ][ name ] = function( options, element ) {

		// Allow instantiation without "new" keyword
		if ( !this._createWidget ) {
			return new constructor( options, element );
		}

		// Allow instantiation without initializing for simple inheritance
		// must use "new" keyword (the code above always passes args)
		if ( arguments.length ) {
			this._createWidget( options, element );
		}
	};

	// Extend with the existing constructor to carry over any static properties
	$.extend( constructor, existingConstructor, {
		version: prototype.version,

		// Copy the object used to create the prototype in case we need to
		// redefine the widget later
		_proto: $.extend( {}, prototype ),

		// Track widgets that inherit from this widget in case this widget is
		// redefined after a widget inherits from it
		_childConstructors: []
	} );

	basePrototype = new base();

	// We need to make the options hash a property directly on the new instance
	// otherwise we'll modify the options hash on the prototype that we're
	// inheriting from
	basePrototype.options = $.widget.extend( {}, basePrototype.options );
	$.each( prototype, function( prop, value ) {
		if ( !$.isFunction( value ) ) {
			proxiedPrototype[ prop ] = value;
			return;
		}
		proxiedPrototype[ prop ] = ( function() {
			function _super() {
				return base.prototype[ prop ].apply( this, arguments );
			}

			function _superApply( args ) {
				return base.prototype[ prop ].apply( this, args );
			}

			return function() {
				var __super = this._super;
				var __superApply = this._superApply;
				var returnValue;

				this._super = _super;
				this._superApply = _superApply;

				returnValue = value.apply( this, arguments );

				this._super = __super;
				this._superApply = __superApply;

				return returnValue;
			};
		} )();
	} );
	constructor.prototype = $.widget.extend( basePrototype, {

		// TODO: remove support for widgetEventPrefix
		// always use the name + a colon as the prefix, e.g., draggable:start
		// don't prefix for widgets that aren't DOM-based
		widgetEventPrefix: existingConstructor ? ( basePrototype.widgetEventPrefix || name ) : name
	}, proxiedPrototype, {
		constructor: constructor,
		namespace: namespace,
		widgetName: name,
		widgetFullName: fullName
	} );

	// If this widget is being redefined then we need to find all widgets that
	// are inheriting from it and redefine all of them so that they inherit from
	// the new version of this widget. We're essentially trying to replace one
	// level in the prototype chain.
	if ( existingConstructor ) {
		$.each( existingConstructor._childConstructors, function( i, child ) {
			var childPrototype = child.prototype;

			// Redefine the child widget using the same prototype that was
			// originally used, but inherit from the new version of the base
			$.widget( childPrototype.namespace + "." + childPrototype.widgetName, constructor,
				child._proto );
		} );

		// Remove the list of existing child constructors from the old constructor
		// so the old child constructors can be garbage collected
		delete existingConstructor._childConstructors;
	} else {
		base._childConstructors.push( constructor );
	}

	$.widget.bridge( name, constructor );

	return constructor;
};

$.widget.extend = function( target ) {
	var input = widgetSlice.call( arguments, 1 );
	var inputIndex = 0;
	var inputLength = input.length;
	var key;
	var value;

	for ( ; inputIndex < inputLength; inputIndex++ ) {
		for ( key in input[ inputIndex ] ) {
			value = input[ inputIndex ][ key ];
			if ( input[ inputIndex ].hasOwnProperty( key ) && value !== undefined ) {

				// Clone objects
				if ( $.isPlainObject( value ) ) {
					target[ key ] = $.isPlainObject( target[ key ] ) ?
						$.widget.extend( {}, target[ key ], value ) :

						// Don't extend strings, arrays, etc. with objects
						$.widget.extend( {}, value );

				// Copy everything else by reference
				} else {
					target[ key ] = value;
				}
			}
		}
	}
	return target;
};

$.widget.bridge = function( name, object ) {
	var fullName = object.prototype.widgetFullName || name;
	$.fn[ name ] = function( options ) {
		var isMethodCall = typeof options === "string";
		var args = widgetSlice.call( arguments, 1 );
		var returnValue = this;

		if ( isMethodCall ) {

			// If this is an empty collection, we need to have the instance method
			// return undefined instead of the jQuery instance
			if ( !this.length && options === "instance" ) {
				returnValue = undefined;
			} else {
				this.each( function() {
					var methodValue;
					var instance = $.data( this, fullName );

					if ( options === "instance" ) {
						returnValue = instance;
						return false;
					}

					if ( !instance ) {
						return $.error( "cannot call methods on " + name +
							" prior to initialization; " +
							"attempted to call method '" + options + "'" );
					}

					if ( !$.isFunction( instance[ options ] ) || options.charAt( 0 ) === "_" ) {
						return $.error( "no such method '" + options + "' for " + name +
							" widget instance" );
					}

					methodValue = instance[ options ].apply( instance, args );

					if ( methodValue !== instance && methodValue !== undefined ) {
						returnValue = methodValue && methodValue.jquery ?
							returnValue.pushStack( methodValue.get() ) :
							methodValue;
						return false;
					}
				} );
			}
		} else {

			// Allow multiple hashes to be passed on init
			if ( args.length ) {
				options = $.widget.extend.apply( null, [ options ].concat( args ) );
			}

			this.each( function() {
				var instance = $.data( this, fullName );
				if ( instance ) {
					instance.option( options || {} );
					if ( instance._init ) {
						instance._init();
					}
				} else {
					$.data( this, fullName, new object( options, this ) );
				}
			} );
		}

		return returnValue;
	};
};

$.Widget = function( /* options, element */ ) {};
$.Widget._childConstructors = [];

$.Widget.prototype = {
	widgetName: "widget",
	widgetEventPrefix: "",
	defaultElement: "<div>",

	options: {
		classes: {},
		disabled: false,

		// Callbacks
		create: null
	},

	_createWidget: function( options, element ) {
		element = $( element || this.defaultElement || this )[ 0 ];
		this.element = $( element );
		this.uuid = widgetUuid++;
		this.eventNamespace = "." + this.widgetName + this.uuid;

		this.bindings = $();
		this.hoverable = $();
		this.focusable = $();
		this.classesElementLookup = {};

		if ( element !== this ) {
			$.data( element, this.widgetFullName, this );
			this._on( true, this.element, {
				remove: function( event ) {
					if ( event.target === element ) {
						this.destroy();
					}
				}
			} );
			this.document = $( element.style ?

				// Element within the document
				element.ownerDocument :

				// Element is window or document
				element.document || element );
			this.window = $( this.document[ 0 ].defaultView || this.document[ 0 ].parentWindow );
		}

		this.options = $.widget.extend( {},
			this.options,
			this._getCreateOptions(),
			options );

		this._create();

		if ( this.options.disabled ) {
			this._setOptionDisabled( this.options.disabled );
		}

		this._trigger( "create", null, this._getCreateEventData() );
		this._init();
	},

	_getCreateOptions: function() {
		return {};
	},

	_getCreateEventData: $.noop,

	_create: $.noop,

	_init: $.noop,

	destroy: function() {
		var that = this;

		this._destroy();
		$.each( this.classesElementLookup, function( key, value ) {
			that._removeClass( value, key );
		} );

		// We can probably remove the unbind calls in 2.0
		// all event bindings should go through this._on()
		this.element
			.off( this.eventNamespace )
			.removeData( this.widgetFullName );
		this.widget()
			.off( this.eventNamespace )
			.removeAttr( "aria-disabled" );

		// Clean up events and states
		this.bindings.off( this.eventNamespace );
	},

	_destroy: $.noop,

	widget: function() {
		return this.element;
	},

	option: function( key, value ) {
		var options = key;
		var parts;
		var curOption;
		var i;

		if ( arguments.length === 0 ) {

			// Don't return a reference to the internal hash
			return $.widget.extend( {}, this.options );
		}

		if ( typeof key === "string" ) {

			// Handle nested keys, e.g., "foo.bar" => { foo: { bar: ___ } }
			options = {};
			parts = key.split( "." );
			key = parts.shift();
			if ( parts.length ) {
				curOption = options[ key ] = $.widget.extend( {}, this.options[ key ] );
				for ( i = 0; i < parts.length - 1; i++ ) {
					curOption[ parts[ i ] ] = curOption[ parts[ i ] ] || {};
					curOption = curOption[ parts[ i ] ];
				}
				key = parts.pop();
				if ( arguments.length === 1 ) {
					return curOption[ key ] === undefined ? null : curOption[ key ];
				}
				curOption[ key ] = value;
			} else {
				if ( arguments.length === 1 ) {
					return this.options[ key ] === undefined ? null : this.options[ key ];
				}
				options[ key ] = value;
			}
		}

		this._setOptions( options );

		return this;
	},

	_setOptions: function( options ) {
		var key;

		for ( key in options ) {
			this._setOption( key, options[ key ] );
		}

		return this;
	},

	_setOption: function( key, value ) {
		if ( key === "classes" ) {
			this._setOptionClasses( value );
		}

		this.options[ key ] = value;

		if ( key === "disabled" ) {
			this._setOptionDisabled( value );
		}

		return this;
	},

	_setOptionClasses: function( value ) {
		var classKey, elements, currentElements;

		for ( classKey in value ) {
			currentElements = this.classesElementLookup[ classKey ];
			if ( value[ classKey ] === this.options.classes[ classKey ] ||
					!currentElements ||
					!currentElements.length ) {
				continue;
			}

			// We are doing this to create a new jQuery object because the _removeClass() call
			// on the next line is going to destroy the reference to the current elements being
			// tracked. We need to save a copy of this collection so that we can add the new classes
			// below.
			elements = $( currentElements.get() );
			this._removeClass( currentElements, classKey );

			// We don't use _addClass() here, because that uses this.options.classes
			// for generating the string of classes. We want to use the value passed in from
			// _setOption(), this is the new value of the classes option which was passed to
			// _setOption(). We pass this value directly to _classes().
			elements.addClass( this._classes( {
				element: elements,
				keys: classKey,
				classes: value,
				add: true
			} ) );
		}
	},

	_setOptionDisabled: function( value ) {
		this._toggleClass( this.widget(), this.widgetFullName + "-disabled", null, !!value );

		// If the widget is becoming disabled, then nothing is interactive
		if ( value ) {
			this._removeClass( this.hoverable, null, "ui-state-hover" );
			this._removeClass( this.focusable, null, "ui-state-focus" );
		}
	},

	enable: function() {
		return this._setOptions( { disabled: false } );
	},

	disable: function() {
		return this._setOptions( { disabled: true } );
	},

	_classes: function( options ) {
		var full = [];
		var that = this;

		options = $.extend( {
			element: this.element,
			classes: this.options.classes || {}
		}, options );

		function processClassString( classes, checkOption ) {
			var current, i;
			for ( i = 0; i < classes.length; i++ ) {
				current = that.classesElementLookup[ classes[ i ] ] || $();
				if ( options.add ) {
					current = $( $.unique( current.get().concat( options.element.get() ) ) );
				} else {
					current = $( current.not( options.element ).get() );
				}
				that.classesElementLookup[ classes[ i ] ] = current;
				full.push( classes[ i ] );
				if ( checkOption && options.classes[ classes[ i ] ] ) {
					full.push( options.classes[ classes[ i ] ] );
				}
			}
		}

		this._on( options.element, {
			"remove": "_untrackClassesElement"
		} );

		if ( options.keys ) {
			processClassString( options.keys.match( /\S+/g ) || [], true );
		}
		if ( options.extra ) {
			processClassString( options.extra.match( /\S+/g ) || [] );
		}

		return full.join( " " );
	},

	_untrackClassesElement: function( event ) {
		var that = this;
		$.each( that.classesElementLookup, function( key, value ) {
			if ( $.inArray( event.target, value ) !== -1 ) {
				that.classesElementLookup[ key ] = $( value.not( event.target ).get() );
			}
		} );
	},

	_removeClass: function( element, keys, extra ) {
		return this._toggleClass( element, keys, extra, false );
	},

	_addClass: function( element, keys, extra ) {
		return this._toggleClass( element, keys, extra, true );
	},

	_toggleClass: function( element, keys, extra, add ) {
		add = ( typeof add === "boolean" ) ? add : extra;
		var shift = ( typeof element === "string" || element === null ),
			options = {
				extra: shift ? keys : extra,
				keys: shift ? element : keys,
				element: shift ? this.element : element,
				add: add
			};
		options.element.toggleClass( this._classes( options ), add );
		return this;
	},

	_on: function( suppressDisabledCheck, element, handlers ) {
		var delegateElement;
		var instance = this;

		// No suppressDisabledCheck flag, shuffle arguments
		if ( typeof suppressDisabledCheck !== "boolean" ) {
			handlers = element;
			element = suppressDisabledCheck;
			suppressDisabledCheck = false;
		}

		// No element argument, shuffle and use this.element
		if ( !handlers ) {
			handlers = element;
			element = this.element;
			delegateElement = this.widget();
		} else {
			element = delegateElement = $( element );
			this.bindings = this.bindings.add( element );
		}

		$.each( handlers, function( event, handler ) {
			function handlerProxy() {

				// Allow widgets to customize the disabled handling
				// - disabled as an array instead of boolean
				// - disabled class as method for disabling individual parts
				if ( !suppressDisabledCheck &&
						( instance.options.disabled === true ||
						$( this ).hasClass( "ui-state-disabled" ) ) ) {
					return;
				}
				return ( typeof handler === "string" ? instance[ handler ] : handler )
					.apply( instance, arguments );
			}

			// Copy the guid so direct unbinding works
			if ( typeof handler !== "string" ) {
				handlerProxy.guid = handler.guid =
					handler.guid || handlerProxy.guid || $.guid++;
			}

			var match = event.match( /^([\w:-]*)\s*(.*)$/ );
			var eventName = match[ 1 ] + instance.eventNamespace;
			var selector = match[ 2 ];

			if ( selector ) {
				delegateElement.on( eventName, selector, handlerProxy );
			} else {
				element.on( eventName, handlerProxy );
			}
		} );
	},

	_off: function( element, eventName ) {
		eventName = ( eventName || "" ).split( " " ).join( this.eventNamespace + " " ) +
			this.eventNamespace;
		element.off( eventName ).off( eventName );

		// Clear the stack to avoid memory leaks (#10056)
		this.bindings = $( this.bindings.not( element ).get() );
		this.focusable = $( this.focusable.not( element ).get() );
		this.hoverable = $( this.hoverable.not( element ).get() );
	},

	_delay: function( handler, delay ) {
		function handlerProxy() {
			return ( typeof handler === "string" ? instance[ handler ] : handler )
				.apply( instance, arguments );
		}
		var instance = this;
		return setTimeout( handlerProxy, delay || 0 );
	},

	_hoverable: function( element ) {
		this.hoverable = this.hoverable.add( element );
		this._on( element, {
			mouseenter: function( event ) {
				this._addClass( $( event.currentTarget ), null, "ui-state-hover" );
			},
			mouseleave: function( event ) {
				this._removeClass( $( event.currentTarget ), null, "ui-state-hover" );
			}
		} );
	},

	_focusable: function( element ) {
		this.focusable = this.focusable.add( element );
		this._on( element, {
			focusin: function( event ) {
				this._addClass( $( event.currentTarget ), null, "ui-state-focus" );
			},
			focusout: function( event ) {
				this._removeClass( $( event.currentTarget ), null, "ui-state-focus" );
			}
		} );
	},

	_trigger: function( type, event, data ) {
		var prop, orig;
		var callback = this.options[ type ];

		data = data || {};
		event = $.Event( event );
		event.type = ( type === this.widgetEventPrefix ?
			type :
			this.widgetEventPrefix + type ).toLowerCase();

		// The original event may come from any element
		// so we need to reset the target on the new event
		event.target = this.element[ 0 ];

		// Copy original event properties over to the new event
		orig = event.originalEvent;
		if ( orig ) {
			for ( prop in orig ) {
				if ( !( prop in event ) ) {
					event[ prop ] = orig[ prop ];
				}
			}
		}

		this.element.trigger( event, data );
		return !( $.isFunction( callback ) &&
			callback.apply( this.element[ 0 ], [ event ].concat( data ) ) === false ||
			event.isDefaultPrevented() );
	}
};

$.each( { show: "fadeIn", hide: "fadeOut" }, function( method, defaultEffect ) {
	$.Widget.prototype[ "_" + method ] = function( element, options, callback ) {
		if ( typeof options === "string" ) {
			options = { effect: options };
		}

		var hasOptions;
		var effectName = !options ?
			method :
			options === true || typeof options === "number" ?
				defaultEffect :
				options.effect || defaultEffect;

		options = options || {};
		if ( typeof options === "number" ) {
			options = { duration: options };
		}

		hasOptions = !$.isEmptyObject( options );
		options.complete = callback;

		if ( options.delay ) {
			element.delay( options.delay );
		}

		if ( hasOptions && $.effects && $.effects.effect[ effectName ] ) {
			element[ method ]( options );
		} else if ( effectName !== method && element[ effectName ] ) {
			element[ effectName ]( options.duration, options.easing, callback );
		} else {
			element.queue( function( next ) {
				$( this )[ method ]();
				if ( callback ) {
					callback.call( element[ 0 ] );
				}
				next();
			} );
		}
	};
} );

var widget = $.widget;





( function() {
var cachedScrollbarWidth,
	max = Math.max,
	abs = Math.abs,
	rhorizontal = /left|center|right/,
	rvertical = /top|center|bottom/,
	roffset = /[\+\-]\d+(\.[\d]+)?%?/,
	rposition = /^\w+/,
	rpercent = /%$/,
	_position = $.fn.position;

function getOffsets( offsets, width, height ) {
	return [
		parseFloat( offsets[ 0 ] ) * ( rpercent.test( offsets[ 0 ] ) ? width / 100 : 1 ),
		parseFloat( offsets[ 1 ] ) * ( rpercent.test( offsets[ 1 ] ) ? height / 100 : 1 )
	];
}

function parseCss( element, property ) {
	return parseInt( $.css( element, property ), 10 ) || 0;
}

function getDimensions( elem ) {
	var raw = elem[ 0 ];
	if ( raw.nodeType === 9 ) {
		return {
			width: elem.width(),
			height: elem.height(),
			offset: { top: 0, left: 0 }
		};
	}
	if ( $.isWindow( raw ) ) {
		return {
			width: elem.width(),
			height: elem.height(),
			offset: { top: elem.scrollTop(), left: elem.scrollLeft() }
		};
	}
	if ( raw.preventDefault ) {
		return {
			width: 0,
			height: 0,
			offset: { top: raw.pageY, left: raw.pageX }
		};
	}
	return {
		width: elem.outerWidth(),
		height: elem.outerHeight(),
		offset: elem.offset()
	};
}

$.position = {
	scrollbarWidth: function() {
		if ( cachedScrollbarWidth !== undefined ) {
			return cachedScrollbarWidth;
		}
		var w1, w2,
			div = $( "<div " +
				"style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'>" +
				"<div style='height:100px;width:auto;'></div></div>" ),
			innerDiv = div.children()[ 0 ];

		$( "body" ).append( div );
		w1 = innerDiv.offsetWidth;
		div.css( "overflow", "scroll" );

		w2 = innerDiv.offsetWidth;

		if ( w1 === w2 ) {
			w2 = div[ 0 ].clientWidth;
		}

		div.remove();

		return ( cachedScrollbarWidth = w1 - w2 );
	},
	getScrollInfo: function( within ) {
		var overflowX = within.isWindow || within.isDocument ? "" :
				within.element.css( "overflow-x" ),
			overflowY = within.isWindow || within.isDocument ? "" :
				within.element.css( "overflow-y" ),
			hasOverflowX = overflowX === "scroll" ||
				( overflowX === "auto" && within.width < within.element[ 0 ].scrollWidth ),
			hasOverflowY = overflowY === "scroll" ||
				( overflowY === "auto" && within.height < within.element[ 0 ].scrollHeight );
		return {
			width: hasOverflowY ? $.position.scrollbarWidth() : 0,
			height: hasOverflowX ? $.position.scrollbarWidth() : 0
		};
	},
	getWithinInfo: function( element ) {
		var withinElement = $( element || window ),
			isWindow = $.isWindow( withinElement[ 0 ] ),
			isDocument = !!withinElement[ 0 ] && withinElement[ 0 ].nodeType === 9,
			hasOffset = !isWindow && !isDocument;
		return {
			element: withinElement,
			isWindow: isWindow,
			isDocument: isDocument,
			offset: hasOffset ? $( element ).offset() : { left: 0, top: 0 },
			scrollLeft: withinElement.scrollLeft(),
			scrollTop: withinElement.scrollTop(),
			width: withinElement.outerWidth(),
			height: withinElement.outerHeight()
		};
	}
};

$.fn.position = function( options ) {
	if ( !options || !options.of ) {
		return _position.apply( this, arguments );
	}

	// Make a copy, we don't want to modify arguments
	options = $.extend( {}, options );

	var atOffset, targetWidth, targetHeight, targetOffset, basePosition, dimensions,
		target = $( options.of ),
		within = $.position.getWithinInfo( options.within ),
		scrollInfo = $.position.getScrollInfo( within ),
		collision = ( options.collision || "flip" ).split( " " ),
		offsets = {};

	dimensions = getDimensions( target );
	if ( target[ 0 ].preventDefault ) {

		// Force left top to allow flipping
		options.at = "left top";
	}
	targetWidth = dimensions.width;
	targetHeight = dimensions.height;
	targetOffset = dimensions.offset;

	// Clone to reuse original targetOffset later
	basePosition = $.extend( {}, targetOffset );

	// Force my and at to have valid horizontal and vertical positions
	// if a value is missing or invalid, it will be converted to center
	$.each( [ "my", "at" ], function() {
		var pos = ( options[ this ] || "" ).split( " " ),
			horizontalOffset,
			verticalOffset;

		if ( pos.length === 1 ) {
			pos = rhorizontal.test( pos[ 0 ] ) ?
				pos.concat( [ "center" ] ) :
				rvertical.test( pos[ 0 ] ) ?
					[ "center" ].concat( pos ) :
					[ "center", "center" ];
		}
		pos[ 0 ] = rhorizontal.test( pos[ 0 ] ) ? pos[ 0 ] : "center";
		pos[ 1 ] = rvertical.test( pos[ 1 ] ) ? pos[ 1 ] : "center";

		// Calculate offsets
		horizontalOffset = roffset.exec( pos[ 0 ] );
		verticalOffset = roffset.exec( pos[ 1 ] );
		offsets[ this ] = [
			horizontalOffset ? horizontalOffset[ 0 ] : 0,
			verticalOffset ? verticalOffset[ 0 ] : 0
		];

		// Reduce to just the positions without the offsets
		options[ this ] = [
			rposition.exec( pos[ 0 ] )[ 0 ],
			rposition.exec( pos[ 1 ] )[ 0 ]
		];
	} );

	// Normalize collision option
	if ( collision.length === 1 ) {
		collision[ 1 ] = collision[ 0 ];
	}

	if ( options.at[ 0 ] === "right" ) {
		basePosition.left += targetWidth;
	} else if ( options.at[ 0 ] === "center" ) {
		basePosition.left += targetWidth / 2;
	}

	if ( options.at[ 1 ] === "bottom" ) {
		basePosition.top += targetHeight;
	} else if ( options.at[ 1 ] === "center" ) {
		basePosition.top += targetHeight / 2;
	}

	atOffset = getOffsets( offsets.at, targetWidth, targetHeight );
	basePosition.left += atOffset[ 0 ];
	basePosition.top += atOffset[ 1 ];

	return this.each( function() {
		var collisionPosition, using,
			elem = $( this ),
			elemWidth = elem.outerWidth(),
			elemHeight = elem.outerHeight(),
			marginLeft = parseCss( this, "marginLeft" ),
			marginTop = parseCss( this, "marginTop" ),
			collisionWidth = elemWidth + marginLeft + parseCss( this, "marginRight" ) +
				scrollInfo.width,
			collisionHeight = elemHeight + marginTop + parseCss( this, "marginBottom" ) +
				scrollInfo.height,
			position = $.extend( {}, basePosition ),
			myOffset = getOffsets( offsets.my, elem.outerWidth(), elem.outerHeight() );

		if ( options.my[ 0 ] === "right" ) {
			position.left -= elemWidth;
		} else if ( options.my[ 0 ] === "center" ) {
			position.left -= elemWidth / 2;
		}

		if ( options.my[ 1 ] === "bottom" ) {
			position.top -= elemHeight;
		} else if ( options.my[ 1 ] === "center" ) {
			position.top -= elemHeight / 2;
		}

		position.left += myOffset[ 0 ];
		position.top += myOffset[ 1 ];

		collisionPosition = {
			marginLeft: marginLeft,
			marginTop: marginTop
		};

		$.each( [ "left", "top" ], function( i, dir ) {
			if ( $.ui.position[ collision[ i ] ] ) {
				$.ui.position[ collision[ i ] ][ dir ]( position, {
					targetWidth: targetWidth,
					targetHeight: targetHeight,
					elemWidth: elemWidth,
					elemHeight: elemHeight,
					collisionPosition: collisionPosition,
					collisionWidth: collisionWidth,
					collisionHeight: collisionHeight,
					offset: [ atOffset[ 0 ] + myOffset[ 0 ], atOffset [ 1 ] + myOffset[ 1 ] ],
					my: options.my,
					at: options.at,
					within: within,
					elem: elem
				} );
			}
		} );

		if ( options.using ) {

			// Adds feedback as second argument to using callback, if present
			using = function( props ) {
				var left = targetOffset.left - position.left,
					right = left + targetWidth - elemWidth,
					top = targetOffset.top - position.top,
					bottom = top + targetHeight - elemHeight,
					feedback = {
						target: {
							element: target,
							left: targetOffset.left,
							top: targetOffset.top,
							width: targetWidth,
							height: targetHeight
						},
						element: {
							element: elem,
							left: position.left,
							top: position.top,
							width: elemWidth,
							height: elemHeight
						},
						horizontal: right < 0 ? "left" : left > 0 ? "right" : "center",
						vertical: bottom < 0 ? "top" : top > 0 ? "bottom" : "middle"
					};
				if ( targetWidth < elemWidth && abs( left + right ) < targetWidth ) {
					feedback.horizontal = "center";
				}
				if ( targetHeight < elemHeight && abs( top + bottom ) < targetHeight ) {
					feedback.vertical = "middle";
				}
				if ( max( abs( left ), abs( right ) ) > max( abs( top ), abs( bottom ) ) ) {
					feedback.important = "horizontal";
				} else {
					feedback.important = "vertical";
				}
				options.using.call( this, props, feedback );
			};
		}

		elem.offset( $.extend( position, { using: using } ) );
	} );
};

$.ui.position = {
	fit: {
		left: function( position, data ) {
			var within = data.within,
				withinOffset = within.isWindow ? within.scrollLeft : within.offset.left,
				outerWidth = within.width,
				collisionPosLeft = position.left - data.collisionPosition.marginLeft,
				overLeft = withinOffset - collisionPosLeft,
				overRight = collisionPosLeft + data.collisionWidth - outerWidth - withinOffset,
				newOverRight;

			// Element is wider than within
			if ( data.collisionWidth > outerWidth ) {

				// Element is initially over the left side of within
				if ( overLeft > 0 && overRight <= 0 ) {
					newOverRight = position.left + overLeft + data.collisionWidth - outerWidth -
						withinOffset;
					position.left += overLeft - newOverRight;

				// Element is initially over right side of within
				} else if ( overRight > 0 && overLeft <= 0 ) {
					position.left = withinOffset;

				// Element is initially over both left and right sides of within
				} else {
					if ( overLeft > overRight ) {
						position.left = withinOffset + outerWidth - data.collisionWidth;
					} else {
						position.left = withinOffset;
					}
				}

			// Too far left -> align with left edge
			} else if ( overLeft > 0 ) {
				position.left += overLeft;

			// Too far right -> align with right edge
			} else if ( overRight > 0 ) {
				position.left -= overRight;

			// Adjust based on position and margin
			} else {
				position.left = max( position.left - collisionPosLeft, position.left );
			}
		},
		top: function( position, data ) {
			var within = data.within,
				withinOffset = within.isWindow ? within.scrollTop : within.offset.top,
				outerHeight = data.within.height,
				collisionPosTop = position.top - data.collisionPosition.marginTop,
				overTop = withinOffset - collisionPosTop,
				overBottom = collisionPosTop + data.collisionHeight - outerHeight - withinOffset,
				newOverBottom;

			// Element is taller than within
			if ( data.collisionHeight > outerHeight ) {

				// Element is initially over the top of within
				if ( overTop > 0 && overBottom <= 0 ) {
					newOverBottom = position.top + overTop + data.collisionHeight - outerHeight -
						withinOffset;
					position.top += overTop - newOverBottom;

				// Element is initially over bottom of within
				} else if ( overBottom > 0 && overTop <= 0 ) {
					position.top = withinOffset;

				// Element is initially over both top and bottom of within
				} else {
					if ( overTop > overBottom ) {
						position.top = withinOffset + outerHeight - data.collisionHeight;
					} else {
						position.top = withinOffset;
					}
				}

			// Too far up -> align with top
			} else if ( overTop > 0 ) {
				position.top += overTop;

			// Too far down -> align with bottom edge
			} else if ( overBottom > 0 ) {
				position.top -= overBottom;

			// Adjust based on position and margin
			} else {
				position.top = max( position.top - collisionPosTop, position.top );
			}
		}
	},
	flip: {
		left: function( position, data ) {
			var within = data.within,
				withinOffset = within.offset.left + within.scrollLeft,
				outerWidth = within.width,
				offsetLeft = within.isWindow ? within.scrollLeft : within.offset.left,
				collisionPosLeft = position.left - data.collisionPosition.marginLeft,
				overLeft = collisionPosLeft - offsetLeft,
				overRight = collisionPosLeft + data.collisionWidth - outerWidth - offsetLeft,
				myOffset = data.my[ 0 ] === "left" ?
					-data.elemWidth :
					data.my[ 0 ] === "right" ?
						data.elemWidth :
						0,
				atOffset = data.at[ 0 ] === "left" ?
					data.targetWidth :
					data.at[ 0 ] === "right" ?
						-data.targetWidth :
						0,
				offset = -2 * data.offset[ 0 ],
				newOverRight,
				newOverLeft;

			if ( overLeft < 0 ) {
				newOverRight = position.left + myOffset + atOffset + offset + data.collisionWidth -
					outerWidth - withinOffset;
				if ( newOverRight < 0 || newOverRight < abs( overLeft ) ) {
					position.left += myOffset + atOffset + offset;
				}
			} else if ( overRight > 0 ) {
				newOverLeft = position.left - data.collisionPosition.marginLeft + myOffset +
					atOffset + offset - offsetLeft;
				if ( newOverLeft > 0 || abs( newOverLeft ) < overRight ) {
					position.left += myOffset + atOffset + offset;
				}
			}
		},
		top: function( position, data ) {
			var within = data.within,
				withinOffset = within.offset.top + within.scrollTop,
				outerHeight = within.height,
				offsetTop = within.isWindow ? within.scrollTop : within.offset.top,
				collisionPosTop = position.top - data.collisionPosition.marginTop,
				overTop = collisionPosTop - offsetTop,
				overBottom = collisionPosTop + data.collisionHeight - outerHeight - offsetTop,
				top = data.my[ 1 ] === "top",
				myOffset = top ?
					-data.elemHeight :
					data.my[ 1 ] === "bottom" ?
						data.elemHeight :
						0,
				atOffset = data.at[ 1 ] === "top" ?
					data.targetHeight :
					data.at[ 1 ] === "bottom" ?
						-data.targetHeight :
						0,
				offset = -2 * data.offset[ 1 ],
				newOverTop,
				newOverBottom;
			if ( overTop < 0 ) {
				newOverBottom = position.top + myOffset + atOffset + offset + data.collisionHeight -
					outerHeight - withinOffset;
				if ( newOverBottom < 0 || newOverBottom < abs( overTop ) ) {
					position.top += myOffset + atOffset + offset;
				}
			} else if ( overBottom > 0 ) {
				newOverTop = position.top - data.collisionPosition.marginTop + myOffset + atOffset +
					offset - offsetTop;
				if ( newOverTop > 0 || abs( newOverTop ) < overBottom ) {
					position.top += myOffset + atOffset + offset;
				}
			}
		}
	},
	flipfit: {
		left: function() {
			$.ui.position.flip.left.apply( this, arguments );
			$.ui.position.fit.left.apply( this, arguments );
		},
		top: function() {
			$.ui.position.flip.top.apply( this, arguments );
			$.ui.position.fit.top.apply( this, arguments );
		}
	}
};

} )();

var position = $.ui.position;





var data = $.extend( $.expr[ ":" ], {
	data: $.expr.createPseudo ?
		$.expr.createPseudo( function( dataName ) {
			return function( elem ) {
				return !!$.data( elem, dataName );
			};
		} ) :

		// Support: jQuery <1.8
		function( elem, i, match ) {
			return !!$.data( elem, match[ 3 ] );
		}
} );



// This file is deprecated


var disableSelection = $.fn.extend( {
	disableSelection: ( function() {
		var eventType = "onselectstart" in document.createElement( "div" ) ?
			"selectstart" :
			"mousedown";

		return function() {
			return this.on( eventType + ".ui-disableSelection", function( event ) {
				event.preventDefault();
			} );
		};
	} )(),

	enableSelection: function() {
		return this.off( ".ui-disableSelection" );
	}
} );






var dataSpace = "ui-effects-",
	dataSpaceStyle = "ui-effects-style",
	dataSpaceAnimated = "ui-effects-animated",

	// Create a local jQuery because jQuery Color relies on it and the
	// global may not exist with AMD and a custom build (#10199)
	jQuery = $;

$.effects = {
	effect: {}
};


( function( jQuery, undefined ) {

	var stepHooks = "backgroundColor borderBottomColor borderLeftColor borderRightColor " +
		"borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",

	// Plusequals test for += 100 -= 100
	rplusequals = /^([\-+])=\s*(\d+\.?\d*)/,

	// A set of RE's that can match strings and generate color tuples.
	stringParsers = [ {
			re: /rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
			parse: function( execResult ) {
				return [
					execResult[ 1 ],
					execResult[ 2 ],
					execResult[ 3 ],
					execResult[ 4 ]
				];
			}
		}, {
			re: /rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
			parse: function( execResult ) {
				return [
					execResult[ 1 ] * 2.55,
					execResult[ 2 ] * 2.55,
					execResult[ 3 ] * 2.55,
					execResult[ 4 ]
				];
			}
		}, {

			// This regex ignores A-F because it's compared against an already lowercased string
			re: /#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,
			parse: function( execResult ) {
				return [
					parseInt( execResult[ 1 ], 16 ),
					parseInt( execResult[ 2 ], 16 ),
					parseInt( execResult[ 3 ], 16 )
				];
			}
		}, {

			// This regex ignores A-F because it's compared against an already lowercased string
			re: /#([a-f0-9])([a-f0-9])([a-f0-9])/,
			parse: function( execResult ) {
				return [
					parseInt( execResult[ 1 ] + execResult[ 1 ], 16 ),
					parseInt( execResult[ 2 ] + execResult[ 2 ], 16 ),
					parseInt( execResult[ 3 ] + execResult[ 3 ], 16 )
				];
			}
		}, {
			re: /hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,
			space: "hsla",
			parse: function( execResult ) {
				return [
					execResult[ 1 ],
					execResult[ 2 ] / 100,
					execResult[ 3 ] / 100,
					execResult[ 4 ]
				];
			}
		} ],

	// JQuery.Color( )
	color = jQuery.Color = function( color, green, blue, alpha ) {
		return new jQuery.Color.fn.parse( color, green, blue, alpha );
	},
	spaces = {
		rgba: {
			props: {
				red: {
					idx: 0,
					type: "byte"
				},
				green: {
					idx: 1,
					type: "byte"
				},
				blue: {
					idx: 2,
					type: "byte"
				}
			}
		},

		hsla: {
			props: {
				hue: {
					idx: 0,
					type: "degrees"
				},
				saturation: {
					idx: 1,
					type: "percent"
				},
				lightness: {
					idx: 2,
					type: "percent"
				}
			}
		}
	},
	propTypes = {
		"byte": {
			floor: true,
			max: 255
		},
		"percent": {
			max: 1
		},
		"degrees": {
			mod: 360,
			floor: true
		}
	},
	support = color.support = {},

	// Element for support tests
	supportElem = jQuery( "<p>" )[ 0 ],

	// Colors = jQuery.Color.names
	colors,

	// Local aliases of functions called often
	each = jQuery.each;

// Determine rgba support immediately
supportElem.style.cssText = "background-color:rgba(1,1,1,.5)";
support.rgba = supportElem.style.backgroundColor.indexOf( "rgba" ) > -1;

// Define cache name and alpha properties
// for rgba and hsla spaces
each( spaces, function( spaceName, space ) {
	space.cache = "_" + spaceName;
	space.props.alpha = {
		idx: 3,
		type: "percent",
		def: 1
	};
} );

function clamp( value, prop, allowEmpty ) {
	var type = propTypes[ prop.type ] || {};

	if ( value == null ) {
		return ( allowEmpty || !prop.def ) ? null : prop.def;
	}

	// ~~ is an short way of doing floor for positive numbers
	value = type.floor ? ~~value : parseFloat( value );

	// IE will pass in empty strings as value for alpha,
	// which will hit this case
	if ( isNaN( value ) ) {
		return prop.def;
	}

	if ( type.mod ) {

		// We add mod before modding to make sure that negatives values
		// get converted properly: -10 -> 350
		return ( value + type.mod ) % type.mod;
	}

	// For now all property types without mod have min and max
	return 0 > value ? 0 : type.max < value ? type.max : value;
}

function stringParse( string ) {
	var inst = color(),
		rgba = inst._rgba = [];

	string = string.toLowerCase();

	each( stringParsers, function( i, parser ) {
		var parsed,
			match = parser.re.exec( string ),
			values = match && parser.parse( match ),
			spaceName = parser.space || "rgba";

		if ( values ) {
			parsed = inst[ spaceName ]( values );

			// If this was an rgba parse the assignment might happen twice
			// oh well....
			inst[ spaces[ spaceName ].cache ] = parsed[ spaces[ spaceName ].cache ];
			rgba = inst._rgba = parsed._rgba;

			// Exit each( stringParsers ) here because we matched
			return false;
		}
	} );

	// Found a stringParser that handled it
	if ( rgba.length ) {

		// If this came from a parsed string, force "transparent" when alpha is 0
		// chrome, (and maybe others) return "transparent" as rgba(0,0,0,0)
		if ( rgba.join() === "0,0,0,0" ) {
			jQuery.extend( rgba, colors.transparent );
		}
		return inst;
	}

	// Named colors
	return colors[ string ];
}

color.fn = jQuery.extend( color.prototype, {
	parse: function( red, green, blue, alpha ) {
		if ( red === undefined ) {
			this._rgba = [ null, null, null, null ];
			return this;
		}
		if ( red.jquery || red.nodeType ) {
			red = jQuery( red ).css( green );
			green = undefined;
		}

		var inst = this,
			type = jQuery.type( red ),
			rgba = this._rgba = [];

		// More than 1 argument specified - assume ( red, green, blue, alpha )
		if ( green !== undefined ) {
			red = [ red, green, blue, alpha ];
			type = "array";
		}

		if ( type === "string" ) {
			return this.parse( stringParse( red ) || colors._default );
		}

		if ( type === "array" ) {
			each( spaces.rgba.props, function( key, prop ) {
				rgba[ prop.idx ] = clamp( red[ prop.idx ], prop );
			} );
			return this;
		}

		if ( type === "object" ) {
			if ( red instanceof color ) {
				each( spaces, function( spaceName, space ) {
					if ( red[ space.cache ] ) {
						inst[ space.cache ] = red[ space.cache ].slice();
					}
				} );
			} else {
				each( spaces, function( spaceName, space ) {
					var cache = space.cache;
					each( space.props, function( key, prop ) {

						// If the cache doesn't exist, and we know how to convert
						if ( !inst[ cache ] && space.to ) {

							// If the value was null, we don't need to copy it
							// if the key was alpha, we don't need to copy it either
							if ( key === "alpha" || red[ key ] == null ) {
								return;
							}
							inst[ cache ] = space.to( inst._rgba );
						}

						// This is the only case where we allow nulls for ALL properties.
						// call clamp with alwaysAllowEmpty
						inst[ cache ][ prop.idx ] = clamp( red[ key ], prop, true );
					} );

					// Everything defined but alpha?
					if ( inst[ cache ] &&
							jQuery.inArray( null, inst[ cache ].slice( 0, 3 ) ) < 0 ) {

						// Use the default of 1
						inst[ cache ][ 3 ] = 1;
						if ( space.from ) {
							inst._rgba = space.from( inst[ cache ] );
						}
					}
				} );
			}
			return this;
		}
	},
	is: function( compare ) {
		var is = color( compare ),
			same = true,
			inst = this;

		each( spaces, function( _, space ) {
			var localCache,
				isCache = is[ space.cache ];
			if ( isCache ) {
				localCache = inst[ space.cache ] || space.to && space.to( inst._rgba ) || [];
				each( space.props, function( _, prop ) {
					if ( isCache[ prop.idx ] != null ) {
						same = ( isCache[ prop.idx ] === localCache[ prop.idx ] );
						return same;
					}
				} );
			}
			return same;
		} );
		return same;
	},
	_space: function() {
		var used = [],
			inst = this;
		each( spaces, function( spaceName, space ) {
			if ( inst[ space.cache ] ) {
				used.push( spaceName );
			}
		} );
		return used.pop();
	},
	transition: function( other, distance ) {
		var end = color( other ),
			spaceName = end._space(),
			space = spaces[ spaceName ],
			startColor = this.alpha() === 0 ? color( "transparent" ) : this,
			start = startColor[ space.cache ] || space.to( startColor._rgba ),
			result = start.slice();

		end = end[ space.cache ];
		each( space.props, function( key, prop ) {
			var index = prop.idx,
				startValue = start[ index ],
				endValue = end[ index ],
				type = propTypes[ prop.type ] || {};

			// If null, don't override start value
			if ( endValue === null ) {
				return;
			}

			// If null - use end
			if ( startValue === null ) {
				result[ index ] = endValue;
			} else {
				if ( type.mod ) {
					if ( endValue - startValue > type.mod / 2 ) {
						startValue += type.mod;
					} else if ( startValue - endValue > type.mod / 2 ) {
						startValue -= type.mod;
					}
				}
				result[ index ] = clamp( ( endValue - startValue ) * distance + startValue, prop );
			}
		} );
		return this[ spaceName ]( result );
	},
	blend: function( opaque ) {

		// If we are already opaque - return ourself
		if ( this._rgba[ 3 ] === 1 ) {
			return this;
		}

		var rgb = this._rgba.slice(),
			a = rgb.pop(),
			blend = color( opaque )._rgba;

		return color( jQuery.map( rgb, function( v, i ) {
			return ( 1 - a ) * blend[ i ] + a * v;
		} ) );
	},
	toRgbaString: function() {
		var prefix = "rgba(",
			rgba = jQuery.map( this._rgba, function( v, i ) {
				return v == null ? ( i > 2 ? 1 : 0 ) : v;
			} );

		if ( rgba[ 3 ] === 1 ) {
			rgba.pop();
			prefix = "rgb(";
		}

		return prefix + rgba.join() + ")";
	},
	toHslaString: function() {
		var prefix = "hsla(",
			hsla = jQuery.map( this.hsla(), function( v, i ) {
				if ( v == null ) {
					v = i > 2 ? 1 : 0;
				}

				// Catch 1 and 2
				if ( i && i < 3 ) {
					v = Math.round( v * 100 ) + "%";
				}
				return v;
			} );

		if ( hsla[ 3 ] === 1 ) {
			hsla.pop();
			prefix = "hsl(";
		}
		return prefix + hsla.join() + ")";
	},
	toHexString: function( includeAlpha ) {
		var rgba = this._rgba.slice(),
			alpha = rgba.pop();

		if ( includeAlpha ) {
			rgba.push( ~~( alpha * 255 ) );
		}

		return "#" + jQuery.map( rgba, function( v ) {

			// Default to 0 when nulls exist
			v = ( v || 0 ).toString( 16 );
			return v.length === 1 ? "0" + v : v;
		} ).join( "" );
	},
	toString: function() {
		return this._rgba[ 3 ] === 0 ? "transparent" : this.toRgbaString();
	}
} );
color.fn.parse.prototype = color.fn;

// Hsla conversions adapted from:
// https://code.google.com/p/maashaack/source/browse/packages/graphics/trunk/src/graphics/colors/HUE2RGB.as?r=5021

function hue2rgb( p, q, h ) {
	h = ( h + 1 ) % 1;
	if ( h * 6 < 1 ) {
		return p + ( q - p ) * h * 6;
	}
	if ( h * 2 < 1 ) {
		return q;
	}
	if ( h * 3 < 2 ) {
		return p + ( q - p ) * ( ( 2 / 3 ) - h ) * 6;
	}
	return p;
}

spaces.hsla.to = function( rgba ) {
	if ( rgba[ 0 ] == null || rgba[ 1 ] == null || rgba[ 2 ] == null ) {
		return [ null, null, null, rgba[ 3 ] ];
	}
	var r = rgba[ 0 ] / 255,
		g = rgba[ 1 ] / 255,
		b = rgba[ 2 ] / 255,
		a = rgba[ 3 ],
		max = Math.max( r, g, b ),
		min = Math.min( r, g, b ),
		diff = max - min,
		add = max + min,
		l = add * 0.5,
		h, s;

	if ( min === max ) {
		h = 0;
	} else if ( r === max ) {
		h = ( 60 * ( g - b ) / diff ) + 360;
	} else if ( g === max ) {
		h = ( 60 * ( b - r ) / diff ) + 120;
	} else {
		h = ( 60 * ( r - g ) / diff ) + 240;
	}

	// Chroma (diff) == 0 means greyscale which, by definition, saturation = 0%
	// otherwise, saturation is based on the ratio of chroma (diff) to lightness (add)
	if ( diff === 0 ) {
		s = 0;
	} else if ( l <= 0.5 ) {
		s = diff / add;
	} else {
		s = diff / ( 2 - add );
	}
	return [ Math.round( h ) % 360, s, l, a == null ? 1 : a ];
};

spaces.hsla.from = function( hsla ) {
	if ( hsla[ 0 ] == null || hsla[ 1 ] == null || hsla[ 2 ] == null ) {
		return [ null, null, null, hsla[ 3 ] ];
	}
	var h = hsla[ 0 ] / 360,
		s = hsla[ 1 ],
		l = hsla[ 2 ],
		a = hsla[ 3 ],
		q = l <= 0.5 ? l * ( 1 + s ) : l + s - l * s,
		p = 2 * l - q;

	return [
		Math.round( hue2rgb( p, q, h + ( 1 / 3 ) ) * 255 ),
		Math.round( hue2rgb( p, q, h ) * 255 ),
		Math.round( hue2rgb( p, q, h - ( 1 / 3 ) ) * 255 ),
		a
	];
};

each( spaces, function( spaceName, space ) {
	var props = space.props,
		cache = space.cache,
		to = space.to,
		from = space.from;

	// Makes rgba() and hsla()
	color.fn[ spaceName ] = function( value ) {

		// Generate a cache for this space if it doesn't exist
		if ( to && !this[ cache ] ) {
			this[ cache ] = to( this._rgba );
		}
		if ( value === undefined ) {
			return this[ cache ].slice();
		}

		var ret,
			type = jQuery.type( value ),
			arr = ( type === "array" || type === "object" ) ? value : arguments,
			local = this[ cache ].slice();

		each( props, function( key, prop ) {
			var val = arr[ type === "object" ? key : prop.idx ];
			if ( val == null ) {
				val = local[ prop.idx ];
			}
			local[ prop.idx ] = clamp( val, prop );
		} );

		if ( from ) {
			ret = color( from( local ) );
			ret[ cache ] = local;
			return ret;
		} else {
			return color( local );
		}
	};

	// Makes red() green() blue() alpha() hue() saturation() lightness()
	each( props, function( key, prop ) {

		// Alpha is included in more than one space
		if ( color.fn[ key ] ) {
			return;
		}
		color.fn[ key ] = function( value ) {
			var vtype = jQuery.type( value ),
				fn = ( key === "alpha" ? ( this._hsla ? "hsla" : "rgba" ) : spaceName ),
				local = this[ fn ](),
				cur = local[ prop.idx ],
				match;

			if ( vtype === "undefined" ) {
				return cur;
			}

			if ( vtype === "function" ) {
				value = value.call( this, cur );
				vtype = jQuery.type( value );
			}
			if ( value == null && prop.empty ) {
				return this;
			}
			if ( vtype === "string" ) {
				match = rplusequals.exec( value );
				if ( match ) {
					value = cur + parseFloat( match[ 2 ] ) * ( match[ 1 ] === "+" ? 1 : -1 );
				}
			}
			local[ prop.idx ] = value;
			return this[ fn ]( local );
		};
	} );
} );

// Add cssHook and .fx.step function for each named hook.
// accept a space separated string of properties
color.hook = function( hook ) {
	var hooks = hook.split( " " );
	each( hooks, function( i, hook ) {
		jQuery.cssHooks[ hook ] = {
			set: function( elem, value ) {
				var parsed, curElem,
					backgroundColor = "";

				if ( value !== "transparent" && ( jQuery.type( value ) !== "string" ||
						( parsed = stringParse( value ) ) ) ) {
					value = color( parsed || value );
					if ( !support.rgba && value._rgba[ 3 ] !== 1 ) {
						curElem = hook === "backgroundColor" ? elem.parentNode : elem;
						while (
							( backgroundColor === "" || backgroundColor === "transparent" ) &&
							curElem && curElem.style
						) {
							try {
								backgroundColor = jQuery.css( curElem, "backgroundColor" );
								curElem = curElem.parentNode;
							} catch ( e ) {
							}
						}

						value = value.blend( backgroundColor && backgroundColor !== "transparent" ?
							backgroundColor :
							"_default" );
					}

					value = value.toRgbaString();
				}
				try {
					elem.style[ hook ] = value;
				} catch ( e ) {

					// Wrapped to prevent IE from throwing errors on "invalid" values like
					// 'auto' or 'inherit'
				}
			}
		};
		jQuery.fx.step[ hook ] = function( fx ) {
			if ( !fx.colorInit ) {
				fx.start = color( fx.elem, hook );
				fx.end = color( fx.end );
				fx.colorInit = true;
			}
			jQuery.cssHooks[ hook ].set( fx.elem, fx.start.transition( fx.end, fx.pos ) );
		};
	} );

};

color.hook( stepHooks );

jQuery.cssHooks.borderColor = {
	expand: function( value ) {
		var expanded = {};

		each( [ "Top", "Right", "Bottom", "Left" ], function( i, part ) {
			expanded[ "border" + part + "Color" ] = value;
		} );
		return expanded;
	}
};

// Basic color names only.
// Usage of any of the other color names requires adding yourself or including
// jquery.color.svg-names.js.
colors = jQuery.Color.names = {

	// 4.1. Basic color keywords
	aqua: "#00ffff",
	black: "#000000",
	blue: "#0000ff",
	fuchsia: "#ff00ff",
	gray: "#808080",
	green: "#008000",
	lime: "#00ff00",
	maroon: "#800000",
	navy: "#000080",
	olive: "#808000",
	purple: "#800080",
	red: "#ff0000",
	silver: "#c0c0c0",
	teal: "#008080",
	white: "#ffffff",
	yellow: "#ffff00",

	// 4.2.3. "transparent" color keyword
	transparent: [ null, null, null, 0 ],

	_default: "#ffffff"
};

} )( jQuery );

/******************************************************************************/
/****************************** CLASS ANIMATIONS ******************************/
/******************************************************************************/
( function() {

var classAnimationActions = [ "add", "remove", "toggle" ],
	shorthandStyles = {
		border: 1,
		borderBottom: 1,
		borderColor: 1,
		borderLeft: 1,
		borderRight: 1,
		borderTop: 1,
		borderWidth: 1,
		margin: 1,
		padding: 1
	};

$.each(
	[ "borderLeftStyle", "borderRightStyle", "borderBottomStyle", "borderTopStyle" ],
	function( _, prop ) {
		$.fx.step[ prop ] = function( fx ) {
			if ( fx.end !== "none" && !fx.setAttr || fx.pos === 1 && !fx.setAttr ) {
				jQuery.style( fx.elem, prop, fx.end );
				fx.setAttr = true;
			}
		};
	}
);

function getElementStyles( elem ) {
	var key, len,
		style = elem.ownerDocument.defaultView ?
			elem.ownerDocument.defaultView.getComputedStyle( elem, null ) :
			elem.currentStyle,
		styles = {};

	if ( style && style.length && style[ 0 ] && style[ style[ 0 ] ] ) {
		len = style.length;
		while ( len-- ) {
			key = style[ len ];
			if ( typeof style[ key ] === "string" ) {
				styles[ $.camelCase( key ) ] = style[ key ];
			}
		}

	// Support: Opera, IE <9
	} else {
		for ( key in style ) {
			if ( typeof style[ key ] === "string" ) {
				styles[ key ] = style[ key ];
			}
		}
	}

	return styles;
}

function styleDifference( oldStyle, newStyle ) {
	var diff = {},
		name, value;

	for ( name in newStyle ) {
		value = newStyle[ name ];
		if ( oldStyle[ name ] !== value ) {
			if ( !shorthandStyles[ name ] ) {
				if ( $.fx.step[ name ] || !isNaN( parseFloat( value ) ) ) {
					diff[ name ] = value;
				}
			}
		}
	}

	return diff;
}

// Support: jQuery <1.8
if ( !$.fn.addBack ) {
	$.fn.addBack = function( selector ) {
		return this.add( selector == null ?
			this.prevObject : this.prevObject.filter( selector )
		);
	};
}

$.effects.animateClass = function( value, duration, easing, callback ) {
	var o = $.speed( duration, easing, callback );

	return this.queue( function() {
		var animated = $( this ),
			baseClass = animated.attr( "class" ) || "",
			applyClassChange,
			allAnimations = o.children ? animated.find( "*" ).addBack() : animated;

		// Map the animated objects to store the original styles.
		allAnimations = allAnimations.map( function() {
			var el = $( this );
			return {
				el: el,
				start: getElementStyles( this )
			};
		} );

		// Apply class change
		applyClassChange = function() {
			$.each( classAnimationActions, function( i, action ) {
				if ( value[ action ] ) {
					animated[ action + "Class" ]( value[ action ] );
				}
			} );
		};
		applyClassChange();

		// Map all animated objects again - calculate new styles and diff
		allAnimations = allAnimations.map( function() {
			this.end = getElementStyles( this.el[ 0 ] );
			this.diff = styleDifference( this.start, this.end );
			return this;
		} );

		// Apply original class
		animated.attr( "class", baseClass );

		// Map all animated objects again - this time collecting a promise
		allAnimations = allAnimations.map( function() {
			var styleInfo = this,
				dfd = $.Deferred(),
				opts = $.extend( {}, o, {
					queue: false,
					complete: function() {
						dfd.resolve( styleInfo );
					}
				} );

			this.el.animate( this.diff, opts );
			return dfd.promise();
		} );

		// Once all animations have completed:
		$.when.apply( $, allAnimations.get() ).done( function() {

			// Set the final class
			applyClassChange();

			// For each animated element,
			// clear all css properties that were animated
			$.each( arguments, function() {
				var el = this.el;
				$.each( this.diff, function( key ) {
					el.css( key, "" );
				} );
			} );

			// This is guarnteed to be there if you use jQuery.speed()
			// it also handles dequeuing the next anim...
			o.complete.call( animated[ 0 ] );
		} );
	} );
};

$.fn.extend( {
	addClass: ( function( orig ) {
		return function( classNames, speed, easing, callback ) {
			return speed ?
				$.effects.animateClass.call( this,
					{ add: classNames }, speed, easing, callback ) :
				orig.apply( this, arguments );
		};
	} )( $.fn.addClass ),

	removeClass: ( function( orig ) {
		return function( classNames, speed, easing, callback ) {
			return arguments.length > 1 ?
				$.effects.animateClass.call( this,
					{ remove: classNames }, speed, easing, callback ) :
				orig.apply( this, arguments );
		};
	} )( $.fn.removeClass ),

	toggleClass: ( function( orig ) {
		return function( classNames, force, speed, easing, callback ) {
			if ( typeof force === "boolean" || force === undefined ) {
				if ( !speed ) {

					// Without speed parameter
					return orig.apply( this, arguments );
				} else {
					return $.effects.animateClass.call( this,
						( force ? { add: classNames } : { remove: classNames } ),
						speed, easing, callback );
				}
			} else {

				// Without force parameter
				return $.effects.animateClass.call( this,
					{ toggle: classNames }, force, speed, easing );
			}
		};
	} )( $.fn.toggleClass ),

	switchClass: function( remove, add, speed, easing, callback ) {
		return $.effects.animateClass.call( this, {
			add: add,
			remove: remove
		}, speed, easing, callback );
	}
} );

} )();

/******************************************************************************/
/*********************************** EFFECTS **********************************/
/******************************************************************************/

( function() {

if ( $.expr && $.expr.filters && $.expr.filters.animated ) {
	$.expr.filters.animated = ( function( orig ) {
		return function( elem ) {
			return !!$( elem ).data( dataSpaceAnimated ) || orig( elem );
		};
	} )( $.expr.filters.animated );
}

if ( $.uiBackCompat !== false ) {
	$.extend( $.effects, {

		// Saves a set of properties in a data storage
		save: function( element, set ) {
			var i = 0, length = set.length;
			for ( ; i < length; i++ ) {
				if ( set[ i ] !== null ) {
					element.data( dataSpace + set[ i ], element[ 0 ].style[ set[ i ] ] );
				}
			}
		},

		// Restores a set of previously saved properties from a data storage
		restore: function( element, set ) {
			var val, i = 0, length = set.length;
			for ( ; i < length; i++ ) {
				if ( set[ i ] !== null ) {
					val = element.data( dataSpace + set[ i ] );
					element.css( set[ i ], val );
				}
			}
		},

		setMode: function( el, mode ) {
			if ( mode === "toggle" ) {
				mode = el.is( ":hidden" ) ? "show" : "hide";
			}
			return mode;
		},

		// Wraps the element around a wrapper that copies position properties
		createWrapper: function( element ) {

			// If the element is already wrapped, return it
			if ( element.parent().is( ".ui-effects-wrapper" ) ) {
				return element.parent();
			}

			// Wrap the element
			var props = {
					width: element.outerWidth( true ),
					height: element.outerHeight( true ),
					"float": element.css( "float" )
				},
				wrapper = $( "<div></div>" )
					.addClass( "ui-effects-wrapper" )
					.css( {
						fontSize: "100%",
						background: "transparent",
						border: "none",
						margin: 0,
						padding: 0
					} ),

				// Store the size in case width/height are defined in % - Fixes #5245
				size = {
					width: element.width(),
					height: element.height()
				},
				active = document.activeElement;

			// Support: Firefox
			// Firefox incorrectly exposes anonymous content
			// https://bugzilla.mozilla.org/show_bug.cgi?id=561664
			try {
				active.id;
			} catch ( e ) {
				active = document.body;
			}

			element.wrap( wrapper );

			// Fixes #7595 - Elements lose focus when wrapped.
			if ( element[ 0 ] === active || $.contains( element[ 0 ], active ) ) {
				$( active ).trigger( "focus" );
			}

			// Hotfix for jQuery 1.4 since some change in wrap() seems to actually
			// lose the reference to the wrapped element
			wrapper = element.parent();

			// Transfer positioning properties to the wrapper
			if ( element.css( "position" ) === "static" ) {
				wrapper.css( { position: "relative" } );
				element.css( { position: "relative" } );
			} else {
				$.extend( props, {
					position: element.css( "position" ),
					zIndex: element.css( "z-index" )
				} );
				$.each( [ "top", "left", "bottom", "right" ], function( i, pos ) {
					props[ pos ] = element.css( pos );
					if ( isNaN( parseInt( props[ pos ], 10 ) ) ) {
						props[ pos ] = "auto";
					}
				} );
				element.css( {
					position: "relative",
					top: 0,
					left: 0,
					right: "auto",
					bottom: "auto"
				} );
			}
			element.css( size );

			return wrapper.css( props ).show();
		},

		removeWrapper: function( element ) {
			var active = document.activeElement;

			if ( element.parent().is( ".ui-effects-wrapper" ) ) {
				element.parent().replaceWith( element );

				// Fixes #7595 - Elements lose focus when wrapped.
				if ( element[ 0 ] === active || $.contains( element[ 0 ], active ) ) {
					$( active ).trigger( "focus" );
				}
			}

			return element;
		}
	} );
}

$.extend( $.effects, {
	version: "1.12.1",

	define: function( name, mode, effect ) {
		if ( !effect ) {
			effect = mode;
			mode = "effect";
		}

		$.effects.effect[ name ] = effect;
		$.effects.effect[ name ].mode = mode;

		return effect;
	},

	scaledDimensions: function( element, percent, direction ) {
		if ( percent === 0 ) {
			return {
				height: 0,
				width: 0,
				outerHeight: 0,
				outerWidth: 0
			};
		}

		var x = direction !== "horizontal" ? ( ( percent || 100 ) / 100 ) : 1,
			y = direction !== "vertical" ? ( ( percent || 100 ) / 100 ) : 1;

		return {
			height: element.height() * y,
			width: element.width() * x,
			outerHeight: element.outerHeight() * y,
			outerWidth: element.outerWidth() * x
		};

	},

	clipToBox: function( animation ) {
		return {
			width: animation.clip.right - animation.clip.left,
			height: animation.clip.bottom - animation.clip.top,
			left: animation.clip.left,
			top: animation.clip.top
		};
	},

	// Injects recently queued functions to be first in line (after "inprogress")
	unshift: function( element, queueLength, count ) {
		var queue = element.queue();

		if ( queueLength > 1 ) {
			queue.splice.apply( queue,
				[ 1, 0 ].concat( queue.splice( queueLength, count ) ) );
		}
		element.dequeue();
	},

	saveStyle: function( element ) {
		element.data( dataSpaceStyle, element[ 0 ].style.cssText );
	},

	restoreStyle: function( element ) {
		element[ 0 ].style.cssText = element.data( dataSpaceStyle ) || "";
		element.removeData( dataSpaceStyle );
	},

	mode: function( element, mode ) {
		var hidden = element.is( ":hidden" );

		if ( mode === "toggle" ) {
			mode = hidden ? "show" : "hide";
		}
		if ( hidden ? mode === "hide" : mode === "show" ) {
			mode = "none";
		}
		return mode;
	},

	// Translates a [top,left] array into a baseline value
	getBaseline: function( origin, original ) {
		var y, x;

		switch ( origin[ 0 ] ) {
		case "top":
			y = 0;
			break;
		case "middle":
			y = 0.5;
			break;
		case "bottom":
			y = 1;
			break;
		default:
			y = origin[ 0 ] / original.height;
		}

		switch ( origin[ 1 ] ) {
		case "left":
			x = 0;
			break;
		case "center":
			x = 0.5;
			break;
		case "right":
			x = 1;
			break;
		default:
			x = origin[ 1 ] / original.width;
		}

		return {
			x: x,
			y: y
		};
	},

	// Creates a placeholder element so that the original element can be made absolute
	createPlaceholder: function( element ) {
		var placeholder,
			cssPosition = element.css( "position" ),
			position = element.position();

		// Lock in margins first to account for form elements, which
		// will change margin if you explicitly set height
		// see: http://jsfiddle.net/JZSMt/3/ https://bugs.webkit.org/show_bug.cgi?id=107380
		// Support: Safari
		element.css( {
			marginTop: element.css( "marginTop" ),
			marginBottom: element.css( "marginBottom" ),
			marginLeft: element.css( "marginLeft" ),
			marginRight: element.css( "marginRight" )
		} )
		.outerWidth( element.outerWidth() )
		.outerHeight( element.outerHeight() );

		if ( /^(static|relative)/.test( cssPosition ) ) {
			cssPosition = "absolute";

			placeholder = $( "<" + element[ 0 ].nodeName + ">" ).insertAfter( element ).css( {

				// Convert inline to inline block to account for inline elements
				// that turn to inline block based on content (like img)
				display: /^(inline|ruby)/.test( element.css( "display" ) ) ?
					"inline-block" :
					"block",
				visibility: "hidden",

				// Margins need to be set to account for margin collapse
				marginTop: element.css( "marginTop" ),
				marginBottom: element.css( "marginBottom" ),
				marginLeft: element.css( "marginLeft" ),
				marginRight: element.css( "marginRight" ),
				"float": element.css( "float" )
			} )
			.outerWidth( element.outerWidth() )
			.outerHeight( element.outerHeight() )
			.addClass( "ui-effects-placeholder" );

			element.data( dataSpace + "placeholder", placeholder );
		}

		element.css( {
			position: cssPosition,
			left: position.left,
			top: position.top
		} );

		return placeholder;
	},

	removePlaceholder: function( element ) {
		var dataKey = dataSpace + "placeholder",
				placeholder = element.data( dataKey );

		if ( placeholder ) {
			placeholder.remove();
			element.removeData( dataKey );
		}
	},

	// Removes a placeholder if it exists and restores
	// properties that were modified during placeholder creation
	cleanUp: function( element ) {
		$.effects.restoreStyle( element );
		$.effects.removePlaceholder( element );
	},

	setTransition: function( element, list, factor, value ) {
		value = value || {};
		$.each( list, function( i, x ) {
			var unit = element.cssUnit( x );
			if ( unit[ 0 ] > 0 ) {
				value[ x ] = unit[ 0 ] * factor + unit[ 1 ];
			}
		} );
		return value;
	}
} );

// Return an effect options object for the given parameters:
function _normalizeArguments( effect, options, speed, callback ) {

	// Allow passing all options as the first parameter
	if ( $.isPlainObject( effect ) ) {
		options = effect;
		effect = effect.effect;
	}

	// Convert to an object
	effect = { effect: effect };

	// Catch (effect, null, ...)
	if ( options == null ) {
		options = {};
	}

	// Catch (effect, callback)
	if ( $.isFunction( options ) ) {
		callback = options;
		speed = null;
		options = {};
	}

	// Catch (effect, speed, ?)
	if ( typeof options === "number" || $.fx.speeds[ options ] ) {
		callback = speed;
		speed = options;
		options = {};
	}

	// Catch (effect, options, callback)
	if ( $.isFunction( speed ) ) {
		callback = speed;
		speed = null;
	}

	// Add options to effect
	if ( options ) {
		$.extend( effect, options );
	}

	speed = speed || options.duration;
	effect.duration = $.fx.off ? 0 :
		typeof speed === "number" ? speed :
		speed in $.fx.speeds ? $.fx.speeds[ speed ] :
		$.fx.speeds._default;

	effect.complete = callback || options.complete;

	return effect;
}

function standardAnimationOption( option ) {

	// Valid standard speeds (nothing, number, named speed)
	if ( !option || typeof option === "number" || $.fx.speeds[ option ] ) {
		return true;
	}

	// Invalid strings - treat as "normal" speed
	if ( typeof option === "string" && !$.effects.effect[ option ] ) {
		return true;
	}

	// Complete callback
	if ( $.isFunction( option ) ) {
		return true;
	}

	// Options hash (but not naming an effect)
	if ( typeof option === "object" && !option.effect ) {
		return true;
	}

	// Didn't match any standard API
	return false;
}

$.fn.extend( {
	effect: function( /* effect, options, speed, callback */ ) {
		var args = _normalizeArguments.apply( this, arguments ),
			effectMethod = $.effects.effect[ args.effect ],
			defaultMode = effectMethod.mode,
			queue = args.queue,
			queueName = queue || "fx",
			complete = args.complete,
			mode = args.mode,
			modes = [],
			prefilter = function( next ) {
				var el = $( this ),
					normalizedMode = $.effects.mode( el, mode ) || defaultMode;

				// Sentinel for duck-punching the :animated psuedo-selector
				el.data( dataSpaceAnimated, true );

				// Save effect mode for later use,
				// we can't just call $.effects.mode again later,
				// as the .show() below destroys the initial state
				modes.push( normalizedMode );

				// See $.uiBackCompat inside of run() for removal of defaultMode in 1.13
				if ( defaultMode && ( normalizedMode === "show" ||
						( normalizedMode === defaultMode && normalizedMode === "hide" ) ) ) {
					el.show();
				}

				if ( !defaultMode || normalizedMode !== "none" ) {
					$.effects.saveStyle( el );
				}

				if ( $.isFunction( next ) ) {
					next();
				}
			};

		if ( $.fx.off || !effectMethod ) {

			// Delegate to the original method (e.g., .show()) if possible
			if ( mode ) {
				return this[ mode ]( args.duration, complete );
			} else {
				return this.each( function() {
					if ( complete ) {
						complete.call( this );
					}
				} );
			}
		}

		function run( next ) {
			var elem = $( this );

			function cleanup() {
				elem.removeData( dataSpaceAnimated );

				$.effects.cleanUp( elem );

				if ( args.mode === "hide" ) {
					elem.hide();
				}

				done();
			}

			function done() {
				if ( $.isFunction( complete ) ) {
					complete.call( elem[ 0 ] );
				}

				if ( $.isFunction( next ) ) {
					next();
				}
			}

			// Override mode option on a per element basis,
			// as toggle can be either show or hide depending on element state
			args.mode = modes.shift();

			if ( $.uiBackCompat !== false && !defaultMode ) {
				if ( elem.is( ":hidden" ) ? mode === "hide" : mode === "show" ) {

					// Call the core method to track "olddisplay" properly
					elem[ mode ]();
					done();
				} else {
					effectMethod.call( elem[ 0 ], args, done );
				}
			} else {
				if ( args.mode === "none" ) {

					// Call the core method to track "olddisplay" properly
					elem[ mode ]();
					done();
				} else {
					effectMethod.call( elem[ 0 ], args, cleanup );
				}
			}
		}

		// Run prefilter on all elements first to ensure that
		// any showing or hiding happens before placeholder creation,
		// which ensures that any layout changes are correctly captured.
		return queue === false ?
			this.each( prefilter ).each( run ) :
			this.queue( queueName, prefilter ).queue( queueName, run );
	},

	show: ( function( orig ) {
		return function( option ) {
			if ( standardAnimationOption( option ) ) {
				return orig.apply( this, arguments );
			} else {
				var args = _normalizeArguments.apply( this, arguments );
				args.mode = "show";
				return this.effect.call( this, args );
			}
		};
	} )( $.fn.show ),

	hide: ( function( orig ) {
		return function( option ) {
			if ( standardAnimationOption( option ) ) {
				return orig.apply( this, arguments );
			} else {
				var args = _normalizeArguments.apply( this, arguments );
				args.mode = "hide";
				return this.effect.call( this, args );
			}
		};
	} )( $.fn.hide ),

	toggle: ( function( orig ) {
		return function( option ) {
			if ( standardAnimationOption( option ) || typeof option === "boolean" ) {
				return orig.apply( this, arguments );
			} else {
				var args = _normalizeArguments.apply( this, arguments );
				args.mode = "toggle";
				return this.effect.call( this, args );
			}
		};
	} )( $.fn.toggle ),

	cssUnit: function( key ) {
		var style = this.css( key ),
			val = [];

		$.each( [ "em", "px", "%", "pt" ], function( i, unit ) {
			if ( style.indexOf( unit ) > 0 ) {
				val = [ parseFloat( style ), unit ];
			}
		} );
		return val;
	},

	cssClip: function( clipObj ) {
		if ( clipObj ) {
			return this.css( "clip", "rect(" + clipObj.top + "px " + clipObj.right + "px " +
				clipObj.bottom + "px " + clipObj.left + "px)" );
		}
		return parseClip( this.css( "clip" ), this );
	},

	transfer: function( options, done ) {
		var element = $( this ),
			target = $( options.to ),
			targetFixed = target.css( "position" ) === "fixed",
			body = $( "body" ),
			fixTop = targetFixed ? body.scrollTop() : 0,
			fixLeft = targetFixed ? body.scrollLeft() : 0,
			endPosition = target.offset(),
			animation = {
				top: endPosition.top - fixTop,
				left: endPosition.left - fixLeft,
				height: target.innerHeight(),
				width: target.innerWidth()
			},
			startPosition = element.offset(),
			transfer = $( "<div class='ui-effects-transfer'></div>" )
				.appendTo( "body" )
				.addClass( options.className )
				.css( {
					top: startPosition.top - fixTop,
					left: startPosition.left - fixLeft,
					height: element.innerHeight(),
					width: element.innerWidth(),
					position: targetFixed ? "fixed" : "absolute"
				} )
				.animate( animation, options.duration, options.easing, function() {
					transfer.remove();
					if ( $.isFunction( done ) ) {
						done();
					}
				} );
	}
} );

function parseClip( str, element ) {
		var outerWidth = element.outerWidth(),
			outerHeight = element.outerHeight(),
			clipRegex = /^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/,
			values = clipRegex.exec( str ) || [ "", 0, outerWidth, outerHeight, 0 ];

		return {
			top: parseFloat( values[ 1 ] ) || 0,
			right: values[ 2 ] === "auto" ? outerWidth : parseFloat( values[ 2 ] ),
			bottom: values[ 3 ] === "auto" ? outerHeight : parseFloat( values[ 3 ] ),
			left: parseFloat( values[ 4 ] ) || 0
		};
}

$.fx.step.clip = function( fx ) {
	if ( !fx.clipInit ) {
		fx.start = $( fx.elem ).cssClip();
		if ( typeof fx.end === "string" ) {
			fx.end = parseClip( fx.end, fx.elem );
		}
		fx.clipInit = true;
	}

	$( fx.elem ).cssClip( {
		top: fx.pos * ( fx.end.top - fx.start.top ) + fx.start.top,
		right: fx.pos * ( fx.end.right - fx.start.right ) + fx.start.right,
		bottom: fx.pos * ( fx.end.bottom - fx.start.bottom ) + fx.start.bottom,
		left: fx.pos * ( fx.end.left - fx.start.left ) + fx.start.left
	} );
};

} )();

/******************************************************************************/
/*********************************** EASING ***********************************/
/******************************************************************************/

( function() {


var baseEasings = {};

$.each( [ "Quad", "Cubic", "Quart", "Quint", "Expo" ], function( i, name ) {
	baseEasings[ name ] = function( p ) {
		return Math.pow( p, i + 2 );
	};
} );

$.extend( baseEasings, {
	Sine: function( p ) {
		return 1 - Math.cos( p * Math.PI / 2 );
	},
	Circ: function( p ) {
		return 1 - Math.sqrt( 1 - p * p );
	},
	Elastic: function( p ) {
		return p === 0 || p === 1 ? p :
			-Math.pow( 2, 8 * ( p - 1 ) ) * Math.sin( ( ( p - 1 ) * 80 - 7.5 ) * Math.PI / 15 );
	},
	Back: function( p ) {
		return p * p * ( 3 * p - 2 );
	},
	Bounce: function( p ) {
		var pow2,
			bounce = 4;

		while ( p < ( ( pow2 = Math.pow( 2, --bounce ) ) - 1 ) / 11 ) {}
		return 1 / Math.pow( 4, 3 - bounce ) - 7.5625 * Math.pow( ( pow2 * 3 - 2 ) / 22 - p, 2 );
	}
} );

$.each( baseEasings, function( name, easeIn ) {
	$.easing[ "easeIn" + name ] = easeIn;
	$.easing[ "easeOut" + name ] = function( p ) {
		return 1 - easeIn( 1 - p );
	};
	$.easing[ "easeInOut" + name ] = function( p ) {
		return p < 0.5 ?
			easeIn( p * 2 ) / 2 :
			1 - easeIn( p * -2 + 2 ) / 2;
	};
} );

} )();

var effect = $.effects;





var effectsEffectBlind = $.effects.define( "blind", "hide", function( options, done ) {
	var map = {
			up: [ "bottom", "top" ],
			vertical: [ "bottom", "top" ],
			down: [ "top", "bottom" ],
			left: [ "right", "left" ],
			horizontal: [ "right", "left" ],
			right: [ "left", "right" ]
		},
		element = $( this ),
		direction = options.direction || "up",
		start = element.cssClip(),
		animate = { clip: $.extend( {}, start ) },
		placeholder = $.effects.createPlaceholder( element );

	animate.clip[ map[ direction ][ 0 ] ] = animate.clip[ map[ direction ][ 1 ] ];

	if ( options.mode === "show" ) {
		element.cssClip( animate.clip );
		if ( placeholder ) {
			placeholder.css( $.effects.clipToBox( animate ) );
		}

		animate.clip = start;
	}

	if ( placeholder ) {
		placeholder.animate( $.effects.clipToBox( animate ), options.duration, options.easing );
	}

	element.animate( animate, {
		queue: false,
		duration: options.duration,
		easing: options.easing,
		complete: done
	} );
} );






var effectsEffectBounce = $.effects.define( "bounce", function( options, done ) {
	var upAnim, downAnim, refValue,
		element = $( this ),

		// Defaults:
		mode = options.mode,
		hide = mode === "hide",
		show = mode === "show",
		direction = options.direction || "up",
		distance = options.distance,
		times = options.times || 5,

		// Number of internal animations
		anims = times * 2 + ( show || hide ? 1 : 0 ),
		speed = options.duration / anims,
		easing = options.easing,

		// Utility:
		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
		motion = ( direction === "up" || direction === "left" ),
		i = 0,

		queuelen = element.queue().length;

	$.effects.createPlaceholder( element );

	refValue = element.css( ref );

	// Default distance for the BIGGEST bounce is the outer Distance / 3
	if ( !distance ) {
		distance = element[ ref === "top" ? "outerHeight" : "outerWidth" ]() / 3;
	}

	if ( show ) {
		downAnim = { opacity: 1 };
		downAnim[ ref ] = refValue;

		// If we are showing, force opacity 0 and set the initial position
		// then do the "first" animation
		element
			.css( "opacity", 0 )
			.css( ref, motion ? -distance * 2 : distance * 2 )
			.animate( downAnim, speed, easing );
	}

	// Start at the smallest distance if we are hiding
	if ( hide ) {
		distance = distance / Math.pow( 2, times - 1 );
	}

	downAnim = {};
	downAnim[ ref ] = refValue;

	// Bounces up/down/left/right then back to 0 -- times * 2 animations happen here
	for ( ; i < times; i++ ) {
		upAnim = {};
		upAnim[ ref ] = ( motion ? "-=" : "+=" ) + distance;

		element
			.animate( upAnim, speed, easing )
			.animate( downAnim, speed, easing );

		distance = hide ? distance * 2 : distance / 2;
	}

	// Last Bounce when Hiding
	if ( hide ) {
		upAnim = { opacity: 0 };
		upAnim[ ref ] = ( motion ? "-=" : "+=" ) + distance;

		element.animate( upAnim, speed, easing );
	}

	element.queue( done );

	$.effects.unshift( element, queuelen, anims + 1 );
} );






var effectsEffectClip = $.effects.define( "clip", "hide", function( options, done ) {
	var start,
		animate = {},
		element = $( this ),
		direction = options.direction || "vertical",
		both = direction === "both",
		horizontal = both || direction === "horizontal",
		vertical = both || direction === "vertical";

	start = element.cssClip();
	animate.clip = {
		top: vertical ? ( start.bottom - start.top ) / 2 : start.top,
		right: horizontal ? ( start.right - start.left ) / 2 : start.right,
		bottom: vertical ? ( start.bottom - start.top ) / 2 : start.bottom,
		left: horizontal ? ( start.right - start.left ) / 2 : start.left
	};

	$.effects.createPlaceholder( element );

	if ( options.mode === "show" ) {
		element.cssClip( animate.clip );
		animate.clip = start;
	}

	element.animate( animate, {
		queue: false,
		duration: options.duration,
		easing: options.easing,
		complete: done
	} );

} );





var effectsEffectDrop = $.effects.define( "drop", "hide", function( options, done ) {

	var distance,
		element = $( this ),
		mode = options.mode,
		show = mode === "show",
		direction = options.direction || "left",
		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
		motion = ( direction === "up" || direction === "left" ) ? "-=" : "+=",
		oppositeMotion = ( motion === "+=" ) ? "-=" : "+=",
		animation = {
			opacity: 0
		};

	$.effects.createPlaceholder( element );

	distance = options.distance ||
		element[ ref === "top" ? "outerHeight" : "outerWidth" ]( true ) / 2;

	animation[ ref ] = motion + distance;

	if ( show ) {
		element.css( animation );

		animation[ ref ] = oppositeMotion + distance;
		animation.opacity = 1;
	}

	// Animate
	element.animate( animation, {
		queue: false,
		duration: options.duration,
		easing: options.easing,
		complete: done
	} );
} );






var effectsEffectExplode = $.effects.define( "explode", "hide", function( options, done ) {

	var i, j, left, top, mx, my,
		rows = options.pieces ? Math.round( Math.sqrt( options.pieces ) ) : 3,
		cells = rows,
		element = $( this ),
		mode = options.mode,
		show = mode === "show",

		// Show and then visibility:hidden the element before calculating offset
		offset = element.show().css( "visibility", "hidden" ).offset(),

		// Width and height of a piece
		width = Math.ceil( element.outerWidth() / cells ),
		height = Math.ceil( element.outerHeight() / rows ),
		pieces = [];

	// Children animate complete:
	function childComplete() {
		pieces.push( this );
		if ( pieces.length === rows * cells ) {
			animComplete();
		}
	}

	// Clone the element for each row and cell.
	for ( i = 0; i < rows; i++ ) { // ===>
		top = offset.top + i * height;
		my = i - ( rows - 1 ) / 2;

		for ( j = 0; j < cells; j++ ) { // |||
			left = offset.left + j * width;
			mx = j - ( cells - 1 ) / 2;

			// Create a clone of the now hidden main element that will be absolute positioned
			// within a wrapper div off the -left and -top equal to size of our pieces
			element
				.clone()
				.appendTo( "body" )
				.wrap( "<div></div>" )
				.css( {
					position: "absolute",
					visibility: "visible",
					left: -j * width,
					top: -i * height
				} )

				// Select the wrapper - make it overflow: hidden and absolute positioned based on
				// where the original was located +left and +top equal to the size of pieces
				.parent()
					.addClass( "ui-effects-explode" )
					.css( {
						position: "absolute",
						overflow: "hidden",
						width: width,
						height: height,
						left: left + ( show ? mx * width : 0 ),
						top: top + ( show ? my * height : 0 ),
						opacity: show ? 0 : 1
					} )
					.animate( {
						left: left + ( show ? 0 : mx * width ),
						top: top + ( show ? 0 : my * height ),
						opacity: show ? 1 : 0
					}, options.duration || 500, options.easing, childComplete );
		}
	}

	function animComplete() {
		element.css( {
			visibility: "visible"
		} );
		$( pieces ).remove();
		done();
	}
} );






var effectsEffectFade = $.effects.define( "fade", "toggle", function( options, done ) {
	var show = options.mode === "show";

	$( this )
		.css( "opacity", show ? 0 : 1 )
		.animate( {
			opacity: show ? 1 : 0
		}, {
			queue: false,
			duration: options.duration,
			easing: options.easing,
			complete: done
		} );
} );





var effectsEffectFold = $.effects.define( "fold", "hide", function( options, done ) {

	// Create element
	var element = $( this ),
		mode = options.mode,
		show = mode === "show",
		hide = mode === "hide",
		size = options.size || 15,
		percent = /([0-9]+)%/.exec( size ),
		horizFirst = !!options.horizFirst,
		ref = horizFirst ? [ "right", "bottom" ] : [ "bottom", "right" ],
		duration = options.duration / 2,

		placeholder = $.effects.createPlaceholder( element ),

		start = element.cssClip(),
		animation1 = { clip: $.extend( {}, start ) },
		animation2 = { clip: $.extend( {}, start ) },

		distance = [ start[ ref[ 0 ] ], start[ ref[ 1 ] ] ],

		queuelen = element.queue().length;

	if ( percent ) {
		size = parseInt( percent[ 1 ], 10 ) / 100 * distance[ hide ? 0 : 1 ];
	}
	animation1.clip[ ref[ 0 ] ] = size;
	animation2.clip[ ref[ 0 ] ] = size;
	animation2.clip[ ref[ 1 ] ] = 0;

	if ( show ) {
		element.cssClip( animation2.clip );
		if ( placeholder ) {
			placeholder.css( $.effects.clipToBox( animation2 ) );
		}

		animation2.clip = start;
	}

	// Animate
	element
		.queue( function( next ) {
			if ( placeholder ) {
				placeholder
					.animate( $.effects.clipToBox( animation1 ), duration, options.easing )
					.animate( $.effects.clipToBox( animation2 ), duration, options.easing );
			}

			next();
		} )
		.animate( animation1, duration, options.easing )
		.animate( animation2, duration, options.easing )
		.queue( done );

	$.effects.unshift( element, queuelen, 4 );
} );






var effectsEffectHighlight = $.effects.define( "highlight", "show", function( options, done ) {
	var element = $( this ),
		animation = {
			backgroundColor: element.css( "backgroundColor" )
		};

	if ( options.mode === "hide" ) {
		animation.opacity = 0;
	}

	$.effects.saveStyle( element );

	element
		.css( {
			backgroundImage: "none",
			backgroundColor: options.color || "#ffff99"
		} )
		.animate( animation, {
			queue: false,
			duration: options.duration,
			easing: options.easing,
			complete: done
		} );
} );





var effectsEffectSize = $.effects.define( "size", function( options, done ) {

	// Create element
	var baseline, factor, temp,
		element = $( this ),

		// Copy for children
		cProps = [ "fontSize" ],
		vProps = [ "borderTopWidth", "borderBottomWidth", "paddingTop", "paddingBottom" ],
		hProps = [ "borderLeftWidth", "borderRightWidth", "paddingLeft", "paddingRight" ],

		// Set options
		mode = options.mode,
		restore = mode !== "effect",
		scale = options.scale || "both",
		origin = options.origin || [ "middle", "center" ],
		position = element.css( "position" ),
		pos = element.position(),
		original = $.effects.scaledDimensions( element ),
		from = options.from || original,
		to = options.to || $.effects.scaledDimensions( element, 0 );

	$.effects.createPlaceholder( element );

	if ( mode === "show" ) {
		temp = from;
		from = to;
		to = temp;
	}

	// Set scaling factor
	factor = {
		from: {
			y: from.height / original.height,
			x: from.width / original.width
		},
		to: {
			y: to.height / original.height,
			x: to.width / original.width
		}
	};

	// Scale the css box
	if ( scale === "box" || scale === "both" ) {

		// Vertical props scaling
		if ( factor.from.y !== factor.to.y ) {
			from = $.effects.setTransition( element, vProps, factor.from.y, from );
			to = $.effects.setTransition( element, vProps, factor.to.y, to );
		}

		// Horizontal props scaling
		if ( factor.from.x !== factor.to.x ) {
			from = $.effects.setTransition( element, hProps, factor.from.x, from );
			to = $.effects.setTransition( element, hProps, factor.to.x, to );
		}
	}

	// Scale the content
	if ( scale === "content" || scale === "both" ) {

		// Vertical props scaling
		if ( factor.from.y !== factor.to.y ) {
			from = $.effects.setTransition( element, cProps, factor.from.y, from );
			to = $.effects.setTransition( element, cProps, factor.to.y, to );
		}
	}

	// Adjust the position properties based on the provided origin points
	if ( origin ) {
		baseline = $.effects.getBaseline( origin, original );
		from.top = ( original.outerHeight - from.outerHeight ) * baseline.y + pos.top;
		from.left = ( original.outerWidth - from.outerWidth ) * baseline.x + pos.left;
		to.top = ( original.outerHeight - to.outerHeight ) * baseline.y + pos.top;
		to.left = ( original.outerWidth - to.outerWidth ) * baseline.x + pos.left;
	}
	element.css( from );

	// Animate the children if desired
	if ( scale === "content" || scale === "both" ) {

		vProps = vProps.concat( [ "marginTop", "marginBottom" ] ).concat( cProps );
		hProps = hProps.concat( [ "marginLeft", "marginRight" ] );

		// Only animate children with width attributes specified
		// TODO: is this right? should we include anything with css width specified as well
		element.find( "*[width]" ).each( function() {
			var child = $( this ),
				childOriginal = $.effects.scaledDimensions( child ),
				childFrom = {
					height: childOriginal.height * factor.from.y,
					width: childOriginal.width * factor.from.x,
					outerHeight: childOriginal.outerHeight * factor.from.y,
					outerWidth: childOriginal.outerWidth * factor.from.x
				},
				childTo = {
					height: childOriginal.height * factor.to.y,
					width: childOriginal.width * factor.to.x,
					outerHeight: childOriginal.height * factor.to.y,
					outerWidth: childOriginal.width * factor.to.x
				};

			// Vertical props scaling
			if ( factor.from.y !== factor.to.y ) {
				childFrom = $.effects.setTransition( child, vProps, factor.from.y, childFrom );
				childTo = $.effects.setTransition( child, vProps, factor.to.y, childTo );
			}

			// Horizontal props scaling
			if ( factor.from.x !== factor.to.x ) {
				childFrom = $.effects.setTransition( child, hProps, factor.from.x, childFrom );
				childTo = $.effects.setTransition( child, hProps, factor.to.x, childTo );
			}

			if ( restore ) {
				$.effects.saveStyle( child );
			}

			// Animate children
			child.css( childFrom );
			child.animate( childTo, options.duration, options.easing, function() {

				// Restore children
				if ( restore ) {
					$.effects.restoreStyle( child );
				}
			} );
		} );
	}

	// Animate
	element.animate( to, {
		queue: false,
		duration: options.duration,
		easing: options.easing,
		complete: function() {

			var offset = element.offset();

			if ( to.opacity === 0 ) {
				element.css( "opacity", from.opacity );
			}

			if ( !restore ) {
				element
					.css( "position", position === "static" ? "relative" : position )
					.offset( offset );

				// Need to save style here so that automatic style restoration
				// doesn't restore to the original styles from before the animation.
				$.effects.saveStyle( element );
			}

			done();
		}
	} );

} );






var effectsEffectScale = $.effects.define( "scale", function( options, done ) {

	// Create element
	var el = $( this ),
		mode = options.mode,
		percent = parseInt( options.percent, 10 ) ||
			( parseInt( options.percent, 10 ) === 0 ? 0 : ( mode !== "effect" ? 0 : 100 ) ),

		newOptions = $.extend( true, {
			from: $.effects.scaledDimensions( el ),
			to: $.effects.scaledDimensions( el, percent, options.direction || "both" ),
			origin: options.origin || [ "middle", "center" ]
		}, options );

	// Fade option to support puff
	if ( options.fade ) {
		newOptions.from.opacity = 1;
		newOptions.to.opacity = 0;
	}

	$.effects.effect.size.call( this, newOptions, done );
} );






var effectsEffectPuff = $.effects.define( "puff", "hide", function( options, done ) {
	var newOptions = $.extend( true, {}, options, {
		fade: true,
		percent: parseInt( options.percent, 10 ) || 150
	} );

	$.effects.effect.scale.call( this, newOptions, done );
} );






var effectsEffectPulsate = $.effects.define( "pulsate", "show", function( options, done ) {
	var element = $( this ),
		mode = options.mode,
		show = mode === "show",
		hide = mode === "hide",
		showhide = show || hide,

		// Showing or hiding leaves off the "last" animation
		anims = ( ( options.times || 5 ) * 2 ) + ( showhide ? 1 : 0 ),
		duration = options.duration / anims,
		animateTo = 0,
		i = 1,
		queuelen = element.queue().length;

	if ( show || !element.is( ":visible" ) ) {
		element.css( "opacity", 0 ).show();
		animateTo = 1;
	}

	// Anims - 1 opacity "toggles"
	for ( ; i < anims; i++ ) {
		element.animate( { opacity: animateTo }, duration, options.easing );
		animateTo = 1 - animateTo;
	}

	element.animate( { opacity: animateTo }, duration, options.easing );

	element.queue( done );

	$.effects.unshift( element, queuelen, anims + 1 );
} );





var effectsEffectShake = $.effects.define( "shake", function( options, done ) {

	var i = 1,
		element = $( this ),
		direction = options.direction || "left",
		distance = options.distance || 20,
		times = options.times || 3,
		anims = times * 2 + 1,
		speed = Math.round( options.duration / anims ),
		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
		positiveMotion = ( direction === "up" || direction === "left" ),
		animation = {},
		animation1 = {},
		animation2 = {},

		queuelen = element.queue().length;

	$.effects.createPlaceholder( element );

	// Animation
	animation[ ref ] = ( positiveMotion ? "-=" : "+=" ) + distance;
	animation1[ ref ] = ( positiveMotion ? "+=" : "-=" ) + distance * 2;
	animation2[ ref ] = ( positiveMotion ? "-=" : "+=" ) + distance * 2;

	// Animate
	element.animate( animation, speed, options.easing );

	// Shakes
	for ( ; i < times; i++ ) {
		element
			.animate( animation1, speed, options.easing )
			.animate( animation2, speed, options.easing );
	}

	element
		.animate( animation1, speed, options.easing )
		.animate( animation, speed / 2, options.easing )
		.queue( done );

	$.effects.unshift( element, queuelen, anims + 1 );
} );






var effectsEffectSlide = $.effects.define( "slide", "show", function( options, done ) {
	var startClip, startRef,
		element = $( this ),
		map = {
			up: [ "bottom", "top" ],
			down: [ "top", "bottom" ],
			left: [ "right", "left" ],
			right: [ "left", "right" ]
		},
		mode = options.mode,
		direction = options.direction || "left",
		ref = ( direction === "up" || direction === "down" ) ? "top" : "left",
		positiveMotion = ( direction === "up" || direction === "left" ),
		distance = options.distance ||
			element[ ref === "top" ? "outerHeight" : "outerWidth" ]( true ),
		animation = {};

	$.effects.createPlaceholder( element );

	startClip = element.cssClip();
	startRef = element.position()[ ref ];

	// Define hide animation
	animation[ ref ] = ( positiveMotion ? -1 : 1 ) * distance + startRef;
	animation.clip = element.cssClip();
	animation.clip[ map[ direction ][ 1 ] ] = animation.clip[ map[ direction ][ 0 ] ];

	// Reverse the animation if we're showing
	if ( mode === "show" ) {
		element.cssClip( animation.clip );
		element.css( ref, animation[ ref ] );
		animation.clip = startClip;
		animation[ ref ] = startRef;
	}

	// Actually animate
	element.animate( animation, {
		queue: false,
		duration: options.duration,
		easing: options.easing,
		complete: done
	} );
} );





var effect;
if ( $.uiBackCompat !== false ) {
	effect = $.effects.define( "transfer", function( options, done ) {
		$( this ).transfer( options, done );
	} );
}
var effectsEffectTransfer = effect;






// Selectors
$.ui.focusable = function( element, hasTabindex ) {
	var map, mapName, img, focusableIfVisible, fieldset,
		nodeName = element.nodeName.toLowerCase();

	if ( "area" === nodeName ) {
		map = element.parentNode;
		mapName = map.name;
		if ( !element.href || !mapName || map.nodeName.toLowerCase() !== "map" ) {
			return false;
		}
		img = $( "img[usemap='#" + mapName + "']" );
		return img.length > 0 && img.is( ":visible" );
	}

	if ( /^(input|select|textarea|button|object)$/.test( nodeName ) ) {
		focusableIfVisible = !element.disabled;

		if ( focusableIfVisible ) {

			// Form controls within a disabled fieldset are disabled.
			// However, controls within the fieldset's legend do not get disabled.
			// Since controls generally aren't placed inside legends, we skip
			// this portion of the check.
			fieldset = $( element ).closest( "fieldset" )[ 0 ];
			if ( fieldset ) {
				focusableIfVisible = !fieldset.disabled;
			}
		}
	} else if ( "a" === nodeName ) {
		focusableIfVisible = element.href || hasTabindex;
	} else {
		focusableIfVisible = hasTabindex;
	}

	return focusableIfVisible && $( element ).is( ":visible" ) && visible( $( element ) );
};

// Support: IE 8 only
// IE 8 doesn't resolve inherit to visible/hidden for computed values
function visible( element ) {
	var visibility = element.css( "visibility" );
	while ( visibility === "inherit" ) {
		element = element.parent();
		visibility = element.css( "visibility" );
	}
	return visibility !== "hidden";
}

$.extend( $.expr[ ":" ], {
	focusable: function( element ) {
		return $.ui.focusable( element, $.attr( element, "tabindex" ) != null );
	}
} );

var focusable = $.ui.focusable;




// Support: IE8 Only
// IE8 does not support the form attribute and when it is supplied. It overwrites the form prop
// with a string, so we need to find the proper form.
var form = $.fn.form = function() {
	return typeof this[ 0 ].form === "string" ? this.closest( "form" ) : $( this[ 0 ].form );
};






var formResetMixin = $.ui.formResetMixin = {
	_formResetHandler: function() {
		var form = $( this );

		// Wait for the form reset to actually happen before refreshing
		setTimeout( function() {
			var instances = form.data( "ui-form-reset-instances" );
			$.each( instances, function() {
				this.refresh();
			} );
		} );
	},

	_bindFormResetHandler: function() {
		this.form = this.element.form();
		if ( !this.form.length ) {
			return;
		}

		var instances = this.form.data( "ui-form-reset-instances" ) || [];
		if ( !instances.length ) {

			// We don't use _on() here because we use a single event handler per form
			this.form.on( "reset.ui-form-reset", this._formResetHandler );
		}
		instances.push( this );
		this.form.data( "ui-form-reset-instances", instances );
	},

	_unbindFormResetHandler: function() {
		if ( !this.form.length ) {
			return;
		}

		var instances = this.form.data( "ui-form-reset-instances" );
		instances.splice( $.inArray( this, instances ), 1 );
		if ( instances.length ) {
			this.form.data( "ui-form-reset-instances", instances );
		} else {
			this.form
				.removeData( "ui-form-reset-instances" )
				.off( "reset.ui-form-reset" );
		}
	}
};






// Not a great way to check versions, but since we only support 1.7+ and only
// need to detect <1.8, this is a simple check that should suffice. Checking
// for "1.7." would be a bit safer, but the version string is 1.7, not 1.7.0
// and we'll never reach 1.70.0 (if we do, we certainly won't be supporting
// 1.7 anymore). See #11197 for why we're not using feature detection.
if ( $.fn.jquery.substring( 0, 3 ) === "1.7" ) {

	// Setters for .innerWidth(), .innerHeight(), .outerWidth(), .outerHeight()
	// Unlike jQuery Core 1.8+, these only support numeric values to set the
	// dimensions in pixels
	$.each( [ "Width", "Height" ], function( i, name ) {
		var side = name === "Width" ? [ "Left", "Right" ] : [ "Top", "Bottom" ],
			type = name.toLowerCase(),
			orig = {
				innerWidth: $.fn.innerWidth,
				innerHeight: $.fn.innerHeight,
				outerWidth: $.fn.outerWidth,
				outerHeight: $.fn.outerHeight
			};

		function reduce( elem, size, border, margin ) {
			$.each( side, function() {
				size -= parseFloat( $.css( elem, "padding" + this ) ) || 0;
				if ( border ) {
					size -= parseFloat( $.css( elem, "border" + this + "Width" ) ) || 0;
				}
				if ( margin ) {
					size -= parseFloat( $.css( elem, "margin" + this ) ) || 0;
				}
			} );
			return size;
		}

		$.fn[ "inner" + name ] = function( size ) {
			if ( size === undefined ) {
				return orig[ "inner" + name ].call( this );
			}

			return this.each( function() {
				$( this ).css( type, reduce( this, size ) + "px" );
			} );
		};

		$.fn[ "outer" + name ] = function( size, margin ) {
			if ( typeof size !== "number" ) {
				return orig[ "outer" + name ].call( this, size );
			}

			return this.each( function() {
				$( this ).css( type, reduce( this, size, true, margin ) + "px" );
			} );
		};
	} );

	$.fn.addBack = function( selector ) {
		return this.add( selector == null ?
			this.prevObject : this.prevObject.filter( selector )
		);
	};
}

;



var keycode = $.ui.keyCode = {
	BACKSPACE: 8,
	COMMA: 188,
	DELETE: 46,
	DOWN: 40,
	END: 35,
	ENTER: 13,
	ESCAPE: 27,
	HOME: 36,
	LEFT: 37,
	PAGE_DOWN: 34,
	PAGE_UP: 33,
	PERIOD: 190,
	RIGHT: 39,
	SPACE: 32,
	TAB: 9,
	UP: 38
};




// Internal use only
var escapeSelector = $.ui.escapeSelector = ( function() {
	var selectorEscape = /([!"#$%&'()*+,./:;<=>?@[\]^`{|}~])/g;
	return function( selector ) {
		return selector.replace( selectorEscape, "\\$1" );
	};
} )();






var labels = $.fn.labels = function() {
	var ancestor, selector, id, labels, ancestors;

	// Check control.labels first
	if ( this[ 0 ].labels && this[ 0 ].labels.length ) {
		return this.pushStack( this[ 0 ].labels );
	}

	// Support: IE <= 11, FF <= 37, Android <= 2.3 only
	// Above browsers do not support control.labels. Everything below is to support them
	// as well as document fragments. control.labels does not work on document fragments
	labels = this.eq( 0 ).parents( "label" );

	// Look for the label based on the id
	id = this.attr( "id" );
	if ( id ) {

		// We don't search against the document in case the element
		// is disconnected from the DOM
		ancestor = this.eq( 0 ).parents().last();

		// Get a full set of top level ancestors
		ancestors = ancestor.add( ancestor.length ? ancestor.siblings() : this.siblings() );

		// Create a selector for the label based on the id
		selector = "label[for='" + $.ui.escapeSelector( id ) + "']";

		labels = labels.add( ancestors.find( selector ).addBack( selector ) );

	}

	// Return whatever we have found for labels
	return this.pushStack( labels );
};






var scrollParent = $.fn.scrollParent = function( includeHidden ) {
	var position = this.css( "position" ),
		excludeStaticParent = position === "absolute",
		overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/,
		scrollParent = this.parents().filter( function() {
			var parent = $( this );
			if ( excludeStaticParent && parent.css( "position" ) === "static" ) {
				return false;
			}
			return overflowRegex.test( parent.css( "overflow" ) + parent.css( "overflow-y" ) +
				parent.css( "overflow-x" ) );
		} ).eq( 0 );

	return position === "fixed" || !scrollParent.length ?
		$( this[ 0 ].ownerDocument || document ) :
		scrollParent;
};






var tabbable = $.extend( $.expr[ ":" ], {
	tabbable: function( element ) {
		var tabIndex = $.attr( element, "tabindex" ),
			hasTabindex = tabIndex != null;
		return ( !hasTabindex || tabIndex >= 0 ) && $.ui.focusable( element, hasTabindex );
	}
} );






var uniqueId = $.fn.extend( {
	uniqueId: ( function() {
		var uuid = 0;

		return function() {
			return this.each( function() {
				if ( !this.id ) {
					this.id = "ui-id-" + ( ++uuid );
				}
			} );
		};
	} )(),

	removeUniqueId: function() {
		return this.each( function() {
			if ( /^ui-id-\d+$/.test( this.id ) ) {
				$( this ).removeAttr( "id" );
			}
		} );
	}
} );



//>>label: Accordion
//>>group: Widgets
// jscs:disable maximumLineLength
//>>description: Displays collapsible content panels for presenting information in a limited amount of space.
// jscs:enable maximumLineLength
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/accordion.css
//>>css.theme: ../../themes/base/theme.css



var widgetsAccordion = $.widget( "ui.accordion", {
	version: "1.12.1",
	options: {
		active: 0,
		animate: {},
		classes: {
			"ui-accordion-header": "ui-corner-top",
			"ui-accordion-header-collapsed": "ui-corner-all",
			"ui-accordion-content": "ui-corner-bottom"
		},
		collapsible: false,
		event: "click",
		header: "> li > :first-child, > :not(li):even",
		heightStyle: "auto",
		icons: {
			activeHeader: "ui-icon-triangle-1-s",
			header: "ui-icon-triangle-1-e"
		},

		// Callbacks
		activate: null,
		beforeActivate: null
	},

	hideProps: {
		borderTopWidth: "hide",
		borderBottomWidth: "hide",
		paddingTop: "hide",
		paddingBottom: "hide",
		height: "hide"
	},

	showProps: {
		borderTopWidth: "show",
		borderBottomWidth: "show",
		paddingTop: "show",
		paddingBottom: "show",
		height: "show"
	},

	_create: function() {
		var options = this.options;

		this.prevShow = this.prevHide = $();
		this._addClass( "ui-accordion", "ui-widget ui-helper-reset" );
		this.element.attr( "role", "tablist" );

		// Don't allow collapsible: false and active: false / null
		if ( !options.collapsible && ( options.active === false || options.active == null ) ) {
			options.active = 0;
		}

		this._processPanels();

		// handle negative values
		if ( options.active < 0 ) {
			options.active += this.headers.length;
		}
		this._refresh();
	},

	_getCreateEventData: function() {
		return {
			header: this.active,
			panel: !this.active.length ? $() : this.active.next()
		};
	},

	_createIcons: function() {
		var icon, children,
			icons = this.options.icons;

		if ( icons ) {
			icon = $( "<span>" );
			this._addClass( icon, "ui-accordion-header-icon", "ui-icon " + icons.header );
			icon.prependTo( this.headers );
			children = this.active.children( ".ui-accordion-header-icon" );
			this._removeClass( children, icons.header )
				._addClass( children, null, icons.activeHeader )
				._addClass( this.headers, "ui-accordion-icons" );
		}
	},

	_destroyIcons: function() {
		this._removeClass( this.headers, "ui-accordion-icons" );
		this.headers.children( ".ui-accordion-header-icon" ).remove();
	},

	_destroy: function() {
		var contents;

		// Clean up main element
		this.element.removeAttr( "role" );

		// Clean up headers
		this.headers
			.removeAttr( "role aria-expanded aria-selected aria-controls tabIndex" )
			.removeUniqueId();

		this._destroyIcons();

		// Clean up content panels
		contents = this.headers.next()
			.css( "display", "" )
			.removeAttr( "role aria-hidden aria-labelledby" )
			.removeUniqueId();

		if ( this.options.heightStyle !== "content" ) {
			contents.css( "height", "" );
		}
	},

	_setOption: function( key, value ) {
		if ( key === "active" ) {

			// _activate() will handle invalid values and update this.options
			this._activate( value );
			return;
		}

		if ( key === "event" ) {
			if ( this.options.event ) {
				this._off( this.headers, this.options.event );
			}
			this._setupEvents( value );
		}

		this._super( key, value );

		// Setting collapsible: false while collapsed; open first panel
		if ( key === "collapsible" && !value && this.options.active === false ) {
			this._activate( 0 );
		}

		if ( key === "icons" ) {
			this._destroyIcons();
			if ( value ) {
				this._createIcons();
			}
		}
	},

	_setOptionDisabled: function( value ) {
		this._super( value );

		this.element.attr( "aria-disabled", value );

		// Support: IE8 Only
		// #5332 / #6059 - opacity doesn't cascade to positioned elements in IE
		// so we need to add the disabled class to the headers and panels
		this._toggleClass( null, "ui-state-disabled", !!value );
		this._toggleClass( this.headers.add( this.headers.next() ), null, "ui-state-disabled",
			!!value );
	},

	_keydown: function( event ) {
		if ( event.altKey || event.ctrlKey ) {
			return;
		}

		var keyCode = $.ui.keyCode,
			length = this.headers.length,
			currentIndex = this.headers.index( event.target ),
			toFocus = false;

		switch ( event.keyCode ) {
		case keyCode.RIGHT:
		case keyCode.DOWN:
			toFocus = this.headers[ ( currentIndex + 1 ) % length ];
			break;
		case keyCode.LEFT:
		case keyCode.UP:
			toFocus = this.headers[ ( currentIndex - 1 + length ) % length ];
			break;
		case keyCode.SPACE:
		case keyCode.ENTER:
			this._eventHandler( event );
			break;
		case keyCode.HOME:
			toFocus = this.headers[ 0 ];
			break;
		case keyCode.END:
			toFocus = this.headers[ length - 1 ];
			break;
		}

		if ( toFocus ) {
			$( event.target ).attr( "tabIndex", -1 );
			$( toFocus ).attr( "tabIndex", 0 );
			$( toFocus ).trigger( "focus" );
			event.preventDefault();
		}
	},

	_panelKeyDown: function( event ) {
		if ( event.keyCode === $.ui.keyCode.UP && event.ctrlKey ) {
			$( event.currentTarget ).prev().trigger( "focus" );
		}
	},

	refresh: function() {
		var options = this.options;
		this._processPanels();

		// Was collapsed or no panel
		if ( ( options.active === false && options.collapsible === true ) ||
				!this.headers.length ) {
			options.active = false;
			this.active = $();

		// active false only when collapsible is true
		} else if ( options.active === false ) {
			this._activate( 0 );

		// was active, but active panel is gone
		} else if ( this.active.length && !$.contains( this.element[ 0 ], this.active[ 0 ] ) ) {

			// all remaining panel are disabled
			if ( this.headers.length === this.headers.find( ".ui-state-disabled" ).length ) {
				options.active = false;
				this.active = $();

			// activate previous panel
			} else {
				this._activate( Math.max( 0, options.active - 1 ) );
			}

		// was active, active panel still exists
		} else {

			// make sure active index is correct
			options.active = this.headers.index( this.active );
		}

		this._destroyIcons();

		this._refresh();
	},

	_processPanels: function() {
		var prevHeaders = this.headers,
			prevPanels = this.panels;

		this.headers = this.element.find( this.options.header );
		this._addClass( this.headers, "ui-accordion-header ui-accordion-header-collapsed",
			"ui-state-default" );

		this.panels = this.headers.next().filter( ":not(.ui-accordion-content-active)" ).hide();
		this._addClass( this.panels, "ui-accordion-content", "ui-helper-reset ui-widget-content" );

		// Avoid memory leaks (#10056)
		if ( prevPanels ) {
			this._off( prevHeaders.not( this.headers ) );
			this._off( prevPanels.not( this.panels ) );
		}
	},

	_refresh: function() {
		var maxHeight,
			options = this.options,
			heightStyle = options.heightStyle,
			parent = this.element.parent();

		this.active = this._findActive( options.active );
		this._addClass( this.active, "ui-accordion-header-active", "ui-state-active" )
			._removeClass( this.active, "ui-accordion-header-collapsed" );
		this._addClass( this.active.next(), "ui-accordion-content-active" );
		this.active.next().show();

		this.headers
			.attr( "role", "tab" )
			.each( function() {
				var header = $( this ),
					headerId = header.uniqueId().attr( "id" ),
					panel = header.next(),
					panelId = panel.uniqueId().attr( "id" );
				header.attr( "aria-controls", panelId );
				panel.attr( "aria-labelledby", headerId );
			} )
			.next()
				.attr( "role", "tabpanel" );

		this.headers
			.not( this.active )
				.attr( {
					"aria-selected": "false",
					"aria-expanded": "false",
					tabIndex: -1
				} )
				.next()
					.attr( {
						"aria-hidden": "true"
					} )
					.hide();

		// Make sure at least one header is in the tab order
		if ( !this.active.length ) {
			this.headers.eq( 0 ).attr( "tabIndex", 0 );
		} else {
			this.active.attr( {
				"aria-selected": "true",
				"aria-expanded": "true",
				tabIndex: 0
			} )
				.next()
					.attr( {
						"aria-hidden": "false"
					} );
		}

		this._createIcons();

		this._setupEvents( options.event );

		if ( heightStyle === "fill" ) {
			maxHeight = parent.height();
			this.element.siblings( ":visible" ).each( function() {
				var elem = $( this ),
					position = elem.css( "position" );

				if ( position === "absolute" || position === "fixed" ) {
					return;
				}
				maxHeight -= elem.outerHeight( true );
			} );

			this.headers.each( function() {
				maxHeight -= $( this ).outerHeight( true );
			} );

			this.headers.next()
				.each( function() {
					$( this ).height( Math.max( 0, maxHeight -
						$( this ).innerHeight() + $( this ).height() ) );
				} )
				.css( "overflow", "auto" );
		} else if ( heightStyle === "auto" ) {
			maxHeight = 0;
			this.headers.next()
				.each( function() {
					var isVisible = $( this ).is( ":visible" );
					if ( !isVisible ) {
						$( this ).show();
					}
					maxHeight = Math.max( maxHeight, $( this ).css( "height", "" ).height() );
					if ( !isVisible ) {
						$( this ).hide();
					}
				} )
				.height( maxHeight );
		}
	},

	_activate: function( index ) {
		var active = this._findActive( index )[ 0 ];

		// Trying to activate the already active panel
		if ( active === this.active[ 0 ] ) {
			return;
		}

		// Trying to collapse, simulate a click on the currently active header
		active = active || this.active[ 0 ];

		this._eventHandler( {
			target: active,
			currentTarget: active,
			preventDefault: $.noop
		} );
	},

	_findActive: function( selector ) {
		return typeof selector === "number" ? this.headers.eq( selector ) : $();
	},

	_setupEvents: function( event ) {
		var events = {
			keydown: "_keydown"
		};
		if ( event ) {
			$.each( event.split( " " ), function( index, eventName ) {
				events[ eventName ] = "_eventHandler";
			} );
		}

		this._off( this.headers.add( this.headers.next() ) );
		this._on( this.headers, events );
		this._on( this.headers.next(), { keydown: "_panelKeyDown" } );
		this._hoverable( this.headers );
		this._focusable( this.headers );
	},

	_eventHandler: function( event ) {
		var activeChildren, clickedChildren,
			options = this.options,
			active = this.active,
			clicked = $( event.currentTarget ),
			clickedIsActive = clicked[ 0 ] === active[ 0 ],
			collapsing = clickedIsActive && options.collapsible,
			toShow = collapsing ? $() : clicked.next(),
			toHide = active.next(),
			eventData = {
				oldHeader: active,
				oldPanel: toHide,
				newHeader: collapsing ? $() : clicked,
				newPanel: toShow
			};

		event.preventDefault();

		if (

				// click on active header, but not collapsible
				( clickedIsActive && !options.collapsible ) ||

				// allow canceling activation
				( this._trigger( "beforeActivate", event, eventData ) === false ) ) {
			return;
		}

		options.active = collapsing ? false : this.headers.index( clicked );

		// When the call to ._toggle() comes after the class changes
		// it causes a very odd bug in IE 8 (see #6720)
		this.active = clickedIsActive ? $() : clicked;
		this._toggle( eventData );

		// Switch classes
		// corner classes on the previously active header stay after the animation
		this._removeClass( active, "ui-accordion-header-active", "ui-state-active" );
		if ( options.icons ) {
			activeChildren = active.children( ".ui-accordion-header-icon" );
			this._removeClass( activeChildren, null, options.icons.activeHeader )
				._addClass( activeChildren, null, options.icons.header );
		}

		if ( !clickedIsActive ) {
			this._removeClass( clicked, "ui-accordion-header-collapsed" )
				._addClass( clicked, "ui-accordion-header-active", "ui-state-active" );
			if ( options.icons ) {
				clickedChildren = clicked.children( ".ui-accordion-header-icon" );
				this._removeClass( clickedChildren, null, options.icons.header )
					._addClass( clickedChildren, null, options.icons.activeHeader );
			}

			this._addClass( clicked.next(), "ui-accordion-content-active" );
		}
	},

	_toggle: function( data ) {
		var toShow = data.newPanel,
			toHide = this.prevShow.length ? this.prevShow : data.oldPanel;

		// Handle activating a panel during the animation for another activation
		this.prevShow.add( this.prevHide ).stop( true, true );
		this.prevShow = toShow;
		this.prevHide = toHide;

		if ( this.options.animate ) {
			this._animate( toShow, toHide, data );
		} else {
			toHide.hide();
			toShow.show();
			this._toggleComplete( data );
		}

		toHide.attr( {
			"aria-hidden": "true"
		} );
		toHide.prev().attr( {
			"aria-selected": "false",
			"aria-expanded": "false"
		} );

		// if we're switching panels, remove the old header from the tab order
		// if we're opening from collapsed state, remove the previous header from the tab order
		// if we're collapsing, then keep the collapsing header in the tab order
		if ( toShow.length && toHide.length ) {
			toHide.prev().attr( {
				"tabIndex": -1,
				"aria-expanded": "false"
			} );
		} else if ( toShow.length ) {
			this.headers.filter( function() {
				return parseInt( $( this ).attr( "tabIndex" ), 10 ) === 0;
			} )
				.attr( "tabIndex", -1 );
		}

		toShow
			.attr( "aria-hidden", "false" )
			.prev()
				.attr( {
					"aria-selected": "true",
					"aria-expanded": "true",
					tabIndex: 0
				} );
	},

	_animate: function( toShow, toHide, data ) {
		var total, easing, duration,
			that = this,
			adjust = 0,
			boxSizing = toShow.css( "box-sizing" ),
			down = toShow.length &&
				( !toHide.length || ( toShow.index() < toHide.index() ) ),
			animate = this.options.animate || {},
			options = down && animate.down || animate,
			complete = function() {
				that._toggleComplete( data );
			};

		if ( typeof options === "number" ) {
			duration = options;
		}
		if ( typeof options === "string" ) {
			easing = options;
		}

		// fall back from options to animation in case of partial down settings
		easing = easing || options.easing || animate.easing;
		duration = duration || options.duration || animate.duration;

		if ( !toHide.length ) {
			return toShow.animate( this.showProps, duration, easing, complete );
		}
		if ( !toShow.length ) {
			return toHide.animate( this.hideProps, duration, easing, complete );
		}

		total = toShow.show().outerHeight();
		toHide.animate( this.hideProps, {
			duration: duration,
			easing: easing,
			step: function( now, fx ) {
				fx.now = Math.round( now );
			}
		} );
		toShow
			.hide()
			.animate( this.showProps, {
				duration: duration,
				easing: easing,
				complete: complete,
				step: function( now, fx ) {
					fx.now = Math.round( now );
					if ( fx.prop !== "height" ) {
						if ( boxSizing === "content-box" ) {
							adjust += fx.now;
						}
					} else if ( that.options.heightStyle !== "content" ) {
						fx.now = Math.round( total - toHide.outerHeight() - adjust );
						adjust = 0;
					}
				}
			} );
	},

	_toggleComplete: function( data ) {
		var toHide = data.oldPanel,
			prev = toHide.prev();

		this._removeClass( toHide, "ui-accordion-content-active" );
		this._removeClass( prev, "ui-accordion-header-active" )
			._addClass( prev, "ui-accordion-header-collapsed" );

		// Work around for rendering bug in IE (#5421)
		if ( toHide.length ) {
			toHide.parent()[ 0 ].className = toHide.parent()[ 0 ].className;
		}
		this._trigger( "activate", null, data );
	}
} );



var safeActiveElement = $.ui.safeActiveElement = function( document ) {
	var activeElement;

	// Support: IE 9 only
	// IE9 throws an "Unspecified error" accessing document.activeElement from an <iframe>
	try {
		activeElement = document.activeElement;
	} catch ( error ) {
		activeElement = document.body;
	}

	// Support: IE 9 - 11 only
	// IE may return null instead of an element
	// Interestingly, this only seems to occur when NOT in an iframe
	if ( !activeElement ) {
		activeElement = document.body;
	}

	// Support: IE 11 only
	// IE11 returns a seemingly empty object in some cases when accessing
	// document.activeElement from an <iframe>
	if ( !activeElement.nodeName ) {
		activeElement = document.body;
	}

	return activeElement;
};


//>>label: Menu
//>>group: Widgets
//>>description: Creates nestable menus.
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/menu.css
//>>css.theme: ../../themes/base/theme.css



var widgetsMenu = $.widget( "ui.menu", {
	version: "1.12.1",
	defaultElement: "<ul>",
	delay: 300,
	options: {
		icons: {
			submenu: "ui-icon-caret-1-e"
		},
		items: "> *",
		menus: "ul",
		position: {
			my: "left top",
			at: "right top"
		},
		role: "menu",

		// Callbacks
		blur: null,
		focus: null,
		select: null
	},

	_create: function() {
		this.activeMenu = this.element;

		// Flag used to prevent firing of the click handler
		// as the event bubbles up through nested menus
		this.mouseHandled = false;
		this.element
			.uniqueId()
			.attr( {
				role: this.options.role,
				tabIndex: 0
			} );

		this._addClass( "ui-menu", "ui-widget ui-widget-content" );
		this._on( {

			// Prevent focus from sticking to links inside menu after clicking
			// them (focus should always stay on UL during navigation).
			"mousedown .ui-menu-item": function( event ) {
				event.preventDefault();
			},
			"click .ui-menu-item": function( event ) {
				var target = $( event.target );
				var active = $( $.ui.safeActiveElement( this.document[ 0 ] ) );
				if ( !this.mouseHandled && target.not( ".ui-state-disabled" ).length ) {
					this.select( event );

					// Only set the mouseHandled flag if the event will bubble, see #9469.
					if ( !event.isPropagationStopped() ) {
						this.mouseHandled = true;
					}

					// Open submenu on click
					if ( target.has( ".ui-menu" ).length ) {
						this.expand( event );
					} else if ( !this.element.is( ":focus" ) &&
							active.closest( ".ui-menu" ).length ) {

						// Redirect focus to the menu
						this.element.trigger( "focus", [ true ] );

						// If the active item is on the top level, let it stay active.
						// Otherwise, blur the active item since it is no longer visible.
						if ( this.active && this.active.parents( ".ui-menu" ).length === 1 ) {
							clearTimeout( this.timer );
						}
					}
				}
			},
			"mouseenter .ui-menu-item": function( event ) {

				// Ignore mouse events while typeahead is active, see #10458.
				// Prevents focusing the wrong item when typeahead causes a scroll while the mouse
				// is over an item in the menu
				if ( this.previousFilter ) {
					return;
				}

				var actualTarget = $( event.target ).closest( ".ui-menu-item" ),
					target = $( event.currentTarget );

				// Ignore bubbled events on parent items, see #11641
				if ( actualTarget[ 0 ] !== target[ 0 ] ) {
					return;
				}

				// Remove ui-state-active class from siblings of the newly focused menu item
				// to avoid a jump caused by adjacent elements both having a class with a border
				this._removeClass( target.siblings().children( ".ui-state-active" ),
					null, "ui-state-active" );
				this.focus( event, target );
			},
			mouseleave: "collapseAll",
			"mouseleave .ui-menu": "collapseAll",
			focus: function( event, keepActiveItem ) {

				// If there's already an active item, keep it active
				// If not, activate the first item
				var item = this.active || this.element.find( this.options.items ).eq( 0 );

				if ( !keepActiveItem ) {
					this.focus( event, item );
				}
			},
			blur: function( event ) {
				this._delay( function() {
					var notContained = !$.contains(
						this.element[ 0 ],
						$.ui.safeActiveElement( this.document[ 0 ] )
					);
					if ( notContained ) {
						this.collapseAll( event );
					}
				} );
			},
			keydown: "_keydown"
		} );

		this.refresh();

		// Clicks outside of a menu collapse any open menus
		this._on( this.document, {
			click: function( event ) {
				if ( this._closeOnDocumentClick( event ) ) {
					this.collapseAll( event );
				}

				// Reset the mouseHandled flag
				this.mouseHandled = false;
			}
		} );
	},

	_destroy: function() {
		var items = this.element.find( ".ui-menu-item" )
				.removeAttr( "role aria-disabled" ),
			submenus = items.children( ".ui-menu-item-wrapper" )
				.removeUniqueId()
				.removeAttr( "tabIndex role aria-haspopup" );

		// Destroy (sub)menus
		this.element
			.removeAttr( "aria-activedescendant" )
			.find( ".ui-menu" ).addBack()
				.removeAttr( "role aria-labelledby aria-expanded aria-hidden aria-disabled " +
					"tabIndex" )
				.removeUniqueId()
				.show();

		submenus.children().each( function() {
			var elem = $( this );
			if ( elem.data( "ui-menu-submenu-caret" ) ) {
				elem.remove();
			}
		} );
	},

	_keydown: function( event ) {
		var match, prev, character, skip,
			preventDefault = true;

		switch ( event.keyCode ) {
		case $.ui.keyCode.PAGE_UP:
			this.previousPage( event );
			break;
		case $.ui.keyCode.PAGE_DOWN:
			this.nextPage( event );
			break;
		case $.ui.keyCode.HOME:
			this._move( "first", "first", event );
			break;
		case $.ui.keyCode.END:
			this._move( "last", "last", event );
			break;
		case $.ui.keyCode.UP:
			this.previous( event );
			break;
		case $.ui.keyCode.DOWN:
			this.next( event );
			break;
		case $.ui.keyCode.LEFT:
			this.collapse( event );
			break;
		case $.ui.keyCode.RIGHT:
			if ( this.active && !this.active.is( ".ui-state-disabled" ) ) {
				this.expand( event );
			}
			break;
		case $.ui.keyCode.ENTER:
		case $.ui.keyCode.SPACE:
			this._activate( event );
			break;
		case $.ui.keyCode.ESCAPE:
			this.collapse( event );
			break;
		default:
			preventDefault = false;
			prev = this.previousFilter || "";
			skip = false;

			// Support number pad values
			character = event.keyCode >= 96 && event.keyCode <= 105 ?
				( event.keyCode - 96 ).toString() : String.fromCharCode( event.keyCode );

			clearTimeout( this.filterTimer );

			if ( character === prev ) {
				skip = true;
			} else {
				character = prev + character;
			}

			match = this._filterMenuItems( character );
			match = skip && match.index( this.active.next() ) !== -1 ?
				this.active.nextAll( ".ui-menu-item" ) :
				match;

			// If no matches on the current filter, reset to the last character pressed
			// to move down the menu to the first item that starts with that character
			if ( !match.length ) {
				character = String.fromCharCode( event.keyCode );
				match = this._filterMenuItems( character );
			}

			if ( match.length ) {
				this.focus( event, match );
				this.previousFilter = character;
				this.filterTimer = this._delay( function() {
					delete this.previousFilter;
				}, 1000 );
			} else {
				delete this.previousFilter;
			}
		}

		if ( preventDefault ) {
			event.preventDefault();
		}
	},

	_activate: function( event ) {
		if ( this.active && !this.active.is( ".ui-state-disabled" ) ) {
			if ( this.active.children( "[aria-haspopup='true']" ).length ) {
				this.expand( event );
			} else {
				this.select( event );
			}
		}
	},

	refresh: function() {
		var menus, items, newSubmenus, newItems, newWrappers,
			that = this,
			icon = this.options.icons.submenu,
			submenus = this.element.find( this.options.menus );

		this._toggleClass( "ui-menu-icons", null, !!this.element.find( ".ui-icon" ).length );

		// Initialize nested menus
		newSubmenus = submenus.filter( ":not(.ui-menu)" )
			.hide()
			.attr( {
				role: this.options.role,
				"aria-hidden": "true",
				"aria-expanded": "false"
			} )
			.each( function() {
				var menu = $( this ),
					item = menu.prev(),
					submenuCaret = $( "<span>" ).data( "ui-menu-submenu-caret", true );

				that._addClass( submenuCaret, "ui-menu-icon", "ui-icon " + icon );
				item
					.attr( "aria-haspopup", "true" )
					.prepend( submenuCaret );
				menu.attr( "aria-labelledby", item.attr( "id" ) );
			} );

		this._addClass( newSubmenus, "ui-menu", "ui-widget ui-widget-content ui-front" );

		menus = submenus.add( this.element );
		items = menus.find( this.options.items );

		// Initialize menu-items containing spaces and/or dashes only as dividers
		items.not( ".ui-menu-item" ).each( function() {
			var item = $( this );
			if ( that._isDivider( item ) ) {
				that._addClass( item, "ui-menu-divider", "ui-widget-content" );
			}
		} );

		// Don't refresh list items that are already adapted
		newItems = items.not( ".ui-menu-item, .ui-menu-divider" );
		newWrappers = newItems.children()
			.not( ".ui-menu" )
				.uniqueId()
				.attr( {
					tabIndex: -1,
					role: this._itemRole()
				} );
		this._addClass( newItems, "ui-menu-item" )
			._addClass( newWrappers, "ui-menu-item-wrapper" );

		// Add aria-disabled attribute to any disabled menu item
		items.filter( ".ui-state-disabled" ).attr( "aria-disabled", "true" );

		// If the active item has been removed, blur the menu
		if ( this.active && !$.contains( this.element[ 0 ], this.active[ 0 ] ) ) {
			this.blur();
		}
	},

	_itemRole: function() {
		return {
			menu: "menuitem",
			listbox: "option"
		}[ this.options.role ];
	},

	_setOption: function( key, value ) {
		if ( key === "icons" ) {
			var icons = this.element.find( ".ui-menu-icon" );
			this._removeClass( icons, null, this.options.icons.submenu )
				._addClass( icons, null, value.submenu );
		}
		this._super( key, value );
	},

	_setOptionDisabled: function( value ) {
		this._super( value );

		this.element.attr( "aria-disabled", String( value ) );
		this._toggleClass( null, "ui-state-disabled", !!value );
	},

	focus: function( event, item ) {
		var nested, focused, activeParent;
		this.blur( event, event && event.type === "focus" );

		this._scrollIntoView( item );

		this.active = item.first();

		focused = this.active.children( ".ui-menu-item-wrapper" );
		this._addClass( focused, null, "ui-state-active" );

		// Only update aria-activedescendant if there's a role
		// otherwise we assume focus is managed elsewhere
		if ( this.options.role ) {
			this.element.attr( "aria-activedescendant", focused.attr( "id" ) );
		}

		// Highlight active parent menu item, if any
		activeParent = this.active
			.parent()
				.closest( ".ui-menu-item" )
					.children( ".ui-menu-item-wrapper" );
		this._addClass( activeParent, null, "ui-state-active" );

		if ( event && event.type === "keydown" ) {
			this._close();
		} else {
			this.timer = this._delay( function() {
				this._close();
			}, this.delay );
		}

		nested = item.children( ".ui-menu" );
		if ( nested.length && event && ( /^mouse/.test( event.type ) ) ) {
			this._startOpening( nested );
		}
		this.activeMenu = item.parent();

		this._trigger( "focus", event, { item: item } );
	},

	_scrollIntoView: function( item ) {
		var borderTop, paddingTop, offset, scroll, elementHeight, itemHeight;
		if ( this._hasScroll() ) {
			borderTop = parseFloat( $.css( this.activeMenu[ 0 ], "borderTopWidth" ) ) || 0;
			paddingTop = parseFloat( $.css( this.activeMenu[ 0 ], "paddingTop" ) ) || 0;
			offset = item.offset().top - this.activeMenu.offset().top - borderTop - paddingTop;
			scroll = this.activeMenu.scrollTop();
			elementHeight = this.activeMenu.height();
			itemHeight = item.outerHeight();

			if ( offset < 0 ) {
				this.activeMenu.scrollTop( scroll + offset );
			} else if ( offset + itemHeight > elementHeight ) {
				this.activeMenu.scrollTop( scroll + offset - elementHeight + itemHeight );
			}
		}
	},

	blur: function( event, fromFocus ) {
		if ( !fromFocus ) {
			clearTimeout( this.timer );
		}

		if ( !this.active ) {
			return;
		}

		this._removeClass( this.active.children( ".ui-menu-item-wrapper" ),
			null, "ui-state-active" );

		this._trigger( "blur", event, { item: this.active } );
		this.active = null;
	},

	_startOpening: function( submenu ) {
		clearTimeout( this.timer );

		// Don't open if already open fixes a Firefox bug that caused a .5 pixel
		// shift in the submenu position when mousing over the caret icon
		if ( submenu.attr( "aria-hidden" ) !== "true" ) {
			return;
		}

		this.timer = this._delay( function() {
			this._close();
			this._open( submenu );
		}, this.delay );
	},

	_open: function( submenu ) {
		var position = $.extend( {
			of: this.active
		}, this.options.position );

		clearTimeout( this.timer );
		this.element.find( ".ui-menu" ).not( submenu.parents( ".ui-menu" ) )
			.hide()
			.attr( "aria-hidden", "true" );

		submenu
			.show()
			.removeAttr( "aria-hidden" )
			.attr( "aria-expanded", "true" )
			.position( position );
	},

	collapseAll: function( event, all ) {
		clearTimeout( this.timer );
		this.timer = this._delay( function() {

			// If we were passed an event, look for the submenu that contains the event
			var currentMenu = all ? this.element :
				$( event && event.target ).closest( this.element.find( ".ui-menu" ) );

			// If we found no valid submenu ancestor, use the main menu to close all
			// sub menus anyway
			if ( !currentMenu.length ) {
				currentMenu = this.element;
			}

			this._close( currentMenu );

			this.blur( event );

			// Work around active item staying active after menu is blurred
			this._removeClass( currentMenu.find( ".ui-state-active" ), null, "ui-state-active" );

			this.activeMenu = currentMenu;
		}, this.delay );
	},

	// With no arguments, closes the currently active menu - if nothing is active
	// it closes all menus.  If passed an argument, it will search for menus BELOW
	_close: function( startMenu ) {
		if ( !startMenu ) {
			startMenu = this.active ? this.active.parent() : this.element;
		}

		startMenu.find( ".ui-menu" )
			.hide()
			.attr( "aria-hidden", "true" )
			.attr( "aria-expanded", "false" );
	},

	_closeOnDocumentClick: function( event ) {
		return !$( event.target ).closest( ".ui-menu" ).length;
	},

	_isDivider: function( item ) {

		// Match hyphen, em dash, en dash
		return !/[^\-\u2014\u2013\s]/.test( item.text() );
	},

	collapse: function( event ) {
		var newItem = this.active &&
			this.active.parent().closest( ".ui-menu-item", this.element );
		if ( newItem && newItem.length ) {
			this._close();
			this.focus( event, newItem );
		}
	},

	expand: function( event ) {
		var newItem = this.active &&
			this.active
				.children( ".ui-menu " )
					.find( this.options.items )
						.first();

		if ( newItem && newItem.length ) {
			this._open( newItem.parent() );

			// Delay so Firefox will not hide activedescendant change in expanding submenu from AT
			this._delay( function() {
				this.focus( event, newItem );
			} );
		}
	},

	next: function( event ) {
		this._move( "next", "first", event );
	},

	previous: function( event ) {
		this._move( "prev", "last", event );
	},

	isFirstItem: function() {
		return this.active && !this.active.prevAll( ".ui-menu-item" ).length;
	},

	isLastItem: function() {
		return this.active && !this.active.nextAll( ".ui-menu-item" ).length;
	},

	_move: function( direction, filter, event ) {
		var next;
		if ( this.active ) {
			if ( direction === "first" || direction === "last" ) {
				next = this.active
					[ direction === "first" ? "prevAll" : "nextAll" ]( ".ui-menu-item" )
					.eq( -1 );
			} else {
				next = this.active
					[ direction + "All" ]( ".ui-menu-item" )
					.eq( 0 );
			}
		}
		if ( !next || !next.length || !this.active ) {
			next = this.activeMenu.find( this.options.items )[ filter ]();
		}

		this.focus( event, next );
	},

	nextPage: function( event ) {
		var item, base, height;

		if ( !this.active ) {
			this.next( event );
			return;
		}
		if ( this.isLastItem() ) {
			return;
		}
		if ( this._hasScroll() ) {
			base = this.active.offset().top;
			height = this.element.height();
			this.active.nextAll( ".ui-menu-item" ).each( function() {
				item = $( this );
				return item.offset().top - base - height < 0;
			} );

			this.focus( event, item );
		} else {
			this.focus( event, this.activeMenu.find( this.options.items )
				[ !this.active ? "first" : "last" ]() );
		}
	},

	previousPage: function( event ) {
		var item, base, height;
		if ( !this.active ) {
			this.next( event );
			return;
		}
		if ( this.isFirstItem() ) {
			return;
		}
		if ( this._hasScroll() ) {
			base = this.active.offset().top;
			height = this.element.height();
			this.active.prevAll( ".ui-menu-item" ).each( function() {
				item = $( this );
				return item.offset().top - base + height > 0;
			} );

			this.focus( event, item );
		} else {
			this.focus( event, this.activeMenu.find( this.options.items ).first() );
		}
	},

	_hasScroll: function() {
		return this.element.outerHeight() < this.element.prop( "scrollHeight" );
	},

	select: function( event ) {

		// TODO: It should never be possible to not have an active item at this
		// point, but the tests don't trigger mouseenter before click.
		this.active = this.active || $( event.target ).closest( ".ui-menu-item" );
		var ui = { item: this.active };
		if ( !this.active.has( ".ui-menu" ).length ) {
			this.collapseAll( event, true );
		}
		this._trigger( "select", event, ui );
	},

	_filterMenuItems: function( character ) {
		var escapedCharacter = character.replace( /[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&" ),
			regex = new RegExp( "^" + escapedCharacter, "i" );

		return this.activeMenu
			.find( this.options.items )

				// Only match on items, not dividers or other content (#10571)
				.filter( ".ui-menu-item" )
					.filter( function() {
						return regex.test(
							$.trim( $( this ).children( ".ui-menu-item-wrapper" ).text() ) );
					} );
	}
} );


//>>label: Autocomplete
//>>group: Widgets
//>>description: Lists suggested words as the user is typing.
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/autocomplete.css
//>>css.theme: ../../themes/base/theme.css



$.widget( "ui.autocomplete", {
	version: "1.12.1",
	defaultElement: "<input>",
	options: {
		appendTo: null,
		autoFocus: false,
		delay: 300,
		minLength: 1,
		position: {
			my: "left top",
			at: "left bottom",
			collision: "none"
		},
		source: null,

		// Callbacks
		change: null,
		close: null,
		focus: null,
		open: null,
		response: null,
		search: null,
		select: null
	},

	requestIndex: 0,
	pending: 0,

	_create: function() {

		// Some browsers only repeat keydown events, not keypress events,
		// so we use the suppressKeyPress flag to determine if we've already
		// handled the keydown event. #7269
		// Unfortunately the code for & in keypress is the same as the up arrow,
		// so we use the suppressKeyPressRepeat flag to avoid handling keypress
		// events when we know the keydown event was used to modify the
		// search term. #7799
		var suppressKeyPress, suppressKeyPressRepeat, suppressInput,
			nodeName = this.element[ 0 ].nodeName.toLowerCase(),
			isTextarea = nodeName === "textarea",
			isInput = nodeName === "input";

		// Textareas are always multi-line
		// Inputs are always single-line, even if inside a contentEditable element
		// IE also treats inputs as contentEditable
		// All other element types are determined by whether or not they're contentEditable
		this.isMultiLine = isTextarea || !isInput && this._isContentEditable( this.element );

		this.valueMethod = this.element[ isTextarea || isInput ? "val" : "text" ];
		this.isNewMenu = true;

		this._addClass( "ui-autocomplete-input" );
		this.element.attr( "autocomplete", "off" );

		this._on( this.element, {
			keydown: function( event ) {
				if ( this.element.prop( "readOnly" ) ) {
					suppressKeyPress = true;
					suppressInput = true;
					suppressKeyPressRepeat = true;
					return;
				}

				suppressKeyPress = false;
				suppressInput = false;
				suppressKeyPressRepeat = false;
				var keyCode = $.ui.keyCode;
				switch ( event.keyCode ) {
				case keyCode.PAGE_UP:
					suppressKeyPress = true;
					this._move( "previousPage", event );
					break;
				case keyCode.PAGE_DOWN:
					suppressKeyPress = true;
					this._move( "nextPage", event );
					break;
				case keyCode.UP:
					suppressKeyPress = true;
					this._keyEvent( "previous", event );
					break;
				case keyCode.DOWN:
					suppressKeyPress = true;
					this._keyEvent( "next", event );
					break;
				case keyCode.ENTER:

					// when menu is open and has focus
					if ( this.menu.active ) {

						// #6055 - Opera still allows the keypress to occur
						// which causes forms to submit
						suppressKeyPress = true;
						event.preventDefault();
						this.menu.select( event );
					}
					break;
				case keyCode.TAB:
					if ( this.menu.active ) {
						this.menu.select( event );
					}
					break;
				case keyCode.ESCAPE:
					if ( this.menu.element.is( ":visible" ) ) {
						if ( !this.isMultiLine ) {
							this._value( this.term );
						}
						this.close( event );

						// Different browsers have different default behavior for escape
						// Single press can mean undo or clear
						// Double press in IE means clear the whole form
						event.preventDefault();
					}
					break;
				default:
					suppressKeyPressRepeat = true;

					// search timeout should be triggered before the input value is changed
					this._searchTimeout( event );
					break;
				}
			},
			keypress: function( event ) {
				if ( suppressKeyPress ) {
					suppressKeyPress = false;
					if ( !this.isMultiLine || this.menu.element.is( ":visible" ) ) {
						event.preventDefault();
					}
					return;
				}
				if ( suppressKeyPressRepeat ) {
					return;
				}

				// Replicate some key handlers to allow them to repeat in Firefox and Opera
				var keyCode = $.ui.keyCode;
				switch ( event.keyCode ) {
				case keyCode.PAGE_UP:
					this._move( "previousPage", event );
					break;
				case keyCode.PAGE_DOWN:
					this._move( "nextPage", event );
					break;
				case keyCode.UP:
					this._keyEvent( "previous", event );
					break;
				case keyCode.DOWN:
					this._keyEvent( "next", event );
					break;
				}
			},
			input: function( event ) {
				if ( suppressInput ) {
					suppressInput = false;
					event.preventDefault();
					return;
				}
				this._searchTimeout( event );
			},
			focus: function() {
				this.selectedItem = null;
				this.previous = this._value();
			},
			blur: function( event ) {
				if ( this.cancelBlur ) {
					delete this.cancelBlur;
					return;
				}

				clearTimeout( this.searching );
				this.close( event );
				this._change( event );
			}
		} );

		this._initSource();
		this.menu = $( "<ul>" )
			.appendTo( this._appendTo() )
			.menu( {

				// disable ARIA support, the live region takes care of that
				role: null
			} )
			.hide()
			.menu( "instance" );

		this._addClass( this.menu.element, "ui-autocomplete", "ui-front" );
		this._on( this.menu.element, {
			mousedown: function( event ) {

				// prevent moving focus out of the text field
				event.preventDefault();

				// IE doesn't prevent moving focus even with event.preventDefault()
				// so we set a flag to know when we should ignore the blur event
				this.cancelBlur = true;
				this._delay( function() {
					delete this.cancelBlur;

					// Support: IE 8 only
					// Right clicking a menu item or selecting text from the menu items will
					// result in focus moving out of the input. However, we've already received
					// and ignored the blur event because of the cancelBlur flag set above. So
					// we restore focus to ensure that the menu closes properly based on the user's
					// next actions.
					if ( this.element[ 0 ] !== $.ui.safeActiveElement( this.document[ 0 ] ) ) {
						this.element.trigger( "focus" );
					}
				} );
			},
			menufocus: function( event, ui ) {
				var label, item;

				// support: Firefox
				// Prevent accidental activation of menu items in Firefox (#7024 #9118)
				if ( this.isNewMenu ) {
					this.isNewMenu = false;
					if ( event.originalEvent && /^mouse/.test( event.originalEvent.type ) ) {
						this.menu.blur();

						this.document.one( "mousemove", function() {
							$( event.target ).trigger( event.originalEvent );
						} );

						return;
					}
				}

				item = ui.item.data( "ui-autocomplete-item" );
				if ( false !== this._trigger( "focus", event, { item: item } ) ) {

					// use value to match what will end up in the input, if it was a key event
					if ( event.originalEvent && /^key/.test( event.originalEvent.type ) ) {
						this._value( item.value );
					}
				}

				// Announce the value in the liveRegion
				label = ui.item.attr( "aria-label" ) || item.value;
				if ( label && $.trim( label ).length ) {
					this.liveRegion.children().hide();
					$( "<div>" ).text( label ).appendTo( this.liveRegion );
				}
			},
			menuselect: function( event, ui ) {
				var item = ui.item.data( "ui-autocomplete-item" ),
					previous = this.previous;

				// Only trigger when focus was lost (click on menu)
				if ( this.element[ 0 ] !== $.ui.safeActiveElement( this.document[ 0 ] ) ) {
					this.element.trigger( "focus" );
					this.previous = previous;

					// #6109 - IE triggers two focus events and the second
					// is asynchronous, so we need to reset the previous
					// term synchronously and asynchronously :-(
					this._delay( function() {
						this.previous = previous;
						this.selectedItem = item;
					} );
				}

				if ( false !== this._trigger( "select", event, { item: item } ) ) {
					this._value( item.value );
				}

				// reset the term after the select event
				// this allows custom select handling to work properly
				this.term = this._value();

				this.close( event );
				this.selectedItem = item;
			}
		} );

		this.liveRegion = $( "<div>", {
			role: "status",
			"aria-live": "assertive",
			"aria-relevant": "additions"
		} )
			.appendTo( this.document[ 0 ].body );

		this._addClass( this.liveRegion, null, "ui-helper-hidden-accessible" );

		// Turning off autocomplete prevents the browser from remembering the
		// value when navigating through history, so we re-enable autocomplete
		// if the page is unloaded before the widget is destroyed. #7790
		this._on( this.window, {
			beforeunload: function() {
				this.element.removeAttr( "autocomplete" );
			}
		} );
	},

	_destroy: function() {
		clearTimeout( this.searching );
		this.element.removeAttr( "autocomplete" );
		this.menu.element.remove();
		this.liveRegion.remove();
	},

	_setOption: function( key, value ) {
		this._super( key, value );
		if ( key === "source" ) {
			this._initSource();
		}
		if ( key === "appendTo" ) {
			this.menu.element.appendTo( this._appendTo() );
		}
		if ( key === "disabled" && value && this.xhr ) {
			this.xhr.abort();
		}
	},

	_isEventTargetInWidget: function( event ) {
		var menuElement = this.menu.element[ 0 ];

		return event.target === this.element[ 0 ] ||
			event.target === menuElement ||
			$.contains( menuElement, event.target );
	},

	_closeOnClickOutside: function( event ) {
		if ( !this._isEventTargetInWidget( event ) ) {
			this.close();
		}
	},

	_appendTo: function() {
		var element = this.options.appendTo;

		if ( element ) {
			element = element.jquery || element.nodeType ?
				$( element ) :
				this.document.find( element ).eq( 0 );
		}

		if ( !element || !element[ 0 ] ) {
			element = this.element.closest( ".ui-front, dialog" );
		}

		if ( !element.length ) {
			element = this.document[ 0 ].body;
		}

		return element;
	},

	_initSource: function() {
		var array, url,
			that = this;
		if ( $.isArray( this.options.source ) ) {
			array = this.options.source;
			this.source = function( request, response ) {
				response( $.ui.autocomplete.filter( array, request.term ) );
			};
		} else if ( typeof this.options.source === "string" ) {
			url = this.options.source;
			this.source = function( request, response ) {
				if ( that.xhr ) {
					that.xhr.abort();
				}
				that.xhr = $.ajax( {
					url: url,
					data: request,
					dataType: "json",
					success: function( data ) {
						response( data );
					},
					error: function() {
						response( [] );
					}
				} );
			};
		} else {
			this.source = this.options.source;
		}
	},

	_searchTimeout: function( event ) {
		clearTimeout( this.searching );
		this.searching = this._delay( function() {

			// Search if the value has changed, or if the user retypes the same value (see #7434)
			var equalValues = this.term === this._value(),
				menuVisible = this.menu.element.is( ":visible" ),
				modifierKey = event.altKey || event.ctrlKey || event.metaKey || event.shiftKey;

			if ( !equalValues || ( equalValues && !menuVisible && !modifierKey ) ) {
				this.selectedItem = null;
				this.search( null, event );
			}
		}, this.options.delay );
	},

	search: function( value, event ) {
		value = value != null ? value : this._value();

		// Always save the actual value, not the one passed as an argument
		this.term = this._value();

		if ( value.length < this.options.minLength ) {
			return this.close( event );
		}

		if ( this._trigger( "search", event ) === false ) {
			return;
		}

		return this._search( value );
	},

	_search: function( value ) {
		this.pending++;
		this._addClass( "ui-autocomplete-loading" );
		this.cancelSearch = false;

		this.source( { term: value }, this._response() );
	},

	_response: function() {
		var index = ++this.requestIndex;

		return $.proxy( function( content ) {
			if ( index === this.requestIndex ) {
				this.__response( content );
			}

			this.pending--;
			if ( !this.pending ) {
				this._removeClass( "ui-autocomplete-loading" );
			}
		}, this );
	},

	__response: function( content ) {
		if ( content ) {
			content = this._normalize( content );
		}
		this._trigger( "response", null, { content: content } );
		if ( !this.options.disabled && content && content.length && !this.cancelSearch ) {
			this._suggest( content );
			this._trigger( "open" );
		} else {

			// use ._close() instead of .close() so we don't cancel future searches
			this._close();
		}
	},

	close: function( event ) {
		this.cancelSearch = true;
		this._close( event );
	},

	_close: function( event ) {

		// Remove the handler that closes the menu on outside clicks
		this._off( this.document, "mousedown" );

		if ( this.menu.element.is( ":visible" ) ) {
			this.menu.element.hide();
			this.menu.blur();
			this.isNewMenu = true;
			this._trigger( "close", event );
		}
	},

	_change: function( event ) {
		if ( this.previous !== this._value() ) {
			this._trigger( "change", event, { item: this.selectedItem } );
		}
	},

	_normalize: function( items ) {

		// assume all items have the right format when the first item is complete
		if ( items.length && items[ 0 ].label && items[ 0 ].value ) {
			return items;
		}
		return $.map( items, function( item ) {
			if ( typeof item === "string" ) {
				return {
					label: item,
					value: item
				};
			}
			return $.extend( {}, item, {
				label: item.label || item.value,
				value: item.value || item.label
			} );
		} );
	},

	_suggest: function( items ) {
		var ul = this.menu.element.empty();
		this._renderMenu( ul, items );
		this.isNewMenu = true;
		this.menu.refresh();

		// Size and position menu
		ul.show();
		this._resizeMenu();
		ul.position( $.extend( {
			of: this.element
		}, this.options.position ) );

		if ( this.options.autoFocus ) {
			this.menu.next();
		}

		// Listen for interactions outside of the widget (#6642)
		this._on( this.document, {
			mousedown: "_closeOnClickOutside"
		} );
	},

	_resizeMenu: function() {
		var ul = this.menu.element;
		ul.outerWidth( Math.max(

			// Firefox wraps long text (possibly a rounding bug)
			// so we add 1px to avoid the wrapping (#7513)
			ul.width( "" ).outerWidth() + 1,
			this.element.outerWidth()
		) );
	},

	_renderMenu: function( ul, items ) {
		var that = this;
		$.each( items, function( index, item ) {
			that._renderItemData( ul, item );
		} );
	},

	_renderItemData: function( ul, item ) {
		return this._renderItem( ul, item ).data( "ui-autocomplete-item", item );
	},

	_renderItem: function( ul, item ) {
		return $( "<li>" )
			.append( $( "<div>" ).text( item.label ) )
			.appendTo( ul );
	},

	_move: function( direction, event ) {
		if ( !this.menu.element.is( ":visible" ) ) {
			this.search( null, event );
			return;
		}
		if ( this.menu.isFirstItem() && /^previous/.test( direction ) ||
				this.menu.isLastItem() && /^next/.test( direction ) ) {

			if ( !this.isMultiLine ) {
				this._value( this.term );
			}

			this.menu.blur();
			return;
		}
		this.menu[ direction ]( event );
	},

	widget: function() {
		return this.menu.element;
	},

	_value: function() {
		return this.valueMethod.apply( this.element, arguments );
	},

	_keyEvent: function( keyEvent, event ) {
		if ( !this.isMultiLine || this.menu.element.is( ":visible" ) ) {
			this._move( keyEvent, event );

			// Prevents moving cursor to beginning/end of the text field in some browsers
			event.preventDefault();
		}
	},

	// Support: Chrome <=50
	// We should be able to just use this.element.prop( "isContentEditable" )
	// but hidden elements always report false in Chrome.
	// https://code.google.com/p/chromium/issues/detail?id=313082
	_isContentEditable: function( element ) {
		if ( !element.length ) {
			return false;
		}

		var editable = element.prop( "contentEditable" );

		if ( editable === "inherit" ) {
		  return this._isContentEditable( element.parent() );
		}

		return editable === "true";
	}
} );

$.extend( $.ui.autocomplete, {
	escapeRegex: function( value ) {
		return value.replace( /[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&" );
	},
	filter: function( array, term ) {
		var matcher = new RegExp( $.ui.autocomplete.escapeRegex( term ), "i" );
		return $.grep( array, function( value ) {
			return matcher.test( value.label || value.value || value );
		} );
	}
} );

// Live region extension, adding a `messages` option
// NOTE: This is an experimental API. We are still investigating
// a full solution for string manipulation and internationalization.
$.widget( "ui.autocomplete", $.ui.autocomplete, {
	options: {
		messages: {
			noResults: "No search results.",
			results: function( amount ) {
				return amount + ( amount > 1 ? " results are" : " result is" ) +
					" available, use up and down arrow keys to navigate.";
			}
		}
	},

	__response: function( content ) {
		var message;
		this._superApply( arguments );
		if ( this.options.disabled || this.cancelSearch ) {
			return;
		}
		if ( content && content.length ) {
			message = this.options.messages.results( content.length );
		} else {
			message = this.options.messages.noResults;
		}
		this.liveRegion.children().hide();
		$( "<div>" ).text( message ).appendTo( this.liveRegion );
	}
} );

var widgetsAutocomplete = $.ui.autocomplete;



//>>label: Controlgroup
//>>group: Widgets
//>>description: Visually groups form control widgets
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/controlgroup.css
//>>css.theme: ../../themes/base/theme.css


var controlgroupCornerRegex = /ui-corner-([a-z]){2,6}/g;

var widgetsControlgroup = $.widget( "ui.controlgroup", {
	version: "1.12.1",
	defaultElement: "<div>",
	options: {
		direction: "horizontal",
		disabled: null,
		onlyVisible: true,
		items: {
			"button": "input[type=button], input[type=submit], input[type=reset], button, a",
			"controlgroupLabel": ".ui-controlgroup-label",
			"checkboxradio": "input[type='checkbox'], input[type='radio']",
			"selectmenu": "select",
			"spinner": ".ui-spinner-input"
		}
	},

	_create: function() {
		this._enhance();
	},

	// To support the enhanced option in jQuery Mobile, we isolate DOM manipulation
	_enhance: function() {
		this.element.attr( "role", "toolbar" );
		this.refresh();
	},

	_destroy: function() {
		this._callChildMethod( "destroy" );
		this.childWidgets.removeData( "ui-controlgroup-data" );
		this.element.removeAttr( "role" );
		if ( this.options.items.controlgroupLabel ) {
			this.element
				.find( this.options.items.controlgroupLabel )
				.find( ".ui-controlgroup-label-contents" )
				.contents().unwrap();
		}
	},

	_initWidgets: function() {
		var that = this,
			childWidgets = [];

		// First we iterate over each of the items options
		$.each( this.options.items, function( widget, selector ) {
			var labels;
			var options = {};

			// Make sure the widget has a selector set
			if ( !selector ) {
				return;
			}

			if ( widget === "controlgroupLabel" ) {
				labels = that.element.find( selector );
				labels.each( function() {
					var element = $( this );

					if ( element.children( ".ui-controlgroup-label-contents" ).length ) {
						return;
					}
					element.contents()
						.wrapAll( "<span class='ui-controlgroup-label-contents'></span>" );
				} );
				that._addClass( labels, null, "ui-widget ui-widget-content ui-state-default" );
				childWidgets = childWidgets.concat( labels.get() );
				return;
			}

			// Make sure the widget actually exists
			if ( !$.fn[ widget ] ) {
				return;
			}

			// We assume everything is in the middle to start because we can't determine
			// first / last elements until all enhancments are done.
			if ( that[ "_" + widget + "Options" ] ) {
				options = that[ "_" + widget + "Options" ]( "middle" );
			} else {
				options = { classes: {} };
			}

			// Find instances of this widget inside controlgroup and init them
			that.element
				.find( selector )
				.each( function() {
					var element = $( this );
					var instance = element[ widget ]( "instance" );

					// We need to clone the default options for this type of widget to avoid
					// polluting the variable options which has a wider scope than a single widget.
					var instanceOptions = $.widget.extend( {}, options );

					// If the button is the child of a spinner ignore it
					// TODO: Find a more generic solution
					if ( widget === "button" && element.parent( ".ui-spinner" ).length ) {
						return;
					}

					// Create the widget if it doesn't exist
					if ( !instance ) {
						instance = element[ widget ]()[ widget ]( "instance" );
					}
					if ( instance ) {
						instanceOptions.classes =
							that._resolveClassesValues( instanceOptions.classes, instance );
					}
					element[ widget ]( instanceOptions );

					// Store an instance of the controlgroup to be able to reference
					// from the outermost element for changing options and refresh
					var widgetElement = element[ widget ]( "widget" );
					$.data( widgetElement[ 0 ], "ui-controlgroup-data",
						instance ? instance : element[ widget ]( "instance" ) );

					childWidgets.push( widgetElement[ 0 ] );
				} );
		} );

		this.childWidgets = $( $.unique( childWidgets ) );
		this._addClass( this.childWidgets, "ui-controlgroup-item" );
	},

	_callChildMethod: function( method ) {
		this.childWidgets.each( function() {
			var element = $( this ),
				data = element.data( "ui-controlgroup-data" );
			if ( data && data[ method ] ) {
				data[ method ]();
			}
		} );
	},

	_updateCornerClass: function( element, position ) {
		var remove = "ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all";
		var add = this._buildSimpleOptions( position, "label" ).classes.label;

		this._removeClass( element, null, remove );
		this._addClass( element, null, add );
	},

	_buildSimpleOptions: function( position, key ) {
		var direction = this.options.direction === "vertical";
		var result = {
			classes: {}
		};
		result.classes[ key ] = {
			"middle": "",
			"first": "ui-corner-" + ( direction ? "top" : "left" ),
			"last": "ui-corner-" + ( direction ? "bottom" : "right" ),
			"only": "ui-corner-all"
		}[ position ];

		return result;
	},

	_spinnerOptions: function( position ) {
		var options = this._buildSimpleOptions( position, "ui-spinner" );

		options.classes[ "ui-spinner-up" ] = "";
		options.classes[ "ui-spinner-down" ] = "";

		return options;
	},

	_buttonOptions: function( position ) {
		return this._buildSimpleOptions( position, "ui-button" );
	},

	_checkboxradioOptions: function( position ) {
		return this._buildSimpleOptions( position, "ui-checkboxradio-label" );
	},

	_selectmenuOptions: function( position ) {
		var direction = this.options.direction === "vertical";
		return {
			width: direction ? "auto" : false,
			classes: {
				middle: {
					"ui-selectmenu-button-open": "",
					"ui-selectmenu-button-closed": ""
				},
				first: {
					"ui-selectmenu-button-open": "ui-corner-" + ( direction ? "top" : "tl" ),
					"ui-selectmenu-button-closed": "ui-corner-" + ( direction ? "top" : "left" )
				},
				last: {
					"ui-selectmenu-button-open": direction ? "" : "ui-corner-tr",
					"ui-selectmenu-button-closed": "ui-corner-" + ( direction ? "bottom" : "right" )
				},
				only: {
					"ui-selectmenu-button-open": "ui-corner-top",
					"ui-selectmenu-button-closed": "ui-corner-all"
				}

			}[ position ]
		};
	},

	_resolveClassesValues: function( classes, instance ) {
		var result = {};
		$.each( classes, function( key ) {
			var current = instance.options.classes[ key ] || "";
			current = $.trim( current.replace( controlgroupCornerRegex, "" ) );
			result[ key ] = ( current + " " + classes[ key ] ).replace( /\s+/g, " " );
		} );
		return result;
	},

	_setOption: function( key, value ) {
		if ( key === "direction" ) {
			this._removeClass( "ui-controlgroup-" + this.options.direction );
		}

		this._super( key, value );
		if ( key === "disabled" ) {
			this._callChildMethod( value ? "disable" : "enable" );
			return;
		}

		this.refresh();
	},

	refresh: function() {
		var children,
			that = this;

		this._addClass( "ui-controlgroup ui-controlgroup-" + this.options.direction );

		if ( this.options.direction === "horizontal" ) {
			this._addClass( null, "ui-helper-clearfix" );
		}
		this._initWidgets();

		children = this.childWidgets;

		// We filter here because we need to track all childWidgets not just the visible ones
		if ( this.options.onlyVisible ) {
			children = children.filter( ":visible" );
		}

		if ( children.length ) {

			// We do this last because we need to make sure all enhancment is done
			// before determining first and last
			$.each( [ "first", "last" ], function( index, value ) {
				var instance = children[ value ]().data( "ui-controlgroup-data" );

				if ( instance && that[ "_" + instance.widgetName + "Options" ] ) {
					var options = that[ "_" + instance.widgetName + "Options" ](
						children.length === 1 ? "only" : value
					);
					options.classes = that._resolveClassesValues( options.classes, instance );
					instance.element[ instance.widgetName ]( options );
				} else {
					that._updateCornerClass( children[ value ](), value );
				}
			} );

			// Finally call the refresh method on each of the child widgets.
			this._callChildMethod( "refresh" );
		}
	}
} );



//>>label: Checkboxradio
//>>group: Widgets
//>>description: Enhances a form with multiple themeable checkboxes or radio buttons.
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/button.css
//>>css.structure: ../../themes/base/checkboxradio.css
//>>css.theme: ../../themes/base/theme.css



$.widget( "ui.checkboxradio", [ $.ui.formResetMixin, {
	version: "1.12.1",
	options: {
		disabled: null,
		label: null,
		icon: true,
		classes: {
			"ui-checkboxradio-label": "ui-corner-all",
			"ui-checkboxradio-icon": "ui-corner-all"
		}
	},

	_getCreateOptions: function() {
		var disabled, labels;
		var that = this;
		var options = this._super() || {};

		// We read the type here, because it makes more sense to throw a element type error first,
		// rather then the error for lack of a label. Often if its the wrong type, it
		// won't have a label (e.g. calling on a div, btn, etc)
		this._readType();

		labels = this.element.labels();

		// If there are multiple labels, use the last one
		this.label = $( labels[ labels.length - 1 ] );
		if ( !this.label.length ) {
			$.error( "No label found for checkboxradio widget" );
		}

		this.originalLabel = "";

		// We need to get the label text but this may also need to make sure it does not contain the
		// input itself.
		this.label.contents().not( this.element[ 0 ] ).each( function() {

			// The label contents could be text, html, or a mix. We concat each element to get a
			// string representation of the label, without the input as part of it.
			that.originalLabel += this.nodeType === 3 ? $( this ).text() : this.outerHTML;
		} );

		// Set the label option if we found label text
		if ( this.originalLabel ) {
			options.label = this.originalLabel;
		}

		disabled = this.element[ 0 ].disabled;
		if ( disabled != null ) {
			options.disabled = disabled;
		}
		return options;
	},

	_create: function() {
		var checked = this.element[ 0 ].checked;

		this._bindFormResetHandler();

		if ( this.options.disabled == null ) {
			this.options.disabled = this.element[ 0 ].disabled;
		}

		this._setOption( "disabled", this.options.disabled );
		this._addClass( "ui-checkboxradio", "ui-helper-hidden-accessible" );
		this._addClass( this.label, "ui-checkboxradio-label", "ui-button ui-widget" );

		if ( this.type === "radio" ) {
			this._addClass( this.label, "ui-checkboxradio-radio-label" );
		}

		if ( this.options.label && this.options.label !== this.originalLabel ) {
			this._updateLabel();
		} else if ( this.originalLabel ) {
			this.options.label = this.originalLabel;
		}

		this._enhance();

		if ( checked ) {
			this._addClass( this.label, "ui-checkboxradio-checked", "ui-state-active" );
			if ( this.icon ) {
				this._addClass( this.icon, null, "ui-state-hover" );
			}
		}

		this._on( {
			change: "_toggleClasses",
			focus: function() {
				this._addClass( this.label, null, "ui-state-focus ui-visual-focus" );
			},
			blur: function() {
				this._removeClass( this.label, null, "ui-state-focus ui-visual-focus" );
			}
		} );
	},

	_readType: function() {
		var nodeName = this.element[ 0 ].nodeName.toLowerCase();
		this.type = this.element[ 0 ].type;
		if ( nodeName !== "input" || !/radio|checkbox/.test( this.type ) ) {
			$.error( "Can't create checkboxradio on element.nodeName=" + nodeName +
				" and element.type=" + this.type );
		}
	},

	// Support jQuery Mobile enhanced option
	_enhance: function() {
		this._updateIcon( this.element[ 0 ].checked );
	},

	widget: function() {
		return this.label;
	},

	_getRadioGroup: function() {
		var group;
		var name = this.element[ 0 ].name;
		var nameSelector = "input[name='" + $.ui.escapeSelector( name ) + "']";

		if ( !name ) {
			return $( [] );
		}

		if ( this.form.length ) {
			group = $( this.form[ 0 ].elements ).filter( nameSelector );
		} else {

			// Not inside a form, check all inputs that also are not inside a form
			group = $( nameSelector ).filter( function() {
				return $( this ).form().length === 0;
			} );
		}

		return group.not( this.element );
	},

	_toggleClasses: function() {
		var checked = this.element[ 0 ].checked;
		this._toggleClass( this.label, "ui-checkboxradio-checked", "ui-state-active", checked );

		if ( this.options.icon && this.type === "checkbox" ) {
			this._toggleClass( this.icon, null, "ui-icon-check ui-state-checked", checked )
				._toggleClass( this.icon, null, "ui-icon-blank", !checked );
		}

		if ( this.type === "radio" ) {
			this._getRadioGroup()
				.each( function() {
					var instance = $( this ).checkboxradio( "instance" );

					if ( instance ) {
						instance._removeClass( instance.label,
							"ui-checkboxradio-checked", "ui-state-active" );
					}
				} );
		}
	},

	_destroy: function() {
		this._unbindFormResetHandler();

		if ( this.icon ) {
			this.icon.remove();
			this.iconSpace.remove();
		}
	},

	_setOption: function( key, value ) {

		// We don't allow the value to be set to nothing
		if ( key === "label" && !value ) {
			return;
		}

		this._super( key, value );

		if ( key === "disabled" ) {
			this._toggleClass( this.label, null, "ui-state-disabled", value );
			this.element[ 0 ].disabled = value;

			// Don't refresh when setting disabled
			return;
		}
		this.refresh();
	},

	_updateIcon: function( checked ) {
		var toAdd = "ui-icon ui-icon-background ";

		if ( this.options.icon ) {
			if ( !this.icon ) {
				this.icon = $( "<span>" );
				this.iconSpace = $( "<span> </span>" );
				this._addClass( this.iconSpace, "ui-checkboxradio-icon-space" );
			}

			if ( this.type === "checkbox" ) {
				toAdd += checked ? "ui-icon-check ui-state-checked" : "ui-icon-blank";
				this._removeClass( this.icon, null, checked ? "ui-icon-blank" : "ui-icon-check" );
			} else {
				toAdd += "ui-icon-blank";
			}
			this._addClass( this.icon, "ui-checkboxradio-icon", toAdd );
			if ( !checked ) {
				this._removeClass( this.icon, null, "ui-icon-check ui-state-checked" );
			}
			this.icon.prependTo( this.label ).after( this.iconSpace );
		} else if ( this.icon !== undefined ) {
			this.icon.remove();
			this.iconSpace.remove();
			delete this.icon;
		}
	},

	_updateLabel: function() {

		// Remove the contents of the label ( minus the icon, icon space, and input )
		var contents = this.label.contents().not( this.element[ 0 ] );
		if ( this.icon ) {
			contents = contents.not( this.icon[ 0 ] );
		}
		if ( this.iconSpace ) {
			contents = contents.not( this.iconSpace[ 0 ] );
		}
		contents.remove();

		this.label.append( this.options.label );
	},

	refresh: function() {
		var checked = this.element[ 0 ].checked,
			isDisabled = this.element[ 0 ].disabled;

		this._updateIcon( checked );
		this._toggleClass( this.label, "ui-checkboxradio-checked", "ui-state-active", checked );
		if ( this.options.label !== null ) {
			this._updateLabel();
		}

		if ( isDisabled !== this.options.disabled ) {
			this._setOptions( { "disabled": isDisabled } );
		}
	}

} ] );

var widgetsCheckboxradio = $.ui.checkboxradio;




//>>label: Button
//>>group: Widgets
//>>description: Enhances a form with themeable buttons.
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/button.css
//>>css.theme: ../../themes/base/theme.css



$.widget( "ui.button", {
	version: "1.12.1",
	defaultElement: "<button>",
	options: {
		classes: {
			"ui-button": "ui-corner-all"
		},
		disabled: null,
		icon: null,
		iconPosition: "beginning",
		label: null,
		showLabel: true
	},

	_getCreateOptions: function() {
		var disabled,

			// This is to support cases like in jQuery Mobile where the base widget does have
			// an implementation of _getCreateOptions
			options = this._super() || {};

		this.isInput = this.element.is( "input" );

		disabled = this.element[ 0 ].disabled;
		if ( disabled != null ) {
			options.disabled = disabled;
		}

		this.originalLabel = this.isInput ? this.element.val() : this.element.html();
		if ( this.originalLabel ) {
			options.label = this.originalLabel;
		}

		return options;
	},

	_create: function() {
		if ( !this.option.showLabel & !this.options.icon ) {
			this.options.showLabel = true;
		}

		// We have to check the option again here even though we did in _getCreateOptions,
		// because null may have been passed on init which would override what was set in
		// _getCreateOptions
		if ( this.options.disabled == null ) {
			this.options.disabled = this.element[ 0 ].disabled || false;
		}

		this.hasTitle = !!this.element.attr( "title" );

		// Check to see if the label needs to be set or if its already correct
		if ( this.options.label && this.options.label !== this.originalLabel ) {
			if ( this.isInput ) {
				this.element.val( this.options.label );
			} else {
				this.element.html( this.options.label );
			}
		}
		this._addClass( "ui-button", "ui-widget" );
		this._setOption( "disabled", this.options.disabled );
		this._enhance();

		if ( this.element.is( "a" ) ) {
			this._on( {
				"keyup": function( event ) {
					if ( event.keyCode === $.ui.keyCode.SPACE ) {
						event.preventDefault();

						// Support: PhantomJS <= 1.9, IE 8 Only
						// If a native click is available use it so we actually cause navigation
						// otherwise just trigger a click event
						if ( this.element[ 0 ].click ) {
							this.element[ 0 ].click();
						} else {
							this.element.trigger( "click" );
						}
					}
				}
			} );
		}
	},

	_enhance: function() {
		if ( !this.element.is( "button" ) ) {
			this.element.attr( "role", "button" );
		}

		if ( this.options.icon ) {
			this._updateIcon( "icon", this.options.icon );
			this._updateTooltip();
		}
	},

	_updateTooltip: function() {
		this.title = this.element.attr( "title" );

		if ( !this.options.showLabel && !this.title ) {
			this.element.attr( "title", this.options.label );
		}
	},

	_updateIcon: function( option, value ) {
		var icon = option !== "iconPosition",
			position = icon ? this.options.iconPosition : value,
			displayBlock = position === "top" || position === "bottom";

		// Create icon
		if ( !this.icon ) {
			this.icon = $( "<span>" );

			this._addClass( this.icon, "ui-button-icon", "ui-icon" );

			if ( !this.options.showLabel ) {
				this._addClass( "ui-button-icon-only" );
			}
		} else if ( icon ) {

			// If we are updating the icon remove the old icon class
			this._removeClass( this.icon, null, this.options.icon );
		}

		// If we are updating the icon add the new icon class
		if ( icon ) {
			this._addClass( this.icon, null, value );
		}

		this._attachIcon( position );

		// If the icon is on top or bottom we need to add the ui-widget-icon-block class and remove
		// the iconSpace if there is one.
		if ( displayBlock ) {
			this._addClass( this.icon, null, "ui-widget-icon-block" );
			if ( this.iconSpace ) {
				this.iconSpace.remove();
			}
		} else {

			// Position is beginning or end so remove the ui-widget-icon-block class and add the
			// space if it does not exist
			if ( !this.iconSpace ) {
				this.iconSpace = $( "<span> </span>" );
				this._addClass( this.iconSpace, "ui-button-icon-space" );
			}
			this._removeClass( this.icon, null, "ui-wiget-icon-block" );
			this._attachIconSpace( position );
		}
	},

	_destroy: function() {
		this.element.removeAttr( "role" );

		if ( this.icon ) {
			this.icon.remove();
		}
		if ( this.iconSpace ) {
			this.iconSpace.remove();
		}
		if ( !this.hasTitle ) {
			this.element.removeAttr( "title" );
		}
	},

	_attachIconSpace: function( iconPosition ) {
		this.icon[ /^(?:end|bottom)/.test( iconPosition ) ? "before" : "after" ]( this.iconSpace );
	},

	_attachIcon: function( iconPosition ) {
		this.element[ /^(?:end|bottom)/.test( iconPosition ) ? "append" : "prepend" ]( this.icon );
	},

	_setOptions: function( options ) {
		var newShowLabel = options.showLabel === undefined ?
				this.options.showLabel :
				options.showLabel,
			newIcon = options.icon === undefined ? this.options.icon : options.icon;

		if ( !newShowLabel && !newIcon ) {
			options.showLabel = true;
		}
		this._super( options );
	},

	_setOption: function( key, value ) {
		if ( key === "icon" ) {
			if ( value ) {
				this._updateIcon( key, value );
			} else if ( this.icon ) {
				this.icon.remove();
				if ( this.iconSpace ) {
					this.iconSpace.remove();
				}
			}
		}

		if ( key === "iconPosition" ) {
			this._updateIcon( key, value );
		}

		// Make sure we can't end up with a button that has neither text nor icon
		if ( key === "showLabel" ) {
				this._toggleClass( "ui-button-icon-only", null, !value );
				this._updateTooltip();
		}

		if ( key === "label" ) {
			if ( this.isInput ) {
				this.element.val( value );
			} else {

				// If there is an icon, append it, else nothing then append the value
				// this avoids removal of the icon when setting label text
				this.element.html( value );
				if ( this.icon ) {
					this._attachIcon( this.options.iconPosition );
					this._attachIconSpace( this.options.iconPosition );
				}
			}
		}

		this._super( key, value );

		if ( key === "disabled" ) {
			this._toggleClass( null, "ui-state-disabled", value );
			this.element[ 0 ].disabled = value;
			if ( value ) {
				this.element.blur();
			}
		}
	},

	refresh: function() {

		// Make sure to only check disabled if its an element that supports this otherwise
		// check for the disabled class to determine state
		var isDisabled = this.element.is( "input, button" ) ?
			this.element[ 0 ].disabled : this.element.hasClass( "ui-button-disabled" );

		if ( isDisabled !== this.options.disabled ) {
			this._setOptions( { disabled: isDisabled } );
		}

		this._updateTooltip();
	}
} );

// DEPRECATED
if ( $.uiBackCompat !== false ) {

	// Text and Icons options
	$.widget( "ui.button", $.ui.button, {
		options: {
			text: true,
			icons: {
				primary: null,
				secondary: null
			}
		},

		_create: function() {
			if ( this.options.showLabel && !this.options.text ) {
				this.options.showLabel = this.options.text;
			}
			if ( !this.options.showLabel && this.options.text ) {
				this.options.text = this.options.showLabel;
			}
			if ( !this.options.icon && ( this.options.icons.primary ||
					this.options.icons.secondary ) ) {
				if ( this.options.icons.primary ) {
					this.options.icon = this.options.icons.primary;
				} else {
					this.options.icon = this.options.icons.secondary;
					this.options.iconPosition = "end";
				}
			} else if ( this.options.icon ) {
				this.options.icons.primary = this.options.icon;
			}
			this._super();
		},

		_setOption: function( key, value ) {
			if ( key === "text" ) {
				this._super( "showLabel", value );
				return;
			}
			if ( key === "showLabel" ) {
				this.options.text = value;
			}
			if ( key === "icon" ) {
				this.options.icons.primary = value;
			}
			if ( key === "icons" ) {
				if ( value.primary ) {
					this._super( "icon", value.primary );
					this._super( "iconPosition", "beginning" );
				} else if ( value.secondary ) {
					this._super( "icon", value.secondary );
					this._super( "iconPosition", "end" );
				}
			}
			this._superApply( arguments );
		}
	} );

	$.fn.button = ( function( orig ) {
		return function() {
			if ( !this.length || ( this.length && this[ 0 ].tagName !== "INPUT" ) ||
					( this.length && this[ 0 ].tagName === "INPUT" && (
						this.attr( "type" ) !== "checkbox" && this.attr( "type" ) !== "radio"
					) ) ) {
				return orig.apply( this, arguments );
			}
			if ( !$.ui.checkboxradio ) {
				$.error( "Checkboxradio widget missing" );
			}
			if ( arguments.length === 0 ) {
				return this.checkboxradio( {
					"icon": false
				} );
			}
			return this.checkboxradio.apply( this, arguments );
		};
	} )( $.fn.button );

	$.fn.buttonset = function() {
		if ( !$.ui.controlgroup ) {
			$.error( "Controlgroup widget missing" );
		}
		if ( arguments[ 0 ] === "option" && arguments[ 1 ] === "items" && arguments[ 2 ] ) {
			return this.controlgroup.apply( this,
				[ arguments[ 0 ], "items.button", arguments[ 2 ] ] );
		}
		if ( arguments[ 0 ] === "option" && arguments[ 1 ] === "items" ) {
			return this.controlgroup.apply( this, [ arguments[ 0 ], "items.button" ] );
		}
		if ( typeof arguments[ 0 ] === "object" && arguments[ 0 ].items ) {
			arguments[ 0 ].items = {
				button: arguments[ 0 ].items
			};
		}
		return this.controlgroup.apply( this, arguments );
	};
}

var widgetsButton = $.ui.button;


// jscs:disable maximumLineLength
/* jscs:disable requireCamelCaseOrUpperCaseIdentifiers */


//>>label: Datepicker
//>>group: Widgets
//>>description: Displays a calendar from an input or inline for selecting dates.
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/datepicker.css
//>>css.theme: ../../themes/base/theme.css



$.extend( $.ui, { datepicker: { version: "1.12.1" } } );

var datepicker_instActive;

function datepicker_getZindex( elem ) {
	var position, value;
	while ( elem.length && elem[ 0 ] !== document ) {

		// Ignore z-index if position is set to a value where z-index is ignored by the browser
		// This makes behavior of this function consistent across browsers
		// WebKit always returns auto if the element is positioned
		position = elem.css( "position" );
		if ( position === "absolute" || position === "relative" || position === "fixed" ) {

			// IE returns 0 when zIndex is not specified
			// other browsers return a string
			// we ignore the case of nested elements with an explicit value of 0
			// <div style="z-index: -10;"><div style="z-index: 0;"></div></div>
			value = parseInt( elem.css( "zIndex" ), 10 );
			if ( !isNaN( value ) && value !== 0 ) {
				return value;
			}
		}
		elem = elem.parent();
	}

	return 0;
}
/* Date picker manager.
   Use the singleton instance of this class, $.datepicker, to interact with the date picker.
   Settings for (groups of) date pickers are maintained in an instance object,
   allowing multiple different settings on the same page. */

function Datepicker() {
	this._curInst = null; // The current instance in use
	this._keyEvent = false; // If the last event was a key event
	this._disabledInputs = []; // List of date picker inputs that have been disabled
	this._datepickerShowing = false; // True if the popup picker is showing , false if not
	this._inDialog = false; // True if showing within a "dialog", false if not
	this._mainDivId = "ui-datepicker-div"; // The ID of the main datepicker division
	this._inlineClass = "ui-datepicker-inline"; // The name of the inline marker class
	this._appendClass = "ui-datepicker-append"; // The name of the append marker class
	this._triggerClass = "ui-datepicker-trigger"; // The name of the trigger marker class
	this._dialogClass = "ui-datepicker-dialog"; // The name of the dialog marker class
	this._disableClass = "ui-datepicker-disabled"; // The name of the disabled covering marker class
	this._unselectableClass = "ui-datepicker-unselectable"; // The name of the unselectable cell marker class
	this._currentClass = "ui-datepicker-current-day"; // The name of the current day marker class
	this._dayOverClass = "ui-datepicker-days-cell-over"; // The name of the day hover marker class
	this.regional = []; // Available regional settings, indexed by language code
	this.regional[ "" ] = { // Default regional settings
		closeText: "Done", // Display text for close link
		prevText: "Prev", // Display text for previous month link
		nextText: "Next", // Display text for next month link
		currentText: "Today", // Display text for current month link
		monthNames: [ "January","February","March","April","May","June",
			"July","August","September","October","November","December" ], // Names of months for drop-down and formatting
		monthNamesShort: [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ], // For formatting
		dayNames: [ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" ], // For formatting
		dayNamesShort: [ "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" ], // For formatting
		dayNamesMin: [ "Su","Mo","Tu","We","Th","Fr","Sa" ], // Column headings for days starting at Sunday
		weekHeader: "Wk", // Column header for week of the year
		dateFormat: "mm/dd/yy", // See format options on parseDate
		firstDay: 0, // The first day of the week, Sun = 0, Mon = 1, ...
		isRTL: false, // True if right-to-left language, false if left-to-right
		showMonthAfterYear: false, // True if the year select precedes month, false for month then year
		yearSuffix: "" // Additional text to append to the year in the month headers
	};
	this._defaults = { // Global defaults for all the date picker instances
		showOn: "focus", // "focus" for popup on focus,
			// "button" for trigger button, or "both" for either
		showAnim: "fadeIn", // Name of jQuery animation for popup
		showOptions: {}, // Options for enhanced animations
		defaultDate: null, // Used when field is blank: actual date,
			// +/-number for offset from today, null for today
		appendText: "", // Display text following the input box, e.g. showing the format
		buttonText: "...", // Text for trigger button
		buttonImage: "", // URL for trigger button image
		buttonImageOnly: false, // True if the image appears alone, false if it appears on a button
		hideIfNoPrevNext: false, // True to hide next/previous month links
			// if not applicable, false to just disable them
		navigationAsDateFormat: false, // True if date formatting applied to prev/today/next links
		gotoCurrent: false, // True if today link goes back to current selection instead
		changeMonth: false, // True if month can be selected directly, false if only prev/next
		changeYear: false, // True if year can be selected directly, false if only prev/next
		yearRange: "c-10:c+10", // Range of years to display in drop-down,
			// either relative to today's year (-nn:+nn), relative to currently displayed year
			// (c-nn:c+nn), absolute (nnnn:nnnn), or a combination of the above (nnnn:-n)
		showOtherMonths: false, // True to show dates in other months, false to leave blank
		selectOtherMonths: false, // True to allow selection of dates in other months, false for unselectable
		showWeek: false, // True to show week of the year, false to not show it
		calculateWeek: this.iso8601Week, // How to calculate the week of the year,
			// takes a Date and returns the number of the week for it
		shortYearCutoff: "+10", // Short year values < this are in the current century,
			// > this are in the previous century,
			// string value starting with "+" for current year + value
		minDate: null, // The earliest selectable date, or null for no limit
		maxDate: null, // The latest selectable date, or null for no limit
		duration: "fast", // Duration of display/closure
		beforeShowDay: null, // Function that takes a date and returns an array with
			// [0] = true if selectable, false if not, [1] = custom CSS class name(s) or "",
			// [2] = cell title (optional), e.g. $.datepicker.noWeekends
		beforeShow: null, // Function that takes an input field and
			// returns a set of custom settings for the date picker
		onSelect: null, // Define a callback function when a date is selected
		onChangeMonthYear: null, // Define a callback function when the month or year is changed
		onClose: null, // Define a callback function when the datepicker is closed
		numberOfMonths: 1, // Number of months to show at a time
		showCurrentAtPos: 0, // The position in multipe months at which to show the current month (starting at 0)
		stepMonths: 1, // Number of months to step back/forward
		stepBigMonths: 12, // Number of months to step back/forward for the big links
		altField: "", // Selector for an alternate field to store selected dates into
		altFormat: "", // The date format to use for the alternate field
		constrainInput: true, // The input is constrained by the current date format
		showButtonPanel: false, // True to show button panel, false to not show it
		autoSize: false, // True to size the input for the date format, false to leave as is
		disabled: false // The initial disabled state
	};
	$.extend( this._defaults, this.regional[ "" ] );
	this.regional.en = $.extend( true, {}, this.regional[ "" ] );
	this.regional[ "en-US" ] = $.extend( true, {}, this.regional.en );
	this.dpDiv = datepicker_bindHover( $( "<div id='" + this._mainDivId + "' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>" ) );
}

$.extend( Datepicker.prototype, {
	/* Class name added to elements to indicate already configured with a date picker. */
	markerClassName: "hasDatepicker",

	//Keep track of the maximum number of rows displayed (see #7043)
	maxRows: 4,

	// TODO rename to "widget" when switching to widget factory
	_widgetDatepicker: function() {
		return this.dpDiv;
	},

	/* Override the default settings for all instances of the date picker.
	 * @param  settings  object - the new settings to use as defaults (anonymous object)
	 * @return the manager object
	 */
	setDefaults: function( settings ) {
		datepicker_extendRemove( this._defaults, settings || {} );
		return this;
	},

	/* Attach the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 * @param  settings  object - the new settings to use for this date picker instance (anonymous)
	 */
	_attachDatepicker: function( target, settings ) {
		var nodeName, inline, inst;
		nodeName = target.nodeName.toLowerCase();
		inline = ( nodeName === "div" || nodeName === "span" );
		if ( !target.id ) {
			this.uuid += 1;
			target.id = "dp" + this.uuid;
		}
		inst = this._newInst( $( target ), inline );
		inst.settings = $.extend( {}, settings || {} );
		if ( nodeName === "input" ) {
			this._connectDatepicker( target, inst );
		} else if ( inline ) {
			this._inlineDatepicker( target, inst );
		}
	},

	/* Create a new instance object. */
	_newInst: function( target, inline ) {
		var id = target[ 0 ].id.replace( /([^A-Za-z0-9_\-])/g, "\\\\$1" ); // escape jQuery meta chars
		return { id: id, input: target, // associated target
			selectedDay: 0, selectedMonth: 0, selectedYear: 0, // current selection
			drawMonth: 0, drawYear: 0, // month being drawn
			inline: inline, // is datepicker inline or not
			dpDiv: ( !inline ? this.dpDiv : // presentation div
			datepicker_bindHover( $( "<div class='" + this._inlineClass + " ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>" ) ) ) };
	},

	/* Attach the date picker to an input field. */
	_connectDatepicker: function( target, inst ) {
		var input = $( target );
		inst.append = $( [] );
		inst.trigger = $( [] );
		if ( input.hasClass( this.markerClassName ) ) {
			return;
		}
		this._attachments( input, inst );
		input.addClass( this.markerClassName ).on( "keydown", this._doKeyDown ).
			on( "keypress", this._doKeyPress ).on( "keyup", this._doKeyUp );
		this._autoSize( inst );
		$.data( target, "datepicker", inst );

		//If disabled option is true, disable the datepicker once it has been attached to the input (see ticket #5665)
		if ( inst.settings.disabled ) {
			this._disableDatepicker( target );
		}
	},

	/* Make attachments based on settings. */
	_attachments: function( input, inst ) {
		var showOn, buttonText, buttonImage,
			appendText = this._get( inst, "appendText" ),
			isRTL = this._get( inst, "isRTL" );

		if ( inst.append ) {
			inst.append.remove();
		}
		if ( appendText ) {
			inst.append = $( "<span class='" + this._appendClass + "'>" + appendText + "</span>" );
			input[ isRTL ? "before" : "after" ]( inst.append );
		}

		input.off( "focus", this._showDatepicker );

		if ( inst.trigger ) {
			inst.trigger.remove();
		}

		showOn = this._get( inst, "showOn" );
		if ( showOn === "focus" || showOn === "both" ) { // pop-up date picker when in the marked field
			input.on( "focus", this._showDatepicker );
		}
		if ( showOn === "button" || showOn === "both" ) { // pop-up date picker when button clicked
			buttonText = this._get( inst, "buttonText" );
			buttonImage = this._get( inst, "buttonImage" );
			inst.trigger = $( this._get( inst, "buttonImageOnly" ) ?
				$( "<img/>" ).addClass( this._triggerClass ).
					attr( { src: buttonImage, alt: buttonText, title: buttonText } ) :
				$( "<button type='button'></button>" ).addClass( this._triggerClass ).
					html( !buttonImage ? buttonText : $( "<img/>" ).attr(
					{ src:buttonImage, alt:buttonText, title:buttonText } ) ) );
			input[ isRTL ? "before" : "after" ]( inst.trigger );
			inst.trigger.on( "click", function() {
				if ( $.datepicker._datepickerShowing && $.datepicker._lastInput === input[ 0 ] ) {
					$.datepicker._hideDatepicker();
				} else if ( $.datepicker._datepickerShowing && $.datepicker._lastInput !== input[ 0 ] ) {
					$.datepicker._hideDatepicker();
					$.datepicker._showDatepicker( input[ 0 ] );
				} else {
					$.datepicker._showDatepicker( input[ 0 ] );
				}
				return false;
			} );
		}
	},

	/* Apply the maximum length for the date format. */
	_autoSize: function( inst ) {
		if ( this._get( inst, "autoSize" ) && !inst.inline ) {
			var findMax, max, maxI, i,
				date = new Date( 2009, 12 - 1, 20 ), // Ensure double digits
				dateFormat = this._get( inst, "dateFormat" );

			if ( dateFormat.match( /[DM]/ ) ) {
				findMax = function( names ) {
					max = 0;
					maxI = 0;
					for ( i = 0; i < names.length; i++ ) {
						if ( names[ i ].length > max ) {
							max = names[ i ].length;
							maxI = i;
						}
					}
					return maxI;
				};
				date.setMonth( findMax( this._get( inst, ( dateFormat.match( /MM/ ) ?
					"monthNames" : "monthNamesShort" ) ) ) );
				date.setDate( findMax( this._get( inst, ( dateFormat.match( /DD/ ) ?
					"dayNames" : "dayNamesShort" ) ) ) + 20 - date.getDay() );
			}
			inst.input.attr( "size", this._formatDate( inst, date ).length );
		}
	},

	/* Attach an inline date picker to a div. */
	_inlineDatepicker: function( target, inst ) {
		var divSpan = $( target );
		if ( divSpan.hasClass( this.markerClassName ) ) {
			return;
		}
		divSpan.addClass( this.markerClassName ).append( inst.dpDiv );
		$.data( target, "datepicker", inst );
		this._setDate( inst, this._getDefaultDate( inst ), true );
		this._updateDatepicker( inst );
		this._updateAlternate( inst );

		//If disabled option is true, disable the datepicker before showing it (see ticket #5665)
		if ( inst.settings.disabled ) {
			this._disableDatepicker( target );
		}

		// Set display:block in place of inst.dpDiv.show() which won't work on disconnected elements

		inst.dpDiv.css( "display", "block" );
	},

	/* Pop-up the date picker in a "dialog" box.
	 * @param  input element - ignored
	 * @param  date	string or Date - the initial date to display
	 * @param  onSelect  function - the function to call when a date is selected
	 * @param  settings  object - update the dialog date picker instance's settings (anonymous object)
	 * @param  pos int[2] - coordinates for the dialog's position within the screen or
	 *					event - with x/y coordinates or
	 *					leave empty for default (screen centre)
	 * @return the manager object
	 */
	_dialogDatepicker: function( input, date, onSelect, settings, pos ) {
		var id, browserWidth, browserHeight, scrollX, scrollY,
			inst = this._dialogInst; // internal instance

		if ( !inst ) {
			this.uuid += 1;
			id = "dp" + this.uuid;
			this._dialogInput = $( "<input type='text' id='" + id +
				"' style='position: absolute; top: -100px; width: 0px;'/>" );
			this._dialogInput.on( "keydown", this._doKeyDown );
			$( "body" ).append( this._dialogInput );
			inst = this._dialogInst = this._newInst( this._dialogInput, false );
			inst.settings = {};
			$.data( this._dialogInput[ 0 ], "datepicker", inst );
		}
		datepicker_extendRemove( inst.settings, settings || {} );
		date = ( date && date.constructor === Date ? this._formatDate( inst, date ) : date );
		this._dialogInput.val( date );

		this._pos = ( pos ? ( pos.length ? pos : [ pos.pageX, pos.pageY ] ) : null );
		if ( !this._pos ) {
			browserWidth = document.documentElement.clientWidth;
			browserHeight = document.documentElement.clientHeight;
			scrollX = document.documentElement.scrollLeft || document.body.scrollLeft;
			scrollY = document.documentElement.scrollTop || document.body.scrollTop;
			this._pos = // should use actual width/height below
				[ ( browserWidth / 2 ) - 100 + scrollX, ( browserHeight / 2 ) - 150 + scrollY ];
		}

		// Move input on screen for focus, but hidden behind dialog
		this._dialogInput.css( "left", ( this._pos[ 0 ] + 20 ) + "px" ).css( "top", this._pos[ 1 ] + "px" );
		inst.settings.onSelect = onSelect;
		this._inDialog = true;
		this.dpDiv.addClass( this._dialogClass );
		this._showDatepicker( this._dialogInput[ 0 ] );
		if ( $.blockUI ) {
			$.blockUI( this.dpDiv );
		}
		$.data( this._dialogInput[ 0 ], "datepicker", inst );
		return this;
	},

	/* Detach a datepicker from its control.
	 * @param  target	element - the target input field or division or span
	 */
	_destroyDatepicker: function( target ) {
		var nodeName,
			$target = $( target ),
			inst = $.data( target, "datepicker" );

		if ( !$target.hasClass( this.markerClassName ) ) {
			return;
		}

		nodeName = target.nodeName.toLowerCase();
		$.removeData( target, "datepicker" );
		if ( nodeName === "input" ) {
			inst.append.remove();
			inst.trigger.remove();
			$target.removeClass( this.markerClassName ).
				off( "focus", this._showDatepicker ).
				off( "keydown", this._doKeyDown ).
				off( "keypress", this._doKeyPress ).
				off( "keyup", this._doKeyUp );
		} else if ( nodeName === "div" || nodeName === "span" ) {
			$target.removeClass( this.markerClassName ).empty();
		}

		if ( datepicker_instActive === inst ) {
			datepicker_instActive = null;
		}
	},

	/* Enable the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 */
	_enableDatepicker: function( target ) {
		var nodeName, inline,
			$target = $( target ),
			inst = $.data( target, "datepicker" );

		if ( !$target.hasClass( this.markerClassName ) ) {
			return;
		}

		nodeName = target.nodeName.toLowerCase();
		if ( nodeName === "input" ) {
			target.disabled = false;
			inst.trigger.filter( "button" ).
				each( function() { this.disabled = false; } ).end().
				filter( "img" ).css( { opacity: "1.0", cursor: "" } );
		} else if ( nodeName === "div" || nodeName === "span" ) {
			inline = $target.children( "." + this._inlineClass );
			inline.children().removeClass( "ui-state-disabled" );
			inline.find( "select.ui-datepicker-month, select.ui-datepicker-year" ).
				prop( "disabled", false );
		}
		this._disabledInputs = $.map( this._disabledInputs,
			function( value ) { return ( value === target ? null : value ); } ); // delete entry
	},

	/* Disable the date picker to a jQuery selection.
	 * @param  target	element - the target input field or division or span
	 */
	_disableDatepicker: function( target ) {
		var nodeName, inline,
			$target = $( target ),
			inst = $.data( target, "datepicker" );

		if ( !$target.hasClass( this.markerClassName ) ) {
			return;
		}

		nodeName = target.nodeName.toLowerCase();
		if ( nodeName === "input" ) {
			target.disabled = true;
			inst.trigger.filter( "button" ).
				each( function() { this.disabled = true; } ).end().
				filter( "img" ).css( { opacity: "0.5", cursor: "default" } );
		} else if ( nodeName === "div" || nodeName === "span" ) {
			inline = $target.children( "." + this._inlineClass );
			inline.children().addClass( "ui-state-disabled" );
			inline.find( "select.ui-datepicker-month, select.ui-datepicker-year" ).
				prop( "disabled", true );
		}
		this._disabledInputs = $.map( this._disabledInputs,
			function( value ) { return ( value === target ? null : value ); } ); // delete entry
		this._disabledInputs[ this._disabledInputs.length ] = target;
	},

	/* Is the first field in a jQuery collection disabled as a datepicker?
	 * @param  target	element - the target input field or division or span
	 * @return boolean - true if disabled, false if enabled
	 */
	_isDisabledDatepicker: function( target ) {
		if ( !target ) {
			return false;
		}
		for ( var i = 0; i < this._disabledInputs.length; i++ ) {
			if ( this._disabledInputs[ i ] === target ) {
				return true;
			}
		}
		return false;
	},

	/* Retrieve the instance data for the target control.
	 * @param  target  element - the target input field or division or span
	 * @return  object - the associated instance data
	 * @throws  error if a jQuery problem getting data
	 */
	_getInst: function( target ) {
		try {
			return $.data( target, "datepicker" );
		}
		catch ( err ) {
			throw "Missing instance data for this datepicker";
		}
	},

	/* Update or retrieve the settings for a date picker attached to an input field or division.
	 * @param  target  element - the target input field or division or span
	 * @param  name	object - the new settings to update or
	 *				string - the name of the setting to change or retrieve,
	 *				when retrieving also "all" for all instance settings or
	 *				"defaults" for all global defaults
	 * @param  value   any - the new value for the setting
	 *				(omit if above is an object or to retrieve a value)
	 */
	_optionDatepicker: function( target, name, value ) {
		var settings, date, minDate, maxDate,
			inst = this._getInst( target );

		if ( arguments.length === 2 && typeof name === "string" ) {
			return ( name === "defaults" ? $.extend( {}, $.datepicker._defaults ) :
				( inst ? ( name === "all" ? $.extend( {}, inst.settings ) :
				this._get( inst, name ) ) : null ) );
		}

		settings = name || {};
		if ( typeof name === "string" ) {
			settings = {};
			settings[ name ] = value;
		}

		if ( inst ) {
			if ( this._curInst === inst ) {
				this._hideDatepicker();
			}

			date = this._getDateDatepicker( target, true );
			minDate = this._getMinMaxDate( inst, "min" );
			maxDate = this._getMinMaxDate( inst, "max" );
			datepicker_extendRemove( inst.settings, settings );

			// reformat the old minDate/maxDate values if dateFormat changes and a new minDate/maxDate isn't provided
			if ( minDate !== null && settings.dateFormat !== undefined && settings.minDate === undefined ) {
				inst.settings.minDate = this._formatDate( inst, minDate );
			}
			if ( maxDate !== null && settings.dateFormat !== undefined && settings.maxDate === undefined ) {
				inst.settings.maxDate = this._formatDate( inst, maxDate );
			}
			if ( "disabled" in settings ) {
				if ( settings.disabled ) {
					this._disableDatepicker( target );
				} else {
					this._enableDatepicker( target );
				}
			}
			this._attachments( $( target ), inst );
			this._autoSize( inst );
			this._setDate( inst, date );
			this._updateAlternate( inst );
			this._updateDatepicker( inst );
		}
	},

	// Change method deprecated
	_changeDatepicker: function( target, name, value ) {
		this._optionDatepicker( target, name, value );
	},

	/* Redraw the date picker attached to an input field or division.
	 * @param  target  element - the target input field or division or span
	 */
	_refreshDatepicker: function( target ) {
		var inst = this._getInst( target );
		if ( inst ) {
			this._updateDatepicker( inst );
		}
	},

	/* Set the dates for a jQuery selection.
	 * @param  target element - the target input field or division or span
	 * @param  date	Date - the new date
	 */
	_setDateDatepicker: function( target, date ) {
		var inst = this._getInst( target );
		if ( inst ) {
			this._setDate( inst, date );
			this._updateDatepicker( inst );
			this._updateAlternate( inst );
		}
	},

	/* Get the date(s) for the first entry in a jQuery selection.
	 * @param  target element - the target input field or division or span
	 * @param  noDefault boolean - true if no default date is to be used
	 * @return Date - the current date
	 */
	_getDateDatepicker: function( target, noDefault ) {
		var inst = this._getInst( target );
		if ( inst && !inst.inline ) {
			this._setDateFromField( inst, noDefault );
		}
		return ( inst ? this._getDate( inst ) : null );
	},

	/* Handle keystrokes. */
	_doKeyDown: function( event ) {
		var onSelect, dateStr, sel,
			inst = $.datepicker._getInst( event.target ),
			handled = true,
			isRTL = inst.dpDiv.is( ".ui-datepicker-rtl" );

		inst._keyEvent = true;
		if ( $.datepicker._datepickerShowing ) {
			switch ( event.keyCode ) {
				case 9: $.datepicker._hideDatepicker();
						handled = false;
						break; // hide on tab out
				case 13: sel = $( "td." + $.datepicker._dayOverClass + ":not(." +
									$.datepicker._currentClass + ")", inst.dpDiv );
						if ( sel[ 0 ] ) {
							$.datepicker._selectDay( event.target, inst.selectedMonth, inst.selectedYear, sel[ 0 ] );
						}

						onSelect = $.datepicker._get( inst, "onSelect" );
						if ( onSelect ) {
							dateStr = $.datepicker._formatDate( inst );

							// Trigger custom callback
							onSelect.apply( ( inst.input ? inst.input[ 0 ] : null ), [ dateStr, inst ] );
						} else {
							$.datepicker._hideDatepicker();
						}

						return false; // don't submit the form
				case 27: $.datepicker._hideDatepicker();
						break; // hide on escape
				case 33: $.datepicker._adjustDate( event.target, ( event.ctrlKey ?
							-$.datepicker._get( inst, "stepBigMonths" ) :
							-$.datepicker._get( inst, "stepMonths" ) ), "M" );
						break; // previous month/year on page up/+ ctrl
				case 34: $.datepicker._adjustDate( event.target, ( event.ctrlKey ?
							+$.datepicker._get( inst, "stepBigMonths" ) :
							+$.datepicker._get( inst, "stepMonths" ) ), "M" );
						break; // next month/year on page down/+ ctrl
				case 35: if ( event.ctrlKey || event.metaKey ) {
							$.datepicker._clearDate( event.target );
						}
						handled = event.ctrlKey || event.metaKey;
						break; // clear on ctrl or command +end
				case 36: if ( event.ctrlKey || event.metaKey ) {
							$.datepicker._gotoToday( event.target );
						}
						handled = event.ctrlKey || event.metaKey;
						break; // current on ctrl or command +home
				case 37: if ( event.ctrlKey || event.metaKey ) {
							$.datepicker._adjustDate( event.target, ( isRTL ? +1 : -1 ), "D" );
						}
						handled = event.ctrlKey || event.metaKey;

						// -1 day on ctrl or command +left
						if ( event.originalEvent.altKey ) {
							$.datepicker._adjustDate( event.target, ( event.ctrlKey ?
								-$.datepicker._get( inst, "stepBigMonths" ) :
								-$.datepicker._get( inst, "stepMonths" ) ), "M" );
						}

						// next month/year on alt +left on Mac
						break;
				case 38: if ( event.ctrlKey || event.metaKey ) {
							$.datepicker._adjustDate( event.target, -7, "D" );
						}
						handled = event.ctrlKey || event.metaKey;
						break; // -1 week on ctrl or command +up
				case 39: if ( event.ctrlKey || event.metaKey ) {
							$.datepicker._adjustDate( event.target, ( isRTL ? -1 : +1 ), "D" );
						}
						handled = event.ctrlKey || event.metaKey;

						// +1 day on ctrl or command +right
						if ( event.originalEvent.altKey ) {
							$.datepicker._adjustDate( event.target, ( event.ctrlKey ?
								+$.datepicker._get( inst, "stepBigMonths" ) :
								+$.datepicker._get( inst, "stepMonths" ) ), "M" );
						}

						// next month/year on alt +right
						break;
				case 40: if ( event.ctrlKey || event.metaKey ) {
							$.datepicker._adjustDate( event.target, +7, "D" );
						}
						handled = event.ctrlKey || event.metaKey;
						break; // +1 week on ctrl or command +down
				default: handled = false;
			}
		} else if ( event.keyCode === 36 && event.ctrlKey ) { // display the date picker on ctrl+home
			$.datepicker._showDatepicker( this );
		} else {
			handled = false;
		}

		if ( handled ) {
			event.preventDefault();
			event.stopPropagation();
		}
	},

	/* Filter entered characters - based on date format. */
	_doKeyPress: function( event ) {
		var chars, chr,
			inst = $.datepicker._getInst( event.target );

		if ( $.datepicker._get( inst, "constrainInput" ) ) {
			chars = $.datepicker._possibleChars( $.datepicker._get( inst, "dateFormat" ) );
			chr = String.fromCharCode( event.charCode == null ? event.keyCode : event.charCode );
			return event.ctrlKey || event.metaKey || ( chr < " " || !chars || chars.indexOf( chr ) > -1 );
		}
	},

	/* Synchronise manual entry and field/alternate field. */
	_doKeyUp: function( event ) {
		var date,
			inst = $.datepicker._getInst( event.target );

		if ( inst.input.val() !== inst.lastVal ) {
			try {
				date = $.datepicker.parseDate( $.datepicker._get( inst, "dateFormat" ),
					( inst.input ? inst.input.val() : null ),
					$.datepicker._getFormatConfig( inst ) );

				if ( date ) { // only if valid
					$.datepicker._setDateFromField( inst );
					$.datepicker._updateAlternate( inst );
					$.datepicker._updateDatepicker( inst );
				}
			}
			catch ( err ) {
			}
		}
		return true;
	},

	/* Pop-up the date picker for a given input field.
	 * If false returned from beforeShow event handler do not show.
	 * @param  input  element - the input field attached to the date picker or
	 *					event - if triggered by focus
	 */
	_showDatepicker: function( input ) {
		input = input.target || input;
		if ( input.nodeName.toLowerCase() !== "input" ) { // find from button/image trigger
			input = $( "input", input.parentNode )[ 0 ];
		}

		if ( $.datepicker._isDisabledDatepicker( input ) || $.datepicker._lastInput === input ) { // already here
			return;
		}

		var inst, beforeShow, beforeShowSettings, isFixed,
			offset, showAnim, duration;

		inst = $.datepicker._getInst( input );
		if ( $.datepicker._curInst && $.datepicker._curInst !== inst ) {
			$.datepicker._curInst.dpDiv.stop( true, true );
			if ( inst && $.datepicker._datepickerShowing ) {
				$.datepicker._hideDatepicker( $.datepicker._curInst.input[ 0 ] );
			}
		}

		beforeShow = $.datepicker._get( inst, "beforeShow" );
		beforeShowSettings = beforeShow ? beforeShow.apply( input, [ input, inst ] ) : {};
		if ( beforeShowSettings === false ) {
			return;
		}
		datepicker_extendRemove( inst.settings, beforeShowSettings );

		inst.lastVal = null;
		$.datepicker._lastInput = input;
		$.datepicker._setDateFromField( inst );

		if ( $.datepicker._inDialog ) { // hide cursor
			input.value = "";
		}
		if ( !$.datepicker._pos ) { // position below input
			$.datepicker._pos = $.datepicker._findPos( input );
			$.datepicker._pos[ 1 ] += input.offsetHeight; // add the height
		}

		isFixed = false;
		$( input ).parents().each( function() {
			isFixed |= $( this ).css( "position" ) === "fixed";
			return !isFixed;
		} );

		offset = { left: $.datepicker._pos[ 0 ], top: $.datepicker._pos[ 1 ] };
		$.datepicker._pos = null;

		//to avoid flashes on Firefox
		inst.dpDiv.empty();

		// determine sizing offscreen
		inst.dpDiv.css( { position: "absolute", display: "block", top: "-1000px" } );
		$.datepicker._updateDatepicker( inst );

		// fix width for dynamic number of date pickers
		// and adjust position before showing
		offset = $.datepicker._checkOffset( inst, offset, isFixed );
		inst.dpDiv.css( { position: ( $.datepicker._inDialog && $.blockUI ?
			"static" : ( isFixed ? "fixed" : "absolute" ) ), display: "none",
			left: offset.left + "px", top: offset.top + "px" } );

		if ( !inst.inline ) {
			showAnim = $.datepicker._get( inst, "showAnim" );
			duration = $.datepicker._get( inst, "duration" );
			inst.dpDiv.css( "z-index", datepicker_getZindex( $( input ) ) + 1 );
			$.datepicker._datepickerShowing = true;

			if ( $.effects && $.effects.effect[ showAnim ] ) {
				inst.dpDiv.show( showAnim, $.datepicker._get( inst, "showOptions" ), duration );
			} else {
				inst.dpDiv[ showAnim || "show" ]( showAnim ? duration : null );
			}

			if ( $.datepicker._shouldFocusInput( inst ) ) {
				inst.input.trigger( "focus" );
			}

			$.datepicker._curInst = inst;
		}
	},

	/* Generate the date picker content. */
	_updateDatepicker: function( inst ) {
		this.maxRows = 4; //Reset the max number of rows being displayed (see #7043)
		datepicker_instActive = inst; // for delegate hover events
		inst.dpDiv.empty().append( this._generateHTML( inst ) );
		this._attachHandlers( inst );

		var origyearshtml,
			numMonths = this._getNumberOfMonths( inst ),
			cols = numMonths[ 1 ],
			width = 17,
			activeCell = inst.dpDiv.find( "." + this._dayOverClass + " a" );

		if ( activeCell.length > 0 ) {
			datepicker_handleMouseover.apply( activeCell.get( 0 ) );
		}

		inst.dpDiv.removeClass( "ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4" ).width( "" );
		if ( cols > 1 ) {
			inst.dpDiv.addClass( "ui-datepicker-multi-" + cols ).css( "width", ( width * cols ) + "em" );
		}
		inst.dpDiv[ ( numMonths[ 0 ] !== 1 || numMonths[ 1 ] !== 1 ? "add" : "remove" ) +
			"Class" ]( "ui-datepicker-multi" );
		inst.dpDiv[ ( this._get( inst, "isRTL" ) ? "add" : "remove" ) +
			"Class" ]( "ui-datepicker-rtl" );

		if ( inst === $.datepicker._curInst && $.datepicker._datepickerShowing && $.datepicker._shouldFocusInput( inst ) ) {
			inst.input.trigger( "focus" );
		}

		// Deffered render of the years select (to avoid flashes on Firefox)
		if ( inst.yearshtml ) {
			origyearshtml = inst.yearshtml;
			setTimeout( function() {

				//assure that inst.yearshtml didn't change.
				if ( origyearshtml === inst.yearshtml && inst.yearshtml ) {
					inst.dpDiv.find( "select.ui-datepicker-year:first" ).replaceWith( inst.yearshtml );
				}
				origyearshtml = inst.yearshtml = null;
			}, 0 );
		}
	},

	// #6694 - don't focus the input if it's already focused
	// this breaks the change event in IE
	// Support: IE and jQuery <1.9
	_shouldFocusInput: function( inst ) {
		return inst.input && inst.input.is( ":visible" ) && !inst.input.is( ":disabled" ) && !inst.input.is( ":focus" );
	},

	/* Check positioning to remain on screen. */
	_checkOffset: function( inst, offset, isFixed ) {
		var dpWidth = inst.dpDiv.outerWidth(),
			dpHeight = inst.dpDiv.outerHeight(),
			inputWidth = inst.input ? inst.input.outerWidth() : 0,
			inputHeight = inst.input ? inst.input.outerHeight() : 0,
			viewWidth = document.documentElement.clientWidth + ( isFixed ? 0 : $( document ).scrollLeft() ),
			viewHeight = document.documentElement.clientHeight + ( isFixed ? 0 : $( document ).scrollTop() );

		offset.left -= ( this._get( inst, "isRTL" ) ? ( dpWidth - inputWidth ) : 0 );
		offset.left -= ( isFixed && offset.left === inst.input.offset().left ) ? $( document ).scrollLeft() : 0;
		offset.top -= ( isFixed && offset.top === ( inst.input.offset().top + inputHeight ) ) ? $( document ).scrollTop() : 0;

		// Now check if datepicker is showing outside window viewport - move to a better place if so.
		offset.left -= Math.min( offset.left, ( offset.left + dpWidth > viewWidth && viewWidth > dpWidth ) ?
			Math.abs( offset.left + dpWidth - viewWidth ) : 0 );
		offset.top -= Math.min( offset.top, ( offset.top + dpHeight > viewHeight && viewHeight > dpHeight ) ?
			Math.abs( dpHeight + inputHeight ) : 0 );

		return offset;
	},

	/* Find an object's position on the screen. */
	_findPos: function( obj ) {
		var position,
			inst = this._getInst( obj ),
			isRTL = this._get( inst, "isRTL" );

		while ( obj && ( obj.type === "hidden" || obj.nodeType !== 1 || $.expr.filters.hidden( obj ) ) ) {
			obj = obj[ isRTL ? "previousSibling" : "nextSibling" ];
		}

		position = $( obj ).offset();
		return [ position.left, position.top ];
	},

	/* Hide the date picker from view.
	 * @param  input  element - the input field attached to the date picker
	 */
	_hideDatepicker: function( input ) {
		var showAnim, duration, postProcess, onClose,
			inst = this._curInst;

		if ( !inst || ( input && inst !== $.data( input, "datepicker" ) ) ) {
			return;
		}

		if ( this._datepickerShowing ) {
			showAnim = this._get( inst, "showAnim" );
			duration = this._get( inst, "duration" );
			postProcess = function() {
				$.datepicker._tidyDialog( inst );
			};

			// DEPRECATED: after BC for 1.8.x $.effects[ showAnim ] is not needed
			if ( $.effects && ( $.effects.effect[ showAnim ] || $.effects[ showAnim ] ) ) {
				inst.dpDiv.hide( showAnim, $.datepicker._get( inst, "showOptions" ), duration, postProcess );
			} else {
				inst.dpDiv[ ( showAnim === "slideDown" ? "slideUp" :
					( showAnim === "fadeIn" ? "fadeOut" : "hide" ) ) ]( ( showAnim ? duration : null ), postProcess );
			}

			if ( !showAnim ) {
				postProcess();
			}
			this._datepickerShowing = false;

			onClose = this._get( inst, "onClose" );
			if ( onClose ) {
				onClose.apply( ( inst.input ? inst.input[ 0 ] : null ), [ ( inst.input ? inst.input.val() : "" ), inst ] );
			}

			this._lastInput = null;
			if ( this._inDialog ) {
				this._dialogInput.css( { position: "absolute", left: "0", top: "-100px" } );
				if ( $.blockUI ) {
					$.unblockUI();
					$( "body" ).append( this.dpDiv );
				}
			}
			this._inDialog = false;
		}
	},

	/* Tidy up after a dialog display. */
	_tidyDialog: function( inst ) {
		inst.dpDiv.removeClass( this._dialogClass ).off( ".ui-datepicker-calendar" );
	},

	/* Close date picker if clicked elsewhere. */
	_checkExternalClick: function( event ) {
		if ( !$.datepicker._curInst ) {
			return;
		}

		var $target = $( event.target ),
			inst = $.datepicker._getInst( $target[ 0 ] );

		if ( ( ( $target[ 0 ].id !== $.datepicker._mainDivId &&
				$target.parents( "#" + $.datepicker._mainDivId ).length === 0 &&
				!$target.hasClass( $.datepicker.markerClassName ) &&
				!$target.closest( "." + $.datepicker._triggerClass ).length &&
				$.datepicker._datepickerShowing && !( $.datepicker._inDialog && $.blockUI ) ) ) ||
			( $target.hasClass( $.datepicker.markerClassName ) && $.datepicker._curInst !== inst ) ) {
				$.datepicker._hideDatepicker();
		}
	},

	/* Adjust one of the date sub-fields. */
	_adjustDate: function( id, offset, period ) {
		var target = $( id ),
			inst = this._getInst( target[ 0 ] );

		if ( this._isDisabledDatepicker( target[ 0 ] ) ) {
			return;
		}
		this._adjustInstDate( inst, offset +
			( period === "M" ? this._get( inst, "showCurrentAtPos" ) : 0 ), // undo positioning
			period );
		this._updateDatepicker( inst );
	},

	/* Action for current link. */
	_gotoToday: function( id ) {
		var date,
			target = $( id ),
			inst = this._getInst( target[ 0 ] );

		if ( this._get( inst, "gotoCurrent" ) && inst.currentDay ) {
			inst.selectedDay = inst.currentDay;
			inst.drawMonth = inst.selectedMonth = inst.currentMonth;
			inst.drawYear = inst.selectedYear = inst.currentYear;
		} else {
			date = new Date();
			inst.selectedDay = date.getDate();
			inst.drawMonth = inst.selectedMonth = date.getMonth();
			inst.drawYear = inst.selectedYear = date.getFullYear();
		}
		this._notifyChange( inst );
		this._adjustDate( target );
	},

	/* Action for selecting a new month/year. */
	_selectMonthYear: function( id, select, period ) {
		var target = $( id ),
			inst = this._getInst( target[ 0 ] );

		inst[ "selected" + ( period === "M" ? "Month" : "Year" ) ] =
		inst[ "draw" + ( period === "M" ? "Month" : "Year" ) ] =
			parseInt( select.options[ select.selectedIndex ].value, 10 );

		this._notifyChange( inst );
		this._adjustDate( target );
	},

	/* Action for selecting a day. */
	_selectDay: function( id, month, year, td ) {
		var inst,
			target = $( id );

		if ( $( td ).hasClass( this._unselectableClass ) || this._isDisabledDatepicker( target[ 0 ] ) ) {
			return;
		}

		inst = this._getInst( target[ 0 ] );
		inst.selectedDay = inst.currentDay = $( "a", td ).html();
		inst.selectedMonth = inst.currentMonth = month;
		inst.selectedYear = inst.currentYear = year;
		this._selectDate( id, this._formatDate( inst,
			inst.currentDay, inst.currentMonth, inst.currentYear ) );
	},

	/* Erase the input field and hide the date picker. */
	_clearDate: function( id ) {
		var target = $( id );
		this._selectDate( target, "" );
	},

	/* Update the input field with the selected date. */
	_selectDate: function( id, dateStr ) {
		var onSelect,
			target = $( id ),
			inst = this._getInst( target[ 0 ] );

		dateStr = ( dateStr != null ? dateStr : this._formatDate( inst ) );
		if ( inst.input ) {
			inst.input.val( dateStr );
		}
		this._updateAlternate( inst );

		onSelect = this._get( inst, "onSelect" );
		if ( onSelect ) {
			onSelect.apply( ( inst.input ? inst.input[ 0 ] : null ), [ dateStr, inst ] );  // trigger custom callback
		} else if ( inst.input ) {
			inst.input.trigger( "change" ); // fire the change event
		}

		if ( inst.inline ) {
			this._updateDatepicker( inst );
		} else {
			this._hideDatepicker();
			this._lastInput = inst.input[ 0 ];
			if ( typeof( inst.input[ 0 ] ) !== "object" ) {
				inst.input.trigger( "focus" ); // restore focus
			}
			this._lastInput = null;
		}
	},

	/* Update any alternate field to synchronise with the main field. */
	_updateAlternate: function( inst ) {
		var altFormat, date, dateStr,
			altField = this._get( inst, "altField" );

		if ( altField ) { // update alternate field too
			altFormat = this._get( inst, "altFormat" ) || this._get( inst, "dateFormat" );
			date = this._getDate( inst );
			dateStr = this.formatDate( altFormat, date, this._getFormatConfig( inst ) );
			$( altField ).val( dateStr );
		}
	},

	/* Set as beforeShowDay function to prevent selection of weekends.
	 * @param  date  Date - the date to customise
	 * @return [boolean, string] - is this date selectable?, what is its CSS class?
	 */
	noWeekends: function( date ) {
		var day = date.getDay();
		return [ ( day > 0 && day < 6 ), "" ];
	},

	/* Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.
	 * @param  date  Date - the date to get the week for
	 * @return  number - the number of the week within the year that contains this date
	 */
	iso8601Week: function( date ) {
		var time,
			checkDate = new Date( date.getTime() );

		// Find Thursday of this week starting on Monday
		checkDate.setDate( checkDate.getDate() + 4 - ( checkDate.getDay() || 7 ) );

		time = checkDate.getTime();
		checkDate.setMonth( 0 ); // Compare with Jan 1
		checkDate.setDate( 1 );
		return Math.floor( Math.round( ( time - checkDate ) / 86400000 ) / 7 ) + 1;
	},

	/* Parse a string value into a date object.
	 * See formatDate below for the possible formats.
	 *
	 * @param  format string - the expected format of the date
	 * @param  value string - the date in the above format
	 * @param  settings Object - attributes include:
	 *					shortYearCutoff  number - the cutoff year for determining the century (optional)
	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
	 *					dayNames		string[7] - names of the days from Sunday (optional)
	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
	 *					monthNames		string[12] - names of the months (optional)
	 * @return  Date - the extracted date value or null if value is blank
	 */
	parseDate: function( format, value, settings ) {
		if ( format == null || value == null ) {
			throw "Invalid arguments";
		}

		value = ( typeof value === "object" ? value.toString() : value + "" );
		if ( value === "" ) {
			return null;
		}

		var iFormat, dim, extra,
			iValue = 0,
			shortYearCutoffTemp = ( settings ? settings.shortYearCutoff : null ) || this._defaults.shortYearCutoff,
			shortYearCutoff = ( typeof shortYearCutoffTemp !== "string" ? shortYearCutoffTemp :
				new Date().getFullYear() % 100 + parseInt( shortYearCutoffTemp, 10 ) ),
			dayNamesShort = ( settings ? settings.dayNamesShort : null ) || this._defaults.dayNamesShort,
			dayNames = ( settings ? settings.dayNames : null ) || this._defaults.dayNames,
			monthNamesShort = ( settings ? settings.monthNamesShort : null ) || this._defaults.monthNamesShort,
			monthNames = ( settings ? settings.monthNames : null ) || this._defaults.monthNames,
			year = -1,
			month = -1,
			day = -1,
			doy = -1,
			literal = false,
			date,

			// Check whether a format character is doubled
			lookAhead = function( match ) {
				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
				if ( matches ) {
					iFormat++;
				}
				return matches;
			},

			// Extract a number from the string value
			getNumber = function( match ) {
				var isDoubled = lookAhead( match ),
					size = ( match === "@" ? 14 : ( match === "!" ? 20 :
					( match === "y" && isDoubled ? 4 : ( match === "o" ? 3 : 2 ) ) ) ),
					minSize = ( match === "y" ? size : 1 ),
					digits = new RegExp( "^\\d{" + minSize + "," + size + "}" ),
					num = value.substring( iValue ).match( digits );
				if ( !num ) {
					throw "Missing number at position " + iValue;
				}
				iValue += num[ 0 ].length;
				return parseInt( num[ 0 ], 10 );
			},

			// Extract a name from the string value and convert to an index
			getName = function( match, shortNames, longNames ) {
				var index = -1,
					names = $.map( lookAhead( match ) ? longNames : shortNames, function( v, k ) {
						return [ [ k, v ] ];
					} ).sort( function( a, b ) {
						return -( a[ 1 ].length - b[ 1 ].length );
					} );

				$.each( names, function( i, pair ) {
					var name = pair[ 1 ];
					if ( value.substr( iValue, name.length ).toLowerCase() === name.toLowerCase() ) {
						index = pair[ 0 ];
						iValue += name.length;
						return false;
					}
				} );
				if ( index !== -1 ) {
					return index + 1;
				} else {
					throw "Unknown name at position " + iValue;
				}
			},

			// Confirm that a literal character matches the string value
			checkLiteral = function() {
				if ( value.charAt( iValue ) !== format.charAt( iFormat ) ) {
					throw "Unexpected literal at position " + iValue;
				}
				iValue++;
			};

		for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
			if ( literal ) {
				if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
					literal = false;
				} else {
					checkLiteral();
				}
			} else {
				switch ( format.charAt( iFormat ) ) {
					case "d":
						day = getNumber( "d" );
						break;
					case "D":
						getName( "D", dayNamesShort, dayNames );
						break;
					case "o":
						doy = getNumber( "o" );
						break;
					case "m":
						month = getNumber( "m" );
						break;
					case "M":
						month = getName( "M", monthNamesShort, monthNames );
						break;
					case "y":
						year = getNumber( "y" );
						break;
					case "@":
						date = new Date( getNumber( "@" ) );
						year = date.getFullYear();
						month = date.getMonth() + 1;
						day = date.getDate();
						break;
					case "!":
						date = new Date( ( getNumber( "!" ) - this._ticksTo1970 ) / 10000 );
						year = date.getFullYear();
						month = date.getMonth() + 1;
						day = date.getDate();
						break;
					case "'":
						if ( lookAhead( "'" ) ) {
							checkLiteral();
						} else {
							literal = true;
						}
						break;
					default:
						checkLiteral();
				}
			}
		}

		if ( iValue < value.length ) {
			extra = value.substr( iValue );
			if ( !/^\s+/.test( extra ) ) {
				throw "Extra/unparsed characters found in date: " + extra;
			}
		}

		if ( year === -1 ) {
			year = new Date().getFullYear();
		} else if ( year < 100 ) {
			year += new Date().getFullYear() - new Date().getFullYear() % 100 +
				( year <= shortYearCutoff ? 0 : -100 );
		}

		if ( doy > -1 ) {
			month = 1;
			day = doy;
			do {
				dim = this._getDaysInMonth( year, month - 1 );
				if ( day <= dim ) {
					break;
				}
				month++;
				day -= dim;
			} while ( true );
		}

		date = this._daylightSavingAdjust( new Date( year, month - 1, day ) );
		if ( date.getFullYear() !== year || date.getMonth() + 1 !== month || date.getDate() !== day ) {
			throw "Invalid date"; // E.g. 31/02/00
		}
		return date;
	},

	/* Standard date formats. */
	ATOM: "yy-mm-dd", // RFC 3339 (ISO 8601)
	COOKIE: "D, dd M yy",
	ISO_8601: "yy-mm-dd",
	RFC_822: "D, d M y",
	RFC_850: "DD, dd-M-y",
	RFC_1036: "D, d M y",
	RFC_1123: "D, d M yy",
	RFC_2822: "D, d M yy",
	RSS: "D, d M y", // RFC 822
	TICKS: "!",
	TIMESTAMP: "@",
	W3C: "yy-mm-dd", // ISO 8601

	_ticksTo1970: ( ( ( 1970 - 1 ) * 365 + Math.floor( 1970 / 4 ) - Math.floor( 1970 / 100 ) +
		Math.floor( 1970 / 400 ) ) * 24 * 60 * 60 * 10000000 ),

	/* Format a date object into a string value.
	 * The format can be combinations of the following:
	 * d  - day of month (no leading zero)
	 * dd - day of month (two digit)
	 * o  - day of year (no leading zeros)
	 * oo - day of year (three digit)
	 * D  - day name short
	 * DD - day name long
	 * m  - month of year (no leading zero)
	 * mm - month of year (two digit)
	 * M  - month name short
	 * MM - month name long
	 * y  - year (two digit)
	 * yy - year (four digit)
	 * @ - Unix timestamp (ms since 01/01/1970)
	 * ! - Windows ticks (100ns since 01/01/0001)
	 * "..." - literal text
	 * '' - single quote
	 *
	 * @param  format string - the desired format of the date
	 * @param  date Date - the date value to format
	 * @param  settings Object - attributes include:
	 *					dayNamesShort	string[7] - abbreviated names of the days from Sunday (optional)
	 *					dayNames		string[7] - names of the days from Sunday (optional)
	 *					monthNamesShort string[12] - abbreviated names of the months (optional)
	 *					monthNames		string[12] - names of the months (optional)
	 * @return  string - the date in the above format
	 */
	formatDate: function( format, date, settings ) {
		if ( !date ) {
			return "";
		}

		var iFormat,
			dayNamesShort = ( settings ? settings.dayNamesShort : null ) || this._defaults.dayNamesShort,
			dayNames = ( settings ? settings.dayNames : null ) || this._defaults.dayNames,
			monthNamesShort = ( settings ? settings.monthNamesShort : null ) || this._defaults.monthNamesShort,
			monthNames = ( settings ? settings.monthNames : null ) || this._defaults.monthNames,

			// Check whether a format character is doubled
			lookAhead = function( match ) {
				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
				if ( matches ) {
					iFormat++;
				}
				return matches;
			},

			// Format a number, with leading zero if necessary
			formatNumber = function( match, value, len ) {
				var num = "" + value;
				if ( lookAhead( match ) ) {
					while ( num.length < len ) {
						num = "0" + num;
					}
				}
				return num;
			},

			// Format a name, short or long as requested
			formatName = function( match, value, shortNames, longNames ) {
				return ( lookAhead( match ) ? longNames[ value ] : shortNames[ value ] );
			},
			output = "",
			literal = false;

		if ( date ) {
			for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
				if ( literal ) {
					if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
						literal = false;
					} else {
						output += format.charAt( iFormat );
					}
				} else {
					switch ( format.charAt( iFormat ) ) {
						case "d":
							output += formatNumber( "d", date.getDate(), 2 );
							break;
						case "D":
							output += formatName( "D", date.getDay(), dayNamesShort, dayNames );
							break;
						case "o":
							output += formatNumber( "o",
								Math.round( ( new Date( date.getFullYear(), date.getMonth(), date.getDate() ).getTime() - new Date( date.getFullYear(), 0, 0 ).getTime() ) / 86400000 ), 3 );
							break;
						case "m":
							output += formatNumber( "m", date.getMonth() + 1, 2 );
							break;
						case "M":
							output += formatName( "M", date.getMonth(), monthNamesShort, monthNames );
							break;
						case "y":
							output += ( lookAhead( "y" ) ? date.getFullYear() :
								( date.getFullYear() % 100 < 10 ? "0" : "" ) + date.getFullYear() % 100 );
							break;
						case "@":
							output += date.getTime();
							break;
						case "!":
							output += date.getTime() * 10000 + this._ticksTo1970;
							break;
						case "'":
							if ( lookAhead( "'" ) ) {
								output += "'";
							} else {
								literal = true;
							}
							break;
						default:
							output += format.charAt( iFormat );
					}
				}
			}
		}
		return output;
	},

	/* Extract all possible characters from the date format. */
	_possibleChars: function( format ) {
		var iFormat,
			chars = "",
			literal = false,

			// Check whether a format character is doubled
			lookAhead = function( match ) {
				var matches = ( iFormat + 1 < format.length && format.charAt( iFormat + 1 ) === match );
				if ( matches ) {
					iFormat++;
				}
				return matches;
			};

		for ( iFormat = 0; iFormat < format.length; iFormat++ ) {
			if ( literal ) {
				if ( format.charAt( iFormat ) === "'" && !lookAhead( "'" ) ) {
					literal = false;
				} else {
					chars += format.charAt( iFormat );
				}
			} else {
				switch ( format.charAt( iFormat ) ) {
					case "d": case "m": case "y": case "@":
						chars += "0123456789";
						break;
					case "D": case "M":
						return null; // Accept anything
					case "'":
						if ( lookAhead( "'" ) ) {
							chars += "'";
						} else {
							literal = true;
						}
						break;
					default:
						chars += format.charAt( iFormat );
				}
			}
		}
		return chars;
	},

	/* Get a setting value, defaulting if necessary. */
	_get: function( inst, name ) {
		return inst.settings[ name ] !== undefined ?
			inst.settings[ name ] : this._defaults[ name ];
	},

	/* Parse existing date and initialise date picker. */
	_setDateFromField: function( inst, noDefault ) {
		if ( inst.input.val() === inst.lastVal ) {
			return;
		}

		var dateFormat = this._get( inst, "dateFormat" ),
			dates = inst.lastVal = inst.input ? inst.input.val() : null,
			defaultDate = this._getDefaultDate( inst ),
			date = defaultDate,
			settings = this._getFormatConfig( inst );

		try {
			date = this.parseDate( dateFormat, dates, settings ) || defaultDate;
		} catch ( event ) {
			dates = ( noDefault ? "" : dates );
		}
		inst.selectedDay = date.getDate();
		inst.drawMonth = inst.selectedMonth = date.getMonth();
		inst.drawYear = inst.selectedYear = date.getFullYear();
		inst.currentDay = ( dates ? date.getDate() : 0 );
		inst.currentMonth = ( dates ? date.getMonth() : 0 );
		inst.currentYear = ( dates ? date.getFullYear() : 0 );
		this._adjustInstDate( inst );
	},

	/* Retrieve the default date shown on opening. */
	_getDefaultDate: function( inst ) {
		return this._restrictMinMax( inst,
			this._determineDate( inst, this._get( inst, "defaultDate" ), new Date() ) );
	},

	/* A date may be specified as an exact value or a relative one. */
	_determineDate: function( inst, date, defaultDate ) {
		var offsetNumeric = function( offset ) {
				var date = new Date();
				date.setDate( date.getDate() + offset );
				return date;
			},
			offsetString = function( offset ) {
				try {
					return $.datepicker.parseDate( $.datepicker._get( inst, "dateFormat" ),
						offset, $.datepicker._getFormatConfig( inst ) );
				}
				catch ( e ) {

					// Ignore
				}

				var date = ( offset.toLowerCase().match( /^c/ ) ?
					$.datepicker._getDate( inst ) : null ) || new Date(),
					year = date.getFullYear(),
					month = date.getMonth(),
					day = date.getDate(),
					pattern = /([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,
					matches = pattern.exec( offset );

				while ( matches ) {
					switch ( matches[ 2 ] || "d" ) {
						case "d" : case "D" :
							day += parseInt( matches[ 1 ], 10 ); break;
						case "w" : case "W" :
							day += parseInt( matches[ 1 ], 10 ) * 7; break;
						case "m" : case "M" :
							month += parseInt( matches[ 1 ], 10 );
							day = Math.min( day, $.datepicker._getDaysInMonth( year, month ) );
							break;
						case "y": case "Y" :
							year += parseInt( matches[ 1 ], 10 );
							day = Math.min( day, $.datepicker._getDaysInMonth( year, month ) );
							break;
					}
					matches = pattern.exec( offset );
				}
				return new Date( year, month, day );
			},
			newDate = ( date == null || date === "" ? defaultDate : ( typeof date === "string" ? offsetString( date ) :
				( typeof date === "number" ? ( isNaN( date ) ? defaultDate : offsetNumeric( date ) ) : new Date( date.getTime() ) ) ) );

		newDate = ( newDate && newDate.toString() === "Invalid Date" ? defaultDate : newDate );
		if ( newDate ) {
			newDate.setHours( 0 );
			newDate.setMinutes( 0 );
			newDate.setSeconds( 0 );
			newDate.setMilliseconds( 0 );
		}
		return this._daylightSavingAdjust( newDate );
	},

	/* Handle switch to/from daylight saving.
	 * Hours may be non-zero on daylight saving cut-over:
	 * > 12 when midnight changeover, but then cannot generate
	 * midnight datetime, so jump to 1AM, otherwise reset.
	 * @param  date  (Date) the date to check
	 * @return  (Date) the corrected date
	 */
	_daylightSavingAdjust: function( date ) {
		if ( !date ) {
			return null;
		}
		date.setHours( date.getHours() > 12 ? date.getHours() + 2 : 0 );
		return date;
	},

	/* Set the date(s) directly. */
	_setDate: function( inst, date, noChange ) {
		var clear = !date,
			origMonth = inst.selectedMonth,
			origYear = inst.selectedYear,
			newDate = this._restrictMinMax( inst, this._determineDate( inst, date, new Date() ) );

		inst.selectedDay = inst.currentDay = newDate.getDate();
		inst.drawMonth = inst.selectedMonth = inst.currentMonth = newDate.getMonth();
		inst.drawYear = inst.selectedYear = inst.currentYear = newDate.getFullYear();
		if ( ( origMonth !== inst.selectedMonth || origYear !== inst.selectedYear ) && !noChange ) {
			this._notifyChange( inst );
		}
		this._adjustInstDate( inst );
		if ( inst.input ) {
			inst.input.val( clear ? "" : this._formatDate( inst ) );
		}
	},

	/* Retrieve the date(s) directly. */
	_getDate: function( inst ) {
		var startDate = ( !inst.currentYear || ( inst.input && inst.input.val() === "" ) ? null :
			this._daylightSavingAdjust( new Date(
			inst.currentYear, inst.currentMonth, inst.currentDay ) ) );
			return startDate;
	},

	/* Attach the onxxx handlers.  These are declared statically so
	 * they work with static code transformers like Caja.
	 */
	_attachHandlers: function( inst ) {
		var stepMonths = this._get( inst, "stepMonths" ),
			id = "#" + inst.id.replace( /\\\\/g, "\\" );
		inst.dpDiv.find( "[data-handler]" ).map( function() {
			var handler = {
				prev: function() {
					$.datepicker._adjustDate( id, -stepMonths, "M" );
				},
				next: function() {
					$.datepicker._adjustDate( id, +stepMonths, "M" );
				},
				hide: function() {
					$.datepicker._hideDatepicker();
				},
				today: function() {
					$.datepicker._gotoToday( id );
				},
				selectDay: function() {
					$.datepicker._selectDay( id, +this.getAttribute( "data-month" ), +this.getAttribute( "data-year" ), this );
					return false;
				},
				selectMonth: function() {
					$.datepicker._selectMonthYear( id, this, "M" );
					return false;
				},
				selectYear: function() {
					$.datepicker._selectMonthYear( id, this, "Y" );
					return false;
				}
			};
			$( this ).on( this.getAttribute( "data-event" ), handler[ this.getAttribute( "data-handler" ) ] );
		} );
	},

	/* Generate the HTML for the current state of the date picker. */
	_generateHTML: function( inst ) {
		var maxDraw, prevText, prev, nextText, next, currentText, gotoDate,
			controls, buttonPanel, firstDay, showWeek, dayNames, dayNamesMin,
			monthNames, monthNamesShort, beforeShowDay, showOtherMonths,
			selectOtherMonths, defaultDate, html, dow, row, group, col, selectedDate,
			cornerClass, calender, thead, day, daysInMonth, leadDays, curRows, numRows,
			printDate, dRow, tbody, daySettings, otherMonth, unselectable,
			tempDate = new Date(),
			today = this._daylightSavingAdjust(
				new Date( tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate() ) ), // clear time
			isRTL = this._get( inst, "isRTL" ),
			showButtonPanel = this._get( inst, "showButtonPanel" ),
			hideIfNoPrevNext = this._get( inst, "hideIfNoPrevNext" ),
			navigationAsDateFormat = this._get( inst, "navigationAsDateFormat" ),
			numMonths = this._getNumberOfMonths( inst ),
			showCurrentAtPos = this._get( inst, "showCurrentAtPos" ),
			stepMonths = this._get( inst, "stepMonths" ),
			isMultiMonth = ( numMonths[ 0 ] !== 1 || numMonths[ 1 ] !== 1 ),
			currentDate = this._daylightSavingAdjust( ( !inst.currentDay ? new Date( 9999, 9, 9 ) :
				new Date( inst.currentYear, inst.currentMonth, inst.currentDay ) ) ),
			minDate = this._getMinMaxDate( inst, "min" ),
			maxDate = this._getMinMaxDate( inst, "max" ),
			drawMonth = inst.drawMonth - showCurrentAtPos,
			drawYear = inst.drawYear;

		if ( drawMonth < 0 ) {
			drawMonth += 12;
			drawYear--;
		}
		if ( maxDate ) {
			maxDraw = this._daylightSavingAdjust( new Date( maxDate.getFullYear(),
				maxDate.getMonth() - ( numMonths[ 0 ] * numMonths[ 1 ] ) + 1, maxDate.getDate() ) );
			maxDraw = ( minDate && maxDraw < minDate ? minDate : maxDraw );
			while ( this._daylightSavingAdjust( new Date( drawYear, drawMonth, 1 ) ) > maxDraw ) {
				drawMonth--;
				if ( drawMonth < 0 ) {
					drawMonth = 11;
					drawYear--;
				}
			}
		}
		inst.drawMonth = drawMonth;
		inst.drawYear = drawYear;

		prevText = this._get( inst, "prevText" );
		prevText = ( !navigationAsDateFormat ? prevText : this.formatDate( prevText,
			this._daylightSavingAdjust( new Date( drawYear, drawMonth - stepMonths, 1 ) ),
			this._getFormatConfig( inst ) ) );

		prev = ( this._canAdjustMonth( inst, -1, drawYear, drawMonth ) ?
			"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click'" +
			" title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + ( isRTL ? "e" : "w" ) + "'>" + prevText + "</span></a>" :
			( hideIfNoPrevNext ? "" : "<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='" + prevText + "'><span class='ui-icon ui-icon-circle-triangle-" + ( isRTL ? "e" : "w" ) + "'>" + prevText + "</span></a>" ) );

		nextText = this._get( inst, "nextText" );
		nextText = ( !navigationAsDateFormat ? nextText : this.formatDate( nextText,
			this._daylightSavingAdjust( new Date( drawYear, drawMonth + stepMonths, 1 ) ),
			this._getFormatConfig( inst ) ) );

		next = ( this._canAdjustMonth( inst, +1, drawYear, drawMonth ) ?
			"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click'" +
			" title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + ( isRTL ? "w" : "e" ) + "'>" + nextText + "</span></a>" :
			( hideIfNoPrevNext ? "" : "<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='" + nextText + "'><span class='ui-icon ui-icon-circle-triangle-" + ( isRTL ? "w" : "e" ) + "'>" + nextText + "</span></a>" ) );

		currentText = this._get( inst, "currentText" );
		gotoDate = ( this._get( inst, "gotoCurrent" ) && inst.currentDay ? currentDate : today );
		currentText = ( !navigationAsDateFormat ? currentText :
			this.formatDate( currentText, gotoDate, this._getFormatConfig( inst ) ) );

		controls = ( !inst.inline ? "<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>" +
			this._get( inst, "closeText" ) + "</button>" : "" );

		buttonPanel = ( showButtonPanel ) ? "<div class='ui-datepicker-buttonpane ui-widget-content'>" + ( isRTL ? controls : "" ) +
			( this._isInRange( inst, gotoDate ) ? "<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'" +
			">" + currentText + "</button>" : "" ) + ( isRTL ? "" : controls ) + "</div>" : "";

		firstDay = parseInt( this._get( inst, "firstDay" ), 10 );
		firstDay = ( isNaN( firstDay ) ? 0 : firstDay );

		showWeek = this._get( inst, "showWeek" );
		dayNames = this._get( inst, "dayNames" );
		dayNamesMin = this._get( inst, "dayNamesMin" );
		monthNames = this._get( inst, "monthNames" );
		monthNamesShort = this._get( inst, "monthNamesShort" );
		beforeShowDay = this._get( inst, "beforeShowDay" );
		showOtherMonths = this._get( inst, "showOtherMonths" );
		selectOtherMonths = this._get( inst, "selectOtherMonths" );
		defaultDate = this._getDefaultDate( inst );
		html = "";

		for ( row = 0; row < numMonths[ 0 ]; row++ ) {
			group = "";
			this.maxRows = 4;
			for ( col = 0; col < numMonths[ 1 ]; col++ ) {
				selectedDate = this._daylightSavingAdjust( new Date( drawYear, drawMonth, inst.selectedDay ) );
				cornerClass = " ui-corner-all";
				calender = "";
				if ( isMultiMonth ) {
					calender += "<div class='ui-datepicker-group";
					if ( numMonths[ 1 ] > 1 ) {
						switch ( col ) {
							case 0: calender += " ui-datepicker-group-first";
								cornerClass = " ui-corner-" + ( isRTL ? "right" : "left" ); break;
							case numMonths[ 1 ] - 1: calender += " ui-datepicker-group-last";
								cornerClass = " ui-corner-" + ( isRTL ? "left" : "right" ); break;
							default: calender += " ui-datepicker-group-middle"; cornerClass = ""; break;
						}
					}
					calender += "'>";
				}
				calender += "<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix" + cornerClass + "'>" +
					( /all|left/.test( cornerClass ) && row === 0 ? ( isRTL ? next : prev ) : "" ) +
					( /all|right/.test( cornerClass ) && row === 0 ? ( isRTL ? prev : next ) : "" ) +
					this._generateMonthYearHeader( inst, drawMonth, drawYear, minDate, maxDate,
					row > 0 || col > 0, monthNames, monthNamesShort ) + // draw month headers
					"</div><table class='ui-datepicker-calendar'><thead>" +
					"<tr>";
				thead = ( showWeek ? "<th class='ui-datepicker-week-col'>" + this._get( inst, "weekHeader" ) + "</th>" : "" );
				for ( dow = 0; dow < 7; dow++ ) { // days of the week
					day = ( dow + firstDay ) % 7;
					thead += "<th scope='col'" + ( ( dow + firstDay + 6 ) % 7 >= 5 ? " class='ui-datepicker-week-end'" : "" ) + ">" +
						"<span title='" + dayNames[ day ] + "'>" + dayNamesMin[ day ] + "</span></th>";
				}
				calender += thead + "</tr></thead><tbody>";
				daysInMonth = this._getDaysInMonth( drawYear, drawMonth );
				if ( drawYear === inst.selectedYear && drawMonth === inst.selectedMonth ) {
					inst.selectedDay = Math.min( inst.selectedDay, daysInMonth );
				}
				leadDays = ( this._getFirstDayOfMonth( drawYear, drawMonth ) - firstDay + 7 ) % 7;
				curRows = Math.ceil( ( leadDays + daysInMonth ) / 7 ); // calculate the number of rows to generate
				numRows = ( isMultiMonth ? this.maxRows > curRows ? this.maxRows : curRows : curRows ); //If multiple months, use the higher number of rows (see #7043)
				this.maxRows = numRows;
				printDate = this._daylightSavingAdjust( new Date( drawYear, drawMonth, 1 - leadDays ) );
				for ( dRow = 0; dRow < numRows; dRow++ ) { // create date picker rows
					calender += "<tr>";
					tbody = ( !showWeek ? "" : "<td class='ui-datepicker-week-col'>" +
						this._get( inst, "calculateWeek" )( printDate ) + "</td>" );
					for ( dow = 0; dow < 7; dow++ ) { // create date picker days
						daySettings = ( beforeShowDay ?
							beforeShowDay.apply( ( inst.input ? inst.input[ 0 ] : null ), [ printDate ] ) : [ true, "" ] );
						otherMonth = ( printDate.getMonth() !== drawMonth );
						unselectable = ( otherMonth && !selectOtherMonths ) || !daySettings[ 0 ] ||
							( minDate && printDate < minDate ) || ( maxDate && printDate > maxDate );
						tbody += "<td class='" +
							( ( dow + firstDay + 6 ) % 7 >= 5 ? " ui-datepicker-week-end" : "" ) + // highlight weekends
							( otherMonth ? " ui-datepicker-other-month" : "" ) + // highlight days from other months
							( ( printDate.getTime() === selectedDate.getTime() && drawMonth === inst.selectedMonth && inst._keyEvent ) || // user pressed key
							( defaultDate.getTime() === printDate.getTime() && defaultDate.getTime() === selectedDate.getTime() ) ?

							// or defaultDate is current printedDate and defaultDate is selectedDate
							" " + this._dayOverClass : "" ) + // highlight selected day
							( unselectable ? " " + this._unselectableClass + " ui-state-disabled" : "" ) +  // highlight unselectable days
							( otherMonth && !showOtherMonths ? "" : " " + daySettings[ 1 ] + // highlight custom dates
							( printDate.getTime() === currentDate.getTime() ? " " + this._currentClass : "" ) + // highlight selected day
							( printDate.getTime() === today.getTime() ? " ui-datepicker-today" : "" ) ) + "'" + // highlight today (if different)
							( ( !otherMonth || showOtherMonths ) && daySettings[ 2 ] ? " title='" + daySettings[ 2 ].replace( /'/g, "&#39;" ) + "'" : "" ) + // cell title
							( unselectable ? "" : " data-handler='selectDay' data-event='click' data-month='" + printDate.getMonth() + "' data-year='" + printDate.getFullYear() + "'" ) + ">" + // actions
							( otherMonth && !showOtherMonths ? "&#xa0;" : // display for other months
							( unselectable ? "<span class='ui-state-default'>" + printDate.getDate() + "</span>" : "<a class='ui-state-default" +
							( printDate.getTime() === today.getTime() ? " ui-state-highlight" : "" ) +
							( printDate.getTime() === currentDate.getTime() ? " ui-state-active" : "" ) + // highlight selected day
							( otherMonth ? " ui-priority-secondary" : "" ) + // distinguish dates from other months
							"' href='#'>" + printDate.getDate() + "</a>" ) ) + "</td>"; // display selectable date
						printDate.setDate( printDate.getDate() + 1 );
						printDate = this._daylightSavingAdjust( printDate );
					}
					calender += tbody + "</tr>";
				}
				drawMonth++;
				if ( drawMonth > 11 ) {
					drawMonth = 0;
					drawYear++;
				}
				calender += "</tbody></table>" + ( isMultiMonth ? "</div>" +
							( ( numMonths[ 0 ] > 0 && col === numMonths[ 1 ] - 1 ) ? "<div class='ui-datepicker-row-break'></div>" : "" ) : "" );
				group += calender;
			}
			html += group;
		}
		html += buttonPanel;
		inst._keyEvent = false;
		return html;
	},

	/* Generate the month and year header. */
	_generateMonthYearHeader: function( inst, drawMonth, drawYear, minDate, maxDate,
			secondary, monthNames, monthNamesShort ) {

		var inMinYear, inMaxYear, month, years, thisYear, determineYear, year, endYear,
			changeMonth = this._get( inst, "changeMonth" ),
			changeYear = this._get( inst, "changeYear" ),
			showMonthAfterYear = this._get( inst, "showMonthAfterYear" ),
			html = "<div class='ui-datepicker-title'>",
			monthHtml = "";

		// Month selection
		if ( secondary || !changeMonth ) {
			monthHtml += "<span class='ui-datepicker-month'>" + monthNames[ drawMonth ] + "</span>";
		} else {
			inMinYear = ( minDate && minDate.getFullYear() === drawYear );
			inMaxYear = ( maxDate && maxDate.getFullYear() === drawYear );
			monthHtml += "<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";
			for ( month = 0; month < 12; month++ ) {
				if ( ( !inMinYear || month >= minDate.getMonth() ) && ( !inMaxYear || month <= maxDate.getMonth() ) ) {
					monthHtml += "<option value='" + month + "'" +
						( month === drawMonth ? " selected='selected'" : "" ) +
						">" + monthNamesShort[ month ] + "</option>";
				}
			}
			monthHtml += "</select>";
		}

		if ( !showMonthAfterYear ) {
			html += monthHtml + ( secondary || !( changeMonth && changeYear ) ? "&#xa0;" : "" );
		}

		// Year selection
		if ( !inst.yearshtml ) {
			inst.yearshtml = "";
			if ( secondary || !changeYear ) {
				html += "<span class='ui-datepicker-year'>" + drawYear + "</span>";
			} else {

				// determine range of years to display
				years = this._get( inst, "yearRange" ).split( ":" );
				thisYear = new Date().getFullYear();
				determineYear = function( value ) {
					var year = ( value.match( /c[+\-].*/ ) ? drawYear + parseInt( value.substring( 1 ), 10 ) :
						( value.match( /[+\-].*/ ) ? thisYear + parseInt( value, 10 ) :
						parseInt( value, 10 ) ) );
					return ( isNaN( year ) ? thisYear : year );
				};
				year = determineYear( years[ 0 ] );
				endYear = Math.max( year, determineYear( years[ 1 ] || "" ) );
				year = ( minDate ? Math.max( year, minDate.getFullYear() ) : year );
				endYear = ( maxDate ? Math.min( endYear, maxDate.getFullYear() ) : endYear );
				inst.yearshtml += "<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";
				for ( ; year <= endYear; year++ ) {
					inst.yearshtml += "<option value='" + year + "'" +
						( year === drawYear ? " selected='selected'" : "" ) +
						">" + year + "</option>";
				}
				inst.yearshtml += "</select>";

				html += inst.yearshtml;
				inst.yearshtml = null;
			}
		}

		html += this._get( inst, "yearSuffix" );
		if ( showMonthAfterYear ) {
			html += ( secondary || !( changeMonth && changeYear ) ? "&#xa0;" : "" ) + monthHtml;
		}
		html += "</div>"; // Close datepicker_header
		return html;
	},

	/* Adjust one of the date sub-fields. */
	_adjustInstDate: function( inst, offset, period ) {
		var year = inst.selectedYear + ( period === "Y" ? offset : 0 ),
			month = inst.selectedMonth + ( period === "M" ? offset : 0 ),
			day = Math.min( inst.selectedDay, this._getDaysInMonth( year, month ) ) + ( period === "D" ? offset : 0 ),
			date = this._restrictMinMax( inst, this._daylightSavingAdjust( new Date( year, month, day ) ) );

		inst.selectedDay = date.getDate();
		inst.drawMonth = inst.selectedMonth = date.getMonth();
		inst.drawYear = inst.selectedYear = date.getFullYear();
		if ( period === "M" || period === "Y" ) {
			this._notifyChange( inst );
		}
	},

	/* Ensure a date is within any min/max bounds. */
	_restrictMinMax: function( inst, date ) {
		var minDate = this._getMinMaxDate( inst, "min" ),
			maxDate = this._getMinMaxDate( inst, "max" ),
			newDate = ( minDate && date < minDate ? minDate : date );
		return ( maxDate && newDate > maxDate ? maxDate : newDate );
	},

	/* Notify change of month/year. */
	_notifyChange: function( inst ) {
		var onChange = this._get( inst, "onChangeMonthYear" );
		if ( onChange ) {
			onChange.apply( ( inst.input ? inst.input[ 0 ] : null ),
				[ inst.selectedYear, inst.selectedMonth + 1, inst ] );
		}
	},

	/* Determine the number of months to show. */
	_getNumberOfMonths: function( inst ) {
		var numMonths = this._get( inst, "numberOfMonths" );
		return ( numMonths == null ? [ 1, 1 ] : ( typeof numMonths === "number" ? [ 1, numMonths ] : numMonths ) );
	},

	/* Determine the current maximum date - ensure no time components are set. */
	_getMinMaxDate: function( inst, minMax ) {
		return this._determineDate( inst, this._get( inst, minMax + "Date" ), null );
	},

	/* Find the number of days in a given month. */
	_getDaysInMonth: function( year, month ) {
		return 32 - this._daylightSavingAdjust( new Date( year, month, 32 ) ).getDate();
	},

	/* Find the day of the week of the first of a month. */
	_getFirstDayOfMonth: function( year, month ) {
		return new Date( year, month, 1 ).getDay();
	},

	/* Determines if we should allow a "next/prev" month display change. */
	_canAdjustMonth: function( inst, offset, curYear, curMonth ) {
		var numMonths = this._getNumberOfMonths( inst ),
			date = this._daylightSavingAdjust( new Date( curYear,
			curMonth + ( offset < 0 ? offset : numMonths[ 0 ] * numMonths[ 1 ] ), 1 ) );

		if ( offset < 0 ) {
			date.setDate( this._getDaysInMonth( date.getFullYear(), date.getMonth() ) );
		}
		return this._isInRange( inst, date );
	},

	/* Is the given date in the accepted range? */
	_isInRange: function( inst, date ) {
		var yearSplit, currentYear,
			minDate = this._getMinMaxDate( inst, "min" ),
			maxDate = this._getMinMaxDate( inst, "max" ),
			minYear = null,
			maxYear = null,
			years = this._get( inst, "yearRange" );
			if ( years ) {
				yearSplit = years.split( ":" );
				currentYear = new Date().getFullYear();
				minYear = parseInt( yearSplit[ 0 ], 10 );
				maxYear = parseInt( yearSplit[ 1 ], 10 );
				if ( yearSplit[ 0 ].match( /[+\-].*/ ) ) {
					minYear += currentYear;
				}
				if ( yearSplit[ 1 ].match( /[+\-].*/ ) ) {
					maxYear += currentYear;
				}
			}

		return ( ( !minDate || date.getTime() >= minDate.getTime() ) &&
			( !maxDate || date.getTime() <= maxDate.getTime() ) &&
			( !minYear || date.getFullYear() >= minYear ) &&
			( !maxYear || date.getFullYear() <= maxYear ) );
	},

	/* Provide the configuration settings for formatting/parsing. */
	_getFormatConfig: function( inst ) {
		var shortYearCutoff = this._get( inst, "shortYearCutoff" );
		shortYearCutoff = ( typeof shortYearCutoff !== "string" ? shortYearCutoff :
			new Date().getFullYear() % 100 + parseInt( shortYearCutoff, 10 ) );
		return { shortYearCutoff: shortYearCutoff,
			dayNamesShort: this._get( inst, "dayNamesShort" ), dayNames: this._get( inst, "dayNames" ),
			monthNamesShort: this._get( inst, "monthNamesShort" ), monthNames: this._get( inst, "monthNames" ) };
	},

	/* Format the given date for display. */
	_formatDate: function( inst, day, month, year ) {
		if ( !day ) {
			inst.currentDay = inst.selectedDay;
			inst.currentMonth = inst.selectedMonth;
			inst.currentYear = inst.selectedYear;
		}
		var date = ( day ? ( typeof day === "object" ? day :
			this._daylightSavingAdjust( new Date( year, month, day ) ) ) :
			this._daylightSavingAdjust( new Date( inst.currentYear, inst.currentMonth, inst.currentDay ) ) );
		return this.formatDate( this._get( inst, "dateFormat" ), date, this._getFormatConfig( inst ) );
	}
} );

/*
 * Bind hover events for datepicker elements.
 * Done via delegate so the binding only occurs once in the lifetime of the parent div.
 * Global datepicker_instActive, set by _updateDatepicker allows the handlers to find their way back to the active picker.
 */
function datepicker_bindHover( dpDiv ) {
	var selector = "button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";
	return dpDiv.on( "mouseout", selector, function() {
			$( this ).removeClass( "ui-state-hover" );
			if ( this.className.indexOf( "ui-datepicker-prev" ) !== -1 ) {
				$( this ).removeClass( "ui-datepicker-prev-hover" );
			}
			if ( this.className.indexOf( "ui-datepicker-next" ) !== -1 ) {
				$( this ).removeClass( "ui-datepicker-next-hover" );
			}
		} )
		.on( "mouseover", selector, datepicker_handleMouseover );
}

function datepicker_handleMouseover() {
	if ( !$.datepicker._isDisabledDatepicker( datepicker_instActive.inline ? datepicker_instActive.dpDiv.parent()[ 0 ] : datepicker_instActive.input[ 0 ] ) ) {
		$( this ).parents( ".ui-datepicker-calendar" ).find( "a" ).removeClass( "ui-state-hover" );
		$( this ).addClass( "ui-state-hover" );
		if ( this.className.indexOf( "ui-datepicker-prev" ) !== -1 ) {
			$( this ).addClass( "ui-datepicker-prev-hover" );
		}
		if ( this.className.indexOf( "ui-datepicker-next" ) !== -1 ) {
			$( this ).addClass( "ui-datepicker-next-hover" );
		}
	}
}

/* jQuery extend now ignores nulls! */
function datepicker_extendRemove( target, props ) {
	$.extend( target, props );
	for ( var name in props ) {
		if ( props[ name ] == null ) {
			target[ name ] = props[ name ];
		}
	}
	return target;
}

/* Invoke the datepicker functionality.
   @param  options  string - a command, optionally followed by additional parameters or
					Object - settings for attaching new datepicker functionality
   @return  jQuery object */
$.fn.datepicker = function( options ) {

	/* Verify an empty collection wasn't passed - Fixes #6976 */
	if ( !this.length ) {
		return this;
	}

	/* Initialise the date picker. */
	if ( !$.datepicker.initialized ) {
		$( document ).on( "mousedown", $.datepicker._checkExternalClick );
		$.datepicker.initialized = true;
	}

	/* Append datepicker main container to body if not exist. */
	if ( $( "#" + $.datepicker._mainDivId ).length === 0 ) {
		$( "body" ).append( $.datepicker.dpDiv );
	}

	var otherArgs = Array.prototype.slice.call( arguments, 1 );
	if ( typeof options === "string" && ( options === "isDisabled" || options === "getDate" || options === "widget" ) ) {
		return $.datepicker[ "_" + options + "Datepicker" ].
			apply( $.datepicker, [ this[ 0 ] ].concat( otherArgs ) );
	}
	if ( options === "option" && arguments.length === 2 && typeof arguments[ 1 ] === "string" ) {
		return $.datepicker[ "_" + options + "Datepicker" ].
			apply( $.datepicker, [ this[ 0 ] ].concat( otherArgs ) );
	}
	return this.each( function() {
		typeof options === "string" ?
			$.datepicker[ "_" + options + "Datepicker" ].
				apply( $.datepicker, [ this ].concat( otherArgs ) ) :
			$.datepicker._attachDatepicker( this, options );
	} );
};

$.datepicker = new Datepicker(); // singleton instance
$.datepicker.initialized = false;
$.datepicker.uuid = new Date().getTime();
$.datepicker.version = "1.12.1";

var widgetsDatepicker = $.datepicker;




// This file is deprecated
var ie = $.ui.ie = !!/msie [\w.]+/.exec( navigator.userAgent.toLowerCase() );



//>>label: Mouse
//>>group: Widgets
//>>description: Abstracts mouse-based interactions to assist in creating certain widgets.



var mouseHandled = false;
$( document ).on( "mouseup", function() {
	mouseHandled = false;
} );

var widgetsMouse = $.widget( "ui.mouse", {
	version: "1.12.1",
	options: {
		cancel: "input, textarea, button, select, option",
		distance: 1,
		delay: 0
	},
	_mouseInit: function() {
		var that = this;

		this.element
			.on( "mousedown." + this.widgetName, function( event ) {
				return that._mouseDown( event );
			} )
			.on( "click." + this.widgetName, function( event ) {
				if ( true === $.data( event.target, that.widgetName + ".preventClickEvent" ) ) {
					$.removeData( event.target, that.widgetName + ".preventClickEvent" );
					event.stopImmediatePropagation();
					return false;
				}
			} );

		this.started = false;
	},

	// TODO: make sure destroying one instance of mouse doesn't mess with
	// other instances of mouse
	_mouseDestroy: function() {
		this.element.off( "." + this.widgetName );
		if ( this._mouseMoveDelegate ) {
			this.document
				.off( "mousemove." + this.widgetName, this._mouseMoveDelegate )
				.off( "mouseup." + this.widgetName, this._mouseUpDelegate );
		}
	},

	_mouseDown: function( event ) {

		// don't let more than one widget handle mouseStart
		if ( mouseHandled ) {
			return;
		}

		this._mouseMoved = false;

		// We may have missed mouseup (out of window)
		( this._mouseStarted && this._mouseUp( event ) );

		this._mouseDownEvent = event;

		var that = this,
			btnIsLeft = ( event.which === 1 ),

			// event.target.nodeName works around a bug in IE 8 with
			// disabled inputs (#7620)
			elIsCancel = ( typeof this.options.cancel === "string" && event.target.nodeName ?
				$( event.target ).closest( this.options.cancel ).length : false );
		if ( !btnIsLeft || elIsCancel || !this._mouseCapture( event ) ) {
			return true;
		}

		this.mouseDelayMet = !this.options.delay;
		if ( !this.mouseDelayMet ) {
			this._mouseDelayTimer = setTimeout( function() {
				that.mouseDelayMet = true;
			}, this.options.delay );
		}

		if ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {
			this._mouseStarted = ( this._mouseStart( event ) !== false );
			if ( !this._mouseStarted ) {
				event.preventDefault();
				return true;
			}
		}

		// Click event may never have fired (Gecko & Opera)
		if ( true === $.data( event.target, this.widgetName + ".preventClickEvent" ) ) {
			$.removeData( event.target, this.widgetName + ".preventClickEvent" );
		}

		// These delegates are required to keep context
		this._mouseMoveDelegate = function( event ) {
			return that._mouseMove( event );
		};
		this._mouseUpDelegate = function( event ) {
			return that._mouseUp( event );
		};

		this.document
			.on( "mousemove." + this.widgetName, this._mouseMoveDelegate )
			.on( "mouseup." + this.widgetName, this._mouseUpDelegate );

		event.preventDefault();

		mouseHandled = true;
		return true;
	},

	_mouseMove: function( event ) {

		// Only check for mouseups outside the document if you've moved inside the document
		// at least once. This prevents the firing of mouseup in the case of IE<9, which will
		// fire a mousemove event if content is placed under the cursor. See #7778
		// Support: IE <9
		if ( this._mouseMoved ) {

			// IE mouseup check - mouseup happened when mouse was out of window
			if ( $.ui.ie && ( !document.documentMode || document.documentMode < 9 ) &&
					!event.button ) {
				return this._mouseUp( event );

			// Iframe mouseup check - mouseup occurred in another document
			} else if ( !event.which ) {

				// Support: Safari <=8 - 9
				// Safari sets which to 0 if you press any of the following keys
				// during a drag (#14461)
				if ( event.originalEvent.altKey || event.originalEvent.ctrlKey ||
						event.originalEvent.metaKey || event.originalEvent.shiftKey ) {
					this.ignoreMissingWhich = true;
				} else if ( !this.ignoreMissingWhich ) {
					return this._mouseUp( event );
				}
			}
		}

		if ( event.which || event.button ) {
			this._mouseMoved = true;
		}

		if ( this._mouseStarted ) {
			this._mouseDrag( event );
			return event.preventDefault();
		}

		if ( this._mouseDistanceMet( event ) && this._mouseDelayMet( event ) ) {
			this._mouseStarted =
				( this._mouseStart( this._mouseDownEvent, event ) !== false );
			( this._mouseStarted ? this._mouseDrag( event ) : this._mouseUp( event ) );
		}

		return !this._mouseStarted;
	},

	_mouseUp: function( event ) {
		this.document
			.off( "mousemove." + this.widgetName, this._mouseMoveDelegate )
			.off( "mouseup." + this.widgetName, this._mouseUpDelegate );

		if ( this._mouseStarted ) {
			this._mouseStarted = false;

			if ( event.target === this._mouseDownEvent.target ) {
				$.data( event.target, this.widgetName + ".preventClickEvent", true );
			}

			this._mouseStop( event );
		}

		if ( this._mouseDelayTimer ) {
			clearTimeout( this._mouseDelayTimer );
			delete this._mouseDelayTimer;
		}

		this.ignoreMissingWhich = false;
		mouseHandled = false;
		event.preventDefault();
	},

	_mouseDistanceMet: function( event ) {
		return ( Math.max(
				Math.abs( this._mouseDownEvent.pageX - event.pageX ),
				Math.abs( this._mouseDownEvent.pageY - event.pageY )
			) >= this.options.distance
		);
	},

	_mouseDelayMet: function( /* event */ ) {
		return this.mouseDelayMet;
	},

	// These are placeholder methods, to be overriden by extending plugin
	_mouseStart: function( /* event */ ) {},
	_mouseDrag: function( /* event */ ) {},
	_mouseStop: function( /* event */ ) {},
	_mouseCapture: function( /* event */ ) { return true; }
} );




// $.ui.plugin is deprecated. Use $.widget() extensions instead.
var plugin = $.ui.plugin = {
	add: function( module, option, set ) {
		var i,
			proto = $.ui[ module ].prototype;
		for ( i in set ) {
			proto.plugins[ i ] = proto.plugins[ i ] || [];
			proto.plugins[ i ].push( [ option, set[ i ] ] );
		}
	},
	call: function( instance, name, args, allowDisconnected ) {
		var i,
			set = instance.plugins[ name ];

		if ( !set ) {
			return;
		}

		if ( !allowDisconnected && ( !instance.element[ 0 ].parentNode ||
				instance.element[ 0 ].parentNode.nodeType === 11 ) ) {
			return;
		}

		for ( i = 0; i < set.length; i++ ) {
			if ( instance.options[ set[ i ][ 0 ] ] ) {
				set[ i ][ 1 ].apply( instance.element, args );
			}
		}
	}
};



var safeBlur = $.ui.safeBlur = function( element ) {

	// Support: IE9 - 10 only
	// If the <body> is blurred, IE will switch windows, see #9420
	if ( element && element.nodeName.toLowerCase() !== "body" ) {
		$( element ).trigger( "blur" );
	}
};




//>>label: Draggable
//>>group: Interactions
//>>description: Enables dragging functionality for any element.
//>>css.structure: ../../themes/base/draggable.css



$.widget( "ui.draggable", $.ui.mouse, {
	version: "1.12.1",
	widgetEventPrefix: "drag",
	options: {
		addClasses: true,
		appendTo: "parent",
		axis: false,
		connectToSortable: false,
		containment: false,
		cursor: "auto",
		cursorAt: false,
		grid: false,
		handle: false,
		helper: "original",
		iframeFix: false,
		opacity: false,
		refreshPositions: false,
		revert: false,
		revertDuration: 500,
		scope: "default",
		scroll: true,
		scrollSensitivity: 20,
		scrollSpeed: 20,
		snap: false,
		snapMode: "both",
		snapTolerance: 20,
		stack: false,
		zIndex: false,

		// Callbacks
		drag: null,
		start: null,
		stop: null
	},
	_create: function() {

		if ( this.options.helper === "original" ) {
			this._setPositionRelative();
		}
		if ( this.options.addClasses ) {
			this._addClass( "ui-draggable" );
		}
		this._setHandleClassName();

		this._mouseInit();
	},

	_setOption: function( key, value ) {
		this._super( key, value );
		if ( key === "handle" ) {
			this._removeHandleClassName();
			this._setHandleClassName();
		}
	},

	_destroy: function() {
		if ( ( this.helper || this.element ).is( ".ui-draggable-dragging" ) ) {
			this.destroyOnClear = true;
			return;
		}
		this._removeHandleClassName();
		this._mouseDestroy();
	},

	_mouseCapture: function( event ) {
		var o = this.options;

		// Among others, prevent a drag on a resizable-handle
		if ( this.helper || o.disabled ||
				$( event.target ).closest( ".ui-resizable-handle" ).length > 0 ) {
			return false;
		}

		//Quit if we're not on a valid handle
		this.handle = this._getHandle( event );
		if ( !this.handle ) {
			return false;
		}

		this._blurActiveElement( event );

		this._blockFrames( o.iframeFix === true ? "iframe" : o.iframeFix );

		return true;

	},

	_blockFrames: function( selector ) {
		this.iframeBlocks = this.document.find( selector ).map( function() {
			var iframe = $( this );

			return $( "<div>" )
				.css( "position", "absolute" )
				.appendTo( iframe.parent() )
				.outerWidth( iframe.outerWidth() )
				.outerHeight( iframe.outerHeight() )
				.offset( iframe.offset() )[ 0 ];
		} );
	},

	_unblockFrames: function() {
		if ( this.iframeBlocks ) {
			this.iframeBlocks.remove();
			delete this.iframeBlocks;
		}
	},

	_blurActiveElement: function( event ) {
		var activeElement = $.ui.safeActiveElement( this.document[ 0 ] ),
			target = $( event.target );

		// Don't blur if the event occurred on an element that is within
		// the currently focused element
		// See #10527, #12472
		if ( target.closest( activeElement ).length ) {
			return;
		}

		// Blur any element that currently has focus, see #4261
		$.ui.safeBlur( activeElement );
	},

	_mouseStart: function( event ) {

		var o = this.options;

		//Create and append the visible helper
		this.helper = this._createHelper( event );

		this._addClass( this.helper, "ui-draggable-dragging" );

		//Cache the helper size
		this._cacheHelperProportions();

		//If ddmanager is used for droppables, set the global draggable
		if ( $.ui.ddmanager ) {
			$.ui.ddmanager.current = this;
		}

		/*
		 * - Position generation -
		 * This block generates everything position related - it's the core of draggables.
		 */

		//Cache the margins of the original element
		this._cacheMargins();

		//Store the helper's css position
		this.cssPosition = this.helper.css( "position" );
		this.scrollParent = this.helper.scrollParent( true );
		this.offsetParent = this.helper.offsetParent();
		this.hasFixedAncestor = this.helper.parents().filter( function() {
				return $( this ).css( "position" ) === "fixed";
			} ).length > 0;

		//The element's absolute position on the page minus margins
		this.positionAbs = this.element.offset();
		this._refreshOffsets( event );

		//Generate the original position
		this.originalPosition = this.position = this._generatePosition( event, false );
		this.originalPageX = event.pageX;
		this.originalPageY = event.pageY;

		//Adjust the mouse offset relative to the helper if "cursorAt" is supplied
		( o.cursorAt && this._adjustOffsetFromHelper( o.cursorAt ) );

		//Set a containment if given in the options
		this._setContainment();

		//Trigger event + callbacks
		if ( this._trigger( "start", event ) === false ) {
			this._clear();
			return false;
		}

		//Recache the helper size
		this._cacheHelperProportions();

		//Prepare the droppable offsets
		if ( $.ui.ddmanager && !o.dropBehaviour ) {
			$.ui.ddmanager.prepareOffsets( this, event );
		}

		// Execute the drag once - this causes the helper not to be visible before getting its
		// correct position
		this._mouseDrag( event, true );

		// If the ddmanager is used for droppables, inform the manager that dragging has started
		// (see #5003)
		if ( $.ui.ddmanager ) {
			$.ui.ddmanager.dragStart( this, event );
		}

		return true;
	},

	_refreshOffsets: function( event ) {
		this.offset = {
			top: this.positionAbs.top - this.margins.top,
			left: this.positionAbs.left - this.margins.left,
			scroll: false,
			parent: this._getParentOffset(),
			relative: this._getRelativeOffset()
		};

		this.offset.click = {
			left: event.pageX - this.offset.left,
			top: event.pageY - this.offset.top
		};
	},

	_mouseDrag: function( event, noPropagation ) {

		// reset any necessary cached properties (see #5009)
		if ( this.hasFixedAncestor ) {
			this.offset.parent = this._getParentOffset();
		}

		//Compute the helpers position
		this.position = this._generatePosition( event, true );
		this.positionAbs = this._convertPositionTo( "absolute" );

		//Call plugins and callbacks and use the resulting position if something is returned
		if ( !noPropagation ) {
			var ui = this._uiHash();
			if ( this._trigger( "drag", event, ui ) === false ) {
				this._mouseUp( new $.Event( "mouseup", event ) );
				return false;
			}
			this.position = ui.position;
		}

		this.helper[ 0 ].style.left = this.position.left + "px";
		this.helper[ 0 ].style.top = this.position.top + "px";

		if ( $.ui.ddmanager ) {
			$.ui.ddmanager.drag( this, event );
		}

		return false;
	},

	_mouseStop: function( event ) {

		//If we are using droppables, inform the manager about the drop
		var that = this,
			dropped = false;
		if ( $.ui.ddmanager && !this.options.dropBehaviour ) {
			dropped = $.ui.ddmanager.drop( this, event );
		}

		//if a drop comes from outside (a sortable)
		if ( this.dropped ) {
			dropped = this.dropped;
			this.dropped = false;
		}

		if ( ( this.options.revert === "invalid" && !dropped ) ||
				( this.options.revert === "valid" && dropped ) ||
				this.options.revert === true || ( $.isFunction( this.options.revert ) &&
				this.options.revert.call( this.element, dropped ) )
		) {
			$( this.helper ).animate(
				this.originalPosition,
				parseInt( this.options.revertDuration, 10 ),
				function() {
					if ( that._trigger( "stop", event ) !== false ) {
						that._clear();
					}
				}
			);
		} else {
			if ( this._trigger( "stop", event ) !== false ) {
				this._clear();
			}
		}

		return false;
	},

	_mouseUp: function( event ) {
		this._unblockFrames();

		// If the ddmanager is used for droppables, inform the manager that dragging has stopped
		// (see #5003)
		if ( $.ui.ddmanager ) {
			$.ui.ddmanager.dragStop( this, event );
		}

		// Only need to focus if the event occurred on the draggable itself, see #10527
		if ( this.handleElement.is( event.target ) ) {

			// The interaction is over; whether or not the click resulted in a drag,
			// focus the element
			this.element.trigger( "focus" );
		}

		return $.ui.mouse.prototype._mouseUp.call( this, event );
	},

	cancel: function() {

		if ( this.helper.is( ".ui-draggable-dragging" ) ) {
			this._mouseUp( new $.Event( "mouseup", { target: this.element[ 0 ] } ) );
		} else {
			this._clear();
		}

		return this;

	},

	_getHandle: function( event ) {
		return this.options.handle ?
			!!$( event.target ).closest( this.element.find( this.options.handle ) ).length :
			true;
	},

	_setHandleClassName: function() {
		this.handleElement = this.options.handle ?
			this.element.find( this.options.handle ) : this.element;
		this._addClass( this.handleElement, "ui-draggable-handle" );
	},

	_removeHandleClassName: function() {
		this._removeClass( this.handleElement, "ui-draggable-handle" );
	},

	_createHelper: function( event ) {

		var o = this.options,
			helperIsFunction = $.isFunction( o.helper ),
			helper = helperIsFunction ?
				$( o.helper.apply( this.element[ 0 ], [ event ] ) ) :
				( o.helper === "clone" ?
					this.element.clone().removeAttr( "id" ) :
					this.element );

		if ( !helper.parents( "body" ).length ) {
			helper.appendTo( ( o.appendTo === "parent" ?
				this.element[ 0 ].parentNode :
				o.appendTo ) );
		}

		// Http://bugs.jqueryui.com/ticket/9446
		// a helper function can return the original element
		// which wouldn't have been set to relative in _create
		if ( helperIsFunction && helper[ 0 ] === this.element[ 0 ] ) {
			this._setPositionRelative();
		}

		if ( helper[ 0 ] !== this.element[ 0 ] &&
				!( /(fixed|absolute)/ ).test( helper.css( "position" ) ) ) {
			helper.css( "position", "absolute" );
		}

		return helper;

	},

	_setPositionRelative: function() {
		if ( !( /^(?:r|a|f)/ ).test( this.element.css( "position" ) ) ) {
			this.element[ 0 ].style.position = "relative";
		}
	},

	_adjustOffsetFromHelper: function( obj ) {
		if ( typeof obj === "string" ) {
			obj = obj.split( " " );
		}
		if ( $.isArray( obj ) ) {
			obj = { left: +obj[ 0 ], top: +obj[ 1 ] || 0 };
		}
		if ( "left" in obj ) {
			this.offset.click.left = obj.left + this.margins.left;
		}
		if ( "right" in obj ) {
			this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
		}
		if ( "top" in obj ) {
			this.offset.click.top = obj.top + this.margins.top;
		}
		if ( "bottom" in obj ) {
			this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
		}
	},

	_isRootNode: function( element ) {
		return ( /(html|body)/i ).test( element.tagName ) || element === this.document[ 0 ];
	},

	_getParentOffset: function() {

		//Get the offsetParent and cache its position
		var po = this.offsetParent.offset(),
			document = this.document[ 0 ];

		// This is a special case where we need to modify a offset calculated on start, since the
		// following happened:
		// 1. The position of the helper is absolute, so it's position is calculated based on the
		// next positioned parent
		// 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
		// the document, which means that the scroll is included in the initial calculation of the
		// offset of the parent, and never recalculated upon drag
		if ( this.cssPosition === "absolute" && this.scrollParent[ 0 ] !== document &&
				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) {
			po.left += this.scrollParent.scrollLeft();
			po.top += this.scrollParent.scrollTop();
		}

		if ( this._isRootNode( this.offsetParent[ 0 ] ) ) {
			po = { top: 0, left: 0 };
		}

		return {
			top: po.top + ( parseInt( this.offsetParent.css( "borderTopWidth" ), 10 ) || 0 ),
			left: po.left + ( parseInt( this.offsetParent.css( "borderLeftWidth" ), 10 ) || 0 )
		};

	},

	_getRelativeOffset: function() {
		if ( this.cssPosition !== "relative" ) {
			return { top: 0, left: 0 };
		}

		var p = this.element.position(),
			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] );

		return {
			top: p.top - ( parseInt( this.helper.css( "top" ), 10 ) || 0 ) +
				( !scrollIsRootNode ? this.scrollParent.scrollTop() : 0 ),
			left: p.left - ( parseInt( this.helper.css( "left" ), 10 ) || 0 ) +
				( !scrollIsRootNode ? this.scrollParent.scrollLeft() : 0 )
		};

	},

	_cacheMargins: function() {
		this.margins = {
			left: ( parseInt( this.element.css( "marginLeft" ), 10 ) || 0 ),
			top: ( parseInt( this.element.css( "marginTop" ), 10 ) || 0 ),
			right: ( parseInt( this.element.css( "marginRight" ), 10 ) || 0 ),
			bottom: ( parseInt( this.element.css( "marginBottom" ), 10 ) || 0 )
		};
	},

	_cacheHelperProportions: function() {
		this.helperProportions = {
			width: this.helper.outerWidth(),
			height: this.helper.outerHeight()
		};
	},

	_setContainment: function() {

		var isUserScrollable, c, ce,
			o = this.options,
			document = this.document[ 0 ];

		this.relativeContainer = null;

		if ( !o.containment ) {
			this.containment = null;
			return;
		}

		if ( o.containment === "window" ) {
			this.containment = [
				$( window ).scrollLeft() - this.offset.relative.left - this.offset.parent.left,
				$( window ).scrollTop() - this.offset.relative.top - this.offset.parent.top,
				$( window ).scrollLeft() + $( window ).width() -
					this.helperProportions.width - this.margins.left,
				$( window ).scrollTop() +
					( $( window ).height() || document.body.parentNode.scrollHeight ) -
					this.helperProportions.height - this.margins.top
			];
			return;
		}

		if ( o.containment === "document" ) {
			this.containment = [
				0,
				0,
				$( document ).width() - this.helperProportions.width - this.margins.left,
				( $( document ).height() || document.body.parentNode.scrollHeight ) -
					this.helperProportions.height - this.margins.top
			];
			return;
		}

		if ( o.containment.constructor === Array ) {
			this.containment = o.containment;
			return;
		}

		if ( o.containment === "parent" ) {
			o.containment = this.helper[ 0 ].parentNode;
		}

		c = $( o.containment );
		ce = c[ 0 ];

		if ( !ce ) {
			return;
		}

		isUserScrollable = /(scroll|auto)/.test( c.css( "overflow" ) );

		this.containment = [
			( parseInt( c.css( "borderLeftWidth" ), 10 ) || 0 ) +
				( parseInt( c.css( "paddingLeft" ), 10 ) || 0 ),
			( parseInt( c.css( "borderTopWidth" ), 10 ) || 0 ) +
				( parseInt( c.css( "paddingTop" ), 10 ) || 0 ),
			( isUserScrollable ? Math.max( ce.scrollWidth, ce.offsetWidth ) : ce.offsetWidth ) -
				( parseInt( c.css( "borderRightWidth" ), 10 ) || 0 ) -
				( parseInt( c.css( "paddingRight" ), 10 ) || 0 ) -
				this.helperProportions.width -
				this.margins.left -
				this.margins.right,
			( isUserScrollable ? Math.max( ce.scrollHeight, ce.offsetHeight ) : ce.offsetHeight ) -
				( parseInt( c.css( "borderBottomWidth" ), 10 ) || 0 ) -
				( parseInt( c.css( "paddingBottom" ), 10 ) || 0 ) -
				this.helperProportions.height -
				this.margins.top -
				this.margins.bottom
		];
		this.relativeContainer = c;
	},

	_convertPositionTo: function( d, pos ) {

		if ( !pos ) {
			pos = this.position;
		}

		var mod = d === "absolute" ? 1 : -1,
			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] );

		return {
			top: (

				// The absolute mouse position
				pos.top	+

				// Only for relative positioned nodes: Relative offset from element to offset parent
				this.offset.relative.top * mod +

				// The offsetParent's offset without borders (offset + border)
				this.offset.parent.top * mod -
				( ( this.cssPosition === "fixed" ?
					-this.offset.scroll.top :
					( scrollIsRootNode ? 0 : this.offset.scroll.top ) ) * mod )
			),
			left: (

				// The absolute mouse position
				pos.left +

				// Only for relative positioned nodes: Relative offset from element to offset parent
				this.offset.relative.left * mod +

				// The offsetParent's offset without borders (offset + border)
				this.offset.parent.left * mod	-
				( ( this.cssPosition === "fixed" ?
					-this.offset.scroll.left :
					( scrollIsRootNode ? 0 : this.offset.scroll.left ) ) * mod )
			)
		};

	},

	_generatePosition: function( event, constrainPosition ) {

		var containment, co, top, left,
			o = this.options,
			scrollIsRootNode = this._isRootNode( this.scrollParent[ 0 ] ),
			pageX = event.pageX,
			pageY = event.pageY;

		// Cache the scroll
		if ( !scrollIsRootNode || !this.offset.scroll ) {
			this.offset.scroll = {
				top: this.scrollParent.scrollTop(),
				left: this.scrollParent.scrollLeft()
			};
		}

		/*
		 * - Position constraining -
		 * Constrain the position to a mix of grid, containment.
		 */

		// If we are not dragging yet, we won't check for options
		if ( constrainPosition ) {
			if ( this.containment ) {
				if ( this.relativeContainer ) {
					co = this.relativeContainer.offset();
					containment = [
						this.containment[ 0 ] + co.left,
						this.containment[ 1 ] + co.top,
						this.containment[ 2 ] + co.left,
						this.containment[ 3 ] + co.top
					];
				} else {
					containment = this.containment;
				}

				if ( event.pageX - this.offset.click.left < containment[ 0 ] ) {
					pageX = containment[ 0 ] + this.offset.click.left;
				}
				if ( event.pageY - this.offset.click.top < containment[ 1 ] ) {
					pageY = containment[ 1 ] + this.offset.click.top;
				}
				if ( event.pageX - this.offset.click.left > containment[ 2 ] ) {
					pageX = containment[ 2 ] + this.offset.click.left;
				}
				if ( event.pageY - this.offset.click.top > containment[ 3 ] ) {
					pageY = containment[ 3 ] + this.offset.click.top;
				}
			}

			if ( o.grid ) {

				//Check for grid elements set to 0 to prevent divide by 0 error causing invalid
				// argument errors in IE (see ticket #6950)
				top = o.grid[ 1 ] ? this.originalPageY + Math.round( ( pageY -
					this.originalPageY ) / o.grid[ 1 ] ) * o.grid[ 1 ] : this.originalPageY;
				pageY = containment ? ( ( top - this.offset.click.top >= containment[ 1 ] ||
					top - this.offset.click.top > containment[ 3 ] ) ?
						top :
						( ( top - this.offset.click.top >= containment[ 1 ] ) ?
							top - o.grid[ 1 ] : top + o.grid[ 1 ] ) ) : top;

				left = o.grid[ 0 ] ? this.originalPageX +
					Math.round( ( pageX - this.originalPageX ) / o.grid[ 0 ] ) * o.grid[ 0 ] :
					this.originalPageX;
				pageX = containment ? ( ( left - this.offset.click.left >= containment[ 0 ] ||
					left - this.offset.click.left > containment[ 2 ] ) ?
						left :
						( ( left - this.offset.click.left >= containment[ 0 ] ) ?
							left - o.grid[ 0 ] : left + o.grid[ 0 ] ) ) : left;
			}

			if ( o.axis === "y" ) {
				pageX = this.originalPageX;
			}

			if ( o.axis === "x" ) {
				pageY = this.originalPageY;
			}
		}

		return {
			top: (

				// The absolute mouse position
				pageY -

				// Click offset (relative to the element)
				this.offset.click.top -

				// Only for relative positioned nodes: Relative offset from element to offset parent
				this.offset.relative.top -

				// The offsetParent's offset without borders (offset + border)
				this.offset.parent.top +
				( this.cssPosition === "fixed" ?
					-this.offset.scroll.top :
					( scrollIsRootNode ? 0 : this.offset.scroll.top ) )
			),
			left: (

				// The absolute mouse position
				pageX -

				// Click offset (relative to the element)
				this.offset.click.left -

				// Only for relative positioned nodes: Relative offset from element to offset parent
				this.offset.relative.left -

				// The offsetParent's offset without borders (offset + border)
				this.offset.parent.left +
				( this.cssPosition === "fixed" ?
					-this.offset.scroll.left :
					( scrollIsRootNode ? 0 : this.offset.scroll.left ) )
			)
		};

	},

	_clear: function() {
		this._removeClass( this.helper, "ui-draggable-dragging" );
		if ( this.helper[ 0 ] !== this.element[ 0 ] && !this.cancelHelperRemoval ) {
			this.helper.remove();
		}
		this.helper = null;
		this.cancelHelperRemoval = false;
		if ( this.destroyOnClear ) {
			this.destroy();
		}
	},

	// From now on bulk stuff - mainly helpers

	_trigger: function( type, event, ui ) {
		ui = ui || this._uiHash();
		$.ui.plugin.call( this, type, [ event, ui, this ], true );

		// Absolute position and offset (see #6884 ) have to be recalculated after plugins
		if ( /^(drag|start|stop)/.test( type ) ) {
			this.positionAbs = this._convertPositionTo( "absolute" );
			ui.offset = this.positionAbs;
		}
		return $.Widget.prototype._trigger.call( this, type, event, ui );
	},

	plugins: {},

	_uiHash: function() {
		return {
			helper: this.helper,
			position: this.position,
			originalPosition: this.originalPosition,
			offset: this.positionAbs
		};
	}

} );

$.ui.plugin.add( "draggable", "connectToSortable", {
	start: function( event, ui, draggable ) {
		var uiSortable = $.extend( {}, ui, {
			item: draggable.element
		} );

		draggable.sortables = [];
		$( draggable.options.connectToSortable ).each( function() {
			var sortable = $( this ).sortable( "instance" );

			if ( sortable && !sortable.options.disabled ) {
				draggable.sortables.push( sortable );

				// RefreshPositions is called at drag start to refresh the containerCache
				// which is used in drag. This ensures it's initialized and synchronized
				// with any changes that might have happened on the page since initialization.
				sortable.refreshPositions();
				sortable._trigger( "activate", event, uiSortable );
			}
		} );
	},
	stop: function( event, ui, draggable ) {
		var uiSortable = $.extend( {}, ui, {
			item: draggable.element
		} );

		draggable.cancelHelperRemoval = false;

		$.each( draggable.sortables, function() {
			var sortable = this;

			if ( sortable.isOver ) {
				sortable.isOver = 0;

				// Allow this sortable to handle removing the helper
				draggable.cancelHelperRemoval = true;
				sortable.cancelHelperRemoval = false;

				// Use _storedCSS To restore properties in the sortable,
				// as this also handles revert (#9675) since the draggable
				// may have modified them in unexpected ways (#8809)
				sortable._storedCSS = {
					position: sortable.placeholder.css( "position" ),
					top: sortable.placeholder.css( "top" ),
					left: sortable.placeholder.css( "left" )
				};

				sortable._mouseStop( event );

				// Once drag has ended, the sortable should return to using
				// its original helper, not the shared helper from draggable
				sortable.options.helper = sortable.options._helper;
			} else {

				// Prevent this Sortable from removing the helper.
				// However, don't set the draggable to remove the helper
				// either as another connected Sortable may yet handle the removal.
				sortable.cancelHelperRemoval = true;

				sortable._trigger( "deactivate", event, uiSortable );
			}
		} );
	},
	drag: function( event, ui, draggable ) {
		$.each( draggable.sortables, function() {
			var innermostIntersecting = false,
				sortable = this;

			// Copy over variables that sortable's _intersectsWith uses
			sortable.positionAbs = draggable.positionAbs;
			sortable.helperProportions = draggable.helperProportions;
			sortable.offset.click = draggable.offset.click;

			if ( sortable._intersectsWith( sortable.containerCache ) ) {
				innermostIntersecting = true;

				$.each( draggable.sortables, function() {

					// Copy over variables that sortable's _intersectsWith uses
					this.positionAbs = draggable.positionAbs;
					this.helperProportions = draggable.helperProportions;
					this.offset.click = draggable.offset.click;

					if ( this !== sortable &&
							this._intersectsWith( this.containerCache ) &&
							$.contains( sortable.element[ 0 ], this.element[ 0 ] ) ) {
						innermostIntersecting = false;
					}

					return innermostIntersecting;
				} );
			}

			if ( innermostIntersecting ) {

				// If it intersects, we use a little isOver variable and set it once,
				// so that the move-in stuff gets fired only once.
				if ( !sortable.isOver ) {
					sortable.isOver = 1;

					// Store draggable's parent in case we need to reappend to it later.
					draggable._parent = ui.helper.parent();

					sortable.currentItem = ui.helper
						.appendTo( sortable.element )
						.data( "ui-sortable-item", true );

					// Store helper option to later restore it
					sortable.options._helper = sortable.options.helper;

					sortable.options.helper = function() {
						return ui.helper[ 0 ];
					};

					// Fire the start events of the sortable with our passed browser event,
					// and our own helper (so it doesn't create a new one)
					event.target = sortable.currentItem[ 0 ];
					sortable._mouseCapture( event, true );
					sortable._mouseStart( event, true, true );

					// Because the browser event is way off the new appended portlet,
					// modify necessary variables to reflect the changes
					sortable.offset.click.top = draggable.offset.click.top;
					sortable.offset.click.left = draggable.offset.click.left;
					sortable.offset.parent.left -= draggable.offset.parent.left -
						sortable.offset.parent.left;
					sortable.offset.parent.top -= draggable.offset.parent.top -
						sortable.offset.parent.top;

					draggable._trigger( "toSortable", event );

					// Inform draggable that the helper is in a valid drop zone,
					// used solely in the revert option to handle "valid/invalid".
					draggable.dropped = sortable.element;

					// Need to refreshPositions of all sortables in the case that
					// adding to one sortable changes the location of the other sortables (#9675)
					$.each( draggable.sortables, function() {
						this.refreshPositions();
					} );

					// Hack so receive/update callbacks work (mostly)
					draggable.currentItem = draggable.element;
					sortable.fromOutside = draggable;
				}

				if ( sortable.currentItem ) {
					sortable._mouseDrag( event );

					// Copy the sortable's position because the draggable's can potentially reflect
					// a relative position, while sortable is always absolute, which the dragged
					// element has now become. (#8809)
					ui.position = sortable.position;
				}
			} else {

				// If it doesn't intersect with the sortable, and it intersected before,
				// we fake the drag stop of the sortable, but make sure it doesn't remove
				// the helper by using cancelHelperRemoval.
				if ( sortable.isOver ) {

					sortable.isOver = 0;
					sortable.cancelHelperRemoval = true;

					// Calling sortable's mouseStop would trigger a revert,
					// so revert must be temporarily false until after mouseStop is called.
					sortable.options._revert = sortable.options.revert;
					sortable.options.revert = false;

					sortable._trigger( "out", event, sortable._uiHash( sortable ) );
					sortable._mouseStop( event, true );

					// Restore sortable behaviors that were modfied
					// when the draggable entered the sortable area (#9481)
					sortable.options.revert = sortable.options._revert;
					sortable.options.helper = sortable.options._helper;

					if ( sortable.placeholder ) {
						sortable.placeholder.remove();
					}

					// Restore and recalculate the draggable's offset considering the sortable
					// may have modified them in unexpected ways. (#8809, #10669)
					ui.helper.appendTo( draggable._parent );
					draggable._refreshOffsets( event );
					ui.position = draggable._generatePosition( event, true );

					draggable._trigger( "fromSortable", event );

					// Inform draggable that the helper is no longer in a valid drop zone
					draggable.dropped = false;

					// Need to refreshPositions of all sortables just in case removing
					// from one sortable changes the location of other sortables (#9675)
					$.each( draggable.sortables, function() {
						this.refreshPositions();
					} );
				}
			}
		} );
	}
} );

$.ui.plugin.add( "draggable", "cursor", {
	start: function( event, ui, instance ) {
		var t = $( "body" ),
			o = instance.options;

		if ( t.css( "cursor" ) ) {
			o._cursor = t.css( "cursor" );
		}
		t.css( "cursor", o.cursor );
	},
	stop: function( event, ui, instance ) {
		var o = instance.options;
		if ( o._cursor ) {
			$( "body" ).css( "cursor", o._cursor );
		}
	}
} );

$.ui.plugin.add( "draggable", "opacity", {
	start: function( event, ui, instance ) {
		var t = $( ui.helper ),
			o = instance.options;
		if ( t.css( "opacity" ) ) {
			o._opacity = t.css( "opacity" );
		}
		t.css( "opacity", o.opacity );
	},
	stop: function( event, ui, instance ) {
		var o = instance.options;
		if ( o._opacity ) {
			$( ui.helper ).css( "opacity", o._opacity );
		}
	}
} );

$.ui.plugin.add( "draggable", "scroll", {
	start: function( event, ui, i ) {
		if ( !i.scrollParentNotHidden ) {
			i.scrollParentNotHidden = i.helper.scrollParent( false );
		}

		if ( i.scrollParentNotHidden[ 0 ] !== i.document[ 0 ] &&
				i.scrollParentNotHidden[ 0 ].tagName !== "HTML" ) {
			i.overflowOffset = i.scrollParentNotHidden.offset();
		}
	},
	drag: function( event, ui, i  ) {

		var o = i.options,
			scrolled = false,
			scrollParent = i.scrollParentNotHidden[ 0 ],
			document = i.document[ 0 ];

		if ( scrollParent !== document && scrollParent.tagName !== "HTML" ) {
			if ( !o.axis || o.axis !== "x" ) {
				if ( ( i.overflowOffset.top + scrollParent.offsetHeight ) - event.pageY <
						o.scrollSensitivity ) {
					scrollParent.scrollTop = scrolled = scrollParent.scrollTop + o.scrollSpeed;
				} else if ( event.pageY - i.overflowOffset.top < o.scrollSensitivity ) {
					scrollParent.scrollTop = scrolled = scrollParent.scrollTop - o.scrollSpeed;
				}
			}

			if ( !o.axis || o.axis !== "y" ) {
				if ( ( i.overflowOffset.left + scrollParent.offsetWidth ) - event.pageX <
						o.scrollSensitivity ) {
					scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft + o.scrollSpeed;
				} else if ( event.pageX - i.overflowOffset.left < o.scrollSensitivity ) {
					scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft - o.scrollSpeed;
				}
			}

		} else {

			if ( !o.axis || o.axis !== "x" ) {
				if ( event.pageY - $( document ).scrollTop() < o.scrollSensitivity ) {
					scrolled = $( document ).scrollTop( $( document ).scrollTop() - o.scrollSpeed );
				} else if ( $( window ).height() - ( event.pageY - $( document ).scrollTop() ) <
						o.scrollSensitivity ) {
					scrolled = $( document ).scrollTop( $( document ).scrollTop() + o.scrollSpeed );
				}
			}

			if ( !o.axis || o.axis !== "y" ) {
				if ( event.pageX - $( document ).scrollLeft() < o.scrollSensitivity ) {
					scrolled = $( document ).scrollLeft(
						$( document ).scrollLeft() - o.scrollSpeed
					);
				} else if ( $( window ).width() - ( event.pageX - $( document ).scrollLeft() ) <
						o.scrollSensitivity ) {
					scrolled = $( document ).scrollLeft(
						$( document ).scrollLeft() + o.scrollSpeed
					);
				}
			}

		}

		if ( scrolled !== false && $.ui.ddmanager && !o.dropBehaviour ) {
			$.ui.ddmanager.prepareOffsets( i, event );
		}

	}
} );

$.ui.plugin.add( "draggable", "snap", {
	start: function( event, ui, i ) {

		var o = i.options;

		i.snapElements = [];

		$( o.snap.constructor !== String ? ( o.snap.items || ":data(ui-draggable)" ) : o.snap )
			.each( function() {
				var $t = $( this ),
					$o = $t.offset();
				if ( this !== i.element[ 0 ] ) {
					i.snapElements.push( {
						item: this,
						width: $t.outerWidth(), height: $t.outerHeight(),
						top: $o.top, left: $o.left
					} );
				}
			} );

	},
	drag: function( event, ui, inst ) {

		var ts, bs, ls, rs, l, r, t, b, i, first,
			o = inst.options,
			d = o.snapTolerance,
			x1 = ui.offset.left, x2 = x1 + inst.helperProportions.width,
			y1 = ui.offset.top, y2 = y1 + inst.helperProportions.height;

		for ( i = inst.snapElements.length - 1; i >= 0; i-- ) {

			l = inst.snapElements[ i ].left - inst.margins.left;
			r = l + inst.snapElements[ i ].width;
			t = inst.snapElements[ i ].top - inst.margins.top;
			b = t + inst.snapElements[ i ].height;

			if ( x2 < l - d || x1 > r + d || y2 < t - d || y1 > b + d ||
					!$.contains( inst.snapElements[ i ].item.ownerDocument,
					inst.snapElements[ i ].item ) ) {
				if ( inst.snapElements[ i ].snapping ) {
					( inst.options.snap.release &&
						inst.options.snap.release.call(
							inst.element,
							event,
							$.extend( inst._uiHash(), { snapItem: inst.snapElements[ i ].item } )
						) );
				}
				inst.snapElements[ i ].snapping = false;
				continue;
			}

			if ( o.snapMode !== "inner" ) {
				ts = Math.abs( t - y2 ) <= d;
				bs = Math.abs( b - y1 ) <= d;
				ls = Math.abs( l - x2 ) <= d;
				rs = Math.abs( r - x1 ) <= d;
				if ( ts ) {
					ui.position.top = inst._convertPositionTo( "relative", {
						top: t - inst.helperProportions.height,
						left: 0
					} ).top;
				}
				if ( bs ) {
					ui.position.top = inst._convertPositionTo( "relative", {
						top: b,
						left: 0
					} ).top;
				}
				if ( ls ) {
					ui.position.left = inst._convertPositionTo( "relative", {
						top: 0,
						left: l - inst.helperProportions.width
					} ).left;
				}
				if ( rs ) {
					ui.position.left = inst._convertPositionTo( "relative", {
						top: 0,
						left: r
					} ).left;
				}
			}

			first = ( ts || bs || ls || rs );

			if ( o.snapMode !== "outer" ) {
				ts = Math.abs( t - y1 ) <= d;
				bs = Math.abs( b - y2 ) <= d;
				ls = Math.abs( l - x1 ) <= d;
				rs = Math.abs( r - x2 ) <= d;
				if ( ts ) {
					ui.position.top = inst._convertPositionTo( "relative", {
						top: t,
						left: 0
					} ).top;
				}
				if ( bs ) {
					ui.position.top = inst._convertPositionTo( "relative", {
						top: b - inst.helperProportions.height,
						left: 0
					} ).top;
				}
				if ( ls ) {
					ui.position.left = inst._convertPositionTo( "relative", {
						top: 0,
						left: l
					} ).left;
				}
				if ( rs ) {
					ui.position.left = inst._convertPositionTo( "relative", {
						top: 0,
						left: r - inst.helperProportions.width
					} ).left;
				}
			}

			if ( !inst.snapElements[ i ].snapping && ( ts || bs || ls || rs || first ) ) {
				( inst.options.snap.snap &&
					inst.options.snap.snap.call(
						inst.element,
						event,
						$.extend( inst._uiHash(), {
							snapItem: inst.snapElements[ i ].item
						} ) ) );
			}
			inst.snapElements[ i ].snapping = ( ts || bs || ls || rs || first );

		}

	}
} );

$.ui.plugin.add( "draggable", "stack", {
	start: function( event, ui, instance ) {
		var min,
			o = instance.options,
			group = $.makeArray( $( o.stack ) ).sort( function( a, b ) {
				return ( parseInt( $( a ).css( "zIndex" ), 10 ) || 0 ) -
					( parseInt( $( b ).css( "zIndex" ), 10 ) || 0 );
			} );

		if ( !group.length ) { return; }

		min = parseInt( $( group[ 0 ] ).css( "zIndex" ), 10 ) || 0;
		$( group ).each( function( i ) {
			$( this ).css( "zIndex", min + i );
		} );
		this.css( "zIndex", ( min + group.length ) );
	}
} );

$.ui.plugin.add( "draggable", "zIndex", {
	start: function( event, ui, instance ) {
		var t = $( ui.helper ),
			o = instance.options;

		if ( t.css( "zIndex" ) ) {
			o._zIndex = t.css( "zIndex" );
		}
		t.css( "zIndex", o.zIndex );
	},
	stop: function( event, ui, instance ) {
		var o = instance.options;

		if ( o._zIndex ) {
			$( ui.helper ).css( "zIndex", o._zIndex );
		}
	}
} );

var widgetsDraggable = $.ui.draggable;



//>>label: Resizable
//>>group: Interactions
//>>description: Enables resize functionality for any element.
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/resizable.css
//>>css.theme: ../../themes/base/theme.css



$.widget( "ui.resizable", $.ui.mouse, {
	version: "1.12.1",
	widgetEventPrefix: "resize",
	options: {
		alsoResize: false,
		animate: false,
		animateDuration: "slow",
		animateEasing: "swing",
		aspectRatio: false,
		autoHide: false,
		classes: {
			"ui-resizable-se": "ui-icon ui-icon-gripsmall-diagonal-se"
		},
		containment: false,
		ghost: false,
		grid: false,
		handles: "e,s,se",
		helper: false,
		maxHeight: null,
		maxWidth: null,
		minHeight: 10,
		minWidth: 10,

		// See #7960
		zIndex: 90,

		// Callbacks
		resize: null,
		start: null,
		stop: null
	},

	_num: function( value ) {
		return parseFloat( value ) || 0;
	},

	_isNumber: function( value ) {
		return !isNaN( parseFloat( value ) );
	},

	_hasScroll: function( el, a ) {

		if ( $( el ).css( "overflow" ) === "hidden" ) {
			return false;
		}

		var scroll = ( a && a === "left" ) ? "scrollLeft" : "scrollTop",
			has = false;

		if ( el[ scroll ] > 0 ) {
			return true;
		}

		// TODO: determine which cases actually cause this to happen
		// if the element doesn't have the scroll set, see if it's possible to
		// set the scroll
		el[ scroll ] = 1;
		has = ( el[ scroll ] > 0 );
		el[ scroll ] = 0;
		return has;
	},

	_create: function() {

		var margins,
			o = this.options,
			that = this;
		this._addClass( "ui-resizable" );

		$.extend( this, {
			_aspectRatio: !!( o.aspectRatio ),
			aspectRatio: o.aspectRatio,
			originalElement: this.element,
			_proportionallyResizeElements: [],
			_helper: o.helper || o.ghost || o.animate ? o.helper || "ui-resizable-helper" : null
		} );

		// Wrap the element if it cannot hold child nodes
		if ( this.element[ 0 ].nodeName.match( /^(canvas|textarea|input|select|button|img)$/i ) ) {

			this.element.wrap(
				$( "<div class='ui-wrapper' style='overflow: hidden;'></div>" ).css( {
					position: this.element.css( "position" ),
					width: this.element.outerWidth(),
					height: this.element.outerHeight(),
					top: this.element.css( "top" ),
					left: this.element.css( "left" )
				} )
			);

			this.element = this.element.parent().data(
				"ui-resizable", this.element.resizable( "instance" )
			);

			this.elementIsWrapper = true;

			margins = {
				marginTop: this.originalElement.css( "marginTop" ),
				marginRight: this.originalElement.css( "marginRight" ),
				marginBottom: this.originalElement.css( "marginBottom" ),
				marginLeft: this.originalElement.css( "marginLeft" )
			};

			this.element.css( margins );
			this.originalElement.css( "margin", 0 );

			// support: Safari
			// Prevent Safari textarea resize
			this.originalResizeStyle = this.originalElement.css( "resize" );
			this.originalElement.css( "resize", "none" );

			this._proportionallyResizeElements.push( this.originalElement.css( {
				position: "static",
				zoom: 1,
				display: "block"
			} ) );

			// Support: IE9
			// avoid IE jump (hard set the margin)
			this.originalElement.css( margins );

			this._proportionallyResize();
		}

		this._setupHandles();

		if ( o.autoHide ) {
			$( this.element )
				.on( "mouseenter", function() {
					if ( o.disabled ) {
						return;
					}
					that._removeClass( "ui-resizable-autohide" );
					that._handles.show();
				} )
				.on( "mouseleave", function() {
					if ( o.disabled ) {
						return;
					}
					if ( !that.resizing ) {
						that._addClass( "ui-resizable-autohide" );
						that._handles.hide();
					}
				} );
		}

		this._mouseInit();
	},

	_destroy: function() {

		this._mouseDestroy();

		var wrapper,
			_destroy = function( exp ) {
				$( exp )
					.removeData( "resizable" )
					.removeData( "ui-resizable" )
					.off( ".resizable" )
					.find( ".ui-resizable-handle" )
						.remove();
			};

		// TODO: Unwrap at same DOM position
		if ( this.elementIsWrapper ) {
			_destroy( this.element );
			wrapper = this.element;
			this.originalElement.css( {
				position: wrapper.css( "position" ),
				width: wrapper.outerWidth(),
				height: wrapper.outerHeight(),
				top: wrapper.css( "top" ),
				left: wrapper.css( "left" )
			} ).insertAfter( wrapper );
			wrapper.remove();
		}

		this.originalElement.css( "resize", this.originalResizeStyle );
		_destroy( this.originalElement );

		return this;
	},

	_setOption: function( key, value ) {
		this._super( key, value );

		switch ( key ) {
		case "handles":
			this._removeHandles();
			this._setupHandles();
			break;
		default:
			break;
		}
	},

	_setupHandles: function() {
		var o = this.options, handle, i, n, hname, axis, that = this;
		this.handles = o.handles ||
			( !$( ".ui-resizable-handle", this.element ).length ?
				"e,s,se" : {
					n: ".ui-resizable-n",
					e: ".ui-resizable-e",
					s: ".ui-resizable-s",
					w: ".ui-resizable-w",
					se: ".ui-resizable-se",
					sw: ".ui-resizable-sw",
					ne: ".ui-resizable-ne",
					nw: ".ui-resizable-nw"
				} );

		this._handles = $();
		if ( this.handles.constructor === String ) {

			if ( this.handles === "all" ) {
				this.handles = "n,e,s,w,se,sw,ne,nw";
			}

			n = this.handles.split( "," );
			this.handles = {};

			for ( i = 0; i < n.length; i++ ) {

				handle = $.trim( n[ i ] );
				hname = "ui-resizable-" + handle;
				axis = $( "<div>" );
				this._addClass( axis, "ui-resizable-handle " + hname );

				axis.css( { zIndex: o.zIndex } );

				this.handles[ handle ] = ".ui-resizable-" + handle;
				this.element.append( axis );
			}

		}

		this._renderAxis = function( target ) {

			var i, axis, padPos, padWrapper;

			target = target || this.element;

			for ( i in this.handles ) {

				if ( this.handles[ i ].constructor === String ) {
					this.handles[ i ] = this.element.children( this.handles[ i ] ).first().show();
				} else if ( this.handles[ i ].jquery || this.handles[ i ].nodeType ) {
					this.handles[ i ] = $( this.handles[ i ] );
					this._on( this.handles[ i ], { "mousedown": that._mouseDown } );
				}

				if ( this.elementIsWrapper &&
						this.originalElement[ 0 ]
							.nodeName
							.match( /^(textarea|input|select|button)$/i ) ) {
					axis = $( this.handles[ i ], this.element );

					padWrapper = /sw|ne|nw|se|n|s/.test( i ) ?
						axis.outerHeight() :
						axis.outerWidth();

					padPos = [ "padding",
						/ne|nw|n/.test( i ) ? "Top" :
						/se|sw|s/.test( i ) ? "Bottom" :
						/^e$/.test( i ) ? "Right" : "Left" ].join( "" );

					target.css( padPos, padWrapper );

					this._proportionallyResize();
				}

				this._handles = this._handles.add( this.handles[ i ] );
			}
		};

		// TODO: make renderAxis a prototype function
		this._renderAxis( this.element );

		this._handles = this._handles.add( this.element.find( ".ui-resizable-handle" ) );
		this._handles.disableSelection();

		this._handles.on( "mouseover", function() {
			if ( !that.resizing ) {
				if ( this.className ) {
					axis = this.className.match( /ui-resizable-(se|sw|ne|nw|n|e|s|w)/i );
				}
				that.axis = axis && axis[ 1 ] ? axis[ 1 ] : "se";
			}
		} );

		if ( o.autoHide ) {
			this._handles.hide();
			this._addClass( "ui-resizable-autohide" );
		}
	},

	_removeHandles: function() {
		this._handles.remove();
	},

	_mouseCapture: function( event ) {
		var i, handle,
			capture = false;

		for ( i in this.handles ) {
			handle = $( this.handles[ i ] )[ 0 ];
			if ( handle === event.target || $.contains( handle, event.target ) ) {
				capture = true;
			}
		}

		return !this.options.disabled && capture;
	},

	_mouseStart: function( event ) {

		var curleft, curtop, cursor,
			o = this.options,
			el = this.element;

		this.resizing = true;

		this._renderProxy();

		curleft = this._num( this.helper.css( "left" ) );
		curtop = this._num( this.helper.css( "top" ) );

		if ( o.containment ) {
			curleft += $( o.containment ).scrollLeft() || 0;
			curtop += $( o.containment ).scrollTop() || 0;
		}

		this.offset = this.helper.offset();
		this.position = { left: curleft, top: curtop };

		this.size = this._helper ? {
				width: this.helper.width(),
				height: this.helper.height()
			} : {
				width: el.width(),
				height: el.height()
			};

		this.originalSize = this._helper ? {
				width: el.outerWidth(),
				height: el.outerHeight()
			} : {
				width: el.width(),
				height: el.height()
			};

		this.sizeDiff = {
			width: el.outerWidth() - el.width(),
			height: el.outerHeight() - el.height()
		};

		this.originalPosition = { left: curleft, top: curtop };
		this.originalMousePosition = { left: event.pageX, top: event.pageY };

		this.aspectRatio = ( typeof o.aspectRatio === "number" ) ?
			o.aspectRatio :
			( ( this.originalSize.width / this.originalSize.height ) || 1 );

		cursor = $( ".ui-resizable-" + this.axis ).css( "cursor" );
		$( "body" ).css( "cursor", cursor === "auto" ? this.axis + "-resize" : cursor );

		this._addClass( "ui-resizable-resizing" );
		this._propagate( "start", event );
		return true;
	},

	_mouseDrag: function( event ) {

		var data, props,
			smp = this.originalMousePosition,
			a = this.axis,
			dx = ( event.pageX - smp.left ) || 0,
			dy = ( event.pageY - smp.top ) || 0,
			trigger = this._change[ a ];

		this._updatePrevProperties();

		if ( !trigger ) {
			return false;
		}

		data = trigger.apply( this, [ event, dx, dy ] );

		this._updateVirtualBoundaries( event.shiftKey );
		if ( this._aspectRatio || event.shiftKey ) {
			data = this._updateRatio( data, event );
		}

		data = this._respectSize( data, event );

		this._updateCache( data );

		this._propagate( "resize", event );

		props = this._applyChanges();

		if ( !this._helper && this._proportionallyResizeElements.length ) {
			this._proportionallyResize();
		}

		if ( !$.isEmptyObject( props ) ) {
			this._updatePrevProperties();
			this._trigger( "resize", event, this.ui() );
			this._applyChanges();
		}

		return false;
	},

	_mouseStop: function( event ) {

		this.resizing = false;
		var pr, ista, soffseth, soffsetw, s, left, top,
			o = this.options, that = this;

		if ( this._helper ) {

			pr = this._proportionallyResizeElements;
			ista = pr.length && ( /textarea/i ).test( pr[ 0 ].nodeName );
			soffseth = ista && this._hasScroll( pr[ 0 ], "left" ) ? 0 : that.sizeDiff.height;
			soffsetw = ista ? 0 : that.sizeDiff.width;

			s = {
				width: ( that.helper.width()  - soffsetw ),
				height: ( that.helper.height() - soffseth )
			};
			left = ( parseFloat( that.element.css( "left" ) ) +
				( that.position.left - that.originalPosition.left ) ) || null;
			top = ( parseFloat( that.element.css( "top" ) ) +
				( that.position.top - that.originalPosition.top ) ) || null;

			if ( !o.animate ) {
				this.element.css( $.extend( s, { top: top, left: left } ) );
			}

			that.helper.height( that.size.height );
			that.helper.width( that.size.width );

			if ( this._helper && !o.animate ) {
				this._proportionallyResize();
			}
		}

		$( "body" ).css( "cursor", "auto" );

		this._removeClass( "ui-resizable-resizing" );

		this._propagate( "stop", event );

		if ( this._helper ) {
			this.helper.remove();
		}

		return false;

	},

	_updatePrevProperties: function() {
		this.prevPosition = {
			top: this.position.top,
			left: this.position.left
		};
		this.prevSize = {
			width: this.size.width,
			height: this.size.height
		};
	},

	_applyChanges: function() {
		var props = {};

		if ( this.position.top !== this.prevPosition.top ) {
			props.top = this.position.top + "px";
		}
		if ( this.position.left !== this.prevPosition.left ) {
			props.left = this.position.left + "px";
		}
		if ( this.size.width !== this.prevSize.width ) {
			props.width = this.size.width + "px";
		}
		if ( this.size.height !== this.prevSize.height ) {
			props.height = this.size.height + "px";
		}

		this.helper.css( props );

		return props;
	},

	_updateVirtualBoundaries: function( forceAspectRatio ) {
		var pMinWidth, pMaxWidth, pMinHeight, pMaxHeight, b,
			o = this.options;

		b = {
			minWidth: this._isNumber( o.minWidth ) ? o.minWidth : 0,
			maxWidth: this._isNumber( o.maxWidth ) ? o.maxWidth : Infinity,
			minHeight: this._isNumber( o.minHeight ) ? o.minHeight : 0,
			maxHeight: this._isNumber( o.maxHeight ) ? o.maxHeight : Infinity
		};

		if ( this._aspectRatio || forceAspectRatio ) {
			pMinWidth = b.minHeight * this.aspectRatio;
			pMinHeight = b.minWidth / this.aspectRatio;
			pMaxWidth = b.maxHeight * this.aspectRatio;
			pMaxHeight = b.maxWidth / this.aspectRatio;

			if ( pMinWidth > b.minWidth ) {
				b.minWidth = pMinWidth;
			}
			if ( pMinHeight > b.minHeight ) {
				b.minHeight = pMinHeight;
			}
			if ( pMaxWidth < b.maxWidth ) {
				b.maxWidth = pMaxWidth;
			}
			if ( pMaxHeight < b.maxHeight ) {
				b.maxHeight = pMaxHeight;
			}
		}
		this._vBoundaries = b;
	},

	_updateCache: function( data ) {
		this.offset = this.helper.offset();
		if ( this._isNumber( data.left ) ) {
			this.position.left = data.left;
		}
		if ( this._isNumber( data.top ) ) {
			this.position.top = data.top;
		}
		if ( this._isNumber( data.height ) ) {
			this.size.height = data.height;
		}
		if ( this._isNumber( data.width ) ) {
			this.size.width = data.width;
		}
	},

	_updateRatio: function( data ) {

		var cpos = this.position,
			csize = this.size,
			a = this.axis;

		if ( this._isNumber( data.height ) ) {
			data.width = ( data.height * this.aspectRatio );
		} else if ( this._isNumber( data.width ) ) {
			data.height = ( data.width / this.aspectRatio );
		}

		if ( a === "sw" ) {
			data.left = cpos.left + ( csize.width - data.width );
			data.top = null;
		}
		if ( a === "nw" ) {
			data.top = cpos.top + ( csize.height - data.height );
			data.left = cpos.left + ( csize.width - data.width );
		}

		return data;
	},

	_respectSize: function( data ) {

		var o = this._vBoundaries,
			a = this.axis,
			ismaxw = this._isNumber( data.width ) && o.maxWidth && ( o.maxWidth < data.width ),
			ismaxh = this._isNumber( data.height ) && o.maxHeight && ( o.maxHeight < data.height ),
			isminw = this._isNumber( data.width ) && o.minWidth && ( o.minWidth > data.width ),
			isminh = this._isNumber( data.height ) && o.minHeight && ( o.minHeight > data.height ),
			dw = this.originalPosition.left + this.originalSize.width,
			dh = this.originalPosition.top + this.originalSize.height,
			cw = /sw|nw|w/.test( a ), ch = /nw|ne|n/.test( a );
		if ( isminw ) {
			data.width = o.minWidth;
		}
		if ( isminh ) {
			data.height = o.minHeight;
		}
		if ( ismaxw ) {
			data.width = o.maxWidth;
		}
		if ( ismaxh ) {
			data.height = o.maxHeight;
		}

		if ( isminw && cw ) {
			data.left = dw - o.minWidth;
		}
		if ( ismaxw && cw ) {
			data.left = dw - o.maxWidth;
		}
		if ( isminh && ch ) {
			data.top = dh - o.minHeight;
		}
		if ( ismaxh && ch ) {
			data.top = dh - o.maxHeight;
		}

		// Fixing jump error on top/left - bug #2330
		if ( !data.width && !data.height && !data.left && data.top ) {
			data.top = null;
		} else if ( !data.width && !data.height && !data.top && data.left ) {
			data.left = null;
		}

		return data;
	},

	_getPaddingPlusBorderDimensions: function( element ) {
		var i = 0,
			widths = [],
			borders = [
				element.css( "borderTopWidth" ),
				element.css( "borderRightWidth" ),
				element.css( "borderBottomWidth" ),
				element.css( "borderLeftWidth" )
			],
			paddings = [
				element.css( "paddingTop" ),
				element.css( "paddingRight" ),
				element.css( "paddingBottom" ),
				element.css( "paddingLeft" )
			];

		for ( ; i < 4; i++ ) {
			widths[ i ] = ( parseFloat( borders[ i ] ) || 0 );
			widths[ i ] += ( parseFloat( paddings[ i ] ) || 0 );
		}

		return {
			height: widths[ 0 ] + widths[ 2 ],
			width: widths[ 1 ] + widths[ 3 ]
		};
	},

	_proportionallyResize: function() {

		if ( !this._proportionallyResizeElements.length ) {
			return;
		}

		var prel,
			i = 0,
			element = this.helper || this.element;

		for ( ; i < this._proportionallyResizeElements.length; i++ ) {

			prel = this._proportionallyResizeElements[ i ];

			// TODO: Seems like a bug to cache this.outerDimensions
			// considering that we are in a loop.
			if ( !this.outerDimensions ) {
				this.outerDimensions = this._getPaddingPlusBorderDimensions( prel );
			}

			prel.css( {
				height: ( element.height() - this.outerDimensions.height ) || 0,
				width: ( element.width() - this.outerDimensions.width ) || 0
			} );

		}

	},

	_renderProxy: function() {

		var el = this.element, o = this.options;
		this.elementOffset = el.offset();

		if ( this._helper ) {

			this.helper = this.helper || $( "<div style='overflow:hidden;'></div>" );

			this._addClass( this.helper, this._helper );
			this.helper.css( {
				width: this.element.outerWidth(),
				height: this.element.outerHeight(),
				position: "absolute",
				left: this.elementOffset.left + "px",
				top: this.elementOffset.top + "px",
				zIndex: ++o.zIndex //TODO: Don't modify option
			} );

			this.helper
				.appendTo( "body" )
				.disableSelection();

		} else {
			this.helper = this.element;
		}

	},

	_change: {
		e: function( event, dx ) {
			return { width: this.originalSize.width + dx };
		},
		w: function( event, dx ) {
			var cs = this.originalSize, sp = this.originalPosition;
			return { left: sp.left + dx, width: cs.width - dx };
		},
		n: function( event, dx, dy ) {
			var cs = this.originalSize, sp = this.originalPosition;
			return { top: sp.top + dy, height: cs.height - dy };
		},
		s: function( event, dx, dy ) {
			return { height: this.originalSize.height + dy };
		},
		se: function( event, dx, dy ) {
			return $.extend( this._change.s.apply( this, arguments ),
				this._change.e.apply( this, [ event, dx, dy ] ) );
		},
		sw: function( event, dx, dy ) {
			return $.extend( this._change.s.apply( this, arguments ),
				this._change.w.apply( this, [ event, dx, dy ] ) );
		},
		ne: function( event, dx, dy ) {
			return $.extend( this._change.n.apply( this, arguments ),
				this._change.e.apply( this, [ event, dx, dy ] ) );
		},
		nw: function( event, dx, dy ) {
			return $.extend( this._change.n.apply( this, arguments ),
				this._change.w.apply( this, [ event, dx, dy ] ) );
		}
	},

	_propagate: function( n, event ) {
		$.ui.plugin.call( this, n, [ event, this.ui() ] );
		( n !== "resize" && this._trigger( n, event, this.ui() ) );
	},

	plugins: {},

	ui: function() {
		return {
			originalElement: this.originalElement,
			element: this.element,
			helper: this.helper,
			position: this.position,
			size: this.size,
			originalSize: this.originalSize,
			originalPosition: this.originalPosition
		};
	}

} );

/*
 * Resizable Extensions
 */

$.ui.plugin.add( "resizable", "animate", {

	stop: function( event ) {
		var that = $( this ).resizable( "instance" ),
			o = that.options,
			pr = that._proportionallyResizeElements,
			ista = pr.length && ( /textarea/i ).test( pr[ 0 ].nodeName ),
			soffseth = ista && that._hasScroll( pr[ 0 ], "left" ) ? 0 : that.sizeDiff.height,
			soffsetw = ista ? 0 : that.sizeDiff.width,
			style = {
				width: ( that.size.width - soffsetw ),
				height: ( that.size.height - soffseth )
			},
			left = ( parseFloat( that.element.css( "left" ) ) +
				( that.position.left - that.originalPosition.left ) ) || null,
			top = ( parseFloat( that.element.css( "top" ) ) +
				( that.position.top - that.originalPosition.top ) ) || null;

		that.element.animate(
			$.extend( style, top && left ? { top: top, left: left } : {} ), {
				duration: o.animateDuration,
				easing: o.animateEasing,
				step: function() {

					var data = {
						width: parseFloat( that.element.css( "width" ) ),
						height: parseFloat( that.element.css( "height" ) ),
						top: parseFloat( that.element.css( "top" ) ),
						left: parseFloat( that.element.css( "left" ) )
					};

					if ( pr && pr.length ) {
						$( pr[ 0 ] ).css( { width: data.width, height: data.height } );
					}

					// Propagating resize, and updating values for each animation step
					that._updateCache( data );
					that._propagate( "resize", event );

				}
			}
		);
	}

} );

$.ui.plugin.add( "resizable", "containment", {

	start: function() {
		var element, p, co, ch, cw, width, height,
			that = $( this ).resizable( "instance" ),
			o = that.options,
			el = that.element,
			oc = o.containment,
			ce = ( oc instanceof $ ) ?
				oc.get( 0 ) :
				( /parent/.test( oc ) ) ? el.parent().get( 0 ) : oc;

		if ( !ce ) {
			return;
		}

		that.containerElement = $( ce );

		if ( /document/.test( oc ) || oc === document ) {
			that.containerOffset = {
				left: 0,
				top: 0
			};
			that.containerPosition = {
				left: 0,
				top: 0
			};

			that.parentData = {
				element: $( document ),
				left: 0,
				top: 0,
				width: $( document ).width(),
				height: $( document ).height() || document.body.parentNode.scrollHeight
			};
		} else {
			element = $( ce );
			p = [];
			$( [ "Top", "Right", "Left", "Bottom" ] ).each( function( i, name ) {
				p[ i ] = that._num( element.css( "padding" + name ) );
			} );

			that.containerOffset = element.offset();
			that.containerPosition = element.position();
			that.containerSize = {
				height: ( element.innerHeight() - p[ 3 ] ),
				width: ( element.innerWidth() - p[ 1 ] )
			};

			co = that.containerOffset;
			ch = that.containerSize.height;
			cw = that.containerSize.width;
			width = ( that._hasScroll ( ce, "left" ) ? ce.scrollWidth : cw );
			height = ( that._hasScroll ( ce ) ? ce.scrollHeight : ch ) ;

			that.parentData = {
				element: ce,
				left: co.left,
				top: co.top,
				width: width,
				height: height
			};
		}
	},

	resize: function( event ) {
		var woset, hoset, isParent, isOffsetRelative,
			that = $( this ).resizable( "instance" ),
			o = that.options,
			co = that.containerOffset,
			cp = that.position,
			pRatio = that._aspectRatio || event.shiftKey,
			cop = {
				top: 0,
				left: 0
			},
			ce = that.containerElement,
			continueResize = true;

		if ( ce[ 0 ] !== document && ( /static/ ).test( ce.css( "position" ) ) ) {
			cop = co;
		}

		if ( cp.left < ( that._helper ? co.left : 0 ) ) {
			that.size.width = that.size.width +
				( that._helper ?
					( that.position.left - co.left ) :
					( that.position.left - cop.left ) );

			if ( pRatio ) {
				that.size.height = that.size.width / that.aspectRatio;
				continueResize = false;
			}
			that.position.left = o.helper ? co.left : 0;
		}

		if ( cp.top < ( that._helper ? co.top : 0 ) ) {
			that.size.height = that.size.height +
				( that._helper ?
					( that.position.top - co.top ) :
					that.position.top );

			if ( pRatio ) {
				that.size.width = that.size.height * that.aspectRatio;
				continueResize = false;
			}
			that.position.top = that._helper ? co.top : 0;
		}

		isParent = that.containerElement.get( 0 ) === that.element.parent().get( 0 );
		isOffsetRelative = /relative|absolute/.test( that.containerElement.css( "position" ) );

		if ( isParent && isOffsetRelative ) {
			that.offset.left = that.parentData.left + that.position.left;
			that.offset.top = that.parentData.top + that.position.top;
		} else {
			that.offset.left = that.element.offset().left;
			that.offset.top = that.element.offset().top;
		}

		woset = Math.abs( that.sizeDiff.width +
			( that._helper ?
				that.offset.left - cop.left :
				( that.offset.left - co.left ) ) );

		hoset = Math.abs( that.sizeDiff.height +
			( that._helper ?
				that.offset.top - cop.top :
				( that.offset.top - co.top ) ) );

		if ( woset + that.size.width >= that.parentData.width ) {
			that.size.width = that.parentData.width - woset;
			if ( pRatio ) {
				that.size.height = that.size.width / that.aspectRatio;
				continueResize = false;
			}
		}

		if ( hoset + that.size.height >= that.parentData.height ) {
			that.size.height = that.parentData.height - hoset;
			if ( pRatio ) {
				that.size.width = that.size.height * that.aspectRatio;
				continueResize = false;
			}
		}

		if ( !continueResize ) {
			that.position.left = that.prevPosition.left;
			that.position.top = that.prevPosition.top;
			that.size.width = that.prevSize.width;
			that.size.height = that.prevSize.height;
		}
	},

	stop: function() {
		var that = $( this ).resizable( "instance" ),
			o = that.options,
			co = that.containerOffset,
			cop = that.containerPosition,
			ce = that.containerElement,
			helper = $( that.helper ),
			ho = helper.offset(),
			w = helper.outerWidth() - that.sizeDiff.width,
			h = helper.outerHeight() - that.sizeDiff.height;

		if ( that._helper && !o.animate && ( /relative/ ).test( ce.css( "position" ) ) ) {
			$( this ).css( {
				left: ho.left - cop.left - co.left,
				width: w,
				height: h
			} );
		}

		if ( that._helper && !o.animate && ( /static/ ).test( ce.css( "position" ) ) ) {
			$( this ).css( {
				left: ho.left - cop.left - co.left,
				width: w,
				height: h
			} );
		}
	}
} );

$.ui.plugin.add( "resizable", "alsoResize", {

	start: function() {
		var that = $( this ).resizable( "instance" ),
			o = that.options;

		$( o.alsoResize ).each( function() {
			var el = $( this );
			el.data( "ui-resizable-alsoresize", {
				width: parseFloat( el.width() ), height: parseFloat( el.height() ),
				left: parseFloat( el.css( "left" ) ), top: parseFloat( el.css( "top" ) )
			} );
		} );
	},

	resize: function( event, ui ) {
		var that = $( this ).resizable( "instance" ),
			o = that.options,
			os = that.originalSize,
			op = that.originalPosition,
			delta = {
				height: ( that.size.height - os.height ) || 0,
				width: ( that.size.width - os.width ) || 0,
				top: ( that.position.top - op.top ) || 0,
				left: ( that.position.left - op.left ) || 0
			};

			$( o.alsoResize ).each( function() {
				var el = $( this ), start = $( this ).data( "ui-resizable-alsoresize" ), style = {},
					css = el.parents( ui.originalElement[ 0 ] ).length ?
							[ "width", "height" ] :
							[ "width", "height", "top", "left" ];

				$.each( css, function( i, prop ) {
					var sum = ( start[ prop ] || 0 ) + ( delta[ prop ] || 0 );
					if ( sum && sum >= 0 ) {
						style[ prop ] = sum || null;
					}
				} );

				el.css( style );
			} );
	},

	stop: function() {
		$( this ).removeData( "ui-resizable-alsoresize" );
	}
} );

$.ui.plugin.add( "resizable", "ghost", {

	start: function() {

		var that = $( this ).resizable( "instance" ), cs = that.size;

		that.ghost = that.originalElement.clone();
		that.ghost.css( {
			opacity: 0.25,
			display: "block",
			position: "relative",
			height: cs.height,
			width: cs.width,
			margin: 0,
			left: 0,
			top: 0
		} );

		that._addClass( that.ghost, "ui-resizable-ghost" );

		// DEPRECATED
		// TODO: remove after 1.12
		if ( $.uiBackCompat !== false && typeof that.options.ghost === "string" ) {

			// Ghost option
			that.ghost.addClass( this.options.ghost );
		}

		that.ghost.appendTo( that.helper );

	},

	resize: function() {
		var that = $( this ).resizable( "instance" );
		if ( that.ghost ) {
			that.ghost.css( {
				position: "relative",
				height: that.size.height,
				width: that.size.width
			} );
		}
	},

	stop: function() {
		var that = $( this ).resizable( "instance" );
		if ( that.ghost && that.helper ) {
			that.helper.get( 0 ).removeChild( that.ghost.get( 0 ) );
		}
	}

} );

$.ui.plugin.add( "resizable", "grid", {

	resize: function() {
		var outerDimensions,
			that = $( this ).resizable( "instance" ),
			o = that.options,
			cs = that.size,
			os = that.originalSize,
			op = that.originalPosition,
			a = that.axis,
			grid = typeof o.grid === "number" ? [ o.grid, o.grid ] : o.grid,
			gridX = ( grid[ 0 ] || 1 ),
			gridY = ( grid[ 1 ] || 1 ),
			ox = Math.round( ( cs.width - os.width ) / gridX ) * gridX,
			oy = Math.round( ( cs.height - os.height ) / gridY ) * gridY,
			newWidth = os.width + ox,
			newHeight = os.height + oy,
			isMaxWidth = o.maxWidth && ( o.maxWidth < newWidth ),
			isMaxHeight = o.maxHeight && ( o.maxHeight < newHeight ),
			isMinWidth = o.minWidth && ( o.minWidth > newWidth ),
			isMinHeight = o.minHeight && ( o.minHeight > newHeight );

		o.grid = grid;

		if ( isMinWidth ) {
			newWidth += gridX;
		}
		if ( isMinHeight ) {
			newHeight += gridY;
		}
		if ( isMaxWidth ) {
			newWidth -= gridX;
		}
		if ( isMaxHeight ) {
			newHeight -= gridY;
		}

		if ( /^(se|s|e)$/.test( a ) ) {
			that.size.width = newWidth;
			that.size.height = newHeight;
		} else if ( /^(ne)$/.test( a ) ) {
			that.size.width = newWidth;
			that.size.height = newHeight;
			that.position.top = op.top - oy;
		} else if ( /^(sw)$/.test( a ) ) {
			that.size.width = newWidth;
			that.size.height = newHeight;
			that.position.left = op.left - ox;
		} else {
			if ( newHeight - gridY <= 0 || newWidth - gridX <= 0 ) {
				outerDimensions = that._getPaddingPlusBorderDimensions( this );
			}

			if ( newHeight - gridY > 0 ) {
				that.size.height = newHeight;
				that.position.top = op.top - oy;
			} else {
				newHeight = gridY - outerDimensions.height;
				that.size.height = newHeight;
				that.position.top = op.top + os.height - newHeight;
			}
			if ( newWidth - gridX > 0 ) {
				that.size.width = newWidth;
				that.position.left = op.left - ox;
			} else {
				newWidth = gridX - outerDimensions.width;
				that.size.width = newWidth;
				that.position.left = op.left + os.width - newWidth;
			}
		}
	}

} );

var widgetsResizable = $.ui.resizable;




//>>label: Dialog
//>>group: Widgets
//>>description: Displays customizable dialog windows.
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/dialog.css
//>>css.theme: ../../themes/base/theme.css



$.widget( "ui.dialog", {
	version: "1.12.1",
	options: {
		appendTo: "body",
		autoOpen: true,
		buttons: [],
		classes: {
			"ui-dialog": "ui-corner-all",
			"ui-dialog-titlebar": "ui-corner-all"
		},
		closeOnEscape: true,
		closeText: "Close",
		draggable: true,
		hide: null,
		height: "auto",
		maxHeight: null,
		maxWidth: null,
		minHeight: 150,
		minWidth: 150,
		modal: false,
		position: {
			my: "center",
			at: "center",
			of: window,
			collision: "fit",

			// Ensure the titlebar is always visible
			using: function( pos ) {
				var topOffset = $( this ).css( pos ).offset().top;
				if ( topOffset < 0 ) {
					$( this ).css( "top", pos.top - topOffset );
				}
			}
		},
		resizable: true,
		show: null,
		title: null,
		width: 300,

		// Callbacks
		beforeClose: null,
		close: null,
		drag: null,
		dragStart: null,
		dragStop: null,
		focus: null,
		open: null,
		resize: null,
		resizeStart: null,
		resizeStop: null
	},

	sizeRelatedOptions: {
		buttons: true,
		height: true,
		maxHeight: true,
		maxWidth: true,
		minHeight: true,
		minWidth: true,
		width: true
	},

	resizableRelatedOptions: {
		maxHeight: true,
		maxWidth: true,
		minHeight: true,
		minWidth: true
	},

	_create: function() {
		this.originalCss = {
			display: this.element[ 0 ].style.display,
			width: this.element[ 0 ].style.width,
			minHeight: this.element[ 0 ].style.minHeight,
			maxHeight: this.element[ 0 ].style.maxHeight,
			height: this.element[ 0 ].style.height
		};
		this.originalPosition = {
			parent: this.element.parent(),
			index: this.element.parent().children().index( this.element )
		};
		this.originalTitle = this.element.attr( "title" );
		if ( this.options.title == null && this.originalTitle != null ) {
			this.options.title = this.originalTitle;
		}

		// Dialogs can't be disabled
		if ( this.options.disabled ) {
			this.options.disabled = false;
		}

		this._createWrapper();

		this.element
			.show()
			.removeAttr( "title" )
			.appendTo( this.uiDialog );

		this._addClass( "ui-dialog-content", "ui-widget-content" );

		this._createTitlebar();
		this._createButtonPane();

		if ( this.options.draggable && $.fn.draggable ) {
			this._makeDraggable();
		}
		if ( this.options.resizable && $.fn.resizable ) {
			this._makeResizable();
		}

		this._isOpen = false;

		this._trackFocus();
	},

	_init: function() {
		if ( this.options.autoOpen ) {
			this.open();
		}
	},

	_appendTo: function() {
		var element = this.options.appendTo;
		if ( element && ( element.jquery || element.nodeType ) ) {
			return $( element );
		}
		return this.document.find( element || "body" ).eq( 0 );
	},

	_destroy: function() {
		var next,
			originalPosition = this.originalPosition;

		this._untrackInstance();
		this._destroyOverlay();

		this.element
			.removeUniqueId()
			.css( this.originalCss )

			// Without detaching first, the following becomes really slow
			.detach();

		this.uiDialog.remove();

		if ( this.originalTitle ) {
			this.element.attr( "title", this.originalTitle );
		}

		next = originalPosition.parent.children().eq( originalPosition.index );

		// Don't try to place the dialog next to itself (#8613)
		if ( next.length && next[ 0 ] !== this.element[ 0 ] ) {
			next.before( this.element );
		} else {
			originalPosition.parent.append( this.element );
		}
	},

	widget: function() {
		return this.uiDialog;
	},

	disable: $.noop,
	enable: $.noop,

	close: function( event ) {
		var that = this;

		if ( !this._isOpen || this._trigger( "beforeClose", event ) === false ) {
			return;
		}

		this._isOpen = false;
		this._focusedElement = null;
		this._destroyOverlay();
		this._untrackInstance();

		if ( !this.opener.filter( ":focusable" ).trigger( "focus" ).length ) {

			// Hiding a focused element doesn't trigger blur in WebKit
			// so in case we have nothing to focus on, explicitly blur the active element
			// https://bugs.webkit.org/show_bug.cgi?id=47182
			$.ui.safeBlur( $.ui.safeActiveElement( this.document[ 0 ] ) );
		}

		this._hide( this.uiDialog, this.options.hide, function() {
			that._trigger( "close", event );
		} );
	},

	isOpen: function() {
		return this._isOpen;
	},

	moveToTop: function() {
		this._moveToTop();
	},

	_moveToTop: function( event, silent ) {
		var moved = false,
			zIndices = this.uiDialog.siblings( ".ui-front:visible" ).map( function() {
				return +$( this ).css( "z-index" );
			} ).get(),
			zIndexMax = Math.max.apply( null, zIndices );

		if ( zIndexMax >= +this.uiDialog.css( "z-index" ) ) {
			this.uiDialog.css( "z-index", zIndexMax + 1 );
			moved = true;
		}

		if ( moved && !silent ) {
			this._trigger( "focus", event );
		}
		return moved;
	},

	open: function() {
		var that = this;
		if ( this._isOpen ) {
			if ( this._moveToTop() ) {
				this._focusTabbable();
			}
			return;
		}

		this._isOpen = true;
		this.opener = $( $.ui.safeActiveElement( this.document[ 0 ] ) );

		this._size();
		this._position();
		this._createOverlay();
		this._moveToTop( null, true );

		// Ensure the overlay is moved to the top with the dialog, but only when
		// opening. The overlay shouldn't move after the dialog is open so that
		// modeless dialogs opened after the modal dialog stack properly.
		if ( this.overlay ) {
			this.overlay.css( "z-index", this.uiDialog.css( "z-index" ) - 1 );
		}

		this._show( this.uiDialog, this.options.show, function() {
			that._focusTabbable();
			that._trigger( "focus" );
		} );

		// Track the dialog immediately upon openening in case a focus event
		// somehow occurs outside of the dialog before an element inside the
		// dialog is focused (#10152)
		this._makeFocusTarget();

		this._trigger( "open" );
	},

	_focusTabbable: function() {

		// Set focus to the first match:
		// 1. An element that was focused previously
		// 2. First element inside the dialog matching [autofocus]
		// 3. Tabbable element inside the content element
		// 4. Tabbable element inside the buttonpane
		// 5. The close button
		// 6. The dialog itself
		var hasFocus = this._focusedElement;
		if ( !hasFocus ) {
			hasFocus = this.element.find( "[autofocus]" );
		}
		if ( !hasFocus.length ) {
			hasFocus = this.element.find( ":tabbable" );
		}
		if ( !hasFocus.length ) {
			hasFocus = this.uiDialogButtonPane.find( ":tabbable" );
		}
		if ( !hasFocus.length ) {
			hasFocus = this.uiDialogTitlebarClose.filter( ":tabbable" );
		}
		if ( !hasFocus.length ) {
			hasFocus = this.uiDialog;
		}
		hasFocus.eq( 0 ).trigger( "focus" );
	},

	_keepFocus: function( event ) {
		function checkFocus() {
			var activeElement = $.ui.safeActiveElement( this.document[ 0 ] ),
				isActive = this.uiDialog[ 0 ] === activeElement ||
					$.contains( this.uiDialog[ 0 ], activeElement );
			if ( !isActive ) {
				this._focusTabbable();
			}
		}
		event.preventDefault();
		checkFocus.call( this );

		// support: IE
		// IE <= 8 doesn't prevent moving focus even with event.preventDefault()
		// so we check again later
		this._delay( checkFocus );
	},

	_createWrapper: function() {
		this.uiDialog = $( "<div>" )
			.hide()
			.attr( {

				// Setting tabIndex makes the div focusable
				tabIndex: -1,
				role: "dialog"
			} )
			.appendTo( this._appendTo() );

		this._addClass( this.uiDialog, "ui-dialog", "ui-widget ui-widget-content ui-front" );
		this._on( this.uiDialog, {
			keydown: function( event ) {
				if ( this.options.closeOnEscape && !event.isDefaultPrevented() && event.keyCode &&
						event.keyCode === $.ui.keyCode.ESCAPE ) {
					event.preventDefault();
					this.close( event );
					return;
				}

				// Prevent tabbing out of dialogs
				if ( event.keyCode !== $.ui.keyCode.TAB || event.isDefaultPrevented() ) {
					return;
				}
				var tabbables = this.uiDialog.find( ":tabbable" ),
					first = tabbables.filter( ":first" ),
					last = tabbables.filter( ":last" );

				if ( ( event.target === last[ 0 ] || event.target === this.uiDialog[ 0 ] ) &&
						!event.shiftKey ) {
					this._delay( function() {
						first.trigger( "focus" );
					} );
					event.preventDefault();
				} else if ( ( event.target === first[ 0 ] ||
						event.target === this.uiDialog[ 0 ] ) && event.shiftKey ) {
					this._delay( function() {
						last.trigger( "focus" );
					} );
					event.preventDefault();
				}
			},
			mousedown: function( event ) {
				if ( this._moveToTop( event ) ) {
					this._focusTabbable();
				}
			}
		} );

		// We assume that any existing aria-describedby attribute means
		// that the dialog content is marked up properly
		// otherwise we brute force the content as the description
		if ( !this.element.find( "[aria-describedby]" ).length ) {
			this.uiDialog.attr( {
				"aria-describedby": this.element.uniqueId().attr( "id" )
			} );
		}
	},

	_createTitlebar: function() {
		var uiDialogTitle;

		this.uiDialogTitlebar = $( "<div>" );
		this._addClass( this.uiDialogTitlebar,
			"ui-dialog-titlebar", "ui-widget-header ui-helper-clearfix" );
		this._on( this.uiDialogTitlebar, {
			mousedown: function( event ) {

				// Don't prevent click on close button (#8838)
				// Focusing a dialog that is partially scrolled out of view
				// causes the browser to scroll it into view, preventing the click event
				if ( !$( event.target ).closest( ".ui-dialog-titlebar-close" ) ) {

					// Dialog isn't getting focus when dragging (#8063)
					this.uiDialog.trigger( "focus" );
				}
			}
		} );

		// Support: IE
		// Use type="button" to prevent enter keypresses in textboxes from closing the
		// dialog in IE (#9312)
		this.uiDialogTitlebarClose = $( "<button type='button'></button>" )
			.button( {
				label: $( "<a>" ).text( this.options.closeText ).html(),
				icon: "ui-icon-closethick",
				showLabel: false
			} )
			.appendTo( this.uiDialogTitlebar );

		this._addClass( this.uiDialogTitlebarClose, "ui-dialog-titlebar-close" );
		this._on( this.uiDialogTitlebarClose, {
			click: function( event ) {
				event.preventDefault();
				this.close( event );
			}
		} );

		uiDialogTitle = $( "<span>" ).uniqueId().prependTo( this.uiDialogTitlebar );
		this._addClass( uiDialogTitle, "ui-dialog-title" );
		this._title( uiDialogTitle );

		this.uiDialogTitlebar.prependTo( this.uiDialog );

		this.uiDialog.attr( {
			"aria-labelledby": uiDialogTitle.attr( "id" )
		} );
	},

	_title: function( title ) {
		if ( this.options.title ) {
			title.text( this.options.title );
		} else {
			title.html( "&#160;" );
		}
	},

	_createButtonPane: function() {
		this.uiDialogButtonPane = $( "<div>" );
		this._addClass( this.uiDialogButtonPane, "ui-dialog-buttonpane",
			"ui-widget-content ui-helper-clearfix" );

		this.uiButtonSet = $( "<div>" )
			.appendTo( this.uiDialogButtonPane );
		this._addClass( this.uiButtonSet, "ui-dialog-buttonset" );

		this._createButtons();
	},

	_createButtons: function() {
		var that = this,
			buttons = this.options.buttons;

		// If we already have a button pane, remove it
		this.uiDialogButtonPane.remove();
		this.uiButtonSet.empty();

		if ( $.isEmptyObject( buttons ) || ( $.isArray( buttons ) && !buttons.length ) ) {
			this._removeClass( this.uiDialog, "ui-dialog-buttons" );
			return;
		}

		$.each( buttons, function( name, props ) {
			var click, buttonOptions;
			props = $.isFunction( props ) ?
				{ click: props, text: name } :
				props;

			// Default to a non-submitting button
			props = $.extend( { type: "button" }, props );

			// Change the context for the click callback to be the main element
			click = props.click;
			buttonOptions = {
				icon: props.icon,
				iconPosition: props.iconPosition,
				showLabel: props.showLabel,

				// Deprecated options
				icons: props.icons,
				text: props.text
			};

			delete props.click;
			delete props.icon;
			delete props.iconPosition;
			delete props.showLabel;

			// Deprecated options
			delete props.icons;
			if ( typeof props.text === "boolean" ) {
				delete props.text;
			}

			$( "<button></button>", props )
				.button( buttonOptions )
				.appendTo( that.uiButtonSet )
				.on( "click", function() {
					click.apply( that.element[ 0 ], arguments );
				} );
		} );
		this._addClass( this.uiDialog, "ui-dialog-buttons" );
		this.uiDialogButtonPane.appendTo( this.uiDialog );
	},

	_makeDraggable: function() {
		var that = this,
			options = this.options;

		function filteredUi( ui ) {
			return {
				position: ui.position,
				offset: ui.offset
			};
		}

		this.uiDialog.draggable( {
			cancel: ".ui-dialog-content, .ui-dialog-titlebar-close",
			handle: ".ui-dialog-titlebar",
			containment: "document",
			start: function( event, ui ) {
				that._addClass( $( this ), "ui-dialog-dragging" );
				that._blockFrames();
				that._trigger( "dragStart", event, filteredUi( ui ) );
			},
			drag: function( event, ui ) {
				that._trigger( "drag", event, filteredUi( ui ) );
			},
			stop: function( event, ui ) {
				var left = ui.offset.left - that.document.scrollLeft(),
					top = ui.offset.top - that.document.scrollTop();

				options.position = {
					my: "left top",
					at: "left" + ( left >= 0 ? "+" : "" ) + left + " " +
						"top" + ( top >= 0 ? "+" : "" ) + top,
					of: that.window
				};
				that._removeClass( $( this ), "ui-dialog-dragging" );
				that._unblockFrames();
				that._trigger( "dragStop", event, filteredUi( ui ) );
			}
		} );
	},

	_makeResizable: function() {
		var that = this,
			options = this.options,
			handles = options.resizable,

			// .ui-resizable has position: relative defined in the stylesheet
			// but dialogs have to use absolute or fixed positioning
			position = this.uiDialog.css( "position" ),
			resizeHandles = typeof handles === "string" ?
				handles :
				"n,e,s,w,se,sw,ne,nw";

		function filteredUi( ui ) {
			return {
				originalPosition: ui.originalPosition,
				originalSize: ui.originalSize,
				position: ui.position,
				size: ui.size
			};
		}

		this.uiDialog.resizable( {
			cancel: ".ui-dialog-content",
			containment: "document",
			alsoResize: this.element,
			maxWidth: options.maxWidth,
			maxHeight: options.maxHeight,
			minWidth: options.minWidth,
			minHeight: this._minHeight(),
			handles: resizeHandles,
			start: function( event, ui ) {
				that._addClass( $( this ), "ui-dialog-resizing" );
				that._blockFrames();
				that._trigger( "resizeStart", event, filteredUi( ui ) );
			},
			resize: function( event, ui ) {
				that._trigger( "resize", event, filteredUi( ui ) );
			},
			stop: function( event, ui ) {
				var offset = that.uiDialog.offset(),
					left = offset.left - that.document.scrollLeft(),
					top = offset.top - that.document.scrollTop();

				options.height = that.uiDialog.height();
				options.width = that.uiDialog.width();
				options.position = {
					my: "left top",
					at: "left" + ( left >= 0 ? "+" : "" ) + left + " " +
						"top" + ( top >= 0 ? "+" : "" ) + top,
					of: that.window
				};
				that._removeClass( $( this ), "ui-dialog-resizing" );
				that._unblockFrames();
				that._trigger( "resizeStop", event, filteredUi( ui ) );
			}
		} )
			.css( "position", position );
	},

	_trackFocus: function() {
		this._on( this.widget(), {
			focusin: function( event ) {
				this._makeFocusTarget();
				this._focusedElement = $( event.target );
			}
		} );
	},

	_makeFocusTarget: function() {
		this._untrackInstance();
		this._trackingInstances().unshift( this );
	},

	_untrackInstance: function() {
		var instances = this._trackingInstances(),
			exists = $.inArray( this, instances );
		if ( exists !== -1 ) {
			instances.splice( exists, 1 );
		}
	},

	_trackingInstances: function() {
		var instances = this.document.data( "ui-dialog-instances" );
		if ( !instances ) {
			instances = [];
			this.document.data( "ui-dialog-instances", instances );
		}
		return instances;
	},

	_minHeight: function() {
		var options = this.options;

		return options.height === "auto" ?
			options.minHeight :
			Math.min( options.minHeight, options.height );
	},

	_position: function() {

		// Need to show the dialog to get the actual offset in the position plugin
		var isVisible = this.uiDialog.is( ":visible" );
		if ( !isVisible ) {
			this.uiDialog.show();
		}
		this.uiDialog.position( this.options.position );
		if ( !isVisible ) {
			this.uiDialog.hide();
		}
	},

	_setOptions: function( options ) {
		var that = this,
			resize = false,
			resizableOptions = {};

		$.each( options, function( key, value ) {
			that._setOption( key, value );

			if ( key in that.sizeRelatedOptions ) {
				resize = true;
			}
			if ( key in that.resizableRelatedOptions ) {
				resizableOptions[ key ] = value;
			}
		} );

		if ( resize ) {
			this._size();
			this._position();
		}
		if ( this.uiDialog.is( ":data(ui-resizable)" ) ) {
			this.uiDialog.resizable( "option", resizableOptions );
		}
	},

	_setOption: function( key, value ) {
		var isDraggable, isResizable,
			uiDialog = this.uiDialog;

		if ( key === "disabled" ) {
			return;
		}

		this._super( key, value );

		if ( key === "appendTo" ) {
			this.uiDialog.appendTo( this._appendTo() );
		}

		if ( key === "buttons" ) {
			this._createButtons();
		}

		if ( key === "closeText" ) {
			this.uiDialogTitlebarClose.button( {

				// Ensure that we always pass a string
				label: $( "<a>" ).text( "" + this.options.closeText ).html()
			} );
		}

		if ( key === "draggable" ) {
			isDraggable = uiDialog.is( ":data(ui-draggable)" );
			if ( isDraggable && !value ) {
				uiDialog.draggable( "destroy" );
			}

			if ( !isDraggable && value ) {
				this._makeDraggable();
			}
		}

		if ( key === "position" ) {
			this._position();
		}

		if ( key === "resizable" ) {

			// currently resizable, becoming non-resizable
			isResizable = uiDialog.is( ":data(ui-resizable)" );
			if ( isResizable && !value ) {
				uiDialog.resizable( "destroy" );
			}

			// Currently resizable, changing handles
			if ( isResizable && typeof value === "string" ) {
				uiDialog.resizable( "option", "handles", value );
			}

			// Currently non-resizable, becoming resizable
			if ( !isResizable && value !== false ) {
				this._makeResizable();
			}
		}

		if ( key === "title" ) {
			this._title( this.uiDialogTitlebar.find( ".ui-dialog-title" ) );
		}
	},

	_size: function() {

		// If the user has resized the dialog, the .ui-dialog and .ui-dialog-content
		// divs will both have width and height set, so we need to reset them
		var nonContentHeight, minContentHeight, maxContentHeight,
			options = this.options;

		// Reset content sizing
		this.element.show().css( {
			width: "auto",
			minHeight: 0,
			maxHeight: "none",
			height: 0
		} );

		if ( options.minWidth > options.width ) {
			options.width = options.minWidth;
		}

		// Reset wrapper sizing
		// determine the height of all the non-content elements
		nonContentHeight = this.uiDialog.css( {
			height: "auto",
			width: options.width
		} )
			.outerHeight();
		minContentHeight = Math.max( 0, options.minHeight - nonContentHeight );
		maxContentHeight = typeof options.maxHeight === "number" ?
			Math.max( 0, options.maxHeight - nonContentHeight ) :
			"none";

		if ( options.height === "auto" ) {
			this.element.css( {
				minHeight: minContentHeight,
				maxHeight: maxContentHeight,
				height: "auto"
			} );
		} else {
			this.element.height( Math.max( 0, options.height - nonContentHeight ) );
		}

		if ( this.uiDialog.is( ":data(ui-resizable)" ) ) {
			this.uiDialog.resizable( "option", "minHeight", this._minHeight() );
		}
	},

	_blockFrames: function() {
		this.iframeBlocks = this.document.find( "iframe" ).map( function() {
			var iframe = $( this );

			return $( "<div>" )
				.css( {
					position: "absolute",
					width: iframe.outerWidth(),
					height: iframe.outerHeight()
				} )
				.appendTo( iframe.parent() )
				.offset( iframe.offset() )[ 0 ];
		} );
	},

	_unblockFrames: function() {
		if ( this.iframeBlocks ) {
			this.iframeBlocks.remove();
			delete this.iframeBlocks;
		}
	},

	_allowInteraction: function( event ) {
		if ( $( event.target ).closest( ".ui-dialog" ).length ) {
			return true;
		}

		// TODO: Remove hack when datepicker implements
		// the .ui-front logic (#8989)
		return !!$( event.target ).closest( ".ui-datepicker" ).length;
	},

	_createOverlay: function() {
		if ( !this.options.modal ) {
			return;
		}

		// We use a delay in case the overlay is created from an
		// event that we're going to be cancelling (#2804)
		var isOpening = true;
		this._delay( function() {
			isOpening = false;
		} );

		if ( !this.document.data( "ui-dialog-overlays" ) ) {

			// Prevent use of anchors and inputs
			// Using _on() for an event handler shared across many instances is
			// safe because the dialogs stack and must be closed in reverse order
			this._on( this.document, {
				focusin: function( event ) {
					if ( isOpening ) {
						return;
					}

					if ( !this._allowInteraction( event ) ) {
						event.preventDefault();
						this._trackingInstances()[ 0 ]._focusTabbable();
					}
				}
			} );
		}

		this.overlay = $( "<div>" )
			.appendTo( this._appendTo() );

		this._addClass( this.overlay, null, "ui-widget-overlay ui-front" );
		this._on( this.overlay, {
			mousedown: "_keepFocus"
		} );
		this.document.data( "ui-dialog-overlays",
			( this.document.data( "ui-dialog-overlays" ) || 0 ) + 1 );
	},

	_destroyOverlay: function() {
		if ( !this.options.modal ) {
			return;
		}

		if ( this.overlay ) {
			var overlays = this.document.data( "ui-dialog-overlays" ) - 1;

			if ( !overlays ) {
				this._off( this.document, "focusin" );
				this.document.removeData( "ui-dialog-overlays" );
			} else {
				this.document.data( "ui-dialog-overlays", overlays );
			}

			this.overlay.remove();
			this.overlay = null;
		}
	}
} );

// DEPRECATED
// TODO: switch return back to widget declaration at top of file when this is removed
if ( $.uiBackCompat !== false ) {

	// Backcompat for dialogClass option
	$.widget( "ui.dialog", $.ui.dialog, {
		options: {
			dialogClass: ""
		},
		_createWrapper: function() {
			this._super();
			this.uiDialog.addClass( this.options.dialogClass );
		},
		_setOption: function( key, value ) {
			if ( key === "dialogClass" ) {
				this.uiDialog
					.removeClass( this.options.dialogClass )
					.addClass( value );
			}
			this._superApply( arguments );
		}
	} );
}

var widgetsDialog = $.ui.dialog;



//>>label: Droppable
//>>group: Interactions
//>>description: Enables drop targets for draggable elements.



$.widget( "ui.droppable", {
	version: "1.12.1",
	widgetEventPrefix: "drop",
	options: {
		accept: "*",
		addClasses: true,
		greedy: false,
		scope: "default",
		tolerance: "intersect",

		// Callbacks
		activate: null,
		deactivate: null,
		drop: null,
		out: null,
		over: null
	},
	_create: function() {

		var proportions,
			o = this.options,
			accept = o.accept;

		this.isover = false;
		this.isout = true;

		this.accept = $.isFunction( accept ) ? accept : function( d ) {
			return d.is( accept );
		};

		this.proportions = function( /* valueToWrite */ ) {
			if ( arguments.length ) {

				// Store the droppable's proportions
				proportions = arguments[ 0 ];
			} else {

				// Retrieve or derive the droppable's proportions
				return proportions ?
					proportions :
					proportions = {
						width: this.element[ 0 ].offsetWidth,
						height: this.element[ 0 ].offsetHeight
					};
			}
		};

		this._addToManager( o.scope );

		o.addClasses && this._addClass( "ui-droppable" );

	},

	_addToManager: function( scope ) {

		// Add the reference and positions to the manager
		$.ui.ddmanager.droppables[ scope ] = $.ui.ddmanager.droppables[ scope ] || [];
		$.ui.ddmanager.droppables[ scope ].push( this );
	},

	_splice: function( drop ) {
		var i = 0;
		for ( ; i < drop.length; i++ ) {
			if ( drop[ i ] === this ) {
				drop.splice( i, 1 );
			}
		}
	},

	_destroy: function() {
		var drop = $.ui.ddmanager.droppables[ this.options.scope ];

		this._splice( drop );
	},

	_setOption: function( key, value ) {

		if ( key === "accept" ) {
			this.accept = $.isFunction( value ) ? value : function( d ) {
				return d.is( value );
			};
		} else if ( key === "scope" ) {
			var drop = $.ui.ddmanager.droppables[ this.options.scope ];

			this._splice( drop );
			this._addToManager( value );
		}

		this._super( key, value );
	},

	_activate: function( event ) {
		var draggable = $.ui.ddmanager.current;

		this._addActiveClass();
		if ( draggable ) {
			this._trigger( "activate", event, this.ui( draggable ) );
		}
	},

	_deactivate: function( event ) {
		var draggable = $.ui.ddmanager.current;

		this._removeActiveClass();
		if ( draggable ) {
			this._trigger( "deactivate", event, this.ui( draggable ) );
		}
	},

	_over: function( event ) {

		var draggable = $.ui.ddmanager.current;

		// Bail if draggable and droppable are same element
		if ( !draggable || ( draggable.currentItem ||
				draggable.element )[ 0 ] === this.element[ 0 ] ) {
			return;
		}

		if ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||
				draggable.element ) ) ) {
			this._addHoverClass();
			this._trigger( "over", event, this.ui( draggable ) );
		}

	},

	_out: function( event ) {

		var draggable = $.ui.ddmanager.current;

		// Bail if draggable and droppable are same element
		if ( !draggable || ( draggable.currentItem ||
				draggable.element )[ 0 ] === this.element[ 0 ] ) {
			return;
		}

		if ( this.accept.call( this.element[ 0 ], ( draggable.currentItem ||
				draggable.element ) ) ) {
			this._removeHoverClass();
			this._trigger( "out", event, this.ui( draggable ) );
		}

	},

	_drop: function( event, custom ) {

		var draggable = custom || $.ui.ddmanager.current,
			childrenIntersection = false;

		// Bail if draggable and droppable are same element
		if ( !draggable || ( draggable.currentItem ||
				draggable.element )[ 0 ] === this.element[ 0 ] ) {
			return false;
		}

		this.element
			.find( ":data(ui-droppable)" )
			.not( ".ui-draggable-dragging" )
			.each( function() {
				var inst = $( this ).droppable( "instance" );
				if (
					inst.options.greedy &&
					!inst.options.disabled &&
					inst.options.scope === draggable.options.scope &&
					inst.accept.call(
						inst.element[ 0 ], ( draggable.currentItem || draggable.element )
					) &&
					intersect(
						draggable,
						$.extend( inst, { offset: inst.element.offset() } ),
						inst.options.tolerance, event
					)
				) {
					childrenIntersection = true;
					return false; }
			} );
		if ( childrenIntersection ) {
			return false;
		}

		if ( this.accept.call( this.element[ 0 ],
				( draggable.currentItem || draggable.element ) ) ) {
			this._removeActiveClass();
			this._removeHoverClass();

			this._trigger( "drop", event, this.ui( draggable ) );
			return this.element;
		}

		return false;

	},

	ui: function( c ) {
		return {
			draggable: ( c.currentItem || c.element ),
			helper: c.helper,
			position: c.position,
			offset: c.positionAbs
		};
	},

	// Extension points just to make backcompat sane and avoid duplicating logic
	// TODO: Remove in 1.13 along with call to it below
	_addHoverClass: function() {
		this._addClass( "ui-droppable-hover" );
	},

	_removeHoverClass: function() {
		this._removeClass( "ui-droppable-hover" );
	},

	_addActiveClass: function() {
		this._addClass( "ui-droppable-active" );
	},

	_removeActiveClass: function() {
		this._removeClass( "ui-droppable-active" );
	}
} );

var intersect = $.ui.intersect = ( function() {
	function isOverAxis( x, reference, size ) {
		return ( x >= reference ) && ( x < ( reference + size ) );
	}

	return function( draggable, droppable, toleranceMode, event ) {

		if ( !droppable.offset ) {
			return false;
		}

		var x1 = ( draggable.positionAbs ||
				draggable.position.absolute ).left + draggable.margins.left,
			y1 = ( draggable.positionAbs ||
				draggable.position.absolute ).top + draggable.margins.top,
			x2 = x1 + draggable.helperProportions.width,
			y2 = y1 + draggable.helperProportions.height,
			l = droppable.offset.left,
			t = droppable.offset.top,
			r = l + droppable.proportions().width,
			b = t + droppable.proportions().height;

		switch ( toleranceMode ) {
		case "fit":
			return ( l <= x1 && x2 <= r && t <= y1 && y2 <= b );
		case "intersect":
			return ( l < x1 + ( draggable.helperProportions.width / 2 ) && // Right Half
				x2 - ( draggable.helperProportions.width / 2 ) < r && // Left Half
				t < y1 + ( draggable.helperProportions.height / 2 ) && // Bottom Half
				y2 - ( draggable.helperProportions.height / 2 ) < b ); // Top Half
		case "pointer":
			return isOverAxis( event.pageY, t, droppable.proportions().height ) &&
				isOverAxis( event.pageX, l, droppable.proportions().width );
		case "touch":
			return (
				( y1 >= t && y1 <= b ) || // Top edge touching
				( y2 >= t && y2 <= b ) || // Bottom edge touching
				( y1 < t && y2 > b ) // Surrounded vertically
			) && (
				( x1 >= l && x1 <= r ) || // Left edge touching
				( x2 >= l && x2 <= r ) || // Right edge touching
				( x1 < l && x2 > r ) // Surrounded horizontally
			);
		default:
			return false;
		}
	};
} )();

/*
	This manager tracks offsets of draggables and droppables
*/
$.ui.ddmanager = {
	current: null,
	droppables: { "default": [] },
	prepareOffsets: function( t, event ) {

		var i, j,
			m = $.ui.ddmanager.droppables[ t.options.scope ] || [],
			type = event ? event.type : null, // workaround for #2317
			list = ( t.currentItem || t.element ).find( ":data(ui-droppable)" ).addBack();

		droppablesLoop: for ( i = 0; i < m.length; i++ ) {

			// No disabled and non-accepted
			if ( m[ i ].options.disabled || ( t && !m[ i ].accept.call( m[ i ].element[ 0 ],
					( t.currentItem || t.element ) ) ) ) {
				continue;
			}

			// Filter out elements in the current dragged item
			for ( j = 0; j < list.length; j++ ) {
				if ( list[ j ] === m[ i ].element[ 0 ] ) {
					m[ i ].proportions().height = 0;
					continue droppablesLoop;
				}
			}

			m[ i ].visible = m[ i ].element.css( "display" ) !== "none";
			if ( !m[ i ].visible ) {
				continue;
			}

			// Activate the droppable if used directly from draggables
			if ( type === "mousedown" ) {
				m[ i ]._activate.call( m[ i ], event );
			}

			m[ i ].offset = m[ i ].element.offset();
			m[ i ].proportions( {
				width: m[ i ].element[ 0 ].offsetWidth,
				height: m[ i ].element[ 0 ].offsetHeight
			} );

		}

	},
	drop: function( draggable, event ) {

		var dropped = false;

		// Create a copy of the droppables in case the list changes during the drop (#9116)
		$.each( ( $.ui.ddmanager.droppables[ draggable.options.scope ] || [] ).slice(), function() {

			if ( !this.options ) {
				return;
			}
			if ( !this.options.disabled && this.visible &&
					intersect( draggable, this, this.options.tolerance, event ) ) {
				dropped = this._drop.call( this, event ) || dropped;
			}

			if ( !this.options.disabled && this.visible && this.accept.call( this.element[ 0 ],
					( draggable.currentItem || draggable.element ) ) ) {
				this.isout = true;
				this.isover = false;
				this._deactivate.call( this, event );
			}

		} );
		return dropped;

	},
	dragStart: function( draggable, event ) {

		// Listen for scrolling so that if the dragging causes scrolling the position of the
		// droppables can be recalculated (see #5003)
		draggable.element.parentsUntil( "body" ).on( "scroll.droppable", function() {
			if ( !draggable.options.refreshPositions ) {
				$.ui.ddmanager.prepareOffsets( draggable, event );
			}
		} );
	},
	drag: function( draggable, event ) {

		// If you have a highly dynamic page, you might try this option. It renders positions
		// every time you move the mouse.
		if ( draggable.options.refreshPositions ) {
			$.ui.ddmanager.prepareOffsets( draggable, event );
		}

		// Run through all droppables and check their positions based on specific tolerance options
		$.each( $.ui.ddmanager.droppables[ draggable.options.scope ] || [], function() {

			if ( this.options.disabled || this.greedyChild || !this.visible ) {
				return;
			}

			var parentInstance, scope, parent,
				intersects = intersect( draggable, this, this.options.tolerance, event ),
				c = !intersects && this.isover ?
					"isout" :
					( intersects && !this.isover ? "isover" : null );
			if ( !c ) {
				return;
			}

			if ( this.options.greedy ) {

				// find droppable parents with same scope
				scope = this.options.scope;
				parent = this.element.parents( ":data(ui-droppable)" ).filter( function() {
					return $( this ).droppable( "instance" ).options.scope === scope;
				} );

				if ( parent.length ) {
					parentInstance = $( parent[ 0 ] ).droppable( "instance" );
					parentInstance.greedyChild = ( c === "isover" );
				}
			}

			// We just moved into a greedy child
			if ( parentInstance && c === "isover" ) {
				parentInstance.isover = false;
				parentInstance.isout = true;
				parentInstance._out.call( parentInstance, event );
			}

			this[ c ] = true;
			this[ c === "isout" ? "isover" : "isout" ] = false;
			this[ c === "isover" ? "_over" : "_out" ].call( this, event );

			// We just moved out of a greedy child
			if ( parentInstance && c === "isout" ) {
				parentInstance.isout = false;
				parentInstance.isover = true;
				parentInstance._over.call( parentInstance, event );
			}
		} );

	},
	dragStop: function( draggable, event ) {
		draggable.element.parentsUntil( "body" ).off( "scroll.droppable" );

		// Call prepareOffsets one final time since IE does not fire return scroll events when
		// overflow was caused by drag (see #5003)
		if ( !draggable.options.refreshPositions ) {
			$.ui.ddmanager.prepareOffsets( draggable, event );
		}
	}
};

// DEPRECATED
// TODO: switch return back to widget declaration at top of file when this is removed
if ( $.uiBackCompat !== false ) {

	// Backcompat for activeClass and hoverClass options
	$.widget( "ui.droppable", $.ui.droppable, {
		options: {
			hoverClass: false,
			activeClass: false
		},
		_addActiveClass: function() {
			this._super();
			if ( this.options.activeClass ) {
				this.element.addClass( this.options.activeClass );
			}
		},
		_removeActiveClass: function() {
			this._super();
			if ( this.options.activeClass ) {
				this.element.removeClass( this.options.activeClass );
			}
		},
		_addHoverClass: function() {
			this._super();
			if ( this.options.hoverClass ) {
				this.element.addClass( this.options.hoverClass );
			}
		},
		_removeHoverClass: function() {
			this._super();
			if ( this.options.hoverClass ) {
				this.element.removeClass( this.options.hoverClass );
			}
		}
	} );
}

var widgetsDroppable = $.ui.droppable;



//>>label: Progressbar
//>>group: Widgets
// jscs:disable maximumLineLength
//>>description: Displays a status indicator for loading state, standard percentage, and other progress indicators.
// jscs:enable maximumLineLength
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/progressbar.css
//>>css.theme: ../../themes/base/theme.css



var widgetsProgressbar = $.widget( "ui.progressbar", {
	version: "1.12.1",
	options: {
		classes: {
			"ui-progressbar": "ui-corner-all",
			"ui-progressbar-value": "ui-corner-left",
			"ui-progressbar-complete": "ui-corner-right"
		},
		max: 100,
		value: 0,

		change: null,
		complete: null
	},

	min: 0,

	_create: function() {

		// Constrain initial value
		this.oldValue = this.options.value = this._constrainedValue();

		this.element.attr( {

			// Only set static values; aria-valuenow and aria-valuemax are
			// set inside _refreshValue()
			role: "progressbar",
			"aria-valuemin": this.min
		} );
		this._addClass( "ui-progressbar", "ui-widget ui-widget-content" );

		this.valueDiv = $( "<div>" ).appendTo( this.element );
		this._addClass( this.valueDiv, "ui-progressbar-value", "ui-widget-header" );
		this._refreshValue();
	},

	_destroy: function() {
		this.element.removeAttr( "role aria-valuemin aria-valuemax aria-valuenow" );

		this.valueDiv.remove();
	},

	value: function( newValue ) {
		if ( newValue === undefined ) {
			return this.options.value;
		}

		this.options.value = this._constrainedValue( newValue );
		this._refreshValue();
	},

	_constrainedValue: function( newValue ) {
		if ( newValue === undefined ) {
			newValue = this.options.value;
		}

		this.indeterminate = newValue === false;

		// Sanitize value
		if ( typeof newValue !== "number" ) {
			newValue = 0;
		}

		return this.indeterminate ? false :
			Math.min( this.options.max, Math.max( this.min, newValue ) );
	},

	_setOptions: function( options ) {

		// Ensure "value" option is set after other values (like max)
		var value = options.value;
		delete options.value;

		this._super( options );

		this.options.value = this._constrainedValue( value );
		this._refreshValue();
	},

	_setOption: function( key, value ) {
		if ( key === "max" ) {

			// Don't allow a max less than min
			value = Math.max( this.min, value );
		}
		this._super( key, value );
	},

	_setOptionDisabled: function( value ) {
		this._super( value );

		this.element.attr( "aria-disabled", value );
		this._toggleClass( null, "ui-state-disabled", !!value );
	},

	_percentage: function() {
		return this.indeterminate ?
			100 :
			100 * ( this.options.value - this.min ) / ( this.options.max - this.min );
	},

	_refreshValue: function() {
		var value = this.options.value,
			percentage = this._percentage();

		this.valueDiv
			.toggle( this.indeterminate || value > this.min )
			.width( percentage.toFixed( 0 ) + "%" );

		this
			._toggleClass( this.valueDiv, "ui-progressbar-complete", null,
				value === this.options.max )
			._toggleClass( "ui-progressbar-indeterminate", null, this.indeterminate );

		if ( this.indeterminate ) {
			this.element.removeAttr( "aria-valuenow" );
			if ( !this.overlayDiv ) {
				this.overlayDiv = $( "<div>" ).appendTo( this.valueDiv );
				this._addClass( this.overlayDiv, "ui-progressbar-overlay" );
			}
		} else {
			this.element.attr( {
				"aria-valuemax": this.options.max,
				"aria-valuenow": value
			} );
			if ( this.overlayDiv ) {
				this.overlayDiv.remove();
				this.overlayDiv = null;
			}
		}

		if ( this.oldValue !== value ) {
			this.oldValue = value;
			this._trigger( "change" );
		}
		if ( value === this.options.max ) {
			this._trigger( "complete" );
		}
	}
} );




//>>label: Selectable
//>>group: Interactions
//>>description: Allows groups of elements to be selected with the mouse.
//>>css.structure: ../../themes/base/selectable.css



var widgetsSelectable = $.widget( "ui.selectable", $.ui.mouse, {
	version: "1.12.1",
	options: {
		appendTo: "body",
		autoRefresh: true,
		distance: 0,
		filter: "*",
		tolerance: "touch",

		// Callbacks
		selected: null,
		selecting: null,
		start: null,
		stop: null,
		unselected: null,
		unselecting: null
	},
	_create: function() {
		var that = this;

		this._addClass( "ui-selectable" );

		this.dragged = false;

		// Cache selectee children based on filter
		this.refresh = function() {
			that.elementPos = $( that.element[ 0 ] ).offset();
			that.selectees = $( that.options.filter, that.element[ 0 ] );
			that._addClass( that.selectees, "ui-selectee" );
			that.selectees.each( function() {
				var $this = $( this ),
					selecteeOffset = $this.offset(),
					pos = {
						left: selecteeOffset.left - that.elementPos.left,
						top: selecteeOffset.top - that.elementPos.top
					};
				$.data( this, "selectable-item", {
					element: this,
					$element: $this,
					left: pos.left,
					top: pos.top,
					right: pos.left + $this.outerWidth(),
					bottom: pos.top + $this.outerHeight(),
					startselected: false,
					selected: $this.hasClass( "ui-selected" ),
					selecting: $this.hasClass( "ui-selecting" ),
					unselecting: $this.hasClass( "ui-unselecting" )
				} );
			} );
		};
		this.refresh();

		this._mouseInit();

		this.helper = $( "<div>" );
		this._addClass( this.helper, "ui-selectable-helper" );
	},

	_destroy: function() {
		this.selectees.removeData( "selectable-item" );
		this._mouseDestroy();
	},

	_mouseStart: function( event ) {
		var that = this,
			options = this.options;

		this.opos = [ event.pageX, event.pageY ];
		this.elementPos = $( this.element[ 0 ] ).offset();

		if ( this.options.disabled ) {
			return;
		}

		this.selectees = $( options.filter, this.element[ 0 ] );

		this._trigger( "start", event );

		$( options.appendTo ).append( this.helper );

		// position helper (lasso)
		this.helper.css( {
			"left": event.pageX,
			"top": event.pageY,
			"width": 0,
			"height": 0
		} );

		if ( options.autoRefresh ) {
			this.refresh();
		}

		this.selectees.filter( ".ui-selected" ).each( function() {
			var selectee = $.data( this, "selectable-item" );
			selectee.startselected = true;
			if ( !event.metaKey && !event.ctrlKey ) {
				that._removeClass( selectee.$element, "ui-selected" );
				selectee.selected = false;
				that._addClass( selectee.$element, "ui-unselecting" );
				selectee.unselecting = true;

				// selectable UNSELECTING callback
				that._trigger( "unselecting", event, {
					unselecting: selectee.element
				} );
			}
		} );

		$( event.target ).parents().addBack().each( function() {
			var doSelect,
				selectee = $.data( this, "selectable-item" );
			if ( selectee ) {
				doSelect = ( !event.metaKey && !event.ctrlKey ) ||
					!selectee.$element.hasClass( "ui-selected" );
				that._removeClass( selectee.$element, doSelect ? "ui-unselecting" : "ui-selected" )
					._addClass( selectee.$element, doSelect ? "ui-selecting" : "ui-unselecting" );
				selectee.unselecting = !doSelect;
				selectee.selecting = doSelect;
				selectee.selected = doSelect;

				// selectable (UN)SELECTING callback
				if ( doSelect ) {
					that._trigger( "selecting", event, {
						selecting: selectee.element
					} );
				} else {
					that._trigger( "unselecting", event, {
						unselecting: selectee.element
					} );
				}
				return false;
			}
		} );

	},

	_mouseDrag: function( event ) {

		this.dragged = true;

		if ( this.options.disabled ) {
			return;
		}

		var tmp,
			that = this,
			options = this.options,
			x1 = this.opos[ 0 ],
			y1 = this.opos[ 1 ],
			x2 = event.pageX,
			y2 = event.pageY;

		if ( x1 > x2 ) { tmp = x2; x2 = x1; x1 = tmp; }
		if ( y1 > y2 ) { tmp = y2; y2 = y1; y1 = tmp; }
		this.helper.css( { left: x1, top: y1, width: x2 - x1, height: y2 - y1 } );

		this.selectees.each( function() {
			var selectee = $.data( this, "selectable-item" ),
				hit = false,
				offset = {};

			//prevent helper from being selected if appendTo: selectable
			if ( !selectee || selectee.element === that.element[ 0 ] ) {
				return;
			}

			offset.left   = selectee.left   + that.elementPos.left;
			offset.right  = selectee.right  + that.elementPos.left;
			offset.top    = selectee.top    + that.elementPos.top;
			offset.bottom = selectee.bottom + that.elementPos.top;

			if ( options.tolerance === "touch" ) {
				hit = ( !( offset.left > x2 || offset.right < x1 || offset.top > y2 ||
                    offset.bottom < y1 ) );
			} else if ( options.tolerance === "fit" ) {
				hit = ( offset.left > x1 && offset.right < x2 && offset.top > y1 &&
                    offset.bottom < y2 );
			}

			if ( hit ) {

				// SELECT
				if ( selectee.selected ) {
					that._removeClass( selectee.$element, "ui-selected" );
					selectee.selected = false;
				}
				if ( selectee.unselecting ) {
					that._removeClass( selectee.$element, "ui-unselecting" );
					selectee.unselecting = false;
				}
				if ( !selectee.selecting ) {
					that._addClass( selectee.$element, "ui-selecting" );
					selectee.selecting = true;

					// selectable SELECTING callback
					that._trigger( "selecting", event, {
						selecting: selectee.element
					} );
				}
			} else {

				// UNSELECT
				if ( selectee.selecting ) {
					if ( ( event.metaKey || event.ctrlKey ) && selectee.startselected ) {
						that._removeClass( selectee.$element, "ui-selecting" );
						selectee.selecting = false;
						that._addClass( selectee.$element, "ui-selected" );
						selectee.selected = true;
					} else {
						that._removeClass( selectee.$element, "ui-selecting" );
						selectee.selecting = false;
						if ( selectee.startselected ) {
							that._addClass( selectee.$element, "ui-unselecting" );
							selectee.unselecting = true;
						}

						// selectable UNSELECTING callback
						that._trigger( "unselecting", event, {
							unselecting: selectee.element
						} );
					}
				}
				if ( selectee.selected ) {
					if ( !event.metaKey && !event.ctrlKey && !selectee.startselected ) {
						that._removeClass( selectee.$element, "ui-selected" );
						selectee.selected = false;

						that._addClass( selectee.$element, "ui-unselecting" );
						selectee.unselecting = true;

						// selectable UNSELECTING callback
						that._trigger( "unselecting", event, {
							unselecting: selectee.element
						} );
					}
				}
			}
		} );

		return false;
	},

	_mouseStop: function( event ) {
		var that = this;

		this.dragged = false;

		$( ".ui-unselecting", this.element[ 0 ] ).each( function() {
			var selectee = $.data( this, "selectable-item" );
			that._removeClass( selectee.$element, "ui-unselecting" );
			selectee.unselecting = false;
			selectee.startselected = false;
			that._trigger( "unselected", event, {
				unselected: selectee.element
			} );
		} );
		$( ".ui-selecting", this.element[ 0 ] ).each( function() {
			var selectee = $.data( this, "selectable-item" );
			that._removeClass( selectee.$element, "ui-selecting" )
				._addClass( selectee.$element, "ui-selected" );
			selectee.selecting = false;
			selectee.selected = true;
			selectee.startselected = true;
			that._trigger( "selected", event, {
				selected: selectee.element
			} );
		} );
		this._trigger( "stop", event );

		this.helper.remove();

		return false;
	}

} );




//>>label: Selectmenu
//>>group: Widgets
// jscs:disable maximumLineLength
//>>description: Duplicates and extends the functionality of a native HTML select element, allowing it to be customizable in behavior and appearance far beyond the limitations of a native select.
// jscs:enable maximumLineLength
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/selectmenu.css, ../../themes/base/button.css
//>>css.theme: ../../themes/base/theme.css



var widgetsSelectmenu = $.widget( "ui.selectmenu", [ $.ui.formResetMixin, {
	version: "1.12.1",
	defaultElement: "<select>",
	options: {
		appendTo: null,
		classes: {
			"ui-selectmenu-button-open": "ui-corner-top",
			"ui-selectmenu-button-closed": "ui-corner-all"
		},
		disabled: null,
		icons: {
			button: "ui-icon-triangle-1-s"
		},
		position: {
			my: "left top",
			at: "left bottom",
			collision: "none"
		},
		width: false,

		// Callbacks
		change: null,
		close: null,
		focus: null,
		open: null,
		select: null
	},

	_create: function() {
		var selectmenuId = this.element.uniqueId().attr( "id" );
		this.ids = {
			element: selectmenuId,
			button: selectmenuId + "-button",
			menu: selectmenuId + "-menu"
		};

		this._drawButton();
		this._drawMenu();
		this._bindFormResetHandler();

		this._rendered = false;
		this.menuItems = $();
	},

	_drawButton: function() {
		var icon,
			that = this,
			item = this._parseOption(
				this.element.find( "option:selected" ),
				this.element[ 0 ].selectedIndex
			);

		// Associate existing label with the new button
		this.labels = this.element.labels().attr( "for", this.ids.button );
		this._on( this.labels, {
			click: function( event ) {
				this.button.focus();
				event.preventDefault();
			}
		} );

		// Hide original select element
		this.element.hide();

		// Create button
		this.button = $( "<span>", {
			tabindex: this.options.disabled ? -1 : 0,
			id: this.ids.button,
			role: "combobox",
			"aria-expanded": "false",
			"aria-autocomplete": "list",
			"aria-owns": this.ids.menu,
			"aria-haspopup": "true",
			title: this.element.attr( "title" )
		} )
			.insertAfter( this.element );

		this._addClass( this.button, "ui-selectmenu-button ui-selectmenu-button-closed",
			"ui-button ui-widget" );

		icon = $( "<span>" ).appendTo( this.button );
		this._addClass( icon, "ui-selectmenu-icon", "ui-icon " + this.options.icons.button );
		this.buttonItem = this._renderButtonItem( item )
			.appendTo( this.button );

		if ( this.options.width !== false ) {
			this._resizeButton();
		}

		this._on( this.button, this._buttonEvents );
		this.button.one( "focusin", function() {

			// Delay rendering the menu items until the button receives focus.
			// The menu may have already been rendered via a programmatic open.
			if ( !that._rendered ) {
				that._refreshMenu();
			}
		} );
	},

	_drawMenu: function() {
		var that = this;

		// Create menu
		this.menu = $( "<ul>", {
			"aria-hidden": "true",
			"aria-labelledby": this.ids.button,
			id: this.ids.menu
		} );

		// Wrap menu
		this.menuWrap = $( "<div>" ).append( this.menu );
		this._addClass( this.menuWrap, "ui-selectmenu-menu", "ui-front" );
		this.menuWrap.appendTo( this._appendTo() );

		// Initialize menu widget
		this.menuInstance = this.menu
			.menu( {
				classes: {
					"ui-menu": "ui-corner-bottom"
				},
				role: "listbox",
				select: function( event, ui ) {
					event.preventDefault();

					// Support: IE8
					// If the item was selected via a click, the text selection
					// will be destroyed in IE
					that._setSelection();

					that._select( ui.item.data( "ui-selectmenu-item" ), event );
				},
				focus: function( event, ui ) {
					var item = ui.item.data( "ui-selectmenu-item" );

					// Prevent inital focus from firing and check if its a newly focused item
					if ( that.focusIndex != null && item.index !== that.focusIndex ) {
						that._trigger( "focus", event, { item: item } );
						if ( !that.isOpen ) {
							that._select( item, event );
						}
					}
					that.focusIndex = item.index;

					that.button.attr( "aria-activedescendant",
						that.menuItems.eq( item.index ).attr( "id" ) );
				}
			} )
			.menu( "instance" );

		// Don't close the menu on mouseleave
		this.menuInstance._off( this.menu, "mouseleave" );

		// Cancel the menu's collapseAll on document click
		this.menuInstance._closeOnDocumentClick = function() {
			return false;
		};

		// Selects often contain empty items, but never contain dividers
		this.menuInstance._isDivider = function() {
			return false;
		};
	},

	refresh: function() {
		this._refreshMenu();
		this.buttonItem.replaceWith(
			this.buttonItem = this._renderButtonItem(

				// Fall back to an empty object in case there are no options
				this._getSelectedItem().data( "ui-selectmenu-item" ) || {}
			)
		);
		if ( this.options.width === null ) {
			this._resizeButton();
		}
	},

	_refreshMenu: function() {
		var item,
			options = this.element.find( "option" );

		this.menu.empty();

		this._parseOptions( options );
		this._renderMenu( this.menu, this.items );

		this.menuInstance.refresh();
		this.menuItems = this.menu.find( "li" )
			.not( ".ui-selectmenu-optgroup" )
				.find( ".ui-menu-item-wrapper" );

		this._rendered = true;

		if ( !options.length ) {
			return;
		}

		item = this._getSelectedItem();

		// Update the menu to have the correct item focused
		this.menuInstance.focus( null, item );
		this._setAria( item.data( "ui-selectmenu-item" ) );

		// Set disabled state
		this._setOption( "disabled", this.element.prop( "disabled" ) );
	},

	open: function( event ) {
		if ( this.options.disabled ) {
			return;
		}

		// If this is the first time the menu is being opened, render the items
		if ( !this._rendered ) {
			this._refreshMenu();
		} else {

			// Menu clears focus on close, reset focus to selected item
			this._removeClass( this.menu.find( ".ui-state-active" ), null, "ui-state-active" );
			this.menuInstance.focus( null, this._getSelectedItem() );
		}

		// If there are no options, don't open the menu
		if ( !this.menuItems.length ) {
			return;
		}

		this.isOpen = true;
		this._toggleAttr();
		this._resizeMenu();
		this._position();

		this._on( this.document, this._documentClick );

		this._trigger( "open", event );
	},

	_position: function() {
		this.menuWrap.position( $.extend( { of: this.button }, this.options.position ) );
	},

	close: function( event ) {
		if ( !this.isOpen ) {
			return;
		}

		this.isOpen = false;
		this._toggleAttr();

		this.range = null;
		this._off( this.document );

		this._trigger( "close", event );
	},

	widget: function() {
		return this.button;
	},

	menuWidget: function() {
		return this.menu;
	},

	_renderButtonItem: function( item ) {
		var buttonItem = $( "<span>" );

		this._setText( buttonItem, item.label );
		this._addClass( buttonItem, "ui-selectmenu-text" );

		return buttonItem;
	},

	_renderMenu: function( ul, items ) {
		var that = this,
			currentOptgroup = "";

		$.each( items, function( index, item ) {
			var li;

			if ( item.optgroup !== currentOptgroup ) {
				li = $( "<li>", {
					text: item.optgroup
				} );
				that._addClass( li, "ui-selectmenu-optgroup", "ui-menu-divider" +
					( item.element.parent( "optgroup" ).prop( "disabled" ) ?
						" ui-state-disabled" :
						"" ) );

				li.appendTo( ul );

				currentOptgroup = item.optgroup;
			}

			that._renderItemData( ul, item );
		} );
	},

	_renderItemData: function( ul, item ) {
		return this._renderItem( ul, item ).data( "ui-selectmenu-item", item );
	},

	_renderItem: function( ul, item ) {
		var li = $( "<li>" ),
			wrapper = $( "<div>", {
				title: item.element.attr( "title" )
			} );

		if ( item.disabled ) {
			this._addClass( li, null, "ui-state-disabled" );
		}
		this._setText( wrapper, item.label );

		return li.append( wrapper ).appendTo( ul );
	},

	_setText: function( element, value ) {
		if ( value ) {
			element.text( value );
		} else {
			element.html( "&#160;" );
		}
	},

	_move: function( direction, event ) {
		var item, next,
			filter = ".ui-menu-item";

		if ( this.isOpen ) {
			item = this.menuItems.eq( this.focusIndex ).parent( "li" );
		} else {
			item = this.menuItems.eq( this.element[ 0 ].selectedIndex ).parent( "li" );
			filter += ":not(.ui-state-disabled)";
		}

		if ( direction === "first" || direction === "last" ) {
			next = item[ direction === "first" ? "prevAll" : "nextAll" ]( filter ).eq( -1 );
		} else {
			next = item[ direction + "All" ]( filter ).eq( 0 );
		}

		if ( next.length ) {
			this.menuInstance.focus( event, next );
		}
	},

	_getSelectedItem: function() {
		return this.menuItems.eq( this.element[ 0 ].selectedIndex ).parent( "li" );
	},

	_toggle: function( event ) {
		this[ this.isOpen ? "close" : "open" ]( event );
	},

	_setSelection: function() {
		var selection;

		if ( !this.range ) {
			return;
		}

		if ( window.getSelection ) {
			selection = window.getSelection();
			selection.removeAllRanges();
			selection.addRange( this.range );

		// Support: IE8
		} else {
			this.range.select();
		}

		// Support: IE
		// Setting the text selection kills the button focus in IE, but
		// restoring the focus doesn't kill the selection.
		this.button.focus();
	},

	_documentClick: {
		mousedown: function( event ) {
			if ( !this.isOpen ) {
				return;
			}

			if ( !$( event.target ).closest( ".ui-selectmenu-menu, #" +
					$.ui.escapeSelector( this.ids.button ) ).length ) {
				this.close( event );
			}
		}
	},

	_buttonEvents: {

		// Prevent text selection from being reset when interacting with the selectmenu (#10144)
		mousedown: function() {
			var selection;

			if ( window.getSelection ) {
				selection = window.getSelection();
				if ( selection.rangeCount ) {
					this.range = selection.getRangeAt( 0 );
				}

			// Support: IE8
			} else {
				this.range = document.selection.createRange();
			}
		},

		click: function( event ) {
			this._setSelection();
			this._toggle( event );
		},

		keydown: function( event ) {
			var preventDefault = true;
			switch ( event.keyCode ) {
			case $.ui.keyCode.TAB:
			case $.ui.keyCode.ESCAPE:
				this.close( event );
				preventDefault = false;
				break;
			case $.ui.keyCode.ENTER:
				if ( this.isOpen ) {
					this._selectFocusedItem( event );
				}
				break;
			case $.ui.keyCode.UP:
				if ( event.altKey ) {
					this._toggle( event );
				} else {
					this._move( "prev", event );
				}
				break;
			case $.ui.keyCode.DOWN:
				if ( event.altKey ) {
					this._toggle( event );
				} else {
					this._move( "next", event );
				}
				break;
			case $.ui.keyCode.SPACE:
				if ( this.isOpen ) {
					this._selectFocusedItem( event );
				} else {
					this._toggle( event );
				}
				break;
			case $.ui.keyCode.LEFT:
				this._move( "prev", event );
				break;
			case $.ui.keyCode.RIGHT:
				this._move( "next", event );
				break;
			case $.ui.keyCode.HOME:
			case $.ui.keyCode.PAGE_UP:
				this._move( "first", event );
				break;
			case $.ui.keyCode.END:
			case $.ui.keyCode.PAGE_DOWN:
				this._move( "last", event );
				break;
			default:
				this.menu.trigger( event );
				preventDefault = false;
			}

			if ( preventDefault ) {
				event.preventDefault();
			}
		}
	},

	_selectFocusedItem: function( event ) {
		var item = this.menuItems.eq( this.focusIndex ).parent( "li" );
		if ( !item.hasClass( "ui-state-disabled" ) ) {
			this._select( item.data( "ui-selectmenu-item" ), event );
		}
	},

	_select: function( item, event ) {
		var oldIndex = this.element[ 0 ].selectedIndex;

		// Change native select element
		this.element[ 0 ].selectedIndex = item.index;
		this.buttonItem.replaceWith( this.buttonItem = this._renderButtonItem( item ) );
		this._setAria( item );
		this._trigger( "select", event, { item: item } );

		if ( item.index !== oldIndex ) {
			this._trigger( "change", event, { item: item } );
		}

		this.close( event );
	},

	_setAria: function( item ) {
		var id = this.menuItems.eq( item.index ).attr( "id" );

		this.button.attr( {
			"aria-labelledby": id,
			"aria-activedescendant": id
		} );
		this.menu.attr( "aria-activedescendant", id );
	},

	_setOption: function( key, value ) {
		if ( key === "icons" ) {
			var icon = this.button.find( "span.ui-icon" );
			this._removeClass( icon, null, this.options.icons.button )
				._addClass( icon, null, value.button );
		}

		this._super( key, value );

		if ( key === "appendTo" ) {
			this.menuWrap.appendTo( this._appendTo() );
		}

		if ( key === "width" ) {
			this._resizeButton();
		}
	},

	_setOptionDisabled: function( value ) {
		this._super( value );

		this.menuInstance.option( "disabled", value );
		this.button.attr( "aria-disabled", value );
		this._toggleClass( this.button, null, "ui-state-disabled", value );

		this.element.prop( "disabled", value );
		if ( value ) {
			this.button.attr( "tabindex", -1 );
			this.close();
		} else {
			this.button.attr( "tabindex", 0 );
		}
	},

	_appendTo: function() {
		var element = this.options.appendTo;

		if ( element ) {
			element = element.jquery || element.nodeType ?
				$( element ) :
				this.document.find( element ).eq( 0 );
		}

		if ( !element || !element[ 0 ] ) {
			element = this.element.closest( ".ui-front, dialog" );
		}

		if ( !element.length ) {
			element = this.document[ 0 ].body;
		}

		return element;
	},

	_toggleAttr: function() {
		this.button.attr( "aria-expanded", this.isOpen );

		// We can't use two _toggleClass() calls here, because we need to make sure
		// we always remove classes first and add them second, otherwise if both classes have the
		// same theme class, it will be removed after we add it.
		this._removeClass( this.button, "ui-selectmenu-button-" +
			( this.isOpen ? "closed" : "open" ) )
			._addClass( this.button, "ui-selectmenu-button-" +
				( this.isOpen ? "open" : "closed" ) )
			._toggleClass( this.menuWrap, "ui-selectmenu-open", null, this.isOpen );

		this.menu.attr( "aria-hidden", !this.isOpen );
	},

	_resizeButton: function() {
		var width = this.options.width;

		// For `width: false`, just remove inline style and stop
		if ( width === false ) {
			this.button.css( "width", "" );
			return;
		}

		// For `width: null`, match the width of the original element
		if ( width === null ) {
			width = this.element.show().outerWidth();
			this.element.hide();
		}

		this.button.outerWidth( width );
	},

	_resizeMenu: function() {
		this.menu.outerWidth( Math.max(
			this.button.outerWidth(),

			// Support: IE10
			// IE10 wraps long text (possibly a rounding bug)
			// so we add 1px to avoid the wrapping
			this.menu.width( "" ).outerWidth() + 1
		) );
	},

	_getCreateOptions: function() {
		var options = this._super();

		options.disabled = this.element.prop( "disabled" );

		return options;
	},

	_parseOptions: function( options ) {
		var that = this,
			data = [];
		options.each( function( index, item ) {
			data.push( that._parseOption( $( item ), index ) );
		} );
		this.items = data;
	},

	_parseOption: function( option, index ) {
		var optgroup = option.parent( "optgroup" );

		return {
			element: option,
			index: index,
			value: option.val(),
			label: option.text(),
			optgroup: optgroup.attr( "label" ) || "",
			disabled: optgroup.prop( "disabled" ) || option.prop( "disabled" )
		};
	},

	_destroy: function() {
		this._unbindFormResetHandler();
		this.menuWrap.remove();
		this.button.remove();
		this.element.show();
		this.element.removeUniqueId();
		this.labels.attr( "for", this.ids.element );
	}
} ] );




//>>label: Slider
//>>group: Widgets
//>>description: Displays a flexible slider with ranges and accessibility via keyboard.

//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/slider.css
//>>css.theme: ../../themes/base/theme.css



var widgetsSlider = $.widget( "ui.slider", $.ui.mouse, {
	version: "1.12.1",
	widgetEventPrefix: "slide",

	options: {
		animate: false,
		classes: {
			"ui-slider": "ui-corner-all",
			"ui-slider-handle": "ui-corner-all",

			// Note: ui-widget-header isn't the most fittingly semantic framework class for this
			// element, but worked best visually with a variety of themes
			"ui-slider-range": "ui-corner-all ui-widget-header"
		},
		distance: 0,
		max: 100,
		min: 0,
		orientation: "horizontal",
		range: false,
		step: 1,
		value: 0,
		values: null,

		// Callbacks
		change: null,
		slide: null,
		start: null,
		stop: null
	},

	// Number of pages in a slider
	// (how many times can you page up/down to go through the whole range)
	numPages: 5,

	_create: function() {
		this._keySliding = false;
		this._mouseSliding = false;
		this._animateOff = true;
		this._handleIndex = null;
		this._detectOrientation();
		this._mouseInit();
		this._calculateNewMax();

		this._addClass( "ui-slider ui-slider-" + this.orientation,
			"ui-widget ui-widget-content" );

		this._refresh();

		this._animateOff = false;
	},

	_refresh: function() {
		this._createRange();
		this._createHandles();
		this._setupEvents();
		this._refreshValue();
	},

	_createHandles: function() {
		var i, handleCount,
			options = this.options,
			existingHandles = this.element.find( ".ui-slider-handle" ),
			handle = "<span tabindex='0'></span>",
			handles = [];

		handleCount = ( options.values && options.values.length ) || 1;

		if ( existingHandles.length > handleCount ) {
			existingHandles.slice( handleCount ).remove();
			existingHandles = existingHandles.slice( 0, handleCount );
		}

		for ( i = existingHandles.length; i < handleCount; i++ ) {
			handles.push( handle );
		}

		this.handles = existingHandles.add( $( handles.join( "" ) ).appendTo( this.element ) );

		this._addClass( this.handles, "ui-slider-handle", "ui-state-default" );

		this.handle = this.handles.eq( 0 );

		this.handles.each( function( i ) {
			$( this )
				.data( "ui-slider-handle-index", i )
				.attr( "tabIndex", 0 );
		} );
	},

	_createRange: function() {
		var options = this.options;

		if ( options.range ) {
			if ( options.range === true ) {
				if ( !options.values ) {
					options.values = [ this._valueMin(), this._valueMin() ];
				} else if ( options.values.length && options.values.length !== 2 ) {
					options.values = [ options.values[ 0 ], options.values[ 0 ] ];
				} else if ( $.isArray( options.values ) ) {
					options.values = options.values.slice( 0 );
				}
			}

			if ( !this.range || !this.range.length ) {
				this.range = $( "<div>" )
					.appendTo( this.element );

				this._addClass( this.range, "ui-slider-range" );
			} else {
				this._removeClass( this.range, "ui-slider-range-min ui-slider-range-max" );

				// Handle range switching from true to min/max
				this.range.css( {
					"left": "",
					"bottom": ""
				} );
			}
			if ( options.range === "min" || options.range === "max" ) {
				this._addClass( this.range, "ui-slider-range-" + options.range );
			}
		} else {
			if ( this.range ) {
				this.range.remove();
			}
			this.range = null;
		}
	},

	_setupEvents: function() {
		this._off( this.handles );
		this._on( this.handles, this._handleEvents );
		this._hoverable( this.handles );
		this._focusable( this.handles );
	},

	_destroy: function() {
		this.handles.remove();
		if ( this.range ) {
			this.range.remove();
		}

		this._mouseDestroy();
	},

	_mouseCapture: function( event ) {
		var position, normValue, distance, closestHandle, index, allowed, offset, mouseOverHandle,
			that = this,
			o = this.options;

		if ( o.disabled ) {
			return false;
		}

		this.elementSize = {
			width: this.element.outerWidth(),
			height: this.element.outerHeight()
		};
		this.elementOffset = this.element.offset();

		position = { x: event.pageX, y: event.pageY };
		normValue = this._normValueFromMouse( position );
		distance = this._valueMax() - this._valueMin() + 1;
		this.handles.each( function( i ) {
			var thisDistance = Math.abs( normValue - that.values( i ) );
			if ( ( distance > thisDistance ) ||
				( distance === thisDistance &&
					( i === that._lastChangedValue || that.values( i ) === o.min ) ) ) {
				distance = thisDistance;
				closestHandle = $( this );
				index = i;
			}
		} );

		allowed = this._start( event, index );
		if ( allowed === false ) {
			return false;
		}
		this._mouseSliding = true;

		this._handleIndex = index;

		this._addClass( closestHandle, null, "ui-state-active" );
		closestHandle.trigger( "focus" );

		offset = closestHandle.offset();
		mouseOverHandle = !$( event.target ).parents().addBack().is( ".ui-slider-handle" );
		this._clickOffset = mouseOverHandle ? { left: 0, top: 0 } : {
			left: event.pageX - offset.left - ( closestHandle.width() / 2 ),
			top: event.pageY - offset.top -
				( closestHandle.height() / 2 ) -
				( parseInt( closestHandle.css( "borderTopWidth" ), 10 ) || 0 ) -
				( parseInt( closestHandle.css( "borderBottomWidth" ), 10 ) || 0 ) +
				( parseInt( closestHandle.css( "marginTop" ), 10 ) || 0 )
		};

		if ( !this.handles.hasClass( "ui-state-hover" ) ) {
			this._slide( event, index, normValue );
		}
		this._animateOff = true;
		return true;
	},

	_mouseStart: function() {
		return true;
	},

	_mouseDrag: function( event ) {
		var position = { x: event.pageX, y: event.pageY },
			normValue = this._normValueFromMouse( position );

		this._slide( event, this._handleIndex, normValue );

		return false;
	},

	_mouseStop: function( event ) {
		this._removeClass( this.handles, null, "ui-state-active" );
		this._mouseSliding = false;

		this._stop( event, this._handleIndex );
		this._change( event, this._handleIndex );

		this._handleIndex = null;
		this._clickOffset = null;
		this._animateOff = false;

		return false;
	},

	_detectOrientation: function() {
		this.orientation = ( this.options.orientation === "vertical" ) ? "vertical" : "horizontal";
	},

	_normValueFromMouse: function( position ) {
		var pixelTotal,
			pixelMouse,
			percentMouse,
			valueTotal,
			valueMouse;

		if ( this.orientation === "horizontal" ) {
			pixelTotal = this.elementSize.width;
			pixelMouse = position.x - this.elementOffset.left -
				( this._clickOffset ? this._clickOffset.left : 0 );
		} else {
			pixelTotal = this.elementSize.height;
			pixelMouse = position.y - this.elementOffset.top -
				( this._clickOffset ? this._clickOffset.top : 0 );
		}

		percentMouse = ( pixelMouse / pixelTotal );
		if ( percentMouse > 1 ) {
			percentMouse = 1;
		}
		if ( percentMouse < 0 ) {
			percentMouse = 0;
		}
		if ( this.orientation === "vertical" ) {
			percentMouse = 1 - percentMouse;
		}

		valueTotal = this._valueMax() - this._valueMin();
		valueMouse = this._valueMin() + percentMouse * valueTotal;

		return this._trimAlignValue( valueMouse );
	},

	_uiHash: function( index, value, values ) {
		var uiHash = {
			handle: this.handles[ index ],
			handleIndex: index,
			value: value !== undefined ? value : this.value()
		};

		if ( this._hasMultipleValues() ) {
			uiHash.value = value !== undefined ? value : this.values( index );
			uiHash.values = values || this.values();
		}

		return uiHash;
	},

	_hasMultipleValues: function() {
		return this.options.values && this.options.values.length;
	},

	_start: function( event, index ) {
		return this._trigger( "start", event, this._uiHash( index ) );
	},

	_slide: function( event, index, newVal ) {
		var allowed, otherVal,
			currentValue = this.value(),
			newValues = this.values();

		if ( this._hasMultipleValues() ) {
			otherVal = this.values( index ? 0 : 1 );
			currentValue = this.values( index );

			if ( this.options.values.length === 2 && this.options.range === true ) {
				newVal =  index === 0 ? Math.min( otherVal, newVal ) : Math.max( otherVal, newVal );
			}

			newValues[ index ] = newVal;
		}

		if ( newVal === currentValue ) {
			return;
		}

		allowed = this._trigger( "slide", event, this._uiHash( index, newVal, newValues ) );

		// A slide can be canceled by returning false from the slide callback
		if ( allowed === false ) {
			return;
		}

		if ( this._hasMultipleValues() ) {
			this.values( index, newVal );
		} else {
			this.value( newVal );
		}
	},

	_stop: function( event, index ) {
		this._trigger( "stop", event, this._uiHash( index ) );
	},

	_change: function( event, index ) {
		if ( !this._keySliding && !this._mouseSliding ) {

			//store the last changed value index for reference when handles overlap
			this._lastChangedValue = index;
			this._trigger( "change", event, this._uiHash( index ) );
		}
	},

	value: function( newValue ) {
		if ( arguments.length ) {
			this.options.value = this._trimAlignValue( newValue );
			this._refreshValue();
			this._change( null, 0 );
			return;
		}

		return this._value();
	},

	values: function( index, newValue ) {
		var vals,
			newValues,
			i;

		if ( arguments.length > 1 ) {
			this.options.values[ index ] = this._trimAlignValue( newValue );
			this._refreshValue();
			this._change( null, index );
			return;
		}

		if ( arguments.length ) {
			if ( $.isArray( arguments[ 0 ] ) ) {
				vals = this.options.values;
				newValues = arguments[ 0 ];
				for ( i = 0; i < vals.length; i += 1 ) {
					vals[ i ] = this._trimAlignValue( newValues[ i ] );
					this._change( null, i );
				}
				this._refreshValue();
			} else {
				if ( this._hasMultipleValues() ) {
					return this._values( index );
				} else {
					return this.value();
				}
			}
		} else {
			return this._values();
		}
	},

	_setOption: function( key, value ) {
		var i,
			valsLength = 0;

		if ( key === "range" && this.options.range === true ) {
			if ( value === "min" ) {
				this.options.value = this._values( 0 );
				this.options.values = null;
			} else if ( value === "max" ) {
				this.options.value = this._values( this.options.values.length - 1 );
				this.options.values = null;
			}
		}

		if ( $.isArray( this.options.values ) ) {
			valsLength = this.options.values.length;
		}

		this._super( key, value );

		switch ( key ) {
			case "orientation":
				this._detectOrientation();
				this._removeClass( "ui-slider-horizontal ui-slider-vertical" )
					._addClass( "ui-slider-" + this.orientation );
				this._refreshValue();
				if ( this.options.range ) {
					this._refreshRange( value );
				}

				// Reset positioning from previous orientation
				this.handles.css( value === "horizontal" ? "bottom" : "left", "" );
				break;
			case "value":
				this._animateOff = true;
				this._refreshValue();
				this._change( null, 0 );
				this._animateOff = false;
				break;
			case "values":
				this._animateOff = true;
				this._refreshValue();

				// Start from the last handle to prevent unreachable handles (#9046)
				for ( i = valsLength - 1; i >= 0; i-- ) {
					this._change( null, i );
				}
				this._animateOff = false;
				break;
			case "step":
			case "min":
			case "max":
				this._animateOff = true;
				this._calculateNewMax();
				this._refreshValue();
				this._animateOff = false;
				break;
			case "range":
				this._animateOff = true;
				this._refresh();
				this._animateOff = false;
				break;
		}
	},

	_setOptionDisabled: function( value ) {
		this._super( value );

		this._toggleClass( null, "ui-state-disabled", !!value );
	},

	//internal value getter
	// _value() returns value trimmed by min and max, aligned by step
	_value: function() {
		var val = this.options.value;
		val = this._trimAlignValue( val );

		return val;
	},

	//internal values getter
	// _values() returns array of values trimmed by min and max, aligned by step
	// _values( index ) returns single value trimmed by min and max, aligned by step
	_values: function( index ) {
		var val,
			vals,
			i;

		if ( arguments.length ) {
			val = this.options.values[ index ];
			val = this._trimAlignValue( val );

			return val;
		} else if ( this._hasMultipleValues() ) {

			// .slice() creates a copy of the array
			// this copy gets trimmed by min and max and then returned
			vals = this.options.values.slice();
			for ( i = 0; i < vals.length; i += 1 ) {
				vals[ i ] = this._trimAlignValue( vals[ i ] );
			}

			return vals;
		} else {
			return [];
		}
	},

	// Returns the step-aligned value that val is closest to, between (inclusive) min and max
	_trimAlignValue: function( val ) {
		if ( val <= this._valueMin() ) {
			return this._valueMin();
		}
		if ( val >= this._valueMax() ) {
			return this._valueMax();
		}
		var step = ( this.options.step > 0 ) ? this.options.step : 1,
			valModStep = ( val - this._valueMin() ) % step,
			alignValue = val - valModStep;

		if ( Math.abs( valModStep ) * 2 >= step ) {
			alignValue += ( valModStep > 0 ) ? step : ( -step );
		}

		// Since JavaScript has problems with large floats, round
		// the final value to 5 digits after the decimal point (see #4124)
		return parseFloat( alignValue.toFixed( 5 ) );
	},

	_calculateNewMax: function() {
		var max = this.options.max,
			min = this._valueMin(),
			step = this.options.step,
			aboveMin = Math.round( ( max - min ) / step ) * step;
		max = aboveMin + min;
		if ( max > this.options.max ) {

			//If max is not divisible by step, rounding off may increase its value
			max -= step;
		}
		this.max = parseFloat( max.toFixed( this._precision() ) );
	},

	_precision: function() {
		var precision = this._precisionOf( this.options.step );
		if ( this.options.min !== null ) {
			precision = Math.max( precision, this._precisionOf( this.options.min ) );
		}
		return precision;
	},

	_precisionOf: function( num ) {
		var str = num.toString(),
			decimal = str.indexOf( "." );
		return decimal === -1 ? 0 : str.length - decimal - 1;
	},

	_valueMin: function() {
		return this.options.min;
	},

	_valueMax: function() {
		return this.max;
	},

	_refreshRange: function( orientation ) {
		if ( orientation === "vertical" ) {
			this.range.css( { "width": "", "left": "" } );
		}
		if ( orientation === "horizontal" ) {
			this.range.css( { "height": "", "bottom": "" } );
		}
	},

	_refreshValue: function() {
		var lastValPercent, valPercent, value, valueMin, valueMax,
			oRange = this.options.range,
			o = this.options,
			that = this,
			animate = ( !this._animateOff ) ? o.animate : false,
			_set = {};

		if ( this._hasMultipleValues() ) {
			this.handles.each( function( i ) {
				valPercent = ( that.values( i ) - that._valueMin() ) / ( that._valueMax() -
					that._valueMin() ) * 100;
				_set[ that.orientation === "horizontal" ? "left" : "bottom" ] = valPercent + "%";
				$( this ).stop( 1, 1 )[ animate ? "animate" : "css" ]( _set, o.animate );
				if ( that.options.range === true ) {
					if ( that.orientation === "horizontal" ) {
						if ( i === 0 ) {
							that.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
								left: valPercent + "%"
							}, o.animate );
						}
						if ( i === 1 ) {
							that.range[ animate ? "animate" : "css" ]( {
								width: ( valPercent - lastValPercent ) + "%"
							}, {
								queue: false,
								duration: o.animate
							} );
						}
					} else {
						if ( i === 0 ) {
							that.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
								bottom: ( valPercent ) + "%"
							}, o.animate );
						}
						if ( i === 1 ) {
							that.range[ animate ? "animate" : "css" ]( {
								height: ( valPercent - lastValPercent ) + "%"
							}, {
								queue: false,
								duration: o.animate
							} );
						}
					}
				}
				lastValPercent = valPercent;
			} );
		} else {
			value = this.value();
			valueMin = this._valueMin();
			valueMax = this._valueMax();
			valPercent = ( valueMax !== valueMin ) ?
					( value - valueMin ) / ( valueMax - valueMin ) * 100 :
					0;
			_set[ this.orientation === "horizontal" ? "left" : "bottom" ] = valPercent + "%";
			this.handle.stop( 1, 1 )[ animate ? "animate" : "css" ]( _set, o.animate );

			if ( oRange === "min" && this.orientation === "horizontal" ) {
				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
					width: valPercent + "%"
				}, o.animate );
			}
			if ( oRange === "max" && this.orientation === "horizontal" ) {
				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
					width: ( 100 - valPercent ) + "%"
				}, o.animate );
			}
			if ( oRange === "min" && this.orientation === "vertical" ) {
				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
					height: valPercent + "%"
				}, o.animate );
			}
			if ( oRange === "max" && this.orientation === "vertical" ) {
				this.range.stop( 1, 1 )[ animate ? "animate" : "css" ]( {
					height: ( 100 - valPercent ) + "%"
				}, o.animate );
			}
		}
	},

	_handleEvents: {
		keydown: function( event ) {
			var allowed, curVal, newVal, step,
				index = $( event.target ).data( "ui-slider-handle-index" );

			switch ( event.keyCode ) {
				case $.ui.keyCode.HOME:
				case $.ui.keyCode.END:
				case $.ui.keyCode.PAGE_UP:
				case $.ui.keyCode.PAGE_DOWN:
				case $.ui.keyCode.UP:
				case $.ui.keyCode.RIGHT:
				case $.ui.keyCode.DOWN:
				case $.ui.keyCode.LEFT:
					event.preventDefault();
					if ( !this._keySliding ) {
						this._keySliding = true;
						this._addClass( $( event.target ), null, "ui-state-active" );
						allowed = this._start( event, index );
						if ( allowed === false ) {
							return;
						}
					}
					break;
			}

			step = this.options.step;
			if ( this._hasMultipleValues() ) {
				curVal = newVal = this.values( index );
			} else {
				curVal = newVal = this.value();
			}

			switch ( event.keyCode ) {
				case $.ui.keyCode.HOME:
					newVal = this._valueMin();
					break;
				case $.ui.keyCode.END:
					newVal = this._valueMax();
					break;
				case $.ui.keyCode.PAGE_UP:
					newVal = this._trimAlignValue(
						curVal + ( ( this._valueMax() - this._valueMin() ) / this.numPages )
					);
					break;
				case $.ui.keyCode.PAGE_DOWN:
					newVal = this._trimAlignValue(
						curVal - ( ( this._valueMax() - this._valueMin() ) / this.numPages ) );
					break;
				case $.ui.keyCode.UP:
				case $.ui.keyCode.RIGHT:
					if ( curVal === this._valueMax() ) {
						return;
					}
					newVal = this._trimAlignValue( curVal + step );
					break;
				case $.ui.keyCode.DOWN:
				case $.ui.keyCode.LEFT:
					if ( curVal === this._valueMin() ) {
						return;
					}
					newVal = this._trimAlignValue( curVal - step );
					break;
			}

			this._slide( event, index, newVal );
		},
		keyup: function( event ) {
			var index = $( event.target ).data( "ui-slider-handle-index" );

			if ( this._keySliding ) {
				this._keySliding = false;
				this._stop( event, index );
				this._change( event, index );
				this._removeClass( $( event.target ), null, "ui-state-active" );
			}
		}
	}
} );




//>>label: Sortable
//>>group: Interactions
//>>description: Enables items in a list to be sorted using the mouse.
//>>css.structure: ../../themes/base/sortable.css



var widgetsSortable = $.widget( "ui.sortable", $.ui.mouse, {
	version: "1.12.1",
	widgetEventPrefix: "sort",
	ready: false,
	options: {
		appendTo: "parent",
		axis: false,
		connectWith: false,
		containment: false,
		cursor: "auto",
		cursorAt: false,
		dropOnEmpty: true,
		forcePlaceholderSize: false,
		forceHelperSize: false,
		grid: false,
		handle: false,
		helper: "original",
		items: "> *",
		opacity: false,
		placeholder: false,
		revert: false,
		scroll: true,
		scrollSensitivity: 20,
		scrollSpeed: 20,
		scope: "default",
		tolerance: "intersect",
		zIndex: 1000,

		// Callbacks
		activate: null,
		beforeStop: null,
		change: null,
		deactivate: null,
		out: null,
		over: null,
		receive: null,
		remove: null,
		sort: null,
		start: null,
		stop: null,
		update: null
	},

	_isOverAxis: function( x, reference, size ) {
		return ( x >= reference ) && ( x < ( reference + size ) );
	},

	_isFloating: function( item ) {
		return ( /left|right/ ).test( item.css( "float" ) ) ||
			( /inline|table-cell/ ).test( item.css( "display" ) );
	},

	_create: function() {
		this.containerCache = {};
		this._addClass( "ui-sortable" );

		//Get the items
		this.refresh();

		//Let's determine the parent's offset
		this.offset = this.element.offset();

		//Initialize mouse events for interaction
		this._mouseInit();

		this._setHandleClassName();

		//We're ready to go
		this.ready = true;

	},

	_setOption: function( key, value ) {
		this._super( key, value );

		if ( key === "handle" ) {
			this._setHandleClassName();
		}
	},

	_setHandleClassName: function() {
		var that = this;
		this._removeClass( this.element.find( ".ui-sortable-handle" ), "ui-sortable-handle" );
		$.each( this.items, function() {
			that._addClass(
				this.instance.options.handle ?
					this.item.find( this.instance.options.handle ) :
					this.item,
				"ui-sortable-handle"
			);
		} );
	},

	_destroy: function() {
		this._mouseDestroy();

		for ( var i = this.items.length - 1; i >= 0; i-- ) {
			this.items[ i ].item.removeData( this.widgetName + "-item" );
		}

		return this;
	},

	_mouseCapture: function( event, overrideHandle ) {
		var currentItem = null,
			validHandle = false,
			that = this;

		if ( this.reverting ) {
			return false;
		}

		if ( this.options.disabled || this.options.type === "static" ) {
			return false;
		}

		//We have to refresh the items data once first
		this._refreshItems( event );

		//Find out if the clicked node (or one of its parents) is a actual item in this.items
		$( event.target ).parents().each( function() {
			if ( $.data( this, that.widgetName + "-item" ) === that ) {
				currentItem = $( this );
				return false;
			}
		} );
		if ( $.data( event.target, that.widgetName + "-item" ) === that ) {
			currentItem = $( event.target );
		}

		if ( !currentItem ) {
			return false;
		}
		if ( this.options.handle && !overrideHandle ) {
			$( this.options.handle, currentItem ).find( "*" ).addBack().each( function() {
				if ( this === event.target ) {
					validHandle = true;
				}
			} );
			if ( !validHandle ) {
				return false;
			}
		}

		this.currentItem = currentItem;
		this._removeCurrentsFromItems();
		return true;

	},

	_mouseStart: function( event, overrideHandle, noActivation ) {

		var i, body,
			o = this.options;

		this.currentContainer = this;

		//We only need to call refreshPositions, because the refreshItems call has been moved to
		// mouseCapture
		this.refreshPositions();

		//Create and append the visible helper
		this.helper = this._createHelper( event );

		//Cache the helper size
		this._cacheHelperProportions();

		/*
		 * - Position generation -
		 * This block generates everything position related - it's the core of draggables.
		 */

		//Cache the margins of the original element
		this._cacheMargins();

		//Get the next scrolling parent
		this.scrollParent = this.helper.scrollParent();

		//The element's absolute position on the page minus margins
		this.offset = this.currentItem.offset();
		this.offset = {
			top: this.offset.top - this.margins.top,
			left: this.offset.left - this.margins.left
		};

		$.extend( this.offset, {
			click: { //Where the click happened, relative to the element
				left: event.pageX - this.offset.left,
				top: event.pageY - this.offset.top
			},
			parent: this._getParentOffset(),

			// This is a relative to absolute position minus the actual position calculation -
			// only used for relative positioned helper
			relative: this._getRelativeOffset()
		} );

		// Only after we got the offset, we can change the helper's position to absolute
		// TODO: Still need to figure out a way to make relative sorting possible
		this.helper.css( "position", "absolute" );
		this.cssPosition = this.helper.css( "position" );

		//Generate the original position
		this.originalPosition = this._generatePosition( event );
		this.originalPageX = event.pageX;
		this.originalPageY = event.pageY;

		//Adjust the mouse offset relative to the helper if "cursorAt" is supplied
		( o.cursorAt && this._adjustOffsetFromHelper( o.cursorAt ) );

		//Cache the former DOM position
		this.domPosition = {
			prev: this.currentItem.prev()[ 0 ],
			parent: this.currentItem.parent()[ 0 ]
		};

		// If the helper is not the original, hide the original so it's not playing any role during
		// the drag, won't cause anything bad this way
		if ( this.helper[ 0 ] !== this.currentItem[ 0 ] ) {
			this.currentItem.hide();
		}

		//Create the placeholder
		this._createPlaceholder();

		//Set a containment if given in the options
		if ( o.containment ) {
			this._setContainment();
		}

		if ( o.cursor && o.cursor !== "auto" ) { // cursor option
			body = this.document.find( "body" );

			// Support: IE
			this.storedCursor = body.css( "cursor" );
			body.css( "cursor", o.cursor );

			this.storedStylesheet =
				$( "<style>*{ cursor: " + o.cursor + " !important; }</style>" ).appendTo( body );
		}

		if ( o.opacity ) { // opacity option
			if ( this.helper.css( "opacity" ) ) {
				this._storedOpacity = this.helper.css( "opacity" );
			}
			this.helper.css( "opacity", o.opacity );
		}

		if ( o.zIndex ) { // zIndex option
			if ( this.helper.css( "zIndex" ) ) {
				this._storedZIndex = this.helper.css( "zIndex" );
			}
			this.helper.css( "zIndex", o.zIndex );
		}

		//Prepare scrolling
		if ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
				this.scrollParent[ 0 ].tagName !== "HTML" ) {
			this.overflowOffset = this.scrollParent.offset();
		}

		//Call callbacks
		this._trigger( "start", event, this._uiHash() );

		//Recache the helper size
		if ( !this._preserveHelperProportions ) {
			this._cacheHelperProportions();
		}

		//Post "activate" events to possible containers
		if ( !noActivation ) {
			for ( i = this.containers.length - 1; i >= 0; i-- ) {
				this.containers[ i ]._trigger( "activate", event, this._uiHash( this ) );
			}
		}

		//Prepare possible droppables
		if ( $.ui.ddmanager ) {
			$.ui.ddmanager.current = this;
		}

		if ( $.ui.ddmanager && !o.dropBehaviour ) {
			$.ui.ddmanager.prepareOffsets( this, event );
		}

		this.dragging = true;

		this._addClass( this.helper, "ui-sortable-helper" );

		// Execute the drag once - this causes the helper not to be visiblebefore getting its
		// correct position
		this._mouseDrag( event );
		return true;

	},

	_mouseDrag: function( event ) {
		var i, item, itemElement, intersection,
			o = this.options,
			scrolled = false;

		//Compute the helpers position
		this.position = this._generatePosition( event );
		this.positionAbs = this._convertPositionTo( "absolute" );

		if ( !this.lastPositionAbs ) {
			this.lastPositionAbs = this.positionAbs;
		}

		//Do scrolling
		if ( this.options.scroll ) {
			if ( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
					this.scrollParent[ 0 ].tagName !== "HTML" ) {

				if ( ( this.overflowOffset.top + this.scrollParent[ 0 ].offsetHeight ) -
						event.pageY < o.scrollSensitivity ) {
					this.scrollParent[ 0 ].scrollTop =
						scrolled = this.scrollParent[ 0 ].scrollTop + o.scrollSpeed;
				} else if ( event.pageY - this.overflowOffset.top < o.scrollSensitivity ) {
					this.scrollParent[ 0 ].scrollTop =
						scrolled = this.scrollParent[ 0 ].scrollTop - o.scrollSpeed;
				}

				if ( ( this.overflowOffset.left + this.scrollParent[ 0 ].offsetWidth ) -
						event.pageX < o.scrollSensitivity ) {
					this.scrollParent[ 0 ].scrollLeft = scrolled =
						this.scrollParent[ 0 ].scrollLeft + o.scrollSpeed;
				} else if ( event.pageX - this.overflowOffset.left < o.scrollSensitivity ) {
					this.scrollParent[ 0 ].scrollLeft = scrolled =
						this.scrollParent[ 0 ].scrollLeft - o.scrollSpeed;
				}

			} else {

				if ( event.pageY - this.document.scrollTop() < o.scrollSensitivity ) {
					scrolled = this.document.scrollTop( this.document.scrollTop() - o.scrollSpeed );
				} else if ( this.window.height() - ( event.pageY - this.document.scrollTop() ) <
						o.scrollSensitivity ) {
					scrolled = this.document.scrollTop( this.document.scrollTop() + o.scrollSpeed );
				}

				if ( event.pageX - this.document.scrollLeft() < o.scrollSensitivity ) {
					scrolled = this.document.scrollLeft(
						this.document.scrollLeft() - o.scrollSpeed
					);
				} else if ( this.window.width() - ( event.pageX - this.document.scrollLeft() ) <
						o.scrollSensitivity ) {
					scrolled = this.document.scrollLeft(
						this.document.scrollLeft() + o.scrollSpeed
					);
				}

			}

			if ( scrolled !== false && $.ui.ddmanager && !o.dropBehaviour ) {
				$.ui.ddmanager.prepareOffsets( this, event );
			}
		}

		//Regenerate the absolute position used for position checks
		this.positionAbs = this._convertPositionTo( "absolute" );

		//Set the helper position
		if ( !this.options.axis || this.options.axis !== "y" ) {
			this.helper[ 0 ].style.left = this.position.left + "px";
		}
		if ( !this.options.axis || this.options.axis !== "x" ) {
			this.helper[ 0 ].style.top = this.position.top + "px";
		}

		//Rearrange
		for ( i = this.items.length - 1; i >= 0; i-- ) {

			//Cache variables and intersection, continue if no intersection
			item = this.items[ i ];
			itemElement = item.item[ 0 ];
			intersection = this._intersectsWithPointer( item );
			if ( !intersection ) {
				continue;
			}

			// Only put the placeholder inside the current Container, skip all
			// items from other containers. This works because when moving
			// an item from one container to another the
			// currentContainer is switched before the placeholder is moved.
			//
			// Without this, moving items in "sub-sortables" can cause
			// the placeholder to jitter between the outer and inner container.
			if ( item.instance !== this.currentContainer ) {
				continue;
			}

			// Cannot intersect with itself
			// no useless actions that have been done before
			// no action if the item moved is the parent of the item checked
			if ( itemElement !== this.currentItem[ 0 ] &&
				this.placeholder[ intersection === 1 ? "next" : "prev" ]()[ 0 ] !== itemElement &&
				!$.contains( this.placeholder[ 0 ], itemElement ) &&
				( this.options.type === "semi-dynamic" ?
					!$.contains( this.element[ 0 ], itemElement ) :
					true
				)
			) {

				this.direction = intersection === 1 ? "down" : "up";

				if ( this.options.tolerance === "pointer" || this._intersectsWithSides( item ) ) {
					this._rearrange( event, item );
				} else {
					break;
				}

				this._trigger( "change", event, this._uiHash() );
				break;
			}
		}

		//Post events to containers
		this._contactContainers( event );

		//Interconnect with droppables
		if ( $.ui.ddmanager ) {
			$.ui.ddmanager.drag( this, event );
		}

		//Call callbacks
		this._trigger( "sort", event, this._uiHash() );

		this.lastPositionAbs = this.positionAbs;
		return false;

	},

	_mouseStop: function( event, noPropagation ) {

		if ( !event ) {
			return;
		}

		//If we are using droppables, inform the manager about the drop
		if ( $.ui.ddmanager && !this.options.dropBehaviour ) {
			$.ui.ddmanager.drop( this, event );
		}

		if ( this.options.revert ) {
			var that = this,
				cur = this.placeholder.offset(),
				axis = this.options.axis,
				animation = {};

			if ( !axis || axis === "x" ) {
				animation.left = cur.left - this.offset.parent.left - this.margins.left +
					( this.offsetParent[ 0 ] === this.document[ 0 ].body ?
						0 :
						this.offsetParent[ 0 ].scrollLeft
					);
			}
			if ( !axis || axis === "y" ) {
				animation.top = cur.top - this.offset.parent.top - this.margins.top +
					( this.offsetParent[ 0 ] === this.document[ 0 ].body ?
						0 :
						this.offsetParent[ 0 ].scrollTop
					);
			}
			this.reverting = true;
			$( this.helper ).animate(
				animation,
				parseInt( this.options.revert, 10 ) || 500,
				function() {
					that._clear( event );
				}
			);
		} else {
			this._clear( event, noPropagation );
		}

		return false;

	},

	cancel: function() {

		if ( this.dragging ) {

			this._mouseUp( new $.Event( "mouseup", { target: null } ) );

			if ( this.options.helper === "original" ) {
				this.currentItem.css( this._storedCSS );
				this._removeClass( this.currentItem, "ui-sortable-helper" );
			} else {
				this.currentItem.show();
			}

			//Post deactivating events to containers
			for ( var i = this.containers.length - 1; i >= 0; i-- ) {
				this.containers[ i ]._trigger( "deactivate", null, this._uiHash( this ) );
				if ( this.containers[ i ].containerCache.over ) {
					this.containers[ i ]._trigger( "out", null, this._uiHash( this ) );
					this.containers[ i ].containerCache.over = 0;
				}
			}

		}

		if ( this.placeholder ) {

			//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
			// it unbinds ALL events from the original node!
			if ( this.placeholder[ 0 ].parentNode ) {
				this.placeholder[ 0 ].parentNode.removeChild( this.placeholder[ 0 ] );
			}
			if ( this.options.helper !== "original" && this.helper &&
					this.helper[ 0 ].parentNode ) {
				this.helper.remove();
			}

			$.extend( this, {
				helper: null,
				dragging: false,
				reverting: false,
				_noFinalSort: null
			} );

			if ( this.domPosition.prev ) {
				$( this.domPosition.prev ).after( this.currentItem );
			} else {
				$( this.domPosition.parent ).prepend( this.currentItem );
			}
		}

		return this;

	},

	serialize: function( o ) {

		var items = this._getItemsAsjQuery( o && o.connected ),
			str = [];
		o = o || {};

		$( items ).each( function() {
			var res = ( $( o.item || this ).attr( o.attribute || "id" ) || "" )
				.match( o.expression || ( /(.+)[\-=_](.+)/ ) );
			if ( res ) {
				str.push(
					( o.key || res[ 1 ] + "[]" ) +
					"=" + ( o.key && o.expression ? res[ 1 ] : res[ 2 ] ) );
			}
		} );

		if ( !str.length && o.key ) {
			str.push( o.key + "=" );
		}

		return str.join( "&" );

	},

	toArray: function( o ) {

		var items = this._getItemsAsjQuery( o && o.connected ),
			ret = [];

		o = o || {};

		items.each( function() {
			ret.push( $( o.item || this ).attr( o.attribute || "id" ) || "" );
		} );
		return ret;

	},

	/* Be careful with the following core functions */
	_intersectsWith: function( item ) {

		var x1 = this.positionAbs.left,
			x2 = x1 + this.helperProportions.width,
			y1 = this.positionAbs.top,
			y2 = y1 + this.helperProportions.height,
			l = item.left,
			r = l + item.width,
			t = item.top,
			b = t + item.height,
			dyClick = this.offset.click.top,
			dxClick = this.offset.click.left,
			isOverElementHeight = ( this.options.axis === "x" ) || ( ( y1 + dyClick ) > t &&
				( y1 + dyClick ) < b ),
			isOverElementWidth = ( this.options.axis === "y" ) || ( ( x1 + dxClick ) > l &&
				( x1 + dxClick ) < r ),
			isOverElement = isOverElementHeight && isOverElementWidth;

		if ( this.options.tolerance === "pointer" ||
			this.options.forcePointerForContainers ||
			( this.options.tolerance !== "pointer" &&
				this.helperProportions[ this.floating ? "width" : "height" ] >
				item[ this.floating ? "width" : "height" ] )
		) {
			return isOverElement;
		} else {

			return ( l < x1 + ( this.helperProportions.width / 2 ) && // Right Half
				x2 - ( this.helperProportions.width / 2 ) < r && // Left Half
				t < y1 + ( this.helperProportions.height / 2 ) && // Bottom Half
				y2 - ( this.helperProportions.height / 2 ) < b ); // Top Half

		}
	},

	_intersectsWithPointer: function( item ) {
		var verticalDirection, horizontalDirection,
			isOverElementHeight = ( this.options.axis === "x" ) ||
				this._isOverAxis(
					this.positionAbs.top + this.offset.click.top, item.top, item.height ),
			isOverElementWidth = ( this.options.axis === "y" ) ||
				this._isOverAxis(
					this.positionAbs.left + this.offset.click.left, item.left, item.width ),
			isOverElement = isOverElementHeight && isOverElementWidth;

		if ( !isOverElement ) {
			return false;
		}

		verticalDirection = this._getDragVerticalDirection();
		horizontalDirection = this._getDragHorizontalDirection();

		return this.floating ?
			( ( horizontalDirection === "right" || verticalDirection === "down" ) ? 2 : 1 )
			: ( verticalDirection && ( verticalDirection === "down" ? 2 : 1 ) );

	},

	_intersectsWithSides: function( item ) {

		var isOverBottomHalf = this._isOverAxis( this.positionAbs.top +
				this.offset.click.top, item.top + ( item.height / 2 ), item.height ),
			isOverRightHalf = this._isOverAxis( this.positionAbs.left +
				this.offset.click.left, item.left + ( item.width / 2 ), item.width ),
			verticalDirection = this._getDragVerticalDirection(),
			horizontalDirection = this._getDragHorizontalDirection();

		if ( this.floating && horizontalDirection ) {
			return ( ( horizontalDirection === "right" && isOverRightHalf ) ||
				( horizontalDirection === "left" && !isOverRightHalf ) );
		} else {
			return verticalDirection && ( ( verticalDirection === "down" && isOverBottomHalf ) ||
				( verticalDirection === "up" && !isOverBottomHalf ) );
		}

	},

	_getDragVerticalDirection: function() {
		var delta = this.positionAbs.top - this.lastPositionAbs.top;
		return delta !== 0 && ( delta > 0 ? "down" : "up" );
	},

	_getDragHorizontalDirection: function() {
		var delta = this.positionAbs.left - this.lastPositionAbs.left;
		return delta !== 0 && ( delta > 0 ? "right" : "left" );
	},

	refresh: function( event ) {
		this._refreshItems( event );
		this._setHandleClassName();
		this.refreshPositions();
		return this;
	},

	_connectWith: function() {
		var options = this.options;
		return options.connectWith.constructor === String ?
			[ options.connectWith ] :
			options.connectWith;
	},

	_getItemsAsjQuery: function( connected ) {

		var i, j, cur, inst,
			items = [],
			queries = [],
			connectWith = this._connectWith();

		if ( connectWith && connected ) {
			for ( i = connectWith.length - 1; i >= 0; i-- ) {
				cur = $( connectWith[ i ], this.document[ 0 ] );
				for ( j = cur.length - 1; j >= 0; j-- ) {
					inst = $.data( cur[ j ], this.widgetFullName );
					if ( inst && inst !== this && !inst.options.disabled ) {
						queries.push( [ $.isFunction( inst.options.items ) ?
							inst.options.items.call( inst.element ) :
							$( inst.options.items, inst.element )
								.not( ".ui-sortable-helper" )
								.not( ".ui-sortable-placeholder" ), inst ] );
					}
				}
			}
		}

		queries.push( [ $.isFunction( this.options.items ) ?
			this.options.items
				.call( this.element, null, { options: this.options, item: this.currentItem } ) :
			$( this.options.items, this.element )
				.not( ".ui-sortable-helper" )
				.not( ".ui-sortable-placeholder" ), this ] );

		function addItems() {
			items.push( this );
		}
		for ( i = queries.length - 1; i >= 0; i-- ) {
			queries[ i ][ 0 ].each( addItems );
		}

		return $( items );

	},

	_removeCurrentsFromItems: function() {

		var list = this.currentItem.find( ":data(" + this.widgetName + "-item)" );

		this.items = $.grep( this.items, function( item ) {
			for ( var j = 0; j < list.length; j++ ) {
				if ( list[ j ] === item.item[ 0 ] ) {
					return false;
				}
			}
			return true;
		} );

	},

	_refreshItems: function( event ) {

		this.items = [];
		this.containers = [ this ];

		var i, j, cur, inst, targetData, _queries, item, queriesLength,
			items = this.items,
			queries = [ [ $.isFunction( this.options.items ) ?
				this.options.items.call( this.element[ 0 ], event, { item: this.currentItem } ) :
				$( this.options.items, this.element ), this ] ],
			connectWith = this._connectWith();

		//Shouldn't be run the first time through due to massive slow-down
		if ( connectWith && this.ready ) {
			for ( i = connectWith.length - 1; i >= 0; i-- ) {
				cur = $( connectWith[ i ], this.document[ 0 ] );
				for ( j = cur.length - 1; j >= 0; j-- ) {
					inst = $.data( cur[ j ], this.widgetFullName );
					if ( inst && inst !== this && !inst.options.disabled ) {
						queries.push( [ $.isFunction( inst.options.items ) ?
							inst.options.items
								.call( inst.element[ 0 ], event, { item: this.currentItem } ) :
							$( inst.options.items, inst.element ), inst ] );
						this.containers.push( inst );
					}
				}
			}
		}

		for ( i = queries.length - 1; i >= 0; i-- ) {
			targetData = queries[ i ][ 1 ];
			_queries = queries[ i ][ 0 ];

			for ( j = 0, queriesLength = _queries.length; j < queriesLength; j++ ) {
				item = $( _queries[ j ] );

				// Data for target checking (mouse manager)
				item.data( this.widgetName + "-item", targetData );

				items.push( {
					item: item,
					instance: targetData,
					width: 0, height: 0,
					left: 0, top: 0
				} );
			}
		}

	},

	refreshPositions: function( fast ) {

		// Determine whether items are being displayed horizontally
		this.floating = this.items.length ?
			this.options.axis === "x" || this._isFloating( this.items[ 0 ].item ) :
			false;

		//This has to be redone because due to the item being moved out/into the offsetParent,
		// the offsetParent's position will change
		if ( this.offsetParent && this.helper ) {
			this.offset.parent = this._getParentOffset();
		}

		var i, item, t, p;

		for ( i = this.items.length - 1; i >= 0; i-- ) {
			item = this.items[ i ];

			//We ignore calculating positions of all connected containers when we're not over them
			if ( item.instance !== this.currentContainer && this.currentContainer &&
					item.item[ 0 ] !== this.currentItem[ 0 ] ) {
				continue;
			}

			t = this.options.toleranceElement ?
				$( this.options.toleranceElement, item.item ) :
				item.item;

			if ( !fast ) {
				item.width = t.outerWidth();
				item.height = t.outerHeight();
			}

			p = t.offset();
			item.left = p.left;
			item.top = p.top;
		}

		if ( this.options.custom && this.options.custom.refreshContainers ) {
			this.options.custom.refreshContainers.call( this );
		} else {
			for ( i = this.containers.length - 1; i >= 0; i-- ) {
				p = this.containers[ i ].element.offset();
				this.containers[ i ].containerCache.left = p.left;
				this.containers[ i ].containerCache.top = p.top;
				this.containers[ i ].containerCache.width =
					this.containers[ i ].element.outerWidth();
				this.containers[ i ].containerCache.height =
					this.containers[ i ].element.outerHeight();
			}
		}

		return this;
	},

	_createPlaceholder: function( that ) {
		that = that || this;
		var className,
			o = that.options;

		if ( !o.placeholder || o.placeholder.constructor === String ) {
			className = o.placeholder;
			o.placeholder = {
				element: function() {

					var nodeName = that.currentItem[ 0 ].nodeName.toLowerCase(),
						element = $( "<" + nodeName + ">", that.document[ 0 ] );

						that._addClass( element, "ui-sortable-placeholder",
								className || that.currentItem[ 0 ].className )
							._removeClass( element, "ui-sortable-helper" );

					if ( nodeName === "tbody" ) {
						that._createTrPlaceholder(
							that.currentItem.find( "tr" ).eq( 0 ),
							$( "<tr>", that.document[ 0 ] ).appendTo( element )
						);
					} else if ( nodeName === "tr" ) {
						that._createTrPlaceholder( that.currentItem, element );
					} else if ( nodeName === "img" ) {
						element.attr( "src", that.currentItem.attr( "src" ) );
					}

					if ( !className ) {
						element.css( "visibility", "hidden" );
					}

					return element;
				},
				update: function( container, p ) {

					// 1. If a className is set as 'placeholder option, we don't force sizes -
					// the class is responsible for that
					// 2. The option 'forcePlaceholderSize can be enabled to force it even if a
					// class name is specified
					if ( className && !o.forcePlaceholderSize ) {
						return;
					}

					//If the element doesn't have a actual height by itself (without styles coming
					// from a stylesheet), it receives the inline height from the dragged item
					if ( !p.height() ) {
						p.height(
							that.currentItem.innerHeight() -
							parseInt( that.currentItem.css( "paddingTop" ) || 0, 10 ) -
							parseInt( that.currentItem.css( "paddingBottom" ) || 0, 10 ) );
					}
					if ( !p.width() ) {
						p.width(
							that.currentItem.innerWidth() -
							parseInt( that.currentItem.css( "paddingLeft" ) || 0, 10 ) -
							parseInt( that.currentItem.css( "paddingRight" ) || 0, 10 ) );
					}
				}
			};
		}

		//Create the placeholder
		that.placeholder = $( o.placeholder.element.call( that.element, that.currentItem ) );

		//Append it after the actual current item
		that.currentItem.after( that.placeholder );

		//Update the size of the placeholder (TODO: Logic to fuzzy, see line 316/317)
		o.placeholder.update( that, that.placeholder );

	},

	_createTrPlaceholder: function( sourceTr, targetTr ) {
		var that = this;

		sourceTr.children().each( function() {
			$( "<td>&#160;</td>", that.document[ 0 ] )
				.attr( "colspan", $( this ).attr( "colspan" ) || 1 )
				.appendTo( targetTr );
		} );
	},

	_contactContainers: function( event ) {
		var i, j, dist, itemWithLeastDistance, posProperty, sizeProperty, cur, nearBottom,
			floating, axis,
			innermostContainer = null,
			innermostIndex = null;

		// Get innermost container that intersects with item
		for ( i = this.containers.length - 1; i >= 0; i-- ) {

			// Never consider a container that's located within the item itself
			if ( $.contains( this.currentItem[ 0 ], this.containers[ i ].element[ 0 ] ) ) {
				continue;
			}

			if ( this._intersectsWith( this.containers[ i ].containerCache ) ) {

				// If we've already found a container and it's more "inner" than this, then continue
				if ( innermostContainer &&
						$.contains(
							this.containers[ i ].element[ 0 ],
							innermostContainer.element[ 0 ] ) ) {
					continue;
				}

				innermostContainer = this.containers[ i ];
				innermostIndex = i;

			} else {

				// container doesn't intersect. trigger "out" event if necessary
				if ( this.containers[ i ].containerCache.over ) {
					this.containers[ i ]._trigger( "out", event, this._uiHash( this ) );
					this.containers[ i ].containerCache.over = 0;
				}
			}

		}

		// If no intersecting containers found, return
		if ( !innermostContainer ) {
			return;
		}

		// Move the item into the container if it's not there already
		if ( this.containers.length === 1 ) {
			if ( !this.containers[ innermostIndex ].containerCache.over ) {
				this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash( this ) );
				this.containers[ innermostIndex ].containerCache.over = 1;
			}
		} else {

			// When entering a new container, we will find the item with the least distance and
			// append our item near it
			dist = 10000;
			itemWithLeastDistance = null;
			floating = innermostContainer.floating || this._isFloating( this.currentItem );
			posProperty = floating ? "left" : "top";
			sizeProperty = floating ? "width" : "height";
			axis = floating ? "pageX" : "pageY";

			for ( j = this.items.length - 1; j >= 0; j-- ) {
				if ( !$.contains(
						this.containers[ innermostIndex ].element[ 0 ], this.items[ j ].item[ 0 ] )
				) {
					continue;
				}
				if ( this.items[ j ].item[ 0 ] === this.currentItem[ 0 ] ) {
					continue;
				}

				cur = this.items[ j ].item.offset()[ posProperty ];
				nearBottom = false;
				if ( event[ axis ] - cur > this.items[ j ][ sizeProperty ] / 2 ) {
					nearBottom = true;
				}

				if ( Math.abs( event[ axis ] - cur ) < dist ) {
					dist = Math.abs( event[ axis ] - cur );
					itemWithLeastDistance = this.items[ j ];
					this.direction = nearBottom ? "up" : "down";
				}
			}

			//Check if dropOnEmpty is enabled
			if ( !itemWithLeastDistance && !this.options.dropOnEmpty ) {
				return;
			}

			if ( this.currentContainer === this.containers[ innermostIndex ] ) {
				if ( !this.currentContainer.containerCache.over ) {
					this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash() );
					this.currentContainer.containerCache.over = 1;
				}
				return;
			}

			itemWithLeastDistance ?
				this._rearrange( event, itemWithLeastDistance, null, true ) :
				this._rearrange( event, null, this.containers[ innermostIndex ].element, true );
			this._trigger( "change", event, this._uiHash() );
			this.containers[ innermostIndex ]._trigger( "change", event, this._uiHash( this ) );
			this.currentContainer = this.containers[ innermostIndex ];

			//Update the placeholder
			this.options.placeholder.update( this.currentContainer, this.placeholder );

			this.containers[ innermostIndex ]._trigger( "over", event, this._uiHash( this ) );
			this.containers[ innermostIndex ].containerCache.over = 1;
		}

	},

	_createHelper: function( event ) {

		var o = this.options,
			helper = $.isFunction( o.helper ) ?
				$( o.helper.apply( this.element[ 0 ], [ event, this.currentItem ] ) ) :
				( o.helper === "clone" ? this.currentItem.clone() : this.currentItem );

		//Add the helper to the DOM if that didn't happen already
		if ( !helper.parents( "body" ).length ) {
			$( o.appendTo !== "parent" ?
				o.appendTo :
				this.currentItem[ 0 ].parentNode )[ 0 ].appendChild( helper[ 0 ] );
		}

		if ( helper[ 0 ] === this.currentItem[ 0 ] ) {
			this._storedCSS = {
				width: this.currentItem[ 0 ].style.width,
				height: this.currentItem[ 0 ].style.height,
				position: this.currentItem.css( "position" ),
				top: this.currentItem.css( "top" ),
				left: this.currentItem.css( "left" )
			};
		}

		if ( !helper[ 0 ].style.width || o.forceHelperSize ) {
			helper.width( this.currentItem.width() );
		}
		if ( !helper[ 0 ].style.height || o.forceHelperSize ) {
			helper.height( this.currentItem.height() );
		}

		return helper;

	},

	_adjustOffsetFromHelper: function( obj ) {
		if ( typeof obj === "string" ) {
			obj = obj.split( " " );
		}
		if ( $.isArray( obj ) ) {
			obj = { left: +obj[ 0 ], top: +obj[ 1 ] || 0 };
		}
		if ( "left" in obj ) {
			this.offset.click.left = obj.left + this.margins.left;
		}
		if ( "right" in obj ) {
			this.offset.click.left = this.helperProportions.width - obj.right + this.margins.left;
		}
		if ( "top" in obj ) {
			this.offset.click.top = obj.top + this.margins.top;
		}
		if ( "bottom" in obj ) {
			this.offset.click.top = this.helperProportions.height - obj.bottom + this.margins.top;
		}
	},

	_getParentOffset: function() {

		//Get the offsetParent and cache its position
		this.offsetParent = this.helper.offsetParent();
		var po = this.offsetParent.offset();

		// This is a special case where we need to modify a offset calculated on start, since the
		// following happened:
		// 1. The position of the helper is absolute, so it's position is calculated based on the
		// next positioned parent
		// 2. The actual offset parent is a child of the scroll parent, and the scroll parent isn't
		// the document, which means that the scroll is included in the initial calculation of the
		// offset of the parent, and never recalculated upon drag
		if ( this.cssPosition === "absolute" && this.scrollParent[ 0 ] !== this.document[ 0 ] &&
				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) {
			po.left += this.scrollParent.scrollLeft();
			po.top += this.scrollParent.scrollTop();
		}

		// This needs to be actually done for all browsers, since pageX/pageY includes this
		// information with an ugly IE fix
		if ( this.offsetParent[ 0 ] === this.document[ 0 ].body ||
				( this.offsetParent[ 0 ].tagName &&
				this.offsetParent[ 0 ].tagName.toLowerCase() === "html" && $.ui.ie ) ) {
			po = { top: 0, left: 0 };
		}

		return {
			top: po.top + ( parseInt( this.offsetParent.css( "borderTopWidth" ), 10 ) || 0 ),
			left: po.left + ( parseInt( this.offsetParent.css( "borderLeftWidth" ), 10 ) || 0 )
		};

	},

	_getRelativeOffset: function() {

		if ( this.cssPosition === "relative" ) {
			var p = this.currentItem.position();
			return {
				top: p.top - ( parseInt( this.helper.css( "top" ), 10 ) || 0 ) +
					this.scrollParent.scrollTop(),
				left: p.left - ( parseInt( this.helper.css( "left" ), 10 ) || 0 ) +
					this.scrollParent.scrollLeft()
			};
		} else {
			return { top: 0, left: 0 };
		}

	},

	_cacheMargins: function() {
		this.margins = {
			left: ( parseInt( this.currentItem.css( "marginLeft" ), 10 ) || 0 ),
			top: ( parseInt( this.currentItem.css( "marginTop" ), 10 ) || 0 )
		};
	},

	_cacheHelperProportions: function() {
		this.helperProportions = {
			width: this.helper.outerWidth(),
			height: this.helper.outerHeight()
		};
	},

	_setContainment: function() {

		var ce, co, over,
			o = this.options;
		if ( o.containment === "parent" ) {
			o.containment = this.helper[ 0 ].parentNode;
		}
		if ( o.containment === "document" || o.containment === "window" ) {
			this.containment = [
				0 - this.offset.relative.left - this.offset.parent.left,
				0 - this.offset.relative.top - this.offset.parent.top,
				o.containment === "document" ?
					this.document.width() :
					this.window.width() - this.helperProportions.width - this.margins.left,
				( o.containment === "document" ?
					( this.document.height() || document.body.parentNode.scrollHeight ) :
					this.window.height() || this.document[ 0 ].body.parentNode.scrollHeight
				) - this.helperProportions.height - this.margins.top
			];
		}

		if ( !( /^(document|window|parent)$/ ).test( o.containment ) ) {
			ce = $( o.containment )[ 0 ];
			co = $( o.containment ).offset();
			over = ( $( ce ).css( "overflow" ) !== "hidden" );

			this.containment = [
				co.left + ( parseInt( $( ce ).css( "borderLeftWidth" ), 10 ) || 0 ) +
					( parseInt( $( ce ).css( "paddingLeft" ), 10 ) || 0 ) - this.margins.left,
				co.top + ( parseInt( $( ce ).css( "borderTopWidth" ), 10 ) || 0 ) +
					( parseInt( $( ce ).css( "paddingTop" ), 10 ) || 0 ) - this.margins.top,
				co.left + ( over ? Math.max( ce.scrollWidth, ce.offsetWidth ) : ce.offsetWidth ) -
					( parseInt( $( ce ).css( "borderLeftWidth" ), 10 ) || 0 ) -
					( parseInt( $( ce ).css( "paddingRight" ), 10 ) || 0 ) -
					this.helperProportions.width - this.margins.left,
				co.top + ( over ? Math.max( ce.scrollHeight, ce.offsetHeight ) : ce.offsetHeight ) -
					( parseInt( $( ce ).css( "borderTopWidth" ), 10 ) || 0 ) -
					( parseInt( $( ce ).css( "paddingBottom" ), 10 ) || 0 ) -
					this.helperProportions.height - this.margins.top
			];
		}

	},

	_convertPositionTo: function( d, pos ) {

		if ( !pos ) {
			pos = this.position;
		}
		var mod = d === "absolute" ? 1 : -1,
			scroll = this.cssPosition === "absolute" &&
				!( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) ?
					this.offsetParent :
					this.scrollParent,
			scrollIsRootNode = ( /(html|body)/i ).test( scroll[ 0 ].tagName );

		return {
			top: (

				// The absolute mouse position
				pos.top	+

				// Only for relative positioned nodes: Relative offset from element to offset parent
				this.offset.relative.top * mod +

				// The offsetParent's offset without borders (offset + border)
				this.offset.parent.top * mod -
				( ( this.cssPosition === "fixed" ?
					-this.scrollParent.scrollTop() :
					( scrollIsRootNode ? 0 : scroll.scrollTop() ) ) * mod )
			),
			left: (

				// The absolute mouse position
				pos.left +

				// Only for relative positioned nodes: Relative offset from element to offset parent
				this.offset.relative.left * mod +

				// The offsetParent's offset without borders (offset + border)
				this.offset.parent.left * mod	-
				( ( this.cssPosition === "fixed" ?
					-this.scrollParent.scrollLeft() : scrollIsRootNode ? 0 :
					scroll.scrollLeft() ) * mod )
			)
		};

	},

	_generatePosition: function( event ) {

		var top, left,
			o = this.options,
			pageX = event.pageX,
			pageY = event.pageY,
			scroll = this.cssPosition === "absolute" &&
				!( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
				$.contains( this.scrollParent[ 0 ], this.offsetParent[ 0 ] ) ) ?
					this.offsetParent :
					this.scrollParent,
				scrollIsRootNode = ( /(html|body)/i ).test( scroll[ 0 ].tagName );

		// This is another very weird special case that only happens for relative elements:
		// 1. If the css position is relative
		// 2. and the scroll parent is the document or similar to the offset parent
		// we have to refresh the relative offset during the scroll so there are no jumps
		if ( this.cssPosition === "relative" && !( this.scrollParent[ 0 ] !== this.document[ 0 ] &&
				this.scrollParent[ 0 ] !== this.offsetParent[ 0 ] ) ) {
			this.offset.relative = this._getRelativeOffset();
		}

		/*
		 * - Position constraining -
		 * Constrain the position to a mix of grid, containment.
		 */

		if ( this.originalPosition ) { //If we are not dragging yet, we won't check for options

			if ( this.containment ) {
				if ( event.pageX - this.offset.click.left < this.containment[ 0 ] ) {
					pageX = this.containment[ 0 ] + this.offset.click.left;
				}
				if ( event.pageY - this.offset.click.top < this.containment[ 1 ] ) {
					pageY = this.containment[ 1 ] + this.offset.click.top;
				}
				if ( event.pageX - this.offset.click.left > this.containment[ 2 ] ) {
					pageX = this.containment[ 2 ] + this.offset.click.left;
				}
				if ( event.pageY - this.offset.click.top > this.containment[ 3 ] ) {
					pageY = this.containment[ 3 ] + this.offset.click.top;
				}
			}

			if ( o.grid ) {
				top = this.originalPageY + Math.round( ( pageY - this.originalPageY ) /
					o.grid[ 1 ] ) * o.grid[ 1 ];
				pageY = this.containment ?
					( ( top - this.offset.click.top >= this.containment[ 1 ] &&
						top - this.offset.click.top <= this.containment[ 3 ] ) ?
							top :
							( ( top - this.offset.click.top >= this.containment[ 1 ] ) ?
								top - o.grid[ 1 ] : top + o.grid[ 1 ] ) ) :
								top;

				left = this.originalPageX + Math.round( ( pageX - this.originalPageX ) /
					o.grid[ 0 ] ) * o.grid[ 0 ];
				pageX = this.containment ?
					( ( left - this.offset.click.left >= this.containment[ 0 ] &&
						left - this.offset.click.left <= this.containment[ 2 ] ) ?
							left :
							( ( left - this.offset.click.left >= this.containment[ 0 ] ) ?
								left - o.grid[ 0 ] : left + o.grid[ 0 ] ) ) :
								left;
			}

		}

		return {
			top: (

				// The absolute mouse position
				pageY -

				// Click offset (relative to the element)
				this.offset.click.top -

				// Only for relative positioned nodes: Relative offset from element to offset parent
				this.offset.relative.top -

				// The offsetParent's offset without borders (offset + border)
				this.offset.parent.top +
				( ( this.cssPosition === "fixed" ?
					-this.scrollParent.scrollTop() :
					( scrollIsRootNode ? 0 : scroll.scrollTop() ) ) )
			),
			left: (

				// The absolute mouse position
				pageX -

				// Click offset (relative to the element)
				this.offset.click.left -

				// Only for relative positioned nodes: Relative offset from element to offset parent
				this.offset.relative.left -

				// The offsetParent's offset without borders (offset + border)
				this.offset.parent.left +
				( ( this.cssPosition === "fixed" ?
					-this.scrollParent.scrollLeft() :
					scrollIsRootNode ? 0 : scroll.scrollLeft() ) )
			)
		};

	},

	_rearrange: function( event, i, a, hardRefresh ) {

		a ? a[ 0 ].appendChild( this.placeholder[ 0 ] ) :
			i.item[ 0 ].parentNode.insertBefore( this.placeholder[ 0 ],
				( this.direction === "down" ? i.item[ 0 ] : i.item[ 0 ].nextSibling ) );

		//Various things done here to improve the performance:
		// 1. we create a setTimeout, that calls refreshPositions
		// 2. on the instance, we have a counter variable, that get's higher after every append
		// 3. on the local scope, we copy the counter variable, and check in the timeout,
		// if it's still the same
		// 4. this lets only the last addition to the timeout stack through
		this.counter = this.counter ? ++this.counter : 1;
		var counter = this.counter;

		this._delay( function() {
			if ( counter === this.counter ) {

				//Precompute after each DOM insertion, NOT on mousemove
				this.refreshPositions( !hardRefresh );
			}
		} );

	},

	_clear: function( event, noPropagation ) {

		this.reverting = false;

		// We delay all events that have to be triggered to after the point where the placeholder
		// has been removed and everything else normalized again
		var i,
			delayedTriggers = [];

		// We first have to update the dom position of the actual currentItem
		// Note: don't do it if the current item is already removed (by a user), or it gets
		// reappended (see #4088)
		if ( !this._noFinalSort && this.currentItem.parent().length ) {
			this.placeholder.before( this.currentItem );
		}
		this._noFinalSort = null;

		if ( this.helper[ 0 ] === this.currentItem[ 0 ] ) {
			for ( i in this._storedCSS ) {
				if ( this._storedCSS[ i ] === "auto" || this._storedCSS[ i ] === "static" ) {
					this._storedCSS[ i ] = "";
				}
			}
			this.currentItem.css( this._storedCSS );
			this._removeClass( this.currentItem, "ui-sortable-helper" );
		} else {
			this.currentItem.show();
		}

		if ( this.fromOutside && !noPropagation ) {
			delayedTriggers.push( function( event ) {
				this._trigger( "receive", event, this._uiHash( this.fromOutside ) );
			} );
		}
		if ( ( this.fromOutside ||
				this.domPosition.prev !==
				this.currentItem.prev().not( ".ui-sortable-helper" )[ 0 ] ||
				this.domPosition.parent !== this.currentItem.parent()[ 0 ] ) && !noPropagation ) {

			// Trigger update callback if the DOM position has changed
			delayedTriggers.push( function( event ) {
				this._trigger( "update", event, this._uiHash() );
			} );
		}

		// Check if the items Container has Changed and trigger appropriate
		// events.
		if ( this !== this.currentContainer ) {
			if ( !noPropagation ) {
				delayedTriggers.push( function( event ) {
					this._trigger( "remove", event, this._uiHash() );
				} );
				delayedTriggers.push( ( function( c ) {
					return function( event ) {
						c._trigger( "receive", event, this._uiHash( this ) );
					};
				} ).call( this, this.currentContainer ) );
				delayedTriggers.push( ( function( c ) {
					return function( event ) {
						c._trigger( "update", event, this._uiHash( this ) );
					};
				} ).call( this, this.currentContainer ) );
			}
		}

		//Post events to containers
		function delayEvent( type, instance, container ) {
			return function( event ) {
				container._trigger( type, event, instance._uiHash( instance ) );
			};
		}
		for ( i = this.containers.length - 1; i >= 0; i-- ) {
			if ( !noPropagation ) {
				delayedTriggers.push( delayEvent( "deactivate", this, this.containers[ i ] ) );
			}
			if ( this.containers[ i ].containerCache.over ) {
				delayedTriggers.push( delayEvent( "out", this, this.containers[ i ] ) );
				this.containers[ i ].containerCache.over = 0;
			}
		}

		//Do what was originally in plugins
		if ( this.storedCursor ) {
			this.document.find( "body" ).css( "cursor", this.storedCursor );
			this.storedStylesheet.remove();
		}
		if ( this._storedOpacity ) {
			this.helper.css( "opacity", this._storedOpacity );
		}
		if ( this._storedZIndex ) {
			this.helper.css( "zIndex", this._storedZIndex === "auto" ? "" : this._storedZIndex );
		}

		this.dragging = false;

		if ( !noPropagation ) {
			this._trigger( "beforeStop", event, this._uiHash() );
		}

		//$(this.placeholder[0]).remove(); would have been the jQuery way - unfortunately,
		// it unbinds ALL events from the original node!
		this.placeholder[ 0 ].parentNode.removeChild( this.placeholder[ 0 ] );

		if ( !this.cancelHelperRemoval ) {
			if ( this.helper[ 0 ] !== this.currentItem[ 0 ] ) {
				this.helper.remove();
			}
			this.helper = null;
		}

		if ( !noPropagation ) {
			for ( i = 0; i < delayedTriggers.length; i++ ) {

				// Trigger all delayed events
				delayedTriggers[ i ].call( this, event );
			}
			this._trigger( "stop", event, this._uiHash() );
		}

		this.fromOutside = false;
		return !this.cancelHelperRemoval;

	},

	_trigger: function() {
		if ( $.Widget.prototype._trigger.apply( this, arguments ) === false ) {
			this.cancel();
		}
	},

	_uiHash: function( _inst ) {
		var inst = _inst || this;
		return {
			helper: inst.helper,
			placeholder: inst.placeholder || $( [] ),
			position: inst.position,
			originalPosition: inst.originalPosition,
			offset: inst.positionAbs,
			item: inst.currentItem,
			sender: _inst ? _inst.element : null
		};
	}

} );




//>>label: Spinner
//>>group: Widgets
//>>description: Displays buttons to easily input numbers via the keyboard or mouse.

//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/spinner.css
//>>css.theme: ../../themes/base/theme.css



function spinnerModifer( fn ) {
	return function() {
		var previous = this.element.val();
		fn.apply( this, arguments );
		this._refresh();
		if ( previous !== this.element.val() ) {
			this._trigger( "change" );
		}
	};
}

$.widget( "ui.spinner", {
	version: "1.12.1",
	defaultElement: "<input>",
	widgetEventPrefix: "spin",
	options: {
		classes: {
			"ui-spinner": "ui-corner-all",
			"ui-spinner-down": "ui-corner-br",
			"ui-spinner-up": "ui-corner-tr"
		},
		culture: null,
		icons: {
			down: "ui-icon-triangle-1-s",
			up: "ui-icon-triangle-1-n"
		},
		incremental: true,
		max: null,
		min: null,
		numberFormat: null,
		page: 10,
		step: 1,

		change: null,
		spin: null,
		start: null,
		stop: null
	},

	_create: function() {

		// handle string values that need to be parsed
		this._setOption( "max", this.options.max );
		this._setOption( "min", this.options.min );
		this._setOption( "step", this.options.step );

		// Only format if there is a value, prevents the field from being marked
		// as invalid in Firefox, see #9573.
		if ( this.value() !== "" ) {

			// Format the value, but don't constrain.
			this._value( this.element.val(), true );
		}

		this._draw();
		this._on( this._events );
		this._refresh();

		// Turning off autocomplete prevents the browser from remembering the
		// value when navigating through history, so we re-enable autocomplete
		// if the page is unloaded before the widget is destroyed. #7790
		this._on( this.window, {
			beforeunload: function() {
				this.element.removeAttr( "autocomplete" );
			}
		} );
	},

	_getCreateOptions: function() {
		var options = this._super();
		var element = this.element;

		$.each( [ "min", "max", "step" ], function( i, option ) {
			var value = element.attr( option );
			if ( value != null && value.length ) {
				options[ option ] = value;
			}
		} );

		return options;
	},

	_events: {
		keydown: function( event ) {
			if ( this._start( event ) && this._keydown( event ) ) {
				event.preventDefault();
			}
		},
		keyup: "_stop",
		focus: function() {
			this.previous = this.element.val();
		},
		blur: function( event ) {
			if ( this.cancelBlur ) {
				delete this.cancelBlur;
				return;
			}

			this._stop();
			this._refresh();
			if ( this.previous !== this.element.val() ) {
				this._trigger( "change", event );
			}
		},
		mousewheel: function( event, delta ) {
			if ( !delta ) {
				return;
			}
			if ( !this.spinning && !this._start( event ) ) {
				return false;
			}

			this._spin( ( delta > 0 ? 1 : -1 ) * this.options.step, event );
			clearTimeout( this.mousewheelTimer );
			this.mousewheelTimer = this._delay( function() {
				if ( this.spinning ) {
					this._stop( event );
				}
			}, 100 );
			event.preventDefault();
		},
		"mousedown .ui-spinner-button": function( event ) {
			var previous;

			// We never want the buttons to have focus; whenever the user is
			// interacting with the spinner, the focus should be on the input.
			// If the input is focused then this.previous is properly set from
			// when the input first received focus. If the input is not focused
			// then we need to set this.previous based on the value before spinning.
			previous = this.element[ 0 ] === $.ui.safeActiveElement( this.document[ 0 ] ) ?
				this.previous : this.element.val();
			function checkFocus() {
				var isActive = this.element[ 0 ] === $.ui.safeActiveElement( this.document[ 0 ] );
				if ( !isActive ) {
					this.element.trigger( "focus" );
					this.previous = previous;

					// support: IE
					// IE sets focus asynchronously, so we need to check if focus
					// moved off of the input because the user clicked on the button.
					this._delay( function() {
						this.previous = previous;
					} );
				}
			}

			// Ensure focus is on (or stays on) the text field
			event.preventDefault();
			checkFocus.call( this );

			// Support: IE
			// IE doesn't prevent moving focus even with event.preventDefault()
			// so we set a flag to know when we should ignore the blur event
			// and check (again) if focus moved off of the input.
			this.cancelBlur = true;
			this._delay( function() {
				delete this.cancelBlur;
				checkFocus.call( this );
			} );

			if ( this._start( event ) === false ) {
				return;
			}

			this._repeat( null, $( event.currentTarget )
				.hasClass( "ui-spinner-up" ) ? 1 : -1, event );
		},
		"mouseup .ui-spinner-button": "_stop",
		"mouseenter .ui-spinner-button": function( event ) {

			// button will add ui-state-active if mouse was down while mouseleave and kept down
			if ( !$( event.currentTarget ).hasClass( "ui-state-active" ) ) {
				return;
			}

			if ( this._start( event ) === false ) {
				return false;
			}
			this._repeat( null, $( event.currentTarget )
				.hasClass( "ui-spinner-up" ) ? 1 : -1, event );
		},

		// TODO: do we really want to consider this a stop?
		// shouldn't we just stop the repeater and wait until mouseup before
		// we trigger the stop event?
		"mouseleave .ui-spinner-button": "_stop"
	},

	// Support mobile enhanced option and make backcompat more sane
	_enhance: function() {
		this.uiSpinner = this.element
			.attr( "autocomplete", "off" )
			.wrap( "<span>" )
			.parent()

				// Add buttons
				.append(
					"<a></a><a></a>"
				);
	},

	_draw: function() {
		this._enhance();

		this._addClass( this.uiSpinner, "ui-spinner", "ui-widget ui-widget-content" );
		this._addClass( "ui-spinner-input" );

		this.element.attr( "role", "spinbutton" );

		// Button bindings
		this.buttons = this.uiSpinner.children( "a" )
			.attr( "tabIndex", -1 )
			.attr( "aria-hidden", true )
			.button( {
				classes: {
					"ui-button": ""
				}
			} );

		// TODO: Right now button does not support classes this is already updated in button PR
		this._removeClass( this.buttons, "ui-corner-all" );

		this._addClass( this.buttons.first(), "ui-spinner-button ui-spinner-up" );
		this._addClass( this.buttons.last(), "ui-spinner-button ui-spinner-down" );
		this.buttons.first().button( {
			"icon": this.options.icons.up,
			"showLabel": false
		} );
		this.buttons.last().button( {
			"icon": this.options.icons.down,
			"showLabel": false
		} );

		// IE 6 doesn't understand height: 50% for the buttons
		// unless the wrapper has an explicit height
		if ( this.buttons.height() > Math.ceil( this.uiSpinner.height() * 0.5 ) &&
				this.uiSpinner.height() > 0 ) {
			this.uiSpinner.height( this.uiSpinner.height() );
		}
	},

	_keydown: function( event ) {
		var options = this.options,
			keyCode = $.ui.keyCode;

		switch ( event.keyCode ) {
		case keyCode.UP:
			this._repeat( null, 1, event );
			return true;
		case keyCode.DOWN:
			this._repeat( null, -1, event );
			return true;
		case keyCode.PAGE_UP:
			this._repeat( null, options.page, event );
			return true;
		case keyCode.PAGE_DOWN:
			this._repeat( null, -options.page, event );
			return true;
		}

		return false;
	},

	_start: function( event ) {
		if ( !this.spinning && this._trigger( "start", event ) === false ) {
			return false;
		}

		if ( !this.counter ) {
			this.counter = 1;
		}
		this.spinning = true;
		return true;
	},

	_repeat: function( i, steps, event ) {
		i = i || 500;

		clearTimeout( this.timer );
		this.timer = this._delay( function() {
			this._repeat( 40, steps, event );
		}, i );

		this._spin( steps * this.options.step, event );
	},

	_spin: function( step, event ) {
		var value = this.value() || 0;

		if ( !this.counter ) {
			this.counter = 1;
		}

		value = this._adjustValue( value + step * this._increment( this.counter ) );

		if ( !this.spinning || this._trigger( "spin", event, { value: value } ) !== false ) {
			this._value( value );
			this.counter++;
		}
	},

	_increment: function( i ) {
		var incremental = this.options.incremental;

		if ( incremental ) {
			return $.isFunction( incremental ) ?
				incremental( i ) :
				Math.floor( i * i * i / 50000 - i * i / 500 + 17 * i / 200 + 1 );
		}

		return 1;
	},

	_precision: function() {
		var precision = this._precisionOf( this.options.step );
		if ( this.options.min !== null ) {
			precision = Math.max( precision, this._precisionOf( this.options.min ) );
		}
		return precision;
	},

	_precisionOf: function( num ) {
		var str = num.toString(),
			decimal = str.indexOf( "." );
		return decimal === -1 ? 0 : str.length - decimal - 1;
	},

	_adjustValue: function( value ) {
		var base, aboveMin,
			options = this.options;

		// Make sure we're at a valid step
		// - find out where we are relative to the base (min or 0)
		base = options.min !== null ? options.min : 0;
		aboveMin = value - base;

		// - round to the nearest step
		aboveMin = Math.round( aboveMin / options.step ) * options.step;

		// - rounding is based on 0, so adjust back to our base
		value = base + aboveMin;

		// Fix precision from bad JS floating point math
		value = parseFloat( value.toFixed( this._precision() ) );

		// Clamp the value
		if ( options.max !== null && value > options.max ) {
			return options.max;
		}
		if ( options.min !== null && value < options.min ) {
			return options.min;
		}

		return value;
	},

	_stop: function( event ) {
		if ( !this.spinning ) {
			return;
		}

		clearTimeout( this.timer );
		clearTimeout( this.mousewheelTimer );
		this.counter = 0;
		this.spinning = false;
		this._trigger( "stop", event );
	},

	_setOption: function( key, value ) {
		var prevValue, first, last;

		if ( key === "culture" || key === "numberFormat" ) {
			prevValue = this._parse( this.element.val() );
			this.options[ key ] = value;
			this.element.val( this._format( prevValue ) );
			return;
		}

		if ( key === "max" || key === "min" || key === "step" ) {
			if ( typeof value === "string" ) {
				value = this._parse( value );
			}
		}
		if ( key === "icons" ) {
			first = this.buttons.first().find( ".ui-icon" );
			this._removeClass( first, null, this.options.icons.up );
			this._addClass( first, null, value.up );
			last = this.buttons.last().find( ".ui-icon" );
			this._removeClass( last, null, this.options.icons.down );
			this._addClass( last, null, value.down );
		}

		this._super( key, value );
	},

	_setOptionDisabled: function( value ) {
		this._super( value );

		this._toggleClass( this.uiSpinner, null, "ui-state-disabled", !!value );
		this.element.prop( "disabled", !!value );
		this.buttons.button( value ? "disable" : "enable" );
	},

	_setOptions: spinnerModifer( function( options ) {
		this._super( options );
	} ),

	_parse: function( val ) {
		if ( typeof val === "string" && val !== "" ) {
			val = window.Globalize && this.options.numberFormat ?
				Globalize.parseFloat( val, 10, this.options.culture ) : +val;
		}
		return val === "" || isNaN( val ) ? null : val;
	},

	_format: function( value ) {
		if ( value === "" ) {
			return "";
		}
		return window.Globalize && this.options.numberFormat ?
			Globalize.format( value, this.options.numberFormat, this.options.culture ) :
			value;
	},

	_refresh: function() {
		this.element.attr( {
			"aria-valuemin": this.options.min,
			"aria-valuemax": this.options.max,

			// TODO: what should we do with values that can't be parsed?
			"aria-valuenow": this._parse( this.element.val() )
		} );
	},

	isValid: function() {
		var value = this.value();

		// Null is invalid
		if ( value === null ) {
			return false;
		}

		// If value gets adjusted, it's invalid
		return value === this._adjustValue( value );
	},

	// Update the value without triggering change
	_value: function( value, allowAny ) {
		var parsed;
		if ( value !== "" ) {
			parsed = this._parse( value );
			if ( parsed !== null ) {
				if ( !allowAny ) {
					parsed = this._adjustValue( parsed );
				}
				value = this._format( parsed );
			}
		}
		this.element.val( value );
		this._refresh();
	},

	_destroy: function() {
		this.element
			.prop( "disabled", false )
			.removeAttr( "autocomplete role aria-valuemin aria-valuemax aria-valuenow" );

		this.uiSpinner.replaceWith( this.element );
	},

	stepUp: spinnerModifer( function( steps ) {
		this._stepUp( steps );
	} ),
	_stepUp: function( steps ) {
		if ( this._start() ) {
			this._spin( ( steps || 1 ) * this.options.step );
			this._stop();
		}
	},

	stepDown: spinnerModifer( function( steps ) {
		this._stepDown( steps );
	} ),
	_stepDown: function( steps ) {
		if ( this._start() ) {
			this._spin( ( steps || 1 ) * -this.options.step );
			this._stop();
		}
	},

	pageUp: spinnerModifer( function( pages ) {
		this._stepUp( ( pages || 1 ) * this.options.page );
	} ),

	pageDown: spinnerModifer( function( pages ) {
		this._stepDown( ( pages || 1 ) * this.options.page );
	} ),

	value: function( newVal ) {
		if ( !arguments.length ) {
			return this._parse( this.element.val() );
		}
		spinnerModifer( this._value ).call( this, newVal );
	},

	widget: function() {
		return this.uiSpinner;
	}
} );

// DEPRECATED
// TODO: switch return back to widget declaration at top of file when this is removed
if ( $.uiBackCompat !== false ) {

	// Backcompat for spinner html extension points
	$.widget( "ui.spinner", $.ui.spinner, {
		_enhance: function() {
			this.uiSpinner = this.element
				.attr( "autocomplete", "off" )
				.wrap( this._uiSpinnerHtml() )
				.parent()

					// Add buttons
					.append( this._buttonHtml() );
		},
		_uiSpinnerHtml: function() {
			return "<span>";
		},

		_buttonHtml: function() {
			return "<a></a><a></a>";
		}
	} );
}

var widgetsSpinner = $.ui.spinner;




//>>label: Tabs
//>>group: Widgets
//>>description: Transforms a set of container elements into a tab structure.

//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/tabs.css
//>>css.theme: ../../themes/base/theme.css



$.widget( "ui.tabs", {
	version: "1.12.1",
	delay: 300,
	options: {
		active: null,
		classes: {
			"ui-tabs": "ui-corner-all",
			"ui-tabs-nav": "ui-corner-all",
			"ui-tabs-panel": "ui-corner-bottom",
			"ui-tabs-tab": "ui-corner-top"
		},
		collapsible: false,
		event: "click",
		heightStyle: "content",
		hide: null,
		show: null,

		// Callbacks
		activate: null,
		beforeActivate: null,
		beforeLoad: null,
		load: null
	},

	_isLocal: ( function() {
		var rhash = /#.*$/;

		return function( anchor ) {
			var anchorUrl, locationUrl;

			anchorUrl = anchor.href.replace( rhash, "" );
			locationUrl = location.href.replace( rhash, "" );

			// Decoding may throw an error if the URL isn't UTF-8 (#9518)
			try {
				anchorUrl = decodeURIComponent( anchorUrl );
			} catch ( error ) {}
			try {
				locationUrl = decodeURIComponent( locationUrl );
			} catch ( error ) {}

			return anchor.hash.length > 1 && anchorUrl === locationUrl;
		};
	} )(),

	_create: function() {
		var that = this,
			options = this.options;

		this.running = false;

		this._addClass( "ui-tabs", "ui-widget ui-widget-content" );
		this._toggleClass( "ui-tabs-collapsible", null, options.collapsible );

		this._processTabs();
		options.active = this._initialActive();

		// Take disabling tabs via class attribute from HTML
		// into account and update option properly.
		if ( $.isArray( options.disabled ) ) {
			options.disabled = $.unique( options.disabled.concat(
				$.map( this.tabs.filter( ".ui-state-disabled" ), function( li ) {
					return that.tabs.index( li );
				} )
			) ).sort();
		}

		// Check for length avoids error when initializing empty list
		if ( this.options.active !== false && this.anchors.length ) {
			this.active = this._findActive( options.active );
		} else {
			this.active = $();
		}

		this._refresh();

		if ( this.active.length ) {
			this.load( options.active );
		}
	},

	_initialActive: function() {
		var active = this.options.active,
			collapsible = this.options.collapsible,
			locationHash = location.hash.substring( 1 );

		if ( active === null ) {

			// check the fragment identifier in the URL
			if ( locationHash ) {
				this.tabs.each( function( i, tab ) {
					if ( $( tab ).attr( "aria-controls" ) === locationHash ) {
						active = i;
						return false;
					}
				} );
			}

			// Check for a tab marked active via a class
			if ( active === null ) {
				active = this.tabs.index( this.tabs.filter( ".ui-tabs-active" ) );
			}

			// No active tab, set to false
			if ( active === null || active === -1 ) {
				active = this.tabs.length ? 0 : false;
			}
		}

		// Handle numbers: negative, out of range
		if ( active !== false ) {
			active = this.tabs.index( this.tabs.eq( active ) );
			if ( active === -1 ) {
				active = collapsible ? false : 0;
			}
		}

		// Don't allow collapsible: false and active: false
		if ( !collapsible && active === false && this.anchors.length ) {
			active = 0;
		}

		return active;
	},

	_getCreateEventData: function() {
		return {
			tab: this.active,
			panel: !this.active.length ? $() : this._getPanelForTab( this.active )
		};
	},

	_tabKeydown: function( event ) {
		var focusedTab = $( $.ui.safeActiveElement( this.document[ 0 ] ) ).closest( "li" ),
			selectedIndex = this.tabs.index( focusedTab ),
			goingForward = true;

		if ( this._handlePageNav( event ) ) {
			return;
		}

		switch ( event.keyCode ) {
		case $.ui.keyCode.RIGHT:
		case $.ui.keyCode.DOWN:
			selectedIndex++;
			break;
		case $.ui.keyCode.UP:
		case $.ui.keyCode.LEFT:
			goingForward = false;
			selectedIndex--;
			break;
		case $.ui.keyCode.END:
			selectedIndex = this.anchors.length - 1;
			break;
		case $.ui.keyCode.HOME:
			selectedIndex = 0;
			break;
		case $.ui.keyCode.SPACE:

			// Activate only, no collapsing
			event.preventDefault();
			clearTimeout( this.activating );
			this._activate( selectedIndex );
			return;
		case $.ui.keyCode.ENTER:

			// Toggle (cancel delayed activation, allow collapsing)
			event.preventDefault();
			clearTimeout( this.activating );

			// Determine if we should collapse or activate
			this._activate( selectedIndex === this.options.active ? false : selectedIndex );
			return;
		default:
			return;
		}

		// Focus the appropriate tab, based on which key was pressed
		event.preventDefault();
		clearTimeout( this.activating );
		selectedIndex = this._focusNextTab( selectedIndex, goingForward );

		// Navigating with control/command key will prevent automatic activation
		if ( !event.ctrlKey && !event.metaKey ) {

			// Update aria-selected immediately so that AT think the tab is already selected.
			// Otherwise AT may confuse the user by stating that they need to activate the tab,
			// but the tab will already be activated by the time the announcement finishes.
			focusedTab.attr( "aria-selected", "false" );
			this.tabs.eq( selectedIndex ).attr( "aria-selected", "true" );

			this.activating = this._delay( function() {
				this.option( "active", selectedIndex );
			}, this.delay );
		}
	},

	_panelKeydown: function( event ) {
		if ( this._handlePageNav( event ) ) {
			return;
		}

		// Ctrl+up moves focus to the current tab
		if ( event.ctrlKey && event.keyCode === $.ui.keyCode.UP ) {
			event.preventDefault();
			this.active.trigger( "focus" );
		}
	},

	// Alt+page up/down moves focus to the previous/next tab (and activates)
	_handlePageNav: function( event ) {
		if ( event.altKey && event.keyCode === $.ui.keyCode.PAGE_UP ) {
			this._activate( this._focusNextTab( this.options.active - 1, false ) );
			return true;
		}
		if ( event.altKey && event.keyCode === $.ui.keyCode.PAGE_DOWN ) {
			this._activate( this._focusNextTab( this.options.active + 1, true ) );
			return true;
		}
	},

	_findNextTab: function( index, goingForward ) {
		var lastTabIndex = this.tabs.length - 1;

		function constrain() {
			if ( index > lastTabIndex ) {
				index = 0;
			}
			if ( index < 0 ) {
				index = lastTabIndex;
			}
			return index;
		}

		while ( $.inArray( constrain(), this.options.disabled ) !== -1 ) {
			index = goingForward ? index + 1 : index - 1;
		}

		return index;
	},

	_focusNextTab: function( index, goingForward ) {
		index = this._findNextTab( index, goingForward );
		this.tabs.eq( index ).trigger( "focus" );
		return index;
	},

	_setOption: function( key, value ) {
		if ( key === "active" ) {

			// _activate() will handle invalid values and update this.options
			this._activate( value );
			return;
		}

		this._super( key, value );

		if ( key === "collapsible" ) {
			this._toggleClass( "ui-tabs-collapsible", null, value );

			// Setting collapsible: false while collapsed; open first panel
			if ( !value && this.options.active === false ) {
				this._activate( 0 );
			}
		}

		if ( key === "event" ) {
			this._setupEvents( value );
		}

		if ( key === "heightStyle" ) {
			this._setupHeightStyle( value );
		}
	},

	_sanitizeSelector: function( hash ) {
		return hash ? hash.replace( /[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g, "\\$&" ) : "";
	},

	refresh: function() {
		var options = this.options,
			lis = this.tablist.children( ":has(a[href])" );

		// Get disabled tabs from class attribute from HTML
		// this will get converted to a boolean if needed in _refresh()
		options.disabled = $.map( lis.filter( ".ui-state-disabled" ), function( tab ) {
			return lis.index( tab );
		} );

		this._processTabs();

		// Was collapsed or no tabs
		if ( options.active === false || !this.anchors.length ) {
			options.active = false;
			this.active = $();

		// was active, but active tab is gone
		} else if ( this.active.length && !$.contains( this.tablist[ 0 ], this.active[ 0 ] ) ) {

			// all remaining tabs are disabled
			if ( this.tabs.length === options.disabled.length ) {
				options.active = false;
				this.active = $();

			// activate previous tab
			} else {
				this._activate( this._findNextTab( Math.max( 0, options.active - 1 ), false ) );
			}

		// was active, active tab still exists
		} else {

			// make sure active index is correct
			options.active = this.tabs.index( this.active );
		}

		this._refresh();
	},

	_refresh: function() {
		this._setOptionDisabled( this.options.disabled );
		this._setupEvents( this.options.event );
		this._setupHeightStyle( this.options.heightStyle );

		this.tabs.not( this.active ).attr( {
			"aria-selected": "false",
			"aria-expanded": "false",
			tabIndex: -1
		} );
		this.panels.not( this._getPanelForTab( this.active ) )
			.hide()
			.attr( {
				"aria-hidden": "true"
			} );

		// Make sure one tab is in the tab order
		if ( !this.active.length ) {
			this.tabs.eq( 0 ).attr( "tabIndex", 0 );
		} else {
			this.active
				.attr( {
					"aria-selected": "true",
					"aria-expanded": "true",
					tabIndex: 0
				} );
			this._addClass( this.active, "ui-tabs-active", "ui-state-active" );
			this._getPanelForTab( this.active )
				.show()
				.attr( {
					"aria-hidden": "false"
				} );
		}
	},

	_processTabs: function() {
		var that = this,
			prevTabs = this.tabs,
			prevAnchors = this.anchors,
			prevPanels = this.panels;

		this.tablist = this._getList().attr( "role", "tablist" );
		this._addClass( this.tablist, "ui-tabs-nav",
			"ui-helper-reset ui-helper-clearfix ui-widget-header" );

		// Prevent users from focusing disabled tabs via click
		this.tablist
			.on( "mousedown" + this.eventNamespace, "> li", function( event ) {
				if ( $( this ).is( ".ui-state-disabled" ) ) {
					event.preventDefault();
				}
			} )

			// Support: IE <9
			// Preventing the default action in mousedown doesn't prevent IE
			// from focusing the element, so if the anchor gets focused, blur.
			// We don't have to worry about focusing the previously focused
			// element since clicking on a non-focusable element should focus
			// the body anyway.
			.on( "focus" + this.eventNamespace, ".ui-tabs-anchor", function() {
				if ( $( this ).closest( "li" ).is( ".ui-state-disabled" ) ) {
					this.blur();
				}
			} );

		this.tabs = this.tablist.find( "> li:has(a[href])" )
			.attr( {
				role: "tab",
				tabIndex: -1
			} );
		this._addClass( this.tabs, "ui-tabs-tab", "ui-state-default" );

		this.anchors = this.tabs.map( function() {
			return $( "a", this )[ 0 ];
		} )
			.attr( {
				role: "presentation",
				tabIndex: -1
			} );
		this._addClass( this.anchors, "ui-tabs-anchor" );

		this.panels = $();

		this.anchors.each( function( i, anchor ) {
			var selector, panel, panelId,
				anchorId = $( anchor ).uniqueId().attr( "id" ),
				tab = $( anchor ).closest( "li" ),
				originalAriaControls = tab.attr( "aria-controls" );

			// Inline tab
			if ( that._isLocal( anchor ) ) {
				selector = anchor.hash;
				panelId = selector.substring( 1 );
				panel = that.element.find( that._sanitizeSelector( selector ) );

			// remote tab
			} else {

				// If the tab doesn't already have aria-controls,
				// generate an id by using a throw-away element
				panelId = tab.attr( "aria-controls" ) || $( {} ).uniqueId()[ 0 ].id;
				selector = "#" + panelId;
				panel = that.element.find( selector );
				if ( !panel.length ) {
					panel = that._createPanel( panelId );
					panel.insertAfter( that.panels[ i - 1 ] || that.tablist );
				}
				panel.attr( "aria-live", "polite" );
			}

			if ( panel.length ) {
				that.panels = that.panels.add( panel );
			}
			if ( originalAriaControls ) {
				tab.data( "ui-tabs-aria-controls", originalAriaControls );
			}
			tab.attr( {
				"aria-controls": panelId,
				"aria-labelledby": anchorId
			} );
			panel.attr( "aria-labelledby", anchorId );
		} );

		this.panels.attr( "role", "tabpanel" );
		this._addClass( this.panels, "ui-tabs-panel", "ui-widget-content" );

		// Avoid memory leaks (#10056)
		if ( prevTabs ) {
			this._off( prevTabs.not( this.tabs ) );
			this._off( prevAnchors.not( this.anchors ) );
			this._off( prevPanels.not( this.panels ) );
		}
	},

	// Allow overriding how to find the list for rare usage scenarios (#7715)
	_getList: function() {
		return this.tablist || this.element.find( "ol, ul" ).eq( 0 );
	},

	_createPanel: function( id ) {
		return $( "<div>" )
			.attr( "id", id )
			.data( "ui-tabs-destroy", true );
	},

	_setOptionDisabled: function( disabled ) {
		var currentItem, li, i;

		if ( $.isArray( disabled ) ) {
			if ( !disabled.length ) {
				disabled = false;
			} else if ( disabled.length === this.anchors.length ) {
				disabled = true;
			}
		}

		// Disable tabs
		for ( i = 0; ( li = this.tabs[ i ] ); i++ ) {
			currentItem = $( li );
			if ( disabled === true || $.inArray( i, disabled ) !== -1 ) {
				currentItem.attr( "aria-disabled", "true" );
				this._addClass( currentItem, null, "ui-state-disabled" );
			} else {
				currentItem.removeAttr( "aria-disabled" );
				this._removeClass( currentItem, null, "ui-state-disabled" );
			}
		}

		this.options.disabled = disabled;

		this._toggleClass( this.widget(), this.widgetFullName + "-disabled", null,
			disabled === true );
	},

	_setupEvents: function( event ) {
		var events = {};
		if ( event ) {
			$.each( event.split( " " ), function( index, eventName ) {
				events[ eventName ] = "_eventHandler";
			} );
		}

		this._off( this.anchors.add( this.tabs ).add( this.panels ) );

		// Always prevent the default action, even when disabled
		this._on( true, this.anchors, {
			click: function( event ) {
				event.preventDefault();
			}
		} );
		this._on( this.anchors, events );
		this._on( this.tabs, { keydown: "_tabKeydown" } );
		this._on( this.panels, { keydown: "_panelKeydown" } );

		this._focusable( this.tabs );
		this._hoverable( this.tabs );
	},

	_setupHeightStyle: function( heightStyle ) {
		var maxHeight,
			parent = this.element.parent();

		if ( heightStyle === "fill" ) {
			maxHeight = parent.height();
			maxHeight -= this.element.outerHeight() - this.element.height();

			this.element.siblings( ":visible" ).each( function() {
				var elem = $( this ),
					position = elem.css( "position" );

				if ( position === "absolute" || position === "fixed" ) {
					return;
				}
				maxHeight -= elem.outerHeight( true );
			} );

			this.element.children().not( this.panels ).each( function() {
				maxHeight -= $( this ).outerHeight( true );
			} );

			this.panels.each( function() {
				$( this ).height( Math.max( 0, maxHeight -
					$( this ).innerHeight() + $( this ).height() ) );
			} )
				.css( "overflow", "auto" );
		} else if ( heightStyle === "auto" ) {
			maxHeight = 0;
			this.panels.each( function() {
				maxHeight = Math.max( maxHeight, $( this ).height( "" ).height() );
			} ).height( maxHeight );
		}
	},

	_eventHandler: function( event ) {
		var options = this.options,
			active = this.active,
			anchor = $( event.currentTarget ),
			tab = anchor.closest( "li" ),
			clickedIsActive = tab[ 0 ] === active[ 0 ],
			collapsing = clickedIsActive && options.collapsible,
			toShow = collapsing ? $() : this._getPanelForTab( tab ),
			toHide = !active.length ? $() : this._getPanelForTab( active ),
			eventData = {
				oldTab: active,
				oldPanel: toHide,
				newTab: collapsing ? $() : tab,
				newPanel: toShow
			};

		event.preventDefault();

		if ( tab.hasClass( "ui-state-disabled" ) ||

				// tab is already loading
				tab.hasClass( "ui-tabs-loading" ) ||

				// can't switch durning an animation
				this.running ||

				// click on active header, but not collapsible
				( clickedIsActive && !options.collapsible ) ||

				// allow canceling activation
				( this._trigger( "beforeActivate", event, eventData ) === false ) ) {
			return;
		}

		options.active = collapsing ? false : this.tabs.index( tab );

		this.active = clickedIsActive ? $() : tab;
		if ( this.xhr ) {
			this.xhr.abort();
		}

		if ( !toHide.length && !toShow.length ) {
			$.error( "jQuery UI Tabs: Mismatching fragment identifier." );
		}

		if ( toShow.length ) {
			this.load( this.tabs.index( tab ), event );
		}
		this._toggle( event, eventData );
	},

	// Handles show/hide for selecting tabs
	_toggle: function( event, eventData ) {
		var that = this,
			toShow = eventData.newPanel,
			toHide = eventData.oldPanel;

		this.running = true;

		function complete() {
			that.running = false;
			that._trigger( "activate", event, eventData );
		}

		function show() {
			that._addClass( eventData.newTab.closest( "li" ), "ui-tabs-active", "ui-state-active" );

			if ( toShow.length && that.options.show ) {
				that._show( toShow, that.options.show, complete );
			} else {
				toShow.show();
				complete();
			}
		}

		// Start out by hiding, then showing, then completing
		if ( toHide.length && this.options.hide ) {
			this._hide( toHide, this.options.hide, function() {
				that._removeClass( eventData.oldTab.closest( "li" ),
					"ui-tabs-active", "ui-state-active" );
				show();
			} );
		} else {
			this._removeClass( eventData.oldTab.closest( "li" ),
				"ui-tabs-active", "ui-state-active" );
			toHide.hide();
			show();
		}

		toHide.attr( "aria-hidden", "true" );
		eventData.oldTab.attr( {
			"aria-selected": "false",
			"aria-expanded": "false"
		} );

		// If we're switching tabs, remove the old tab from the tab order.
		// If we're opening from collapsed state, remove the previous tab from the tab order.
		// If we're collapsing, then keep the collapsing tab in the tab order.
		if ( toShow.length && toHide.length ) {
			eventData.oldTab.attr( "tabIndex", -1 );
		} else if ( toShow.length ) {
			this.tabs.filter( function() {
				return $( this ).attr( "tabIndex" ) === 0;
			} )
				.attr( "tabIndex", -1 );
		}

		toShow.attr( "aria-hidden", "false" );
		eventData.newTab.attr( {
			"aria-selected": "true",
			"aria-expanded": "true",
			tabIndex: 0
		} );
	},

	_activate: function( index ) {
		var anchor,
			active = this._findActive( index );

		// Trying to activate the already active panel
		if ( active[ 0 ] === this.active[ 0 ] ) {
			return;
		}

		// Trying to collapse, simulate a click on the current active header
		if ( !active.length ) {
			active = this.active;
		}

		anchor = active.find( ".ui-tabs-anchor" )[ 0 ];
		this._eventHandler( {
			target: anchor,
			currentTarget: anchor,
			preventDefault: $.noop
		} );
	},

	_findActive: function( index ) {
		return index === false ? $() : this.tabs.eq( index );
	},

	_getIndex: function( index ) {

		// meta-function to give users option to provide a href string instead of a numerical index.
		if ( typeof index === "string" ) {
			index = this.anchors.index( this.anchors.filter( "[href$='" +
				$.ui.escapeSelector( index ) + "']" ) );
		}

		return index;
	},

	_destroy: function() {
		if ( this.xhr ) {
			this.xhr.abort();
		}

		this.tablist
			.removeAttr( "role" )
			.off( this.eventNamespace );

		this.anchors
			.removeAttr( "role tabIndex" )
			.removeUniqueId();

		this.tabs.add( this.panels ).each( function() {
			if ( $.data( this, "ui-tabs-destroy" ) ) {
				$( this ).remove();
			} else {
				$( this ).removeAttr( "role tabIndex " +
					"aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded" );
			}
		} );

		this.tabs.each( function() {
			var li = $( this ),
				prev = li.data( "ui-tabs-aria-controls" );
			if ( prev ) {
				li
					.attr( "aria-controls", prev )
					.removeData( "ui-tabs-aria-controls" );
			} else {
				li.removeAttr( "aria-controls" );
			}
		} );

		this.panels.show();

		if ( this.options.heightStyle !== "content" ) {
			this.panels.css( "height", "" );
		}
	},

	enable: function( index ) {
		var disabled = this.options.disabled;
		if ( disabled === false ) {
			return;
		}

		if ( index === undefined ) {
			disabled = false;
		} else {
			index = this._getIndex( index );
			if ( $.isArray( disabled ) ) {
				disabled = $.map( disabled, function( num ) {
					return num !== index ? num : null;
				} );
			} else {
				disabled = $.map( this.tabs, function( li, num ) {
					return num !== index ? num : null;
				} );
			}
		}
		this._setOptionDisabled( disabled );
	},

	disable: function( index ) {
		var disabled = this.options.disabled;
		if ( disabled === true ) {
			return;
		}

		if ( index === undefined ) {
			disabled = true;
		} else {
			index = this._getIndex( index );
			if ( $.inArray( index, disabled ) !== -1 ) {
				return;
			}
			if ( $.isArray( disabled ) ) {
				disabled = $.merge( [ index ], disabled ).sort();
			} else {
				disabled = [ index ];
			}
		}
		this._setOptionDisabled( disabled );
	},

	load: function( index, event ) {
		index = this._getIndex( index );
		var that = this,
			tab = this.tabs.eq( index ),
			anchor = tab.find( ".ui-tabs-anchor" ),
			panel = this._getPanelForTab( tab ),
			eventData = {
				tab: tab,
				panel: panel
			},
			complete = function( jqXHR, status ) {
				if ( status === "abort" ) {
					that.panels.stop( false, true );
				}

				that._removeClass( tab, "ui-tabs-loading" );
				panel.removeAttr( "aria-busy" );

				if ( jqXHR === that.xhr ) {
					delete that.xhr;
				}
			};

		// Not remote
		if ( this._isLocal( anchor[ 0 ] ) ) {
			return;
		}

		this.xhr = $.ajax( this._ajaxSettings( anchor, event, eventData ) );

		// Support: jQuery <1.8
		// jQuery <1.8 returns false if the request is canceled in beforeSend,
		// but as of 1.8, $.ajax() always returns a jqXHR object.
		if ( this.xhr && this.xhr.statusText !== "canceled" ) {
			this._addClass( tab, "ui-tabs-loading" );
			panel.attr( "aria-busy", "true" );

			this.xhr
				.done( function( response, status, jqXHR ) {

					// support: jQuery <1.8
					// http://bugs.jquery.com/ticket/11778
					setTimeout( function() {
						panel.html( response );
						that._trigger( "load", event, eventData );

						complete( jqXHR, status );
					}, 1 );
				} )
				.fail( function( jqXHR, status ) {

					// support: jQuery <1.8
					// http://bugs.jquery.com/ticket/11778
					setTimeout( function() {
						complete( jqXHR, status );
					}, 1 );
				} );
		}
	},

	_ajaxSettings: function( anchor, event, eventData ) {
		var that = this;
		return {

			// Support: IE <11 only
			// Strip any hash that exists to prevent errors with the Ajax request
			url: anchor.attr( "href" ).replace( /#.*$/, "" ),
			beforeSend: function( jqXHR, settings ) {
				return that._trigger( "beforeLoad", event,
					$.extend( { jqXHR: jqXHR, ajaxSettings: settings }, eventData ) );
			}
		};
	},

	_getPanelForTab: function( tab ) {
		var id = $( tab ).attr( "aria-controls" );
		return this.element.find( this._sanitizeSelector( "#" + id ) );
	}
} );

// DEPRECATED
// TODO: Switch return back to widget declaration at top of file when this is removed
if ( $.uiBackCompat !== false ) {

	// Backcompat for ui-tab class (now ui-tabs-tab)
	$.widget( "ui.tabs", $.ui.tabs, {
		_processTabs: function() {
			this._superApply( arguments );
			this._addClass( this.tabs, "ui-tab" );
		}
	} );
}

var widgetsTabs = $.ui.tabs;




//>>label: Tooltip
//>>group: Widgets
//>>description: Shows additional information for any element on hover or focus.
//>>css.structure: ../../themes/base/core.css
//>>css.structure: ../../themes/base/tooltip.css
//>>css.theme: ../../themes/base/theme.css



$.widget( "ui.tooltip", {
	version: "1.12.1",
	options: {
		classes: {
			"ui-tooltip": "ui-corner-all ui-widget-shadow"
		},
		content: function() {

			// support: IE<9, Opera in jQuery <1.7
			// .text() can't accept undefined, so coerce to a string
			var title = $( this ).attr( "title" ) || "";

			// Escape title, since we're going from an attribute to raw HTML
			return $( "<a>" ).text( title ).html();
		},
		hide: true,

		// Disabled elements have inconsistent behavior across browsers (#8661)
		items: "[title]:not([disabled])",
		position: {
			my: "left top+15",
			at: "left bottom",
			collision: "flipfit flip"
		},
		show: true,
		track: false,

		// Callbacks
		close: null,
		open: null
	},

	_addDescribedBy: function( elem, id ) {
		var describedby = ( elem.attr( "aria-describedby" ) || "" ).split( /\s+/ );
		describedby.push( id );
		elem
			.data( "ui-tooltip-id", id )
			.attr( "aria-describedby", $.trim( describedby.join( " " ) ) );
	},

	_removeDescribedBy: function( elem ) {
		var id = elem.data( "ui-tooltip-id" ),
			describedby = ( elem.attr( "aria-describedby" ) || "" ).split( /\s+/ ),
			index = $.inArray( id, describedby );

		if ( index !== -1 ) {
			describedby.splice( index, 1 );
		}

		elem.removeData( "ui-tooltip-id" );
		describedby = $.trim( describedby.join( " " ) );
		if ( describedby ) {
			elem.attr( "aria-describedby", describedby );
		} else {
			elem.removeAttr( "aria-describedby" );
		}
	},

	_create: function() {
		this._on( {
			mouseover: "open",
			focusin: "open"
		} );

		// IDs of generated tooltips, needed for destroy
		this.tooltips = {};

		// IDs of parent tooltips where we removed the title attribute
		this.parents = {};

		// Append the aria-live region so tooltips announce correctly
		this.liveRegion = $( "<div>" )
			.attr( {
				role: "log",
				"aria-live": "assertive",
				"aria-relevant": "additions"
			} )
			.appendTo( this.document[ 0 ].body );
		this._addClass( this.liveRegion, null, "ui-helper-hidden-accessible" );

		this.disabledTitles = $( [] );
	},

	_setOption: function( key, value ) {
		var that = this;

		this._super( key, value );

		if ( key === "content" ) {
			$.each( this.tooltips, function( id, tooltipData ) {
				that._updateContent( tooltipData.element );
			} );
		}
	},

	_setOptionDisabled: function( value ) {
		this[ value ? "_disable" : "_enable" ]();
	},

	_disable: function() {
		var that = this;

		// Close open tooltips
		$.each( this.tooltips, function( id, tooltipData ) {
			var event = $.Event( "blur" );
			event.target = event.currentTarget = tooltipData.element[ 0 ];
			that.close( event, true );
		} );

		// Remove title attributes to prevent native tooltips
		this.disabledTitles = this.disabledTitles.add(
			this.element.find( this.options.items ).addBack()
				.filter( function() {
					var element = $( this );
					if ( element.is( "[title]" ) ) {
						return element
							.data( "ui-tooltip-title", element.attr( "title" ) )
							.removeAttr( "title" );
					}
				} )
		);
	},

	_enable: function() {

		// restore title attributes
		this.disabledTitles.each( function() {
			var element = $( this );
			if ( element.data( "ui-tooltip-title" ) ) {
				element.attr( "title", element.data( "ui-tooltip-title" ) );
			}
		} );
		this.disabledTitles = $( [] );
	},

	open: function( event ) {
		var that = this,
			target = $( event ? event.target : this.element )

				// we need closest here due to mouseover bubbling,
				// but always pointing at the same event target
				.closest( this.options.items );

		// No element to show a tooltip for or the tooltip is already open
		if ( !target.length || target.data( "ui-tooltip-id" ) ) {
			return;
		}

		if ( target.attr( "title" ) ) {
			target.data( "ui-tooltip-title", target.attr( "title" ) );
		}

		target.data( "ui-tooltip-open", true );

		// Kill parent tooltips, custom or native, for hover
		if ( event && event.type === "mouseover" ) {
			target.parents().each( function() {
				var parent = $( this ),
					blurEvent;
				if ( parent.data( "ui-tooltip-open" ) ) {
					blurEvent = $.Event( "blur" );
					blurEvent.target = blurEvent.currentTarget = this;
					that.close( blurEvent, true );
				}
				if ( parent.attr( "title" ) ) {
					parent.uniqueId();
					that.parents[ this.id ] = {
						element: this,
						title: parent.attr( "title" )
					};
					parent.attr( "title", "" );
				}
			} );
		}

		this._registerCloseHandlers( event, target );
		this._updateContent( target, event );
	},

	_updateContent: function( target, event ) {
		var content,
			contentOption = this.options.content,
			that = this,
			eventType = event ? event.type : null;

		if ( typeof contentOption === "string" || contentOption.nodeType ||
				contentOption.jquery ) {
			return this._open( event, target, contentOption );
		}

		content = contentOption.call( target[ 0 ], function( response ) {

			// IE may instantly serve a cached response for ajax requests
			// delay this call to _open so the other call to _open runs first
			that._delay( function() {

				// Ignore async response if tooltip was closed already
				if ( !target.data( "ui-tooltip-open" ) ) {
					return;
				}

				// JQuery creates a special event for focusin when it doesn't
				// exist natively. To improve performance, the native event
				// object is reused and the type is changed. Therefore, we can't
				// rely on the type being correct after the event finished
				// bubbling, so we set it back to the previous value. (#8740)
				if ( event ) {
					event.type = eventType;
				}
				this._open( event, target, response );
			} );
		} );
		if ( content ) {
			this._open( event, target, content );
		}
	},

	_open: function( event, target, content ) {
		var tooltipData, tooltip, delayedShow, a11yContent,
			positionOption = $.extend( {}, this.options.position );

		if ( !content ) {
			return;
		}

		// Content can be updated multiple times. If the tooltip already
		// exists, then just update the content and bail.
		tooltipData = this._find( target );
		if ( tooltipData ) {
			tooltipData.tooltip.find( ".ui-tooltip-content" ).html( content );
			return;
		}

		// If we have a title, clear it to prevent the native tooltip
		// we have to check first to avoid defining a title if none exists
		// (we don't want to cause an element to start matching [title])
		//
		// We use removeAttr only for key events, to allow IE to export the correct
		// accessible attributes. For mouse events, set to empty string to avoid
		// native tooltip showing up (happens only when removing inside mouseover).
		if ( target.is( "[title]" ) ) {
			if ( event && event.type === "mouseover" ) {
				target.attr( "title", "" );
			} else {
				target.removeAttr( "title" );
			}
		}

		tooltipData = this._tooltip( target );
		tooltip = tooltipData.tooltip;
		this._addDescribedBy( target, tooltip.attr( "id" ) );
		tooltip.find( ".ui-tooltip-content" ).html( content );

		// Support: Voiceover on OS X, JAWS on IE <= 9
		// JAWS announces deletions even when aria-relevant="additions"
		// Voiceover will sometimes re-read the entire log region's contents from the beginning
		this.liveRegion.children().hide();
		a11yContent = $( "<div>" ).html( tooltip.find( ".ui-tooltip-content" ).html() );
		a11yContent.removeAttr( "name" ).find( "[name]" ).removeAttr( "name" );
		a11yContent.removeAttr( "id" ).find( "[id]" ).removeAttr( "id" );
		a11yContent.appendTo( this.liveRegion );

		function position( event ) {
			positionOption.of = event;
			if ( tooltip.is( ":hidden" ) ) {
				return;
			}
			tooltip.position( positionOption );
		}
		if ( this.options.track && event && /^mouse/.test( event.type ) ) {
			this._on( this.document, {
				mousemove: position
			} );

			// trigger once to override element-relative positioning
			position( event );
		} else {
			tooltip.position( $.extend( {
				of: target
			}, this.options.position ) );
		}

		tooltip.hide();

		this._show( tooltip, this.options.show );

		// Handle tracking tooltips that are shown with a delay (#8644). As soon
		// as the tooltip is visible, position the tooltip using the most recent
		// event.
		// Adds the check to add the timers only when both delay and track options are set (#14682)
		if ( this.options.track && this.options.show && this.options.show.delay ) {
			delayedShow = this.delayedShow = setInterval( function() {
				if ( tooltip.is( ":visible" ) ) {
					position( positionOption.of );
					clearInterval( delayedShow );
				}
			}, $.fx.interval );
		}

		this._trigger( "open", event, { tooltip: tooltip } );
	},

	_registerCloseHandlers: function( event, target ) {
		var events = {
			keyup: function( event ) {
				if ( event.keyCode === $.ui.keyCode.ESCAPE ) {
					var fakeEvent = $.Event( event );
					fakeEvent.currentTarget = target[ 0 ];
					this.close( fakeEvent, true );
				}
			}
		};

		// Only bind remove handler for delegated targets. Non-delegated
		// tooltips will handle this in destroy.
		if ( target[ 0 ] !== this.element[ 0 ] ) {
			events.remove = function() {
				this._removeTooltip( this._find( target ).tooltip );
			};
		}

		if ( !event || event.type === "mouseover" ) {
			events.mouseleave = "close";
		}
		if ( !event || event.type === "focusin" ) {
			events.focusout = "close";
		}
		this._on( true, target, events );
	},

	close: function( event ) {
		var tooltip,
			that = this,
			target = $( event ? event.currentTarget : this.element ),
			tooltipData = this._find( target );

		// The tooltip may already be closed
		if ( !tooltipData ) {

			// We set ui-tooltip-open immediately upon open (in open()), but only set the
			// additional data once there's actually content to show (in _open()). So even if the
			// tooltip doesn't have full data, we always remove ui-tooltip-open in case we're in
			// the period between open() and _open().
			target.removeData( "ui-tooltip-open" );
			return;
		}

		tooltip = tooltipData.tooltip;

		// Disabling closes the tooltip, so we need to track when we're closing
		// to avoid an infinite loop in case the tooltip becomes disabled on close
		if ( tooltipData.closing ) {
			return;
		}

		// Clear the interval for delayed tracking tooltips
		clearInterval( this.delayedShow );

		// Only set title if we had one before (see comment in _open())
		// If the title attribute has changed since open(), don't restore
		if ( target.data( "ui-tooltip-title" ) && !target.attr( "title" ) ) {
			target.attr( "title", target.data( "ui-tooltip-title" ) );
		}

		this._removeDescribedBy( target );

		tooltipData.hiding = true;
		tooltip.stop( true );
		this._hide( tooltip, this.options.hide, function() {
			that._removeTooltip( $( this ) );
		} );

		target.removeData( "ui-tooltip-open" );
		this._off( target, "mouseleave focusout keyup" );

		// Remove 'remove' binding only on delegated targets
		if ( target[ 0 ] !== this.element[ 0 ] ) {
			this._off( target, "remove" );
		}
		this._off( this.document, "mousemove" );

		if ( event && event.type === "mouseleave" ) {
			$.each( this.parents, function( id, parent ) {
				$( parent.element ).attr( "title", parent.title );
				delete that.parents[ id ];
			} );
		}

		tooltipData.closing = true;
		this._trigger( "close", event, { tooltip: tooltip } );
		if ( !tooltipData.hiding ) {
			tooltipData.closing = false;
		}
	},

	_tooltip: function( element ) {
		var tooltip = $( "<div>" ).attr( "role", "tooltip" ),
			content = $( "<div>" ).appendTo( tooltip ),
			id = tooltip.uniqueId().attr( "id" );

		this._addClass( content, "ui-tooltip-content" );
		this._addClass( tooltip, "ui-tooltip", "ui-widget ui-widget-content" );

		tooltip.appendTo( this._appendTo( element ) );

		return this.tooltips[ id ] = {
			element: element,
			tooltip: tooltip
		};
	},

	_find: function( target ) {
		var id = target.data( "ui-tooltip-id" );
		return id ? this.tooltips[ id ] : null;
	},

	_removeTooltip: function( tooltip ) {
		tooltip.remove();
		delete this.tooltips[ tooltip.attr( "id" ) ];
	},

	_appendTo: function( target ) {
		var element = target.closest( ".ui-front, dialog" );

		if ( !element.length ) {
			element = this.document[ 0 ].body;
		}

		return element;
	},

	_destroy: function() {
		var that = this;

		// Close open tooltips
		$.each( this.tooltips, function( id, tooltipData ) {

			// Delegate to close method to handle common cleanup
			var event = $.Event( "blur" ),
				element = tooltipData.element;
			event.target = event.currentTarget = element[ 0 ];
			that.close( event, true );

			// Remove immediately; destroying an open tooltip doesn't use the
			// hide animation
			$( "#" + id ).remove();

			// Restore the title
			if ( element.data( "ui-tooltip-title" ) ) {

				// If the title attribute has changed since open(), don't restore
				if ( !element.attr( "title" ) ) {
					element.attr( "title", element.data( "ui-tooltip-title" ) );
				}
				element.removeData( "ui-tooltip-title" );
			}
		} );
		this.liveRegion.remove();
	}
} );

// DEPRECATED
// TODO: Switch return back to widget declaration at top of file when this is removed
if ( $.uiBackCompat !== false ) {

	// Backcompat for tooltipClass option
	$.widget( "ui.tooltip", $.ui.tooltip, {
		options: {
			tooltipClass: null
		},
		_tooltip: function() {
			var tooltipData = this._superApply( arguments );
			if ( this.options.tooltipClass ) {
				tooltipData.tooltip.addClass( this.options.tooltipClass );
			}
			return tooltipData;
		}
	} );
}

var widgetsTooltip = $.ui.tooltip;




}));

(function ($) {
	var defaults = {
		url: false,
		callback: false,
		target: false,
		duration: 120,
		on: 'mouseover', // other options: grab, click, toggle
		touch: true, // enables a touch fallback
		onZoomIn: false,
		onZoomOut: false,
		magnify: 1
	};

	// Core Zoom Logic, independent of event listeners.
	$.zoom = function(target, source, img, magnify) {
		var targetHeight,
			targetWidth,
			sourceHeight,
			sourceWidth,
			xRatio,
			yRatio,
			offset,
			$target = $(target),
			position = $target.css('position'),
			$source = $(source);

		// The parent element needs positioning so that the zoomed element can be correctly positioned within.
		target.style.position = /(absolute|fixed)/.test(position) ? position : 'relative';
		target.style.overflow = 'hidden';
		img.style.width = img.style.height = '';

		$(img)
			.addClass('zoomImg')
			.css({
				position: 'absolute',
				top: 0,
				left: 0,
				opacity: 0,
				width: img.width * magnify,
				height: img.height * magnify,
				border: 'none',
				maxWidth: 'none',
				maxHeight: 'none'
			})
			.appendTo(target);

		return {
			init: function() {
				targetWidth = $target.outerWidth();
				targetHeight = $target.outerHeight();

				if (source === target) {
					sourceWidth = targetWidth;
					sourceHeight = targetHeight;
				} else {
					sourceWidth = $source.outerWidth();
					sourceHeight = $source.outerHeight();
				}

				xRatio = (img.width - targetWidth) / sourceWidth;
				yRatio = (img.height - targetHeight) / sourceHeight;

				offset = $source.offset();
			},
			move: function (e) {
				var left = (e.pageX - offset.left),
					top = (e.pageY - offset.top);

				top = Math.max(Math.min(top, sourceHeight), 0);
				left = Math.max(Math.min(left, sourceWidth), 0);

				img.style.left = (left * -xRatio) + 'px';
				img.style.top = (top * -yRatio) + 'px';
			}
		};
	};

	$.fn.zoom = function (options) {
		return this.each(function () {
			var
			settings = $.extend({}, defaults, options || {}),
			//target will display the zoomed image
			target = settings.target && $(settings.target)[0] || this,
			//source will provide zoom location info (thumbnail)
			source = this,
			$source = $(source),
			img = document.createElement('img'),
			$img = $(img),
			mousemove = 'mousemove.zoom',
			clicked = false,
			touched = false;
			title = $('.lazyOwl').data('title');
  
			// If a url wasn't specified, look for an image element.
			if (!settings.url) {
				var srcElement = source.querySelector('img');
				if (srcElement) {
					settings.url = srcElement.getAttribute('data-src') || srcElement.currentSrc || srcElement.src;
				}
				if (!settings.url) {
					return;
				}
			}

			$source.one('zoom.destroy', function(position, overflow){
				$source.off(".zoom");
				target.style.position = position;
				target.style.overflow = overflow;
				img.onload = null;
				$img.remove();
			}.bind(this, target.style.position, target.style.overflow));

			img.onload = function () {
				var zoom = $.zoom(target, source, img, settings.magnify);

				function start(e) {
					zoom.init();
					zoom.move(e);

					// Skip the fade-in for IE8 and lower since it chokes on fading-in
					// and changing position based on mousemovement at the same time.
					$img.stop()
					.fadeTo($.support.opacity ? settings.duration : 0, 1, $.isFunction(settings.onZoomIn) ? settings.onZoomIn.call(img) : false);
				}

				function stop() {
					$img.stop()
					.fadeTo(settings.duration, 0, $.isFunction(settings.onZoomOut) ? settings.onZoomOut.call(img) : false);
				}

				// Mouse events
				if (settings.on === 'grab') {
					$source
						.on('mousedown.zoom',
							function (e) {
								if (e.which === 1) {
									$(document).one('mouseup.zoom',
										function () {
											stop();

											$(document).off(mousemove, zoom.move);
										}
									);

									start(e);

									$(document).on(mousemove, zoom.move);

									e.preventDefault();
								}
							}
						);
				} else if (settings.on === 'click') {
					$source.on('click.zoom',
						function (e) {
							if (clicked) {
								// bubble the event up to the document to trigger the unbind.
								return;
							} else {
								clicked = true;
								start(e);
								$(document).on(mousemove, zoom.move);
								$(document).one('click.zoom',
									function () {
										stop();
										clicked = false;
										$(document).off(mousemove, zoom.move);
									}
								);
								return false;
							}
						}
					);
				} else if (settings.on === 'toggle') {
					$source.on('click.zoom',
						function (e) {
							if (clicked) {
								stop();
							} else {
								start(e);
							}
							clicked = !clicked;
						}
					);
				} else if (settings.on === 'mouseover') {
					zoom.init(); // Preemptively call init because IE7 will fire the mousemove handler before the hover handler.

					$source
						.on('mouseenter.zoom', start)
						.on('mouseleave.zoom', stop)
						.on(mousemove, zoom.move);
				}

				// Touch fallback
				if (settings.touch) {
					$source
						.on('touchstart.zoom', function (e) {
							e.preventDefault();
							if (touched) {
								touched = false;
								stop();
							} else {
								touched = true;
								start( e.originalEvent.touches[0] || e.originalEvent.changedTouches[0] );
							}
						})
						.on('touchmove.zoom', function (e) {
							e.preventDefault();
							zoom.move( e.originalEvent.touches[0] || e.originalEvent.changedTouches[0] );
						})
						.on('touchend.zoom', function (e) {
							e.preventDefault();
							if (touched) {
								touched = false;
								stop();
							}
						});
				}
				
				if ($.isFunction(settings.callback)) {
					settings.callback.call(img);
				}
			};

			img.setAttribute('role', 'presentation');
			img.src = settings.url;
			img.title=title;
			img.alt=title;
		});
	};

	$.fn.zoom.defaults = defaults;
}(window.jQuery));

/*JS Lint helpers: */
/*global dragMove: false, dragEnd: false, $, jQuery, alert, window, document */
/*jslint nomen: true, continue:true */



/*
    MODIFIED!
*/


if (typeof Object.create !== "function") {
    Object.create = function (obj) {
        function F() {}
        F.prototype = obj;
        return new F();
    };
}
(function ($, window, document) {

    var Carousel = {
        init : function (options, el) {
            var base = this;

            base.$elem = $(el);
            base.options = $.extend({}, $.fn.owlCarousel.options, base.$elem.data(), options);

            base.userOptions = options;
            base.loadContent();
        },

        loadContent : function () {
            var base = this, url;

            function getData(data) {
                var i, content = "";
                if (typeof base.options.jsonSuccess === "function") {
                    base.options.jsonSuccess.apply(this, [data]);
                } else {
                    for (i in data.owl) {
                        if (data.owl.hasOwnProperty(i)) {
                            content += data.owl[i].item;
                        }
                    }
                    base.$elem.html(content);
                }
                base.logIn();
            }

            if (typeof base.options.beforeInit === "function") {
                base.options.beforeInit.apply(this, [base.$elem]);
            }

            if (typeof base.options.jsonPath === "string") {
                url = base.options.jsonPath;
                $.getJSON(url, getData);
            } else {
                base.logIn();
            }
        },

        logIn : function () {
            var base = this;

            base.$elem.data({
                "owl-originalStyles": base.$elem.attr("style"),
                "owl-originalClasses": base.$elem.attr("class")
            });

            base.$elem.css({opacity: 0});
            base.orignalItems = base.options.items;
            base.checkBrowser();
            base.wrapperWidth = 0;
            base.checkVisible = null;
            base.setVars();
        },

        setVars : function () {
            var base = this;
            if (base.$elem.children().length === 0) {return false; }
            base.baseClass();
            base.eventTypes();
            base.$userItems = base.$elem.children();
            base.itemsAmount = base.$userItems.length;
            base.wrapItems();
            base.$owlItems = base.$elem.find(".owl-item");
            base.$owlWrapper = base.$elem.find(".owl-wrapper");
            base.playDirection = "next";
            base.prevItem = 0;
            base.prevArr = [0];
            base.currentItem = 0;
            base.customEvents();
            base.onStartup();
        },

        onStartup : function () {
            var base = this;
            base.updateItems();
            base.calculateAll();
            base.buildControls();
            base.updateControls();
            base.response();
            base.moveEvents();
            base.stopOnHover();
            base.owlStatus();

            if (base.options.transitionStyle !== false) {
                base.transitionTypes(base.options.transitionStyle);
            }
            if (base.options.autoPlay === true) {
                base.options.autoPlay = 5000;
            }
            base.play();

            base.$elem.find(".owl-wrapper").css("display", "block");

            if (!base.$elem.is(":visible")) {
                base.watchVisibility();
            } else {
                base.$elem.css("opacity", 1);
            }
            base.onstartup = false;
            base.eachMoveUpdate();
            if (typeof base.options.afterInit === "function") {
                base.options.afterInit.apply(this, [base.$elem]);
            }
        },

        eachMoveUpdate : function () {
            var base = this;

            if (base.options.lazyLoad === true) {
                base.lazyLoad();
            }
            if (base.options.autoHeight === true) {
                base.autoHeight();
            }
            base.onVisibleItems();

            if (typeof base.options.afterAction === "function") {
                base.options.afterAction.apply(this, [base.$elem]);
            }
        },

        updateVars : function () {
            var base = this;
            if (typeof base.options.beforeUpdate === "function") {
                base.options.beforeUpdate.apply(this, [base.$elem]);
            }
            base.watchVisibility();
            base.updateItems();
            base.calculateAll();
            base.updatePosition();
            base.updateControls();
            base.eachMoveUpdate();
            if (typeof base.options.afterUpdate === "function") {
                base.options.afterUpdate.apply(this, [base.$elem]);
            }
        },

        reload : function () {
            var base = this;
            window.setTimeout(function () {
                base.updateVars();
            }, 0);
        },

        watchVisibility : function () {
            var base = this;

            if (base.$elem.is(":visible") === false) {
                base.$elem.css({opacity: 0});
                window.clearInterval(base.autoPlayInterval);
                window.clearInterval(base.checkVisible);
            } else {
                return false;
            }
            base.checkVisible = window.setInterval(function () {
                if (base.$elem.is(":visible")) {
                    base.reload();
                    base.$elem.animate({opacity: 1}, 200);
                    window.clearInterval(base.checkVisible);
                }
            }, 500);
        },

        wrapItems : function () {
            var base = this;
            base.$userItems.wrapAll("<div class=\"owl-wrapper\">").wrap("<div class=\"owl-item\"></div>");
            base.$elem.find(".owl-wrapper").wrap("<div class=\"owl-wrapper-outer\">");
            base.wrapperOuter = base.$elem.find(".owl-wrapper-outer");
            base.$elem.css("display", "block");
        },

        baseClass : function () {
            var base = this,
                hasBaseClass = base.$elem.hasClass(base.options.baseClass),
                hasThemeClass = base.$elem.hasClass(base.options.theme);

            if (!hasBaseClass) {
                base.$elem.addClass(base.options.baseClass);
            }

            if (!hasThemeClass) {
                base.$elem.addClass(base.options.theme);
            }
        },

        updateItems : function () {
            var base = this, width, i;

            if (base.options.responsive === false) {
                return false;
            }
            if (base.options.singleItem === true) {
                base.options.items = base.orignalItems = 1;
                base.options.itemsCustom = false;
                base.options.itemsDesktop = false;
                base.options.itemsDesktopSmall = false;
                base.options.itemsTablet = false;
                base.options.itemsTabletSmall = false;
                base.options.itemsMobile = false;
                return false;
            }

            width = $(base.options.responsiveBaseWidth).width();

            if (width > (base.options.itemsDesktop[0] || base.orignalItems)) {
                base.options.items = base.orignalItems;
            }
            if (base.options.itemsCustom !== false) {
                //Reorder array by screen size
                base.options.itemsCustom.sort(function (a, b) {return a[0] - b[0]; });

                for (i = 0; i < base.options.itemsCustom.length; i += 1) {
                    if (base.options.itemsCustom[i][0] <= width) {
                        base.options.items = base.options.itemsCustom[i][1];
                    }
                }

            } else {

                if (width <= base.options.itemsDesktop[0] && base.options.itemsDesktop !== false) {
                    base.options.items = base.options.itemsDesktop[1];
                }

                if (width <= base.options.itemsDesktopSmall[0] && base.options.itemsDesktopSmall !== false) {
                    base.options.items = base.options.itemsDesktopSmall[1];
                }

                if (width <= base.options.itemsTablet[0] && base.options.itemsTablet !== false) {
                    base.options.items = base.options.itemsTablet[1];
                }

                if (width <= base.options.itemsTabletSmall[0] && base.options.itemsTabletSmall !== false) {
                    base.options.items = base.options.itemsTabletSmall[1];
                }

                if (width <= base.options.itemsMobile[0] && base.options.itemsMobile !== false) {
                    base.options.items = base.options.itemsMobile[1];
                }
            }

            //if number of items is less than declared
            if (base.options.items > base.itemsAmount && base.options.itemsScaleUp === true) {
                base.options.items = base.itemsAmount;
            }
        },

        response : function () {
            var base = this,
                smallDelay,
                lastWindowWidth;

            if (base.options.responsive !== true) {
                return false;
            }
            lastWindowWidth = $(window).width();

            base.resizer = function () {
                if ($(window).width() !== lastWindowWidth) {
                    if (base.options.autoPlay !== false) {
                        window.clearInterval(base.autoPlayInterval);
                    }
                    window.clearTimeout(smallDelay);
                    smallDelay = window.setTimeout(function () {
                        lastWindowWidth = $(window).width();
                        base.updateVars();
                    }, base.options.responsiveRefreshRate);
                }
            };
            $(window).resize(base.resizer);
        },

        updatePosition : function () {
            var base = this;
            base.jumpTo(base.currentItem);
            if (base.options.autoPlay !== false) {
                base.checkAp();
            }
        },

        appendItemsSizes : function () {
            var base = this,
                roundPages = 0,
                lastItem = base.itemsAmount - base.options.items;
				if($(window).width() <= 639 && base.options.pdpImageCarousel === true){
						base.$owlItems.each(function (index) {
		                var $this = $(this);
		                $this
		                    .css({"width": 300})
		                    .data("owl-item", Number(index));
		
		                if (index % base.options.items === 0 || index === lastItem) {
		                    if (!(index > lastItem)) {
		                        roundPages += 1;
		                    }
		                }
		                $this.data("owl-roundPages", roundPages);
		            	});
				}else{
						base.$owlItems.each(function (index) {
		                var $this = $(this);
		                $this
		                    .css({"width": base.itemWidth})
		                    .data("owl-item", Number(index));
		
		                if (index % base.options.items === 0 || index === lastItem) {
		                    if (!(index > lastItem)) {
		                        roundPages += 1;
		                    }
		                }
		                $this.data("owl-roundPages", roundPages);
		            	});
				}
        },

        appendWrapperSizes : function () {
            var base = this,
                width = base.$owlItems.length * base.itemWidth;

            base.$owlWrapper.css({
                "width": width * 2,
                "left": 0
            });
            base.appendItemsSizes();
        },

        calculateAll : function () {
            var base = this;
            base.calculateWidth();
            base.appendWrapperSizes();
            base.loops();
            base.max();
        },

        calculateWidth : function () {
            var base = this;
            base.itemWidth = Math.round(base.$elem.width() / base.options.items);
            if($(window).width() <= 639 && base.options.pdpImageCarousel === true){
				base.itemWidth = 312;

			}
        },

        max : function () {
            var base = this,
                maximum = ((base.itemsAmount * base.itemWidth) - base.options.items * base.itemWidth) * -1;
            if (base.options.items > base.itemsAmount) {
                base.maximumItem = 0;
                maximum = 0;
                base.maximumPixels = 0;
            } else {
                base.maximumItem = base.itemsAmount - base.options.items;
                base.maximumPixels = maximum;
            }
            return maximum;
        },

        min : function () {
            return 0;
        },

        loops : function () {
            var base = this,
                prev = 0,
                elWidth = 0,
                i,
                item,
                roundPageNum;

            base.positionsInArray = [0];
            base.pagesInArray = [];

            for (i = 0; i < base.itemsAmount; i += 1) {
                elWidth += base.itemWidth;
                base.positionsInArray.push(-elWidth);

                if (base.options.scrollPerPage === true) {
                    item = $(base.$owlItems[i]);
                    roundPageNum = item.data("owl-roundPages");
                    if (roundPageNum !== prev) {
                        base.pagesInArray[prev] = base.positionsInArray[i];
                        prev = roundPageNum;
                    }
                }
            }
        },

        buildControls : function () {
            var base = this;
            if (base.options.navigation === true || base.options.pagination === true) {
                base.owlControls = $("<div class=\"owl-controls\"/>").toggleClass("clickable", !base.browser.isTouch).appendTo(base.$elem);
            }
            if (base.options.pagination === true) {
                base.buildPagination();
            }
            if (base.options.navigation === true) {
                base.buildButtons();
            }
        },

        buildButtons : function () {
            var base = this,
                buttonsWrapper = $("<div class=\"owl-buttons\"/>");
            base.owlControls.append(buttonsWrapper);

            base.buttonPrev = $("<div/>", {
                "class" : "owl-prev",
                "html" : base.options.navigationText[0] || ""
            });

            base.buttonNext = $("<div/>", {
                "class" : "owl-next",
                "html" : base.options.navigationText[1] || ""
            });

            buttonsWrapper
                .append(base.buttonPrev)
                .append(base.buttonNext);

            buttonsWrapper.on("touchstart.owlControls mousedown.owlControls", "div[class^=\"owl\"]", function (event) {
                event.preventDefault();
            });

            buttonsWrapper.on("touchend.owlControls mouseup.owlControls", "div[class^=\"owl\"]", function (event) {
                event.preventDefault();
                if ($(this).hasClass("owl-next")) {
                    base.next();
                } else {
                    base.prev();
                }
            });
        },

        buildPagination : function () {
            var base = this;

            base.paginationWrapper = $("<div class=\"owl-pagination\"/>");
            base.owlControls.append(base.paginationWrapper);

            base.paginationWrapper.on("touchend.owlControls mouseup.owlControls", ".owl-page", function (event) {
                event.preventDefault();
                if (Number($(this).data("owl-page")) !== base.currentItem) {
                    base.goTo(Number($(this).data("owl-page")), true);
                }
            });
        },

        updatePagination : function () {
            var base = this,
                counter,
                lastPage,
                lastItem,
                i,
                paginationButton,
                paginationButtonInner;

            if (base.options.pagination === false) {
                return false;
            }

            base.paginationWrapper.html("");

            counter = 0;
            lastPage = base.itemsAmount - base.itemsAmount % base.options.items;

            for (i = 0; i < base.itemsAmount; i += 1) {
                if (i % base.options.items === 0) {
                    counter += 1;
                    if (lastPage === i) {
                        lastItem = base.itemsAmount - base.options.items;
                    }
                    paginationButton = $("<div/>", {
                        "class" : "owl-page"
                    });
                    paginationButtonInner = $("<span></span>", {
                        "text": base.options.paginationNumbers === true ? counter : "",
                        "class": base.options.paginationNumbers === true ? "owl-numbers" : ""
                    });
                    paginationButton.append(paginationButtonInner);

                    paginationButton.data("owl-page", lastPage === i ? lastItem : i);
                    paginationButton.data("owl-roundPages", counter);

                    base.paginationWrapper.append(paginationButton);
                }
            }
            base.checkPagination();
        },
        checkPagination : function () {
            var base = this;
            if (base.options.pagination === false) {
                return false;
            }
			if ($(window).width() <= 639 && base.options.pdpImageCarousel === true) {
				base.paginationWrapper.find(".owl-page").each(function() {
					if ($(this).data("owl-roundPages") === $(base.$owlItems[base.currentItem]).data("owl-roundPages")) {
						if ($(base.$owlItems[base.currentItem]).data("owl-roundPages") === 1) {
							base.paginationWrapper
								.find(".owl-page")
								.removeClass("active");
							$(this).addClass("active");
						} else {
							if (base.newPosX < (base.positionsInArray[($(this).data("owl-roundPages"))-1] + 100)) {
								base.paginationWrapper
									.find(".owl-page")
									.removeClass("active");
								$(this).addClass("active");
							}
						}
					}
				});
			}
			else {
				base.paginationWrapper.find(".owl-page").each(function() {
					if ($(this).data("owl-roundPages") === $(base.$owlItems[base.currentItem]).data("owl-roundPages")) {
						base.paginationWrapper
							.find(".owl-page")
							.removeClass("active");
						$(this).addClass("active");
					}
				});
			} 
        },

        checkNavigation : function () {
            var base = this;

            if (base.options.navigation === false) {
                return false;
            }
            if (base.options.rewindNav === false) {
                if (base.currentItem === 0 && base.maximumItem === 0) {
                    base.buttonPrev.addClass("disabled");
                    base.buttonNext.addClass("disabled");
                } else if (base.currentItem === 0 && base.maximumItem !== 0) {
                    base.buttonPrev.addClass("disabled");
                    base.buttonNext.removeClass("disabled");
                } else if (base.currentItem === base.maximumItem) {
                    base.buttonPrev.removeClass("disabled");
                    base.buttonNext.addClass("disabled");
                } else if (base.currentItem !== 0 && base.currentItem !== base.maximumItem) {
                    base.buttonPrev.removeClass("disabled");
                    base.buttonNext.removeClass("disabled");
                }
            }
        },

        updateControls : function () {
            var base = this;
            base.updatePagination();
            base.checkNavigation();
            if (base.owlControls) {
                if (base.options.items >= base.itemsAmount) {
                    base.owlControls.hide();
                } else {
                    base.owlControls.show();
                }
            }
        },

        destroyControls : function () {
            var base = this;
            if (base.owlControls) {
                base.owlControls.remove();
            }
        },

        next : function (speed) {
            var base = this;

            if (base.isTransition) {
                return false;
            }

            base.currentItem += base.options.scrollPerPage === true ? base.options.items : 1;
            if (base.currentItem > base.maximumItem + (base.options.scrollPerPage === true ? (base.options.items - 1) : 0)) {
                if (base.options.rewindNav === true) {
                    base.currentItem = 0;
                    speed = "rewind";
                } else {
                    base.currentItem = base.maximumItem;
                    return false;
                }
            }
            base.goTo(base.currentItem, speed);
        },

        prev : function (speed) {
            var base = this;

            if (base.isTransition) {
                return false;
            }

            if (base.options.scrollPerPage === true && base.currentItem > 0 && base.currentItem < base.options.items) {
                base.currentItem = 0;
            } else {
                base.currentItem -= base.options.scrollPerPage === true ? base.options.items : 1;
            }
            if (base.currentItem < 0) {
                if (base.options.rewindNav === true) {
                    base.currentItem = base.maximumItem;
                    speed = "rewind";
                } else {
                    base.currentItem = 0;
                    return false;
                }
            }
            base.goTo(base.currentItem, speed);
        },

        goTo : function (position, speed, drag) {
            var base = this,
                goToPixel;

            if (base.isTransition) {
                return false;
            }
            if (typeof base.options.beforeMove === "function") {
                base.options.beforeMove.apply(this, [base.$elem]);
            }
            if (position >= base.maximumItem) {
                position = base.maximumItem;
            } else if (position <= 0) {
                position = 0;
            }

            base.currentItem = base.owl.currentItem = position;
            if (base.options.transitionStyle !== false && drag !== "drag" && base.options.items === 1 && base.browser.support3d === true) {
                base.swapSpeed(0);
                if (base.browser.support3d === true) {
                    base.transition3d(base.positionsInArray[position]);
                } else {
                    base.css2slide(base.positionsInArray[position], 1);
                }
                base.afterGo();
                base.singleItemTransition();
                return false;
            }
            goToPixel = base.positionsInArray[position];
            if (base.browser.support3d === true) {
                base.isCss3Finish = false;

                if (speed === true) {
                    base.swapSpeed("paginationSpeed");
                    window.setTimeout(function () {
                        base.isCss3Finish = true;
                    }, base.options.paginationSpeed);

                } else if (speed === "rewind") {
                    base.swapSpeed(base.options.rewindSpeed);
                    window.setTimeout(function () {
                        base.isCss3Finish = true;
                    }, base.options.rewindSpeed);

                } else {
                    base.swapSpeed("slideSpeed");
                    window.setTimeout(function () {
                        base.isCss3Finish = true;
                    }, base.options.slideSpeed);
                }
                base.transition3d(goToPixel);
            } else {
                if (speed === true) {
                    base.css2slide(goToPixel, base.options.paginationSpeed);
                } else if (speed === "rewind") {
                    base.css2slide(goToPixel, base.options.rewindSpeed);
                } else {
                    base.css2slide(goToPixel, base.options.slideSpeed);
                }
            }
            if($(window).width() <= 639 && base.options.pdpImageCarousel === true){
           		 base.newPosX = base.positionsInArray[position];
           	}
            base.afterGo();
        },

        jumpTo : function (position) {
            var base = this;
            if (typeof base.options.beforeMove === "function") {
                base.options.beforeMove.apply(this, [base.$elem]);
            }
            if (position >= base.maximumItem || position === -1) {
                position = base.maximumItem;
            } else if (position <= 0) {
                position = 0;
            }
            base.swapSpeed(0);
            if (base.browser.support3d === true) {
                base.transition3d(base.positionsInArray[position]);
            } else {
                base.css2slide(base.positionsInArray[position], 1);
            }
            base.currentItem = base.owl.currentItem = position;
            base.afterGo();
        },

        afterGo : function () {
            var base = this;

            base.prevArr.push(base.currentItem);
            base.prevItem = base.owl.prevItem = base.prevArr[base.prevArr.length - 2];
            base.prevArr.shift(0);

            if (base.prevItem !== base.currentItem) {
                base.checkPagination();
                base.checkNavigation();
                base.eachMoveUpdate();

                if (base.options.autoPlay !== false) {
                    base.checkAp();
                }
            }
            if (typeof base.options.afterMove === "function" && base.prevItem !== base.currentItem) {
                base.options.afterMove.apply(this, [base.$elem]);
            }
        },

        stop : function () {
            var base = this;
            base.apStatus = "stop";
            window.clearInterval(base.autoPlayInterval);
        },


        dragging : function (bool) {
            var base = this;
            base.options.dragging = bool;
            
        },


        checkAp : function () {
            var base = this;
            if (base.apStatus !== "stop") {
                base.play();
            }
        },

        play : function () {
            var base = this;
            base.apStatus = "play";
            if (base.options.autoPlay === false) {
                return false;
            }
            window.clearInterval(base.autoPlayInterval);
            base.autoPlayInterval = window.setInterval(function () {
                base.next(true);
            }, base.options.autoPlay);
        },

        swapSpeed : function (action) {
            var base = this;
            if (action === "slideSpeed") {
                base.$owlWrapper.css(base.addCssSpeed(base.options.slideSpeed));
            } else if (action === "paginationSpeed") {
                base.$owlWrapper.css(base.addCssSpeed(base.options.paginationSpeed));
            } else if (typeof action !== "string") {
                base.$owlWrapper.css(base.addCssSpeed(action));
            }
        },

        addCssSpeed : function (speed) {
            return {
                "-webkit-transition": "all " + speed + "ms ease",
                "-moz-transition": "all " + speed + "ms ease",
                "-o-transition": "all " + speed + "ms ease",
                "transition": "all " + speed + "ms ease"
            };
        },

        removeTransition : function () {
            return {
                "-webkit-transition": "",
                "-moz-transition": "",
                "-o-transition": "",
                "transition": ""
            };
        },

        doTranslate : function (pixels) {
            return {
                "-webkit-transform": "translate3d(" + pixels + "px, 0px, 0px)",
                "-moz-transform": "translate3d(" + pixels + "px, 0px, 0px)",
                "-o-transform": "translate3d(" + pixels + "px, 0px, 0px)",
                "-ms-transform": "translate3d(" + pixels + "px, 0px, 0px)",
                "transform": "translate3d(" + pixels + "px, 0px,0px)"
            };
        },

        transition3d : function (value) {
            var base = this;
            base.$owlWrapper.css(base.doTranslate(value));
        },

        css2move : function (value) {
            var base = this;
            base.$owlWrapper.css({"left" : value});
        },

        css2slide : function (value, speed) {
            var base = this;

            base.isCssFinish = false;
            base.$owlWrapper.stop(true, true).animate({
                "left" : value
            }, {
                duration : speed || base.options.slideSpeed,
                complete : function () {
                    base.isCssFinish = true;
                }
            });
        },

        checkBrowser : function () {
            var base = this,
                translate3D = "translate3d(0px, 0px, 0px)",
                tempElem = document.createElement("div"),
                regex,
                asSupport,
                support3d,
                isTouch;

            tempElem.style.cssText = "  -moz-transform:" + translate3D +
                                  "; -ms-transform:"     + translate3D +
                                  "; -o-transform:"      + translate3D +
                                  "; -webkit-transform:" + translate3D +
                                  "; transform:"         + translate3D;
            regex = /translate3d\(0px, 0px, 0px\)/g;
            asSupport = tempElem.style.cssText.match(regex);
            support3d = (asSupport !== null && asSupport.length === 1);

            isTouch = "ontouchstart" in window || window.navigator.msMaxTouchPoints;

            base.browser = {
                "support3d" : support3d,
                "isTouch" : isTouch
            };
        },

        moveEvents : function () {
            var base = this;
            if (base.options.mouseDrag !== false || base.options.touchDrag !== false) {
                base.gestures();
                base.disabledEvents();
            }
        },

        eventTypes : function () {
            var base = this,
                types = ["s", "e", "x"];

            base.ev_types = {};

            if (base.options.mouseDrag === true && base.options.touchDrag === true) {
                types = [
                    "touchstart.owl mousedown.owl",
                    "touchmove.owl mousemove.owl",
                    "touchend.owl touchcancel.owl mouseup.owl"
                ];
            } else if (base.options.mouseDrag === false && base.options.touchDrag === true) {
                types = [
                    "touchstart.owl",
                    "touchmove.owl",
                    "touchend.owl touchcancel.owl"
                ];
            } else if (base.options.mouseDrag === true && base.options.touchDrag === false) {
                types = [
                    "mousedown.owl",
                    "mousemove.owl",
                    "mouseup.owl"
                ];
            }

            base.ev_types.start = types[0];
            base.ev_types.move = types[1];
            base.ev_types.end = types[2];
        },

        disabledEvents :  function () {
            var base = this;
            base.$elem.on("dragstart.owl", function (event) { event.preventDefault(); });
            base.$elem.on("mousedown.disableTextSelect", function (e) {
                return $(e.target).is('input, textarea, select, option');
            });
        },

        gestures : function () {
            /*jslint unparam: true*/
            var base = this,
                locals = {
                    offsetX : 0,
                    offsetY : 0,
                    baseElWidth : 0,
                    relativePos : 0,
                    position: null,
                    minSwipe : null,
                    maxSwipe: null,
                    sliding : null,
                    dargging: null,
                    targetElement : null
                };

            base.isCssFinish = true;

            function getTouches(event) {
                if (event.touches !== undefined) {
                    return {
                        x : event.touches[0].pageX,
                        y : event.touches[0].pageY
                    };
                }

                if (event.touches === undefined) {
                    if (event.pageX !== undefined) {
                        return {
                            x : event.pageX,
                            y : event.pageY
                        };
                    }
                    if (event.pageX === undefined) {
                        return {
                            x : event.clientX,
                            y : event.clientY
                        };
                    }
                }
            }

            function swapEvents(type) {
                if (type === "on") {
                    $(document).on(base.ev_types.move, dragMove);
                    $(document).on(base.ev_types.end, dragEnd);
                } else if (type === "off") {
                    $(document).off(base.ev_types.move);
                    $(document).off(base.ev_types.end);
                }
            }

            function dragStart(event) {
                var ev = event.originalEvent || event || window.event,
                    position;


                
                if(!base.options.dragging){
                	return;
                }

                if (ev.which === 3) {
                    return false;
                }
                if (base.itemsAmount <= base.options.items) {
                    return;
                }
                if (base.isCssFinish === false && !base.options.dragBeforeAnimFinish) {
                    return false;
                }
                if (base.isCss3Finish === false && !base.options.dragBeforeAnimFinish) {
                    return false;
                }

                if (base.options.autoPlay !== false) {
                    window.clearInterval(base.autoPlayInterval);
                }

                if (base.browser.isTouch !== true && !base.$owlWrapper.hasClass("grabbing")) {
                    base.$owlWrapper.addClass("grabbing");
                }

                base.newPosX = 0;
                base.newRelativeX = 0;

                $(this).css(base.removeTransition());

                position = $(this).position();
                locals.relativePos = position.left;

                locals.offsetX = getTouches(ev).x - position.left;
                locals.offsetY = getTouches(ev).y - position.top;

                swapEvents("on");

                locals.sliding = false;
                locals.targetElement = ev.target || ev.srcElement;
            }

            function dragMove(event) {

            	 if(!base.options.dragging){
                	return;
                }

                var ev = event.originalEvent || event || window.event,
                    minSwipe,
                    maxSwipe;

                base.newPosX = getTouches(ev).x - locals.offsetX;
                base.newPosY = getTouches(ev).y - locals.offsetY;
                base.newRelativeX = base.newPosX - locals.relativePos;

              

                if (typeof base.options.startDragging === "function" && locals.dragging !== true && base.newRelativeX !== 0) {
                    locals.dragging = true;
                  	base.options.startDragging.apply(base, [base.$elem]);
                  	
                }


                if ((base.newRelativeX > 8 || base.newRelativeX < -8) && (base.browser.isTouch === true)) {
                    if (ev.preventDefault !== undefined) {
                        ev.preventDefault();
                    } else {
                        ev.returnValue = false;
                    }
                    locals.sliding = true;
                }

                if ((base.newPosY > 10 || base.newPosY < -10) && locals.sliding === false) {
                    $(document).off("touchmove.owl");
                }

                minSwipe = function () {
                    return base.newRelativeX / 5;
                };

                maxSwipe = function () {
                    return base.maximumPixels + base.newRelativeX / 5;
                };
				if($(window).width() <= 639 && base.options.pdpImageCarousel === true){
					if(base.newPosX > 0){
						base.newPosX = 0;
					}
					if(base.newPosX < base.maximumPixels){
						base.newPosX = base.maximumPixels;
					}
					base.checkPagination();
				}else{
					base.newPosX = Math.max(Math.min(base.newPosX, minSwipe()), maxSwipe());
				}
                if (base.browser.support3d === true) {
                    base.transition3d(base.newPosX);
                } else {
                    base.css2move(base.newPosX);
                }
            }

            function dragEnd(event) {
                var ev = event.originalEvent || event || window.event,
                    newPosition,
                    handlers,
                    owlStopEvent;

                ev.target = ev.target || ev.srcElement;

                locals.dragging = false;

                if (base.browser.isTouch !== true) {
                    base.$owlWrapper.removeClass("grabbing");
                }

                if (base.newRelativeX < 50) {
                    base.dragDirection = base.owl.dragDirection = "left";
                } else {
                    base.dragDirection = base.owl.dragDirection = "right";
                }

                if (base.newRelativeX !== 0) {
                    newPosition = base.getNewPosition();
                    if($(window).width() <= 639 && base.options.pdpImageCarousel === true){
                    	base.afterGo();
                    }else{
						base.goTo(newPosition, false, "drag");
					}
                    if (locals.targetElement === ev.target && base.browser.isTouch !== true) {
                        $(ev.target).on("click.disable", function (ev) {
                            ev.stopImmediatePropagation();
                            ev.stopPropagation();
                            ev.preventDefault();
                            $(ev.target).off("click.disable");
                        });
                        handlers = $._data(ev.target, "events").click;
                        owlStopEvent = handlers.pop();
                        handlers.splice(0, 0, owlStopEvent);
                    }
                }
                swapEvents("off");
            }
            base.$elem.on(base.ev_types.start, ".owl-wrapper", dragStart);
        },

        getNewPosition : function () {
            var base = this,
                newPosition = base.closestItem();

            if (newPosition > base.maximumItem) {
                base.currentItem = base.maximumItem;
                newPosition  = base.maximumItem;
            } else if (base.newPosX >= 0) {
                newPosition = 0;
                base.currentItem = 0;
            }
            return newPosition;
        },
        closestItem : function () {
            var base = this,
                array = base.options.scrollPerPage === true ? base.pagesInArray : base.positionsInArray,
                goal = base.newPosX,
                closest = null;

            $.each(array, function (i, v) {
                if (goal - (base.itemWidth / 20) > array[i + 1] && goal - (base.itemWidth / 20) < v && base.moveDirection() === "left") {
                    closest = v;
                    if (base.options.scrollPerPage === true) {
                        base.currentItem = $.inArray(closest, base.positionsInArray);
                    } else {
                        base.currentItem = i;
                    }
                } else if (goal + (base.itemWidth / 20) < v && goal + (base.itemWidth / 20) > (array[i + 1] || array[i] - base.itemWidth) && base.moveDirection() === "right") {
                    if (base.options.scrollPerPage === true) {
                        closest = array[i + 1] || array[array.length - 1];
                        base.currentItem = $.inArray(closest, base.positionsInArray);
                    } else {
                        closest = array[i + 1];
                        base.currentItem = i + 1;
                    }
                }
            });
            return base.currentItem;
        },

        moveDirection : function () {
            var base = this,
                direction;
            if (base.newRelativeX < 0) {
                direction = "right";
                base.playDirection = "next";
            } else {
                direction = "left";
                base.playDirection = "prev";
            }
            return direction;
        },

        customEvents : function () {
            /*jslint unparam: true*/
            var base = this;
            base.$elem.on("owl.next", function () {
                base.next();
            });
            base.$elem.on("owl.prev", function () {
                base.prev();
            });
            base.$elem.on("owl.play", function (event, speed) {
                base.options.autoPlay = speed;
                base.play();
                base.hoverStatus = "play";
            });
            base.$elem.on("owl.stop", function () {
                base.stop();
                base.hoverStatus = "stop";
            });
            base.$elem.on("owl.goTo", function (event, item) {
                base.goTo(item);
            });
            base.$elem.on("owl.jumpTo", function (event, item) {
                base.jumpTo(item);
            });

             base.$elem.on("owl.dragging", function (event, item) {
                base.dragging(item);
            });
        },

        stopOnHover : function () {
            var base = this;
            if (base.options.stopOnHover === true && base.browser.isTouch !== true && base.options.autoPlay !== false) {
                base.$elem.on("mouseover", function () {
                    base.stop();
                });
                base.$elem.on("mouseout", function () {
                    if (base.hoverStatus !== "stop") {
                        base.play();
                    }
                });
            }
        },

        lazyLoad : function () {
            var base = this,
                i,
                $item,
                itemNumber,
                $lazyImg,
                follow;

            if (base.options.lazyLoad === false) {
                return false;
            }
            for (i = 0; i < base.itemsAmount; i += 1) {
                $item = $(base.$owlItems[i]);

                if ($item.data("owl-loaded") === "loaded") {
                    continue;
                }

                itemNumber = $item.data("owl-item");
                $lazyImg = $item.find(".lazyOwl");

                if (typeof $lazyImg.data("src") !== "string") {
                    $item.data("owl-loaded", "loaded");
                    continue;
                }
                if ($item.data("owl-loaded") === undefined) {
                    $lazyImg.hide();
                    $item.addClass("loading").data("owl-loaded", "checked");
                }
                if (base.options.lazyFollow === true) {
                    follow = itemNumber >= base.currentItem;
                } else {
                    follow = true;
                }
                if($(window).width() <= 639 && base.options.pdpImageCarousel === true){
					if (follow && itemNumber < base.currentItem + 2 && $lazyImg.length) {
	                    $lazyImg.each(function() {
	                        base.lazyPreload($item, $(this));
	                    });
                	}
				}else{
					if (follow && itemNumber < base.currentItem + base.options.items && $lazyImg.length) {
	                    $lazyImg.each(function() {
	                        base.lazyPreload($item, $(this));
	                    });
                	}
				}
            }
        },

        lazyPreload : function ($item, $lazyImg) {
            var base = this,
                iterations = 0,
                isBackgroundImg;

            if ($lazyImg.prop("tagName") === "DIV") {
                $lazyImg.css("background-image", "url(" + $lazyImg.data("src") + ")");
                isBackgroundImg = true;
            } else {
                $lazyImg[0].src = $lazyImg.data("src");
            }

            function showImage() {
                $item.data("owl-loaded", "loaded").removeClass("loading");
                $lazyImg.removeAttr("data-src");
                if (base.options.lazyEffect === "fade") {
                    $lazyImg.fadeIn(400);
                } else {
                    $lazyImg.show();
                }
                if (typeof base.options.afterLazyLoad === "function") {
                    base.options.afterLazyLoad.apply(this, [base.$elem]);
                }
            }

            function checkLazyImage() {
                iterations += 1;
                if (base.completeImg($lazyImg.get(0)) || isBackgroundImg === true) {
                    showImage();
                } else if (iterations <= 100) {//if image loads in less than 10 seconds 
                    window.setTimeout(checkLazyImage, 100);
                } else {
                    showImage();
                }
            }

            checkLazyImage();
        },

        autoHeight : function () {
            var base = this,
                $currentimg = $(base.$owlItems[base.currentItem]).find("img"),
                iterations;

            function addHeight() {
                var $currentItem = $(base.$owlItems[base.currentItem]).height();
                base.wrapperOuter.css("height", $currentItem + "px");
                if (!base.wrapperOuter.hasClass("autoHeight")) {
                    window.setTimeout(function () {
                        base.wrapperOuter.addClass("autoHeight");
                    }, 0);
                }
            }

            function checkImage() {
                iterations += 1;
                if (base.completeImg($currentimg.get(0))) {
                    addHeight();
                } else if (iterations <= 100) { //if image loads in less than 10 seconds 
                    window.setTimeout(checkImage, 100);
                } else {
                    base.wrapperOuter.css("height", ""); //Else remove height attribute
                }
            }

            if ($currentimg.get(0) !== undefined) {
                iterations = 0;
                checkImage();
            } else {
                addHeight();
            }
        },

        completeImg : function (img) {
            var naturalWidthType;

            if (!img.complete) {
                return false;
            }
            naturalWidthType = typeof img.naturalWidth;
            if (naturalWidthType !== "undefined" && img.naturalWidth === 0) {
                return false;
            }
            return true;
        },

        onVisibleItems : function () {
            var base = this,
                i;

            if (base.options.addClassActive === true) {
                base.$owlItems.removeClass("active");
            }
            base.visibleItems = [];
            for (i = base.currentItem; i < base.currentItem + base.options.items; i += 1) {
                base.visibleItems.push(i);

                if (base.options.addClassActive === true) {
                    $(base.$owlItems[i]).addClass("active");
                }
            }
            base.owl.visibleItems = base.visibleItems;
        },

        transitionTypes : function (className) {
            var base = this;
            //Currently available: "fade", "backSlide", "goDown", "fadeUp"
            base.outClass = "owl-" + className + "-out";
            base.inClass = "owl-" + className + "-in";
        },

        singleItemTransition : function () {
            var base = this,
                outClass = base.outClass,
                inClass = base.inClass,
                $currentItem = base.$owlItems.eq(base.currentItem),
                $prevItem = base.$owlItems.eq(base.prevItem),
                prevPos = Math.abs(base.positionsInArray[base.currentItem]) + base.positionsInArray[base.prevItem],
                origin = Math.abs(base.positionsInArray[base.currentItem]) + base.itemWidth / 2,
                animEnd = 'webkitAnimationEnd oAnimationEnd MSAnimationEnd animationend';

            base.isTransition = true;

            base.$owlWrapper
                .addClass('owl-origin')
                .css({
                    "-webkit-transform-origin" : origin + "px",
                    "-moz-perspective-origin" : origin + "px",
                    "perspective-origin" : origin + "px"
                });
            function transStyles(prevPos) {
                return {
                    "position" : "relative",
                    "left" : prevPos + "px"
                };
            }

            $prevItem
                .css(transStyles(prevPos, 10))
                .addClass(outClass)
                .on(animEnd, function () {
                    base.endPrev = true;
                    $prevItem.off(animEnd);
                    base.clearTransStyle($prevItem, outClass);
                });

            $currentItem
                .addClass(inClass)
                .on(animEnd, function () {
                    base.endCurrent = true;
                    $currentItem.off(animEnd);
                    base.clearTransStyle($currentItem, inClass);
                });
        },

        clearTransStyle : function (item, classToRemove) {
            var base = this;
            item.css({
                "position" : "",
                "left" : ""
            }).removeClass(classToRemove);

            if (base.endPrev && base.endCurrent) {
                base.$owlWrapper.removeClass('owl-origin');
                base.endPrev = false;
                base.endCurrent = false;
                base.isTransition = false;
            }
        },

        owlStatus : function () {
            var base = this;
            base.owl = {
                "userOptions"   : base.userOptions,
                "baseElement"   : base.$elem,
                "userItems"     : base.$userItems,
                "owlItems"      : base.$owlItems,
                "currentItem"   : base.currentItem,
                "prevItem"      : base.prevItem,
                "visibleItems"  : base.visibleItems,
                "isTouch"       : base.browser.isTouch,
                "browser"       : base.browser,
                "dragDirection" : base.dragDirection
            };
        },

        clearEvents : function () {
            var base = this;
            base.$elem.off(".owl owl mousedown.disableTextSelect");
            $(document).off(".owl owl");
            $(window).off("resize", base.resizer);
        },

        unWrap : function () {
            var base = this;
            if (base.$elem.children().length !== 0) {
                base.$owlWrapper.unwrap();
                base.$userItems.unwrap().unwrap();
                if (base.owlControls) {
                    base.owlControls.remove();
                }
            }
            base.clearEvents();
            base.$elem.attr({
                style: base.$elem.data("owl-originalStyles") || "",
                class: base.$elem.data("owl-originalClasses")
            });
        },

        destroy : function () {
            var base = this;
            base.stop();
            window.clearInterval(base.checkVisible);
            base.unWrap();
            base.$elem.removeData();
        },

        reinit : function (newOptions) {
            var base = this,
                options = $.extend({}, base.userOptions, newOptions);
            base.unWrap();
            base.init(options, base.$elem);
        },

        addItem : function (htmlString, targetPosition) {
            var base = this,
                position;

            if (!htmlString) {return false; }

            if (base.$elem.children().length === 0) {
                base.$elem.append(htmlString);
                base.setVars();
                return false;
            }
            base.unWrap();
            if (targetPosition === undefined || targetPosition === -1) {
                position = -1;
            } else {
                position = targetPosition;
            }
            if (position >= base.$userItems.length || position === -1) {
                base.$userItems.eq(-1).after(htmlString);
            } else {
                base.$userItems.eq(position).before(htmlString);
            }

            base.setVars();
        },

        removeItem : function (targetPosition) {
            var base = this,
                position;

            if (base.$elem.children().length === 0) {
                return false;
            }
            if (targetPosition === undefined || targetPosition === -1) {
                position = -1;
            } else {
                position = targetPosition;
            }

            base.unWrap();
            base.$userItems.eq(position).remove();
            base.setVars();
        }

    };

    $.fn.owlCarousel = function (options) {
        return this.each(function () {
            if ($(this).data("owl-init") === true) {
                return false;
            }
            $(this).data("owl-init", true);
            var carousel = Object.create(Carousel);
            carousel.init(options, this);
            $.data(this, "owlCarousel", carousel);
        });
    };

    $.fn.owlCarousel.options = {

        items : 5,
        itemsCustom : false,
        itemsDesktop : [1199, 4],
        itemsDesktopSmall : [979, 3],
        itemsTablet : [768, 2],
        itemsTabletSmall : false,
        itemsMobile : [479, 1],
        singleItem : false,
        itemsScaleUp : false,

        slideSpeed : 200,
        paginationSpeed : 800,
        rewindSpeed : 1000,

        autoPlay : false,
        stopOnHover : false,

        navigation : false,
        navigationText : ["prev", "next"],
        rewindNav : true,
        scrollPerPage : false,

        pagination : true,
        paginationNumbers : false,

        responsive : true,
        responsiveRefreshRate : 200,
        responsiveBaseWidth : window,

        baseClass : "owl-carousel",
        theme : "owl-theme",

        lazyLoad : false,
        lazyFollow : true,
        lazyEffect : "fade",

        autoHeight : false,

        jsonPath : false,
        jsonSuccess : false,

        dragBeforeAnimFinish : true,
        mouseDrag : true,
        touchDrag : true,
        dragging: true,

        addClassActive : false,
        transitionStyle : false,

        beforeUpdate : false,
        afterUpdate : false,
        beforeInit : false,
        afterInit : false,
        beforeMove : false,
        afterMove : false,
        afterAction : false,
        startDragging : false,
        afterLazyLoad: false
    };
}(jQuery, window, document));

(function(a){var r=a.fn.domManip,d="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},f={},e,p={key:0,data:{}},i=0,c=0,l=[];function g(g,d,h,e){var c={data:e||(e===0||e===false)?e:d?d.data:{},_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};g&&a.extend(c,g,{nodes:[],parent:d});if(h){c.tmpl=h;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++i;(l.length?f:b)[i]=c}return c}a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a(i[h])[d](k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,m,k){if(d[0]&&a.isArray(d[0])){var g=a.makeArray(arguments),h=d[0],j=h.length,i=0,f;while(i<j&&!(f=a.data(h[i++],"tmplItem")));if(f&&c)g[2]=function(b){a.tmpl.afterManip(this,b,k)};r.apply(this,g)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var i,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(j(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h==="function")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);i=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(j(c,null,i)):i},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b==="string")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,"tmpl")||a.data(b,"tmpl",o(b.innerHTML));return typeof c==="string"?(a.template[c]=b):b}return c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function j(e,g,f){var b,c=f?a.map(f,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+e.key+'" $2'):a:j(a,e,a._ctnt)}):e;if(g)return c;c=c.join("");c.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=k(c).concat(b);if(d)b=b.concat(k(d))});return b?b:k(c)}function k(c){var b=document.createElement("div");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(m,l,k,g,b,c,d){var j=a.tmpl.tag[k],i,e,f;if(!j)throw"Unknown template tag: "+k;i=j._default||[];if(c&&!/\w$/.test(b)){b+=c;c=""}if(b){b=h(b);d=d?","+h(d)+")":c?")":"";e=c?b.indexOf(".")>-1?b+h(c):"("+b+").call($item"+d:b;f=c?e:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"}else f=e=i.$1||"null";g=h(g);return"');"+j[l?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(f).split("$1").join(e).split("$2").join(g||i.$2||"")+"__.push('"})+"');}return __;")}function n(c,b){c._wrap=j(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join("")}function h(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n="_"+c,k,j,l={},e,p,h;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName("*");for(h=j.length-1;h>=0;h--)m(j[h]);m(k)}function m(j){var p,h=j,k,e,m;if(m=j.getAttribute(d)){while(h.parentNode&&(h=h.parentNode).nodeType===1&&!(p=h.getAttribute(d)));if(p!==m){h=h.parentNode?h.nodeType===11?0:h.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[h]||f[h]);e.key=++i;b[i]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,"tmplItem"))){o(e.key);b[e.key]=e;h=a.data(j.parentNode,"tmplItem");h=h?h.key:0}if(e){k=e;while(k&&k.key!=h){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,"tmplItem",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(d||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery);


jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};



if(typeof Currency==="undefined"){var Currency={}}Currency.cookie={configuration:{expires:365,path:"/",domain:window.location.hostname},name:"currency",write:function(a){jQuery.cookie(this.name,a,this.configuration)},read:function(){return jQuery.cookie(this.name)},destroy:function(){jQuery.cookie(this.name,null,this.configuration)}};Currency.money_with_currency_format={USD:"${{amount}} USD",EUR:"&euro;{{amount}} EUR",GBP:"&pound;{{amount}} GBP",CAD:"${{amount}} CAD",ARS:"${{amount_with_comma_separator}} ARS",AUD:"${{amount}} AUD",BBD:"${{amount}} Bds",BDT:"Tk {{amount}} BDT",BSD:"BS${{amount}} BSD",BHD:"{{amount}}0 BHD",BRL:"R$ {{amount_with_comma_separator}} BRL",BOB:"Bs{{amount_with_comma_separator}} BOB",BND:"${{amount}} BND",BGN:"{{amount}}  BGN",MMK:"K{{amount}} MMK",KYD:"${{amount}} KYD",CLP:"${{amount_no_decimals}} CLP",CNY:"&#165;{{amount}} CNY",COP:"${{amount_with_comma_separator}} COP",CRC:"&#8353; {{amount_with_comma_separator}} CRC",HRK:"{{amount_with_comma_separator}} kn HRK",CZK:"{{amount_with_comma_separator}} K&#269;",DKK:"kr.{{amount_with_comma_separator}}",DOP:"RD$ {{amount_with_comma_separator}}",XCD:"EC${{amount}}",EGP:"LE {{amount}} EGP",XPF:"{{amount_no_decimals_with_space_separator}}} XPF",FJD:"FJ${{amount}}",GHS:"GH&#8373;{{amount}}",GTQ:"{{amount}} GTQ",GYD:"${{amount}} GYD",GEL:"{{amount}} GEL",HKD:"HK${{amount}}",HUF:"{{amount_no_decimals_with_comma_separator}} Ft",ISK:"{{amount_no_decimals}} kr ISK",INR:"Rs.{{amount}}",IDR:"Rp {{amount_with_comma_separator}}",NIS:"{{amount}} NIS",JMD:"${{amount}} JMD",JPY:"&#165;{{amount_no_decimals}} JPY",JOD:"{{amount}}0 JOD",KZT:"{{amount}} KZT",KES:"KSh{{amount}}",KWD:"{{amount}}0 KWD",LVL:"Ls {{amount}} LVL",LTL:"{{amount}} Lt",MXN:"$ {{amount}} MXN",MYR:"RM{{amount}} MYR",MUR:"Rs {{amount}} MUR",MDL:"{{amount}} MDL",MAD:"Dh {{amount}} MAD",MNT:"{{amount_no_decimals}} MNT",MZN:"Mt {{amount}} MZN",ANG:"{{amount}} NA&fnof;",NZD:"${{amount}} NZD",NGN:"&#8358;{{amount}} NGN",NOK:"kr {{amount_with_comma_separator}} NOK",OMR:"{{amount_with_comma_separator}} OMR",PKR:"Rs.{{amount}} PKR",PYG:"Gs. {{amount_no_decimals_with_comma_separator}} PYG",PEN:"S/. {{amount}} PEN",PHP:"&#8369;{{amount}} PHP",PLN:"{{amount_with_comma_separator}} zl PLN",QAR:"QAR {{amount_with_comma_separator}}",RON:"{{amount_with_comma_separator}} lei RON",RUB:"&#1088;&#1091;&#1073;{{amount_with_comma_separator}} RUB",SAR:"{{amount}} SAR",RSD:"{{amount}} RSD",SCR:"Rs {{amount}} SCR",SGD:"${{amount}} SGD",SYP:"S&pound;{{amount}} SYP",ZAR:"R {{amount}} ZAR",KRW:"&#8361;{{amount_no_decimals}} KRW",LKR:"Rs {{amount}} LKR",SEK:"{{amount_no_decimals}} kr SEK",CHF:"SFr. {{amount}} CHF",TWD:"${{amount}} TWD",THB:"{{amount}} &#xe3f; THB",TZS:"{{amount}} TZS",TTD:"${{amount}} TTD",TRY:"{{amount}}TL",UAH:"{{amount}} UAH",AED:"Dhs. {{amount}} AED",UYU:"${{amount_with_comma_separator}} UYU",VEB:"Bs. {{amount_with_comma_separator}} VEB",VND:"{{amount_no_decimals_with_comma_separator}} VND",ZMK:"ZMK{{amount_no_decimals_with_comma_separator}}"};Currency.money_format={USD:"${{amount}}",EUR:"&euro;{{amount}}",GBP:"&pound;{{amount}}",CAD:"${{amount}}",ARS:"${{amount_with_comma_separator}}",AUD:"${{amount}}",BBD:"${{amount}}",BDT:"Tk {{amount}}",BSD:"BS${{amount}}",BHD:"{{amount}}0 BHD",BRL:"R$ {{amount_with_comma_separator}}",BOB:"Bs{{amount_with_comma_separator}}",BND:"${{amount}}",BGN:"{{amount}} ",MMK:"K{{amount}}",KYD:"${{amount}}",CLP:"${{amount_no_decimals}}",CNY:"&#165;{{amount}}",COP:"${{amount_with_comma_separator}}",CRC:"&#8353; {{amount_with_comma_separator}}",HRK:"{{amount_with_comma_separator}} kn",CZK:"{{amount_with_comma_separator}} K&#269;",DKK:"{{amount_with_comma_separator}}",DOP:"RD$ {{amount_with_comma_separator}}",XCD:"${{amount}}",EGP:"LE {{amount}}",XPF:"{{amount_no_decimals_with_space_separator}}} XPF",FJD:"${{amount}}",GHS:"GH&#8373;{{amount}}",GTQ:"{{amount}}",GYD:"${{amount}}",GEL:"{{amount}} GEL",HKD:"${{amount}}",HUF:"{{amount_no_decimals_with_comma_separator}}",ISK:"{{amount_no_decimals}} kr",INR:"{{amount}}",IDR:"{{amount_with_comma_separator}}",NIS:"{{amount}} NIS",JMD:"${{amount}}",JPY:"&#165;{{amount_no_decimals}}",JOD:"{{amount}}0 JD",KZT:"{{amount}} KZT",KES:"KSh{{amount}}",KWD:"{{amount}}0 KD",LVL:"Ls {{amount}}",LTL:"{{amount}} Lt",MXN:"$ {{amount}}",MYR:"RM{{amount}} MYR",MUR:"Rs {{amount}}",MDL:"{{amount}} MDL",MAD:"{{amount}} dh",MNT:"{{amount_no_decimals}} &#8366",MZN:"{{amount}} Mt",ANG:"&fnof;{{amount}}",NZD:"${{amount}}",NGN:"&#8358;{{amount}}",NOK:"kr {{amount_with_comma_separator}}",OMR:"{{amount_with_comma_separator}} OMR",PKR:"Rs.{{amount}}",PYG:"Gs. {{amount_no_decimals_with_comma_separator}}",PEN:"S/. {{amount}}",PHP:"&#8369;{{amount}}",PLN:"{{amount_with_comma_separator}} zl",QAR:"QAR {{amount_with_comma_separator}}",RON:"{{amount_with_comma_separator}} lei",RUB:"&#1088;&#1091;&#1073;{{amount_with_comma_separator}}",SAR:"{{amount}} SR",RSD:"{{amount}} RSD",SCR:"Rs {{amount}}",SGD:"${{amount}}",SYP:"S&pound;{{amount}}",ZAR:"R {{amount}}",KRW:"&#8361;{{amount_no_decimals}}",LKR:"Rs {{amount}}",SEK:"{{amount_no_decimals}} kr",CHF:"SFr. {{amount}}",TWD:"${{amount}}",THB:"{{amount}} &#xe3f;",TZS:"{{amount}} TZS",TTD:"${{amount}}",TRY:"{{amount}}TL",UAH:"{{amount}}",AED:"Dhs. {{amount}}",UYU:"${{amount_with_comma_separator}}",VEB:"Bs. {{amount_with_comma_separator}}",VND:"{{amount_no_decimals_with_comma_separator}}",ZMK:"K{{amount_no_decimals_with_comma_separator}}"};Currency.formatMoney=function(b,f){if(typeof b=="string"){b=b.replace(".","")}var e="";var d=/\{\{\s*(\w+)\s*\}\}/;var a=(f||this.money_format);function c(g){return g.replace(/(\d+)(\d{3}[\.,]?)/,"$1,$2")}switch(a.match(d)[1]){case"amount":e=c(floatToString(b/100,2));break;case"amount_no_decimals":e=c(floatToString(b/100,0));break;case"amount_with_comma_separator":e=floatToString(b/100,2).replace(/\./,",");break;case"amount_no_decimals_with_comma_separator":e=c(floatToString(b/100,0)).replace(/\./,",");break}return a.replace(d,e)};function floatToString(c,a){var b=c.toFixed(a).toString();if(b.match(/^\.\d+/)){return"0"+b}else{return b}}Currency.currentCurrency="";Currency.format="money_with_currency_format";Currency.convertAll=function(c,b,a,d){jQuery(a||"span.money").each(function(){if(jQuery(this).attr("data-currency")===b){return}if(jQuery(this).attr("data-currency-"+b)){jQuery(this).html(jQuery(this).attr("data-currency-"+b))}else{var e=0;var f=Currency[d||Currency.format][c]||"{{amount}}";var g=Currency[d||Currency.format][b]||"{{amount}}";if(f.indexOf("amount_no_decimals")!==-1){e=Currency.convert(parseInt(jQuery(this).html().replace(/[^0-9]/g,""),10)*100,c,b)}else{e=Currency.convert(parseInt(jQuery(this).html().replace(/[^0-9]/g,""),10),c,b)}var h=Currency.formatMoney(e,g);jQuery(this).html(h);jQuery(this).attr("data-currency-"+b,h)}jQuery(this).attr("data-currency",b)});this.currentCurrency=b;this.cookie.write(b)};

(function(e){var t="waitForImages";e.waitForImages={hasImageProperties:["backgroundImage","listStyleImage","borderImage","borderCornerImage"]},e.expr[":"].uncached=function(t){if(!e(t).is('img[src!=""]'))return!1;var n=new Image;return n.src=t.src,!n.complete},e.fn.waitForImages=function(n,r,i){var s=0,o=0;e.isPlainObject(arguments[0])&&(i=arguments[0].waitForAll,r=arguments[0].each,n=arguments[0].finished),n=n||e.noop,r=r||e.noop,i=!!i;if(!e.isFunction(n)||!e.isFunction(r))throw new TypeError("An invalid callback was supplied.");return this.each(function(){var u=e(this),a=[],f=e.waitForImages.hasImageProperties||[],l=/url\(\s*(['"]?)(.*?)\1\s*\)/g;i?u.find("*").andSelf().each(function(){var t=e(this);t.is("img:uncached")&&a.push({src:t.attr("src"),element:t[0]}),e.each(f,function(e,n){var r=t.css(n),i;if(!r)return!0;while(i=l.exec(r))a.push({src:i[2],element:t[0]})})}):u.find("img:uncached").each(function(){a.push({src:this.src,element:this})}),s=a.length,o=0,s===0&&n.call(u[0]),e.each(a,function(i,a){var f=new Image;e(f).bind("load."+t+" error."+t,function(e){o++,r.call(a.element,o,s,e.type=="load");if(o==s)return n.call(u[0]),!1}),f.src=a.src})})}})(jQuery);


jQuery(function(){
   jQuery("div.svw").prepend("<img src='" + ACC.config.commonResourcePath + "/images/spinner.gif' class='ldrgif' alt='loading...'/ >");
});
var j = 0;
var quantofamo = 0;
var currentActive = 0;
var total = 0;
var listelements = [];

jQuery.fn.slideView = function(settings) {
	settings = jQuery.extend({
		easeFunc: "easeInOutExpo",
		easeTime: 750,
		uiBefore: false,
		toolTip: false,
		ttOpacity: 0.9, 
		autoPlay: false,
		autoPlayTime: '8000'
	}, settings);
	return this.each(function(){
		var container = jQuery(this);
		container.find("img.ldrgif").remove();
		container.removeClass("svw").addClass("stripViewer");		
		var pictWidth = container.find("img").width();
		var pictHeight = container.find("img").height();
		var pictEls = container.find("li").size();
		var stripViewerWidth = pictWidth*pictEls;
		container.find("ul").css("width" , stripViewerWidth);
		container.css("width" , pictWidth);
		container.css("height" , pictHeight);
		container.each(function(i) {
    (!settings.uiBefore) ? jQuery(this).after("<div class='stripTransmitter' id='stripTransmitter" + (j) + "'><ul><\/ul><\/div>") : jQuery(this).before("<div class='stripTransmitter' id='stripTransmitter" + (j) + "'><ul><\/ul><\/div>");			
		jQuery(this).find("li").each(function(n) {
		jQuery("div#stripTransmitter" + j + " ul").append("<li><a title='" + jQuery(this).find("img").attr("alt") + "' href='#'>"+(n+1)+"<\/a><\/li>");
		});
		jQuery("div#stripTransmitter" + j + " a").each(function(z) {
			
		jQuery(this).bind("click", function(){		
			slide(jQuery(this),  z);
			return false;
		});
		
		listelements.push(jQuery(this));
		total++;
		});
		
		
		function slide(target, z){
					target.addClass("current").parent().parent().find("a").not(target).removeClass("current"); // wow!
					currentActive = z;
					var cnt = -(pictWidth*z);
					container.find("ul").animate({ left: cnt}, settings.easeTime, settings.easeFunc);
		}
		
		
		container.bind("click", function(e){
			var ui = (!settings.uiBefore) ? jQuery(this).next().find("a.current") : jQuery(this).prev().find("a.current");
			var bTotal = parseFloat(jQuery(this).css('borderLeftWidth').replace("px", "")) +  parseFloat(jQuery(this).css('borderRightWidth').replace("px", ""));
			var dOs = jQuery(this).offset();
			var zeroLeft = (bTotal/2 + pictWidth) - (e.pageX - dOs.left);
			if(zeroLeft >= pictWidth/2) { 
				var uiprev = ui.parent().prev().find("a");	
				(jQuery(uiprev).length != 0)? uiprev.trigger("click") : ui.parent().parent().find("a:last").trigger("click");							
			} 
			else {
				var uinext = ui.parent().next().find("a");
			  (jQuery(uinext).length != 0)? uinext.trigger("click") : ui.parent().parent().find("a:first").trigger("click");
			}
		});
		
		
		jQuery("div#stripTransmitter" + j).css("width" , pictWidth);
		jQuery("div#stripTransmitter" + j + " a:first").addClass("current");
		jQuery('body').append('<div class="tooltip" style="display:none;"><\/div>');
		
		if(settings.autoPlay){
			var slideOn = setInterval(function() { slide(( total > currentActive+1) ?  listelements[currentActive+1] : listelements[0], ( total > currentActive+1) ?  currentActive+1 : 0)},settings.autoPlayTime);
		}
		

		if(settings.toolTip){
		var aref = jQuery("div#stripTransmitter" + j + " a");
		aref.each(function() {
		jQuery(this).data("title", jQuery(this).prop("title"));
		});

		aref.on('mousemove', function(e) {
		var att = jQuery(this).data('title');
		posX=e.pageX+10;
		posY=e.pageY+10;
		jQuery('.tooltip').html(att).css({'position': 'absolute', 'top': posY+'px', 'left': posX+'px', 'display': 'block', 'opacity': settings.ttOpacity});
		});
		aref.on('mouseout', function() {
		jQuery('.tooltip').hide();
		this.title = jQuery(this).data("title");
		});
		aref.on('mouseover', function() {
		this.title = '';
		});
		}
		});
		j++;
		
	});	
	
};
;(function($) {

    var MenuAim = function(element, options) {
        this.$menu =
        this.activeRow =
        this.mouseLocs =
        this.lastDelayLoc =
        this.timeoutId =
        this.options = null;

        this.init(element, options);
    };

    MenuAim.DEFAULTS = {
        rowSelector: "> li ul",
        submenuSelector: "*",
        submenuDirection: "right",
        tolerance: 75,
        enter: $.noop,
        exit: $.noop,
        activate: $.noop,
        deactivate: $.noop,
        exitMenu: $.noop
    };

    MenuAim.prototype.getDefaults = function() {
        return MenuAim.DEFAULTS;
    };

    MenuAim.prototype.mousemoveDocument = function(e) {
        this.mouseLocs.push({x: e.pageX, y: e.pageY});

        if (this.mouseLocs.length > this.MOUSE_LOCS_TRACKED) {
            this.mouseLocs.shift();
        }
    };

    MenuAim.prototype.mouseleaveMenu = function() {
        if (this.timeoutId) {
            clearTimeout(this.timeoutId);
        }

        if (this.options.exitMenu(this)) {
            if (this.activeRow) {
                this.options.deactivate(this.activeRow);
            }

            this.activeRow = null;
        }
    };

    MenuAim.prototype.mouseenterRow = function(ev) {
        if (this.timeoutId) {
            clearTimeout(this.timeoutId);
        }

        this.options.enter(ev.currentTarget);
        this.possiblyActivate(ev.currentTarget);
    };

    MenuAim.prototype.mouseleaveRow = function(ev) {
        this.options.exit(ev.currentTarget);
    };

    MenuAim.prototype.clickRow = function(ev) {
        this.activate(ev.currentTarget);
    };

    MenuAim.prototype.activate = function(row) {
        if (row == this.activeRow) {
            return;
        }

        if (this.activeRow) {
            this.options.deactivate(this.activeRow);
        }

        this.options.activate(row);
        this.activeRow = row;
    };

    MenuAim.prototype.possiblyActivate = function(row) {
        var delay = this.activationDelay()
          , self = this;

        if (delay) {
            this.timeoutId = setTimeout(function() {
                self.possiblyActivate(row);
            }, delay);
        } else {
            this.activate(row);
        }
    };

    MenuAim.prototype.activationDelay = function() {
        if (!this.activeRow || !$(this.activeRow).is(this.options.submenuSelector)) {
            return 0;
        }

        var offset = this.$menu.offset(),
            upperLeft = {
                x: offset.left,
                y: offset.top - this.options.tolerance
            },
            upperRight = {
                x: offset.left + this.$menu.outerWidth(),
                y: upperLeft.y
            },
            lowerLeft = {
                x: offset.left,
                y: offset.top + this.$menu.outerHeight() + this.options.tolerance
            },
            lowerRight = {
                x: offset.left + this.$menu.outerWidth(),
                y: lowerLeft.y
            },
            loc = this.mouseLocs[this.mouseLocs.length - 1],
            prevLoc = this.mouseLocs[0];

        if (!loc) {
            return 0;
        }

        if (!prevLoc) {
            prevLoc = loc;
        }

        if (prevLoc.x < offset.left || prevLoc.x > lowerRight.x ||
            prevLoc.y < offset.top || prevLoc.y > lowerRight.y) {

            return 0;
        }

        if (this.lastDelayLoc &&
                loc.x == this.lastDelayLoc.x && loc.y == this.lastDelayLoc.y) {

            return 0;
        }

        function slope(a, b) {
            return (b.y - a.y) / (b.x - a.x);
        }

        var decreasingCorner = upperRight,
            increasingCorner = lowerRight;

        if (this.options.submenuDirection == "left") {
            decreasingCorner = lowerLeft;
            increasingCorner = upperLeft;
        } else if (this.options.submenuDirection == "below") {
            decreasingCorner = lowerRight;
            increasingCorner = lowerLeft;
        } else if (this.options.submenuDirection == "above") {
            decreasingCorner = upperLeft;
            increasingCorner = upperRight;
        }

        var decreasingSlope = slope(loc, decreasingCorner),
            increasingSlope = slope(loc, increasingCorner),
            prevDecreasingSlope = slope(prevLoc, decreasingCorner),
            prevIncreasingSlope = slope(prevLoc, increasingCorner);

        if (decreasingSlope < prevDecreasingSlope &&
                increasingSlope > prevIncreasingSlope) {

            this.lastDelayLoc = loc;
            return this.DELAY;
        }

        this.lastDelayLoc = null;
        return 0;
    };

    MenuAim.prototype.destroy = function() {
        this.$menu.removeData("jquery.menu-aim");

        this.$menu.off(".menu-aim")
            .find(this.options.rowSelector)
            .off(".menu-aim");

        $(document).off(".menu-aim");
    };

    MenuAim.prototype.reset = function(triggerDeactivate) {
        if (this.timeoutId) {
            clearTimeout(this.timeoutId);
        }

        if (this.activeRow && triggerDeactivate) {
            this.options.deactivate(this.activeRow);
        }

        this.activeRow = null;
    };

    MenuAim.prototype.init = function(element, option) {
        this.$menu = $(element);
        this.activeRow = null;
        this.mouseLocs = [];
        this.lastDelayLoc = null;
        this.timeoutId = null;
        this.options = $.extend({}, this.getDefaults(), option);

        this.MOUSE_LOCS_TRACKED = 3;  
        this.DELAY = 30000;  

        this.$menu
            .on("mouseleave.menu-aim", $.proxy(this.mouseleaveMenu, this))
            .find(this.options.rowSelector)
                .on("mouseenter.menu-aim", $.proxy(this.mouseenterRow, this))
                .on("mouseleave.menu-aim", $.proxy(this.mouseleaveRow, this))
                .on("click.menu-aim", $.proxy(this.clickRow, this));

        $(document).on("mousemove.menu-aim", $.proxy(this.mousemoveDocument, this));

    };

    $.fn.menuAim = function(opts) {
        return this.each(function() {
            var $this = $(this)
              , data = $this.data("jquery.menu-aim")
              , options = typeof opts == "object" && opts;

            if (!data) {
                $this.data("jquery.menu-aim", (data = new MenuAim(this, options)));
            }

            if (typeof opts == "string") {
                data[opts]();
            }

        });
    };

})(jQuery);
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).uuidv4=e()}(this,(function(){"use strict";var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),e=new Uint8Array(16);function n(){if(!t)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return t(e)}for(var o=[],r=0;r<256;++r)o.push((r+256).toString(16).substr(1));return function(t,e,r){"string"==typeof t&&(e="binary"===t?new Uint8Array(16):null,t=null);var u=(t=t||{}).random||(t.rng||n)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,e){for(var i=r||0,d=0;d<16;++d)e[i+d]=u[d];return e}return function(t,e){var n=e||0,r=o;return(r[t[n+0]]+r[t[n+1]]+r[t[n+2]]+r[t[n+3]]+"-"+r[t[n+4]]+r[t[n+5]]+"-"+r[t[n+6]]+r[t[n+7]]+"-"+r[t[n+8]]+r[t[n+9]]+"-"+r[t[n+10]]+r[t[n+11]]+r[t[n+12]]+r[t[n+13]]+r[t[n+14]]+r[t[n+15]]).toLowerCase()}(u)}}));
/*!
 * Released under the MIT License
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Chart=e()}(this,(function(){"use strict";function t(){}const e=function(){let t=0;return function(){return t++}}();function i(t){return null==t}function s(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return"[object"===e.slice(0,7)&&"Array]"===e.slice(-6)}function n(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)}const o=t=>("number"==typeof t||t instanceof Number)&&isFinite(+t);function a(t,e){return o(t)?t:e}function r(t,e){return void 0===t?e:t}const l=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100:t/e,h=(t,e)=>"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100*e:+t;function c(t,e,i){if(t&&"function"==typeof t.call)return t.apply(i,e)}function d(t,e,i,o){let a,r,l;if(s(t))if(r=t.length,o)for(a=r-1;a>=0;a--)e.call(i,t[a],a);else for(a=0;a<r;a++)e.call(i,t[a],a);else if(n(t))for(l=Object.keys(t),r=l.length,a=0;a<r;a++)e.call(i,t[l[a]],l[a])}function u(t,e){let i,s,n,o;if(!t||!e||t.length!==e.length)return!1;for(i=0,s=t.length;i<s;++i)if(n=t[i],o=e[i],n.datasetIndex!==o.datasetIndex||n.index!==o.index)return!1;return!0}function f(t){if(s(t))return t.map(f);if(n(t)){const e=Object.create(null),i=Object.keys(t),s=i.length;let n=0;for(;n<s;++n)e[i[n]]=f(t[i[n]]);return e}return t}function g(t){return-1===["__proto__","prototype","constructor"].indexOf(t)}function p(t,e,i,s){if(!g(t))return;const o=e[t],a=i[t];n(o)&&n(a)?m(o,a,s):e[t]=f(a)}function m(t,e,i){const o=s(e)?e:[e],a=o.length;if(!n(t))return t;const r=(i=i||{}).merger||p;for(let s=0;s<a;++s){if(!n(e=o[s]))continue;const a=Object.keys(e);for(let s=0,n=a.length;s<n;++s)r(a[s],t,e,i)}return t}function b(t,e){return m(t,e,{merger:x})}function x(t,e,i){if(!g(t))return;const s=e[t],o=i[t];n(s)&&n(o)?b(s,o):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=f(o))}const _={"":t=>t,x:t=>t.x,y:t=>t.y};function y(t,e){const i=_[e]||(_[e]=function(t){const e=v(t);return t=>{for(const i of e){if(""===i)break;t=t&&t[i]}return t}}(e));return i(t)}function v(t){const e=t.split("."),i=[];let s="";for(const t of e)s+=t,s.endsWith("\\")?s=s.slice(0,-1)+".":(i.push(s),s="");return i}function w(t){return t.charAt(0).toUpperCase()+t.slice(1)}const M=t=>void 0!==t,k=t=>"function"==typeof t,S=(t,e)=>{if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0};function P(t){return"mouseup"===t.type||"click"===t.type||"contextmenu"===t.type}const D=Math.PI,O=2*D,C=O+D,A=Number.POSITIVE_INFINITY,T=D/180,L=D/2,E=D/4,R=2*D/3,I=Math.log10,z=Math.sign;function F(t){const e=Math.round(t);t=N(t,e,t/1e3)?e:t;const i=Math.pow(10,Math.floor(I(t))),s=t/i;return(s<=1?1:s<=2?2:s<=5?5:10)*i}function V(t){const e=[],i=Math.sqrt(t);let s;for(s=1;s<i;s++)t%s==0&&(e.push(s),e.push(t/s));return i===(0|i)&&e.push(i),e.sort(((t,e)=>t-e)).pop(),e}function B(t){return!isNaN(parseFloat(t))&&isFinite(t)}function N(t,e,i){return Math.abs(t-e)<i}function W(t,e){const i=Math.round(t);return i-e<=t&&i+e>=t}function j(t,e,i){let s,n,o;for(s=0,n=t.length;s<n;s++)o=t[s][i],isNaN(o)||(e.min=Math.min(e.min,o),e.max=Math.max(e.max,o))}function H(t){return t*(D/180)}function $(t){return t*(180/D)}function Y(t){if(!o(t))return;let e=1,i=0;for(;Math.round(t*e)/e!==t;)e*=10,i++;return i}function U(t,e){const i=e.x-t.x,s=e.y-t.y,n=Math.sqrt(i*i+s*s);let o=Math.atan2(s,i);return o<-.5*D&&(o+=O),{angle:o,distance:n}}function X(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function q(t,e){return(t-e+C)%O-D}function K(t){return(t%O+O)%O}function G(t,e,i,s){const n=K(t),o=K(e),a=K(i),r=K(o-n),l=K(a-n),h=K(n-o),c=K(n-a);return n===o||n===a||s&&o===a||r>l&&h<c}function Z(t,e,i){return Math.max(e,Math.min(i,t))}function J(t){return Z(t,-32768,32767)}function Q(t,e,i,s=1e-6){return t>=Math.min(e,i)-s&&t<=Math.max(e,i)+s}function tt(t,e,i){i=i||(i=>t[i]<e);let s,n=t.length-1,o=0;for(;n-o>1;)s=o+n>>1,i(s)?o=s:n=s;return{lo:o,hi:n}}const et=(t,e,i,s)=>tt(t,i,s?s=>t[s][e]<=i:s=>t[s][e]<i),it=(t,e,i)=>tt(t,i,(s=>t[s][e]>=i));function st(t,e,i){let s=0,n=t.length;for(;s<n&&t[s]<e;)s++;for(;n>s&&t[n-1]>i;)n--;return s>0||n<t.length?t.slice(s,n):t}const nt=["push","pop","shift","splice","unshift"];function ot(t,e){t._chartjs?t._chartjs.listeners.push(e):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),nt.forEach((e=>{const i="_onData"+w(e),s=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value(...e){const n=s.apply(this,e);return t._chartjs.listeners.forEach((t=>{"function"==typeof t[i]&&t[i](...e)})),n}})})))}function at(t,e){const i=t._chartjs;if(!i)return;const s=i.listeners,n=s.indexOf(e);-1!==n&&s.splice(n,1),s.length>0||(nt.forEach((e=>{delete t[e]})),delete t._chartjs)}function rt(t){const e=new Set;let i,s;for(i=0,s=t.length;i<s;++i)e.add(t[i]);return e.size===s?t:Array.from(e)}const lt="undefined"==typeof window?function(t){return t()}:window.requestAnimationFrame;function ht(t,e,i){const s=i||(t=>Array.prototype.slice.call(t));let n=!1,o=[];return function(...i){o=s(i),n||(n=!0,lt.call(window,(()=>{n=!1,t.apply(e,o)})))}}function ct(t,e){let i;return function(...s){return e?(clearTimeout(i),i=setTimeout(t,e,s)):t.apply(this,s),e}}const dt=t=>"start"===t?"left":"end"===t?"right":"center",ut=(t,e,i)=>"start"===t?e:"end"===t?i:(e+i)/2,ft=(t,e,i,s)=>t===(s?"left":"right")?i:"center"===t?(e+i)/2:e;function gt(t,e,i){const s=e.length;let n=0,o=s;if(t._sorted){const{iScale:a,_parsed:r}=t,l=a.axis,{min:h,max:c,minDefined:d,maxDefined:u}=a.getUserBounds();d&&(n=Z(Math.min(et(r,a.axis,h).lo,i?s:et(e,l,a.getPixelForValue(h)).lo),0,s-1)),o=u?Z(Math.max(et(r,a.axis,c,!0).hi+1,i?0:et(e,l,a.getPixelForValue(c),!0).hi+1),n,s)-n:s-n}return{start:n,count:o}}function pt(t){const{xScale:e,yScale:i,_scaleRanges:s}=t,n={xmin:e.min,xmax:e.max,ymin:i.min,ymax:i.max};if(!s)return t._scaleRanges=n,!0;const o=s.xmin!==e.min||s.xmax!==e.max||s.ymin!==i.min||s.ymax!==i.max;return Object.assign(s,n),o}var mt=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const n=e.listeners[s],o=e.duration;n.forEach((s=>s({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)})))}_refresh(){this._request||(this._running=!0,this._request=lt.call(window,(()=>{this._update(),this._request=null,this._running&&this._refresh()})))}_update(t=Date.now()){let e=0;this._charts.forEach(((i,s)=>{if(!i.running||!i.items.length)return;const n=i.items;let o,a=n.length-1,r=!1;for(;a>=0;--a)o=n[a],o._active?(o._total>i.duration&&(i.duration=o._total),o.tick(t),r=!0):(n[a]=n[n.length-1],n.pop());r&&(s.draw(),this._notify(s,i,t,"progress")),n.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),e+=n.length})),this._lastDate=t,0===e&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){e&&e.length&&this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce(((t,e)=>Math.max(t,e._duration)),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!!(e&&e.running&&e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}};
/*!
 * Released under the MIT License
 */function bt(t){return t+.5|0}const xt=(t,e,i)=>Math.max(Math.min(t,i),e);function _t(t){return xt(bt(2.55*t),0,255)}function yt(t){return xt(bt(255*t),0,255)}function vt(t){return xt(bt(t/2.55)/100,0,1)}function wt(t){return xt(bt(100*t),0,100)}const Mt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},kt=[..."0123456789ABCDEF"],St=t=>kt[15&t],Pt=t=>kt[(240&t)>>4]+kt[15&t],Dt=t=>(240&t)>>4==(15&t);function Ot(t){var e=(t=>Dt(t.r)&&Dt(t.g)&&Dt(t.b)&&Dt(t.a))(t)?St:Pt;return t?"#"+e(t.r)+e(t.g)+e(t.b)+((t,e)=>t<255?e(t):"")(t.a,e):void 0}const Ct=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function At(t,e,i){const s=e*Math.min(i,1-i),n=(e,n=(e+t/30)%12)=>i-s*Math.max(Math.min(n-3,9-n,1),-1);return[n(0),n(8),n(4)]}function Tt(t,e,i){const s=(s,n=(s+t/60)%6)=>i-i*e*Math.max(Math.min(n,4-n,1),0);return[s(5),s(3),s(1)]}function Lt(t,e,i){const s=At(t,1,.5);let n;for(e+i>1&&(n=1/(e+i),e*=n,i*=n),n=0;n<3;n++)s[n]*=1-e-i,s[n]+=e;return s}function Et(t){const e=t.r/255,i=t.g/255,s=t.b/255,n=Math.max(e,i,s),o=Math.min(e,i,s),a=(n+o)/2;let r,l,h;return n!==o&&(h=n-o,l=a>.5?h/(2-n-o):h/(n+o),r=function(t,e,i,s,n){return t===n?(e-i)/s+(e<i?6:0):e===n?(i-t)/s+2:(t-e)/s+4}(e,i,s,h,n),r=60*r+.5),[0|r,l||0,a]}function Rt(t,e,i,s){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,i,s)).map(yt)}function It(t,e,i){return Rt(At,t,e,i)}function zt(t){return(t%360+360)%360}function Ft(t){const e=Ct.exec(t);let i,s=255;if(!e)return;e[5]!==i&&(s=e[6]?_t(+e[5]):yt(+e[5]));const n=zt(+e[2]),o=+e[3]/100,a=+e[4]/100;return i="hwb"===e[1]?function(t,e,i){return Rt(Lt,t,e,i)}(n,o,a):"hsv"===e[1]?function(t,e,i){return Rt(Tt,t,e,i)}(n,o,a):It(n,o,a),{r:i[0],g:i[1],b:i[2],a:s}}const Vt={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Bt={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Nt;function Wt(t){Nt||(Nt=function(){const t={},e=Object.keys(Bt),i=Object.keys(Vt);let s,n,o,a,r;for(s=0;s<e.length;s++){for(a=r=e[s],n=0;n<i.length;n++)o=i[n],r=r.replace(o,Vt[o]);o=parseInt(Bt[a],16),t[r]=[o>>16&255,o>>8&255,255&o]}return t}(),Nt.transparent=[0,0,0,0]);const e=Nt[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:4===e.length?e[3]:255}}const jt=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Ht=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,$t=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function Yt(t,e,i){if(t){let s=Et(t);s[e]=Math.max(0,Math.min(s[e]+s[e]*i,0===e?360:1)),s=It(s),t.r=s[0],t.g=s[1],t.b=s[2]}}function Ut(t,e){return t?Object.assign(e||{},t):t}function Xt(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=yt(t[3]))):(e=Ut(t,{r:0,g:0,b:0,a:1})).a=yt(e.a),e}function qt(t){return"r"===t.charAt(0)?function(t){const e=jt.exec(t);let i,s,n,o=255;if(e){if(e[7]!==i){const t=+e[7];o=e[8]?_t(t):xt(255*t,0,255)}return i=+e[1],s=+e[3],n=+e[5],i=255&(e[2]?_t(i):xt(i,0,255)),s=255&(e[4]?_t(s):xt(s,0,255)),n=255&(e[6]?_t(n):xt(n,0,255)),{r:i,g:s,b:n,a:o}}}(t):Ft(t)}class Kt{constructor(t){if(t instanceof Kt)return t;const e=typeof t;let i;var s,n,o;"object"===e?i=Xt(t):"string"===e&&(o=(s=t).length,"#"===s[0]&&(4===o||5===o?n={r:255&17*Mt[s[1]],g:255&17*Mt[s[2]],b:255&17*Mt[s[3]],a:5===o?17*Mt[s[4]]:255}:7!==o&&9!==o||(n={r:Mt[s[1]]<<4|Mt[s[2]],g:Mt[s[3]]<<4|Mt[s[4]],b:Mt[s[5]]<<4|Mt[s[6]],a:9===o?Mt[s[7]]<<4|Mt[s[8]]:255})),i=n||Wt(t)||qt(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Ut(this._rgb);return t&&(t.a=vt(t.a)),t}set rgb(t){this._rgb=Xt(t)}rgbString(){return this._valid?(t=this._rgb)&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${vt(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`):void 0;var t}hexString(){return this._valid?Ot(this._rgb):void 0}hslString(){return this._valid?function(t){if(!t)return;const e=Et(t),i=e[0],s=wt(e[1]),n=wt(e[2]);return t.a<255?`hsla(${i}, ${s}%, ${n}%, ${vt(t.a)})`:`hsl(${i}, ${s}%, ${n}%)`}(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,s=t.rgb;let n;const o=e===n?.5:e,a=2*o-1,r=i.a-s.a,l=((a*r==-1?a:(a+r)/(1+a*r))+1)/2;n=1-l,i.r=255&l*i.r+n*s.r+.5,i.g=255&l*i.g+n*s.g+.5,i.b=255&l*i.b+n*s.b+.5,i.a=o*i.a+(1-o)*s.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=function(t,e,i){const s=$t(vt(t.r)),n=$t(vt(t.g)),o=$t(vt(t.b));return{r:yt(Ht(s+i*($t(vt(e.r))-s))),g:yt(Ht(n+i*($t(vt(e.g))-n))),b:yt(Ht(o+i*($t(vt(e.b))-o))),a:t.a+i*(e.a-t.a)}}(this._rgb,t._rgb,e)),this}clone(){return new Kt(this.rgb)}alpha(t){return this._rgb.a=yt(t),this}clearer(t){return this._rgb.a*=1-t,this}greyscale(){const t=this._rgb,e=bt(.3*t.r+.59*t.g+.11*t.b);return t.r=t.g=t.b=e,this}opaquer(t){return this._rgb.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Yt(this._rgb,2,t),this}darken(t){return Yt(this._rgb,2,-t),this}saturate(t){return Yt(this._rgb,1,t),this}desaturate(t){return Yt(this._rgb,1,-t),this}rotate(t){return function(t,e){var i=Et(t);i[0]=zt(i[0]+e),i=It(i),t.r=i[0],t.g=i[1],t.b=i[2]}(this._rgb,t),this}}function Gt(t){return new Kt(t)}function Zt(t){if(t&&"object"==typeof t){const e=t.toString();return"[object CanvasPattern]"===e||"[object CanvasGradient]"===e}return!1}function Jt(t){return Zt(t)?t:Gt(t)}function Qt(t){return Zt(t)?t:Gt(t).saturate(.5).darken(.1).hexString()}const te=Object.create(null),ee=Object.create(null);function ie(t,e){if(!e)return t;const i=e.split(".");for(let e=0,s=i.length;e<s;++e){const s=i[e];t=t[s]||(t[s]=Object.create(null))}return t}function se(t,e,i){return"string"==typeof e?m(ie(t,e),i):m(ie(t,""),e)}var ne=new class{constructor(t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(t,e)=>Qt(e.backgroundColor),this.hoverBorderColor=(t,e)=>Qt(e.borderColor),this.hoverColor=(t,e)=>Qt(e.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t)}set(t,e){return se(this,t,e)}get(t){return ie(this,t)}describe(t,e){return se(ee,t,e)}override(t,e){return se(te,t,e)}route(t,e,i,s){const o=ie(this,t),a=ie(this,i),l="_"+e;Object.defineProperties(o,{[l]:{value:o[e],writable:!0},[e]:{enumerable:!0,get(){const t=this[l],e=a[s];return n(t)?Object.assign({},e,t):r(t,e)},set(t){this[l]=t}}})}}({_scriptable:t=>!t.startsWith("on"),_indexable:t=>"events"!==t,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}});function oe(){return"undefined"!=typeof window&&"undefined"!=typeof document}function ae(t){let e=t.parentNode;return e&&"[object ShadowRoot]"===e.toString()&&(e=e.host),e}function re(t,e,i){let s;return"string"==typeof t?(s=parseInt(t,10),-1!==t.indexOf("%")&&(s=s/100*e.parentNode[i])):s=t,s}const le=t=>window.getComputedStyle(t,null);function he(t,e){return le(t).getPropertyValue(e)}const ce=["top","right","bottom","left"];function de(t,e,i){const s={};i=i?"-"+i:"";for(let n=0;n<4;n++){const o=ce[n];s[o]=parseFloat(t[e+"-"+o+i])||0}return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function ue(t,e){if("native"in t)return t;const{canvas:i,currentDevicePixelRatio:s}=e,n=le(i),o="border-box"===n.boxSizing,a=de(n,"padding"),r=de(n,"border","width"),{x:l,y:h,box:c}=function(t,e){const i=t.touches,s=i&&i.length?i[0]:t,{offsetX:n,offsetY:o}=s;let a,r,l=!1;if(((t,e,i)=>(t>0||e>0)&&(!i||!i.shadowRoot))(n,o,t.target))a=n,r=o;else{const t=e.getBoundingClientRect();a=s.clientX-t.left,r=s.clientY-t.top,l=!0}return{x:a,y:r,box:l}}(t,i),d=a.left+(c&&r.left),u=a.top+(c&&r.top);let{width:f,height:g}=e;return o&&(f-=a.width+r.width,g-=a.height+r.height),{x:Math.round((l-d)/f*i.width/s),y:Math.round((h-u)/g*i.height/s)}}const fe=t=>Math.round(10*t)/10;function ge(t,e,i,s){const n=le(t),o=de(n,"margin"),a=re(n.maxWidth,t,"clientWidth")||A,r=re(n.maxHeight,t,"clientHeight")||A,l=function(t,e,i){let s,n;if(void 0===e||void 0===i){const o=ae(t);if(o){const t=o.getBoundingClientRect(),a=le(o),r=de(a,"border","width"),l=de(a,"padding");e=t.width-l.width-r.width,i=t.height-l.height-r.height,s=re(a.maxWidth,o,"clientWidth"),n=re(a.maxHeight,o,"clientHeight")}else e=t.clientWidth,i=t.clientHeight}return{width:e,height:i,maxWidth:s||A,maxHeight:n||A}}(t,e,i);let{width:h,height:c}=l;if("content-box"===n.boxSizing){const t=de(n,"border","width"),e=de(n,"padding");h-=e.width+t.width,c-=e.height+t.height}return h=Math.max(0,h-o.width),c=Math.max(0,s?Math.floor(h/s):c-o.height),h=fe(Math.min(h,a,l.maxWidth)),c=fe(Math.min(c,r,l.maxHeight)),h&&!c&&(c=fe(h/2)),{width:h,height:c}}function pe(t,e,i){const s=e||1,n=Math.floor(t.height*s),o=Math.floor(t.width*s);t.height=n/s,t.width=o/s;const a=t.canvas;return a.style&&(i||!a.style.height&&!a.style.width)&&(a.style.height=`${t.height}px`,a.style.width=`${t.width}px`),(t.currentDevicePixelRatio!==s||a.height!==n||a.width!==o)&&(t.currentDevicePixelRatio=s,a.height=n,a.width=o,t.ctx.setTransform(s,0,0,s,0,0),!0)}const me=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(t){}return t}();function be(t,e){const i=he(t,e),s=i&&i.match(/^(\d+)(\.\d+)?px$/);return s?+s[1]:void 0}function xe(t){return!t||i(t.size)||i(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function _e(t,e,i,s,n){let o=e[n];return o||(o=e[n]=t.measureText(n).width,i.push(n)),o>s&&(s=o),s}function ye(t,e,i,n){let o=(n=n||{}).data=n.data||{},a=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(o=n.data={},a=n.garbageCollect=[],n.font=e),t.save(),t.font=e;let r=0;const l=i.length;let h,c,d,u,f;for(h=0;h<l;h++)if(u=i[h],null!=u&&!0!==s(u))r=_e(t,o,a,r,u);else if(s(u))for(c=0,d=u.length;c<d;c++)f=u[c],null==f||s(f)||(r=_e(t,o,a,r,f));t.restore();const g=a.length/2;if(g>i.length){for(h=0;h<g;h++)delete o[a[h]];a.splice(0,g)}return r}function ve(t,e,i){const s=t.currentDevicePixelRatio,n=0!==i?Math.max(i/2,.5):0;return Math.round((e-n)*s)/s+n}function we(t,e){(e=e||t.getContext("2d")).save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function Me(t,e,i,s){ke(t,e,i,s,null)}function ke(t,e,i,s,n){let o,a,r,l,h,c;const d=e.pointStyle,u=e.rotation,f=e.radius;let g=(u||0)*T;if(d&&"object"==typeof d&&(o=d.toString(),"[object HTMLImageElement]"===o||"[object HTMLCanvasElement]"===o))return t.save(),t.translate(i,s),t.rotate(g),t.drawImage(d,-d.width/2,-d.height/2,d.width,d.height),void t.restore();if(!(isNaN(f)||f<=0)){switch(t.beginPath(),d){default:n?t.ellipse(i,s,n/2,f,0,0,O):t.arc(i,s,f,0,O),t.closePath();break;case"triangle":t.moveTo(i+Math.sin(g)*f,s-Math.cos(g)*f),g+=R,t.lineTo(i+Math.sin(g)*f,s-Math.cos(g)*f),g+=R,t.lineTo(i+Math.sin(g)*f,s-Math.cos(g)*f),t.closePath();break;case"rectRounded":h=.516*f,l=f-h,a=Math.cos(g+E)*l,r=Math.sin(g+E)*l,t.arc(i-a,s-r,h,g-D,g-L),t.arc(i+r,s-a,h,g-L,g),t.arc(i+a,s+r,h,g,g+L),t.arc(i-r,s+a,h,g+L,g+D),t.closePath();break;case"rect":if(!u){l=Math.SQRT1_2*f,c=n?n/2:l,t.rect(i-c,s-l,2*c,2*l);break}g+=E;case"rectRot":a=Math.cos(g)*f,r=Math.sin(g)*f,t.moveTo(i-a,s-r),t.lineTo(i+r,s-a),t.lineTo(i+a,s+r),t.lineTo(i-r,s+a),t.closePath();break;case"crossRot":g+=E;case"cross":a=Math.cos(g)*f,r=Math.sin(g)*f,t.moveTo(i-a,s-r),t.lineTo(i+a,s+r),t.moveTo(i+r,s-a),t.lineTo(i-r,s+a);break;case"star":a=Math.cos(g)*f,r=Math.sin(g)*f,t.moveTo(i-a,s-r),t.lineTo(i+a,s+r),t.moveTo(i+r,s-a),t.lineTo(i-r,s+a),g+=E,a=Math.cos(g)*f,r=Math.sin(g)*f,t.moveTo(i-a,s-r),t.lineTo(i+a,s+r),t.moveTo(i+r,s-a),t.lineTo(i-r,s+a);break;case"line":a=n?n/2:Math.cos(g)*f,r=Math.sin(g)*f,t.moveTo(i-a,s-r),t.lineTo(i+a,s+r);break;case"dash":t.moveTo(i,s),t.lineTo(i+Math.cos(g)*f,s+Math.sin(g)*f)}t.fill(),e.borderWidth>0&&t.stroke()}}function Se(t,e,i){return i=i||.5,!e||t&&t.x>e.left-i&&t.x<e.right+i&&t.y>e.top-i&&t.y<e.bottom+i}function Pe(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function De(t){t.restore()}function Oe(t,e,i,s,n){if(!e)return t.lineTo(i.x,i.y);if("middle"===n){const s=(e.x+i.x)/2;t.lineTo(s,e.y),t.lineTo(s,i.y)}else"after"===n!=!!s?t.lineTo(e.x,i.y):t.lineTo(i.x,e.y);t.lineTo(i.x,i.y)}function Ce(t,e,i,s){if(!e)return t.lineTo(i.x,i.y);t.bezierCurveTo(s?e.cp1x:e.cp2x,s?e.cp1y:e.cp2y,s?i.cp2x:i.cp1x,s?i.cp2y:i.cp1y,i.x,i.y)}function Ae(t,e,n,o,a,r={}){const l=s(e)?e:[e],h=r.strokeWidth>0&&""!==r.strokeColor;let c,d;for(t.save(),t.font=a.string,function(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]);i(e.rotation)||t.rotate(e.rotation);e.color&&(t.fillStyle=e.color);e.textAlign&&(t.textAlign=e.textAlign);e.textBaseline&&(t.textBaseline=e.textBaseline)}(t,r),c=0;c<l.length;++c)d=l[c],h&&(r.strokeColor&&(t.strokeStyle=r.strokeColor),i(r.strokeWidth)||(t.lineWidth=r.strokeWidth),t.strokeText(d,n,o,r.maxWidth)),t.fillText(d,n,o,r.maxWidth),Te(t,n,o,d,r),o+=a.lineHeight;t.restore()}function Te(t,e,i,s,n){if(n.strikethrough||n.underline){const o=t.measureText(s),a=e-o.actualBoundingBoxLeft,r=e+o.actualBoundingBoxRight,l=i-o.actualBoundingBoxAscent,h=i+o.actualBoundingBoxDescent,c=n.strikethrough?(l+h)/2:h;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=n.decorationWidth||2,t.moveTo(a,c),t.lineTo(r,c),t.stroke()}}function Le(t,e){const{x:i,y:s,w:n,h:o,radius:a}=e;t.arc(i+a.topLeft,s+a.topLeft,a.topLeft,-L,D,!0),t.lineTo(i,s+o-a.bottomLeft),t.arc(i+a.bottomLeft,s+o-a.bottomLeft,a.bottomLeft,D,L,!0),t.lineTo(i+n-a.bottomRight,s+o),t.arc(i+n-a.bottomRight,s+o-a.bottomRight,a.bottomRight,L,0,!0),t.lineTo(i+n,s+a.topRight),t.arc(i+n-a.topRight,s+a.topRight,a.topRight,0,-L,!0),t.lineTo(i+a.topLeft,s)}function Ee(t,e=[""],i=t,s,n=(()=>t[0])){M(s)||(s=$e("_fallback",t));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:i,_fallback:s,_getTarget:n,override:n=>Ee([n,...t],e,i,s)};return new Proxy(o,{deleteProperty:(e,i)=>(delete e[i],delete e._keys,delete t[0][i],!0),get:(i,s)=>Ve(i,s,(()=>function(t,e,i,s){let n;for(const o of e)if(n=$e(ze(o,t),i),M(n))return Fe(t,n)?je(i,s,t,n):n}(s,e,t,i))),getOwnPropertyDescriptor:(t,e)=>Reflect.getOwnPropertyDescriptor(t._scopes[0],e),getPrototypeOf:()=>Reflect.getPrototypeOf(t[0]),has:(t,e)=>Ye(t).includes(e),ownKeys:t=>Ye(t),set(t,e,i){const s=t._storage||(t._storage=n());return t[e]=s[e]=i,delete t._keys,!0}})}function Re(t,e,i,o){const a={_cacheable:!1,_proxy:t,_context:e,_subProxy:i,_stack:new Set,_descriptors:Ie(t,o),setContext:e=>Re(t,e,i,o),override:s=>Re(t.override(s),e,i,o)};return new Proxy(a,{deleteProperty:(e,i)=>(delete e[i],delete t[i],!0),get:(t,e,i)=>Ve(t,e,(()=>function(t,e,i){const{_proxy:o,_context:a,_subProxy:r,_descriptors:l}=t;let h=o[e];k(h)&&l.isScriptable(e)&&(h=function(t,e,i,s){const{_proxy:n,_context:o,_subProxy:a,_stack:r}=i;if(r.has(t))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+t);r.add(t),e=e(o,a||s),r.delete(t),Fe(t,e)&&(e=je(n._scopes,n,t,e));return e}(e,h,t,i));s(h)&&h.length&&(h=function(t,e,i,s){const{_proxy:o,_context:a,_subProxy:r,_descriptors:l}=i;if(M(a.index)&&s(t))e=e[a.index%e.length];else if(n(e[0])){const i=e,s=o._scopes.filter((t=>t!==i));e=[];for(const n of i){const i=je(s,o,t,n);e.push(Re(i,a,r&&r[t],l))}}return e}(e,h,t,l.isIndexable));Fe(e,h)&&(h=Re(h,a,r&&r[e],l));return h}(t,e,i))),getOwnPropertyDescriptor:(e,i)=>e._descriptors.allKeys?Reflect.has(t,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,i),getPrototypeOf:()=>Reflect.getPrototypeOf(t),has:(e,i)=>Reflect.has(t,i),ownKeys:()=>Reflect.ownKeys(t),set:(e,i,s)=>(t[i]=s,delete e[i],!0)})}function Ie(t,e={scriptable:!0,indexable:!0}){const{_scriptable:i=e.scriptable,_indexable:s=e.indexable,_allKeys:n=e.allKeys}=t;return{allKeys:n,scriptable:i,indexable:s,isScriptable:k(i)?i:()=>i,isIndexable:k(s)?s:()=>s}}const ze=(t,e)=>t?t+w(e):e,Fe=(t,e)=>n(e)&&"adapters"!==t&&(null===Object.getPrototypeOf(e)||e.constructor===Object);function Ve(t,e,i){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];const s=i();return t[e]=s,s}function Be(t,e,i){return k(t)?t(e,i):t}const Ne=(t,e)=>!0===t?e:"string"==typeof t?y(e,t):void 0;function We(t,e,i,s,n){for(const o of e){const e=Ne(i,o);if(e){t.add(e);const o=Be(e._fallback,i,n);if(M(o)&&o!==i&&o!==s)return o}else if(!1===e&&M(s)&&i!==s)return null}return!1}function je(t,e,i,o){const a=e._rootScopes,r=Be(e._fallback,i,o),l=[...t,...a],h=new Set;h.add(o);let c=He(h,l,i,r||i,o);return null!==c&&((!M(r)||r===i||(c=He(h,l,r,c,o),null!==c))&&Ee(Array.from(h),[""],a,r,(()=>function(t,e,i){const o=t._getTarget();e in o||(o[e]={});const a=o[e];if(s(a)&&n(i))return i;return a}(e,i,o))))}function He(t,e,i,s,n){for(;i;)i=We(t,e,i,s,n);return i}function $e(t,e){for(const i of e){if(!i)continue;const e=i[t];if(M(e))return e}}function Ye(t){let e=t._keys;return e||(e=t._keys=function(t){const e=new Set;for(const i of t)for(const t of Object.keys(i).filter((t=>!t.startsWith("_"))))e.add(t);return Array.from(e)}(t._scopes)),e}function Ue(t,e,i,s){const{iScale:n}=t,{key:o="r"}=this._parsing,a=new Array(s);let r,l,h,c;for(r=0,l=s;r<l;++r)h=r+i,c=e[h],a[r]={r:n.parse(y(c,o),h)};return a}const Xe=Number.EPSILON||1e-14,qe=(t,e)=>e<t.length&&!t[e].skip&&t[e],Ke=t=>"x"===t?"y":"x";function Ge(t,e,i,s){const n=t.skip?e:t,o=e,a=i.skip?e:i,r=X(o,n),l=X(a,o);let h=r/(r+l),c=l/(r+l);h=isNaN(h)?0:h,c=isNaN(c)?0:c;const d=s*h,u=s*c;return{previous:{x:o.x-d*(a.x-n.x),y:o.y-d*(a.y-n.y)},next:{x:o.x+u*(a.x-n.x),y:o.y+u*(a.y-n.y)}}}function Ze(t,e="x"){const i=Ke(e),s=t.length,n=Array(s).fill(0),o=Array(s);let a,r,l,h=qe(t,0);for(a=0;a<s;++a)if(r=l,l=h,h=qe(t,a+1),l){if(h){const t=h[e]-l[e];n[a]=0!==t?(h[i]-l[i])/t:0}o[a]=r?h?z(n[a-1])!==z(n[a])?0:(n[a-1]+n[a])/2:n[a-1]:n[a]}!function(t,e,i){const s=t.length;let n,o,a,r,l,h=qe(t,0);for(let c=0;c<s-1;++c)l=h,h=qe(t,c+1),l&&h&&(N(e[c],0,Xe)?i[c]=i[c+1]=0:(n=i[c]/e[c],o=i[c+1]/e[c],r=Math.pow(n,2)+Math.pow(o,2),r<=9||(a=3/Math.sqrt(r),i[c]=n*a*e[c],i[c+1]=o*a*e[c])))}(t,n,o),function(t,e,i="x"){const s=Ke(i),n=t.length;let o,a,r,l=qe(t,0);for(let h=0;h<n;++h){if(a=r,r=l,l=qe(t,h+1),!r)continue;const n=r[i],c=r[s];a&&(o=(n-a[i])/3,r[`cp1${i}`]=n-o,r[`cp1${s}`]=c-o*e[h]),l&&(o=(l[i]-n)/3,r[`cp2${i}`]=n+o,r[`cp2${s}`]=c+o*e[h])}}(t,o,e)}function Je(t,e,i){return Math.max(Math.min(t,i),e)}function Qe(t,e,i,s,n){let o,a,r,l;if(e.spanGaps&&(t=t.filter((t=>!t.skip))),"monotone"===e.cubicInterpolationMode)Ze(t,n);else{let i=s?t[t.length-1]:t[0];for(o=0,a=t.length;o<a;++o)r=t[o],l=Ge(i,r,t[Math.min(o+1,a-(s?0:1))%a],e.tension),r.cp1x=l.previous.x,r.cp1y=l.previous.y,r.cp2x=l.next.x,r.cp2y=l.next.y,i=r}e.capBezierPoints&&function(t,e){let i,s,n,o,a,r=Se(t[0],e);for(i=0,s=t.length;i<s;++i)a=o,o=r,r=i<s-1&&Se(t[i+1],e),o&&(n=t[i],a&&(n.cp1x=Je(n.cp1x,e.left,e.right),n.cp1y=Je(n.cp1y,e.top,e.bottom)),r&&(n.cp2x=Je(n.cp2x,e.left,e.right),n.cp2y=Je(n.cp2y,e.top,e.bottom)))}(t,i)}const ti=t=>0===t||1===t,ei=(t,e,i)=>-Math.pow(2,10*(t-=1))*Math.sin((t-e)*O/i),ii=(t,e,i)=>Math.pow(2,-10*t)*Math.sin((t-e)*O/i)+1,si={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>1-Math.cos(t*L),easeOutSine:t=>Math.sin(t*L),easeInOutSine:t=>-.5*(Math.cos(D*t)-1),easeInExpo:t=>0===t?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>1===t?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>ti(t)?t:t<.5?.5*Math.pow(2,10*(2*t-1)):.5*(2-Math.pow(2,-10*(2*t-1))),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>ti(t)?t:ei(t,.075,.3),easeOutElastic:t=>ti(t)?t:ii(t,.075,.3),easeInOutElastic(t){const e=.1125;return ti(t)?t:t<.5?.5*ei(2*t,e,.45):.5+.5*ii(2*t-1,e,.45)},easeInBack(t){const e=1.70158;return t*t*((e+1)*t-e)},easeOutBack(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},easeInBounce:t=>1-si.easeOutBounce(1-t),easeOutBounce(t){const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},easeInOutBounce:t=>t<.5?.5*si.easeInBounce(2*t):.5*si.easeOutBounce(2*t-1)+.5};function ni(t,e,i,s){return{x:t.x+i*(e.x-t.x),y:t.y+i*(e.y-t.y)}}function oi(t,e,i,s){return{x:t.x+i*(e.x-t.x),y:"middle"===s?i<.5?t.y:e.y:"after"===s?i<1?t.y:e.y:i>0?e.y:t.y}}function ai(t,e,i,s){const n={x:t.cp2x,y:t.cp2y},o={x:e.cp1x,y:e.cp1y},a=ni(t,n,i),r=ni(n,o,i),l=ni(o,e,i),h=ni(a,r,i),c=ni(r,l,i);return ni(h,c,i)}const ri=new Map;function li(t,e,i){return function(t,e){e=e||{};const i=t+JSON.stringify(e);let s=ri.get(i);return s||(s=new Intl.NumberFormat(t,e),ri.set(i,s)),s}(e,i).format(t)}const hi=new RegExp(/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/),ci=new RegExp(/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/);function di(t,e){const i=(""+t).match(hi);if(!i||"normal"===i[1])return 1.2*e;switch(t=+i[2],i[3]){case"px":return t;case"%":t/=100}return e*t}function ui(t,e){const i={},s=n(e),o=s?Object.keys(e):e,a=n(t)?s?i=>r(t[i],t[e[i]]):e=>t[e]:()=>t;for(const t of o)i[t]=+a(t)||0;return i}function fi(t){return ui(t,{top:"y",right:"x",bottom:"y",left:"x"})}function gi(t){return ui(t,["topLeft","topRight","bottomLeft","bottomRight"])}function pi(t){const e=fi(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function mi(t,e){t=t||{},e=e||ne.font;let i=r(t.size,e.size);"string"==typeof i&&(i=parseInt(i,10));let s=r(t.style,e.style);s&&!(""+s).match(ci)&&(console.warn('Invalid font style specified: "'+s+'"'),s="");const n={family:r(t.family,e.family),lineHeight:di(r(t.lineHeight,e.lineHeight),i),size:i,style:s,weight:r(t.weight,e.weight),string:""};return n.string=xe(n),n}function bi(t,e,i,n){let o,a,r,l=!0;for(o=0,a=t.length;o<a;++o)if(r=t[o],void 0!==r&&(void 0!==e&&"function"==typeof r&&(r=r(e),l=!1),void 0!==i&&s(r)&&(r=r[i%r.length],l=!1),void 0!==r))return n&&!l&&(n.cacheable=!1),r}function xi(t,e,i){const{min:s,max:n}=t,o=h(e,(n-s)/2),a=(t,e)=>i&&0===t?0:t+e;return{min:a(s,-Math.abs(o)),max:a(n,o)}}function _i(t,e){return Object.assign(Object.create(t),e)}function yi(t,e,i){return t?function(t,e){return{x:i=>t+t+e-i,setWidth(t){e=t},textAlign:t=>"center"===t?t:"right"===t?"left":"right",xPlus:(t,e)=>t-e,leftForLtr:(t,e)=>t-e}}(e,i):{x:t=>t,setWidth(t){},textAlign:t=>t,xPlus:(t,e)=>t+e,leftForLtr:(t,e)=>t}}function vi(t,e){let i,s;"ltr"!==e&&"rtl"!==e||(i=t.canvas.style,s=[i.getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",e,"important"),t.prevTextDirection=s)}function wi(t,e){void 0!==e&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function Mi(t){return"angle"===t?{between:G,compare:q,normalize:K}:{between:Q,compare:(t,e)=>t-e,normalize:t=>t}}function ki({start:t,end:e,count:i,loop:s,style:n}){return{start:t%i,end:e%i,loop:s&&(e-t+1)%i==0,style:n}}function Si(t,e,i){if(!i)return[t];const{property:s,start:n,end:o}=i,a=e.length,{compare:r,between:l,normalize:h}=Mi(s),{start:c,end:d,loop:u,style:f}=function(t,e,i){const{property:s,start:n,end:o}=i,{between:a,normalize:r}=Mi(s),l=e.length;let h,c,{start:d,end:u,loop:f}=t;if(f){for(d+=l,u+=l,h=0,c=l;h<c&&a(r(e[d%l][s]),n,o);++h)d--,u--;d%=l,u%=l}return u<d&&(u+=l),{start:d,end:u,loop:f,style:t.style}}(t,e,i),g=[];let p,m,b,x=!1,_=null;const y=()=>x||l(n,b,p)&&0!==r(n,b),v=()=>!x||0===r(o,p)||l(o,b,p);for(let t=c,i=c;t<=d;++t)m=e[t%a],m.skip||(p=h(m[s]),p!==b&&(x=l(p,n,o),null===_&&y()&&(_=0===r(p,n)?t:i),null!==_&&v()&&(g.push(ki({start:_,end:t,loop:u,count:a,style:f})),_=null),i=t,b=p));return null!==_&&g.push(ki({start:_,end:d,loop:u,count:a,style:f})),g}function Pi(t,e){const i=[],s=t.segments;for(let n=0;n<s.length;n++){const o=Si(s[n],t.points,e);o.length&&i.push(...o)}return i}function Di(t,e){const i=t.points,s=t.options.spanGaps,n=i.length;if(!n)return[];const o=!!t._loop,{start:a,end:r}=function(t,e,i,s){let n=0,o=e-1;if(i&&!s)for(;n<e&&!t[n].skip;)n++;for(;n<e&&t[n].skip;)n++;for(n%=e,i&&(o+=n);o>n&&t[o%e].skip;)o--;return o%=e,{start:n,end:o}}(i,n,o,s);if(!0===s)return Oi(t,[{start:a,end:r,loop:o}],i,e);return Oi(t,function(t,e,i,s){const n=t.length,o=[];let a,r=e,l=t[e];for(a=e+1;a<=i;++a){const i=t[a%n];i.skip||i.stop?l.skip||(s=!1,o.push({start:e%n,end:(a-1)%n,loop:s}),e=r=i.stop?a:null):(r=a,l.skip&&(e=a)),l=i}return null!==r&&o.push({start:e%n,end:r%n,loop:s}),o}(i,a,r<a?r+n:r,!!t._fullLoop&&0===a&&r===n-1),i,e)}function Oi(t,e,i,s){return s&&s.setContext&&i?function(t,e,i,s){const n=t._chart.getContext(),o=Ci(t.options),{_datasetIndex:a,options:{spanGaps:r}}=t,l=i.length,h=[];let c=o,d=e[0].start,u=d;function f(t,e,s,n){const o=r?-1:1;if(t!==e){for(t+=l;i[t%l].skip;)t-=o;for(;i[e%l].skip;)e+=o;t%l!=e%l&&(h.push({start:t%l,end:e%l,loop:s,style:n}),c=n,d=e%l)}}for(const t of e){d=r?d:t.start;let e,o=i[d%l];for(u=d+1;u<=t.end;u++){const r=i[u%l];e=Ci(s.setContext(_i(n,{type:"segment",p0:o,p1:r,p0DataIndex:(u-1)%l,p1DataIndex:u%l,datasetIndex:a}))),Ai(e,c)&&f(d,u-1,t.loop,c),o=r,c=e}d<u-1&&f(d,u-1,t.loop,c)}return h}(t,e,i,s):e}function Ci(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function Ai(t,e){return e&&JSON.stringify(t)!==JSON.stringify(e)}var Ti=Object.freeze({__proto__:null,easingEffects:si,isPatternOrGradient:Zt,color:Jt,getHoverColor:Qt,noop:t,uid:e,isNullOrUndef:i,isArray:s,isObject:n,isFinite:o,finiteOrDefault:a,valueOrDefault:r,toPercentage:l,toDimension:h,callback:c,each:d,_elementsEqual:u,clone:f,_merger:p,merge:m,mergeIf:b,_mergerIf:x,_deprecated:function(t,e,i,s){void 0!==e&&console.warn(t+': "'+i+'" is deprecated. Please use "'+s+'" instead')},resolveObjectKey:y,_splitKey:v,_capitalize:w,defined:M,isFunction:k,setsEqual:S,_isClickEvent:P,toFontString:xe,_measureText:_e,_longestText:ye,_alignPixel:ve,clearCanvas:we,drawPoint:Me,drawPointLegend:ke,_isPointInArea:Se,clipArea:Pe,unclipArea:De,_steppedLineTo:Oe,_bezierCurveTo:Ce,renderText:Ae,addRoundedRectPath:Le,_lookup:tt,_lookupByKey:et,_rlookupByKey:it,_filterBetween:st,listenArrayEvents:ot,unlistenArrayEvents:at,_arrayUnique:rt,_createResolver:Ee,_attachContext:Re,_descriptors:Ie,_parseObjectDataRadialScale:Ue,splineCurve:Ge,splineCurveMonotone:Ze,_updateBezierControlPoints:Qe,_isDomSupported:oe,_getParentNode:ae,getStyle:he,getRelativePosition:ue,getMaximumSize:ge,retinaScale:pe,supportsEventListenerOptions:me,readUsedSize:be,fontString:function(t,e,i){return e+" "+t+"px "+i},requestAnimFrame:lt,throttled:ht,debounce:ct,_toLeftRightCenter:dt,_alignStartEnd:ut,_textX:ft,_getStartAndCountOfVisiblePoints:gt,_scaleRangesChanged:pt,_pointInLine:ni,_steppedInterpolation:oi,_bezierInterpolation:ai,formatNumber:li,toLineHeight:di,_readValueToProps:ui,toTRBL:fi,toTRBLCorners:gi,toPadding:pi,toFont:mi,resolve:bi,_addGrace:xi,createContext:_i,PI:D,TAU:O,PITAU:C,INFINITY:A,RAD_PER_DEG:T,HALF_PI:L,QUARTER_PI:E,TWO_THIRDS_PI:R,log10:I,sign:z,niceNum:F,_factorize:V,isNumber:B,almostEquals:N,almostWhole:W,_setMinAndMaxByKey:j,toRadians:H,toDegrees:$,_decimalPlaces:Y,getAngleFromPoint:U,distanceBetweenPoints:X,_angleDiff:q,_normalizeAngle:K,_angleBetween:G,_limitValue:Z,_int16Range:J,_isBetween:Q,getRtlAdapter:yi,overrideTextDirection:vi,restoreTextDirection:wi,_boundSegment:Si,_boundSegments:Pi,_computeSegments:Di});function Li(t,e,i,s){const{controller:n,data:o,_sorted:a}=t,r=n._cachedMeta.iScale;if(r&&e===r.axis&&"r"!==e&&a&&o.length){const t=r._reversePixels?it:et;if(!s)return t(o,e,i);if(n._sharedOptions){const s=o[0],n="function"==typeof s.getRange&&s.getRange(e);if(n){const s=t(o,e,i-n),a=t(o,e,i+n);return{lo:s.lo,hi:a.hi}}}}return{lo:0,hi:o.length-1}}function Ei(t,e,i,s,n){const o=t.getSortedVisibleDatasetMetas(),a=i[e];for(let t=0,i=o.length;t<i;++t){const{index:i,data:r}=o[t],{lo:l,hi:h}=Li(o[t],e,a,n);for(let t=l;t<=h;++t){const e=r[t];e.skip||s(e,i,t)}}}function Ri(t,e,i,s,n){const o=[];if(!n&&!t.isPointInArea(e))return o;return Ei(t,i,e,(function(i,a,r){(n||Se(i,t.chartArea,0))&&i.inRange(e.x,e.y,s)&&o.push({element:i,datasetIndex:a,index:r})}),!0),o}function Ii(t,e,i,s,n,o){let a=[];const r=function(t){const e=-1!==t.indexOf("x"),i=-1!==t.indexOf("y");return function(t,s){const n=e?Math.abs(t.x-s.x):0,o=i?Math.abs(t.y-s.y):0;return Math.sqrt(Math.pow(n,2)+Math.pow(o,2))}}(i);let l=Number.POSITIVE_INFINITY;return Ei(t,i,e,(function(i,h,c){const d=i.inRange(e.x,e.y,n);if(s&&!d)return;const u=i.getCenterPoint(n);if(!(!!o||t.isPointInArea(u))&&!d)return;const f=r(e,u);f<l?(a=[{element:i,datasetIndex:h,index:c}],l=f):f===l&&a.push({element:i,datasetIndex:h,index:c})})),a}function zi(t,e,i,s,n,o){return o||t.isPointInArea(e)?"r"!==i||s?Ii(t,e,i,s,n,o):function(t,e,i,s){let n=[];return Ei(t,i,e,(function(t,i,o){const{startAngle:a,endAngle:r}=t.getProps(["startAngle","endAngle"],s),{angle:l}=U(t,{x:e.x,y:e.y});G(l,a,r)&&n.push({element:t,datasetIndex:i,index:o})})),n}(t,e,i,n):[]}function Fi(t,e,i,s,n){const o=[],a="x"===i?"inXRange":"inYRange";let r=!1;return Ei(t,i,e,((t,s,l)=>{t[a](e[i],n)&&(o.push({element:t,datasetIndex:s,index:l}),r=r||t.inRange(e.x,e.y,n))})),s&&!r?[]:o}var Vi={evaluateInteractionItems:Ei,modes:{index(t,e,i,s){const n=ue(e,t),o=i.axis||"x",a=i.includeInvisible||!1,r=i.intersect?Ri(t,n,o,s,a):zi(t,n,o,!1,s,a),l=[];return r.length?(t.getSortedVisibleDatasetMetas().forEach((t=>{const e=r[0].index,i=t.data[e];i&&!i.skip&&l.push({element:i,datasetIndex:t.index,index:e})})),l):[]},dataset(t,e,i,s){const n=ue(e,t),o=i.axis||"xy",a=i.includeInvisible||!1;let r=i.intersect?Ri(t,n,o,s,a):zi(t,n,o,!1,s,a);if(r.length>0){const e=r[0].datasetIndex,i=t.getDatasetMeta(e).data;r=[];for(let t=0;t<i.length;++t)r.push({element:i[t],datasetIndex:e,index:t})}return r},point:(t,e,i,s)=>Ri(t,ue(e,t),i.axis||"xy",s,i.includeInvisible||!1),nearest(t,e,i,s){const n=ue(e,t),o=i.axis||"xy",a=i.includeInvisible||!1;return zi(t,n,o,i.intersect,s,a)},x:(t,e,i,s)=>Fi(t,ue(e,t),"x",i.intersect,s),y:(t,e,i,s)=>Fi(t,ue(e,t),"y",i.intersect,s)}};const Bi=["left","top","right","bottom"];function Ni(t,e){return t.filter((t=>t.pos===e))}function Wi(t,e){return t.filter((t=>-1===Bi.indexOf(t.pos)&&t.box.axis===e))}function ji(t,e){return t.sort(((t,i)=>{const s=e?i:t,n=e?t:i;return s.weight===n.weight?s.index-n.index:s.weight-n.weight}))}function Hi(t,e){const i=function(t){const e={};for(const i of t){const{stack:t,pos:s,stackWeight:n}=i;if(!t||!Bi.includes(s))continue;const o=e[t]||(e[t]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=n}return e}(t),{vBoxMaxWidth:s,hBoxMaxHeight:n}=e;let o,a,r;for(o=0,a=t.length;o<a;++o){r=t[o];const{fullSize:a}=r.box,l=i[r.stack],h=l&&r.stackWeight/l.weight;r.horizontal?(r.width=h?h*s:a&&e.availableWidth,r.height=n):(r.width=s,r.height=h?h*n:a&&e.availableHeight)}return i}function $i(t,e,i,s){return Math.max(t[i],e[i])+Math.max(t[s],e[s])}function Yi(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function Ui(t,e,i,s){const{pos:o,box:a}=i,r=t.maxPadding;if(!n(o)){i.size&&(t[o]-=i.size);const e=s[i.stack]||{size:0,count:1};e.size=Math.max(e.size,i.horizontal?a.height:a.width),i.size=e.size/e.count,t[o]+=i.size}a.getPadding&&Yi(r,a.getPadding());const l=Math.max(0,e.outerWidth-$i(r,t,"left","right")),h=Math.max(0,e.outerHeight-$i(r,t,"top","bottom")),c=l!==t.w,d=h!==t.h;return t.w=l,t.h=h,i.horizontal?{same:c,other:d}:{same:d,other:c}}function Xi(t,e){const i=e.maxPadding;function s(t){const s={left:0,top:0,right:0,bottom:0};return t.forEach((t=>{s[t]=Math.max(e[t],i[t])})),s}return s(t?["left","right"]:["top","bottom"])}function qi(t,e,i,s){const n=[];let o,a,r,l,h,c;for(o=0,a=t.length,h=0;o<a;++o){r=t[o],l=r.box,l.update(r.width||e.w,r.height||e.h,Xi(r.horizontal,e));const{same:a,other:d}=Ui(e,i,r,s);h|=a&&n.length,c=c||d,l.fullSize||n.push(r)}return h&&qi(n,e,i,s)||c}function Ki(t,e,i,s,n){t.top=i,t.left=e,t.right=e+s,t.bottom=i+n,t.width=s,t.height=n}function Gi(t,e,i,s){const n=i.padding;let{x:o,y:a}=e;for(const r of t){const t=r.box,l=s[r.stack]||{count:1,placed:0,weight:1},h=r.stackWeight/l.weight||1;if(r.horizontal){const s=e.w*h,o=l.size||t.height;M(l.start)&&(a=l.start),t.fullSize?Ki(t,n.left,a,i.outerWidth-n.right-n.left,o):Ki(t,e.left+l.placed,a,s,o),l.start=a,l.placed+=s,a=t.bottom}else{const s=e.h*h,a=l.size||t.width;M(l.start)&&(o=l.start),t.fullSize?Ki(t,o,n.top,a,i.outerHeight-n.bottom-n.top):Ki(t,o,e.top+l.placed,a,s),l.start=o,l.placed+=s,o=t.right}}e.x=o,e.y=a}ne.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}});var Zi={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(t){e.draw(t)}}]},t.boxes.push(e)},removeBox(t,e){const i=t.boxes?t.boxes.indexOf(e):-1;-1!==i&&t.boxes.splice(i,1)},configure(t,e,i){e.fullSize=i.fullSize,e.position=i.position,e.weight=i.weight},update(t,e,i,s){if(!t)return;const n=pi(t.options.layout.padding),o=Math.max(e-n.width,0),a=Math.max(i-n.height,0),r=function(t){const e=function(t){const e=[];let i,s,n,o,a,r;for(i=0,s=(t||[]).length;i<s;++i)n=t[i],({position:o,options:{stack:a,stackWeight:r=1}}=n),e.push({index:i,box:n,pos:o,horizontal:n.isHorizontal(),weight:n.weight,stack:a&&o+a,stackWeight:r});return e}(t),i=ji(e.filter((t=>t.box.fullSize)),!0),s=ji(Ni(e,"left"),!0),n=ji(Ni(e,"right")),o=ji(Ni(e,"top"),!0),a=ji(Ni(e,"bottom")),r=Wi(e,"x"),l=Wi(e,"y");return{fullSize:i,leftAndTop:s.concat(o),rightAndBottom:n.concat(l).concat(a).concat(r),chartArea:Ni(e,"chartArea"),vertical:s.concat(n).concat(l),horizontal:o.concat(a).concat(r)}}(t.boxes),l=r.vertical,h=r.horizontal;d(t.boxes,(t=>{"function"==typeof t.beforeLayout&&t.beforeLayout()}));const c=l.reduce(((t,e)=>e.box.options&&!1===e.box.options.display?t:t+1),0)||1,u=Object.freeze({outerWidth:e,outerHeight:i,padding:n,availableWidth:o,availableHeight:a,vBoxMaxWidth:o/2/c,hBoxMaxHeight:a/2}),f=Object.assign({},n);Yi(f,pi(s));const g=Object.assign({maxPadding:f,w:o,h:a,x:n.left,y:n.top},n),p=Hi(l.concat(h),u);qi(r.fullSize,g,u,p),qi(l,g,u,p),qi(h,g,u,p)&&qi(l,g,u,p),function(t){const e=t.maxPadding;function i(i){const s=Math.max(e[i]-t[i],0);return t[i]+=s,s}t.y+=i("top"),t.x+=i("left"),i("right"),i("bottom")}(g),Gi(r.leftAndTop,g,u,p),g.x+=g.w,g.y+=g.h,Gi(r.rightAndBottom,g,u,p),t.chartArea={left:g.left,top:g.top,right:g.left+g.w,bottom:g.top+g.h,height:g.h,width:g.w},d(r.chartArea,(e=>{const i=e.box;Object.assign(i,t.chartArea),i.update(g.w,g.h,{left:0,top:0,right:0,bottom:0})}))}};class Ji{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,s){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,s?Math.floor(e/s):i)}}isAttached(t){return!0}updateConfig(t){}}class Qi extends Ji{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const ts={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},es=t=>null===t||""===t;const is=!!me&&{passive:!0};function ss(t,e,i){t.canvas.removeEventListener(e,i,is)}function ns(t,e){for(const i of t)if(i===e||i.contains(e))return!0}function os(t,e,i){const s=t.canvas,n=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||ns(i.addedNodes,s),e=e&&!ns(i.removedNodes,s);e&&i()}));return n.observe(document,{childList:!0,subtree:!0}),n}function as(t,e,i){const s=t.canvas,n=new MutationObserver((t=>{let e=!1;for(const i of t)e=e||ns(i.removedNodes,s),e=e&&!ns(i.addedNodes,s);e&&i()}));return n.observe(document,{childList:!0,subtree:!0}),n}const rs=new Map;let ls=0;function hs(){const t=window.devicePixelRatio;t!==ls&&(ls=t,rs.forEach(((e,i)=>{i.currentDevicePixelRatio!==t&&e()})))}function cs(t,e,i){const s=t.canvas,n=s&&ae(s);if(!n)return;const o=ht(((t,e)=>{const s=n.clientWidth;i(t,e),s<n.clientWidth&&i()}),window),a=new ResizeObserver((t=>{const e=t[0],i=e.contentRect.width,s=e.contentRect.height;0===i&&0===s||o(i,s)}));return a.observe(n),function(t,e){rs.size||window.addEventListener("resize",hs),rs.set(t,e)}(t,o),a}function ds(t,e,i){i&&i.disconnect(),"resize"===e&&function(t){rs.delete(t),rs.size||window.removeEventListener("resize",hs)}(t)}function us(t,e,i){const s=t.canvas,n=ht((e=>{null!==t.ctx&&i(function(t,e){const i=ts[t.type]||t.type,{x:s,y:n}=ue(t,e);return{type:i,chart:e,native:t,x:void 0!==s?s:null,y:void 0!==n?n:null}}(e,t))}),t,(t=>{const e=t[0];return[e,e.offsetX,e.offsetY]}));return function(t,e,i){t.addEventListener(e,i,is)}(s,e,n),n}class fs extends Ji{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(function(t,e){const i=t.style,s=t.getAttribute("height"),n=t.getAttribute("width");if(t.$chartjs={initial:{height:s,width:n,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",es(n)){const e=be(t,"width");void 0!==e&&(t.width=e)}if(es(s))if(""===t.style.height)t.height=t.width/(e||2);else{const e=be(t,"height");void 0!==e&&(t.height=e)}}(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e.$chartjs)return!1;const s=e.$chartjs.initial;["height","width"].forEach((t=>{const n=s[t];i(n)?e.removeAttribute(t):e.setAttribute(t,n)}));const n=s.style||{};return Object.keys(n).forEach((t=>{e.style[t]=n[t]})),e.width=e.width,delete e.$chartjs,!0}addEventListener(t,e,i){this.removeEventListener(t,e);const s=t.$proxies||(t.$proxies={}),n={attach:os,detach:as,resize:cs}[e]||us;s[e]=n(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),s=i[e];if(!s)return;({attach:ds,detach:ds,resize:ds}[e]||ss)(t,e,s),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,s){return ge(t,e,i,s)}isAttached(t){const e=ae(t);return!(!e||!e.isConnected)}}function gs(t){return!oe()||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas?Qi:fs}var ps=Object.freeze({__proto__:null,_detectPlatform:gs,BasePlatform:Ji,BasicPlatform:Qi,DomPlatform:fs});const ms="transparent",bs={boolean:(t,e,i)=>i>.5?e:t,color(t,e,i){const s=Jt(t||ms),n=s.valid&&Jt(e||ms);return n&&n.valid?n.mix(s,i).hexString():e},number:(t,e,i)=>t+(e-t)*i};class xs{constructor(t,e,i,s){const n=e[i];s=bi([t.to,s,n,t.from]);const o=bi([t.from,n,s]);this._active=!0,this._fn=t.fn||bs[t.type||typeof o],this._easing=si[t.easing]||si.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=s,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const s=this._target[this._prop],n=i-this._start,o=this._duration-n;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=n,this._loop=!!t.loop,this._to=bi([t.to,e,s,t.from]),this._from=bi([t.from,s,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,s=this._prop,n=this._from,o=this._loop,a=this._to;let r;if(this._active=n!==a&&(o||e<i),!this._active)return this._target[s]=a,void this._notify(!0);e<0?this._target[s]=n:(r=e/i%2,r=o&&r>1?2-r:r,r=this._easing(Math.min(1,Math.max(0,r))),this._target[s]=this._fn(n,a,r))}wait(){const t=this._promises||(this._promises=[]);return new Promise(((e,i)=>{t.push({res:e,rej:i})}))}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let t=0;t<i.length;t++)i[t][e]()}}ne.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0});const _s=Object.keys(ne.animation);ne.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>"onProgress"!==t&&"onComplete"!==t&&"fn"!==t}),ne.set("animations",{colors:{type:"color",properties:["color","borderColor","backgroundColor"]},numbers:{type:"number",properties:["x","y","borderWidth","radius","tension"]}}),ne.describe("animations",{_fallback:"animation"}),ne.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>0|t}}}});class ys{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!n(t))return;const e=this._properties;Object.getOwnPropertyNames(t).forEach((i=>{const o=t[i];if(!n(o))return;const a={};for(const t of _s)a[t]=o[t];(s(o.properties)&&o.properties||[i]).forEach((t=>{t!==i&&e.has(t)||e.set(t,a)}))}))}_animateOptions(t,e){const i=e.options,s=function(t,e){if(!e)return;let i=t.options;if(!i)return void(t.options=e);i.$shared&&(t.options=i=Object.assign({},i,{$shared:!1,$animations:{}}));return i}(t,i);if(!s)return[];const n=this._createAnimations(s,i);return i.$shared&&function(t,e){const i=[],s=Object.keys(e);for(let e=0;e<s.length;e++){const n=t[s[e]];n&&n.active()&&i.push(n.wait())}return Promise.all(i)}(t.options.$animations,i).then((()=>{t.options=i}),(()=>{})),n}_createAnimations(t,e){const i=this._properties,s=[],n=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let r;for(r=o.length-1;r>=0;--r){const l=o[r];if("$"===l.charAt(0))continue;if("options"===l){s.push(...this._animateOptions(t,e));continue}const h=e[l];let c=n[l];const d=i.get(l);if(c){if(d&&c.active()){c.update(d,h,a);continue}c.cancel()}d&&d.duration?(n[l]=c=new xs(d,t,l,h),s.push(c)):t[l]=h}return s}update(t,e){if(0===this._properties.size)return void Object.assign(t,e);const i=this._createAnimations(t,e);return i.length?(mt.add(this._chart,i),!0):void 0}}function vs(t,e){const i=t&&t.options||{},s=i.reverse,n=void 0===i.min?e:0,o=void 0===i.max?e:0;return{start:s?o:n,end:s?n:o}}function ws(t,e){const i=[],s=t._getSortedDatasetMetas(e);let n,o;for(n=0,o=s.length;n<o;++n)i.push(s[n].index);return i}function Ms(t,e,i,s={}){const n=t.keys,a="single"===s.mode;let r,l,h,c;if(null!==e){for(r=0,l=n.length;r<l;++r){if(h=+n[r],h===i){if(s.all)continue;break}c=t.values[h],o(c)&&(a||0===e||z(e)===z(c))&&(e+=c)}return e}}function ks(t,e){const i=t&&t.options.stacked;return i||void 0===i&&void 0!==e.stack}function Ss(t,e,i){const s=t[e]||(t[e]={});return s[i]||(s[i]={})}function Ps(t,e,i,s){for(const n of e.getMatchingVisibleMetas(s).reverse()){const e=t[n.index];if(i&&e>0||!i&&e<0)return n.index}return null}function Ds(t,e){const{chart:i,_cachedMeta:s}=t,n=i._stacks||(i._stacks={}),{iScale:o,vScale:a,index:r}=s,l=o.axis,h=a.axis,c=function(t,e,i){return`${t.id}.${e.id}.${i.stack||i.type}`}(o,a,s),d=e.length;let u;for(let t=0;t<d;++t){const i=e[t],{[l]:o,[h]:d}=i;u=(i._stacks||(i._stacks={}))[h]=Ss(n,c,o),u[r]=d,u._top=Ps(u,a,!0,s.type),u._bottom=Ps(u,a,!1,s.type)}}function Os(t,e){const i=t.scales;return Object.keys(i).filter((t=>i[t].axis===e)).shift()}function Cs(t,e){const i=t.controller.index,s=t.vScale&&t.vScale.axis;if(s){e=e||t._parsed;for(const t of e){const e=t._stacks;if(!e||void 0===e[s]||void 0===e[s][i])return;delete e[s][i]}}}const As=t=>"reset"===t||"none"===t,Ts=(t,e)=>e?t:Object.assign({},t);class Ls{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=ks(t.vScale,t),this.addElements()}updateIndex(t){this.index!==t&&Cs(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),s=(t,e,i,s)=>"x"===t?e:"r"===t?s:i,n=e.xAxisID=r(i.xAxisID,Os(t,"x")),o=e.yAxisID=r(i.yAxisID,Os(t,"y")),a=e.rAxisID=r(i.rAxisID,Os(t,"r")),l=e.indexAxis,h=e.iAxisID=s(l,n,o,a),c=e.vAxisID=s(l,o,n,a);e.xScale=this.getScaleForId(n),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(h),e.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&at(this._data,this),t._stacked&&Cs(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(n(e))this._data=function(t){const e=Object.keys(t),i=new Array(e.length);let s,n,o;for(s=0,n=e.length;s<n;++s)o=e[s],i[s]={x:o,y:t[o]};return i}(e);else if(i!==e){if(i){at(i,this);const t=this._cachedMeta;Cs(t),t._parsed=[]}e&&Object.isExtensible(e)&&ot(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const n=e._stacked;e._stacked=ks(e.vScale,e),e.stack!==i.stack&&(s=!0,Cs(e),e.stack=i.stack),this._resyncElements(t),(s||n!==e._stacked)&&Ds(this,e._parsed)}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:o}=this,{iScale:a,_stacked:r}=i,l=a.axis;let h,c,d,u=0===t&&e===o.length||i._sorted,f=t>0&&i._parsed[t-1];if(!1===this._parsing)i._parsed=o,i._sorted=!0,d=o;else{d=s(o[t])?this.parseArrayData(i,o,t,e):n(o[t])?this.parseObjectData(i,o,t,e):this.parsePrimitiveData(i,o,t,e);const a=()=>null===c[l]||f&&c[l]<f[l];for(h=0;h<e;++h)i._parsed[h+t]=c=d[h],u&&(a()&&(u=!1),f=c);i._sorted=u}r&&Ds(this,d)}parsePrimitiveData(t,e,i,s){const{iScale:n,vScale:o}=t,a=n.axis,r=o.axis,l=n.getLabels(),h=n===o,c=new Array(s);let d,u,f;for(d=0,u=s;d<u;++d)f=d+i,c[d]={[a]:h||n.parse(l[f],f),[r]:o.parse(e[f],f)};return c}parseArrayData(t,e,i,s){const{xScale:n,yScale:o}=t,a=new Array(s);let r,l,h,c;for(r=0,l=s;r<l;++r)h=r+i,c=e[h],a[r]={x:n.parse(c[0],h),y:o.parse(c[1],h)};return a}parseObjectData(t,e,i,s){const{xScale:n,yScale:o}=t,{xAxisKey:a="x",yAxisKey:r="y"}=this._parsing,l=new Array(s);let h,c,d,u;for(h=0,c=s;h<c;++h)d=h+i,u=e[d],l[h]={x:n.parse(y(u,a),d),y:o.parse(y(u,r),d)};return l}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const s=this.chart,n=this._cachedMeta,o=e[t.axis];return Ms({keys:ws(s,!0),values:e._stacks[t.axis]},o,n.index,{mode:i})}updateRangeFromParsed(t,e,i,s){const n=i[e.axis];let o=null===n?NaN:n;const a=s&&i._stacks[e.axis];s&&a&&(s.values=a,o=Ms(s,n,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,s=i._parsed,n=i._sorted&&t===i.iScale,a=s.length,r=this._getOtherScale(t),l=((t,e,i)=>t&&!e.hidden&&e._stacked&&{keys:ws(i,!0),values:null})(e,i,this.chart),h={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:d}=function(t){const{min:e,max:i,minDefined:s,maxDefined:n}=t.getUserBounds();return{min:s?e:Number.NEGATIVE_INFINITY,max:n?i:Number.POSITIVE_INFINITY}}(r);let u,f;function g(){f=s[u];const e=f[r.axis];return!o(f[t.axis])||c>e||d<e}for(u=0;u<a&&(g()||(this.updateRangeFromParsed(h,t,f,l),!n));++u);if(n)for(u=a-1;u>=0;--u)if(!g()){this.updateRangeFromParsed(h,t,f,l);break}return h}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let s,n,a;for(s=0,n=e.length;s<n;++s)a=e[s][t.axis],o(a)&&i.push(a);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,s=e.vScale,n=this.getParsed(t);return{label:i?""+i.getLabelForValue(n[i.axis]):"",value:s?""+s.getLabelForValue(n[s.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=function(t){let e,i,s,o;return n(t)?(e=t.top,i=t.right,s=t.bottom,o=t.left):e=i=s=o=t,{top:e,right:i,bottom:s,left:o,disabled:!1===t}}(r(this.options.clip,function(t,e,i){if(!1===i)return!1;const s=vs(t,i),n=vs(e,i);return{top:n.end,right:s.end,bottom:n.start,left:s.start}}(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,s=i.data||[],n=e.chartArea,o=[],a=this._drawStart||0,r=this._drawCount||s.length-a,l=this.options.drawActiveElementsOnTop;let h;for(i.dataset&&i.dataset.draw(t,n,a,r),h=a;h<a+r;++h){const e=s[h];e.hidden||(e.active&&l?o.push(e):e.draw(t,n))}for(h=0;h<o.length;++h)o[h].draw(t,n)}getStyle(t,e){const i=e?"active":"default";return void 0===t&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const s=this.getDataset();let n;if(t>=0&&t<this._cachedMeta.data.length){const e=this._cachedMeta.data[t];n=e.$context||(e.$context=function(t,e,i){return _i(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:i,index:e,mode:"default",type:"data"})}(this.getContext(),t,e)),n.parsed=this.getParsed(t),n.raw=s.data[t],n.index=n.dataIndex=t}else n=this.$context||(this.$context=function(t,e){return _i(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),n.dataset=s,n.index=n.datasetIndex=this.index;return n.active=!!e,n.mode=i,n}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const s="active"===e,n=this._cachedDataOpts,o=t+"-"+e,a=n[o],r=this.enableOptionSharing&&M(i);if(a)return Ts(a,r);const l=this.chart.config,h=l.datasetElementScopeKeys(this._type,t),c=s?[`${t}Hover`,"hover",t,""]:[t,""],d=l.getOptionScopes(this.getDataset(),h),u=Object.keys(ne.elements[t]),f=l.resolveNamedOptions(d,u,(()=>this.getContext(i,s)),c);return f.$shared&&(f.$shared=r,n[o]=Object.freeze(Ts(f,r))),f}_resolveAnimations(t,e,i){const s=this.chart,n=this._cachedDataOpts,o=`animation-${e}`,a=n[o];if(a)return a;let r;if(!1!==s.options.animation){const s=this.chart.config,n=s.datasetAnimationScopeKeys(this._type,e),o=s.getOptionScopes(this.getDataset(),n);r=s.createResolver(o,this.getContext(t,i,e))}const l=new ys(s,r&&r.animations);return r&&r._cacheable&&(n[o]=Object.freeze(l)),l}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||As(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),s=this._sharedOptions,n=this.getSharedOptions(i),o=this.includeOptions(e,n)||n!==s;return this.updateSharedOptions(n,e,i),{sharedOptions:n,includeOptions:o}}updateElement(t,e,i,s){As(s)?Object.assign(t,i):this._resolveAnimations(e,s).update(t,i)}updateSharedOptions(t,e,i){t&&!As(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,s){t.active=s;const n=this.getStyle(e,s);this._resolveAnimations(e,i,s).update(t,{options:!s&&this.getSharedOptions(n)||n})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[t,e,i]of this._syncList)this[t](e,i);this._syncList=[];const s=i.length,n=e.length,o=Math.min(n,s);o&&this.parse(0,o),n>s?this._insertElements(s,n-s,t):n<s&&this._removeElements(n,s-n)}_insertElements(t,e,i=!0){const s=this._cachedMeta,n=s.data,o=t+e;let a;const r=t=>{for(t.length+=e,a=t.length-1;a>=o;a--)t[a]=t[a-e]};for(r(n),a=t;a<o;++a)n[a]=new this.dataElementType;this._parsing&&r(s._parsed),this.parse(t,e),i&&this.updateElements(n,t,e,"reset")}updateElements(t,e,i,s){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,e);i._stacked&&Cs(i,s)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,s]=t;this[e](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Ls.defaults={},Ls.prototype.datasetElementType=null,Ls.prototype.dataElementType=null;class Es{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return B(this.x)&&B(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach((t=>{s[t]=i[t]&&i[t].active()?i[t]._to:this[t]})),s}}Es.defaults={},Es.defaultRoutes=void 0;const Rs={values:t=>s(t)?t:""+t,numeric(t,e,i){if(0===t)return"0";const s=this.chart.options.locale;let n,o=t;if(i.length>1){const e=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(e<1e-4||e>1e15)&&(n="scientific"),o=function(t,e){let i=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;Math.abs(i)>=1&&t!==Math.floor(t)&&(i=t-Math.floor(t));return i}(t,i)}const a=I(Math.abs(o)),r=Math.max(Math.min(-1*Math.floor(a),20),0),l={notation:n,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(l,this.options.ticks.format),li(t,s,l)},logarithmic(t,e,i){if(0===t)return"0";const s=t/Math.pow(10,Math.floor(I(t)));return 1===s||2===s||5===s?Rs.numeric.call(this,t,e,i):""}};var Is={formatters:Rs};function zs(t,e){const s=t.options.ticks,n=s.maxTicksLimit||function(t){const e=t.options.offset,i=t._tickSize(),s=t._length/i+(e?0:1),n=t._maxLength/i;return Math.floor(Math.min(s,n))}(t),o=s.major.enabled?function(t){const e=[];let i,s;for(i=0,s=t.length;i<s;i++)t[i].major&&e.push(i);return e}(e):[],a=o.length,r=o[0],l=o[a-1],h=[];if(a>n)return function(t,e,i,s){let n,o=0,a=i[0];for(s=Math.ceil(s),n=0;n<t.length;n++)n===a&&(e.push(t[n]),o++,a=i[o*s])}(e,h,o,a/n),h;const c=function(t,e,i){const s=function(t){const e=t.length;let i,s;if(e<2)return!1;for(s=t[0],i=1;i<e;++i)if(t[i]-t[i-1]!==s)return!1;return s}(t),n=e.length/i;if(!s)return Math.max(n,1);const o=V(s);for(let t=0,e=o.length-1;t<e;t++){const e=o[t];if(e>n)return e}return Math.max(n,1)}(o,e,n);if(a>0){let t,s;const n=a>1?Math.round((l-r)/(a-1)):null;for(Fs(e,h,c,i(n)?0:r-n,r),t=0,s=a-1;t<s;t++)Fs(e,h,c,o[t],o[t+1]);return Fs(e,h,c,l,i(n)?e.length:l+n),h}return Fs(e,h,c),h}function Fs(t,e,i,s,n){const o=r(s,0),a=Math.min(r(n,t.length),t.length);let l,h,c,d=0;for(i=Math.ceil(i),n&&(l=n-s,i=l/Math.floor(l/i)),c=o;c<0;)d++,c=Math.round(o+d*i);for(h=Math.max(o,0);h<a;h++)h===c&&(e.push(t[h]),d++,c=Math.round(o+d*i))}ne.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawBorder:!0,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1,borderDash:[],borderDashOffset:0,borderWidth:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Is.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),ne.route("scale.ticks","color","","color"),ne.route("scale.grid","color","","borderColor"),ne.route("scale.grid","borderColor","","borderColor"),ne.route("scale.title","color","","color"),ne.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&"callback"!==t&&"parser"!==t,_indexable:t=>"borderDash"!==t&&"tickBorderDash"!==t}),ne.describe("scales",{_fallback:"scale"}),ne.describe("scale.ticks",{_scriptable:t=>"backdropPadding"!==t&&"callback"!==t,_indexable:t=>"backdropPadding"!==t});const Vs=(t,e,i)=>"top"===e||"left"===e?t[e]+i:t[e]-i;function Bs(t,e){const i=[],s=t.length/e,n=t.length;let o=0;for(;o<n;o+=s)i.push(t[Math.floor(o)]);return i}function Ns(t,e,i){const s=t.ticks.length,n=Math.min(e,s-1),o=t._startPixel,a=t._endPixel,r=1e-6;let l,h=t.getPixelForTick(n);if(!(i&&(l=1===s?Math.max(h-o,a-h):0===e?(t.getPixelForTick(1)-h)/2:(h-t.getPixelForTick(n-1))/2,h+=n<e?l:-l,h<o-r||h>a+r)))return h}function Ws(t){return t.drawTicks?t.tickLength:0}function js(t,e){if(!t.display)return 0;const i=mi(t.font,e),n=pi(t.padding);return(s(t.text)?t.text.length:1)*i.lineHeight+n.height}function Hs(t,e,i){let s=dt(t);return(i&&"right"!==e||!i&&"right"===e)&&(s=(t=>"left"===t?"right":"right"===t?"left":t)(s)),s}class $s extends Es{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:s}=this;return t=a(t,Number.POSITIVE_INFINITY),e=a(e,Number.NEGATIVE_INFINITY),i=a(i,Number.POSITIVE_INFINITY),s=a(s,Number.NEGATIVE_INFINITY),{min:a(t,i),max:a(e,s),minDefined:o(t),maxDefined:o(e)}}getMinMax(t){let e,{min:i,max:s,minDefined:n,maxDefined:o}=this.getUserBounds();if(n&&o)return{min:i,max:s};const r=this.getMatchingVisibleMetas();for(let a=0,l=r.length;a<l;++a)e=r[a].controller.getMinMax(this,t),n||(i=Math.min(i,e.min)),o||(s=Math.max(s,e.max));return i=o&&i>s?s:i,s=n&&i>s?i:s,{min:a(i,a(s,i)),max:a(s,a(i,s))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){c(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:s,grace:n,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=xi(this,n,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const r=a<this.ticks.length;this._convertTicksToLabels(r?Bs(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||"auto"===o.source)&&(this.ticks=zs(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),r&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t,e,i=this.options.reverse;this.isHorizontal()?(t=this.left,e=this.right):(t=this.top,e=this.bottom,i=!i),this._startPixel=t,this._endPixel=e,this._reversePixels=i,this._length=e-t,this._alignToPixels=this.options.alignToPixels}afterUpdate(){c(this.options.afterUpdate,[this])}beforeSetDimensions(){c(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){c(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),c(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){c(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,s,n;for(i=0,s=t.length;i<s;i++)n=t[i],n.label=c(e.callback,[n.value,i,t],this)}afterTickToLabelConversion(){c(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){c(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=this.ticks.length,s=e.minRotation||0,n=e.maxRotation;let o,a,r,l=s;if(!this._isVisible()||!e.display||s>=n||i<=1||!this.isHorizontal())return void(this.labelRotation=s);const h=this._getLabelSizes(),c=h.widest.width,d=h.highest.height,u=Z(this.chart.width-c,0,this.maxWidth);o=t.offset?this.maxWidth/i:u/(i-1),c+6>o&&(o=u/(i-(t.offset?.5:1)),a=this.maxHeight-Ws(t.grid)-e.padding-js(t.title,this.chart.options.font),r=Math.sqrt(c*c+d*d),l=$(Math.min(Math.asin(Z((h.highest.height+6)/o,-1,1)),Math.asin(Z(a/r,-1,1))-Math.asin(Z(d/r,-1,1)))),l=Math.max(s,Math.min(n,l))),this.labelRotation=l}afterCalculateLabelRotation(){c(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){c(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:s,grid:n}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const o=js(s,e.options.font);if(a?(t.width=this.maxWidth,t.height=Ws(n)+o):(t.height=this.maxHeight,t.width=Ws(n)+o),i.display&&this.ticks.length){const{first:e,last:s,widest:n,highest:o}=this._getLabelSizes(),r=2*i.padding,l=H(this.labelRotation),h=Math.cos(l),c=Math.sin(l);if(a){const e=i.mirror?0:c*n.width+h*o.height;t.height=Math.min(this.maxHeight,t.height+e+r)}else{const e=i.mirror?0:h*n.width+c*o.height;t.width=Math.min(this.maxWidth,t.width+e+r)}this._calculatePadding(e,s,c,h)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,s){const{ticks:{align:n,padding:o},position:a}=this.options,r=0!==this.labelRotation,l="top"!==a&&"x"===this.axis;if(this.isHorizontal()){const a=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let c=0,d=0;r?l?(c=s*t.width,d=i*e.height):(c=i*t.height,d=s*e.width):"start"===n?d=e.width:"end"===n?c=t.width:"inner"!==n&&(c=t.width/2,d=e.width/2),this.paddingLeft=Math.max((c-a+o)*this.width/(this.width-a),0),this.paddingRight=Math.max((d-h+o)*this.width/(this.width-h),0)}else{let i=e.height/2,s=t.height/2;"start"===n?(i=0,s=t.height):"end"===n&&(i=e.height,s=0),this.paddingTop=i+o,this.paddingBottom=s+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){c(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return"top"===e||"bottom"===e||"x"===t}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){let e,s;for(this.beforeTickToLabelConversion(),this.generateTickLabels(t),e=0,s=t.length;e<s;e++)i(t[e].label)&&(t.splice(e,1),s--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Bs(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length)}return t}_computeLabelSizes(t,e){const{ctx:n,_longestTextCache:o}=this,a=[],r=[];let l,h,c,u,f,g,p,m,b,x,_,y=0,v=0;for(l=0;l<e;++l){if(u=t[l].label,f=this._resolveTickFontOptions(l),n.font=g=f.string,p=o[g]=o[g]||{data:{},gc:[]},m=f.lineHeight,b=x=0,i(u)||s(u)){if(s(u))for(h=0,c=u.length;h<c;++h)_=u[h],i(_)||s(_)||(b=_e(n,p.data,p.gc,b,_),x+=m)}else b=_e(n,p.data,p.gc,b,u),x=m;a.push(b),r.push(x),y=Math.max(b,y),v=Math.max(x,v)}!function(t,e){d(t,(t=>{const i=t.gc,s=i.length/2;let n;if(s>e){for(n=0;n<s;++n)delete t.data[i[n]];i.splice(0,s)}}))}(o,e);const w=a.indexOf(y),M=r.indexOf(v),k=t=>({width:a[t]||0,height:r[t]||0});return{first:k(0),last:k(e-1),widest:k(w),highest:k(M),widths:a,heights:r}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return J(this._alignToPixels?ve(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=function(t,e,i){return _i(t,{tick:i,index:e,type:"tick"})}(this.getContext(),t,i))}return this.$context||(this.$context=_i(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const t=this.options.ticks,e=H(this.labelRotation),i=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),n=this._getLabelSizes(),o=t.autoSkipPadding||0,a=n?n.widest.width+o:0,r=n?n.highest.height+o:0;return this.isHorizontal()?r*i>a*s?a/i:r/s:r*s<a*i?r/i:a/s}_isVisible(){const t=this.options.display;return"auto"!==t?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,s=this.options,{grid:o,position:a}=s,l=o.offset,h=this.isHorizontal(),c=this.ticks.length+(l?1:0),d=Ws(o),u=[],f=o.setContext(this.getContext()),g=f.drawBorder?f.borderWidth:0,p=g/2,m=function(t){return ve(i,t,g)};let b,x,_,y,v,w,M,k,S,P,D,O;if("top"===a)b=m(this.bottom),w=this.bottom-d,k=b-p,P=m(t.top)+p,O=t.bottom;else if("bottom"===a)b=m(this.top),P=t.top,O=m(t.bottom)-p,w=b+p,k=this.top+d;else if("left"===a)b=m(this.right),v=this.right-d,M=b-p,S=m(t.left)+p,D=t.right;else if("right"===a)b=m(this.left),S=t.left,D=m(t.right)-p,v=b+p,M=this.left+d;else if("x"===e){if("center"===a)b=m((t.top+t.bottom)/2+.5);else if(n(a)){const t=Object.keys(a)[0],e=a[t];b=m(this.chart.scales[t].getPixelForValue(e))}P=t.top,O=t.bottom,w=b+p,k=w+d}else if("y"===e){if("center"===a)b=m((t.left+t.right)/2);else if(n(a)){const t=Object.keys(a)[0],e=a[t];b=m(this.chart.scales[t].getPixelForValue(e))}v=b-p,M=v-d,S=t.left,D=t.right}const C=r(s.ticks.maxTicksLimit,c),A=Math.max(1,Math.ceil(c/C));for(x=0;x<c;x+=A){const t=o.setContext(this.getContext(x)),e=t.lineWidth,s=t.color,n=t.borderDash||[],a=t.borderDashOffset,r=t.tickWidth,c=t.tickColor,d=t.tickBorderDash||[],f=t.tickBorderDashOffset;_=Ns(this,x,l),void 0!==_&&(y=ve(i,_,e),h?v=M=S=D=y:w=k=P=O=y,u.push({tx1:v,ty1:w,tx2:M,ty2:k,x1:S,y1:P,x2:D,y2:O,width:e,color:s,borderDash:n,borderDashOffset:a,tickWidth:r,tickColor:c,tickBorderDash:d,tickBorderDashOffset:f}))}return this._ticksLength=c,this._borderValue=b,u}_computeLabelItems(t){const e=this.axis,i=this.options,{position:o,ticks:a}=i,r=this.isHorizontal(),l=this.ticks,{align:h,crossAlign:c,padding:d,mirror:u}=a,f=Ws(i.grid),g=f+d,p=u?-d:g,m=-H(this.labelRotation),b=[];let x,_,y,v,w,M,k,S,P,D,O,C,A="middle";if("top"===o)M=this.bottom-p,k=this._getXAxisLabelAlignment();else if("bottom"===o)M=this.top+p,k=this._getXAxisLabelAlignment();else if("left"===o){const t=this._getYAxisLabelAlignment(f);k=t.textAlign,w=t.x}else if("right"===o){const t=this._getYAxisLabelAlignment(f);k=t.textAlign,w=t.x}else if("x"===e){if("center"===o)M=(t.top+t.bottom)/2+g;else if(n(o)){const t=Object.keys(o)[0],e=o[t];M=this.chart.scales[t].getPixelForValue(e)+g}k=this._getXAxisLabelAlignment()}else if("y"===e){if("center"===o)w=(t.left+t.right)/2-g;else if(n(o)){const t=Object.keys(o)[0],e=o[t];w=this.chart.scales[t].getPixelForValue(e)}k=this._getYAxisLabelAlignment(f).textAlign}"y"===e&&("start"===h?A="top":"end"===h&&(A="bottom"));const T=this._getLabelSizes();for(x=0,_=l.length;x<_;++x){y=l[x],v=y.label;const t=a.setContext(this.getContext(x));S=this.getPixelForTick(x)+a.labelOffset,P=this._resolveTickFontOptions(x),D=P.lineHeight,O=s(v)?v.length:1;const e=O/2,i=t.color,n=t.textStrokeColor,h=t.textStrokeWidth;let d,f=k;if(r?(w=S,"inner"===k&&(f=x===_-1?this.options.reverse?"left":"right":0===x?this.options.reverse?"right":"left":"center"),C="top"===o?"near"===c||0!==m?-O*D+D/2:"center"===c?-T.highest.height/2-e*D+D:-T.highest.height+D/2:"near"===c||0!==m?D/2:"center"===c?T.highest.height/2-e*D:T.highest.height-O*D,u&&(C*=-1)):(M=S,C=(1-O)*D/2),t.showLabelBackdrop){const e=pi(t.backdropPadding),i=T.heights[x],s=T.widths[x];let n=M+C-e.top,o=w-e.left;switch(A){case"middle":n-=i/2;break;case"bottom":n-=i}switch(k){case"center":o-=s/2;break;case"right":o-=s}d={left:o,top:n,width:s+e.width,height:i+e.height,color:t.backdropColor}}b.push({rotation:m,label:v,font:P,color:i,strokeColor:n,strokeWidth:h,textOffset:C,textAlign:f,textBaseline:A,translation:[w,M],backdrop:d})}return b}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-H(this.labelRotation))return"top"===t?"left":"right";let i="center";return"start"===e.align?i="left":"end"===e.align?i="right":"inner"===e.align&&(i="inner"),i}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:s,padding:n}}=this.options,o=t+n,a=this._getLabelSizes().widest.width;let r,l;return"left"===e?s?(l=this.right+n,"near"===i?r="left":"center"===i?(r="center",l+=a/2):(r="right",l+=a)):(l=this.right-o,"near"===i?r="right":"center"===i?(r="center",l-=a/2):(r="left",l=this.left)):"right"===e?s?(l=this.left+n,"near"===i?r="right":"center"===i?(r="center",l-=a/2):(r="left",l-=a)):(l=this.left+o,"near"===i?r="left":"center"===i?(r="center",l+=a/2):(r="right",l=this.right)):r="right",{textAlign:r,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;return"left"===e||"right"===e?{top:0,left:this.left,bottom:t.height,right:this.right}:"top"===e||"bottom"===e?{top:this.top,left:0,bottom:this.bottom,right:t.width}:void 0}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:s,width:n,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,s,n,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const i=this.ticks.findIndex((e=>e.value===t));if(i>=0){return e.setContext(this.getContext(i)).lineWidth}return 0}drawGrid(t){const e=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let n,o;const a=(t,e,s)=>{s.width&&s.color&&(i.save(),i.lineWidth=s.width,i.strokeStyle=s.color,i.setLineDash(s.borderDash||[]),i.lineDashOffset=s.borderDashOffset,i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(e.x,e.y),i.stroke(),i.restore())};if(e.display)for(n=0,o=s.length;n<o;++n){const t=s[n];e.drawOnChartArea&&a({x:t.x1,y:t.y1},{x:t.x2,y:t.y2},t),e.drawTicks&&a({x:t.tx1,y:t.ty1},{x:t.tx2,y:t.ty2},{color:t.tickColor,width:t.tickWidth,borderDash:t.tickBorderDash,borderDashOffset:t.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{grid:i}}=this,s=i.setContext(this.getContext()),n=i.drawBorder?s.borderWidth:0;if(!n)return;const o=i.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let r,l,h,c;this.isHorizontal()?(r=ve(t,this.left,n)-n/2,l=ve(t,this.right,o)+o/2,h=c=a):(h=ve(t,this.top,n)-n/2,c=ve(t,this.bottom,o)+o/2,r=l=a),e.save(),e.lineWidth=s.borderWidth,e.strokeStyle=s.borderColor,e.beginPath(),e.moveTo(r,h),e.lineTo(l,c),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const e=this.ctx,i=this._computeLabelArea();i&&Pe(e,i);const s=this._labelItems||(this._labelItems=this._computeLabelItems(t));let n,o;for(n=0,o=s.length;n<o;++n){const t=s[n],i=t.font,o=t.label;t.backdrop&&(e.fillStyle=t.backdrop.color,e.fillRect(t.backdrop.left,t.backdrop.top,t.backdrop.width,t.backdrop.height)),Ae(e,o,0,t.textOffset,i,t)}i&&De(e)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:o}}=this;if(!i.display)return;const a=mi(i.font),r=pi(i.padding),l=i.align;let h=a.lineHeight/2;"bottom"===e||"center"===e||n(e)?(h+=r.bottom,s(i.text)&&(h+=a.lineHeight*(i.text.length-1))):h+=r.top;const{titleX:c,titleY:d,maxWidth:u,rotation:f}=function(t,e,i,s){const{top:o,left:a,bottom:r,right:l,chart:h}=t,{chartArea:c,scales:d}=h;let u,f,g,p=0;const m=r-o,b=l-a;if(t.isHorizontal()){if(f=ut(s,a,l),n(i)){const t=Object.keys(i)[0],s=i[t];g=d[t].getPixelForValue(s)+m-e}else g="center"===i?(c.bottom+c.top)/2+m-e:Vs(t,i,e);u=l-a}else{if(n(i)){const t=Object.keys(i)[0],s=i[t];f=d[t].getPixelForValue(s)-b+e}else f="center"===i?(c.left+c.right)/2-b+e:Vs(t,i,e);g=ut(s,r,o),p="left"===i?-L:L}return{titleX:f,titleY:g,maxWidth:u,rotation:p}}(this,h,e,l);Ae(t,i.text,0,0,a,{color:i.color,maxWidth:u,rotation:f,textAlign:Hs(l,e,o),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=r(t.grid&&t.grid.z,-1);return this._isVisible()&&this.draw===$s.prototype.draw?[{z:i,draw:t=>{this.drawBackground(),this.drawGrid(t),this.drawTitle()}},{z:i+1,draw:()=>{this.drawBorder()}},{z:e,draw:t=>{this.drawLabels(t)}}]:[{z:e,draw:t=>{this.draw(t)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let n,o;for(n=0,o=e.length;n<o;++n){const o=e[n];o[i]!==this.id||t&&o.type!==t||s.push(o)}return s}_resolveTickFontOptions(t){return mi(this.options.ticks.setContext(this.getContext(t)).font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Ys{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;(function(t){return"id"in t&&"defaults"in t})(e)&&(i=this.register(e));const s=this.items,n=t.id,o=this.scope+"."+n;if(!n)throw new Error("class does not have id: "+t);return n in s||(s[n]=t,function(t,e,i){const s=m(Object.create(null),[i?ne.get(i):{},ne.get(e),t.defaults]);ne.set(e,s),t.defaultRoutes&&function(t,e){Object.keys(e).forEach((i=>{const s=i.split("."),n=s.pop(),o=[t].concat(s).join("."),a=e[i].split("."),r=a.pop(),l=a.join(".");ne.route(o,n,l,r)}))}(e,t.defaultRoutes);t.descriptors&&ne.describe(e,t.descriptors)}(t,o,i),this.override&&ne.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,s=this.scope;i in e&&delete e[i],s&&i in ne[s]&&(delete ne[s][i],this.override&&delete te[i])}}var Us=new class{constructor(){this.controllers=new Ys(Ls,"datasets",!0),this.elements=new Ys(Es,"elements"),this.plugins=new Ys(Object,"plugins"),this.scales=new Ys($s,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach((e=>{const s=i||this._getRegistryForType(e);i||s.isForType(e)||s===this.plugins&&e.id?this._exec(t,s,e):d(e,(e=>{const s=i||this._getRegistryForType(e);this._exec(t,s,e)}))}))}_exec(t,e,i){const s=w(t);c(i["before"+s],[],i),e[t](i),c(i["after"+s],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const s=e.get(t);if(void 0===s)throw new Error('"'+t+'" is not a registered '+i+".");return s}};class Xs{constructor(){this._init=[]}notify(t,e,i,s){"beforeInit"===e&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install"));const n=s?this._descriptors(t).filter(s):this._descriptors(t),o=this._notify(n,t,e,i);return"afterDestroy"===e&&(this._notify(n,t,"stop"),this._notify(this._init,t,"uninstall")),o}_notify(t,e,i,s){s=s||{};for(const n of t){const t=n.plugin;if(!1===c(t[i],[e,s,n.options],t)&&s.cancelable)return!1}return!0}invalidate(){i(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,s=r(i.options&&i.options.plugins,{}),n=function(t){const e={},i=[],s=Object.keys(Us.plugins.items);for(let t=0;t<s.length;t++)i.push(Us.getPlugin(s[t]));const n=t.plugins||[];for(let t=0;t<n.length;t++){const s=n[t];-1===i.indexOf(s)&&(i.push(s),e[s.id]=!0)}return{plugins:i,localIds:e}}(i);return!1!==s||e?function(t,{plugins:e,localIds:i},s,n){const o=[],a=t.getContext();for(const r of e){const e=r.id,l=qs(s[e],n);null!==l&&o.push({plugin:r,options:Ks(t.config,{plugin:r,local:i[e]},l,a)})}return o}(t,n,s,e):[]}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,s=(t,e)=>t.filter((t=>!e.some((e=>t.plugin.id===e.plugin.id))));this._notify(s(e,i),t,"stop"),this._notify(s(i,e),t,"start")}}function qs(t,e){return e||!1!==t?!0===t?{}:t:null}function Ks(t,{plugin:e,local:i},s,n){const o=t.pluginScopeKeys(e),a=t.getOptionScopes(s,o);return i&&e.defaults&&a.push(e.defaults),t.createResolver(a,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Gs(t,e){const i=ne.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||i.indexAxis||"x"}function Zs(t,e){return"x"===t||"y"===t?t:e.axis||("top"===(i=e.position)||"bottom"===i?"x":"left"===i||"right"===i?"y":void 0)||t.charAt(0).toLowerCase();var i}function Js(t){const e=t.options||(t.options={});e.plugins=r(e.plugins,{}),e.scales=function(t,e){const i=te[t.type]||{scales:{}},s=e.scales||{},o=Gs(t.type,e),a=Object.create(null),r=Object.create(null);return Object.keys(s).forEach((t=>{const e=s[t];if(!n(e))return console.error(`Invalid scale configuration for scale: ${t}`);if(e._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${t}`);const l=Zs(t,e),h=function(t,e){return t===e?"_index_":"_value_"}(l,o),c=i.scales||{};a[l]=a[l]||t,r[t]=b(Object.create(null),[{axis:l},e,c[l],c[h]])})),t.data.datasets.forEach((i=>{const n=i.type||t.type,o=i.indexAxis||Gs(n,e),l=(te[n]||{}).scales||{};Object.keys(l).forEach((t=>{const e=function(t,e){let i=t;return"_index_"===t?i=e:"_value_"===t&&(i="x"===e?"y":"x"),i}(t,o),n=i[e+"AxisID"]||a[e]||e;r[n]=r[n]||Object.create(null),b(r[n],[{axis:e},s[n],l[t]])}))})),Object.keys(r).forEach((t=>{const e=r[t];b(e,[ne.scales[e.type],ne.scale])})),r}(t,e)}function Qs(t){return(t=t||{}).datasets=t.datasets||[],t.labels=t.labels||[],t}const tn=new Map,en=new Set;function sn(t,e){let i=tn.get(t);return i||(i=e(),tn.set(t,i),en.add(i)),i}const nn=(t,e,i)=>{const s=y(e,i);void 0!==s&&t.add(s)};class on{constructor(t){this._config=function(t){return(t=t||{}).data=Qs(t.data),Js(t),t}(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Qs(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Js(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return sn(t,(()=>[[`datasets.${t}`,""]]))}datasetAnimationScopeKeys(t,e){return sn(`${t}.transition.${e}`,(()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]]))}datasetElementScopeKeys(t,e){return sn(`${t}-${e}`,(()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]]))}pluginScopeKeys(t){const e=t.id;return sn(`${this.type}-plugin-${e}`,(()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]]))}_cachedScopes(t,e){const i=this._scopeCache;let s=i.get(t);return s&&!e||(s=new Map,i.set(t,s)),s}getOptionScopes(t,e,i){const{options:s,type:n}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const r=new Set;e.forEach((e=>{t&&(r.add(t),e.forEach((e=>nn(r,t,e)))),e.forEach((t=>nn(r,s,t))),e.forEach((t=>nn(r,te[n]||{},t))),e.forEach((t=>nn(r,ne,t))),e.forEach((t=>nn(r,ee,t)))}));const l=Array.from(r);return 0===l.length&&l.push(Object.create(null)),en.has(e)&&o.set(e,l),l}chartOptionScopes(){const{options:t,type:e}=this;return[t,te[e]||{},ne.datasets[e]||{},{type:e},ne,ee]}resolveNamedOptions(t,e,i,n=[""]){const o={$shared:!0},{resolver:a,subPrefixes:r}=an(this._resolverCache,t,n);let l=a;if(function(t,e){const{isScriptable:i,isIndexable:n}=Ie(t);for(const o of e){const e=i(o),a=n(o),r=(a||e)&&t[o];if(e&&(k(r)||rn(r))||a&&s(r))return!0}return!1}(a,e)){o.$shared=!1;l=Re(a,i=k(i)?i():i,this.createResolver(t,i,r))}for(const t of e)o[t]=l[t];return o}createResolver(t,e,i=[""],s){const{resolver:o}=an(this._resolverCache,t,i);return n(e)?Re(o,e,void 0,s):o}}function an(t,e,i){let s=t.get(e);s||(s=new Map,t.set(e,s));const n=i.join();let o=s.get(n);if(!o){o={resolver:Ee(e,i),subPrefixes:i.filter((t=>!t.toLowerCase().includes("hover")))},s.set(n,o)}return o}const rn=t=>n(t)&&Object.getOwnPropertyNames(t).reduce(((e,i)=>e||k(t[i])),!1);const ln=["top","bottom","left","right","chartArea"];function hn(t,e){return"top"===t||"bottom"===t||-1===ln.indexOf(t)&&"x"===e}function cn(t,e){return function(i,s){return i[t]===s[t]?i[e]-s[e]:i[t]-s[t]}}function dn(t){const e=t.chart,i=e.options.animation;e.notifyPlugins("afterRender"),c(i&&i.onComplete,[t],e)}function un(t){const e=t.chart,i=e.options.animation;c(i&&i.onProgress,[t],e)}function fn(t){return oe()&&"string"==typeof t?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const gn={},pn=t=>{const e=fn(t);return Object.values(gn).filter((t=>t.canvas===e)).pop()};function mn(t,e,i){const s=Object.keys(t);for(const n of s){const s=+n;if(s>=e){const o=t[n];delete t[n],(i>0||s>e)&&(t[s+i]=o)}}}class bn{constructor(t,i){const s=this.config=new on(i),n=fn(t),o=pn(n);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const a=s.createResolver(s.chartOptionScopes(),this.getContext());this.platform=new(s.platform||gs(n)),this.platform.updateConfig(s);const r=this.platform.acquireContext(n,a.aspectRatio),l=r&&r.canvas,h=l&&l.height,c=l&&l.width;this.id=e(),this.ctx=r,this.canvas=l,this.width=c,this.height=h,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Xs,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=ct((t=>this.update(t)),a.resizeDelay||0),this._dataChanges=[],gn[this.id]=this,r&&l?(mt.listen(this,"complete",dn),mt.listen(this,"progress",un),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:s,height:n,_aspectRatio:o}=this;return i(t)?e&&o?o:n?s/n:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():pe(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return we(this.canvas,this.ctx),this}stop(){return mt.stop(this),this}resize(t,e){mt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,s=this.canvas,n=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(s,t,e,n),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),r=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,pe(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),c(i.onResize,[this,o],this),this.attached&&this._doResize(r)&&this.render())}ensureScalesHaveIDs(){d(this.options.scales||{},((t,e)=>{t.id=e}))}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,s=Object.keys(i).reduce(((t,e)=>(t[e]=!1,t)),{});let n=[];e&&(n=n.concat(Object.keys(e).map((t=>{const i=e[t],s=Zs(t,i),n="r"===s,o="x"===s;return{options:i,dposition:n?"chartArea":o?"bottom":"left",dtype:n?"radialLinear":o?"category":"linear"}})))),d(n,(e=>{const n=e.options,o=n.id,a=Zs(o,n),l=r(n.type,e.dtype);void 0!==n.position&&hn(n.position,a)===hn(e.dposition)||(n.position=e.dposition),s[o]=!0;let h=null;if(o in i&&i[o].type===l)h=i[o];else{h=new(Us.getScale(l))({id:o,type:l,ctx:this.ctx,chart:this}),i[h.id]=h}h.init(n,t)})),d(s,((t,e)=>{t||delete i[e]})),d(i,(t=>{Zi.configure(this,t,t.options),Zi.addBox(this,t)}))}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort(((t,e)=>t.index-e.index)),i>e){for(let t=e;t<i;++t)this._destroyDatasetMeta(t);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(cn("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach(((t,i)=>{0===e.filter((e=>e===t._dataset)).length&&this._destroyDatasetMeta(i)}))}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=e.length;i<s;i++){const s=e[i];let n=this.getDatasetMeta(i);const o=s.type||this.config.type;if(n.type&&n.type!==o&&(this._destroyDatasetMeta(i),n=this.getDatasetMeta(i)),n.type=o,n.indexAxis=s.indexAxis||Gs(o,this.options),n.order=s.order||0,n.index=i,n.label=""+s.label,n.visible=this.isDatasetVisible(i),n.controller)n.controller.updateIndex(i),n.controller.linkScales();else{const e=Us.getController(o),{datasetElementType:s,dataElementType:a}=ne.datasets[o];Object.assign(e.prototype,{dataElementType:Us.getElement(a),datasetElementType:s&&Us.getElement(s)}),n.controller=new e(this,i),t.push(n.controller)}}return this._updateMetasets(),t}_resetElements(){d(this.data.datasets,((t,e)=>{this.getDatasetMeta(e).controller.reset()}),this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0}))return;const n=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let t=0,e=this.data.datasets.length;t<e;t++){const{controller:e}=this.getDatasetMeta(t),i=!s&&-1===n.indexOf(e);e.buildOrUpdateElements(i),o=Math.max(+e.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),s||d(n,(t=>{t.reset()})),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(cn("z","_idx"));const{_active:a,_lastEvent:r}=this;r?this._eventHandler(r,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){d(this.scales,(t=>{Zi.removeBox(this,t)})),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);S(e,i)&&!!this._responsiveListeners===t.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:n}of e){mn(t,s,"_removeElements"===i?-n:n)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=e=>new Set(t.filter((t=>t[0]===e)).map(((t,e)=>e+","+t.splice(1).join(",")))),s=i(0);for(let t=1;t<e;t++)if(!S(s,i(t)))return;return Array.from(s).map((t=>t.split(","))).map((t=>({method:t[1],start:+t[2],count:+t[3]})))}_updateLayout(t){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;Zi.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],d(this.boxes,(t=>{i&&"chartArea"===t.position||(t.configure&&t.configure(),this._layers.push(...t._layers()))}),this),this._layers.forEach(((t,e)=>{t._idx=e})),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})){for(let t=0,e=this.data.datasets.length;t<e;++t)this.getDatasetMeta(t).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,k(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:e,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",s)&&(i.controller._update(e),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(mt.has(this)?this.attached&&!mt.running(this)&&mt.start(this):(this.draw(),dn({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:t,height:e}=this._resizeBeforeDraw;this._resize(t,e),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let s,n;for(s=0,n=e.length;s<n;++s){const n=e[s];t&&!n.visible||i.push(n)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i=t._clip,s=!i.disabled,n=this.chartArea,o={meta:t,index:t.index,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetDraw",o)&&(s&&Pe(e,{left:!1===i.left?0:n.left-i.left,right:!1===i.right?this.width:n.right+i.right,top:!1===i.top?0:n.top-i.top,bottom:!1===i.bottom?this.height:n.bottom+i.bottom}),t.controller.draw(),s&&De(e),o.cancelable=!1,this.notifyPlugins("afterDatasetDraw",o))}isPointInArea(t){return Se(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,s){const n=Vi.modes[e];return"function"==typeof n?n(this,t,i,s):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let s=i.filter((t=>t&&t._dataset===e)).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=_i(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return"boolean"==typeof i.hidden?!i.hidden:!e.hidden}setDatasetVisibility(t,e){this.getDatasetMeta(t).hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const s=i?"show":"hide",n=this.getDatasetMeta(t),o=n.controller._resolveAnimations(void 0,s);M(e)?(n.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(n,{visible:i}),this.update((e=>e.datasetIndex===t?s:void 0)))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),mt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),we(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),this.notifyPlugins("destroy"),delete gn[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(i,s)=>{e.addEventListener(this,i,s),t[i]=s},s=(t,e,i)=>{t.offsetX=e,t.offsetY=i,this._eventHandler(t)};d(this.options.events,(t=>i(t,s)))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(i,s)=>{e.addEventListener(this,i,s),t[i]=s},s=(i,s)=>{t[i]&&(e.removeEventListener(this,i,s),delete t[i])},n=(t,e)=>{this.canvas&&this.resize(t,e)};let o;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",n),i("detach",o)};o=()=>{this.attached=!1,s("resize",n),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){d(this._listeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._listeners={},d(this._responsiveListeners,((t,e)=>{this.platform.removeEventListener(this,e,t)})),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const s=i?"set":"remove";let n,o,a,r;for("dataset"===e&&(n=this.getDatasetMeta(t[0].datasetIndex),n.controller["_"+s+"DatasetHoverStyle"]()),a=0,r=t.length;a<r;++a){o=t[a];const e=o&&this.getDatasetMeta(o.datasetIndex).controller;e&&e[s+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map((({datasetIndex:t,index:e})=>{const i=this.getDatasetMeta(t);if(!i)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:i.data[e],index:e}}));!u(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}_updateHoverStyles(t,e,i){const s=this.options.hover,n=(t,e)=>t.filter((t=>!e.some((e=>t.datasetIndex===e.datasetIndex&&t.index===e.index)))),o=n(e,t),a=i?t:n(t,e);o.length&&this.updateHoverStyle(o,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},s=e=>(e.options.events||this.options.events).includes(t.native.type);if(!1===this.notifyPlugins("beforeEvent",i,s))return;const n=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(n||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:s=[],options:n}=this,o=e,a=this._getActiveElements(t,s,i,o),r=P(t),l=function(t,e,i,s){return i&&"mouseout"!==t.type?s?e:t:null}(t,this._lastEvent,i,r);i&&(this._lastEvent=null,c(n.onHover,[t,a,this],this),r&&c(n.onClick,[t,a,this],this));const h=!u(a,s);return(h||e)&&(this._active=a,this._updateHoverStyles(a,s,e)),this._lastEvent=l,h}_getActiveElements(t,e,i,s){if("mouseout"===t.type)return[];if(!i)return e;const n=this.options.hover;return this.getElementsAtEventForMode(t,n.mode,n,s)}}const xn=()=>d(bn.instances,(t=>t._plugins.invalidate())),_n=!0;function yn(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}Object.defineProperties(bn,{defaults:{enumerable:_n,value:ne},instances:{enumerable:_n,value:gn},overrides:{enumerable:_n,value:te},registry:{enumerable:_n,value:Us},version:{enumerable:_n,value:"3.9.1"},getChart:{enumerable:_n,value:pn},register:{enumerable:_n,value:(...t)=>{Us.add(...t),xn()}},unregister:{enumerable:_n,value:(...t)=>{Us.remove(...t),xn()}}});class vn{constructor(t){this.options=t||{}}init(t){}formats(){return yn()}parse(t,e){return yn()}format(t,e){return yn()}add(t,e,i){return yn()}diff(t,e,i){return yn()}startOf(t,e,i){return yn()}endOf(t,e){return yn()}}vn.override=function(t){Object.assign(vn.prototype,t)};var wn={_date:vn};function Mn(t){const e=t.iScale,i=function(t,e){if(!t._cache.$bar){const i=t.getMatchingVisibleMetas(e);let s=[];for(let e=0,n=i.length;e<n;e++)s=s.concat(i[e].controller.getAllParsedValues(t));t._cache.$bar=rt(s.sort(((t,e)=>t-e)))}return t._cache.$bar}(e,t.type);let s,n,o,a,r=e._length;const l=()=>{32767!==o&&-32768!==o&&(M(a)&&(r=Math.min(r,Math.abs(o-a)||r)),a=o)};for(s=0,n=i.length;s<n;++s)o=e.getPixelForValue(i[s]),l();for(a=void 0,s=0,n=e.ticks.length;s<n;++s)o=e.getPixelForTick(s),l();return r}function kn(t,e,i,n){return s(t)?function(t,e,i,s){const n=i.parse(t[0],s),o=i.parse(t[1],s),a=Math.min(n,o),r=Math.max(n,o);let l=a,h=r;Math.abs(a)>Math.abs(r)&&(l=r,h=a),e[i.axis]=h,e._custom={barStart:l,barEnd:h,start:n,end:o,min:a,max:r}}(t,e,i,n):e[i.axis]=i.parse(t,n),e}function Sn(t,e,i,s){const n=t.iScale,o=t.vScale,a=n.getLabels(),r=n===o,l=[];let h,c,d,u;for(h=i,c=i+s;h<c;++h)u=e[h],d={},d[n.axis]=r||n.parse(a[h],h),l.push(kn(u,d,o,h));return l}function Pn(t){return t&&void 0!==t.barStart&&void 0!==t.barEnd}function Dn(t,e,i,s){let n=e.borderSkipped;const o={};if(!n)return void(t.borderSkipped=o);if(!0===n)return void(t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:a,end:r,reverse:l,top:h,bottom:c}=function(t){let e,i,s,n,o;return t.horizontal?(e=t.base>t.x,i="left",s="right"):(e=t.base<t.y,i="bottom",s="top"),e?(n="end",o="start"):(n="start",o="end"),{start:i,end:s,reverse:e,top:n,bottom:o}}(t);"middle"===n&&i&&(t.enableBorderRadius=!0,(i._top||0)===s?n=h:(i._bottom||0)===s?n=c:(o[On(c,a,r,l)]=!0,n=h)),o[On(n,a,r,l)]=!0,t.borderSkipped=o}function On(t,e,i,s){var n,o,a;return s?(a=i,t=Cn(t=(n=t)===(o=e)?a:n===a?o:n,i,e)):t=Cn(t,e,i),t}function Cn(t,e,i){return"start"===t?e:"end"===t?i:t}function An(t,{inflateAmount:e},i){t.inflateAmount="auto"===e?1===i?.33:0:e}class Tn extends Ls{parsePrimitiveData(t,e,i,s){return Sn(t,e,i,s)}parseArrayData(t,e,i,s){return Sn(t,e,i,s)}parseObjectData(t,e,i,s){const{iScale:n,vScale:o}=t,{xAxisKey:a="x",yAxisKey:r="y"}=this._parsing,l="x"===n.axis?a:r,h="x"===o.axis?a:r,c=[];let d,u,f,g;for(d=i,u=i+s;d<u;++d)g=e[d],f={},f[n.axis]=n.parse(y(g,l),d),c.push(kn(y(g,h),f,o,d));return c}updateRangeFromParsed(t,e,i,s){super.updateRangeFromParsed(t,e,i,s);const n=i._custom;n&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,n.min),t.max=Math.max(t.max,n.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:s}=e,n=this.getParsed(t),o=n._custom,a=Pn(o)?"["+o.start+", "+o.end+"]":""+s.getLabelForValue(n[s.axis]);return{label:""+i.getLabelForValue(n[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,s,n){const o="reset"===n,{index:a,_cachedMeta:{vScale:r}}=this,l=r.getBasePixel(),h=r.isHorizontal(),c=this._getRuler(),{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,n);for(let f=e;f<e+s;f++){const e=this.getParsed(f),s=o||i(e[r.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),g=this._calculateBarIndexPixels(f,c),p=(e._stacks||{})[r.axis],m={horizontal:h,base:s.base,enableBorderRadius:!p||Pn(e._custom)||a===p._top||a===p._bottom,x:h?s.head:g.center,y:h?g.center:s.head,height:h?g.size:Math.abs(s.size),width:h?Math.abs(s.size):g.size};u&&(m.options=d||this.resolveDataElementOptions(f,t[f].active?"active":n));const b=m.options||t[f].options;Dn(m,b,p,a),An(m,b,c.ratio),this.updateElement(t[f],f,m,n)}}_getStacks(t,e){const{iScale:s}=this._cachedMeta,n=s.getMatchingVisibleMetas(this._type).filter((t=>t.controller.options.grouped)),o=s.options.stacked,a=[],r=t=>{const s=t.controller.getParsed(e),n=s&&s[t.vScale.axis];if(i(n)||isNaN(n))return!0};for(const i of n)if((void 0===e||!r(i))&&((!1===o||-1===a.indexOf(i.stack)||void 0===o&&void 0===i.stack)&&a.push(i.stack),i.index===t))break;return a.length||a.push(void 0),a}_getStackCount(t){return this._getStacks(void 0,t).length}_getStackIndex(t,e,i){const s=this._getStacks(t,i),n=void 0!==e?s.indexOf(e):-1;return-1===n?s.length-1:n}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,s=[];let n,o;for(n=0,o=e.data.length;n<o;++n)s.push(i.getPixelForValue(this.getParsed(n)[i.axis],n));const a=t.barThickness;return{min:a||Mn(e),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:s},options:{base:n,minBarLength:o}}=this,a=n||0,r=this.getParsed(t),l=r._custom,h=Pn(l);let c,d,u=r[e.axis],f=0,g=s?this.applyStack(e,r,s):u;g!==u&&(f=g-u,g=u),h&&(u=l.barStart,g=l.barEnd-l.barStart,0!==u&&z(u)!==z(l.barEnd)&&(f=0),f+=u);const p=i(n)||h?f:n;let m=e.getPixelForValue(p);if(c=this.chart.getDataVisibility(t)?e.getPixelForValue(f+g):m,d=c-m,Math.abs(d)<o){d=function(t,e,i){return 0!==t?z(t):(e.isHorizontal()?1:-1)*(e.min>=i?1:-1)}(d,e,a)*o,u===a&&(m-=d/2);const t=e.getPixelForDecimal(0),i=e.getPixelForDecimal(1),s=Math.min(t,i),n=Math.max(t,i);m=Math.max(Math.min(m,n),s),c=m+d}if(m===e.getPixelForValue(a)){const t=z(d)*e.getLineWidthForValue(a)/2;m+=t,d-=t}return{size:d,base:m,head:c,center:c+d/2}}_calculateBarIndexPixels(t,e){const s=e.scale,n=this.options,o=n.skipNull,a=r(n.maxBarThickness,1/0);let l,h;if(e.grouped){const s=o?this._getStackCount(t):e.stackCount,r="flex"===n.barThickness?function(t,e,i,s){const n=e.pixels,o=n[t];let a=t>0?n[t-1]:null,r=t<n.length-1?n[t+1]:null;const l=i.categoryPercentage;null===a&&(a=o-(null===r?e.end-e.start:r-o)),null===r&&(r=o+o-a);const h=o-(o-Math.min(a,r))/2*l;return{chunk:Math.abs(r-a)/2*l/s,ratio:i.barPercentage,start:h}}(t,e,n,s):function(t,e,s,n){const o=s.barThickness;let a,r;return i(o)?(a=e.min*s.categoryPercentage,r=s.barPercentage):(a=o*n,r=1),{chunk:a/n,ratio:r,start:e.pixels[t]-a/2}}(t,e,n,s),c=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0);l=r.start+r.chunk*c+r.chunk/2,h=Math.min(a,r.chunk*r.ratio)}else l=s.getPixelForValue(this.getParsed(t)[s.axis],t),h=Math.min(a,e.min*e.ratio);return{base:l-h/2,head:l+h/2,center:l,size:h}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,s=i.length;let n=0;for(;n<s;++n)null!==this.getParsed(n)[e.axis]&&i[n].draw(this._ctx)}}Tn.id="bar",Tn.defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}},Tn.overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};class Ln extends Ls{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,s){const n=super.parsePrimitiveData(t,e,i,s);for(let t=0;t<n.length;t++)n[t]._custom=this.resolveDataElementOptions(t+i).radius;return n}parseArrayData(t,e,i,s){const n=super.parseArrayData(t,e,i,s);for(let t=0;t<n.length;t++){const s=e[i+t];n[t]._custom=r(s[2],this.resolveDataElementOptions(t+i).radius)}return n}parseObjectData(t,e,i,s){const n=super.parseObjectData(t,e,i,s);for(let t=0;t<n.length;t++){const s=e[i+t];n[t]._custom=r(s&&s.r&&+s.r,this.resolveDataElementOptions(t+i).radius)}return n}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,{xScale:i,yScale:s}=e,n=this.getParsed(t),o=i.getLabelForValue(n.x),a=s.getLabelForValue(n.y),r=n._custom;return{label:e.label,value:"("+o+", "+a+(r?", "+r:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,s){const n="reset"===s,{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:r,includeOptions:l}=this._getSharedOptions(e,s),h=o.axis,c=a.axis;for(let d=e;d<e+i;d++){const e=t[d],i=!n&&this.getParsed(d),u={},f=u[h]=n?o.getPixelForDecimal(.5):o.getPixelForValue(i[h]),g=u[c]=n?a.getBasePixel():a.getPixelForValue(i[c]);u.skip=isNaN(f)||isNaN(g),l&&(u.options=r||this.resolveDataElementOptions(d,e.active?"active":s),n&&(u.options.radius=0)),this.updateElement(e,d,u,s)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,e);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const n=s.radius;return"active"!==e&&(s.radius=0),s.radius+=r(i&&i._custom,n),s}}Ln.id="bubble",Ln.defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}},Ln.overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{title:()=>""}}}};class En extends Ls{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,s=this._cachedMeta;if(!1===this._parsing)s._parsed=i;else{let o,a,r=t=>+i[t];if(n(i[t])){const{key:t="value"}=this._parsing;r=e=>+y(i[e],t)}for(o=t,a=t+e;o<a;++o)s._parsed[o]=r(o)}}_getRotation(){return H(this.options.rotation-90)}_getCircumference(){return H(this.options.circumference)}_getRotationExtents(){let t=O,e=-O;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)){const s=this.chart.getDatasetMeta(i).controller,n=s._getRotation(),o=s._getCircumference();t=Math.min(t,n),e=Math.max(e,n+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,s=this._cachedMeta,n=s.data,o=this.getMaxBorderWidth()+this.getMaxOffset(n)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),r=Math.min(l(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:f,ratioY:g,offsetX:p,offsetY:m}=function(t,e,i){let s=1,n=1,o=0,a=0;if(e<O){const r=t,l=r+e,h=Math.cos(r),c=Math.sin(r),d=Math.cos(l),u=Math.sin(l),f=(t,e,s)=>G(t,r,l,!0)?1:Math.max(e,e*i,s,s*i),g=(t,e,s)=>G(t,r,l,!0)?-1:Math.min(e,e*i,s,s*i),p=f(0,h,d),m=f(L,c,u),b=g(D,h,d),x=g(D+L,c,u);s=(p-b)/2,n=(m-x)/2,o=-(p+b)/2,a=-(m+x)/2}return{ratioX:s,ratioY:n,offsetX:o,offsetY:a}}(u,d,r),b=(i.width-o)/f,x=(i.height-o)/g,_=Math.max(Math.min(b,x)/2,0),y=h(this.options.radius,_),v=(y-Math.max(y*r,0))/this._getVisibleDatasetWeightTotal();this.offsetX=p*y,this.offsetY=m*y,s.total=this.calculateTotal(),this.outerRadius=y-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*c,0),this.updateElements(n,0,n.length,t)}_circumference(t,e){const i=this.options,s=this._cachedMeta,n=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||null===s._parsed[t]||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*n/O)}updateElements(t,e,i,s){const n="reset"===s,o=this.chart,a=o.chartArea,r=o.options.animation,l=(a.left+a.right)/2,h=(a.top+a.bottom)/2,c=n&&r.animateScale,d=c?0:this.innerRadius,u=c?0:this.outerRadius,{sharedOptions:f,includeOptions:g}=this._getSharedOptions(e,s);let p,m=this._getRotation();for(p=0;p<e;++p)m+=this._circumference(p,n);for(p=e;p<e+i;++p){const e=this._circumference(p,n),i=t[p],o={x:l+this.offsetX,y:h+this.offsetY,startAngle:m,endAngle:m+e,circumference:e,outerRadius:u,innerRadius:d};g&&(o.options=f||this.resolveDataElementOptions(p,i.active?"active":s)),m+=e,this.updateElement(i,p,o,s)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i,s=0;for(i=0;i<e.length;i++){const n=t._parsed[i];null===n||isNaN(n)||!this.chart.getDataVisibility(i)||e[i].hidden||(s+=Math.abs(n))}return s}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?O*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],n=li(e._parsed[t],i.options.locale);return{label:s[t]||"",value:n}}getMaxBorderWidth(t){let e=0;const i=this.chart;let s,n,o,a,r;if(!t)for(s=0,n=i.data.datasets.length;s<n;++s)if(i.isDatasetVisible(s)){o=i.getDatasetMeta(s),t=o.data,a=o.controller;break}if(!t)return 0;for(s=0,n=t.length;s<n;++s)r=a.resolveDataElementOptions(s),"inner"!==r.borderAlign&&(e=Math.max(e,r.borderWidth||0,r.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,s=t.length;i<s;++i){const t=this.resolveDataElementOptions(i);e=Math.max(e,t.offset||0,t.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(r(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}En.id="doughnut",En.defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"},En.descriptors={_scriptable:t=>"spacing"!==t,_indexable:t=>"spacing"!==t},En.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i}}=t.legend.options;return e.labels.map(((e,s)=>{const n=t.getDatasetMeta(0).controller.getStyle(s);return{text:e,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,lineWidth:n.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label(t){let e=t.label;const i=": "+t.formattedValue;return s(e)?(e=e.slice(),e[0]+=i):e+=i,e}}}}};class Rn extends Ls{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:s=[],_dataset:n}=e,o=this.chart._animationsDisabled;let{start:a,count:r}=gt(e,s,o);this._drawStart=a,this._drawCount=r,pt(e)&&(a=0,r=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!n._decimated,i.points=s;const l=this.resolveDatasetElementOptions(t);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:l},t),this.updateElements(s,a,r,t)}updateElements(t,e,s,n){const o="reset"===n,{iScale:a,vScale:r,_stacked:l,_dataset:h}=this._cachedMeta,{sharedOptions:c,includeOptions:d}=this._getSharedOptions(e,n),u=a.axis,f=r.axis,{spanGaps:g,segment:p}=this.options,m=B(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||"none"===n;let x=e>0&&this.getParsed(e-1);for(let g=e;g<e+s;++g){const e=t[g],s=this.getParsed(g),_=b?e:{},y=i(s[f]),v=_[u]=a.getPixelForValue(s[u],g),w=_[f]=o||y?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,s,l):s[f],g);_.skip=isNaN(v)||isNaN(w)||y,_.stop=g>0&&Math.abs(s[u]-x[u])>m,p&&(_.parsed=s,_.raw=h.data[g]),d&&(_.options=c||this.resolveDataElementOptions(g,e.active?"active":n)),b||this.updateElement(e,g,_,n),x=s}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const n=s[0].size(this.resolveDataElementOptions(0)),o=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,n,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}Rn.id="line",Rn.defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1},Rn.overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};class In extends Ls{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],n=li(e._parsed[t].r,i.options.locale);return{label:s[t]||"",value:n}}parseObjectData(t,e,i,s){return Ue.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach(((t,i)=>{const s=this.getParsed(i).r;!isNaN(s)&&this.chart.getDataVisibility(i)&&(s<e.min&&(e.min=s),s>e.max&&(e.max=s))})),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,s=Math.min(e.right-e.left,e.bottom-e.top),n=Math.max(s/2,0),o=(n-Math.max(i.cutoutPercentage?n/100*i.cutoutPercentage:1,0))/t.getVisibleDatasetCount();this.outerRadius=n-o*this.index,this.innerRadius=this.outerRadius-o}updateElements(t,e,i,s){const n="reset"===s,o=this.chart,a=o.options.animation,r=this._cachedMeta.rScale,l=r.xCenter,h=r.yCenter,c=r.getIndexAngle(0)-.5*D;let d,u=c;const f=360/this.countVisibleElements();for(d=0;d<e;++d)u+=this._computeAngle(d,s,f);for(d=e;d<e+i;d++){const e=t[d];let i=u,g=u+this._computeAngle(d,s,f),p=o.getDataVisibility(d)?r.getDistanceFromCenterForValue(this.getParsed(d).r):0;u=g,n&&(a.animateScale&&(p=0),a.animateRotate&&(i=g=c));const m={x:l,y:h,innerRadius:0,outerRadius:p,startAngle:i,endAngle:g,options:this.resolveDataElementOptions(d,e.active?"active":s)};this.updateElement(e,d,m,s)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach(((t,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&e++})),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?H(this.resolveDataElementOptions(t,e).angle||i):0}}In.id="polarArea",In.defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0},In.overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i}}=t.legend.options;return e.labels.map(((e,s)=>{const n=t.getDatasetMeta(0).controller.getStyle(s);return{text:e,fillStyle:n.backgroundColor,strokeStyle:n.borderColor,lineWidth:n.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(s),index:s}}))}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label:t=>t.chart.data.labels[t.dataIndex]+": "+t.formattedValue}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};class zn extends En{}zn.id="pie",zn.defaults={cutout:0,rotation:0,circumference:360,radius:"100%"};class Fn extends Ls{getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,s){return Ue.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta,i=e.dataset,s=e.data||[],n=e.iScale.getLabels();if(i.points=s,"resize"!==t){const e=this.resolveDatasetElementOptions(t);this.options.showLine||(e.borderWidth=0);const o={_loop:!0,_fullLoop:n.length===s.length,options:e};this.updateElement(i,void 0,o,t)}this.updateElements(s,0,s.length,t)}updateElements(t,e,i,s){const n=this._cachedMeta.rScale,o="reset"===s;for(let a=e;a<e+i;a++){const e=t[a],i=this.resolveDataElementOptions(a,e.active?"active":s),r=n.getPointPositionForValue(a,this.getParsed(a).r),l=o?n.xCenter:r.x,h=o?n.yCenter:r.y,c={x:l,y:h,angle:r.angle,skip:isNaN(l)||isNaN(h),options:i};this.updateElement(e,a,c,s)}}}Fn.id="radar",Fn.defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}},Fn.overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};class Vn extends Ls{update(t){const e=this._cachedMeta,{data:i=[]}=e,s=this.chart._animationsDisabled;let{start:n,count:o}=gt(e,i,s);if(this._drawStart=n,this._drawCount=o,pt(e)&&(n=0,o=i.length),this.options.showLine){const{dataset:n,_dataset:o}=e;n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!o._decimated,n.points=i;const a=this.resolveDatasetElementOptions(t);a.segment=this.options.segment,this.updateElement(n,void 0,{animated:!s,options:a},t)}this.updateElements(i,n,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=Us.getElement("line")),super.addElements()}updateElements(t,e,s,n){const o="reset"===n,{iScale:a,vScale:r,_stacked:l,_dataset:h}=this._cachedMeta,c=this.resolveDataElementOptions(e,n),d=this.getSharedOptions(c),u=this.includeOptions(n,d),f=a.axis,g=r.axis,{spanGaps:p,segment:m}=this.options,b=B(p)?p:Number.POSITIVE_INFINITY,x=this.chart._animationsDisabled||o||"none"===n;let _=e>0&&this.getParsed(e-1);for(let c=e;c<e+s;++c){const e=t[c],s=this.getParsed(c),p=x?e:{},y=i(s[g]),v=p[f]=a.getPixelForValue(s[f],c),w=p[g]=o||y?r.getBasePixel():r.getPixelForValue(l?this.applyStack(r,s,l):s[g],c);p.skip=isNaN(v)||isNaN(w)||y,p.stop=c>0&&Math.abs(s[f]-_[f])>b,m&&(p.parsed=s,p.raw=h.data[c]),u&&(p.options=d||this.resolveDataElementOptions(c,e.active?"active":n)),x||this.updateElement(e,c,p,n),_=s}this.updateSharedOptions(d,n,c)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!e.length)return s;const n=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(s,n,o)/2}}Vn.id="scatter",Vn.defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1},Vn.overrides={interaction:{mode:"point"},plugins:{tooltip:{callbacks:{title:()=>"",label:t=>"("+t.label+", "+t.formattedValue+")"}}},scales:{x:{type:"linear"},y:{type:"linear"}}};var Bn=Object.freeze({__proto__:null,BarController:Tn,BubbleController:Ln,DoughnutController:En,LineController:Rn,PolarAreaController:In,PieController:zn,RadarController:Fn,ScatterController:Vn});function Nn(t,e,i){const{startAngle:s,pixelMargin:n,x:o,y:a,outerRadius:r,innerRadius:l}=e;let h=n/r;t.beginPath(),t.arc(o,a,r,s-h,i+h),l>n?(h=n/l,t.arc(o,a,l,i+h,s-h,!0)):t.arc(o,a,n,i+L,s-L),t.closePath(),t.clip()}function Wn(t,e,i,s){const n=ui(t.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const o=(i-e)/2,a=Math.min(o,s*e/2),r=t=>{const e=(i-Math.min(o,t))*s/2;return Z(t,0,Math.min(o,e))};return{outerStart:r(n.outerStart),outerEnd:r(n.outerEnd),innerStart:Z(n.innerStart,0,a),innerEnd:Z(n.innerEnd,0,a)}}function jn(t,e,i,s){return{x:i+t*Math.cos(e),y:s+t*Math.sin(e)}}function Hn(t,e,i,s,n,o){const{x:a,y:r,startAngle:l,pixelMargin:h,innerRadius:c}=e,d=Math.max(e.outerRadius+s+i-h,0),u=c>0?c+s+i+h:0;let f=0;const g=n-l;if(s){const t=((c>0?c-s:0)+(d>0?d-s:0))/2;f=(g-(0!==t?g*t/(t+s):g))/2}const p=(g-Math.max(.001,g*d-i/D)/d)/2,m=l+p+f,b=n-p-f,{outerStart:x,outerEnd:_,innerStart:y,innerEnd:v}=Wn(e,u,d,b-m),w=d-x,M=d-_,k=m+x/w,S=b-_/M,P=u+y,O=u+v,C=m+y/P,A=b-v/O;if(t.beginPath(),o){if(t.arc(a,r,d,k,S),_>0){const e=jn(M,S,a,r);t.arc(e.x,e.y,_,S,b+L)}const e=jn(O,b,a,r);if(t.lineTo(e.x,e.y),v>0){const e=jn(O,A,a,r);t.arc(e.x,e.y,v,b+L,A+Math.PI)}if(t.arc(a,r,u,b-v/u,m+y/u,!0),y>0){const e=jn(P,C,a,r);t.arc(e.x,e.y,y,C+Math.PI,m-L)}const i=jn(w,m,a,r);if(t.lineTo(i.x,i.y),x>0){const e=jn(w,k,a,r);t.arc(e.x,e.y,x,m-L,k)}}else{t.moveTo(a,r);const e=Math.cos(k)*d+a,i=Math.sin(k)*d+r;t.lineTo(e,i);const s=Math.cos(S)*d+a,n=Math.sin(S)*d+r;t.lineTo(s,n)}t.closePath()}function $n(t,e,i,s,n,o){const{options:a}=e,{borderWidth:r,borderJoinStyle:l}=a,h="inner"===a.borderAlign;r&&(h?(t.lineWidth=2*r,t.lineJoin=l||"round"):(t.lineWidth=r,t.lineJoin=l||"bevel"),e.fullCircles&&function(t,e,i){const{x:s,y:n,startAngle:o,pixelMargin:a,fullCircles:r}=e,l=Math.max(e.outerRadius-a,0),h=e.innerRadius+a;let c;for(i&&Nn(t,e,o+O),t.beginPath(),t.arc(s,n,h,o+O,o,!0),c=0;c<r;++c)t.stroke();for(t.beginPath(),t.arc(s,n,l,o,o+O),c=0;c<r;++c)t.stroke()}(t,e,h),h&&Nn(t,e,n),Hn(t,e,i,s,n,o),t.stroke())}class Yn extends Es{constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.getProps(["x","y"],i),{angle:n,distance:o}=U(s,{x:t,y:e}),{startAngle:a,endAngle:l,innerRadius:h,outerRadius:c,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),u=this.options.spacing/2,f=r(d,l-a)>=O||G(n,a,l),g=Q(o,h+u,c+u);return f&&g}getCenterPoint(t){const{x:e,y:i,startAngle:s,endAngle:n,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius","circumference"],t),{offset:r,spacing:l}=this.options,h=(s+n)/2,c=(o+a+l+r)/2;return{x:e+Math.cos(h)*c,y:i+Math.sin(h)*c}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,s=(e.offset||0)/2,n=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin="inner"===e.borderAlign?.33:0,this.fullCircles=i>O?Math.floor(i/O):0,0===i||this.innerRadius<0||this.outerRadius<0)return;t.save();let a=0;if(s){a=s/2;const e=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(e)*a,Math.sin(e)*a),this.circumference>=D&&(a=s)}t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor;const r=function(t,e,i,s,n){const{fullCircles:o,startAngle:a,circumference:r}=e;let l=e.endAngle;if(o){Hn(t,e,i,s,a+O,n);for(let e=0;e<o;++e)t.fill();isNaN(r)||(l=a+r%O,r%O==0&&(l+=O))}return Hn(t,e,i,s,l,n),t.fill(),l}(t,this,a,n,o);$n(t,this,a,n,r,o),t.restore()}}function Un(t,e,i=e){t.lineCap=r(i.borderCapStyle,e.borderCapStyle),t.setLineDash(r(i.borderDash,e.borderDash)),t.lineDashOffset=r(i.borderDashOffset,e.borderDashOffset),t.lineJoin=r(i.borderJoinStyle,e.borderJoinStyle),t.lineWidth=r(i.borderWidth,e.borderWidth),t.strokeStyle=r(i.borderColor,e.borderColor)}function Xn(t,e,i){t.lineTo(i.x,i.y)}function qn(t,e,i={}){const s=t.length,{start:n=0,end:o=s-1}=i,{start:a,end:r}=e,l=Math.max(n,a),h=Math.min(o,r),c=n<a&&o<a||n>r&&o>r;return{count:s,start:l,loop:e.loop,ilen:h<l&&!c?s+h-l:h-l}}function Kn(t,e,i,s){const{points:n,options:o}=e,{count:a,start:r,loop:l,ilen:h}=qn(n,i,s),c=function(t){return t.stepped?Oe:t.tension||"monotone"===t.cubicInterpolationMode?Ce:Xn}(o);let d,u,f,{move:g=!0,reverse:p}=s||{};for(d=0;d<=h;++d)u=n[(r+(p?h-d:d))%a],u.skip||(g?(t.moveTo(u.x,u.y),g=!1):c(t,f,u,p,o.stepped),f=u);return l&&(u=n[(r+(p?h:0))%a],c(t,f,u,p,o.stepped)),!!l}function Gn(t,e,i,s){const n=e.points,{count:o,start:a,ilen:r}=qn(n,i,s),{move:l=!0,reverse:h}=s||{};let c,d,u,f,g,p,m=0,b=0;const x=t=>(a+(h?r-t:t))%o,_=()=>{f!==g&&(t.lineTo(m,g),t.lineTo(m,f),t.lineTo(m,p))};for(l&&(d=n[x(0)],t.moveTo(d.x,d.y)),c=0;c<=r;++c){if(d=n[x(c)],d.skip)continue;const e=d.x,i=d.y,s=0|e;s===u?(i<f?f=i:i>g&&(g=i),m=(b*m+e)/++b):(_(),t.lineTo(e,i),u=s,b=0,f=g=i),p=i}_()}function Zn(t){const e=t.options,i=e.borderDash&&e.borderDash.length;return!(t._decimated||t._loop||e.tension||"monotone"===e.cubicInterpolationMode||e.stepped||i)?Gn:Kn}Yn.id="arc",Yn.defaults={borderAlign:"center",borderColor:"#fff",borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0},Yn.defaultRoutes={backgroundColor:"backgroundColor"};const Jn="function"==typeof Path2D;function Qn(t,e,i,s){Jn&&!e.options.segment?function(t,e,i,s){let n=e._path;n||(n=e._path=new Path2D,e.path(n,i,s)&&n.closePath()),Un(t,e.options),t.stroke(n)}(t,e,i,s):function(t,e,i,s){const{segments:n,options:o}=e,a=Zn(e);for(const r of n)Un(t,o,r.style),t.beginPath(),a(t,e,r,{start:i,end:i+s-1})&&t.closePath(),t.stroke()}(t,e,i,s)}class to extends Es{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;Qe(this._points,i,t,s,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Di(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,s=t[e],n=this.points,o=Pi(this,{property:e,start:s,end:s});if(!o.length)return;const a=[],r=function(t){return t.stepped?oi:t.tension||"monotone"===t.cubicInterpolationMode?ai:ni}(i);let l,h;for(l=0,h=o.length;l<h;++l){const{start:h,end:c}=o[l],d=n[h],u=n[c];if(d===u){a.push(d);continue}const f=r(d,u,Math.abs((s-d[e])/(u[e]-d[e])),i.stepped);f[e]=t[e],a.push(f)}return 1===a.length?a[0]:a}pathSegment(t,e,i){return Zn(this)(t,this,e,i)}path(t,e,i){const s=this.segments,n=Zn(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of s)o&=n(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,s){const n=this.options||{};(this.points||[]).length&&n.borderWidth&&(t.save(),Qn(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function eo(t,e,i,s){const n=t.options,{[i]:o}=t.getProps([i],s);return Math.abs(e-o)<n.radius+n.hitRadius}to.id="line",to.defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0},to.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"},to.descriptors={_scriptable:!0,_indexable:t=>"borderDash"!==t&&"fill"!==t};class io extends Es{constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.options,{x:n,y:o}=this.getProps(["x","y"],i);return Math.pow(t-n,2)+Math.pow(e-o,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(t,e){return eo(this,t,"x",e)}inYRange(t,e){return eo(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){let e=(t=t||this.options||{}).radius||0;e=Math.max(e,e&&t.hoverRadius||0);return 2*(e+(e&&t.borderWidth||0))}draw(t,e){const i=this.options;this.skip||i.radius<.1||!Se(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Me(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function so(t,e){const{x:i,y:s,base:n,width:o,height:a}=t.getProps(["x","y","base","width","height"],e);let r,l,h,c,d;return t.horizontal?(d=a/2,r=Math.min(i,n),l=Math.max(i,n),h=s-d,c=s+d):(d=o/2,r=i-d,l=i+d,h=Math.min(s,n),c=Math.max(s,n)),{left:r,top:h,right:l,bottom:c}}function no(t,e,i,s){return t?0:Z(e,i,s)}function oo(t){const e=so(t),i=e.right-e.left,s=e.bottom-e.top,o=function(t,e,i){const s=t.options.borderWidth,n=t.borderSkipped,o=fi(s);return{t:no(n.top,o.top,0,i),r:no(n.right,o.right,0,e),b:no(n.bottom,o.bottom,0,i),l:no(n.left,o.left,0,e)}}(t,i/2,s/2),a=function(t,e,i){const{enableBorderRadius:s}=t.getProps(["enableBorderRadius"]),o=t.options.borderRadius,a=gi(o),r=Math.min(e,i),l=t.borderSkipped,h=s||n(o);return{topLeft:no(!h||l.top||l.left,a.topLeft,0,r),topRight:no(!h||l.top||l.right,a.topRight,0,r),bottomLeft:no(!h||l.bottom||l.left,a.bottomLeft,0,r),bottomRight:no(!h||l.bottom||l.right,a.bottomRight,0,r)}}(t,i/2,s/2);return{outer:{x:e.left,y:e.top,w:i,h:s,radius:a},inner:{x:e.left+o.l,y:e.top+o.t,w:i-o.l-o.r,h:s-o.t-o.b,radius:{topLeft:Math.max(0,a.topLeft-Math.max(o.t,o.l)),topRight:Math.max(0,a.topRight-Math.max(o.t,o.r)),bottomLeft:Math.max(0,a.bottomLeft-Math.max(o.b,o.l)),bottomRight:Math.max(0,a.bottomRight-Math.max(o.b,o.r))}}}}function ao(t,e,i,s){const n=null===e,o=null===i,a=t&&!(n&&o)&&so(t,s);return a&&(n||Q(e,a.left,a.right))&&(o||Q(i,a.top,a.bottom))}function ro(t,e){t.rect(e.x,e.y,e.w,e.h)}function lo(t,e,i={}){const s=t.x!==i.x?-e:0,n=t.y!==i.y?-e:0,o=(t.x+t.w!==i.x+i.w?e:0)-s,a=(t.y+t.h!==i.y+i.h?e:0)-n;return{x:t.x+s,y:t.y+n,w:t.w+o,h:t.h+a,radius:t.radius}}io.id="point",io.defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0},io.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};class ho extends Es{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:s}}=this,{inner:n,outer:o}=oo(this),a=(r=o.radius).topLeft||r.topRight||r.bottomLeft||r.bottomRight?Le:ro;var r;t.save(),o.w===n.w&&o.h===n.h||(t.beginPath(),a(t,lo(o,e,n)),t.clip(),a(t,lo(n,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,lo(n,e)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,e,i){return ao(this,t,e,i)}inXRange(t,e){return ao(this,t,null,e)}inYRange(t,e){return ao(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:s,horizontal:n}=this.getProps(["x","y","base","horizontal"],t);return{x:n?(e+s)/2:e,y:n?i:(i+s)/2}}getRange(t){return"x"===t?this.width/2:this.height/2}}ho.id="bar",ho.defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0},ho.defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};var co=Object.freeze({__proto__:null,ArcElement:Yn,LineElement:to,PointElement:io,BarElement:ho});function uo(t){if(t._decimated){const e=t._data;delete t._decimated,delete t._data,Object.defineProperty(t,"data",{value:e})}}function fo(t){t.data.datasets.forEach((t=>{uo(t)}))}var go={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(t,e,s)=>{if(!s.enabled)return void fo(t);const n=t.width;t.data.datasets.forEach(((e,o)=>{const{_data:a,indexAxis:r}=e,l=t.getDatasetMeta(o),h=a||e.data;if("y"===bi([r,t.options.indexAxis]))return;if(!l.controller.supportsDecimation)return;const c=t.scales[l.xAxisID];if("linear"!==c.type&&"time"!==c.type)return;if(t.options.parsing)return;let{start:d,count:u}=function(t,e){const i=e.length;let s,n=0;const{iScale:o}=t,{min:a,max:r,minDefined:l,maxDefined:h}=o.getUserBounds();return l&&(n=Z(et(e,o.axis,a).lo,0,i-1)),s=h?Z(et(e,o.axis,r).hi+1,n,i)-n:i-n,{start:n,count:s}}(l,h);if(u<=(s.threshold||4*n))return void uo(e);let f;switch(i(a)&&(e._data=h,delete e.data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(t){this._data=t}})),s.algorithm){case"lttb":f=function(t,e,i,s,n){const o=n.samples||s;if(o>=i)return t.slice(e,e+i);const a=[],r=(i-2)/(o-2);let l=0;const h=e+i-1;let c,d,u,f,g,p=e;for(a[l++]=t[p],c=0;c<o-2;c++){let s,n=0,o=0;const h=Math.floor((c+1)*r)+1+e,m=Math.min(Math.floor((c+2)*r)+1,i)+e,b=m-h;for(s=h;s<m;s++)n+=t[s].x,o+=t[s].y;n/=b,o/=b;const x=Math.floor(c*r)+1+e,_=Math.min(Math.floor((c+1)*r)+1,i)+e,{x:y,y:v}=t[p];for(u=f=-1,s=x;s<_;s++)f=.5*Math.abs((y-n)*(t[s].y-v)-(y-t[s].x)*(o-v)),f>u&&(u=f,d=t[s],g=s);a[l++]=d,p=g}return a[l++]=t[h],a}(h,d,u,n,s);break;case"min-max":f=function(t,e,s,n){let o,a,r,l,h,c,d,u,f,g,p=0,m=0;const b=[],x=e+s-1,_=t[e].x,y=t[x].x-_;for(o=e;o<e+s;++o){a=t[o],r=(a.x-_)/y*n,l=a.y;const e=0|r;if(e===h)l<f?(f=l,c=o):l>g&&(g=l,d=o),p=(m*p+a.x)/++m;else{const s=o-1;if(!i(c)&&!i(d)){const e=Math.min(c,d),i=Math.max(c,d);e!==u&&e!==s&&b.push({...t[e],x:p}),i!==u&&i!==s&&b.push({...t[i],x:p})}o>0&&s!==u&&b.push(t[s]),b.push(a),h=e,m=0,f=g=l,c=d=u=o}}return b}(h,d,u,n);break;default:throw new Error(`Unsupported decimation algorithm '${s.algorithm}'`)}e._decimated=f}))},destroy(t){fo(t)}};function po(t,e,i,s){if(s)return;let n=e[t],o=i[t];return"angle"===t&&(n=K(n),o=K(o)),{property:t,start:n,end:o}}function mo(t,e,i){for(;e>t;e--){const t=i[e];if(!isNaN(t.x)&&!isNaN(t.y))break}return e}function bo(t,e,i,s){return t&&e?s(t[i],e[i]):t?t[i]:e?e[i]:0}function xo(t,e){let i=[],n=!1;return s(t)?(n=!0,i=t):i=function(t,e){const{x:i=null,y:s=null}=t||{},n=e.points,o=[];return e.segments.forEach((({start:t,end:e})=>{e=mo(t,e,n);const a=n[t],r=n[e];null!==s?(o.push({x:a.x,y:s}),o.push({x:r.x,y:s})):null!==i&&(o.push({x:i,y:a.y}),o.push({x:i,y:r.y}))})),o}(t,e),i.length?new to({points:i,options:{tension:0},_loop:n,_fullLoop:n}):null}function _o(t){return t&&!1!==t.fill}function yo(t,e,i){let s=t[e].fill;const n=[e];let a;if(!i)return s;for(;!1!==s&&-1===n.indexOf(s);){if(!o(s))return s;if(a=t[s],!a)return!1;if(a.visible)return s;n.push(s),s=a.fill}return!1}function vo(t,e,i){const s=function(t){const e=t.options,i=e.fill;let s=r(i&&i.target,i);void 0===s&&(s=!!e.backgroundColor);if(!1===s||null===s)return!1;if(!0===s)return"origin";return s}(t);if(n(s))return!isNaN(s.value)&&s;let a=parseFloat(s);return o(a)&&Math.floor(a)===a?function(t,e,i,s){"-"!==t&&"+"!==t||(i=e+i);if(i===e||i<0||i>=s)return!1;return i}(s[0],e,a,i):["origin","start","end","stack","shape"].indexOf(s)>=0&&s}function wo(t,e,i){const s=[];for(let n=0;n<i.length;n++){const o=i[n],{first:a,last:r,point:l}=Mo(o,e,"x");if(!(!l||a&&r))if(a)s.unshift(l);else if(t.push(l),!r)break}t.push(...s)}function Mo(t,e,i){const s=t.interpolate(e,i);if(!s)return{};const n=s[i],o=t.segments,a=t.points;let r=!1,l=!1;for(let t=0;t<o.length;t++){const e=o[t],s=a[e.start][i],h=a[e.end][i];if(Q(n,s,h)){r=n===s,l=n===h;break}}return{first:r,last:l,point:s}}class ko{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:s,y:n,radius:o}=this;return e=e||{start:0,end:O},t.arc(s,n,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:s}=this,n=t.angle;return{x:e+Math.cos(n)*s,y:i+Math.sin(n)*s,angle:n}}}function So(t){const{chart:e,fill:i,line:s}=t;if(o(i))return function(t,e){const i=t.getDatasetMeta(e);return i&&t.isDatasetVisible(e)?i.dataset:null}(e,i);if("stack"===i)return function(t){const{scale:e,index:i,line:s}=t,n=[],o=s.segments,a=s.points,r=function(t,e){const i=[],s=t.getMatchingVisibleMetas("line");for(let t=0;t<s.length;t++){const n=s[t];if(n.index===e)break;n.hidden||i.unshift(n.dataset)}return i}(e,i);r.push(xo({x:null,y:e.bottom},s));for(let t=0;t<o.length;t++){const e=o[t];for(let t=e.start;t<=e.end;t++)wo(n,a[t],r)}return new to({points:n,options:{}})}(t);if("shape"===i)return!0;const a=function(t){if((t.scale||{}).getPointPositionForValue)return function(t){const{scale:e,fill:i}=t,s=e.options,o=e.getLabels().length,a=s.reverse?e.max:e.min,r=function(t,e,i){let s;return s="start"===t?i:"end"===t?e.options.reverse?e.min:e.max:n(t)?t.value:e.getBaseValue(),s}(i,e,a),l=[];if(s.grid.circular){const t=e.getPointPositionForValue(0,a);return new ko({x:t.x,y:t.y,radius:e.getDistanceFromCenterForValue(r)})}for(let t=0;t<o;++t)l.push(e.getPointPositionForValue(t,r));return l}(t);return function(t){const{scale:e={},fill:i}=t,s=function(t,e){let i=null;return"start"===t?i=e.bottom:"end"===t?i=e.top:n(t)?i=e.getPixelForValue(t.value):e.getBasePixel&&(i=e.getBasePixel()),i}(i,e);if(o(s)){const t=e.isHorizontal();return{x:t?s:null,y:t?null:s}}return null}(t)}(t);return a instanceof ko?a:xo(a,s)}function Po(t,e,i){const s=So(e),{line:n,scale:o,axis:a}=e,r=n.options,l=r.fill,h=r.backgroundColor,{above:c=h,below:d=h}=l||{};s&&n.points.length&&(Pe(t,i),function(t,e){const{line:i,target:s,above:n,below:o,area:a,scale:r}=e,l=i._loop?"angle":e.axis;t.save(),"x"===l&&o!==n&&(Do(t,s,a.top),Oo(t,{line:i,target:s,color:n,scale:r,property:l}),t.restore(),t.save(),Do(t,s,a.bottom));Oo(t,{line:i,target:s,color:o,scale:r,property:l}),t.restore()}(t,{line:n,target:s,above:c,below:d,area:i,scale:o,axis:a}),De(t))}function Do(t,e,i){const{segments:s,points:n}=e;let o=!0,a=!1;t.beginPath();for(const r of s){const{start:s,end:l}=r,h=n[s],c=n[mo(s,l,n)];o?(t.moveTo(h.x,h.y),o=!1):(t.lineTo(h.x,i),t.lineTo(h.x,h.y)),a=!!e.pathSegment(t,r,{move:a}),a?t.closePath():t.lineTo(c.x,i)}t.lineTo(e.first().x,i),t.closePath(),t.clip()}function Oo(t,e){const{line:i,target:s,property:n,color:o,scale:a}=e,r=function(t,e,i){const s=t.segments,n=t.points,o=e.points,a=[];for(const t of s){let{start:s,end:r}=t;r=mo(s,r,n);const l=po(i,n[s],n[r],t.loop);if(!e.segments){a.push({source:t,target:l,start:n[s],end:n[r]});continue}const h=Pi(e,l);for(const e of h){const s=po(i,o[e.start],o[e.end],e.loop),r=Si(t,n,s);for(const t of r)a.push({source:t,target:e,start:{[i]:bo(l,s,"start",Math.max)},end:{[i]:bo(l,s,"end",Math.min)}})}}return a}(i,s,n);for(const{source:e,target:l,start:h,end:c}of r){const{style:{backgroundColor:r=o}={}}=e,d=!0!==s;t.save(),t.fillStyle=r,Co(t,a,d&&po(n,h,c)),t.beginPath();const u=!!i.pathSegment(t,e);let f;if(d){u?t.closePath():Ao(t,s,c,n);const e=!!s.pathSegment(t,l,{move:u,reverse:!0});f=u&&e,f||Ao(t,s,h,n)}t.closePath(),t.fill(f?"evenodd":"nonzero"),t.restore()}}function Co(t,e,i){const{top:s,bottom:n}=e.chart.chartArea,{property:o,start:a,end:r}=i||{};"x"===o&&(t.beginPath(),t.rect(a,s,r-a,n-s),t.clip())}function Ao(t,e,i,s){const n=e.interpolate(i,s);n&&t.lineTo(n.x,n.y)}var To={id:"filler",afterDatasetsUpdate(t,e,i){const s=(t.data.datasets||[]).length,n=[];let o,a,r,l;for(a=0;a<s;++a)o=t.getDatasetMeta(a),r=o.dataset,l=null,r&&r.options&&r instanceof to&&(l={visible:t.isDatasetVisible(a),index:a,fill:vo(r,a,s),chart:t,axis:o.controller.options.indexAxis,scale:o.vScale,line:r}),o.$filler=l,n.push(l);for(a=0;a<s;++a)l=n[a],l&&!1!==l.fill&&(l.fill=yo(n,a,i.propagate))},beforeDraw(t,e,i){const s="beforeDraw"===i.drawTime,n=t.getSortedVisibleDatasetMetas(),o=t.chartArea;for(let e=n.length-1;e>=0;--e){const i=n[e].$filler;i&&(i.line.updateControlPoints(o,i.axis),s&&i.fill&&Po(t.ctx,i,o))}},beforeDatasetsDraw(t,e,i){if("beforeDatasetsDraw"!==i.drawTime)return;const s=t.getSortedVisibleDatasetMetas();for(let e=s.length-1;e>=0;--e){const i=s[e].$filler;_o(i)&&Po(t.ctx,i,t.chartArea)}},beforeDatasetDraw(t,e,i){const s=e.meta.$filler;_o(s)&&"beforeDatasetDraw"===i.drawTime&&Po(t.ctx,s,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Lo=(t,e)=>{let{boxHeight:i=e,boxWidth:s=e}=t;return t.usePointStyle&&(i=Math.min(i,e),s=t.pointStyleWidth||Math.min(s,e)),{boxWidth:s,boxHeight:i,itemHeight:Math.max(e,i)}};class Eo extends Es{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=c(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter((e=>t.filter(e,this.chart.data)))),t.sort&&(e=e.sort(((e,i)=>t.sort(e,i,this.chart.data)))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display)return void(this.width=this.height=0);const i=t.labels,s=mi(i.font),n=s.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:r}=Lo(i,n);let l,h;e.font=s.string,this.isHorizontal()?(l=this.maxWidth,h=this._fitRows(o,n,a,r)+10):(h=this.maxHeight,l=this._fitCols(o,n,a,r)+10),this.width=Math.min(l,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,s){const{ctx:n,maxWidth:o,options:{labels:{padding:a}}}=this,r=this.legendHitBoxes=[],l=this.lineWidths=[0],h=s+a;let c=t;n.textAlign="left",n.textBaseline="middle";let d=-1,u=-h;return this.legendItems.forEach(((t,f)=>{const g=i+e/2+n.measureText(t.text).width;(0===f||l[l.length-1]+g+2*a>o)&&(c+=h,l[l.length-(f>0?0:1)]=0,u+=h,d++),r[f]={left:0,top:u,row:d,width:g,height:s},l[l.length-1]+=g+a})),c}_fitCols(t,e,i,s){const{ctx:n,maxHeight:o,options:{labels:{padding:a}}}=this,r=this.legendHitBoxes=[],l=this.columnSizes=[],h=o-t;let c=a,d=0,u=0,f=0,g=0;return this.legendItems.forEach(((t,o)=>{const p=i+e/2+n.measureText(t.text).width;o>0&&u+s+2*a>h&&(c+=d+a,l.push({width:d,height:u}),f+=d+a,g++,d=u=0),r[o]={left:f,top:u,col:g,width:p,height:s},d=Math.max(d,p),u+=s+a})),c+=d,l.push({width:d,height:u}),c}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:s},rtl:n}}=this,o=yi(n,this.left,this.width);if(this.isHorizontal()){let n=0,a=ut(i,this.left+s,this.right-this.lineWidths[n]);for(const r of e)n!==r.row&&(n=r.row,a=ut(i,this.left+s,this.right-this.lineWidths[n])),r.top+=this.top+t+s,r.left=o.leftForLtr(o.x(a),r.width),a+=r.width+s}else{let n=0,a=ut(i,this.top+t+s,this.bottom-this.columnSizes[n].height);for(const r of e)r.col!==n&&(n=r.col,a=ut(i,this.top+t+s,this.bottom-this.columnSizes[n].height)),r.top=a,r.left+=this.left+s,r.left=o.leftForLtr(o.x(r.left),r.width),a+=r.height+s}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const t=this.ctx;Pe(t,this),this._draw(),De(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:s}=this,{align:n,labels:o}=t,a=ne.color,l=yi(t.rtl,this.left,this.width),h=mi(o.font),{color:c,padding:d}=o,u=h.size,f=u/2;let g;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=h.string;const{boxWidth:p,boxHeight:m,itemHeight:b}=Lo(o,u),x=this.isHorizontal(),_=this._computeTitleHeight();g=x?{x:ut(n,this.left+d,this.right-i[0]),y:this.top+d+_,line:0}:{x:this.left+d,y:ut(n,this.top+_+d,this.bottom-e[0].height),line:0},vi(this.ctx,t.textDirection);const y=b+d;this.legendItems.forEach(((v,w)=>{s.strokeStyle=v.fontColor||c,s.fillStyle=v.fontColor||c;const M=s.measureText(v.text).width,k=l.textAlign(v.textAlign||(v.textAlign=o.textAlign)),S=p+f+M;let P=g.x,D=g.y;l.setWidth(this.width),x?w>0&&P+S+d>this.right&&(D=g.y+=y,g.line++,P=g.x=ut(n,this.left+d,this.right-i[g.line])):w>0&&D+y>this.bottom&&(P=g.x=P+e[g.line].width+d,g.line++,D=g.y=ut(n,this.top+_+d,this.bottom-e[g.line].height));!function(t,e,i){if(isNaN(p)||p<=0||isNaN(m)||m<0)return;s.save();const n=r(i.lineWidth,1);if(s.fillStyle=r(i.fillStyle,a),s.lineCap=r(i.lineCap,"butt"),s.lineDashOffset=r(i.lineDashOffset,0),s.lineJoin=r(i.lineJoin,"miter"),s.lineWidth=n,s.strokeStyle=r(i.strokeStyle,a),s.setLineDash(r(i.lineDash,[])),o.usePointStyle){const a={radius:m*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:n},r=l.xPlus(t,p/2);ke(s,a,r,e+f,o.pointStyleWidth&&p)}else{const o=e+Math.max((u-m)/2,0),a=l.leftForLtr(t,p),r=gi(i.borderRadius);s.beginPath(),Object.values(r).some((t=>0!==t))?Le(s,{x:a,y:o,w:p,h:m,radius:r}):s.rect(a,o,p,m),s.fill(),0!==n&&s.stroke()}s.restore()}(l.x(P),D,v),P=ft(k,P+p+f,x?P+S:this.right,t.rtl),function(t,e,i){Ae(s,i.text,t,e+b/2,h,{strikethrough:i.hidden,textAlign:l.textAlign(i.textAlign)})}(l.x(P),D,v),x?g.x+=S+d:g.y+=y})),wi(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=mi(e.font),s=pi(e.padding);if(!e.display)return;const n=yi(t.rtl,this.left,this.width),o=this.ctx,a=e.position,r=i.size/2,l=s.top+r;let h,c=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),h=this.top+l,c=ut(t.align,c,this.right-d);else{const e=this.columnSizes.reduce(((t,e)=>Math.max(t,e.height)),0);h=l+ut(t.align,this.top,this.bottom-e-t.labels.padding-this._computeTitleHeight())}const u=ut(a,c,c+d);o.textAlign=n.textAlign(dt(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,Ae(o,e.text,u,h,i)}_computeTitleHeight(){const t=this.options.title,e=mi(t.font),i=pi(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,s,n;if(Q(t,this.left,this.right)&&Q(e,this.top,this.bottom))for(n=this.legendHitBoxes,i=0;i<n.length;++i)if(s=n[i],Q(t,s.left,s.left+s.width)&&Q(e,s.top,s.top+s.height))return this.legendItems[i];return null}handleEvent(t){const e=this.options;if(!function(t,e){if(("mousemove"===t||"mouseout"===t)&&(e.onHover||e.onLeave))return!0;if(e.onClick&&("click"===t||"mouseup"===t))return!0;return!1}(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if("mousemove"===t.type||"mouseout"===t.type){const o=this._hoveredItem,a=(n=i,null!==(s=o)&&null!==n&&s.datasetIndex===n.datasetIndex&&s.index===n.index);o&&!a&&c(e.onLeave,[t,o,this],this),this._hoveredItem=i,i&&!a&&c(e.onHover,[t,i,this],this)}else i&&c(e.onClick,[t,i,this],this);var s,n}}var Ro={id:"legend",_element:Eo,start(t,e,i){const s=t.legend=new Eo({ctx:t.ctx,options:i,chart:t});Zi.configure(t,s,i),Zi.addBox(t,s)},stop(t){Zi.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,i){const s=t.legend;Zi.configure(t,s,i),s.options=i},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,i){const s=e.datasetIndex,n=i.chart;n.isDatasetVisible(s)?(n.hide(s),e.hidden=!0):(n.show(s),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:i,pointStyle:s,textAlign:n,color:o}}=t.legend.options;return t._getSortedDatasetMetas().map((t=>{const a=t.controller.getStyle(i?0:void 0),r=pi(a.borderWidth);return{text:e[t.index].label,fillStyle:a.backgroundColor,fontColor:o,hidden:!t.visible,lineCap:a.borderCapStyle,lineDash:a.borderDash,lineDashOffset:a.borderDashOffset,lineJoin:a.borderJoinStyle,lineWidth:(r.width+r.height)/4,strokeStyle:a.borderColor,pointStyle:s||a.pointStyle,rotation:a.rotation,textAlign:n||a.textAlign,borderRadius:0,datasetIndex:t.index}}),this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Io extends Es{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=t,this.height=this.bottom=e;const n=s(i.text)?i.text.length:1;this._padding=pi(i.padding);const o=n*mi(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return"top"===t||"bottom"===t}_drawArgs(t){const{top:e,left:i,bottom:s,right:n,options:o}=this,a=o.align;let r,l,h,c=0;return this.isHorizontal()?(l=ut(a,i,n),h=e+t,r=n-i):("left"===o.position?(l=i+t,h=ut(a,s,e),c=-.5*D):(l=n-t,h=ut(a,e,s),c=.5*D),r=s-e),{titleX:l,titleY:h,maxWidth:r,rotation:c}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=mi(e.font),s=i.lineHeight/2+this._padding.top,{titleX:n,titleY:o,maxWidth:a,rotation:r}=this._drawArgs(s);Ae(t,e.text,0,0,i,{color:e.color,maxWidth:a,rotation:r,textAlign:dt(e.align),textBaseline:"middle",translation:[n,o]})}}var zo={id:"title",_element:Io,start(t,e,i){!function(t,e){const i=new Io({ctx:t.ctx,options:e,chart:t});Zi.configure(t,i,e),Zi.addBox(t,i),t.titleBlock=i}(t,i)},stop(t){const e=t.titleBlock;Zi.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,i){const s=t.titleBlock;Zi.configure(t,s,i),s.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Fo=new WeakMap;var Vo={id:"subtitle",start(t,e,i){const s=new Io({ctx:t.ctx,options:i,chart:t});Zi.configure(t,s,i),Zi.addBox(t,s),Fo.set(t,s)},stop(t){Zi.removeBox(t,Fo.get(t)),Fo.delete(t)},beforeUpdate(t,e,i){const s=Fo.get(t);Zi.configure(t,s,i),s.options=i},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Bo={average(t){if(!t.length)return!1;let e,i,s=0,n=0,o=0;for(e=0,i=t.length;e<i;++e){const i=t[e].element;if(i&&i.hasValue()){const t=i.tooltipPosition();s+=t.x,n+=t.y,++o}}return{x:s/o,y:n/o}},nearest(t,e){if(!t.length)return!1;let i,s,n,o=e.x,a=e.y,r=Number.POSITIVE_INFINITY;for(i=0,s=t.length;i<s;++i){const s=t[i].element;if(s&&s.hasValue()){const t=X(e,s.getCenterPoint());t<r&&(r=t,n=s)}}if(n){const t=n.tooltipPosition();o=t.x,a=t.y}return{x:o,y:a}}};function No(t,e){return e&&(s(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function Wo(t){return("string"==typeof t||t instanceof String)&&t.indexOf("\n")>-1?t.split("\n"):t}function jo(t,e){const{element:i,datasetIndex:s,index:n}=e,o=t.getDatasetMeta(s).controller,{label:a,value:r}=o.getLabelAndValue(n);return{chart:t,label:a,parsed:o.getParsed(n),raw:t.data.datasets[s].data[n],formattedValue:r,dataset:o.getDataset(),dataIndex:n,datasetIndex:s,element:i}}function Ho(t,e){const i=t.chart.ctx,{body:s,footer:n,title:o}=t,{boxWidth:a,boxHeight:r}=e,l=mi(e.bodyFont),h=mi(e.titleFont),c=mi(e.footerFont),u=o.length,f=n.length,g=s.length,p=pi(e.padding);let m=p.height,b=0,x=s.reduce(((t,e)=>t+e.before.length+e.lines.length+e.after.length),0);if(x+=t.beforeBody.length+t.afterBody.length,u&&(m+=u*h.lineHeight+(u-1)*e.titleSpacing+e.titleMarginBottom),x){m+=g*(e.displayColors?Math.max(r,l.lineHeight):l.lineHeight)+(x-g)*l.lineHeight+(x-1)*e.bodySpacing}f&&(m+=e.footerMarginTop+f*c.lineHeight+(f-1)*e.footerSpacing);let _=0;const y=function(t){b=Math.max(b,i.measureText(t).width+_)};return i.save(),i.font=h.string,d(t.title,y),i.font=l.string,d(t.beforeBody.concat(t.afterBody),y),_=e.displayColors?a+2+e.boxPadding:0,d(s,(t=>{d(t.before,y),d(t.lines,y),d(t.after,y)})),_=0,i.font=c.string,d(t.footer,y),i.restore(),b+=p.width,{width:b,height:m}}function $o(t,e,i,s){const{x:n,width:o}=i,{width:a,chartArea:{left:r,right:l}}=t;let h="center";return"center"===s?h=n<=(r+l)/2?"left":"right":n<=o/2?h="left":n>=a-o/2&&(h="right"),function(t,e,i,s){const{x:n,width:o}=s,a=i.caretSize+i.caretPadding;return"left"===t&&n+o+a>e.width||"right"===t&&n-o-a<0||void 0}(h,t,e,i)&&(h="center"),h}function Yo(t,e,i){const s=i.yAlign||e.yAlign||function(t,e){const{y:i,height:s}=e;return i<s/2?"top":i>t.height-s/2?"bottom":"center"}(t,i);return{xAlign:i.xAlign||e.xAlign||$o(t,e,i,s),yAlign:s}}function Uo(t,e,i,s){const{caretSize:n,caretPadding:o,cornerRadius:a}=t,{xAlign:r,yAlign:l}=i,h=n+o,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:f}=gi(a);let g=function(t,e){let{x:i,width:s}=t;return"right"===e?i-=s:"center"===e&&(i-=s/2),i}(e,r);const p=function(t,e,i){let{y:s,height:n}=t;return"top"===e?s+=i:s-="bottom"===e?n+i:n/2,s}(e,l,h);return"center"===l?"left"===r?g+=h:"right"===r&&(g-=h):"left"===r?g-=Math.max(c,u)+n:"right"===r&&(g+=Math.max(d,f)+n),{x:Z(g,0,s.width-e.width),y:Z(p,0,s.height-e.height)}}function Xo(t,e,i){const s=pi(i.padding);return"center"===e?t.x+t.width/2:"right"===e?t.x+t.width-s.right:t.x+s.left}function qo(t){return No([],Wo(t))}function Ko(t,e){const i=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return i?t.override(i):t}class Go extends Es{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart||t._chart,this._chart=this.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&e.options.animation&&i.animations,n=new ys(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(n)),n}getContext(){return this.$context||(this.$context=(t=this.chart.getContext(),e=this,i=this._tooltipItems,_i(t,{tooltip:e,tooltipItems:i,type:"tooltip"})));var t,e,i}getTitle(t,e){const{callbacks:i}=e,s=i.beforeTitle.apply(this,[t]),n=i.title.apply(this,[t]),o=i.afterTitle.apply(this,[t]);let a=[];return a=No(a,Wo(s)),a=No(a,Wo(n)),a=No(a,Wo(o)),a}getBeforeBody(t,e){return qo(e.callbacks.beforeBody.apply(this,[t]))}getBody(t,e){const{callbacks:i}=e,s=[];return d(t,(t=>{const e={before:[],lines:[],after:[]},n=Ko(i,t);No(e.before,Wo(n.beforeLabel.call(this,t))),No(e.lines,n.label.call(this,t)),No(e.after,Wo(n.afterLabel.call(this,t))),s.push(e)})),s}getAfterBody(t,e){return qo(e.callbacks.afterBody.apply(this,[t]))}getFooter(t,e){const{callbacks:i}=e,s=i.beforeFooter.apply(this,[t]),n=i.footer.apply(this,[t]),o=i.afterFooter.apply(this,[t]);let a=[];return a=No(a,Wo(s)),a=No(a,Wo(n)),a=No(a,Wo(o)),a}_createItems(t){const e=this._active,i=this.chart.data,s=[],n=[],o=[];let a,r,l=[];for(a=0,r=e.length;a<r;++a)l.push(jo(this.chart,e[a]));return t.filter&&(l=l.filter(((e,s,n)=>t.filter(e,s,n,i)))),t.itemSort&&(l=l.sort(((e,s)=>t.itemSort(e,s,i)))),d(l,(e=>{const i=Ko(t.callbacks,e);s.push(i.labelColor.call(this,e)),n.push(i.labelPointStyle.call(this,e)),o.push(i.labelTextColor.call(this,e))})),this.labelColors=s,this.labelPointStyles=n,this.labelTextColors=o,this.dataPoints=l,l}update(t,e){const i=this.options.setContext(this.getContext()),s=this._active;let n,o=[];if(s.length){const t=Bo[i.position].call(this,s,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const e=this._size=Ho(this,i),a=Object.assign({},t,e),r=Yo(this.chart,i,a),l=Uo(i,a,r,this.chart);this.xAlign=r.xAlign,this.yAlign=r.yAlign,n={opacity:1,x:l.x,y:l.y,width:e.width,height:e.height,caretX:t.x,caretY:t.y}}else 0!==this.opacity&&(n={opacity:0});this._tooltipItems=o,this.$context=void 0,n&&this._resolveAnimations().update(this,n),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,s){const n=this.getCaretPosition(t,i,s);e.lineTo(n.x1,n.y1),e.lineTo(n.x2,n.y2),e.lineTo(n.x3,n.y3)}getCaretPosition(t,e,i){const{xAlign:s,yAlign:n}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:r,topRight:l,bottomLeft:h,bottomRight:c}=gi(a),{x:d,y:u}=t,{width:f,height:g}=e;let p,m,b,x,_,y;return"center"===n?(_=u+g/2,"left"===s?(p=d,m=p-o,x=_+o,y=_-o):(p=d+f,m=p+o,x=_-o,y=_+o),b=p):(m="left"===s?d+Math.max(r,h)+o:"right"===s?d+f-Math.max(l,c)-o:this.caretX,"top"===n?(x=u,_=x-o,p=m-o,b=m+o):(x=u+g,_=x+o,p=m+o,b=m-o),y=x),{x1:p,x2:m,x3:b,y1:x,y2:_,y3:y}}drawTitle(t,e,i){const s=this.title,n=s.length;let o,a,r;if(n){const l=yi(i.rtl,this.x,this.width);for(t.x=Xo(this,i.titleAlign,i),e.textAlign=l.textAlign(i.titleAlign),e.textBaseline="middle",o=mi(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,r=0;r<n;++r)e.fillText(s[r],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,r+1===n&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,s,o){const a=this.labelColors[i],r=this.labelPointStyles[i],{boxHeight:l,boxWidth:h,boxPadding:c}=o,d=mi(o.bodyFont),u=Xo(this,"left",o),f=s.x(u),g=l<d.lineHeight?(d.lineHeight-l)/2:0,p=e.y+g;if(o.usePointStyle){const e={radius:Math.min(h,l)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},i=s.leftForLtr(f,h)+h/2,n=p+l/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,Me(t,e,i,n),t.strokeStyle=a.borderColor,t.fillStyle=a.backgroundColor,Me(t,e,i,n)}else{t.lineWidth=n(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,t.strokeStyle=a.borderColor,t.setLineDash(a.borderDash||[]),t.lineDashOffset=a.borderDashOffset||0;const e=s.leftForLtr(f,h-c),i=s.leftForLtr(s.xPlus(f,1),h-c-2),r=gi(a.borderRadius);Object.values(r).some((t=>0!==t))?(t.beginPath(),t.fillStyle=o.multiKeyBackground,Le(t,{x:e,y:p,w:h,h:l,radius:r}),t.fill(),t.stroke(),t.fillStyle=a.backgroundColor,t.beginPath(),Le(t,{x:i,y:p+1,w:h-2,h:l-2,radius:r}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(e,p,h,l),t.strokeRect(e,p,h,l),t.fillStyle=a.backgroundColor,t.fillRect(i,p+1,h-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:s}=this,{bodySpacing:n,bodyAlign:o,displayColors:a,boxHeight:r,boxWidth:l,boxPadding:h}=i,c=mi(i.bodyFont);let u=c.lineHeight,f=0;const g=yi(i.rtl,this.x,this.width),p=function(i){e.fillText(i,g.x(t.x+f),t.y+u/2),t.y+=u+n},m=g.textAlign(o);let b,x,_,y,v,w,M;for(e.textAlign=o,e.textBaseline="middle",e.font=c.string,t.x=Xo(this,m,i),e.fillStyle=i.bodyColor,d(this.beforeBody,p),f=a&&"right"!==m?"center"===o?l/2+h:l+2+h:0,y=0,w=s.length;y<w;++y){for(b=s[y],x=this.labelTextColors[y],e.fillStyle=x,d(b.before,p),_=b.lines,a&&_.length&&(this._drawColorBox(e,t,y,g,i),u=Math.max(c.lineHeight,r)),v=0,M=_.length;v<M;++v)p(_[v]),u=c.lineHeight;d(b.after,p)}f=0,u=c.lineHeight,d(this.afterBody,p),t.y-=n}drawFooter(t,e,i){const s=this.footer,n=s.length;let o,a;if(n){const r=yi(i.rtl,this.x,this.width);for(t.x=Xo(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=r.textAlign(i.footerAlign),e.textBaseline="middle",o=mi(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<n;++a)e.fillText(s[a],r.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,s){const{xAlign:n,yAlign:o}=this,{x:a,y:r}=t,{width:l,height:h}=i,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:f}=gi(s.cornerRadius);e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.beginPath(),e.moveTo(a+c,r),"top"===o&&this.drawCaret(t,e,i,s),e.lineTo(a+l-d,r),e.quadraticCurveTo(a+l,r,a+l,r+d),"center"===o&&"right"===n&&this.drawCaret(t,e,i,s),e.lineTo(a+l,r+h-f),e.quadraticCurveTo(a+l,r+h,a+l-f,r+h),"bottom"===o&&this.drawCaret(t,e,i,s),e.lineTo(a+u,r+h),e.quadraticCurveTo(a,r+h,a,r+h-u),"center"===o&&"left"===n&&this.drawCaret(t,e,i,s),e.lineTo(a,r+c),e.quadraticCurveTo(a,r,a+c,r),e.closePath(),e.fill(),s.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,s=i&&i.x,n=i&&i.y;if(s||n){const i=Bo[t.position].call(this,this._active,this._eventPosition);if(!i)return;const o=this._size=Ho(this,t),a=Object.assign({},i,this._size),r=Yo(e,t,a),l=Uo(t,a,r,e);s._to===l.x&&n._to===l.y||(this.xAlign=r.xAlign,this.yAlign=r.yAlign,this.width=o.width,this.height=o.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const s={width:this.width,height:this.height},n={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=pi(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(n,t,s,e),vi(t,e.textDirection),n.y+=o.top,this.drawTitle(n,t,e),this.drawBody(n,t,e),this.drawFooter(n,t,e),wi(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,s=t.map((({datasetIndex:t,index:e})=>{const i=this.chart.getDatasetMeta(t);if(!i)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:i.data[e],index:e}})),n=!u(i,s),o=this._positionChanged(s,e);(n||o)&&(this._active=s,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,n=this._active||[],o=this._getActiveElements(t,n,e,i),a=this._positionChanged(o,t),r=e||!u(o,n)||a;return r&&(this._active=o,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),r}_getActiveElements(t,e,i,s){const n=this.options;if("mouseout"===t.type)return[];if(!s)return e;const o=this.chart.getElementsAtEventForMode(t,n.mode,n,i);return n.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:s,options:n}=this,o=Bo[n.position].call(this,t,e);return!1!==o&&(i!==o.x||s!==o.y)}}Go.positioners=Bo;var Zo={id:"tooltip",_element:Go,positioners:Bo,afterInit(t,e,i){i&&(t.tooltip=new Go({chart:t,options:i}))},beforeUpdate(t,e,i){t.tooltip&&t.tooltip.initialize(i)},reset(t,e,i){t.tooltip&&t.tooltip.initialize(i)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const i={tooltip:e};if(!1===t.notifyPlugins("beforeTooltipDraw",i))return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",i)}},afterEvent(t,e){if(t.tooltip){const i=e.replay;t.tooltip.handleEvent(e.event,i,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:t,title(t){if(t.length>0){const e=t[0],i=e.chart.data.labels,s=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return e.dataset.label||"";if(e.label)return e.label;if(s>0&&e.dataIndex<s)return i[e.dataIndex]}return""},afterTitle:t,beforeBody:t,beforeLabel:t,label(t){if(this&&this.options&&"dataset"===this.options.mode)return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const s=t.formattedValue;return i(s)||(e+=s),e},labelColor(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:t,afterBody:t,beforeFooter:t,footer:t,afterFooter:t}},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>"filter"!==t&&"itemSort"!==t&&"external"!==t,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Jo=Object.freeze({__proto__:null,Decimation:go,Filler:To,Legend:Ro,SubTitle:Vo,Title:zo,Tooltip:Zo});function Qo(t,e,i,s){const n=t.indexOf(e);if(-1===n)return((t,e,i,s)=>("string"==typeof e?(i=t.push(e)-1,s.unshift({index:i,label:e})):isNaN(e)&&(i=null),i))(t,e,i,s);return n!==t.lastIndexOf(e)?i:n}class ta extends $s{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const t=this.getLabels();for(const{index:i,label:s}of e)t[i]===s&&t.splice(i,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(i(t))return null;const s=this.getLabels();return((t,e)=>null===t?null:Z(Math.round(t),0,e))(e=isFinite(e)&&s[e]===t?e:Qo(s,t,r(e,t),this._addedLabels),s.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);"ticks"===this.options.bounds&&(t||(i=0),e||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,s=[];let n=this.getLabels();n=0===t&&e===n.length-1?n:n.slice(t,e+1),this._valueRange=Math.max(n.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let i=t;i<=e;i++)s.push({value:i});return s}getLabelForValue(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return"number"!=typeof t&&(t=this.parse(t)),null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function ea(t,e,{horizontal:i,minRotation:s}){const n=H(s),o=(i?Math.sin(n):Math.cos(n))||.001,a=.75*e*(""+t).length;return Math.min(e/o,a)}ta.id="category",ta.defaults={ticks:{callback:ta.prototype.getLabelForValue}};class ia extends $s{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return i(t)||("number"==typeof t||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:s,max:n}=this;const o=t=>s=e?s:t,a=t=>n=i?n:t;if(t){const t=z(s),e=z(n);t<0&&e<0?a(0):t>0&&e>0&&o(0)}if(s===n){let e=1;(n>=Number.MAX_SAFE_INTEGER||s<=Number.MIN_SAFE_INTEGER)&&(e=Math.abs(.05*n)),a(n+e),t||o(s-e)}this.min=s,this.max=n}getTickLimit(){const t=this.options.ticks;let e,{maxTicksLimit:i,stepSize:s}=t;return s?(e=Math.ceil(this.max/s)-Math.floor(this.min/s)+1,e>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${s} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3)):(e=this.computeTickLimit(),i=i||11),i&&(e=Math.min(i,e)),e}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let s=this.getTickLimit();s=Math.max(2,s);const n=function(t,e){const s=[],{bounds:n,step:o,min:a,max:r,precision:l,count:h,maxTicks:c,maxDigits:d,includeBounds:u}=t,f=o||1,g=c-1,{min:p,max:m}=e,b=!i(a),x=!i(r),_=!i(h),y=(m-p)/(d+1);let v,w,M,k,S=F((m-p)/g/f)*f;if(S<1e-14&&!b&&!x)return[{value:p},{value:m}];k=Math.ceil(m/S)-Math.floor(p/S),k>g&&(S=F(k*S/g/f)*f),i(l)||(v=Math.pow(10,l),S=Math.ceil(S*v)/v),"ticks"===n?(w=Math.floor(p/S)*S,M=Math.ceil(m/S)*S):(w=p,M=m),b&&x&&o&&W((r-a)/o,S/1e3)?(k=Math.round(Math.min((r-a)/S,c)),S=(r-a)/k,w=a,M=r):_?(w=b?a:w,M=x?r:M,k=h-1,S=(M-w)/k):(k=(M-w)/S,k=N(k,Math.round(k),S/1e3)?Math.round(k):Math.ceil(k));const P=Math.max(Y(S),Y(w));v=Math.pow(10,i(l)?P:l),w=Math.round(w*v)/v,M=Math.round(M*v)/v;let D=0;for(b&&(u&&w!==a?(s.push({value:a}),w<a&&D++,N(Math.round((w+D*S)*v)/v,a,ea(a,y,t))&&D++):w<a&&D++);D<k;++D)s.push({value:Math.round((w+D*S)*v)/v});return x&&u&&M!==r?s.length&&N(s[s.length-1].value,r,ea(r,y,t))?s[s.length-1].value=r:s.push({value:r}):x&&M!==r||s.push({value:M}),s}({maxTicks:s,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:!1!==e.includeBounds},this._range||this);return"ticks"===t.bounds&&j(n,this,"value"),t.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-e)/Math.max(t.length-1,1)/2;e-=s,i+=s}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return li(t,this.chart.options.locale,this.options.ticks.format)}}class sa extends ia{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=o(t)?t:0,this.max=o(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=H(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,n=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,n.lineHeight/s))}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}function na(t){return 1===t/Math.pow(10,Math.floor(I(t)))}sa.id="linear",sa.defaults={ticks:{callback:Is.formatters.numeric}};class oa extends $s{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=ia.prototype.parse.apply(this,[t,e]);if(0!==i)return o(i)&&i>0?i:null;this._zero=!0}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=o(t)?Math.max(0,t):null,this.max=o(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,s=this.max;const n=e=>i=t?i:e,o=t=>s=e?s:t,a=(t,e)=>Math.pow(10,Math.floor(I(t))+e);i===s&&(i<=0?(n(1),o(10)):(n(a(i,-1)),o(a(s,1)))),i<=0&&n(a(s,-1)),s<=0&&o(a(i,1)),this._zero&&this.min!==this._suggestedMin&&i===a(this.min,0)&&n(a(i,-1)),this.min=i,this.max=s}buildTicks(){const t=this.options,e=function(t,e){const i=Math.floor(I(e.max)),s=Math.ceil(e.max/Math.pow(10,i)),n=[];let o=a(t.min,Math.pow(10,Math.floor(I(e.min)))),r=Math.floor(I(o)),l=Math.floor(o/Math.pow(10,r)),h=r<0?Math.pow(10,Math.abs(r)):1;do{n.push({value:o,major:na(o)}),++l,10===l&&(l=1,++r,h=r>=0?1:h),o=Math.round(l*Math.pow(10,r)*h)/h}while(r<i||r===i&&l<s);const c=a(t.max,o);return n.push({value:c,major:na(o)}),n}({min:this._userMin,max:this._userMax},this);return"ticks"===t.bounds&&j(e,this,"value"),t.reverse?(e.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),e}getLabelForValue(t){return void 0===t?"0":li(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=I(t),this._valueRange=I(this.max)-I(t)}getPixelForValue(t){return void 0!==t&&0!==t||(t=this.min),null===t||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(I(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function aa(t){const e=t.ticks;if(e.display&&t.display){const t=pi(e.backdropPadding);return r(e.font&&e.font.size,ne.font.size)+t.height}return 0}function ra(t,e,i,s,n){return t===s||t===n?{start:e-i/2,end:e+i/2}:t<s||t>n?{start:e-i,end:e}:{start:e,end:e+i}}function la(t){const e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},i=Object.assign({},e),n=[],o=[],a=t._pointLabels.length,r=t.options.pointLabels,l=r.centerPointLabels?D/a:0;for(let u=0;u<a;u++){const a=r.setContext(t.getPointLabelContext(u));o[u]=a.padding;const f=t.getPointPosition(u,t.drawingArea+o[u],l),g=mi(a.font),p=(h=t.ctx,c=g,d=s(d=t._pointLabels[u])?d:[d],{w:ye(h,c.string,d),h:d.length*c.lineHeight});n[u]=p;const m=K(t.getIndexAngle(u)+l),b=Math.round($(m));ha(i,e,m,ra(b,f.x,p.w,0,180),ra(b,f.y,p.h,90,270))}var h,c,d;t.setCenterPoint(e.l-i.l,i.r-e.r,e.t-i.t,i.b-e.b),t._pointLabelItems=function(t,e,i){const s=[],n=t._pointLabels.length,o=t.options,a=aa(o)/2,r=t.drawingArea,l=o.pointLabels.centerPointLabels?D/n:0;for(let o=0;o<n;o++){const n=t.getPointPosition(o,r+a+i[o],l),h=Math.round($(K(n.angle+L))),c=e[o],d=ua(n.y,c.h,h),u=ca(h),f=da(n.x,c.w,u);s.push({x:n.x,y:d,textAlign:u,left:f,top:d,right:f+c.w,bottom:d+c.h})}return s}(t,n,o)}function ha(t,e,i,s,n){const o=Math.abs(Math.sin(i)),a=Math.abs(Math.cos(i));let r=0,l=0;s.start<e.l?(r=(e.l-s.start)/o,t.l=Math.min(t.l,e.l-r)):s.end>e.r&&(r=(s.end-e.r)/o,t.r=Math.max(t.r,e.r+r)),n.start<e.t?(l=(e.t-n.start)/a,t.t=Math.min(t.t,e.t-l)):n.end>e.b&&(l=(n.end-e.b)/a,t.b=Math.max(t.b,e.b+l))}function ca(t){return 0===t||180===t?"center":t<180?"left":"right"}function da(t,e,i){return"right"===i?t-=e:"center"===i&&(t-=e/2),t}function ua(t,e,i){return 90===i||270===i?t-=e/2:(i>270||i<90)&&(t-=e),t}function fa(t,e,i,s){const{ctx:n}=t;if(i)n.arc(t.xCenter,t.yCenter,e,0,O);else{let i=t.getPointPosition(0,e);n.moveTo(i.x,i.y);for(let o=1;o<s;o++)i=t.getPointPosition(o,e),n.lineTo(i.x,i.y)}}oa.id="logarithmic",oa.defaults={ticks:{callback:Is.formatters.logarithmic,major:{enabled:!0}}};class ga extends ia{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=pi(aa(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=o(t)&&!isNaN(t)?t:0,this.max=o(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/aa(this.options))}generateTickLabels(t){ia.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map(((t,e)=>{const i=c(this.options.pointLabels.callback,[t,e],this);return i||0===i?i:""})).filter(((t,e)=>this.chart.getDataVisibility(e)))}fit(){const t=this.options;t.display&&t.pointLabels.display?la(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,s){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,s))}getIndexAngle(t){return K(t*(O/(this._pointLabels.length||1))+H(this.options.startAngle||0))}getDistanceFromCenterForValue(t){if(i(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(i(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return function(t,e,i){return _i(t,{label:i,index:e,type:"pointLabel"})}(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const s=this.getIndexAngle(t)-L+i;return{x:Math.cos(s)*e+this.xCenter,y:Math.sin(s)*e+this.yCenter,angle:s}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:s,bottom:n}=this._pointLabelItems[t];return{left:e,top:i,right:s,bottom:n}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),fa(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:s,grid:n}=e,o=this._pointLabels.length;let a,r,l;if(e.pointLabels.display&&function(t,e){const{ctx:s,options:{pointLabels:n}}=t;for(let o=e-1;o>=0;o--){const e=n.setContext(t.getPointLabelContext(o)),a=mi(e.font),{x:r,y:l,textAlign:h,left:c,top:d,right:u,bottom:f}=t._pointLabelItems[o],{backdropColor:g}=e;if(!i(g)){const t=gi(e.borderRadius),i=pi(e.backdropPadding);s.fillStyle=g;const n=c-i.left,o=d-i.top,a=u-c+i.width,r=f-d+i.height;Object.values(t).some((t=>0!==t))?(s.beginPath(),Le(s,{x:n,y:o,w:a,h:r,radius:t}),s.fill()):s.fillRect(n,o,a,r)}Ae(s,t._pointLabels[o],r,l+a.lineHeight/2,a,{color:e.color,textAlign:h,textBaseline:"middle"})}}(this,o),n.display&&this.ticks.forEach(((t,e)=>{if(0!==e){r=this.getDistanceFromCenterForValue(t.value);!function(t,e,i,s){const n=t.ctx,o=e.circular,{color:a,lineWidth:r}=e;!o&&!s||!a||!r||i<0||(n.save(),n.strokeStyle=a,n.lineWidth=r,n.setLineDash(e.borderDash),n.lineDashOffset=e.borderDashOffset,n.beginPath(),fa(t,i,o,s),n.closePath(),n.stroke(),n.restore())}(this,n.setContext(this.getContext(e-1)),r,o)}})),s.display){for(t.save(),a=o-1;a>=0;a--){const i=s.setContext(this.getPointLabelContext(a)),{color:n,lineWidth:o}=i;o&&n&&(t.lineWidth=o,t.strokeStyle=n,t.setLineDash(i.borderDash),t.lineDashOffset=i.borderDashOffset,r=this.getDistanceFromCenterForValue(e.ticks.reverse?this.min:this.max),l=this.getPointPosition(a,r),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(l.x,l.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let n,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach(((s,a)=>{if(0===a&&!e.reverse)return;const r=i.setContext(this.getContext(a)),l=mi(r.font);if(n=this.getDistanceFromCenterForValue(this.ticks[a].value),r.showLabelBackdrop){t.font=l.string,o=t.measureText(s.label).width,t.fillStyle=r.backdropColor;const e=pi(r.backdropPadding);t.fillRect(-o/2-e.left,-n-l.size/2-e.top,o+e.width,l.size+e.height)}Ae(t,s.label,0,-n,l,{color:r.color})})),t.restore()}drawTitle(){}}ga.id="radialLinear",ga.defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Is.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:t=>t,padding:5,centerPointLabels:!1}},ga.defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"},ga.descriptors={angleLines:{_fallback:"grid"}};const pa={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ma=Object.keys(pa);function ba(t,e){return t-e}function xa(t,e){if(i(e))return null;const s=t._adapter,{parser:n,round:a,isoWeekday:r}=t._parseOpts;let l=e;return"function"==typeof n&&(l=n(l)),o(l)||(l="string"==typeof n?s.parse(l,n):s.parse(l)),null===l?null:(a&&(l="week"!==a||!B(r)&&!0!==r?s.startOf(l,a):s.startOf(l,"isoWeek",r)),+l)}function _a(t,e,i,s){const n=ma.length;for(let o=ma.indexOf(t);o<n-1;++o){const t=pa[ma[o]],n=t.steps?t.steps:Number.MAX_SAFE_INTEGER;if(t.common&&Math.ceil((i-e)/(n*t.size))<=s)return ma[o]}return ma[n-1]}function ya(t,e,i){if(i){if(i.length){const{lo:s,hi:n}=tt(i,e);t[i[s]>=e?i[s]:i[n]]=!0}}else t[e]=!0}function va(t,e,i){const s=[],n={},o=e.length;let a,r;for(a=0;a<o;++a)r=e[a],n[r]=a,s.push({value:r,major:!1});return 0!==o&&i?function(t,e,i,s){const n=t._adapter,o=+n.startOf(e[0].value,s),a=e[e.length-1].value;let r,l;for(r=o;r<=a;r=+n.add(r,1,s))l=i[r],l>=0&&(e[l].major=!0);return e}(t,s,n,i):s}class wa extends $s{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e){const i=t.time||(t.time={}),s=this._adapter=new wn._date(t.adapters.date);s.init(e),b(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return void 0===t?null:xa(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:s,max:n,minDefined:a,maxDefined:r}=this.getUserBounds();function l(t){a||isNaN(t.min)||(s=Math.min(s,t.min)),r||isNaN(t.max)||(n=Math.max(n,t.max))}a&&r||(l(this._getLabelBounds()),"ticks"===t.bounds&&"labels"===t.ticks.source||l(this.getMinMax(!1))),s=o(s)&&!isNaN(s)?s:+e.startOf(Date.now(),i),n=o(n)&&!isNaN(n)?n:+e.endOf(Date.now(),i)+1,this.min=Math.min(s,n-1),this.max=Math.max(s+1,n)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,s="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===t.bounds&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const n=this.min,o=st(s,n,this.max);return this._unit=e.unit||(i.autoSkip?_a(e.minUnit,this.min,this.max,this._getLabelCapacity(n)):function(t,e,i,s,n){for(let o=ma.length-1;o>=ma.indexOf(i);o--){const i=ma[o];if(pa[i].common&&t._adapter.diff(n,s,i)>=e-1)return i}return ma[i?ma.indexOf(i):0]}(this,o.length,e.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(t){for(let e=ma.indexOf(t)+1,i=ma.length;e<i;++e)if(pa[ma[e]].common)return ma[e]}(this._unit):void 0,this.initOffsets(s),t.reverse&&o.reverse(),va(this,o,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map((t=>+t.value)))}initOffsets(t){let e,i,s=0,n=0;this.options.offset&&t.length&&(e=this.getDecimalForValue(t[0]),s=1===t.length?1-e:(this.getDecimalForValue(t[1])-e)/2,i=this.getDecimalForValue(t[t.length-1]),n=1===t.length?i:(i-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;s=Z(s,0,o),n=Z(n,0,o),this._offsets={start:s,end:n,factor:1/(s+1+n)}}_generate(){const t=this._adapter,e=this.min,i=this.max,s=this.options,n=s.time,o=n.unit||_a(n.minUnit,e,i,this._getLabelCapacity(e)),a=r(n.stepSize,1),l="week"===o&&n.isoWeekday,h=B(l)||!0===l,c={};let d,u,f=e;if(h&&(f=+t.startOf(f,"isoWeek",l)),f=+t.startOf(f,h?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const g="data"===s.ticks.source&&this.getDataTimestamps();for(d=f,u=0;d<i;d=+t.add(d,a,o),u++)ya(c,d,g);return d!==i&&"ticks"!==s.bounds&&1!==u||ya(c,d,g),Object.keys(c).sort(((t,e)=>t-e)).map((t=>+t))}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}_tickFormatFunction(t,e,i,s){const n=this.options,o=n.time.displayFormats,a=this._unit,r=this._majorUnit,l=a&&o[a],h=r&&o[r],d=i[e],u=r&&h&&d&&d.major,f=this._adapter.format(t,s||(u?h:l)),g=n.ticks.callback;return g?c(g,[f,e,i],this):f}generateTickLabels(t){let e,i,s;for(e=0,i=t.length;e<i;++e)s=t[e],s.label=this._tickFormatFunction(s.value,e,t)}getDecimalForValue(t){return null===t?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,s=H(this.isHorizontal()?e.maxRotation:e.minRotation),n=Math.cos(s),o=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*n+a*o,h:i*o+a*n}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,s=i[e.unit]||i.millisecond,n=this._tickFormatFunction(t,0,va(this,[t],this._majorUnit),s),o=this._getLabelSize(n),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t,e,i=this._cache.data||[];if(i.length)return i;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(t=0,e=s.length;t<e;++t)i=i.concat(s[t].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const s=this.getLabels();for(e=0,i=s.length;e<i;++e)t.push(xa(this,s[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return rt(t.sort(ba))}}function Ma(t,e,i){let s,n,o,a,r=0,l=t.length-1;i?(e>=t[r].pos&&e<=t[l].pos&&({lo:r,hi:l}=et(t,"pos",e)),({pos:s,time:o}=t[r]),({pos:n,time:a}=t[l])):(e>=t[r].time&&e<=t[l].time&&({lo:r,hi:l}=et(t,"time",e)),({time:s,pos:o}=t[r]),({time:n,pos:a}=t[l]));const h=n-s;return h?o+(a-o)*(e-s)/h:o}wa.id="time",wa.defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",major:{enabled:!1}}};class ka extends wa{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Ma(e,this.min),this._tableRange=Ma(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,s=[],n=[];let o,a,r,l,h;for(o=0,a=t.length;o<a;++o)l=t[o],l>=e&&l<=i&&s.push(l);if(s.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=s.length;o<a;++o)h=s[o+1],r=s[o-1],l=s[o],Math.round((h+r)/2)!==l&&n.push({time:l,pos:o/(a-1)});return n}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return t=e.length&&i.length?this.normalize(e.concat(i)):e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(Ma(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return Ma(this._table,i*this._tableRange+this._minPos,!0)}}ka.id="timeseries",ka.defaults=wa.defaults;var Sa=Object.freeze({__proto__:null,CategoryScale:ta,LinearScale:sa,LogarithmicScale:oa,RadialLinearScale:ga,TimeScale:wa,TimeSeriesScale:ka});return bn.register(Bn,Sa,co,Jo),bn.helpers={...Ti},bn._adapters=wn,bn.Animation=xs,bn.Animations=ys,bn.animator=mt,bn.controllers=Us.controllers.items,bn.DatasetController=Ls,bn.Element=Es,bn.elements=co,bn.Interaction=Vi,bn.layouts=Zi,bn.platforms=ps,bn.Scale=$s,bn.Ticks=Is,Object.assign(bn,Bn,Sa,co,Jo,ps),bn.Chart=bn,"undefined"!=typeof window&&(window.Chart=bn),bn}));
/*!
 * Released under the MIT license
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("chart.js/helpers"),require("chart.js")):"function"==typeof define&&define.amd?define(["chart.js/helpers","chart.js"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).ChartDataLabels=e(t.Chart.helpers,t.Chart)}(this,(function(t,e){"use strict";var r=function(){if("undefined"!=typeof window){if(window.devicePixelRatio)return window.devicePixelRatio;var t=window.screen;if(t)return(t.deviceXDPI||1)/(t.logicalXDPI||1)}return 1}(),a=function(e){var r,a=[];for(e=[].concat(e);e.length;)"string"==typeof(r=e.pop())?a.unshift.apply(a,r.split("\n")):Array.isArray(r)?e.push.apply(e,r):t.isNullOrUndef(e)||a.unshift(""+r);return a},o=function(t,e,r){var a,o=[].concat(e),n=o.length,i=t.font,l=0;for(t.font=r.string,a=0;a<n;++a)l=Math.max(t.measureText(o[a]).width,l);return t.font=i,{height:n*r.lineHeight,width:l}},n=function(t,e,r){return Math.max(t,Math.min(e,r))},i=function(t,e){var r,a,o,n,i=t.slice(),l=[];for(r=0,o=e.length;r<o;++r)n=e[r],-1===(a=i.indexOf(n))?l.push([n,1]):i.splice(a,1);for(r=0,o=i.length;r<o;++r)l.push([i[r],-1]);return l};function l(t,e){var r=e.x,a=e.y;if(null===r)return{x:0,y:-1};if(null===a)return{x:1,y:0};var o=t.x-r,n=t.y-a,i=Math.sqrt(o*o+n*n);return{x:i?o/i:0,y:i?n/i:-1}}function s(t,e,r){var a=0;return t<r.left?a|=1:t>r.right&&(a|=2),e<r.top?a|=8:e>r.bottom&&(a|=4),a}function u(t,e){var r,a,o=e.anchor,n=t;return e.clamp&&(n=function(t,e){for(var r,a,o,n=t.x0,i=t.y0,l=t.x1,u=t.y1,d=s(n,i,e),c=s(l,u,e);d|c&&!(d&c);)8&(r=d||c)?(a=n+(l-n)*(e.top-i)/(u-i),o=e.top):4&r?(a=n+(l-n)*(e.bottom-i)/(u-i),o=e.bottom):2&r?(o=i+(u-i)*(e.right-n)/(l-n),a=e.right):1&r&&(o=i+(u-i)*(e.left-n)/(l-n),a=e.left),r===d?d=s(n=a,i=o,e):c=s(l=a,u=o,e);return{x0:n,x1:l,y0:i,y1:u}}(n,e.area)),"start"===o?(r=n.x0,a=n.y0):"end"===o?(r=n.x1,a=n.y1):(r=(n.x0+n.x1)/2,a=(n.y0+n.y1)/2),function(t,e,r,a,o){switch(o){case"center":r=a=0;break;case"bottom":r=0,a=1;break;case"right":r=1,a=0;break;case"left":r=-1,a=0;break;case"top":r=0,a=-1;break;case"start":r=-r,a=-a;break;case"end":break;default:o*=Math.PI/180,r=Math.cos(o),a=Math.sin(o)}return{x:t,y:e,vx:r,vy:a}}(r,a,t.vx,t.vy,e.align)}var d=function(t,e){var r=(t.startAngle+t.endAngle)/2,a=Math.cos(r),o=Math.sin(r),n=t.innerRadius,i=t.outerRadius;return u({x0:t.x+a*n,y0:t.y+o*n,x1:t.x+a*i,y1:t.y+o*i,vx:a,vy:o},e)},c=function(t,e){var r=l(t,e.origin),a=r.x*t.options.radius,o=r.y*t.options.radius;return u({x0:t.x-a,y0:t.y-o,x1:t.x+a,y1:t.y+o,vx:r.x,vy:r.y},e)},h=function(t,e){var r=l(t,e.origin),a=t.x,o=t.y,n=0,i=0;return t.horizontal?(a=Math.min(t.x,t.base),n=Math.abs(t.base-t.x)):(o=Math.min(t.y,t.base),i=Math.abs(t.base-t.y)),u({x0:a,y0:o+i,x1:a+n,y1:o,vx:r.x,vy:r.y},e)},f=function(t,e){var r=l(t,e.origin);return u({x0:t.x,y0:t.y,x1:t.x,y1:t.y,vx:r.x,vy:r.y},e)},x=function(t){return Math.round(t*r)/r};function y(t,e){var r=e.chart.getDatasetMeta(e.datasetIndex).vScale;if(!r)return null;if(void 0!==r.xCenter&&void 0!==r.yCenter)return{x:r.xCenter,y:r.yCenter};var a=r.getBasePixel();return t.horizontal?{x:a,y:null}:{x:null,y:a}}function v(t,e,r){var a=r.backgroundColor,o=r.borderColor,n=r.borderWidth;(a||o&&n)&&(t.beginPath(),function(t,e,r,a,o,n){var i=Math.PI/2;if(n){var l=Math.min(n,o/2,a/2),s=e+l,u=r+l,d=e+a-l,c=r+o-l;t.moveTo(e,u),s<d&&u<c?(t.arc(s,u,l,-Math.PI,-i),t.arc(d,u,l,-i,0),t.arc(d,c,l,0,i),t.arc(s,c,l,i,Math.PI)):s<d?(t.moveTo(s,r),t.arc(d,u,l,-i,i),t.arc(s,u,l,i,Math.PI+i)):u<c?(t.arc(s,u,l,-Math.PI,0),t.arc(s,c,l,0,Math.PI)):t.arc(s,u,l,-Math.PI,Math.PI),t.closePath(),t.moveTo(e,r)}else t.rect(e,r,a,o)}(t,x(e.x)+n/2,x(e.y)+n/2,x(e.w)-n,x(e.h)-n,r.borderRadius),t.closePath(),a&&(t.fillStyle=a,t.fill()),o&&n&&(t.strokeStyle=o,t.lineWidth=n,t.lineJoin="miter",t.stroke()))}function b(t,e,r){var a=t.shadowBlur,o=r.stroked,n=x(r.x),i=x(r.y),l=x(r.w);o&&t.strokeText(e,n,i,l),r.filled&&(a&&o&&(t.shadowBlur=0),t.fillText(e,n,i,l),a&&o&&(t.shadowBlur=a))}var _=function(t,e,r,a){var o=this;o._config=t,o._index=a,o._model=null,o._rects=null,o._ctx=e,o._el=r};t.merge(_.prototype,{_modelize:function(r,a,n,i){var l,s=this,u=s._index,x=t.toFont(t.resolve([n.font,{}],i,u)),v=t.resolve([n.color,e.defaults.color],i,u);return{align:t.resolve([n.align,"center"],i,u),anchor:t.resolve([n.anchor,"center"],i,u),area:i.chart.chartArea,backgroundColor:t.resolve([n.backgroundColor,null],i,u),borderColor:t.resolve([n.borderColor,null],i,u),borderRadius:t.resolve([n.borderRadius,0],i,u),borderWidth:t.resolve([n.borderWidth,0],i,u),clamp:t.resolve([n.clamp,!1],i,u),clip:t.resolve([n.clip,!1],i,u),color:v,display:r,font:x,lines:a,offset:t.resolve([n.offset,0],i,u),opacity:t.resolve([n.opacity,1],i,u),origin:y(s._el,i),padding:t.toPadding(t.resolve([n.padding,0],i,u)),positioner:(l=s._el,l instanceof e.ArcElement?d:l instanceof e.PointElement?c:l instanceof e.BarElement?h:f),rotation:t.resolve([n.rotation,0],i,u)*(Math.PI/180),size:o(s._ctx,a,x),textAlign:t.resolve([n.textAlign,"start"],i,u),textShadowBlur:t.resolve([n.textShadowBlur,0],i,u),textShadowColor:t.resolve([n.textShadowColor,v],i,u),textStrokeColor:t.resolve([n.textStrokeColor,v],i,u),textStrokeWidth:t.resolve([n.textStrokeWidth,0],i,u)}},update:function(e){var r,o,n,i=this,l=null,s=null,u=i._index,d=i._config,c=t.resolve([d.display,!0],e,u);c&&(r=e.dataset.data[u],o=t.valueOrDefault(t.callback(d.formatter,[r,e]),r),(n=t.isNullOrUndef(o)?[]:a(o)).length&&(s=function(t){var e=t.borderWidth||0,r=t.padding,a=t.size.height,o=t.size.width,n=-o/2,i=-a/2;return{frame:{x:n-r.left-e,y:i-r.top-e,w:o+r.width+2*e,h:a+r.height+2*e},text:{x:n,y:i,w:o,h:a}}}(l=i._modelize(c,n,d,e)))),i._model=l,i._rects=s},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(t,e){var r,a=t.ctx,o=this._model,i=this._rects;this.visible()&&(a.save(),o.clip&&(r=o.area,a.beginPath(),a.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),a.clip()),a.globalAlpha=n(0,o.opacity,1),a.translate(x(e.x),x(e.y)),a.rotate(o.rotation),v(a,i.frame,o),function(t,e,r,a){var o,n=a.textAlign,i=a.color,l=!!i,s=a.font,u=e.length,d=a.textStrokeColor,c=a.textStrokeWidth,h=d&&c;if(u&&(l||h))for(r=function(t,e,r){var a=r.lineHeight,o=t.w,n=t.x;return"center"===e?n+=o/2:"end"!==e&&"right"!==e||(n+=o),{h:a,w:o,x:n,y:t.y+a/2}}(r,n,s),t.font=s.string,t.textAlign=n,t.textBaseline="middle",t.shadowBlur=a.textShadowBlur,t.shadowColor=a.textShadowColor,l&&(t.fillStyle=i),h&&(t.lineJoin="round",t.lineWidth=c,t.strokeStyle=d),o=0,u=e.length;o<u;++o)b(t,e[o],{stroked:h,filled:l,w:r.w,x:r.x,y:r.y+r.h*o})}(a,o.lines,i.text,o),a.restore())}});var p=Number.MIN_SAFE_INTEGER||-9007199254740991,g=Number.MAX_SAFE_INTEGER||9007199254740991;function m(t,e,r){var a=Math.cos(r),o=Math.sin(r),n=e.x,i=e.y;return{x:n+a*(t.x-n)-o*(t.y-i),y:i+o*(t.x-n)+a*(t.y-i)}}function w(t,e){var r,a,o,n,i,l=g,s=p,u=e.origin;for(r=0;r<t.length;++r)o=(a=t[r]).x-u.x,n=a.y-u.y,i=e.vx*o+e.vy*n,l=Math.min(l,i),s=Math.max(s,i);return{min:l,max:s}}function M(t,e){var r=e.x-t.x,a=e.y-t.y,o=Math.sqrt(r*r+a*a);return{vx:(e.x-t.x)/o,vy:(e.y-t.y)/o,origin:t,ln:o}}var k=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};function $(t,e,r){var a=e.positioner(t,e),o=a.vx,n=a.vy;if(!o&&!n)return{x:a.x,y:a.y};var i=r.w,l=r.h,s=e.rotation,u=Math.abs(i/2*Math.cos(s))+Math.abs(l/2*Math.sin(s)),d=Math.abs(i/2*Math.sin(s))+Math.abs(l/2*Math.cos(s)),c=1/Math.max(Math.abs(o),Math.abs(n));return u*=o*c,d*=n*c,u+=e.offset*o,d+=e.offset*n,{x:a.x+u,y:a.y+d}}t.merge(k.prototype,{center:function(){var t=this._rect;return{x:t.x+t.w/2,y:t.y+t.h/2}},update:function(t,e,r){this._rotation=r,this._rect={x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}},contains:function(t){var e=this,r=e._rect;return!((t=m(t,e.center(),-e._rotation)).x<r.x-1||t.y<r.y-1||t.x>r.x+r.w+2||t.y>r.y+r.h+2)},intersects:function(t){var e,r,a,o=this._points(),n=t._points(),i=[M(o[0],o[1]),M(o[0],o[3])];for(this._rotation!==t._rotation&&i.push(M(n[0],n[1]),M(n[0],n[3])),e=0;e<i.length;++e)if(r=w(o,i[e]),a=w(n,i[e]),r.max<a.min||a.max<r.min)return!1;return!0},_points:function(){var t=this,e=t._rect,r=t._rotation,a=t.center();return[m({x:e.x,y:e.y},a,r),m({x:e.x+e.w,y:e.y},a,r),m({x:e.x+e.w,y:e.y+e.h},a,r),m({x:e.x,y:e.y+e.h},a,r)]}});var C={prepare:function(t){var e,r,a,o,n,i=[];for(e=0,a=t.length;e<a;++e)for(r=0,o=t[e].length;r<o;++r)n=t[e][r],i.push(n),n.$layout={_box:new k,_hidable:!1,_visible:!0,_set:e,_idx:r};return i.sort((function(t,e){var r=t.$layout,a=e.$layout;return r._idx===a._idx?a._set-r._set:a._idx-r._idx})),this.update(i),i},update:function(t){var e,r,a,o,n,i=!1;for(e=0,r=t.length;e<r;++e)o=(a=t[e]).model(),(n=a.$layout)._hidable=o&&"auto"===o.display,n._visible=a.visible(),i|=n._hidable;i&&function(t){var e,r,a,o,n,i,l;for(e=0,r=t.length;e<r;++e)(o=(a=t[e]).$layout)._visible&&(l=new Proxy(a._el,{get:(t,e)=>t.getProps([e],!0)[e]}),n=a.geometry(),i=$(l,a.model(),n),o._box.update(i,n,a.rotation()));(function(t,e){var r,a,o,n;for(r=t.length-1;r>=0;--r)for(o=t[r].$layout,a=r-1;a>=0&&o._visible;--a)(n=t[a].$layout)._visible&&o._box.intersects(n._box)&&e(o,n)})(t,(function(t,e){var r=t._hidable,a=e._hidable;r&&a||a?e._visible=!1:r&&(t._visible=!1)}))}(t)},lookup:function(t,e){var r,a;for(r=t.length-1;r>=0;--r)if((a=t[r].$layout)&&a._visible&&a._box.contains(e))return t[r];return null},draw:function(t,e){var r,a,o,n,i,l;for(r=0,a=e.length;r<a;++r)(n=(o=e[r]).$layout)._visible&&(i=o.geometry(),l=$(o._el,o.model(),i),n._box.update(l,i,o.rotation()),o.draw(t,l))}},P="$default";function S(e,r,a){if(r){var o,n=a.$context,i=a.$groups;r[i._set]&&(o=r[i._set][i._key])&&!0===t.callback(o,[n])&&(e.$datalabels._dirty=!0,a.update(n))}}function I(t,e){var r,a,o=t.$datalabels,n=o._listeners;if(n.enter||n.leave){if("mousemove"===e.type)a=C.lookup(o._labels,e);else if("mouseout"!==e.type)return;r=o._hovered,o._hovered=a,function(t,e,r,a){var o,n;(r||a)&&(r?a?r!==a&&(n=o=!0):n=!0:o=!0,n&&S(t,e.leave,r),o&&S(t,e.enter,a))}(t,n,r,a)}}return{id:"datalabels",defaults:{align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:function(e){if(t.isNullOrUndef(e))return null;var r,a,o,n=e;if(t.isObject(e))if(t.isNullOrUndef(e.label))if(t.isNullOrUndef(e.r))for(n="",o=0,a=(r=Object.keys(e)).length;o<a;++o)n+=(0!==o?", ":"")+r[o]+": "+e[r[o]];else n=e.r;else n=e.label;return""+n},labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},beforeInit:function(t){t.$datalabels={_actives:[]}},beforeUpdate:function(t){var e=t.$datalabels;e._listened=!1,e._listeners={},e._datasets=[],e._labels=[]},afterDatasetUpdate:function(e,r,a){var o,n,i,l,s,u,d,c,h=r.index,f=e.$datalabels,x=f._datasets[h]=[],y=e.isDatasetVisible(h),v=e.data.datasets[h],b=function(e,r){var a,o,n,i=e.datalabels,l=[];return!1===i?null:(!0===i&&(i={}),r=t.merge({},[r,i]),o=r.labels||{},n=Object.keys(o),delete r.labels,n.length?n.forEach((function(e){o[e]&&l.push(t.merge({},[r,o[e],{_key:e}]))})):l.push(r),a=l.reduce((function(e,r){return t.each(r.listeners||{},(function(t,a){e[a]=e[a]||{},e[a][r._key||P]=t})),delete r.listeners,e}),{}),{labels:l,listeners:a})}(v,a),p=r.meta.data||[],g=e.ctx;for(g.save(),o=0,i=p.length;o<i;++o)if((d=p[o]).$datalabels=[],y&&d&&e.getDataVisibility(o)&&!d.skip)for(n=0,l=b.labels.length;n<l;++n)u=(s=b.labels[n])._key,(c=new _(s,g,d,o)).$groups={_set:h,_key:u||P},c.$context={active:!1,chart:e,dataIndex:o,dataset:v,datasetIndex:h},c.update(c.$context),d.$datalabels.push(c),x.push(c);g.restore(),t.merge(f._listeners,b.listeners,{merger:function(t,e,a){e[t]=e[t]||{},e[t][r.index]=a[t],f._listened=!0}})},afterUpdate:function(t,e){t.$datalabels._labels=C.prepare(t.$datalabels._datasets,e)},afterDatasetsDraw:function(t){C.draw(t,t.$datalabels._labels)},beforeEvent:function(t,e){if(t.$datalabels._listened){var r=e.event;switch(r.type){case"mousemove":case"mouseout":I(t,r);break;case"click":!function(t,e){var r=t.$datalabels,a=r._listeners.click,o=a&&C.lookup(r._labels,e);o&&S(t,a,o)}(t,r)}}},afterEvent:function(t){var e,r,a,o,n,l,s,u=t.$datalabels,d=u._actives,c=u._actives=t.getActiveElements(),h=i(d,c);for(e=0,r=h.length;e<r;++e)if((n=h[e])[1])for(a=0,o=(s=n[0].element.$datalabels||[]).length;a<o;++a)(l=s[a]).$context.active=1===n[1],l.update(l.$context);(u._dirty||h.length)&&(C.update(u._labels),t.render()),delete u._dirty}}}));
ACC.address = {

	_autoload: [
		"bindToChangeAddressButton",
		"bindCreateUpdateAddressForm",
		"bindSuggestedDeliveryAddresses",
		"bindCountrySpecificAddressForms",
		"showAddressFormButtonPanel",
		"bindViewAddressBook",
		"bindToColorboxClose",
		"showRemoveAddressFromBookConfirmation",
		"backToListAddresses",
		"bindAddressValidations"
	],

	spinner: $("<img src='" + ACC.config.commonResourcePath + "/images/spinner.gif' />"),
	addressID: '',
	
	handleChangeAddressButtonClick: function ()
	{

		ACC.address.addressID = ($(this).data("address")) ? $(this).data("address") : '';
		$('#summaryDeliveryAddressFormContainer').show();
		$('#summaryOverlayViewAddressBook').show();
		$('#summaryDeliveryAddressBook').hide();


		$.getJSON(getDeliveryAddressesUrl, ACC.address.handleAddressDataLoad);
		return false;
	},

	handleAddressDataLoad: function (data)
	{
		ACC.address.setupDeliveryAddressPopupForm(data);

		// Show the delivery address popup
		ACC.colorbox.open("",{
		 	inline: true,
			href: "#summaryDeliveryAddressOverlay",
			overlayClose: false,
			onOpen: function (){
				// empty address form fields
				ACC.address.emptyAddressForm();
				$(document).on('change', '#saveAddress', function ()
				{
					var saveAddressChecked = $(this).prop('checked');
					$('#defaultAddress').prop('disabled', !saveAddressChecked);
					if (!saveAddressChecked)
					{
						$('#defaultAddress').prop('checked', false);
					}
				});
			}
		});

	},

	setupDeliveryAddressPopupForm: function (data)
	{
		// Fill the available delivery addresses
		$('#summaryDeliveryAddressBook').html($('#deliveryAddressesTemplate').tmpl({addresses: data}));
		// Handle selection of address
		$('#summaryDeliveryAddressBook button.use_address').on('click',ACC.address.handleSelectExistingAddressClick);
		// Handle edit address
		$('#summaryDeliveryAddressBook button.edit').on('click',ACC.address.handleEditAddressClick);
		// Handle set default address
		$('#summaryDeliveryAddressBook button.default').on('click',ACC.address.handleDefaultAddressClick);
	},

	emptyAddressForm: function ()
	{
		var options = {
			url: getDeliveryAddressFormUrl,
			cache: false,
			data: {addressId: ACC.address.addressID, createUpdateStatus: ''},
			type: 'GET',
			success: function (data)
			{
				$('#summaryDeliveryAddressFormContainer').html(data);
				ACC.address.bindCreateUpdateAddressForm();
			}
		};

		$.ajax(options);
	},

	handleSelectExistingAddressClick: function ()
	{
		var addressId = $(this).attr('data-address');
		$.postJSON(setDeliveryAddressUrl, {addressId: addressId}, ACC.address.handleSelectExitingAddressSuccess);
		return false;
	},

	handleEditAddressClick: function ()
	{

		$('#summaryDeliveryAddressFormContainer').show();
		$('#summaryOverlayViewAddressBook').show();
		$('#summaryDeliveryAddressBook').hide();

		var addressId = $(this).attr('data-address');
		var options = {
			url: getDeliveryAddressFormUrl,
			cache: false,
			data: {addressId: addressId, createUpdateStatus: ''},
			target: '#summaryDeliveryAddressFormContainer',
			type: 'GET',
			success: function (data)
			{
				ACC.address.bindCreateUpdateAddressForm();
				ACC.colorbox.resize();
			},
			error: function (xht, textStatus, ex)
			{
				alert(ACC.config.failedCart+" [" + xht + ", " + textStatus + ", " + ex + "]");
			}
		};
		
		
		$(this).ajaxSubmit(options);
		return false;
	},

	handleDefaultAddressClick: function ()
	{
		var addressId = $(this).attr('data-address');
		var options = {
			url: setDefaultAddressUrl,
			cache: false,
			data: {addressId: addressId},
			type: 'GET',
			success: function (data)
			{
				ACC.address.setupDeliveryAddressPopupForm(data);
			},
			error: function (xht, textStatus, ex)
			{
				alert(ACC.config.failedAddressBook+" [" + xht + ", " + textStatus + ", " + ex + "]");
			}
		};

		$(this).ajaxSubmit(options);
		return false;
	},

	handleSelectExitingAddressSuccess: function (data)
	{
		if (data != null)
		{
			ACC.refresh.refreshPage(data);
			ACC.colorbox.close();
		}
		else
		{
			alert(ACC.config.failedDeliveryAddress);
		}
	},

	bindCreateUpdateAddressForm: function ()
	{
		$('.create_update_address_form').each(function ()
		{
			var options = {
				type: 'POST',
				beforeSubmit: function ()
				{
					$('#checkout_delivery_address').block({ message: ACC.address.spinner });
				},
				success: function (data)
				{
					$('#summaryDeliveryAddressFormContainer').html(data);
					var status = $('.create_update_address_id').attr('status');
					if (status != null && "success" === status.toLowerCase())
					{
						ACC.refresh.getCheckoutCartDataAndRefreshPage();
						ACC.colorbox.close();
					}
					else
					{
						ACC.address.bindCreateUpdateAddressForm();
						ACC.colorbox.resize();
					}
				},
				error: function (xht, textStatus, ex)
				{
					alert(ACC.config.failedCart+" [" + xht + ", " + textStatus + ", " + ex + "]");
				},
				complete: function ()
				{
					$('#checkout_delivery_address').unblock();
				}
			};

			$(this).ajaxForm(options);
		});
	},

	refreshDeliveryAddressSection: function (data)
	{
		$('.summaryDeliveryAddress').replaceWith($('#deliveryAddressSummaryTemplate').tmpl(data));

	},

	bindSuggestedDeliveryAddresses: function ()
	{
		var status = $('.add_edit_delivery_address_id').attr('status');
		if (status != null && "hasSuggestedAddresses" == status)
		{
			ACC.address.showSuggestedAddressesPopup();
		}
	},

	showSuggestedAddressesPopup: function ()
	{

		ACC.colorbox.open("",{
			href: "#popup_suggested_delivery_addresses",
			inline: true,
			overlayClose: false,
			width: 525,
		});
	},

	bindCountrySpecificAddressForms: function ()
	{
		if($("#pageId").val() == 'add-edit-address' && window.location.href.indexOf('add-address') != -1 && document.referrer.indexOf('add-address') == -1)
        {
           	//$(document).on("load",'#countrySelector select', function ()
        	//{
        	//Hardcoding now as there is only US in the country selection.
				var countryIsoCode = $('.currentBaseStoreId').val();
        		var options = {
        			'addressCode': '',
        			'countryIsoCode': countryIsoCode
        		};
        		ACC.address.displayCountrySpecificAddressForm(options, ACC.address.showAddressFormButtonPanel);
        		//Selecting US by default
        		$("#address\\.country").find('option[value='+ countryIsoCode + ']').attr('selected','selected');
        		$(".errorAddressCountry").html("");

        	//});
        }

	},

	showAddressFormButtonPanel: function ()
	{
		if ($('#countrySelector :input').val() !== '')
		{
			$('#addressform_button_panel').show();
		}
	},

	bindToColorboxClose: function ()
	{
		$(document).on("click", ".closeColorBox", function ()
		{
			ACC.colorbox.close();
		})
	},
	
	bindAddressValidations: function ()
	{	
		$(document).on("blur", "#address\\.phone", function(e)
		{ 
	        var phoneNumber = $(this).val();
	        if (phoneNumber != "" && !ACC.formvalidation.validatePhoneNumber(phoneNumber))  
	        {
	        	ACC.formvalidation.addErrorClassForRegForm('#address\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
	        }
	        else
	        {
	        	ACC.formvalidation.removeErrorClassForRegForm('#address\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
	        }
	    });
		$(document).on('input blur', "#address\\.townCity", function(e)
		{
			ACC.formvalidation.validateFieldBasedOnRegex(e,'#address\\.townCity', '.errorTownCity', '#townCity\\.errors',ACC.config.cityError,ERRORMSG.global.city, 'city');
		});
		$(document).on('input blur', "#childUnit", function(e)
				{
					ACC.formvalidation.vaildateFields('#childUnit', '.errorchildUnit', '#childUnitKeyError',ACC.config.shipToError+'<div class="cl"></div><br/><br/>');
				});
		$(document).on('input blur', "#address\\.companyName", function(e)
				{
					ACC.formvalidation.vaildateFields('#address\\.companyName', '.errorCompanyName', '#companyName\\.errors',ERRORMSG.global.company);
				});
		$(document).on('input blur', "#address\\.line1", function(e)
				{
					ACC.formvalidation.vaildateFields('#address\\.line1', '.errorline1', '#line1\\.errors',ERRORMSG.global.address);
				});
		$(document).on('input blur', "#address\\.region", function(e)
				{
					ACC.formvalidation.vaildateFields('#address\\.region', '.errorRegion', '#region\\.errors', ERRORMSG.global.state);
				});
		$(document).on("input blur", "#address\\.postcode", function(e)
				{	
					if(ACC.formvalidation.validatezipcode(e, $("#address\\.postcode").val()))
					{
						ACC.formvalidation.removeErrorClassForRegForm('#address\\.postcode', '.errorPostCode', '#postcode\\.errors');
					}
					else
					{
						ACC.formvalidation.addErrorClassForRegForm('#address\\.postcode', '.errorPostCode', '#postcode\\.errors', ACC.config.zipCodeError);
					}
			    });
	
	
		$(document).on("click", ".siteOneAddressForm", function(e)
		{
		
			e.preventDefault();
			var status = true;
			 ACC.formvalidation.vaildateFields('#address\\.country', '.errorAddressCountry', '#country\\.errors', ERRORMSG.global.country);
	         ACC.formvalidation.vaildateFields('#address\\.title', '.errorTitle', '#title\\.errors', ACC.config.titleError);	        
	         ACC.formvalidation.vaildateFields('#address\\.surname', '.errorSurName', '#surname\\.errors', ERRORMSG.global.lastname);
	         ACC.formvalidation.vaildateFields('#address\\.line1', '.errorline1', '#line1\\.errors', ERRORMSG.global.address);
	         ACC.formvalidation.validateFieldBasedOnRegex(e,'#address\\.townCity', '.errorTownCity', '#townCity\\.errors',ACC.config.cityError,ERRORMSG.global.city, 'city');
	 		
	         //ACC.formvalidation.vaildateFields('#address\\.townCity', '.errorTownCity', '#townCity\\.errors', ERRORMSG.global.city);
	         ACC.formvalidation.vaildateFields('#address\\.region', '.errorRegion', '#region\\.errors', ERRORMSG.global.state);
	         //ACC.formvalidation.vaildateFields('#address\\.postcode', '.errorPostCode', '#postcode\\.errors', ERRORMSG.global.zip);
	         ACC.formvalidation.vaildateFields('#address\\.companyName', '.errorCompanyName', '#companyName\\.errors', ERRORMSG.global.company);
	         ACC.formvalidation.vaildateFields('#childUnit', '.errorchildUnit', '#childUnitKeyError', ACC.config.shipToError);

	        
	         if($("#address\\.phone").val() != null && $("#address\\.phone").val() != '' && !ACC.formvalidation.validatePhoneNumber($("#address\\.phone").val()))
	         {
	                status = false;
	                ACC.formvalidation.addErrorClassForRegForm('#address\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
	         }
	         else
	         {
	            ACC.formvalidation.removeErrorClassForRegForm('#address\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
	         }
	         
	         if(ACC.formvalidation.validatezipcode(e, $('#address\\.postcode').val()))
			 {
				 ACC.formvalidation.removeErrorClassForRegForm('#address\\.postcode', '.errorPostCode', '#postcode\\.errors');
			 }
			 else
			 {
				 status = false;
				 ACC.formvalidation.addErrorClassForRegForm('#address\\.postcode', '.errorPostCode', '#postcode\\.errors', ACC.config.zipCodeError);
			 }
		        
	        $('*[id*=error]:visible').each(function() 
			{
				if($(this).html() != '')
				{
					status = false;
				}
			});
	        
	       
	        if(status)
			{
	        	 //Call to Address Verification
	        	
	        		$.ajax({
		        		url: ACC.config.encodedContextPath + "/my-account/validate-address", 
		        		method:"post",
		        		data:$('#siteOneAddressForm').serialize(),		        	
		        		success: function(addressVerificationData){
                           //Testing only will remove hardcoded value
                          // addressVerificationData = {"addressType":"H","city":"Roswell","county":"Fulton","description":"Highrise","errorDesc":"No Error","isAddressValid":true,"parsedStreetName":"Colonial Center","state":"GA","street":"300 Colonial Center Pkwy","street2":"","zipCode":"30076-4899"};
                           
                           ACC.address.isAddressChanged = false;
                           ACC.address.isAddressVerified = true;
                           console.log(addressVerificationData);
		        			if((addressVerificationData.isAddressValid && !addressVerificationData.isAddressCorrected) || addressVerificationData.status.errorCode == '404')
		        			{
		        				$("#siteOneAddressForm" ).submit();
		        			}
		        			else
		        			{
			        			// create pop up content		        				        			
			        			var popupContent = createPopupContent(addressVerificationData);			        			
			        			//Popup for address suggestion
			        			$.colorbox({
									html: popupContent,					
									maxWidth:"100%",
									width:"550px",
									maxHeight:"100%",
									overflow:"auto",
									opacity:0.7,
									className:"addNotFound",
									title:false,
									close:'<span class="glyphicon glyphicon-remove"></span>',
									onComplete: function(){
									}
								});
		        				
		        			}
		                 },
		                /* error: function (e)		 				
		                 {
		                	 $("#siteOneAddressForm" ).submit();
		 				 }*/
	        		});
	        	        		        	
	        }	
	        else
			{
				ACC.formvalidation.addGlobalError();
				
			}
	        
	    });
		
		$(document).on("click", "#proceedOriginalAddress", function()
		{							
			$("#siteOneAddressForm" ).submit();
		});
		
		$(document).on("click", "#suggestedAddressSubmit", function()
		{			
			var addressOption = $("input[name='address\\.addressSuggestionOption']:checked").val();
			if(addressOption == "originalAddress")
			{
				 //$("#siteOneAddressForm" ).submit();
			}
			
            if(addressOption == "suggestedAddress")
            {
            	    copySuggestedAddressToForm()
            	    //$("#siteOneAddressForm" ).submit();
			}
		});
		
        $(document).on("click", "#editOriginalAddress", function()
        {
	 		ACC.colorbox.close();		
	    });
        
        $(document).on("click", "#suggestedAddressCancel", function()
	    {
	 	   ACC.colorbox.close();		
	    });
		
		$(document).on("change", "#address\\.country", function()
		{
	        var msg = ERRORMSG.global.country;
	        ACC.formvalidation.vaildateFields('#address\\.country', '.errorAddressCountry', '#country\\.errors', msg);
	    });
	    
		$(document).on("blur", "#address\\.companyName", function()
		{
	        var msg = ERRORMSG.global.company;
	        ACC.formvalidation.vaildateFields('#address\\.companyName', '.errorCompanyName', '#companyName\\.errors', msg);
	    });
			    
		$(document).on("blur", "#address\\.region", function()
		{
	        var msg = ERRORMSG.global.state;
	        ACC.formvalidation.vaildateFields('#address\\.region', '.errorRegion', '#region\\.errors', msg);
	    });
		
	    $(document).on("blur", "#address\\.title", function()
		{
	        var msg = ERRORMSG.global.title;
	        ACC.formvalidation.vaildateFields('#address\\.title', '.errorTitle', '#title\\.errors', msg);
	    });
	    
	    $(document).on("blur", "#childUnit", function()
		{
	        var msg = ACC.config.shipToError;
	        ACC.formvalidation.vaildateFields('#childUnit', '.errorchildUnit', '#childUnitKeyError', msg);
	    });
	    	    
	    $(document).on("blur", "#address\\.firstName", function()
		{
	        var msg = ERRORMSG.global.firstname;
	        ACC.formvalidation.vaildateFields('#address\\.firstName', '.errorFirstName', '#firstName\\.errors', msg);
	    });
	    
	    $(document).on("blur", "#address\\.surname", function()
		{
	        var msg = ERRORMSG.global.lastname;
	        ACC.formvalidation.vaildateFields('#address\\.surname', '.errorSurName', '#surname\\.errors', msg);
	    });
	    
	    $(document).on("blur", "#address\\.line1", function()
		{
	        var msg = ERRORMSG.global.address;
	        ACC.formvalidation.vaildateFields('#address\\.line1', '.errorline1', '#line1\\.errors', msg);
	    });
	    
	    $(document).on("blur", "#address\\.townCity", function(e)
		{
	        ACC.formvalidation.validateFieldBasedOnRegex(e,'#address\\.townCity', '.errorTownCity', '#townCity\\.errors', ACC.config.cityError, ERRORMSG.global.city, 'city');
	    });
	    
	    $(document).on("blur", "#address\\.postcode", function(e)
		{
	        //var msg = ERRORMSG.global.zip;
	        //ACC.formvalidation.vaildateFields('#address\\.postcode', '.errorPostCode', '#postcode\\.errors', msg);
	        if(ACC.formvalidation.validatezipcode(e, $("#address\\.postcode").val()))
			{
				ACC.formvalidation.removeErrorClassForRegForm('#address\\.postcode', '.errorPostCode', '#postcode\\.errors');
			}
			else
			{
				ACC.formvalidation.addErrorClassForRegForm('#address\\.postcode', '.errorPostCode', '#postcode\\.errors', ACC.config.zipCodeError);
			}
	    });
	    
	    $(document).on("input", "#address\\.phone", function(e)
	    {
	    	ACC.formvalidation.handlePhoneNumberOnInput('#address\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
	    });
	    
	},

	displayCountrySpecificAddressForm: function (options, callback)
	{
		$.ajax({
			url: ACC.config.encodedContextPath + '/my-account/addressform',
			cache: false,
			async: true,
			data: options,
			dataType: "html",
			beforeSend: function ()
			{
				$("#i18nAddressForm").html(ACC.address.spinner);
			}
		}).done(function (data)
				{
					$("#i18nAddressForm").html($(data).html());
					if (typeof callback == 'function')
					{
						callback.call();
					}
				});
	},

	bindToChangeAddressButton: function ()
	{
		$(document).on("click", '.summaryDeliveryAddress .editButton', ACC.address.handleChangeAddressButtonClick);
	},

	bindViewAddressBook: function ()
	{

		$(document).on("click",".js-address-book",function(e){
			e.preventDefault();

			ACC.colorbox.open("Saved Addresses",{
				href: "#addressbook",
				inline: true,
				width:"500px"
			});
			
		})

		
		$(document).on("click", '#summaryOverlayViewAddressBook', function ()
		{
			$('#summaryDeliveryAddressFormContainer').hide();
			$('#summaryOverlayViewAddressBook').hide();
			$('#summaryDeliveryAddressBook').show();
			ACC.colorbox.resize();
		});
	},
	
	showRemoveAddressFromBookConfirmation: function ()
	{
		$(document).on("click", ".removeAddressFromBookButton", function ()
		{
			var addressId = $(this).data("addressId");

			ACC.colorbox.open("",{
				inline: true,
				height: false,
				width: 560,
				href: "#popup_confirm_address_removal_" + addressId,
				onComplete: function ()
				{

					$(this).colorbox.resize();
				}
			});

		})
	},

	backToListAddresses: function(){
		$(".addressBackBtn").on("click", function(){
			var sUrl = $(this).data("backToAddresses");
			window.location = sUrl;
		});
	}
};


function copySuggestedAddressToForm()
{

	$("#siteOneAddressForm #address\\.line1").val($("#suggestedAddress\\.line1").data("line1"));
	$("#siteOneAddressForm #address\\.line2").val($("#suggestedAddress\\.line2").data("line2"));
	$("#siteOneAddressForm #address\\.townCity").val($("#suggestedAddress\\.city").data("city"));
	$("#siteOneAddressForm #address\\.region").val($("#siteOneAddressForm #address\\.country").val()+"-"+$("#suggestedAddress\\.state").data("state"));
	$("#siteOneAddressForm #address\\.postcode").val($("#suggestedAddress\\.zipcode").data("zipcode"));
	$("#siteOneAddressForm #address\\.district").val($("#suggestedAddress\\.county").data("county"));
	
}

function createPopupContent(addressVerificationData){
	
	var popupContent = "";	
	
	if(addressVerificationData.isAddressCorrected){
		
		if($(".pagename").val() == "Add Edit Address Page"){

			popupContent ="<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ $("#siteOneAddressForm #address\\.line1").val() +"</span><div class='cl'></div>"
		  
			if($("#siteOneAddressForm #address\\.line2").val() != ""){
				popupContent = popupContent +  $("#siteOneAddressForm #address\\.line2").val() +"<div class='cl'></div>";
			}
		
		   popupContent = popupContent + $("#siteOneAddressForm #address\\.townCity").val() +"<div class='cl'></div>"+ $("#siteOneAddressForm #address\\.region option:selected").text() +"<div class='cl'></div>"+ $("#siteOneAddressForm #address\\.postcode").val() +" </div></div>";
		
			popupContent = popupContent+"<div class='col-md-6 col-xs-12 margin-top-add'><span class='hidden-md hidden-lg'><br/><br/></span><span class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.suggestedAddress+"</b></span><div class='cl'></div><p></p>";
		
			popupContent = popupContent+"<div class='add-address-sec'><span id='suggestedAddress.line1'  data-line1='"+addressVerificationData.street+"'>"+ addressVerificationData.street +"</span>";
		
			popupContent = popupContent+"<span id='suggestedAddress.line2' data-line2='"+addressVerificationData.street2+"'>"+ addressVerificationData.street2+"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.city' data-city='"+addressVerificationData.city+"'>"+ addressVerificationData.city +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.county' data-county='"+addressVerificationData.county+"'>"+ addressVerificationData.county +"</span> <div class='cl'></div>";
			
			popupContent = popupContent+"<span id='suggestedAddress.state'  data-state='"+addressVerificationData.state+"'>"+ addressVerificationData.state +"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.zipcode'  data-zipcode='"+addressVerificationData.zipcode+"'>"+ addressVerificationData.zipcode +"</span>";	        						
        					
			popupContent = popupContent+"</div></div>  <div class='cl'></div><br><br> <div class='col-md-4 col-sm-6 col-xs-4'><input type='button' class='btn btn-primary btn-block' value='"+ACC.config.save+"' id= 'suggestedValidAddressSubmit'/></div><div class='col-md-4 col-sm-6 col-xs-4'> <input type='button' class='btn btn-default btn-block' value='"+ACC.config.cancel+"' id= 'suggestedAddressCancel'/> </div></form>";	
			
		} else {
			popupContent ="<form id='addressSuggestionForm' class='row' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ $("#siteOneAddressForm #address\\.line1").val() +"</span><div class='cl'></div>"
		
			if($("#siteOneAddressForm #address\\.line2").val() != ""){
				popupContent = popupContent +  $("#siteOneAddressForm #address\\.line2").val() +"<div class='cl'></div>";
			}
			
			popupContent = popupContent + $("#siteOneAddressForm #address\\.townCity").val() +"<div class='cl'></div>"+ $("#siteOneAddressForm #address\\.region option:selected").text() +"<div class='cl'></div>"+ $("#siteOneAddressForm #address\\.postcode").val() +" </div></div>";
		
			popupContent = popupContent+"<div class='col-md-6 col-xs-12 margin-top-add'><span class='hidden-md hidden-lg'><br/><br/></span><span class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.suggestedAddress+"</b></span><div class='cl'></div><p></p>";
		
			popupContent = popupContent+"<div class='add-address-sec'><span id='suggestedAddress.line1'  data-line1='"+addressVerificationData.street+"'>"+ addressVerificationData.street +"</span>";
		
			popupContent = popupContent+"<span id='suggestedAddress.line2' data-line2='"+addressVerificationData.street2+"'>"+ addressVerificationData.street2+"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.city' data-city='"+addressVerificationData.city+"'>"+ addressVerificationData.city +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.county' data-county='"+addressVerificationData.county+"'>"+ addressVerificationData.county +"</span> <div class='cl'></div>";
			
			popupContent = popupContent+"<span id='suggestedAddress.state'  data-state='"+addressVerificationData.state+"'>"+ addressVerificationData.state +"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.zipcode'  data-zipcode='"+addressVerificationData.zipcode+"'>"+ addressVerificationData.zipcode +"</span>";	        						
							
			popupContent = popupContent+"</div></div>  <div class='cl'></div><br><br> <div class='col-md-4 col-sm-6 col-xs-4'><input type='button' class='btn btn-primary btn-block' value='"+ACC.config.save+"' id= 'suggestedAddressSubmit'/></div><div class='col-md-4 col-sm-6 col-xs-4'> <input type='button' class='btn btn-default btn-block' value='"+ACC.config.cancel+"' id= 'suggestedAddressCancel'/> </div></form>";
		}		        				    
		
	}else if(!addressVerificationData.isAddressValid){
		popupContent = "<p style='margin-top:-18px;'>"+ACC.config.veryfyAddressError+"</p> <br> <div class='row'><div class='col-md-6 col-xs-12  col-sm-12'><input type='button' value='Proceed Anyway'  class='btn btn-primary btn-block' id='proceedOriginalAddress'/></div> <span class='hidden-xs hidden-md hidden-lg visible-sm'><div class='cl'></div><br/></span><div class='col-md-6 col-xs-12 col-sm-12'><input type='button' value='Edit Address' class='btn btn-default btn-block' id='editOriginalAddress'/></div></div>";
		
	}
	
return popupContent;
}
var indexAutoSuggestion= 1;
var indexProductResult= 1;
var indexRelatedArticle=1;
ACC.autocomplete = {
	_autoload: [
		"bindGetPriceValue",
		"bindSearchAutocomplete",
		"bindDisableSearch",
		"checkForEmptySearchBox",
		"onTextClick"
	],
	bindGetPriceValue: function(obj) {
        if (null != obj && typeof obj != undefined) {
            if (null != obj.price && null != obj.price.formattedValue) {
                return obj.price.formattedValue;
            } else if (null != obj.priceRange && null != obj.priceRange.maxPrice && null != obj.priceRange.minPrice && null != obj.priceRange.maxPrice.formattedValue && null != obj.priceRange.minPrice.formattedValue) {
                return obj.priceRange.minPrice.formattedValue + " - " + obj.priceRange.maxPrice.formattedValue;
            } else {
                return "";
            }
        } else {
            return "";
        }
    },
	bindSearchAutocomplete: function ()
	{	function promoElement(url,imgUrl){
		return `			    
		    <div class="col-md-3 col-xs-6 promo-search-img">
		    <a href="${url}"><img style="width:100%" src="${imgUrl}"/></a>
		    </div>
		    `;
		}
		// extend the default autocomplete widget, to solve issue on multiple instances of the searchbox component
		$.widget( "custom.yautocomplete", $.ui.autocomplete, {
			_create:function(){
				
				// get instance specific options form the html data attr
				var option = this.element.data("options");
				// set the options to the widget
				this._setOptions({
					minLength: option.minCharactersBeforeRequest,
					displayProductImages: option.displayProductImages,
					delay: option.waitTimeBeforeRequest,
					autocompleteUrl: option.autocompleteUrl,
					source: this.source,
					change: function(){
						indexAutoSuggestion = 1;
						indexProductResult = 1;
						indexRelatedArticle=1;
					}
				});

				// call the _super()
				$.ui.autocomplete.prototype._create.call(this);

			},
			options:{
				cache:{}, // init cache per instance
				focus: function (){return false;}, // prevent textfield value replacement on item focus
				select: function (event, ui){
					if (ui.item.url != null){
					window.location.href = ui.item.url;
					} else {
						return false;
					}
				}
			},
			_renderItem : function (ul, item){
				
				if (item.type == "autoSuggestion"){
					var renderHtml = "<a class='auto-suggestion-container' href='"+ item.url + "' ><div class='name titlename' data-index='"+ indexAutoSuggestion +"'>" + item.value + "</div></a>";
					renderHtml = $("<li class='auto-suggestion-name' style='border-top:0px'>")
						.data("item.autocomplete", item)
						.append(renderHtml)
						.appendTo(ul);
					indexAutoSuggestion++;
					return renderHtml;
					
				}
				else if (item.type == "productResult"){

					var renderHtml = "<a class='product-results-wrapper titlename' href='" + item.url + "'  data-index='"+ indexProductResult +"'>";

					if (item.image != null){
						renderHtml += "<div class='product-results-image-wrapper thumb'><img class='product-results-image' src='" + item.image + "' title='" + item.value +"'></div>";
					}
					
					renderHtml += 	"<div class='name product-results-name'> "+ item.value +"</div>";
					/*renderHtml += 	"<div class='price'>" + item.price +"</div>";*/
					renderHtml += 	"</a>";
					
					indexProductResult++;

					return $("<li style='border-top:0px'>").data("item.autocomplete", item).append(renderHtml).appendTo(ul);
				}
				else if(item.type == "SuggestionRelatedArticle"){
					
					var renderHtml = `<a class="ui-menu-item-wrapper titlename suggestion-related-article" href="${item.articleUrl}" data-index=${indexRelatedArticle} ><div class="suggested_RelatedArticle row">
				    <div class="col-xs-2 related-article-icon"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 50 50"><defs><style>.a.icon-box{fill: #F1F2F2;opacity:0.9;}.b{fill:#929497;}</style></defs><g transform="translate(-930 -1274)"><rect class="a icon-box" width="50" height="50" transform="translate(930 1274)"/><g transform="translate(920 1264)"><rect class="b icon-path" width="9.778" height="2.667" transform="translate(37.222 30.111)"/><rect class="b icon-path" width="24" height="2.667" transform="translate(23 23)"/><rect class="b icon-path" width="24" height="2.667" transform="translate(23 44.333)"/><rect class="b icon-path" width="9.778" height="2.667" transform="translate(37.222 37.222)"/><path class="b icon-path" d="M23,48.778h9.778V39H23Zm2.667-7.111h4.444v4.444H25.667Z" transform="translate(0 -8.889)"/></g></g></svg></div>
				    <div class="col-xs-10 related-articles-text">${item.articleName}</div></div></a>`;
					
					indexRelatedArticle++;
					return $("<li style='border-top:0px'>").data("item.autocomplete", item).append(renderHtml).appendTo(ul);
					
				}
				else if (item.type == "suggestionPromo") {
                    var promoItems = $();
                    var promoImg = 1;
                    
                    $.each(item.contents, function (i, obj) {
                    	if(obj.contentType == "PROMOTION_PAGE"){
	                    	if (window.matchMedia("(max-width:" + screenXsMax + ")").matches) {
	                    		if(promoImg <= '2'){
	                                promoItems = promoItems.add(promoElement(obj.url,obj.previewImage.url));
	        					}
	                        }
	                    	else { 
	                        	if(promoImg <= '4'){
	                                promoItems = promoItems.add(promoElement(obj.url,obj.previewImage.url));
	        					}
	                        }
                    	promoImg++;
                    	}
                    })
					var promoRow=$('<div class="row promo-search-wrap"></div>').append(promoItems)
                    return $("<li class='promo-padding0' style='border-top:0px'>").data("item.autocomplete", item).append(promoRow).appendTo(ul);

                }
				
				else if (item.type == "autoSuggestionText"){
					var renderHtml = "<div class='auto-suggestion-text-container'>" + item.value + "</div>"; 
					renderHtml  = $("<li class='auto-suggestion-text-name' style='cursor: default;' onmouseover='this.style.background=\"#FFFFFF\";'>")
						.append(renderHtml)
						.appendTo(ul);
					return renderHtml.css("color", "#999999");
				}
				else if (item.type == "autoSuggestionTextForProduct"){
					var renderHtml = "<div class='suggested_text'>" + item.value + "</div>"; 
					renderHtml  = $("<li class='suggested-items-title' style='cursor: default;' onmouseover='this.style.background=\"#FFFFFF\";'>")
						.append(renderHtml)
						.appendTo(ul);
					return renderHtml.css("color", "#999999");
				}
				else if(item.type == "autoSuggestionRelatedArticle"){
					var renderHtml = "<div class='suggested_RelatedArticle'>" + item.value + "</div>"; 
					renderHtml  = $("<li class='suggested-RelatedArticle-text' style='cursor: default;' onmouseover='this.style.background=\"#FFFFFF\";'>")
					.append(renderHtml)
					.appendTo(ul);
					return renderHtml.css("color", "#999999");
				}
				
			},
			source: function (request, response)
			{
				var self=this;
				var term = request.term.toLowerCase();
				if (term in self.options.cache)
				{
					return response(self.options.cache[term]);
				}

				$.getJSON(self.options.autocompleteUrl, {term: request.term}, function (data)
				{
					var autoSearchData = [];
					if(data.suggestions != null && data.suggestions.length != 0){
						autoSearchData.push({
							value: ACC.config.searchItems,
							type: "autoSuggestionText"
						});
						$.each(data.suggestions, function (i, obj)
						{
							autoSearchData.push({
								value: obj.term,
								url: ACC.config.encodedContextPath + "/search?text=" + obj.term,
								type: "autoSuggestion"
							});
						});
					}
					if(data.products != null && data.products.length != 0 ){
						autoSearchData.push({
							value: ACC.config.suggestedItems,
							type: "autoSuggestionTextForProduct"
						});
						$.each(data.products, function (i, obj)
						{
							
							var prodDesc=obj.description;
							if(!prodDesc){
								prodDesc=obj.productShortDesc;
							}
							autoSearchData.push({
								value: ACC.autocomplete.escapeHTML(prodDesc),
								code: obj.code,
								desc: prodDesc,
								manufacturer: obj.manufacturer,
								url:  ACC.config.encodedContextPath + obj.url,
								price: ACC.autocomplete.bindGetPriceValue(obj),
								type: "productResult",
								image: (obj.images!=null && self.options.displayProductImages) ? obj.images[0].url : null // prevent errors if obj.images = null
							});
						});
					}
					 if (data.contents != null && data.contents.length != 0) {
	                        autoSearchData.push({value: ACC.config.searchRelatedArticle, type: "autoSuggestionRelatedArticle"});
	                        $.each(data.contents, function (i, obj) {
	                            if (obj.contentType == "ARTICLE_PAGE") {
	                                autoSearchData.push({
	                                    articleName: obj.previewTitle,
	                                    articleUrl: ACC.config.encodedContextPath + obj.url,
	                                    type: "SuggestionRelatedArticle"
	                                });
	                            }
								

	                        });
							autoSearchData.push({contents: data.contents, type: "suggestionPromo"});
	                    }
					self.options.cache[term] = autoSearchData;
					return response(autoSearchData);
					
				});
			}

		});


		$search = $(".js-site-search-input");
		if($search.length>0){
			$search.yautocomplete();
		}

	},

	bindDisableSearch: function ()
	{
		$('#js-site-search-input').on('keyup',function (){
			$('#js-site-search-input').val($('#js-site-search-input').val().replace(/^\s+/gm,''));
			indexAutoSuggestion = 1;
			indexProductResult = 1;
			indexRelatedArticle=1;
		})
	},
	checkForEmptySearchBox : function ()
	{	
		$(document).on("keypress", "#js-site-search-input", function(event) { 
			if($('.errorMessage').show())
			{
				$('.errorMessage').hide();
			}
		    if(event.which == 13 && !$('#js-site-search-input').val()){
		    	$('.errorMessage').show();
		    	event.preventDefault(event);
		    }

			//reset sort selection once the user enters the search keyword			
			if(event.which == 13 && $('#js-site-search-input').val()){
				sessionStorage.removeItem('selectedDropdownValueSession');
			}
		    indexAutoSuggestion = 1;
			indexProductResult = 1;
			indexRelatedArticle=1;
		})
		$(document).on("click","#searchBoxButton",function()
                {                   
                    if(!$('#js-site-search-input').val())
                        {
                            $('.errorMessage').show();
                        }
                        else
                        {   sessionStorage.removeItem('mobileSortSelection');
                            $('#searchBox').submit();
                        }
                })
	},
	onTextClick: function(){
			$('.ui-menu').on('click', '.titlename', function(e) {
	        e.stopImmediatePropagation();
			var searchproductIndex= $(this).data('index');
			var productSearchTerm= $(this).text();
			if ($(this).hasClass("product-results-wrapper")) {
				var suggestedSearchType=$(".suggested-items-title").text();
			}
			else if($(this).hasClass("suggestion-related-article")){
				var suggestedSearchType="suggested articles"
				productSearchTerm=$(this).find(".related-articles-text").text();
			}
		 
			else{
				 var suggestedSearchType=$(".auto-suggestion-text-name").text();
			}
			
			try {
				_AAData.method = "internal search";
				_AAData.methodMetaData = productSearchTerm;
			}catch(e){} 
	  
			digitalData.searchInfo={
					searchproductIndex: searchproductIndex,
					productSearchTerm:productSearchTerm,
					suggestedSearchType: suggestedSearchType 
	   				}
			try {
				_satellite.track('suggested-search');
			}
			catch(e){}
			
   				 
   		 });
		
		 
		
		jQuery(function($) {
			  var input = $('#js-site-search-input');
			  input.on('keydown', function() {
			    var key = event.keyCode || event.charCode;

			    if( key == 8 || key == 46 )
			    	indexAutoSuggestion = 1;
					indexProductResult = 1;
					indexRelatedArticle=1;
			  });
			});
    	
    },
	

	escapeHTML: function (input) {
		return input.replace(/&/g,'&amp;')
			.replace(/</g,'&lt;')
			.replace(/>/g,'&gt;');
	}

};
ACC.carousel = {

	_autoload: [
		["bindCarousel", $(".js-owl-carousel").length >0],
		"bindJCarousel"
	],

	carouselConfig:{
		"default":{
			navigation:true,
			navigationText : ["<span class='glyphicon glyphicon-chevron-left'></span>", "<span class='glyphicon glyphicon-chevron-right'></span>"],
			pagination:false,
			itemsCustom : [[0, 2], [640, 4], [1024, 5], [1400, 7]]
		},
		"rotating-image":{
			navigation:false,
			pagination:true,
			singleItem : true,
		},
		"lazy-reference":{
			navigation:true,
			navigationText : ["<span class='glyphicon glyphicon-chevron-left'></span>", "<span class='glyphicon glyphicon-chevron-right'></span>"],
			pagination:false,
			itemsDesktop : [5000,7], 
			itemsDesktopSmall : [1200,5], 
			itemsTablet: [768,4], 
			itemsMobile : [480,3], 
			lazyLoad:true,		
		}
	},

	bindCarousel: function(){
		
		$(".js-owl-carousel").each(function(){
			var $c = $(this)
			$.each(ACC.carousel.carouselConfig,function(key,config){
				if($c.hasClass("js-owl-"+key)){
					var $e = $(".js-owl-"+key);
					$e.owlCarousel(config);
				}
			});
		});

	},
	
	bindJCarousel: function ()
	{
		$(".modal").colorbox({
			onComplete: function ()
			{
				ACC.common.refreshScreenReaderBuffer();
			},
			onClosed: function ()
			{
				ACC.common.refreshScreenReaderBuffer();
			}
		});
		$('.svw').each( function(){
	          $( this).waitForImages( function(){
	               $(this).slideView({toolTip: true, ttOpacity: 0.6, autoPlay: true, autoPlayTime: 8000});
	          });
	    });
	}

};
ACC.cart = {

	_autoload: [
		"bindPageNameUrl",
		"bindHelp",
		"cartRestoration",
		"bindCartPage",
		"bindMultiDEntryRemoval",
		"bindMultidCartProduct",
		["bindApplyVoucher", $(".js-voucher-apply-btn").length != 0],
		["bindToReleaseVoucher", $("#js-applied-vouchers").length != 0],
		"cartUomIntervalMin",
		"bindAvailability",
		"disabledCheckoutGlobalMessage",
		"defaultStoreMessage",
		"cartpopupLink",
		"fullfillmentStatusCall",
		"checkIfCheckoutEnabled",
		"cartDeliveryMethod",
		"applyClipCoupon",
		"removeAllItems",
		"branchFullfillmentAvailablity",
		"hardscapesStoneCartAlert",
		"pickupCountFunction",
		"splitShippingEnable",
		"hideSplitShippingSection",
		"cartEntriesAppend",
		"bigBagChecker",
		"bigBagPopup",
		"bigBagHelpPopup",
		"splitCartHeaderControl"
	],

	cartflaginterval: false,
	//Split cart enabled branched function start
	// To show pickup and shipping count in header
	pickupCountFunction: function () {
		if($(".isSplitCartFulfilment").val()=="true") {
			let pickupCount = $(".pickup-active:visible").length;
			let deliveryCount = $(".delivery-active:visible").length;
			$(".pickup_count").html(pickupCount);
			$(".delivery_count").html(deliveryCount);
			let totalCount = $(".cart-total-items").html();
			if($(".changed_selectedFilfillment").val() == "PICKUP" || $(".changed_selectedFilfillment").val() == "PARCEL_SHIPPING"){
				let shippingonlyCount = totalCount - pickupCount;
				$(".shipping_count").html(shippingonlyCount);
			}
			if($(".changed_selectedFilfillment").val() == "DELIVERY" || $(".changed_selectedFilfillment").val() == "PARCEL_SHIPPING"){
				let shippingonlyCount = totalCount - deliveryCount;
				$(".shipping_count").html(shippingonlyCount);
			}
			
		}
	},
	// To disable Shipping in split cart branch when all shipping fulfillment is not available
	splitShippingEnable: function () {
		if($(".isSplitCartFulfilment").val()=="true"){
			
			let enableSplitShipping = true;
			$("[data-allfulfillmentenabled]").each(function () {
				let target = $(this);
				let shippingEnabled = target.data("shippingenabled");
				if(shippingEnabled != true){
					enableSplitShipping = false;
                	return
				}
			});
			if(enableSplitShipping == true){
				$(".parcelAvail").removeClass('hidden');
				$(".parcelUnavailable").addClass('hidden');
				$(".fullfillment-shipping").removeClass("disabled-fullfillment-method");
			}
			else{
				$(".parcelAvail").addClass('hidden');
				$(".parcelUnavailable").removeClass('hidden');
				$(".fullfillment-shipping").removeClass("js-fullfilment");
				$(".fullfillment-shipping").addClass("disabled-fullfillment-method");
			}
		}
	},
	//To hide split/mixed while shipping fulfillment is selected
	hideSplitShippingSection: function() {
		if($(".isSplitCartFulfilment").val()=="true" && $(".changed_selectedFilfillment").val() != "PARCEL_SHIPPING"){
			let isShippingOnlyProduct="false";
			$("[data-stockavailableonlyhubstore]:visible").each(function () {
				if ($(this).data("stockavailableonlyhubstore") === true) {
					isShippingOnlyProduct="true";
					return;
				}
			});
			if(isShippingOnlyProduct=="true") {
				$(".split-cart-shipping, .split-shipping-count, .split-cart-shipping-container").removeClass('hidden');
				$(".mobile-pickup-text").addClass("hidden");
				if($(".changed_selectedFilfillment").val() == "PICKUP"){
					$(".split-pickup-count-section").removeClass('hidden');
					$(".split-delivery-count-section").addClass('hidden');
				}
				if($(".changed_selectedFilfillment").val() == "DELIVERY"){
					$(".split-delivery-count-section").removeClass('hidden');
					$(".split-pickup-count-section").addClass('hidden');
				}
			}
			$(".splitShippingAppended").addClass("hide")
		}
		else {
			$(".split-cart-shipping, .split-shipping-count, .split-cart-shipping-container").addClass('hidden');
			$(".mobile-pickup-text").removeClass("hidden");
			$(".splitShippingAppended").removeClass("hide");
		}
	},
	splitCartHeaderControl: function() {
		if ($(".isSplitCart").val() === "true") {
			const isNotParcelShipping = $(".changed_selectedFilfillment").val() !== "PARCEL_SHIPPING";
			const splitShippingHeader = $(".splitShippingHeader");
			const splitCartHeader = $(".splitCartHeader");
			const splitPickupDeliveryHeader = $(".splitPickupDeliveryHeader");

			if (isNotParcelShipping) {
				splitShippingHeader.addClass("hidden");
				splitCartHeader.removeClass("m-t-12-md");
				splitPickupDeliveryHeader.removeClass("hidden");
			} else {
				splitPickupDeliveryHeader.addClass("hidden");
				splitCartHeader.addClass("m-t-12-md");
				splitShippingHeader.removeClass("hidden");
			}
		}
	},
	cartEntriesAppend: function() {
		if($(".isSplitCartFulfilment").val()=="true" && $(".changed_selectedFilfillment").val()!= "PARCEL_SHIPPING") {
			$("[data-stockavailableonlyhubstore]:visible").each(function () {
				if ($(this).data("stockavailableonlyhubstore") === true) {
					$(".split-cart-shipping, .split-shipping-count, .split-cart-shipping-container").removeClass("hidden");
					var clonedItem = $(this).clone(true);
					$(this).addClass("hide splitShippingAppended");
					$(".split-cart-shipping-container").append(clonedItem);
					if($(".changed_selectedFilfillment").val() == "PICKUP"){
						$(".split-pickup-count-section").removeClass('hidden');
						$(".split-delivery-count-section").addClass('hidden');
					}
					if($(".changed_selectedFilfillment").val() == "DELIVERY"){
						$(".split-delivery-count-section").removeClass('hidden');
						$(".split-pickup-count-section").addClass('hidden');
					}
				}
			});
		}
	},
	//Split cart enabled branched function End
	//BigBag checkbox
	ajaxBigboxchecker: function(productCode,needReload,ifChecked,newQuantity){
		
		if(ACC.global.wWidth < 700){
			var bigBagchck = $('input.mobbigbagcheck-'+productCode+'[type=checkbox]');
		}
		else{
			var bigBagchck = $('input.bigbagcheck-'+productCode+'[type=checkbox]');
		}	
		
		let isChecked = bigBagchck.is(':checked');
		let skuId = bigBagchck.attr("data-skuId");
		let quantity = bigBagchck.attr("data-quantity");
		let uom = bigBagchck.attr("data-uom");
		let bigBagPrice = bigBagchck.attr("data-bigbagprice");
		
		if(ifChecked == "CHECKED"){quantity=newQuantity;}
		if(ifChecked=="CHECKED" && !isChecked){return;}
		loading.start();	
		$.ajax({
				url: ACC.config.encodedContextPath + "/cart/bigBagChecker",
				data: { "isChecked": isChecked, "sku": skuId, "quantity": quantity, "bigBagPrice": bigBagPrice, "UOM": uom },
				type: "POST",
				success: function() {
							if(needReload){
								window.location.reload();
							}
				},
				error: function() {
					loading.stop();
					// console.log("bigBagChecker ajax call failed.");
				}
			});
	},
	bigBagChecker: function ()
	{
		$('.cart-bigbag .bigbag-check').on('change',function() {
		
		let skuId = $(this).attr("data-skuId");
		
		ACC.cart.ajaxBigboxchecker(skuId,true,"ALL");	
                
    	});
	},
	bigBagPopup: function(){
		$(document).on("click", '.bigbag-help', function() {
		$('#colorbox').addClass("bigbag-help-txt");
		var targetHTML = $(".bigbag-help-mob").html();
			ACC.colorbox.open("", {
		        html:  targetHTML,
		        width: 300,
		        height:250,
		        escKey: false
		      });
		});	
		
		$(document).on("click", '.bigbag-help-txt .bigbag-gotit', function() {
				ACC.colorbox.close();
		});
	},
	bigBagHelpPopup: function(){
		$(document).on("click", '.bigbag-selection-help', function() {
		$('#colorbox').addClass("bigbag-selection-help-txt");
		var targetHTML = $(".bigbag-help-web").html();
			ACC.colorbox.open("", {
		        html:  targetHTML,
		        width: 450,
		        height:500,
		        escKey: false
		      });
		});	
		
		$(document).on("click", '.bigbag-selection-help-txt .bigbag-gotit', function() {
				ACC.colorbox.close();
		});
	},
	//BigBag checkbox END
	cartUomIntervalMin: function () 
    {	
			if($('.page-cartPage').is(":visible")){
				$(".cart-items-left-pane").each(function(){
					var ProductCode = $(this).find(".QtyintervalProductCode").val();
					var intervalupdatedValue = Number($(this).find(".js-update-entry-quantity-input").val());
					var uomqtyintervalvalue = Number($("#uomintervalqtyCart_"+ProductCode).val());
					var uommultipliervalue = Number($("#uommultiplierCart_"+ProductCode).val());
					var minqtycartvalue = Number($("#minQtyCart_"+ProductCode).val());
					if(uommultipliervalue <= 1){
						if(uomqtyintervalvalue > 1){
							if((intervalupdatedValue % uomqtyintervalvalue == 0)){
								$(this).find('.intervalQtyError_cart').addClass('hidden');
								$(this).find(".js-update-entry-quantity-input").removeClass("qtyBoxError");
							}
							else{
								$(this).find('.intervalQtyError_cart').removeClass('hidden');
								$(this).find(".js-update-entry-quantity-input").addClass("qtyBoxError");
								ACC.cartitem.cartflaginterval = true;
							}	
						}
						if(minqtycartvalue > 1){
							if((intervalupdatedValue >= minqtycartvalue)){
								$(this).find('.intervalQtyError_cart').addClass('hidden');
								$(this).find(".js-update-entry-quantity-input").removeClass("qtyBoxError");
							}
							else{
								$(this).find('.intervalQtyError_cart').removeClass('hidden');
								$(this).find('.intervalQtyError_cart').addClass('minError_cart');
								$(this).find(".js-update-entry-quantity-input").addClass("qtyBoxError");
								ACC.cartitem.cartflaginterval = true;
							}
						}
					}
						if(ACC.cartitem.cartflaginterval){
							$('.js-continue-checkout-button').attr('disabled', true);
							$('.js-continue-checkout-buttonoo').attr('disabled', true);
							$('.js-continue-guestcheckout-button').attr('disabled', 'disabled').addClass('disable-checkout-btn');
						}
				});	
				if($(".isGuestCheckoutEnabled").val() == 'false'){
					$("#disableCheckoutMessage").removeClass("hidden");
					ACC.cartitem.cartflaginterval = true;
					ACC.cart.disableCheckoutButton();
				}
			}
    },
	checkIfCheckoutEnabled: function() {
		var IsCheckoutEnabled = true;
		var enableCheckoutElem = document.querySelectorAll("#enableCheckout")
		if ($(enableCheckoutElem).length) {

			$(enableCheckoutElem).each(function() {
				if ($(this).val() != 'true') {
					IsCheckoutEnabled = false
					return false;
				}

			});
		}
		return IsCheckoutEnabled;
	},
	applyClipCoupon: function() {
		$(document).on("click", "#clipCoupon", function(e) {
			var promoProductCode = $(this).parents(".promotion").find("#promoProductCode").val();
			var isPdpPromotion = false;
			if ($(this).prop("checked") == true) {
				isPdpPromotion = true;
			}
			$.ajax({
				type: 'POST',
				url: ACC.config.encodedContextPath + "/cart/apply/clipCoupon",
				datatype: "json",
				data: {
					isCouponEnabled: isPdpPromotion,
					promoProductCode: promoProductCode
				},
				success: function(result) {
					window.location.href = window.location.href;
				},

			});
		})
		$('.cart-items-left-pane').each(function() {
			var cartBox = $(this);
			if ($(this).find(".coupon-applied").length > 0) {
				$(this).find("#clipCoupon").prop('checked', true);
			}
			if(cartBox.find(".trasferable-flag").val()==='false' && cartBox.find(".isstockNearby-flag").val()==='true' ){
				ACC.cart.disableCheckoutButton();
				$(this).addClass("border-color-orange");
				$(".transferable-flag-msg").removeClass("hidden");
			}
		});
	},
	bindPageNameUrl: function() {
		var siteonePathingChannel = $(".siteonepathingchannel").val();
		var siteonePageName = $(".siteonepagename").val();

		try {
			_AAData.pathingPageName = siteonePageName;
			_AAData.pathingChannel = siteonePathingChannel;
		} catch (e) { }

		$(document).bind('cbox_closed', function() {
			try {
				_AAData.popupPageName = "";
				_AAData.popupChannel = "";
			} catch (e) { }
		});

	},

	disabledCheckoutGlobalMessage: function() {

		var isCheckoutErrorMessagePresent = $("#isCheckoutErrorMessagePresent").val();
		var isPriceChangeMessagePresent = $("#isPriceChangeMessagePresent").val();
		var cmspageid = $("#cmspageid").val();
		if (ACC.cart.checkIfCheckoutEnabled() == "false" && !(isCheckoutErrorMessagePresent == "true")) {
				$("#disableCheckoutMessage").removeClass('hidden');
		}
		if (isPriceChangeMessagePresent == "true" && cmspageid == 'cartPage') {
			$(".global-alerts .pricevaryText").closest(".alert-msg-section").addClass("hidden");
			$("#pricechangemessage").removeClass('hidden');

		}
	},

	bindHelp: function() {
		$(document).on("click", ".js-cart-help", function(e) {
			e.preventDefault();
			var title = $(this).data("help");
			ACC.colorbox.open(title, {
				html: $(".js-help-popup-content").html(),
				width: "550px"
			});
		});
		if($(".cartDeliveryDisabled").val()=="true"){
			$(".local-delivery").addClass("pickup-only-product");
		}
		else{
			$(".local-delivery").removeClass("pickup-only-product");
		}
		
		
		
	},

	cartRestoration: function() {
		$('.cartRestoration').on('click', function() {
			var sCartUrl = $(this).data("cartUrl");
			window.location = sCartUrl;
		});
	},

	bindCartPage: function() {
		// link to display the multi-d grid in read-only mode
		$(document).on("click", '.js-show-editable-grid', function(event) {
			ACC.cart.populateAndShowEditableGrid(this, event);
		});
	},

	bindMultiDEntryRemoval: function() {
		$(document).on("click", '.js-submit-remove-product-multi-d', function() {
			var itemIndex = $(this).data("index");
			var $form = $('#updateCartForm' + itemIndex);
			var initialCartQuantity = $form.find('input[name=initialQuantity]');
			var cartQuantity = $form.find('input[name=quantity]');
			var entryNumber = $form.find('input[name=entryNumber]').val();
			var productCode = $form.find('input[name=productCode]').val();

			cartQuantity.val(0);
			initialCartQuantity.val(0);

			ACC.track.trackRemoveFromCart(productCode, initialCartQuantity, cartQuantity.val());

			var method = $form.attr("method") ? $form.attr("method").toUpperCase() : "GET";
			$.ajax({
				url: $form.attr("action"),
				data: $form.serialize(),
				type: method,
				success: function(data) {
					location.reload();
				},
				error: function() {
					alert(ACC.config.failedMsg + " [" + xht + ", " + textStatus + ", " + ex + "]");
				}

			});

		});
	},


	populateAndShowEditableGrid: function(element, event) {
		var readOnly = $(element).data("readOnlyMultidGrid");
		var itemIndex = $(element).data("index");
		grid = $("#ajaxGrid" + itemIndex);

		var gridEntries = $('#grid' + itemIndex);
		var strSubEntries = gridEntries.data("sub-entries");
		var arrSubEntries = strSubEntries.split(',');
		var firstVariantCode = arrSubEntries[0].split(':')[0];

		$(element).toggleClass('open');

		var targetUrl = gridEntries.data("target-url");

		var mapCodeQuantity = new Object();
		for (var i = 0; i < arrSubEntries.length; i++) {
			var arrValue = arrSubEntries[i].split(":");
			mapCodeQuantity[arrValue[0]] = arrValue[1];
		}

		if (grid.children('#cartOrderGridForm').length > 0) {
			grid.slideToggle("slow");
		}
		else {
			var method = "GET";
			$.ajax({
				url: targetUrl,
				data: { productCode: firstVariantCode, readOnly: readOnly },
				type: method,
				success: function(data) {
					grid.html(data);
					$("#ajaxGrid").removeAttr('id');
					var $gridContainer = grid.find(".product-grid-container");
					var numGrids = $gridContainer.length;
					for (var i = 0; i < numGrids; i++) {
						ACC.cart.getProductQuantity($gridContainer.eq(i), mapCodeQuantity, i);
					}
					grid.slideDown("slow");
					ACC.cart.coreCartGridTableActions(element, mapCodeQuantity);
					ACC.productorderform.coreTableScrollActions(grid.children('#cartOrderGridForm'));
				},
				error: function(xht, textStatus, ex) {
					alert("Failed to get variant matrix. Error details [" + xht + ", " + textStatus + ", " + ex + "]");
				}

			});
		}
	},


	coreCartGridTableActions: function(element, mapCodeQuantity) {
		ACC.productorderform.bindUpdateFutureStockButton(".update_future_stock_button");
		ACC.productorderform.bindVariantSelect($(".variant-select-btn"), 'cartOrderGridForm');
		var itemIndex = $(element).data("index");
		var skuQuantityClass = '.sku-quantity';

		var quantityBefore = 0;
		var grid = $('#ajaxGrid' + itemIndex + " .product-grid-container");

		grid.on('focusin', skuQuantityClass, function(event) {
			quantityBefore = (this.value).trim();

			$(this).parents('tr').next('.variant-summary').remove();
			if ($(this).parents('table').data(ACC.productorderform.selectedVariantData)) {
				ACC.productorderform.selectedVariants = $(this).parents('table').data(ACC.productorderform.selectedVariantData);
			} else {
				ACC.productorderform.selectedVariants = [];
			}

			if (quantityBefore == "") {
				quantityBefore = 0;
				this.value = 0;
			}
		});

		grid.on('focusout keypress', skuQuantityClass, function(event) {
			var code = event.keyCode || event.which || event.charCode;

			if (code != 13 && code != undefined) {
				return;
			}

			var quantityAfter = 0;
			var gridLevelTotalPrice = "";

			var indexPattern = "[0-9]+";
			var currentIndex = parseInt($(this).attr("id").match(indexPattern));

			this.value = ACC.productorderform.filterSkuEntry(this.value);

			quantityAfter = (this.value).trim();
			var variantCode = $("input[id='cartEntries[" + currentIndex + "].sku']").val();

			if (isNaN((this.value).trim())) {
				this.value = 0;
			}

			if (quantityAfter == "") {
				quantityAfter = 0;
				this.value = 0;
			}

			var $gridTotalValue = grid.find("[data-grid-total-id=" + 'total_value_' + currentIndex + "]");
			var currentPrice = $("input[id='productPrice[" + currentIndex + "]']").val();

			if (quantityAfter > 0) {
				gridLevelTotalPrice = ACC.productorderform.formatTotalsCurrency(parseFloat(currentPrice) * parseInt(quantityAfter));
			}

			$gridTotalValue.html(gridLevelTotalPrice);

			var _this = this;
			var priceSibling = $(this).siblings('.price');
			var propSibling = $(this).siblings('.variant-prop');
			var currentSkuId = $(this).next('.td_stock').data('sku-id');
			var currentBaseTotal = $(this).siblings('.data-grid-total');

			if (this.value != quantityBefore) {
				var newVariant = true;
				ACC.productorderform.selectedVariants.forEach(function(item, index) {
					if (item.id === currentSkuId) {
						newVariant = false;

						if (_this.value === '0' || _this.value === 0) {
							ACC.productorderform.selectedVariants.splice(index, 1);
						} else {
							ACC.productorderform.selectedVariants[index].quantity = _this.value;
							ACC.productorderform.selectedVariants[index].total = ACC.productorderform.updateVariantTotal(priceSibling, _this.value, currentBaseTotal);
						}
					}
				});

				if (newVariant && this.value > 0) {
					// update variantData
					ACC.productorderform.selectedVariants.push({
						id: currentSkuId,
						size: propSibling.data('variant-prop'),
						quantity: _this.value,
						total: ACC.productorderform.updateVariantTotal(priceSibling, _this.value, currentBaseTotal)
					});
				}
			}
			ACC.productorderform.showSelectedVariant($(this).parents('table'));
			if (this.value > 0 && this.value != quantityBefore) {
				$(this).parents('table').addClass('selected');
			} else {
				if (ACC.productorderform.selectedVariants.length === 0) {
					$(this).parents('table').removeClass('selected').find('.variant-summary').remove();

				}
			}

			if (quantityBefore != quantityAfter) {
				var method = "POST";
				$.ajax({
					url: ACC.config.encodedContextPath + '/cart/updateMultiD',
					data: { productCode: variantCode, quantity: quantityAfter, entryNumber: -1 },
					type: method,
					success: function(data, textStatus, xhr) {
						ACC.cart.refreshCartData(data, -1, quantityAfter, itemIndex);
						mapCodeQuantity[variantCode] = quantityAfter;
					},
					error: function(xhr, textStatus, error) {
						var redirectUrl = xhr.getResponseHeader("redirectUrl");
						var connection = xhr.getResponseHeader("Connection");
						// check if error leads to a redirect
						if (redirectUrl !== null) {
							window.location = redirectUrl;
							// check if error is caused by a closed connection
						} else if (connection === "close") {
							window.location.reload();
						}
					}
				});
			}
		});
	},

	refreshCartData: function(cartData, entryNum, quantity, itemIndex) {
		// if cart is empty, we need to reload the whole page
		if (cartData.entries.length == 0) {
			location.reload();
		}
		else {
			var form;

			if (entryNum == -1) // grouped item
			{
				form = $('.js-qty-form' + itemIndex);
				var productCode = form.find('input[name=productCode]').val();

				var quantity = 0;
				var entryPrice = 0;
				for (var i = 0; i < cartData.entries.length; i++) {
					var entry = cartData.entries[i];
					if (entry.product.code == productCode) {
						quantity = entry.quantity;
						entryPrice = entry.totalPrice;
						break;
					}
				}

				if (quantity == 0) {
					location.reload();
				}
				else {
					form.find(".qtyValue").html(quantity);
					form.parent().parent().find(".js-item-total").html(entryPrice.formattedValue);
				}
			}

			ACC.cart.refreshCartPageWithJSONResponse(cartData);
		}
	},

	refreshCartPageWithJSONResponse: function(cartData) {
		// refresh mini cart
		ACC.minicart.updateMiniCartDisplay();
		$('.js-cart-top-totals').html($("#cartTopTotalSectionTemplate").tmpl(cartData));
		$('div .cartpotproline').remove();
		$('div .cartproline').remove();
		$('.js-cart-totals').remove();
		$('#ajaxCartPotentialPromotionSection').html($("#cartPotentialPromotionSectionTemplate").tmpl(cartData));
		$('#ajaxCartPromotionSection').html($("#cartPromotionSectionTemplate").tmpl(cartData));
		$('#ajaxCart').html($("#cartTotalsTemplate").tmpl(cartData));
		ACC.quote.bindQuoteDiscount();
	},

	getProductQuantity: function(gridContainer, mapData, i) {
		var tables = gridContainer.find("table");

		$.each(tables, function(index, currentTable) {
			var skus = jQuery.map($(currentTable).find("input[type='hidden'].sku"), function(o) {
				return o.value
			});
			var quantities = jQuery.map($(currentTable).find("input[type='textbox'].sku-quantity"), function(o) {
				return o
			});
			var selectedVariants = [];

			$.each(skus, function(index, skuId) {
				var quantity = mapData[skuId];
				if (quantity != undefined) {
					quantities[index].value = quantity;

					var indexPattern = "[0-9]+";
					var currentIndex = parseInt(quantities[index].id.match(indexPattern));
					var gridTotalValue = gridContainer.find("[data-grid-total-id=" + 'total_value_' + currentIndex + "]");
					var gridLevelTotalPrice = "";
					var currentPrice = $("input[id='productPrice[" + currentIndex + "]']").val();
					if (quantity > 0) {
						gridLevelTotalPrice = ACC.productorderform.formatTotalsCurrency(parseFloat(currentPrice) * parseInt(quantity));
					}
					gridTotalValue.html(gridLevelTotalPrice);

					selectedVariants.push({
						id: skuId,
						size: $(quantities[index]).siblings('.variant-prop').data('variant-prop'),
						quantity: quantity,
						total: gridLevelTotalPrice
					});
				}
			});

			if (selectedVariants.length != 0) {
				$.tmpl(ACC.productorderform.$variantSummaryTemplate, {
					variants: selectedVariants
				}).appendTo($(currentTable).addClass('selected'));
				$(currentTable).find('.variant-summary .variant-property').html($(currentTable).find('.variant-detail').data('variant-property'));
				$(currentTable).data(ACC.productorderform.selectedVariantData, selectedVariants);
			}
		});

	},

	bindMultidCartProduct: function() {
		// link to display the multi-d grid in read-only mode
		$(document).on("click", '.showQuantityProduct', function(event) {
			ACC.multidgrid.populateAndShowGrid(this, event, true);
		});

		// link to display the multi-d grid in read-only mode
		$(document).on("click", '.showQuantityProductOverlay', function(event) {
			ACC.multidgrid.populateAndShowGridOverlay(this, event);
		});

	},

	bindApplyVoucher: function() {
		// Remove duplicate dom in Cart Page
		var win_wid = $(window).width();

		if (($('.page-cartPage').length > 0) && (win_wid <= 800)) {
			$('.desktop-promo').remove();
		}
		$(".js-voucher-apply-btn").on("click", function(e) {
			e.preventDefault();
			ACC.cart.handleApplyVoucher(e);
		});

		$(".js-voucher-code-text").on("keypress", function(e) {
			var code = (e.keyCode ? e.keyCode : e.which);
			if (code == 13) {
				ACC.cart.handleApplyVoucher(e);
			}
		});
	},

	handleApplyVoucher: function(e) {
		var display = $(".voucherDisplay").val();
		var voucherCode = $(".js-voucher-code-text").val().trim();
		if (voucherCode != '' && voucherCode.length > 0) {
			$("#applyVoucherForm_" + display).submit();
			$(".cart-promo-msg").show();
		}
	},

	bindToReleaseVoucher: function() {
		$('.js-release-voucher-remove-btn').on("click", function(event) {
			$(this).closest('form').submit();
		});
	},
	/*disableCheckoutIfOrderingAccount: function () {
		if($('#enableCheckoutIfOrderingAccount').length > 0) 
		{
			if($('#enableCheckoutIfOrderingAccount').val() != 'true') 
			{
				$('.js-continue-checkout-button').attr('disabled','disabled');
			} 
			else 
			{
				$('.js-continue-checkout-button').removeAttr('disabled');
			}
		}
	},*/
	bindAnalyticCartdata:function(index, cartErrorText, parentClass){
						let productParent = (parentClass)? "." + parentClass + " " : "";
						var productCode = $(productParent + "#productCode" + index).val();
						var productName = $(productParent + "#productName" + index).val();
						var productCategory = $(productParent + "#productCategory" + index).val();
						var productSubCategory = $(productParent + "#productSubCategory" + index).val();
						var nearbyProduct = $(productParent + "#productnearby" + index).val();
						var productBackOrdercheck= $(productParent + ".analytics_backourderValue"+ index).val();
						var productPrice =$(productParent + "#productprice" + index).val();
						var productQty = $(productParent + "#productQty" + index).val();
						var remainingBackOrder= $(productParent + ".remainingQty"+ index).val();
						var productStockStatus=$(productParent + "#productstockStatus"+ index).val().replace(/<(.|\n)*?>/g, '');
						if(productBackOrdercheck=="true"){
							var productBackOrder= productQty;
						}
						else if(remainingBackOrder > 0){
						var productBackOrder= remainingBackOrder;
						}
					  	else{
							var productBackOrder= "";
						}
	
						if($(".checkmixedcart").val()=="true"){
							var productfulfillment = $(productParent + ".selectedFilfillment" + index).val();
							var productStore = $(productParent + ".selectedFilfillmentStore" + index).val();
						}
	
						 else{
							var productfulfillment = $(".changed_selectedFilfillment").val();
							var productStore = $("#analyticsstore").val().split("#")[1];
						}
    					  if(nearbyProduct === ""){
    						  var productNearBy= "true"
    					  }
    					  else{
    						  var productNearBy= "false"
    					  }
						
						digitalData.cart.item.push({
							"productID": productCode,
							"productName": productName,
							"productCategory": productCategory,
							"productSubCategory": productSubCategory,
							"productSelectedBranch": productNearBy,
							"productfulfillment": productfulfillment,
							"productStore" : productStore,
							"productBackOrder":productBackOrder,
							"productQty":productQty,
							"productPrice":productPrice,
							"productStockStatus":productStockStatus,
							"productError": (!cartErrorText)? "NA" : cartErrorText
						});
	},
	bindAvailability: function() {
		$('input[id^=entry]').each(function() {
			var quantity = 0;
			var productCode = $(this).val();
			var index = this.id.split('entry')[1];
			var nonstore = $(this).data("nonstore");
			if ($(this).data("quantity") !== undefined) {
				quantity = $(this).data("quantity");
			}
			$.ajax({
				url: ACC.config.encodedContextPath + "/cart/availability",
				data: { "productCode": productCode, "quantity": quantity },
				type: "GET",
				success: function(result) {
					var messageField;
					if (quantity != 0) {
						if (result) {
							messageField = "#sufficient" + index;
						} else {
							messageField = "#insufficient" + index;
							//$('#enableCheckout').val('false');
							$('.js-continue-checkout-button').attr('disabled', 'disabled');
							$('.js-continue-checkout-buttonoo').attr('disabled', 'disabled');
						}
					} else {
						if (result) {
							if (nonstore === undefined) {
								messageField = "#inStock" + index;
							} else {
								messageField = "#notCarried" + index;
							}
						} else {
							messageField = "#outOfStock" + index;
							messageField = "#notCarried" + index;
							//$('#enableCheckout').val('false');
							$('.js-continue-checkout-button').attr('disabled', 'disabled');
							$('.js-continue-checkout-buttonoo').attr('disabled', 'disabled');
						}
					}
					if ($(messageField)) {
						$(messageField).show();
					}
				}
			});

		});

		var item = [];
		if ($('#isAnonymous').val() == "false") {
			var recentCartId = $("#currentCartId").val();
		}
		else {
			var recentCartId = $("#anonymousCartId").val();
		}

		if ($('.loginstatus').val() != '') {
			var checkoutOptions = "signed-in"
		}
		else {
			var checkoutOptions = "guest"
		}

		if ($('input[id^=cartEntry]').length > 0) {
			digitalData.cart = {
				item: [],
				event: "scView",
				cartId: $("#cartID").val(),
				recentCartId: recentCartId,
				checkoutOptions: checkoutOptions,
			};
			window.addEventListener('load', function() {
				_satellite.track('cart-view');
			});
		}

		$('input[id^=cartEntry]').each(function() {
			if ($(this).parent().hasClass("hidden") === false) {
				var index = this.id.split('cartEntry')[1];
				var isRegulatory = $("#regulated" + index).val();
				var productCode = $(this).val();
				if (isRegulatory) {
					var isProductSellable = ($("#isProductSellable" + index).val() == 'true');
					var isLicensed = ($("#isLicensed" + index).val() == 'true');
					var isMyStoreProduct = ($("#isMyStoreProduct" + index).val() == 'true');
					if (isProductSellable && isMyStoreProduct) {
						$.ajax({
							url: ACC.config.encodedContextPath + "/cart/rupcheck",
							data: { "productCode": productCode, "isRegulatory": isRegulatory },
							type: "GET",
							success: function(result) {
								if (result && !isLicensed) {
									$('.js-continue-checkout-button').attr('disabled', 'disabled');
									$('.js-continue-checkout-buttonoo').attr('disabled', 'disabled');
									$('#cartRegulatoryLicenceCheck_' + index).removeClass('hidden');
									$('#cartRegulatoryItemInSufficientStockMsg_' + index).addClass('hidden');
									$('#cartRegulatoryItemInStockMsg_' + index).addClass('hidden');
								}
							}
						});
					}
					if (!isProductSellable && isMyStoreProduct) {
						$('.js-continue-checkout-button').attr('disabled', 'disabled');
						$('.js-continue-checkout-buttonoo').attr('disabled', 'disabled');
					}
				}
				var index = this.id.split('cartEntry')[1];
				 
					// console.log("digitalData" + JSON.stringify(digitalData));

					try {
						_satellite.track("View Cart");
					} catch (e) { }
				 
			}
		});
		if ($('#enableCheckout').length && !ACC.cartitem.cartflaginterval) {

			if (ACC.cart.checkIfCheckoutEnabled() === false || $('#enableCheckoutIfOrderingAccount').val() != 'true' || $(".enableFullfilment").val() == 'false') {
				$('.js-continue-checkout-button').attr('disabled', 'disabled');
				$('.js-continue-checkout-buttonoo').attr('disabled', 'disabled');
			} else {
				$('.js-continue-checkout-button').removeAttr('disabled');
				$('.js-continue-checkout-buttonoo').removeAttr('disabled');
			}
			if (ACC.cart.checkIfCheckoutEnabled() === false || $('#disableHideListGuestCheckout').val() == 'true' || $(".enableFullfilment").val() == 'false') {
				$('.js-continue-guestcheckout-button').attr('disabled', 'disabled').addClass('disable-checkout-btn');
			}
			else {
				$('.js-continue-guestcheckout-button').removeAttr('disabled', 'disabled').removeClass('disable-checkout-btn');
			}

			if($(".isMixedCartEnabled").val() != 'true')
			{
				if ($(".branch-pickup").hasClass("fullfilment-select") || $(".local-delivery").hasClass("fullfilment-select") || $(".parcel-shipping").hasClass("fullfilment-select")) {
					if ($(".parcel-shipping").hasClass("fullfilment-select")) {
						$(".fullfillment-shipping").click();
						if(!$(".js-gc-error-msg").length > 0){
							$(".shippingThreshold-msg").removeClass("hidden");
							$(".split-shipping-threshold-free").removeClass("hidden");
							$(".split-nonshipping-threshold-free").addClass("hidden");
						}
					}
				}
				else {
					$('.js-continue-guestcheckout-button').attr('disabled', 'disabled').addClass('disable-checkout-btn');
				}
			}
			

		}

	},

	defaultStoreMessage: function() {
		var storeId = document.getElementById('sessionStore').value;
		if (null == $.cookie("gls") && storeId == '172') {
			$("#defaultStoreMessage").removeClass('hidden');
		}
	},

	cartpopupLink: function() {
		$(document).on("click", ".store_link", function(e) {
			e.preventDefault();
			$("#colorbox").addClass("failedgeoLocation-box");
			$("#colorbox").removeClass("addAddress-checkout");
			ACC.colorbox.open("", {
				html: $("#failedgeolocationOverlay").html(),
				maxWidth: "100%",
				width: "650",
				escKey: false,
				overlayClose: false,
			})

		})
	},
	disableCheckoutButton: function() {
		$('.js-continue-checkout-button').attr('disabled', 'disabled');
		$('.js-continue-checkout-buttonoo').attr('disabled', 'disabled');
		$('.js-continue-guestcheckout-button').attr('disabled', 'disabled').addClass('disable-checkout-btn');
	},
	enableCheckoutButton: function() {
		$('.js-continue-checkout-button').removeAttr('disabled', 'disabled');
		$('.js-continue-checkout-buttonoo').removeAttr('disabled', 'disabled');
		$('.js-continue-guestcheckout-button').removeAttr('disabled', 'disabled').removeClass('disable-checkout-btn');
	},
	isNationalShippingInCart: "false",
	fullfillmentStatusCall: function() {
		ACC.cart.isNationalShippingInCart = $(".isNationalShippingInCart").val();
		var cartSelectedOrderType = $(".cart-orderType").val();
		if ($(".branch-shippingAvailable").length && $(".branch-shippingAvailable").val() == 'false') { //Branch Level Fullfillment Availablity
			ACC.cart.isNationalShippingInCart = false;
		}

		function showAvailabilityNonShippable(cartOrderType) {

			$(".js-cart-availability-non-shippable").each(function() {
				if ((cartOrderType !== "PARCEL_SHIPPING") && $(this).data("is-user-not-anonymous") == true) {
					$(this).removeClass("hidden");
				}
				else {
					$(this).addClass("hidden");
				}
			})

		}

		function showParcelErrorMessages(cartOrderType) {
			//$(".js-gc-problem-error").removeClass("hidden");
			//$(".js-gc-error-msg").removeClass("hidden");
			//$(".national-shipping-nonship-element").removeClass("hidden");
			$(".js-max-qty-err-message").removeClass("hidden");
			$(".js-cart-items-row.maxQtyRed").addClass("border-color-orange");
			$(".js-cart-items-row.shippable").addClass("border-color-orange");
			$(".js-cart-outofstock.outofstock").addClass("border-color-orange");
			$(".js-parcelShippingFulfillment-oos").addClass("hidden");
			showAvailabilityNonShippable(cartOrderType)
		}
		function disableCheckout(cartOrderType) {
			if (($(".disable-parcel-checkout").length && cartOrderType === "PARCEL_SHIPPING") || $('#disableHideListGuestCheckout').val() == 'true' || $(".enableFullfilment").val() == 'false' || ($(".js-cart-items-row").hasClass("maxQtyRed") && cartOrderType === "PARCEL_SHIPPING") || $(".border-red-transferflag").length || ACC.cartitem.cartflaginterval) {
				ACC.cart.disableCheckoutButton();
			}
			else {
				ACC.cart.enableCheckoutButton();
			}
		}
		function showGlobalErrorForHidelistAndOutOfStock() {
			if ($('#disableHideListGuestCheckout').val() == 'true' || $(".enableFullfilment").val() == 'false') {
				$(".js-gc-problem-error").removeClass("hidden");
			}
			if ($(".parcel-shipping").hasClass("fullfilment-select")) {
				if($(".isQtyErrorMsg").val() =='true'){
					$(".js-gc-problem-error").removeClass("hidden");
				}else{
					$(".js-gc-problem-error").addClass("hidden");
				}
				$(".national-shipping-ship-element").addClass("hidden");
			}
			if ($(".enableFullfilment").val() == 'false') {
				$(".outofstock").addClass("border-color-orange");
			}
		}


		function inventoryCheckForParcelShipping(cartOrderType) {
			if($(".isMixedCartEnabled").val() != 'true' && $(".isSplitCartFulfilment").val()!="true")
			{
				if (cartOrderType == "PARCEL_SHIPPING") {
					$(".non-parcelShipping").addClass("hidden");
					$(".parcelShippingFulfillment").removeClass("hidden");
				}
				else {
					$(".non-parcelShipping").removeClass("hidden");
					$(".parcelShippingFulfillment, .national-shipping-nonship-element").addClass("hidden");
				}
			}
		}

		if (($(".js-cart-items-row").hasClass("shippable") || $(".js-cart-items-row").hasClass("maxQtyRed")) && cartSelectedOrderType === 'PARCEL_SHIPPING') {
			showParcelErrorMessages(cartSelectedOrderType);
			disableCheckout(cartSelectedOrderType);
		}
		
		if (cartSelectedOrderType === 'PARCEL_SHIPPING') {
			ACC.cart.splitShippingEnable();
			inventoryCheckForParcelShipping(cartSelectedOrderType);
			showAvailabilityNonShippable(cartSelectedOrderType);
			$(".cart-shipping-fee-msg").addClass('hidden')
				if ($("#cart-shipping-fee-msg-show").val() == 'true') {
					$(".cart-shipping-fee-msg").removeClass('hidden');
				}
		}
		showGlobalErrorForHidelistAndOutOfStock();
		$(document).on("click", ".js-line-item-fullfilment.enabled", function(e) {

			if ($(this).find('.cart-item-icon').hasClass('selected-fulfillment')) {
				return false;
			}
			var url = ACC.config.encodedContextPath + "/cart/updateDeliveryMode";
			var currentElement = $(this);
			var nextElement = $(this).next().find(".cart-item-icon")
			var availabilityMsgElem = $(this).closest(".js-cart-items-row").find(".js-availablility-msg-mixed-cart")
			$(this).find('.cart-item-icon').addClass("ease-in-transition selected-fulfillment")
			$(this).find('.cart-item-icon svg  .selected-fill').addClass("green-fill");
			$(this).siblings().find('.cart-item-icon').removeClass("ease-out-transition selected-fulfillment")
			$(this).siblings().find('.cart-item-icon svg  .selected-fill').removeClass("green-fill");
			var deliveryMode = $(this).data("delivery-mode");
			var cartItemProdCode = $(this).data("prodcode");
			var entryNumber = $(this).closest(".cart-item-icon-container").data("entrynumber");
			var storeId=$(this).data("storeid");
			
			 
			$(this).closest(".js-cart-items-row").find(".changed_selectedFilfillmentStore").val(storeId);
			$(this).closest(".js-cart-items-row").find(".changed_selectedFilfillment").val(deliveryMode);
			if (screen.width >= 1024) {
				$(this).parent().children().find(".cart-item-icon").removeClass("border-left-none-md");
				nextElement.addClass('border-left-none-md');
			}
			 
			//Availability Messages start
				if(deliveryMode==='pickuphome' && $(availabilityMsgElem).data("requestedqty") > $(availabilityMsgElem).data("homestoreqty") && $(availabilityMsgElem).data("isbackordarable") !=true){
					$(availabilityMsgElem).removeClass("hidden")
					$(availabilityMsgElem).find(".js-onhand-qty").text($(availabilityMsgElem).data("homestoreqty"))
					$(availabilityMsgElem).find(".js-remaining-qty").text($(availabilityMsgElem).data("requestedqty") - $(availabilityMsgElem).data("homestoreqty"))
				}
				else if(deliveryMode==='pickupnearby' && $(availabilityMsgElem).data("requestedqty") > $(availabilityMsgElem).data("nearbystoreqty") && $(availabilityMsgElem).data("isbackordarable") !=true){
					$(availabilityMsgElem).removeClass("hidden")
					$(availabilityMsgElem).find(".js-onhand-qty").text($(availabilityMsgElem).data("nearbystoreqty"))
					$(availabilityMsgElem).find(".js-remaining-qty").text($(availabilityMsgElem).data("requestedqty") - $(availabilityMsgElem).data("nearbystoreqty")) 
				}
				else if(deliveryMode==='delivery' && $(availabilityMsgElem).data("requestedqty") > $(availabilityMsgElem).data("deliverystoreqty") && $(availabilityMsgElem).data("isbackordarable") !=true){
					$(availabilityMsgElem).removeClass("hidden")
					$(availabilityMsgElem).find(".js-onhand-qty").text($(availabilityMsgElem).data("deliverystoreqty"))
					$(availabilityMsgElem).find(".js-remaining-qty").text($(availabilityMsgElem).data("requestedqty") - $(availabilityMsgElem).data("deliverystoreqty")) 
				}
				else if(deliveryMode==='shipping' && $(availabilityMsgElem).data("requestedqty") > $(availabilityMsgElem).data("shippingstoresqty") && $(availabilityMsgElem).data("isbackordarable") !=true){
					$(availabilityMsgElem).removeClass("hidden")
					$(availabilityMsgElem).find(".js-onhand-qty").text($(availabilityMsgElem).data("shippingstoresqty"))
					$(availabilityMsgElem).find(".js-remaining-qty").text($(availabilityMsgElem).data("requestedqty") - $(availabilityMsgElem).data("shippingstoresqty"))
				}
			else {
				$(availabilityMsgElem).addClass("hidden")
			}

			//Availability message ends
			$.ajax({
				url: url,
				cache: false,
				type: "get",
				dataType: 'json',
				contentType: 'application/json',
				data: {
					"deliveryMode": deliveryMode,
					"entryNumber": entryNumber,
					"storeId": $(this).data("storeid")
				},
				success: function(response) {
					//Item Level Price Handling
					if (response.basePrice) {
						$(currentElement).closest(".js-cart-items-row").find(".js-cart-unit-price").text(response.basePrice.formattedValue)
						$(currentElement).closest(".js-cart-items-row").find(".js-item-total").text(response.entryTotalPrice.formattedValue)
						$(".js-cart-unit-discount-price").text(response.discountBasePrice.formattedValue)
						$(".js-cart-subtotal").text(response.subTotal.formattedValue)
						$(".js-cart-total-with-tax").text(response.cartTotalPrice.formattedValue)
						$(".js-cart-total-discount").text(response.totalDiscounts.formattedValue)
					}
					else {
						ACC.cart.disableCheckoutButton()
					}
					//Item Level Price Handling Ends
					if(response.showDeliveryFeeMessage==true){
						$(".delivery-fee-msg").removeClass("hidden")
					}
					else{
						$(".delivery-fee-msg").addClass("hidden");
						$(".showDeliveryFeeMessage").val("false");
					}
					//Shipping threshold
					if (deliveryMode === 'shipping' && response.differenceAmountShipping && response.differenceAmountShipping > 0) {
						$(currentElement).closest(".js-cart-items-row").find(".js-shipping-threshold").removeClass("hidden")
						$(".js-shipping-difference-amount").text(response.differenceAmountShipping)
					}
					else {
						$(currentElement).closest(".js-cart-items-row").find(".js-shipping-threshold").addClass("hidden")
						$(".js-shipping-difference-amount").text(response.differenceAmountShipping)
						$(".js-shipping-fulfillment").each(function(e){
							if($(this).hasClass("selected-fulfillment") && response.differenceAmountShipping && response.differenceAmountShipping >0){
								$(this).closest(".js-cart-items-row").find(".js-shipping-threshold").removeClass("hidden")
								$(".js-shipping-difference-amount").text(response.differenceAmountShipping);
							}
							else{
								$(this).closest(".js-cart-items-row").find(".js-shipping-threshold").addClass("hidden")
							}
							})
					}
					//Shipping Threshold ends
					//Max Qty starts
					if (deliveryMode === 'shipping' && response.maxShippingMessage) {
						$(currentElement).closest(".js-cart-items-row").addClass("border-red maxqty");
						$(currentElement).find(".cart-item-icon").addClass("error-fulfillment");
						$(currentElement).find(".cart-item-icon svg .selected-fill").removeClass("green-fill");
						if ($(currentElement).closest(".js-cart-items-row").prev().hasClass("js-max-qty-err-message")) {
							$(currentElement).closest(".js-cart-items-row").prev().removeClass("hidden");
							$(currentElement).closest(".js-cart-items-row").prev().text(response.maxShippingMessage)
						}
						$(".js-shipping-fulfillment").each(function() {
							if ($(this).hasClass("selected-fulfillment") && $(this).data("prodcode") == cartItemProdCode) {
								$(this).closest(".js-cart-items-row").addClass("border-red maxqty");
								$(this).addClass("error-fulfillment");
								$(this).find("svg .selected-fill").removeClass("green-fill");
								if ($(this).closest(".js-cart-items-row").prev().hasClass("js-max-qty-err-message")) {
									$(this).closest(".js-cart-items-row").prev().removeClass("hidden");
									$(this).closest(".js-cart-items-row").prev().text(response.maxShippingMessage)
								}
							}
							else if ($(this).closest(".js-cart-items-row").hasClass("maxqty") === false) {
								$(this).closest(".js-cart-items-row").removeClass("border-red maxqty");
								$(this).removeClass("error-fulfillment");
								if ($(this).closest(".js-cart-items-row").prev().hasClass("js-max-qty-err-message")) {
									$(this).closest(".js-cart-items-row").prev().addClass("hidden");
								}
							}

						})
					}
					else {
						$(currentElement).closest(".js-cart-items-row").removeClass("border-red maxqty");
						$(currentElement).find(".cart-item-icon").removeClass("error-fulfillment");
						$(currentElement).find(".cart-item-icon svg  .selected-fill").addClass("green-fill");
						if ($(currentElement).closest(".js-cart-items-row").prev().hasClass("js-max-qty-err-message")) {
							$(currentElement).closest(".js-cart-items-row").prev().addClass("hidden");
						}
						$(".js-shipping-fulfillment").each(function() {
							if ($(this).hasClass("selected-fulfillment") && $(this).data("prodcode") == cartItemProdCode && response.isMaxShippingExceeded === false) {
								$(this).closest(".js-cart-items-row").removeClass("border-red maxqty");
								$(this).removeClass("error-fulfillment");
								if ($(this).closest(".js-cart-items-row").prev().hasClass("js-max-qty-err-message")) {
									$(this).closest(".js-cart-items-row").prev().addClass("hidden");
								}
							}
						})
					}

					//Max Qty Ends

					if (deliveryMode === 'delivery' && response.differenceAmount && response.differenceAmount > 0) {
						$(currentElement).find(".cart-item-icon").addClass("error-fulfillment");
						$(currentElement).find(".cart-item-icon svg  .selected-fill").removeClass("green-fill");
						$(".js-delivery-minimum-msg").removeClass("hidden")
						$(currentElement).closest(".js-cart-items-row").find(".js-delivery-threshold-item-level").removeClass("hidden")
						$(".js-delivery-difference-amount").text(response.differenceAmount);
						ACC.cart.disableCheckoutButton()
					}
					else {
						var isCheckoutDisabledOnDeliveryThreshold = false;
						if (deliveryMode !== 'shipping' && response.maxShippingMessage == null) {
							$(currentElement).find(".cart-item-icon").removeClass("error-fulfillment");
						}
						$(".js-delivery-difference-amount").text(response.differenceAmount);

						$(".js-delivery-threshold-item-level").each(function(e) {
							if ($(this).closest(".js-cart-items-row").find(".js-delivery-option").hasClass("selected-fulfillment") && response.differenceAmount && response.differenceAmount > 0) {
								ACC.cart.disableCheckoutButton();
								$(".js-delivery-minimum-msg").removeClass("hidden");
								$(this).closest(".js-cart-items-row").find(".js-delivery-option").addClass("error-fulfillment");
								$(this).removeClass("hidden");
								isCheckoutDisabledOnDeliveryThreshold = true;
							}
							else if (!isCheckoutDisabledOnDeliveryThreshold) {
								$(".js-delivery-minimum-msg").addClass("hidden");
								$(this).addClass("hidden");
								$(this).closest(".js-cart-items-row").find(".js-delivery-option").removeClass("error-fulfillment");
								if ($(".border-red").length === 0) {
									ACC.cart.enableCheckoutButton();									
								}
								else {
									ACC.cart.disableCheckoutButton();
								}
							}
							if ($(this).hasClass("hidden") === false && ($(this).closest(".js-cart-items-row").find(".js-delivery-option").hasClass("selected-fulfillment")!=true)) {
								$(this).addClass("hidden");
							}
							

						})

					}
				}
			})
		})
		var orderTypeDelivery = $(".fullfilment-select").data("fullfillment");
		if (orderTypeDelivery == "DELIVERY" && $(".showDeliveryFeeMessage").val()=="true" && ($(".isTampaBranch").val()== "false" || $(".isLABranch").val()== "false")) {
			$(".delivery-fee-msg-nonmixcart").removeClass("hidden");
			$(".cart-shipping-fee-msg").addClass('hidden');
			}
			else if($(".checkmixedcart").val()=="false"&& $(".page-cartPage").length > 0){
				$(".delivery-fee-msg-nonmixcart").addClass("hidden");
			}
		ACC.cart.deliveryInCanada();

		$(document).on("click", ".js-fullfilment", function(e) {
			if(ACC.cart.isNationalShippingInCart == "true"){loading.start();}
			var url = ACC.config.encodedContextPath + "/cart/fullfillmentStatus";
			var orderType = $(this).data("fullfillment");
			digitalData.cart.item = [];
			ACC.cart.cartEntryCheck(orderType);
			if (!$(this).hasClass("disabled-fullfillment-method")) {
				var pageName = $(".pagename").val();
				digitalData.eventData = {
					linkName: "delivery-options",
					onClickPageName: pageName
				}
				try {
					_satellite.track("linkClicks");
				} catch (e) { }
			}
			$(".cart-shipping-fee-msg").addClass('hidden')
			if ($(".parcel-shipping").hasClass("fullfilment-select")) { 
				$(".pickupOnly-error-msg").addClass("hidden");
				$(".national-shipping-nonship-element").removeClass("hidden");
			}
			else {
				$(".pickupOnly-error-msg").removeClass("hidden");
				$(".national-shipping-nonship-element").addClass("hidden");
			}
			$(".js-gc-problem-error").addClass("hidden");
			$(".js-gc-error-msg").addClass("hidden");
			$(".js-cart-items-row.shippable").removeClass("border-color-orange");
			$(".js-max-qty-err-message").addClass("hidden");
			$(".js-cart-items-row.maxQtyRed").removeClass("border-color-orange");
			$(".js-parcelShippingFulfillment-oos").removeClass("hidden");
			$(this).parents(".cart-top-fulfillment-method").find(".changed_selectedFilfillment").val(orderType);
			if ($(this).hasClass("fullfillment-delivery") || $(this).hasClass("fullfillment-pickup")) {
				showAvailabilityNonShippable("pickupOrDelivery");
			}
			
			if($(this).hasClass("fullfillment-shipping") && !$(".js-gc-error-msg").length > 0){
			    $(".shippingThreshold-msg").removeClass("hidden");
				$(".split-shipping-threshold-free").removeClass("hidden");
				$(".split-nonshipping-threshold-free").addClass("hidden");
			}
			else{
				$(".shippingThreshold-msg").addClass("hidden");
				$(".split-shipping-threshold-free").addClass("hidden");
				$(".split-nonshipping-threshold-free").removeClass("hidden");
			}
			
			$(this).addClass("fullfilment-select").siblings().removeClass("fullfilment-select");

			$(this).addClass("ease-in-transition fullfilment-select").siblings().removeClass(" ease-out-transition fullfilment-select");

			$.ajax({
				url: url,
				cache: false,
				type: "get",
				dataType: 'json',
				contentType: 'application/json',
				data: {
					"orderType": orderType,

				},
				success: function(data) {
					inventoryCheckForParcelShipping(orderType);
					disableCheckout(orderType);
					showGlobalErrorForHidelistAndOutOfStock();
				},
			})
			if (orderType == "PARCEL_SHIPPING") {
				showParcelErrorMessages(orderType)
				$(".pickupOnly-error-entry").addClass('hidden');
				$(".cart-items-left-pane").each(
					function(){
						var showmsg=false;
						if ($(this).attr('data-shippingenabled') == 'false') {
							showmsg = true;
							// console.log(showmsg);
						}
						if(showmsg){
					$('.national-shipping-nonship-element').removeClass('hidden');
					$('.pickupOnly-error-msg').addClass('hidden');
				}else{
					$('.national-shipping-nonship-element').addClass('hidden');
				}
					})
					$(".cart-shipping-fee-msg").addClass('hidden')
					if ($("#cart-shipping-fee-msg-show").val() == 'true') {
						$(".cart-shipping-fee-msg").removeClass('hidden');
					}
			}
			
			else {
				$('.national-shipping-nonship-element').addClass('hidden');
				$(".pickupOnly-error-entry").removeClass('hidden');
				$(".pickupOnly-error-msg").removeClass("hidden");
			}
			if (orderType == "DELIVERY" && $(".checkmixedcart").val()=="false" && ($(".isTampaBranch").val()== "false" || $(".isLABranch").val()== "false")) {
				$(".delivery-fee-msg-nonmixcart").removeClass("hidden");
				$(".showDeliveryFeeMessage").val("true");
				$(".cart-shipping-fee-msg").addClass('hidden')
			}
			else if($(".checkmixedcart").val()=="false" && $(".page-cartPage").length > 0){
				$(".showDeliveryFeeMessage").val("false");
				$(".delivery-fee-msg-nonmixcart").addClass("hidden");
			}
			ACC.cart.deliveryInCanada();
				$('.cart-items-left-pane').each(function() {
					var cartBox = $(this);
					if(cartBox.find(".trasferable-flag").val()==='false' && cartBox.find(".isstockNearby-flag").val()==='true'){
						ACC.cart.disableCheckoutButton();
						$(".transferflag-msg").parents(".cart-items-left-pane").addClass("border-color-orange");
						$(".transferable-flag-msg").removeClass("hidden");
						$(".disable-parcel-checkout").removeClass("hidden");
					}
				});
			if(ACC.cart.isNationalShippingInCart == "true"){
				ACC.cart.nationalShippingCartHandling(orderType);
			}
			ACC.cart.hideSplitShippingSection();
			ACC.cart.cartEntriesAppend();
			ACC.cart.splitCartHeaderControl();
		});
		if (cartSelectedOrderType !== "PARCEL_SHIPPING") {
			showAvailabilityNonShippable("pickupOrDelivery");
		}
		if(ACC.cart.isNationalShippingInCart == "true"){
			ACC.cart.nationalShippingCartHandling(cartSelectedOrderType, true);
		}
		$("[data-fullfillment]").each(function(){
			let target = $(this);
			let triggered;
			let tType = target.data('fullfillment'); // PICKUP | DELIVERY | PARCEL_SHIPPING
			tType = (tType == 'PICKUP')? 'pickUp' : (tType == 'DELIVERY')? 'delivery' : 'parcel';
			if(target.hasClass("disabled-fullfillment-method") && target.hasClass("fullfilment-select")){
				target.find('.' + tType + 'Avail').addClass('hidden');
				target.find('.' + tType + 'NotAvail, .' + tType + 'Unavailable').removeClass('hidden');
				for (let i = 0; i < 3; i++) {
					let offTarget = $("[data-fullfillment]").eq(i);
					if(!offTarget.hasClass("disabled-fullfillment-method") && !triggered){
						triggered = true;
						offTarget.trigger("click");
						break;
					}
				}
			}
		});
		ACC.cart.cartEntryCheck();
	},
	nationalShippingCartHandling: function(orderType, onload){
		$.ajax({
			url: ACC.config.encodedContextPath + "/cart/getCartToggleResponse?fulfillmentType="+orderType,
			type: "get",
			data: orderType,
			success: function(data) {
				if($(".isSplitCartFulfilment").val()!="true"){
					$(".pickupOnly-error-msg, .pickupOnly-error-entry").addClass('hidden');
				}
				$(".gc-cart-global-error-msg, .js-gc-error-msg, .js-cart-availability-non-shippable, .gc-error-msg, .mobile-pickup-text, .national-shipping-msg").addClass("hidden");
				$(".border-color-orange, .orange-border").removeClass("border-color-orange orange-border");
				if($(".isQtyErrorMsg").val()=="true"){
					$(".js-cart-qty-error").removeClass('hidden');
					$(".js-gc-problem-error, .gc-cart-global-error-msg").removeClass("hidden")
				}
				if($(".isSplitCartFulfilment").val()=="true" && $(".isQtyErrorMsg").val()=="true"){
					$(".js-cart-qty-error").removeClass('hidden');
					$(".js-gc-problem-error, .gc-cart-global-error-msg").removeClass("hidden");
				}
				if($(".cart-top-fulfillment-method").length){ //checkout option not selected
					if((data.enableDelivery || data.enablePickup) && orderType == "PARCEL_SHIPPING"){ //Shipping selected and only shipping items with other option
						$(".national-shipping-msg").removeClass("hidden");
						ACC.cart.cartEntryAdjustStyling(orderType,data.pickupOrDeliveryOnlyAlertEntries, onload);
					}
					else if((data.enableDelivery || data.enablePickup) && orderType != "PARCEL_SHIPPING"){ //Other option selected and only shipping items with other option
						$(".national-shipping-ship-element").removeClass("hidden");
						ACC.cart.cartEntryAdjustStyling(orderType,data.shippingOnlyAlertEntries, onload);
					}
					else{ //only shipping items
						$(".national-shipping-msg").removeClass("hidden");
						$("[data-cartentry]").each(function(){
							let target = $(this);
							if(Number(target.data("cartentry")) == -1){	//out of stock
								target.addClass("border-color-orange");
								target.find(".js-parcelShippingFulfillment-oos").removeClass("hidden");
							}
						});
					}
	
					if(data.showDeliveryThresholdMsg){
						$(".cartHomeOwner-msg").removeClass("hidden");
					}
					else{
						$(".cartHomeOwner-msg").addClass("hidden");
					}
				
					if(onload){ //showing cart item section
						if(data.enablePickup){
							$(".fullfillment-pickup").removeClass("disabled-fullfillment-method").addClass("js-fullfilment");
							$(".pickUpAvail").removeClass("hidden");
							$(".pickUpNotAvail").addClass("hidden");
						}
						if(data.enableDelivery){
							$(".fullfillment-delivery").removeClass("disabled-fullfillment-method").addClass("js-fullfilment");
							$(".deliveryAvail").removeClass("hidden");
							$(".deliveryNotAvail").addClass("hidden");
						}
					}
				}
				else if(!ACC.cartitem.cartflaginterval){
					$(".cart-checkout-btn").removeClass("disable-checkout-btn").removeAttr("disabled");
				}

				$(".cart-page-container").removeAttr("style");
				loading.stop();
			},
			error: function() {
				if(onload){
					$(".cart-page-container").removeAttr("style");
				}
				loading.stop();
			}
		});
	},
	cartEntryAdjustStyling: function(orderType, filterArray, onload){
		let pickupAndDelivery = false;
		let pickupOnlyItems = true;
		let allEntriesDeliverable = true;
		let allEntriesShippable = true;
		let hasOutOfStockProduct=false;
		let noStockTransferrable= false;
		$("[data-cartentry]").each(function(){
			let target = $(this);
			let entry = Number(target.data("cartentry"));
			let index = target.data("index");
			let pickupEnabled = target.data("pickupenabled");
			let deliveryEnabled = target.data("deliveryenabled");
			let shippingEnabled = target.data("shippingenabled");
			target.removeClass("border-color-orange orange-border mb-marginTop40");
			target.find(".national-shipping-element").addClass("hidden");
			if(entry == -1){	//out of stock
				target.addClass("border-color-orange");
				target.find(".js-parcelShippingFulfillment-oos").removeClass("hidden");
				$(".js-gc-error-msg").removeClass("hidden");
				hasOutOfStockProduct= true;
			}
			else if(entry == -2){	//non transferrable
				target.addClass("border-color-orange");
				target.find(".transferflag-msg").removeClass("hidden");
				noStockTransferrable= true;
			}
			else if(entry != -3 && $.inArray(entry, filterArray) != -1){
				target.addClass("orange-border");
				if($(".isSplitCartFulfilment").val()=="true"){
					target.removeClass("orange-border");
				}
				target.find(".national-shipping-element").removeClass("hidden");
				pickupAndDelivery = true;
			}
			if(deliveryEnabled == true || shippingEnabled == true){
				pickupOnlyItems = false;
			}
			if(deliveryEnabled != true){
				allEntriesDeliverable = false;
			}
			if(shippingEnabled != true){
				allEntriesShippable = false;
			}
		});
		if(pickupAndDelivery){
			if($(".isSplitCartFulfilment").val()=="false"){
				$(".cart-checkout-btn").addClass("disable-checkout-btn").attr("disabled","disabled").css({opacity:.5, background: '#ccc', borderColor: '#ccc'});
			}
		}
		else if(!pickupAndDelivery && orderType == "PARCEL_SHIPPING" && !ACC.cartitem.cartflaginterval && !hasOutOfStockProduct && !noStockTransferrable){
			$(".cart-checkout-btn").removeClass("disable-checkout-btn").removeAttr("disabled style");
		}
		if(orderType == "PARCEL_SHIPPING" && allEntriesShippable){
			$(".cart-alert-message").hide();
		}
		else{
			$(".cart-alert-message").show();
		}
	},
	cartEntryCheck: function(orderType){
		let pickupOnlyItems = true;
		let allEntriesDeliverable = true;
		let shippingOnlyItems = true;
		$("[data-cartentry]").each(function(){
			let target = $(this);
			let entry = Number(target.data("cartentry"));
			let index = target.data("index");
			let pickupEnabled = target.data("pickupenabled");
			let deliveryEnabled = target.data("deliveryenabled");
			let shippingEnabled = target.data("shippingenabled");
			let cartErrorText;
			if(deliveryEnabled == true || shippingEnabled == true){
				pickupOnlyItems = false;
			}
			if(deliveryEnabled != true){
				allEntriesDeliverable = false;
			}
			if (pickupEnabled != true && deliveryEnabled != true && shippingEnabled != true) {
				cartErrorText = "no fulfillment option";
			}
			else {
				cartErrorText = ACC.cart.checkErrorAvailable(target, pickupEnabled, deliveryEnabled, shippingEnabled, orderType);
			}
			if (target.parent().hasClass("hidden") === false && target.parent().hasClass("split-cart-shipping-container") === false) {
				ACC.cart.bindAnalyticCartdata(index, cartErrorText, target.parent().attr("class"), orderType);
			}
		});
		
			if(pickupOnlyItems || (!allEntriesDeliverable  && !shippingOnlyItems)){
				$(".cart-delivery-threshold-message").remove();
			}
	},
	checkErrorAvailable: function(ref, pickupEnabled, deliveryEnabled, shippingEnabled,orderType) {
		let erreText = "";
		if(ACC.cart.isNationalShippingInCart != "true"){
			ref.find("[data-analyticerror]").each(function () {
				let target = $(this);
				if (!target.hasClass("hidden")) {
					erreText = target.data("analyticerror");
				}
			});
		}
		else if(orderType && orderType != "PARCEL_SHIPPING"){
			if(pickupEnabled != true && deliveryEnabled != true && shippingEnabled == true){ //shipping only
				erreText = "Shipping Only";
			}
			else{
				erreText = "";
			}
		}
		else{ //national Shipping Case
			if(pickupEnabled == true && deliveryEnabled != true && shippingEnabled != true){ //pickup only
				erreText = "Pick-Up/Delivery Only";
			}
			else if(pickupEnabled == true && deliveryEnabled == true && shippingEnabled != true){ //pickup and delivery only
				erreText = "Pick-Up/Delivery Only";
			}
			else{
				erreText = "";
			}
		}
		return erreText;
	},
	branchFullfillmentAvailablity: function() {
		if ($(".page-cartPage").length) {
			let allFullfillment = ["pickup", "delivery", "shipping"];
			let allFullfillmentAvailablity = [];
			let isAnyFullfillmentAvailable = false;
			for (let i = 0; i < allFullfillment.length; i++) {
				let currentFullfillment = $(".fullfillment-" + allFullfillment[i]);
				let tType = (allFullfillment[i] == 'shipping') ? 'parcel' : allFullfillment[i];
				if ($(".branch-" + allFullfillment[i] + "Available").length && $(".branch-" + allFullfillment[i] + "Available").val() == 'false') { //Branch Level Fullfillment Availablity
					allFullfillmentAvailablity.push(false);
					$(".cart-" + allFullfillment[i] + "-threshold-message").addClass('hidden');
				}
				else {
					allFullfillmentAvailablity.push(true);
				}
				if (!currentFullfillment.hasClass("disabled-fullfillment-method")) { //Fullfillment Disabling check
					if (!allFullfillmentAvailablity[i]) {
						currentFullfillment.addClass("disabled-fullfillment-method")
						currentFullfillment.removeClass("fullfilment-select js-fullfilment");
						currentFullfillment.find('.' + tType + 'Avail').addClass('hidden');
						currentFullfillment.find('.' + tType + 'NotAvail, .' + tType + 'Unavailable').removeClass('hidden');
					}
					else {
						isAnyFullfillmentAvailable = true;
					}
				}
			}
			if (isAnyFullfillmentAvailable) {
				if ($('.isDeliveryOnlyBranch').val() == true) {
					$('.fullfillment-delivery').click();
				}
				
			}
			if ($(".cart-top-fulfillment-method").length && $.inArray(false, allFullfillmentAvailablity) != -1) {
				$(".js-cart-items-row ").each(function () {
					let target = $(this);
					let allIconDisabled = true;
					for (let j = 0; j < 2; j++) {
						let iconParent = target.find(".cart-item-icon-container").eq(j);
						for (let k = 0; k < allFullfillment.length; k++) {
							let iconEnabled = target.data(allFullfillment[k] + "enabled");
							if (!allFullfillmentAvailablity[k] && iconEnabled) {
								iconParent.find(".cart-item-col").eq(k).css({ opacity: .9 }).find("svg").css({ opacity: .2 });
								iconEnabled = false;
							}
							if (iconEnabled) {
								allIconDisabled = false;
							}
						}
					}
					if (!isAnyFullfillmentAvailable || allIconDisabled) {
						target.addClass("border-color-orange");
						target.find(".cart-availability-backorder-msg").remove();
						target.find(".js-update-entry-quantity-btn, .js-update-entry-quantity-input").addClass("disabled").attr("disabled", "disabled").css({ opacity: .5 });
						if (!$("#disableCheckoutMessage").length) {
							$(".cart-orderType").insertAfter('<div class="gc-error-msg marginTop20 js-gc-problem-error flex-center row hidden-print disable-parcel-checkout"><div class="col-xs-12"><div class="flex-center gc-cart-global-error-msg"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="21.333" viewBox="0 0 24 21.333"><path fill="#bc0000" d="M23.73,18.334a2,2,0,0,1-1.732,3H2a2,2,0,0,1-1.732-3L10.267,1a2,2,0,0,1,3.465,0l10,17.334ZM12,14.75a1.917,1.917,0,1,0,1.917,1.917A1.917,1.917,0,0,0,12,14.75ZM10.18,7.861l.309,5.667a.5.5,0,0,0,.5.473h2.023a.5.5,0,0,0,.5-.473l.309-5.667a.5.5,0,0,0-.5-.527H10.679a.5.5,0,0,0-.5.527Z" transform="translate(0)"></path></svg></span><span class="pad-lft-10">There\'s a problem with your cart. Please correct any errors indicated below and try again.</span></div></div></div>');
						}
						$(".cart-checkout-btn").addClass("disable-checkout-btn").attr("disabled", "disabled").css({ opacity: .5, background: '#ccc', borderColor: '#ccc' });
						$("#disableCheckoutMessage").removeClass("hidden");
						$(".js-gc-error-msg").remove();
					}
					if($("#isAnonymous").val()=='true' && $(".isDeliveryOnlyBranch").val()== 'true'){
						if(!$(".cart-delivery-threshold-message").parent().parent().hasClass('hidden') && !$(".cartHomeOwner-msg").hasClass('hidden')){
							$(".gc-cart-global-error-msg").addClass('hidden');
							$(".js-cart-items-row ").each(function () {
								if($(this).attr('data-deliveryenabled')=='true'){
										 $(this).find(".cartQtyBox").removeClass("disabled");
										 $(this).find(".cartQtyBox").removeAttr("disabled").css({ opacity: 1 });
										 $(this).find(".cart-qty-btn").removeAttr("disabled").css({ opacity: 1 });
										$(this).removeClass('border-color-orange');
								}
								else {
									$(".gc-cart-global-error-msg").removeClass('hidden');
								}
														
							})
					 	}
					 }
				});
			}
			$(".cart-page-container").removeAttr("style");
		}
		
		if ($(".parcel-shipping").hasClass("fullfilment-select")) {
		$(".pickupOnly-error-msg").addClass("hidden");
		$(".pickupOnly-error-entry").addClass('hidden');
		$(".cart-items-left-pane").each(
			function(){
				var showmsg=false;
				if ($(this).attr('data-shippingenabled') == 'false') {
					showmsg = true;
					// console.log(showmsg);
				}
				if(showmsg){
			$('.national-shipping-nonship-element').removeClass('hidden');
			$('.pickupOnly-error-msg').addClass('hidden');
		}else{
			$('.national-shipping-nonship-element').addClass('hidden');
		}
			})}
			else {
				$('.national-shipping-nonship-element').addClass('hidden');
				$(".pickupOnly-error-entry").removeClass('hidden');
				$(".pickupOnly-error-msg").removeClass("hidden");
			}
			
	},
	nearbyContinue: function() {
		ACC.colorbox.open("", {
			html: $(".nearby-continue").html(),
			maxWidth: "100%",
			width: "600",
			escKey: false,
			overlayClose: false,
			close: "",
			title: "<h1 class='headline'>" + ACC.config.nearbyContinueheading + "</h1>",
			className: "nearby-continue",
			onComplete: function(e) {
				_AAData.popupChannel= "checkout";
				_AAData.popupPageName = "checkout: nearby-delay popup";
					try {
					    	 _satellite.track('popupView');
			        } catch (e) {} 
				},
		})
	},

	prop65Overlay: function(checkoutUrl) {
		ACC.colorbox.open("", {
			html: `<div class='row'>
							<div class='col-md-2 col-sm-2 col-xs-3'><span class='icon-warning'></span></div>
							<div class='col-md-10 col-sm-10 col-xs-9'><div class='row'>${ACC.config.cancerHarm} <span class='hidden-xs hiddem-sm'></br /></span><a
								class='prop65-url' href='https://www.P65warnings.ca.gov' target='_blank'>https://www.P65warnings.ca.gov</a>
								<div class='cl'></div></br>
								<div class='row'>
								<div class='col-md-8 col-xs-10'>
									<a href='${checkoutUrl}' class='prop65-btn btn btn-block btn-primary ${$('body').hasClass("page-siteOneCheckoutPage") ? 'proceed-to-checkout-ca' : ''}'>${ACC.config.proceedToCheckout}</a></div>
								</div>
							</div>
						</div>
					</div>`,
			title: "<div class='headline'>" + ACC.config.californiaCustomers + "</div>",
			width: "530px",
			className: "californiaPopup",
			onComplete: function() {
				sessionStorage.setItem("IsProp65Shown", "true");
				_AAData.popupChannel= "checkout";
				_AAData.popupPageName = "checkout: california popup";
					try {
					    	 _satellite.track('popupView');
			        } catch (e) {}
			},
			 onClosed: function() {
				sessionStorage.removeItem("IsProp65Shown");
			},
			
		});
	},
	cartDeliveryMethod: function() {
		$(document.body).on('click', '.exitEmail-guestCheckout-email', function(e) {
			var linkNmae = $(this).text().split(".a")[0].trim();
			var pageName = $(".pagename").val();
			digitalData.eventData = {
				linkName: linkName,
				onClickPageName: pageName
			}
			try {
				_satellite.track("linkClicks");
			} catch (e) { }
		});

		$(document).on('click', '.js-continue-guestcheckout-button', function(e) {
			e.preventDefault();
			ACC.cart.userType = "guest";
			try { ACC.cart.cartPageTotal = $(".cart-totals").text().trim().replace('$', '').replaceAll(',', ''); }
			catch { ACC.cart.cartPageTotal = 0 }
			if ($(".nearbyContinue").val() == "false" && $(".checkmixedcart").val()=="false" && ($(".changed_selectedFilfillment").val()!='PARCEL_SHIPPING')) {
				ACC.cart.nearbyContinue();
				return false;
			}
			var californiaLocation = $("#california_location").val();
			var checkoutUrl = $(this).attr('href');
			if (californiaLocation === 'CA' && $(".nearbyContinue").val() == "true") {
				$.ajax({
					success: function(result) {
						ACC.cart.prop65Overlay(checkoutUrl);
					},

				});
				return false;
			}
			var cartEntriesError = ACC.pickupinstore.validatePickupinStoreCartEntires();
			if (!cartEntriesError)
			{
				ACC.cart.ga4AdobeAnalytics($(this).text().trim(), $(".pagename").val(), [], "scCheckout", $("#anonymousCartId").val(), 0, ACC.cart.cartPageTotal, ACC.cart.userType);
				window.location.href = checkoutUrl;
			}
		});
		
		
		
		
		$(document).on('click', '.prop65-btn, .accept-delay', function(e) {
			e.preventDefault();
			cartEntriesError = ACC.pickupinstore.validatePickupinStoreCartEntires();
			if (!cartEntriesError) {
				ACC.cart.ga4AdobeAnalytics($(this).text().trim(), $(".pagename").val(), [], "scCheckout", $("#anonymousCartId").val(), 0, ACC.cart.cartPageTotal, ACC.cart.userType);
				window.location.href = $(this).attr('href');
				return false;
			}
		});
		
		
		$(document).on('click', '.removeCart', function(e) {
			if ($('#isAnonymous').val() == "false") {
				var deletedCartID = $("#currentCartId").val();
			}
			else {
				var deletedCartID = $("#anonymousCartId").val();
			}
			digitalData.eventData={
					deletedCartId: deletedCartID,
					linktype:"",
	                linkName: "Remove All",
	                onClickPageName: "checkout:cart",
	            }
			_satellite.track("linkClicks");
			var item = [];
			cartEntriesError = ACC.pickupinstore.validatePickupinStoreCartEntires();
			if (!cartEntriesError) {
				digitalData.cart = {
					item: [],
				}
				$('input[id^=cartEntry]').each(function() {
					if($(this).parent().hasClass("hidden")===false){
		            var index = this.id.split('cartEntry')[1];
					ACC.cart.bindAnalyticCartdata(index);
		            
		                // console.log("digitalData" + JSON.stringify(digitalData));
		                
					}
		        });
					try {
						_satellite.track("cartDelete");
					} catch (e) { }
				 
			}
			
		});
		

	},
	cartPageTotal: '0',
	userType: 'guest',
	ga4AdobeAnalytics: function(linkName, pageName, item, pEvent, cartId, recentCartIds, potentialRevenue, checkoutOptions) {
		var _satellite_track_Checkout;
		var CartItems = [];
		var entryParent = !$(".parcelShippingFulfillment").length || $(".parcelShippingFulfillment").hasClass("hidden") ? '.non-parcelShipping ' : '.parcelShippingFulfillment ';
		digitalData.eventData = {
			linktype: "",
			linkName: linkName,
			onClickPageName: pageName,
		}
		try {
			_satellite.track("linkClicks");
		} catch (e) { }
		digitalData.cart = {
			item: item,
			event: pEvent,
			cartId: cartId,
			potentialRevenue: potentialRevenue,
			checkoutOptions: checkoutOptions
		}
		if (recentCartIds) {
			digitalData.cart.recentCartIds = recentCartIds;
		}
		if ($('input[id^=cartEntry]').length) {
			$(entryParent + 'input[id^=cartEntry]').each(function () {
				var index = this.id.split('cartEntry')[1];
				if (!isNaN(index) && index != '') {
					ACC.cart.bindAnalyticCartdata(index);
					_satellite_track_Checkout = true;
					try {
						var ga4CartData = ACC.ga4analytics.generate_cart_item_payload(index, entryParent);
						if (ga4CartData) {
							CartItems.push(ga4CartData);
						}
					} catch (e) { }
				}
			});
		}
		if (_satellite_track_Checkout) {
			try {
				_satellite.track("Checkout");
				ACC.ga4analytics.begin_checkout(CartItems, parseFloat(potentialRevenue)); /***For GA4 Analytics begin_checkout ***/
			} catch (e) { }
		}
	},
	removeAllItems: function() {
		$(document).on("click", "#remove-all-items-cart", function(e) {
			ACC.colorbox.open("", {
	            html:  $(".remove-all-items-modal").html(),
				width: "580px",
	            className:"cart-remove-all-items-popup"
	        });
		});
	},
	cartPriceSKUArray: [],
	showPriceLoader: function () {
		let cartPageSize = $(".cartPageSize").val();
		let priceLoop = $(".cartPageCount").val();
		let priceDataArray = [];
		$(".cart-items-left-loader").each(function () {
			let target = $(this);
			let index = target.data("priceshowindex");
			let code = target.data("priceshowcode");
			priceDataArray[index] = code;
			ACC.cart.cartPriceSKUArray[index] = code;
		});
		let cspCalls = Math.ceil(priceDataArray.length / priceLoop);
		if (cartPageSize < priceDataArray.length) {
			for (let index = 0; index < cspCalls; index++) {
				let setData = priceDataArray.slice(index * priceLoop, (index + 1) * priceLoop);
				$.ajax({
					url: ACC.config.encodedContextPath + "/cart/fetchCspOnload",
					type: "get",
					data: {
						sequenceNo: index,
						sku: setData.join(",")
					},
					success: function (data) {
						if (data) {
							ACC.cart.showCartPrice(data, priceDataArray);
						}
						else { //error => page reload
							ACC.cart.showCartPrice(false);
						}
					},
					error: function () { //error => page reload
						ACC.cart.showCartPrice(false);
					}
				});
			}
		}
	},

	uploadCsvCart: function(e){
		var files = e.files;
		if(files[0].type != 'text/csv' ){
			$('.fileBrowseContainer').addClass('filetype-error-alert padding20');
			$(".filetype-info").show();
			$(".filetype-error-info").show();
			$(".upload-type-fail-msg").text('Incorrect File type');
		} else {
			$('.fileBrowseContainer').removeClass('filetype-error-alert padding20');
			$('.csvUploadbtn').removeAttr('disabled');
			$(".filetype-info").hide();
			$(".filetype-error-info").hide();
		}
		$('.select-filename').text(files[0].name);
	},
	formSubmitCsvCart: function (event) {
        $('.csvUploadbtn').prop("disabled", true);
        var formupload = document.getElementById("siteoneCartUploadForm");
        var fdata = new FormData(formupload);
        loading.start();
        $("<p style='margin: -100px auto auto auto; top: 50%;' class='text-align-center elemOverlayParent font-Geogrotesque f-s-28 text-default'>Hang tight, we're getting things ready for you</p><p style='margin: auto; top: 50%;' class='text-align-center elemOverlayParent font-Geogrotesque f-s-28 text-default'><span class='csv-cart-progress'>0</span>%</p>").appendTo('#loadingOverlay');
        ACC.cart.csvCartProgressStart(document.getElementById("csvFileCart").files[0].size);
        ACC.cart.csvCartProgressResponse = "";
        $.ajax({
            url: formupload.action,
            data: fdata,
            enctype: 'multipart/form-data',
            processData: false,
            contentType: false,
            cache: false,
            type: 'POST',
            success: function (response) {
                ACC.cart.csvCartProgressResponse = response;
            },
            error: function (response) {
                ACC.cart.csvCartProgressResponse = response.statusText;
            }
        });
    },
    csvCartProgressEstimatedTime: 99,
    csvCartProgressPerSecond: 99,
    csvCartProgressCounter: 0,
    csvCartProgressTimer: "",
    csvCartProgressResponse: "",
    csvCartProgressUpdate: function () {
        ++ACC.cart.csvCartProgressCounter;
        let currentPercentage = Math.ceil(ACC.cart.csvCartProgressCounter * ACC.cart.csvCartProgressPerSecond);
        //console.log("currentPercentage: ", currentPercentage," Response: ",  ACC.cart.csvCartProgressResponse," Counter: ",  ACC.cart.csvCartProgressCounter)
        if (ACC.cart.csvCartProgressResponse != "") {
            $(".csv-cart-progress").html(100);
            clearInterval(ACC.cart.csvCartProgressTimer);
            setTimeout(function () {
                loading.stop();
                ACC.cart.csvCartOpenAndResponseHandle(ACC.cart.csvCartProgressResponse);
            }, 600);
        }
        else if (currentPercentage < 99 && ACC.cart.csvCartProgressCounter < Math.ceil(ACC.cart.csvCartProgressEstimatedTime)) {
            $(".csv-cart-progress").html(currentPercentage);
        }
        else {
            $(".csv-cart-progress").html(99);
        }
    },
    csvCartProgressStart: function (fileSize) {
        if (fileSize) {
            ACC.cart.csvCartProgressEstimatedTime = (776.441 / 7284) * fileSize * ((fileSize + 90) * .0024); //static calculation SE- for total time
            ACC.cart.csvCartProgressPerSecond = 100 / ACC.cart.csvCartProgressEstimatedTime;
            ACC.cart.csvCartProgressCounter = 0;
            //console.log("EstimatedTime: ", ACC.cart.csvCartProgressEstimatedTime," PerSecond: ",  ACC.cart.csvCartProgressPerSecond," Counter: ",  ACC.cart.csvCartProgressCounter);
            ACC.cart.csvCartProgressTimer = setInterval(ACC.cart.csvCartProgressUpdate, 1000);
        }
    },
	csvCartOpenAndResponseHandle: function (response) {
		$("#loadingOverlay").empty();
		var selectFileUpload = false;
        var closeBtnSvg = '<span id="close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="15" viewBox="0 0 16 15" fill="none"><path d="M10.8769 7.5L15.1412 3.23565C15.6645 2.71236 15.6645 1.86392 15.1412 1.3402L14.1935 0.392472C13.6702 -0.130824 12.8218 -0.130824 12.298 0.392472L8.03369 4.65682L3.76934 0.392472C3.24605 -0.130824 2.39761 -0.130824 1.87389 0.392472L0.926163 1.3402C0.402868 1.86349 0.402868 2.71193 0.926163 3.23565L5.19051 7.5L0.926163 11.7643C0.402868 12.2876 0.402868 13.1361 0.926163 13.6598L1.87389 14.6075C2.39719 15.1308 3.24605 15.1308 3.76934 14.6075L8.03369 10.3432L12.298 14.6075C12.8213 15.1308 13.6702 15.1308 14.1935 14.6075L15.1412 13.6598C15.6645 13.1365 15.6645 12.2881 15.1412 11.7643L10.8769 7.5Z" fill="#78A22F"/></svg></span>';
		if (response == 'uploadCartEmpty') {
            $('.select-filename').text('');
            $('.fileBrowseContainer').addClass('filetype-error-alert padding20');
            $(".filetype-info").show();
            $(".filetype-error-info").show();
            $(".upload-type-fail-msg").text('File is Blank');
			$(".csvFile").val(null);
        }
        else {
            var prodCount, popupHTML,numUploadissues;
			if (response.indexOf("uploadSuccess") > -1) {
				response = response.replace("[", '').replace("]", '');
                prodCount = response.split("|")[1];
                popupHTML = "sucess";
				var notAvailableProds=response.split(",");
				$(".csvUploadInfo").hide();
				totalUploaded=prodCount;
				if(response.split("|").length > 3){
					$(".csvUploadInfo").show();
					numUploadissues=notAvailableProds.length;
					totalUploaded=numUploadissues+Number(prodCount);
					if(numUploadissues==1){
						$(".csvUploadInfoHeadline").text("There was "+ numUploadissues +" problem:");

					}else{
						$(".csvUploadInfoHeadline").text("There were "+ numUploadissues +" problems:");
					}
					var firstProductWithSuccess = notAvailableProds[0].split("|");
					notAvailableProds[0]=firstProductWithSuccess[2]+"|"+firstProductWithSuccess[3];
					for(var i=0; i<notAvailableProds.length; i++){
						var prodcodeAndDec=notAvailableProds[i].split("|");
						$("<div>Item "+prodcodeAndDec[0]+" is "+prodcodeAndDec[1]+"</div>").appendTo('.csvUploadInfoDetails')
					}
					ACC.adobelinktracking.cartCsvUpload('','','','checkout: cart: upload csv popup: partial confirmation popup', 'checkout', 'checkout: cart: upload csv popup: partial confirmation popup');
				}else{
					ACC.adobelinktracking.cartCsvUpload('','','','checkout: cart: upload csv popup: confirmation popup', 'checkout', 'checkout: cart: upload csv popup: confirmation popup');
				}
				
            }
            else if (response == 'uploadCartExceeded') {
                popupHTML = "exceeded";
				ACC.adobelinktracking.cartCsvUpload('','','','checkout: cart: upload csv popup: error popup', 'checkout', 'checkout: cart: upload csv popup: error popup');
            }
			else if (response == 'openCart') {
				popupHTML = "";
			}
            else {
                popupHTML = "uploaderror";
				ACC.adobelinktracking.cartCsvUpload('','','','checkout: cart: upload csv popup: error popup', 'checkout', 'checkout: cart: upload csv popup: error popup');
            }
            ACC.colorbox.open("", {
                html: $(".cart-import-popup" + popupHTML).html(),
                width: "100%",
                maxWidth: "738px",
                className: "cart-import-csv",
                close: closeBtnSvg,
                title: "<h4 class='hidden-md hidden-lg headline'><span class='headline-text'>" + ACC.config.shoppingCartUploadTitle + "</span></h4>",
                onComplete: function () {
					if(popupHTML == ""){
						$('.cart-import-csv #colorbox').addClass('shopping-cart-list-upload');
						$("body").css("overflow-y", "hidden");
						$(".filetype-error-info, .filetype-info").hide();
						$('.select-filename').text("");
						$(".csvFile").val(null);
						$('.csvUploadbtn').prop("disabled",true);
						$('.fileBrowseContainer').removeClass('filetype-error-alert padding20');
					}
					if(popupHTML == "exceeded"){
						$(".selectFileUploadCart").on( "click", function() {
							selectFileUpload = true;
							ACC.colorbox.close();
						});
					}
                    if (popupHTML == "sucess") {
						if(prodCount==1){
							$('.csvUploadPanelHeadline').text(prodCount+" Of "+ totalUploaded + " " + ACC.config.shoppingCartUploadSuccessSingle);
						}else{
							$('.csvUploadPanelHeadline').text(prodCount+" Of "+ totalUploaded + " " + ACC.config.shoppingCartUploadSuccess);
						}
                    }
                    $("body").css("overflow-y", "hidden");
                },
                onClosed: function () {
                    $('body').css("overflow-y", "auto");
                    if (popupHTML == "sucess") {
                        loading.start();
                        window.location.href = ACC.config.encodedContextPath + "/cart";
                    }
					if(selectFileUpload){
						selectFileUpload = false;
						ACC.cart.csvCartOpenAndResponseHandle('openCart');
					}
                }
            });
        }
    },
	
  formatter: new Intl.NumberFormat('en-US', {
	style: 'currency',
	currency: 'USD',
	// These options are needed to round to whole numbers if that's what you want.
	minimumFractionDigits: 2, // (this suffices for whole numbers, but will print 2500.10 as $2,500.1)
	maximumFractionDigits: 3 // (causes 2500.99 to be printed as $2,501)
	}),	
  showCartPrice: function (data, priceDataArray) {
    // console.log(data, priceDataArray);
    if (data) {
      for (let i = 0; i < data.products.length; i++) {
        let pCode = Number(data.products[i].productCode);
        let target = $('[data-priceshowcode="' + pCode + '"]');
        target.next(".cart-items-left-price-show").removeClass("hidden").find(".atc-price-analytics").html(ACC.cart.formatter.format( data.products[i].itemPrice));
        target.next(".cart-items-left-total-show").removeClass("hidden").find(".atc-price-analytics").html(ACC.cart.formatter.format( data.products[i].itemTotal));
        target.remove();
        ACC.cart.cartPriceSKUArray.splice($.inArray(pCode, ACC.cart.cartPriceSKUArray), 1);
        if (!ACC.cart.cartPriceSKUArray.length) {
          $(".cart-total-loader").remove();
          if ($('.js-cart-total-discount').length > 0) {
			let discountPrice = Number($(".js-cart-total-discount").find('.b-price').text().trim().replace(/[$,]/g, ''));
			let estimatedPrice = (data.subTotal-discountPrice).toLocaleString();
			$(".cart-total-loader-show").removeClass("hidden").children(".js-cart-total-with-tax").html('$' + estimatedPrice);
			$(".cart-total-loader-show").removeClass("hidden").children(".js-cart-subtotal").html(ACC.cart.formatter.format( data.subTotal));
		} else {
			$(".cart-total-loader-show").removeClass("hidden").children(".js-cart-total-with-tax, .js-cart-subtotal").html(ACC.cart.formatter.format( data.subTotal));
		}
          $(".cart-loader-button-overlay").removeClass("cart-loader-button-overlay");
        }
      }
    }
    else {
      ACC.colorbox.open("", {
        title: "<div class='text-center'>" + ACC.config.cartPriceLoaderErrorTitle + "</div>",
        html: '<div class="row text-center"><div class="col-md-12"><p class="bold f-s-18">' + ACC.config.cartPriceLoaderErrorHeading + '</p><p class="brown f-s-18">' + ACC.config.cartPriceLoaderErrorMessage + '</p></div><div class="col-md-6"><a class="btn btn-primary btn-block" href="' + ACC.config.encodedContextPath + '/cart">' + ACC.config.cartPriceLoaderErrorRefresh + '</a></div><div class="col-md-6"><a class="btn btn-primary btn-block" href="' + ACC.config.encodedContextPath + '/contactus">' + ACC.config.cartPriceLoaderErrorContact + '</a></div></div>',
        close: '',
        width: 700,
        escKey: false,
        overlayClose: false
      });
    }
  },
  hardscapesStoneCartAlert: function() {
		if ($(".page-cartPage").length && $(".cart-top-fulfillment-method").length) {
			let target = $(".cart-items-left-pane");
			let l1Category = (ACC.config.encodedContextPath == '/es') ? 'Materiales duros & Vida al Aire Libre' : 'Hardscapes & Outdoor Living';
			let hardscapesconsumablesProductFound;
			let landscapeCategory = (ACC.config.encodedContextPath == '/es') ? 'Material de Jardinera' : 'Landscape Supply';
			let cosumableCategory = (ACC.config.encodedContextPath == '/es') ? 'Consumibles' : 'Consumables';
			for (let i = 0; i < target.length; i++) {
				if ((target.eq(i).data('level1category') == l1Category || (target.eq(i).data('level1category') == landscapeCategory && target.eq(i).data('level2category') == cosumableCategory )) && (target.eq(i).data('uommeasure').indexOf("Net Ton") != -1 || target.eq(i).data('uommeasure').indexOf("Cubic Yard") != -1)) {
					hardscapesconsumablesProductFound = true;
					if (target.eq(i).hasClass("hardscape-highlight-border")) {
						target.eq(i).removeClass("hardscape-highlight-border");
					};
					target.eq(i).addClass("hardscape-highlight-border");
				}
			}
			if (hardscapesconsumablesProductFound) {
				$(".hardscape-stone-alert-box").removeClass("hidden");
			}
		}
	},
	deliveryInCanada: function() {
		var isDeliveryOrder = $(".fullfilment-select").data("fullfillment");
		if (isDeliveryOrder == "DELIVERY" && $(".siteoneCARegion").val() == "true") {
			$(".delivery-fee-msg-nonmixcart").removeClass("hidden");
		}
	}
};
$(document).ready(function() {
	$('.item-fulfillment-container').each(function () {
			var storeId=$(this).find(".selected-fulfillment").parent(".js-line-item-fullfilment").data("storeid");
			$(this).closest(".js-cart-items-row").find(".changed_selectedFilfillmentStore").val(storeId);
	});
	if($(".showDeliveryFeeMessage").val() =="true" && $(".checkmixedcart").val()=="true"){
		$(".delivery-fee-msg").removeClass("hidden")
			
	}
	 else{
		$(".delivery-fee-msg-nonmixcart").removeClass("hidden");
		$(".cart-shipping-fee-msg").addClass('hidden');
	}
	ACC.cart.deliveryInCanada();
	if ($(".page-orderSummaryPage").length > 0) {
		var tradeClass = $(".trade-class").val();
		var subTotalVal = $(".subTotal-class").val();
		var homeOwnerCode = $(".homeOwnerCode").val();
		var subtotalLimit = $(".subtotalLimit").val();
		var orderType = $("#orderType").val();
		if (tradeClass == homeOwnerCode && (parseFloat(subTotalVal) < parseFloat(subtotalLimit)) && orderType == "DELIVERY") {
			$(".btn-place-order").attr("disabled", true);
			$(".homeOwner-msg").removeClass("hidden");
		}
	}
	if ($(".page-cartPage").length > 0) {
		var tradeClass = $(".trade-class").val();
		var subTotalVal = $(".subTotal-class").val();
		var homeOwnerCode = $(".homeOwnerCode").val();
		var subtotalLimit = $(".subtotalLimit").val();
		var deliveryEligibleTotal = $(".deliveryEligibleTotal").val();
		var isDeliveryTampaGuest = $(".isDeliveryTampaBranch").val();
		var isDeliveryLAGuest = $(".isDeliveryLABranch").val();
		var isPickupaAllowedBranch = $(".isPickupaAllowedBranch").val();
		var isTampaBranch = $(".isTampaBranch").val();
		var isLABranch = $(".isLABranch").val();
		var isShippingHubOnly = $(".isShippingHubOnly").val();
		var cartDeliveryDisabled = $(".cartDeliveryDisabled").val();
		$(".deliveryAvail").removeClass("hidden");
		$(".parcelAvail").removeClass("hidden");
		var enableParcelShipping = $(".enableParcelShipping").val();

		if (enableParcelShipping != "true") {
			$(".parcel-shipping").addClass("disabled-fullfillment-method").removeClass("js-fullfilment");
			$(".parcelUnavailable").removeClass("hidden");
			$(".parcelAvail").addClass("hidden");
		}
		if (((isTampaBranch == "false")
			|| (isDeliveryTampaGuest != "" && (isDeliveryTampaGuest == "true"))
			|| (isLABranch == "false") 
			|| (isDeliveryLAGuest != "" && (isDeliveryLAGuest == "true"))) && (parseFloat(deliveryEligibleTotal) < parseFloat(subtotalLimit))) {
			if ($(".isStockAvalilableOnlyHub").val() != "true") {
				$(".cartHomeOwner-msg").removeClass("hidden");
			}
			$(".local-delivery").addClass("disabled-fullfillment-method").removeClass("js-fullfilment");
			$(".deliveryNotAvail").removeClass("hidden");
			$(".deliveryAvail").addClass("hidden");
		}
		
		if ((isDeliveryTampaGuest != "" && (isDeliveryTampaGuest == "false") && (isDeliveryLAGuest != "" && isDeliveryLAGuest == "false")) || (cartDeliveryDisabled == "true")) {
			$(".local-delivery").addClass("disabled-fullfillment-method").removeClass("js-fullfilment");
			$(".deliveryNotAvail").removeClass("hidden");
			$(".deliveryAvail").addClass("hidden");
		}
		
		if (isPickupaAllowedBranch != "" && isPickupaAllowedBranch == "false") {
			$(".branch-pickup").addClass("disabled-fullfillment-method").removeClass("js-fullfilment");
			$(".branch-pickup").removeClass("fullfilment-select");
			$(".pickUpAvail").addClass("hidden");
			$(".pickUpNotAvail").removeClass("hidden");
		}
		
		var orderType = $(".cart-orderType").val();
		if (orderType == 'PICKUP') {
			isShippingHubOnly = "false";
			$(".split-shipping-threshold-free").addClass("hidden");
				$(".split-nonshipping-threshold-free").removeClass("hidden");
		}
		if(orderType == 'DELIVERY' && $(".isSplitCartFulfilment").val()=='true'){
					isShippingHubOnly = "false";
					$(".split-shipping-threshold-free").addClass("hidden");
				$(".split-nonshipping-threshold-free").removeClass("hidden");
				}
		if(orderType == 'PARCEL_SHIPPING' && $(".isSplitCartFulfilment").val()=='true'){
			$("[data-cartentry]").each(function(){
				let target = $(this);
				let entry = Number(target.data("cartentry"));
				let index = target.data("index");
				let pickupEnabled = target.data("pickupenabled");
				let deliveryEnabled = target.data("deliveryenabled");
				if(deliveryEnabled == true || pickupEnabled == true){
					isShippingHubOnly = false;
				}
			})
			}
		if (isShippingHubOnly == "true") {
			$(".branch-pickup").addClass("disabled-fullfillment-method").removeClass("js-fullfilment");
			$(".branch-pickup").removeClass("fullfilment-select");
			$(".pickUpAvail").addClass("hidden");
			$(".pickUpNotAvail").removeClass("hidden");

			$(".local-delivery").addClass("disabled-fullfillment-method").removeClass("js-fullfilment");
			$(".deliveryNotAvail").removeClass("hidden");
			$(".deliveryAvail").addClass("hidden");

			$(".fullfillment-shipping").addClass("fullfilment-select");
			$(".fullfillment-shipping").click();
			if(!$(".js-gc-error-msg").length > 0){
				$(".shippingThreshold-msg").removeClass("hidden");
				$(".split-shipping-threshold-free").removeClass("hidden");
				$(".split-nonshipping-threshold-free").addClass("hidden");
			}
		}


	}
	if($(".page-cartPage").length){
		ACC.cart.showPriceLoader();
	}
	//To show the split/mixed header when shipping only product available  
	ACC.cart.cartEntriesAppend();
});
ACC.cartitem = {

	_autoload: [
		"bindCartItem",
		"disableQtyButton",
		"cartInitiation",
		"cartDeletion",
		"cartIdDetails"
	],
	
	submitTriggered: false,
	disableQtyButton: function () 
    {	
		$('[id^="quantityBoxDisable_"]').each(function() 
		{
			var elementId = $(this).attr('id');
			var itemNumber = elementId.split('_')[1];
			if($('#'+elementId).val() == 'true')
			{
				$("#plusQty_"+itemNumber).prop("disabled", true);
				$("#minusQty_"+itemNumber).prop("disabled", true);
			}
		});
    },
	bindCartItem: function ()
	{
		$('.js-remove-entry-button').on("click", function ()
		{	
			loading.start();
			var entryNumber = $(this).attr('id').split("_");
			var form = $(this).closest("form");

			var productCode = form.find('input[name=productCode]').val();
			var initialCartQuantity = form.find('input[name=initialQuantity]');
			var cartQuantity = form.find('input[name=quantity]');
			
			var productName = form.find('input[name=productName]').val();
			var productCategory = form.find('input[name=productCategory]').val();
			var productSubCategory = form.find('input[name=productSubCategory]').val();	
			var productQty = form.find('input[name=initialQuantity]').val();
			var nearbyProduct= form.find('input[name=productnearbyItem]').val();
			 if(nearbyProduct === ""){
    						  var productNearBy= "true"
    					  }
    					  else{
    						  var productNearBy= "false"
    					  }
			var productfulfillment = $(".changed_selectedFilfillment").val();
			var productStore = $("#analyticsstore").val().split("#")[1];
			var productBackOrdercheck=form.find('input[name=analytics_backourderValueItem]').val();
			var remainingBackOrder= form.find('input[name=remainingQtyItem]').val();
			var productStockStatus=form.find('input[name=productstockStatusItem]').val().replace(/<(.|\n)*?>/g, '');
			if(productBackOrdercheck=="true"){
				var productBackOrder= productQty;
			}
			else if(remainingBackOrder > 0){
				var productBackOrder= remainingBackOrder;
			}
			else{
				var productBackOrder= "";
			}
			var productPrice =form.find('input[name=productpriceItem]').val();
			
			
			if(form.find('input[name=transferableFlagItem]').val()=="false" && form.find('input[name=isStockInNearbyBranchItem]').val()=="true"){
				var productError= "no fulfillment option";
			}
			else{
				var productError= "";
			}
			cartRemoveAnalytics(productCode, productName, productCategory, productSubCategory,productNearBy,productQty,productfulfillment,productStore,productBackOrder,productPrice,productStockStatus,productError);

			ACC.track.trackRemoveFromCart(productCode, initialCartQuantity.val());

			cartQuantity.val(0);
			initialCartQuantity.val(0);
			if ($('#isAnonymous').val() == "false"){
       			var deletedCartID= $("#currentCartId").val();
            	}
          	  else{
          		var deletedCartID= $("#anonymousCartId").val();
          	  }
			if($("input[id=cartItemsCountVar]").val() >=1) {
				digitalData.eventData = {
						deletedCartId: deletedCartID,
						linktype:"",
	                	linkName: "Remove",
	                	onClickPageName: "checkout:cart",
             	};
				if ($("input[id=cartItemsCountVar]").val() == 1) {
					try {
						_satellite.track("cartDelete");
					} catch (e) { }
				}
				else {
					try {
						_satellite.track("Remove Cart");
					} catch (e) { }
				}
			}
			form.submit();
		});
		$('.js-remove-entry-button a').on('click', function(e) {
			e.preventDefault();
		});
		$('.js-update-entry-quantity-btn').on("click",function(e){
			var max_qty=9999;
			var $target=$(e.target);
			var qty = $(this).parent().children('.js-update-entry-quantity-input').val();
			var form = $target.closest('form');
			var intervalQTY = form.find('input[name=uomintervalqtyCart]').val();
			var intervalValidation = form.find(".intervalQtyInfo_cart").is(":visible");
			if(qty && !isNaN(qty) ){
				qty=Number(qty);
			}else{
				qty=0;
			}
			if($target.hasClass("plusQty")){
				if(qty>=max_qty)
					{
					$target.addClass("disabled")
					}
				else
				{	
					if(intervalQTY > 1 && intervalValidation){
						var currentMultiple = Math.floor(qty / intervalQTY);
						var nextMultiple = currentMultiple + 1;
						qtyVal = nextMultiple * intervalQTY;
						if(qtyVal>=max_qty)
						{
							$target.addClass("disabled")
						}else{
							$(this).prev().val(qtyVal);
						}
					}				
					else{
						$(this).prev().val(qty+1);
					}			
				}
			}else{
				if(qty>0){
					if(intervalQTY > 1 && intervalValidation){
						var isMultiple = qty % intervalQTY === 0;
						var previousMultiple = isMultiple ? qty - intervalQTY : qty - (qty % intervalQTY);
						qtyVal = Math.max(intervalQTY, previousMultiple);
						if(qtyVal>0)
						{
							$(this).next().val(qtyVal);
						}
					}else{
						$(this).next().val(qty-1);
					}		
				}
			}
			$(this).parent().find('.js-update-entry-quantity-input').blur();
			return false;
		});
		$('.js-update-entry-quantity-input').on("blur", function (e)
		{
			ACC.cartitem.handleUpdateQuantity(this, e);

		}).on("keyup", function (e)
		{
			return ACC.cartitem.handleKeyEvent(this, e);
		}
		).on("keydown", function (e)
		{
			return ACC.cartitem.handleKeyEvent(this, e);
		}
		);
		

			  $(".js-update-entry-quantity-input, #quantityId").keypress(function (e) {
				  	var regex = new RegExp("^[0-9]+$");
		        	var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);   
		        	var ignoredKeys = [8,0];
		                if (ignoredKeys.indexOf(e.which) >=0 || regex.test(str)) {   
		        	       return true;
		        	    }       	    
		        	    e.preventDefault();
		        	    return false;
	        });
	        
	},

	handleKeyEvent: function (elementRef, event)
	{
		//console.log("key event (type|value): " + event.type + "|" + event.which);

		if (event.which == 13 && !ACC.cartitem.submitTriggered)
		{
			ACC.cartitem.submitTriggered = ACC.cartitem.handleUpdateQuantity(elementRef, event);
			return false;
		}
		else 
		{
			// Ignore all key events once submit was triggered
			if (ACC.cartitem.submitTriggered)
			{
				return false;
			}
		}

		return true;
	},

	handleUpdateQuantity: function (elementRef, event)
	{

		var form = $(elementRef).closest('form');

		var productCode = form.find('input[name=productCode]').val();
		var initialCartQuantity = form.find('input[name=initialQuantity]').val();
		var newCartQuantity = form.find('input[name=quantity]').val();

		if(initialCartQuantity != newCartQuantity)
		{
			ACC.track.trackUpdateCart(productCode, initialCartQuantity, newCartQuantity);
			
			//bigBagChecker AJAX call
			ACC.cart.ajaxBigboxchecker(productCode,false,"CHECKED",newCartQuantity);
			
			form.submit();

			return true;
		}

		return false;
	},
	
	cartInitiation : function(e){
		if ($(".page-cartPage").length > 0 && $('#cartID').length > 0 && $('#welcomeOverlay').length > 0){
			try {
				_satellite.track("Cart Initiation");
		    } catch (e) {}
		 
		}
	 },
	 
	 cartIdDetails: function(e){
		 
		 if ($('.loginstatus').val() != ''  || $(".page-siteOneCheckoutPage, .page-orderSummaryPage, .page-orderConfirmationPage").length > 0){
			 try {
					_AAData.recentCartId= $("#currentCartId").val();
					_AAData.cartId =$("#currentCartId").val();
				}catch(e){}
		 }
		 else{
			 _AAData.cartId= $("#anonymousCartId").val();
		 }
		  	
	 },
	 
	 
};

functioncartRemoveAnalytics(productCode, productName, productCategory, productSubCategory,productNearBy,productQty,productfulfillment,productStore,productBackOrder,productPrice,productStockStatus,productError) {
    digitalData.cart = [{
        item: {
            productInfo: {
                productID: productCode,
                productName: productName,
                productCategory: productCategory,
                productSubCategory: productSubCategory,
				productSelectedBranch: productNearBy,
				productQty:productQty,
				productfulfillment:productfulfillment,
				productStore:productStore,
				productBackOrder:productBackOrder,
				productPrice:productPrice,
				productStockStatus:productStockStatus,
				productError:productError,
            }
        }
    }];
    console.log("digitalData" + JSON.stringify(digitalData));
}
var analyticsPaymentMethodCheck= false;
ACC.checkout = {

	_autoload: [
		["bindCheckoutEvents", $('.page-siteOneCheckoutPage').length],
		"bindCheckO",
		"bindForms",
		"bindSavedPayments",
		"checkPickUpInfoOrDate",
		"bindOrderType",
		"deliveryModeSelection",
		"bindOrderTypeFormSubmit",
		"countWordsForInstructions",
		"bindAddPhone",
		"bindCaliforniaWarning",
		"binbOrderSubmitMethod",
		"addNewAddressCheckout",
		"bindAddressValidations",
		"bindAddAddressSubmit",
		"bindSelectBranch",
		"checkHomeOwnerCase",
		"bindSearchpopups",
		"bindSearchpopup",
		"bindSaveCard",
		"bindSearchValue",
		"paymentContentLoad",
		"bindSaveCardEnabled",
		"bindSavedCardpopup",
		"bindPayOnAccountValue",
		"bindContactAddressValidations",
		"bindBranchPickupDetails",
		"bindEditFulFilmentDetails",
		"bindGuestUserValue",
		"checkoutStepEmailValidation",
		"nationalShippingChanges"
	],
	bindCheckoutEvents: function(){
		if($("#isGuestCCDisbaled").val() == 'Decline_Limit_Over'){
			ACC.checkout.isGuestCCDisbaled = true;
		}
		ACC.checkout.guestCCDisbale();
	},
	isGuestCCDisbaled: false,
	guestCCDisbale: function(){
		if(ACC.checkout.isGuestCCDisbaled){
			loading.stop();
			ACC.colorbox.open("", {
				html: $(".declineCcGuestError").html(),
				width: "600",
				escKey: false,
				overlayClose: false,
				className: "ccdisable-popup",
				onComplete: function(){

				},
				onClosed: function(){
					window.location.href = ACC.config.encodedContextPath + "/cart";
				}
			});
		}
	},
	b2bAddy1:'',b2bAddy2:'',b2bCity:'',b2bSiteoneState:'',b2bZip:'',siteoneAddJSONData:{},
	checkoutAddressNotSaved: false,
	checkIfFlorida :function(id, errorid, errorPath, errMsg, errStateMsg){
		
        ACC.formvalidation.vaildateShippingState(id, errorid, errorPath, errMsg, errStateMsg);

	},
	addErrorClassForCheckoutForm: function (input, error, errorText, msg)
	{
		$(error).html(msg);
		$(input).css("background", "#fec3c3");
		$(input).css("border-color", "#fd7b7b");
		$(input).parent().css("margin-bottom", "5px");
		$(error).css("color", "#fe0303");
		$(error).css("font-weight", "normal");
		$(errorText).html('');
	},
	
	removeErrorClassForCheckoutForm: function (input, error, errorText)
	{
		//alert("hi");
		$(error).html('');
		$(input).removeAttr('style');
		$(error).removeAttr('style');
		$(input).css("background", "#aaaaaaa");
		$(input).css("border-color", "#cccccc");
		$(input + "\\.errors").hide();
		$(errorText).html('');
	},
	bindSpecialInstruction: function(){
		var ref = $('#specialinstruction');
		ACC.checkout.bigbagSpecialInstruction();
		if (ref.length) {
			let text_length = ref.val().length;
			let text_allowed = ref.prop("maxlength");
			text_allowed = (text_allowed && text_allowed != "")? text_allowed : 300;
			if (text_length && text_length <= text_allowed ) {
				$('#wordcountstaticmessage').html(ACC.config.remaining + (text_allowed - text_length) + ' ' + ACC.config.characters);
				ACC.checkout.removeErrorClassForCheckoutForm('#specialinstruction', '#errorSpecialinstruction', '#specialinstruction\\.errors');
			}
			else if(text_length && text_length > text_allowed ){
				$('#wordcountstaticmessage').html(ACC.config.remaining + (0) + ' ' + ACC.config.characters);
				ACC.checkout.addErrorClassForCheckoutForm('#specialinstruction', '#errorSpecialinstruction', '#specialinstruction\\.errors', 'Special Instruction Error');
			}
			else {
				$('#wordcountstaticmessage').html(ACC.config.remaining + text_allowed + ' ' + ACC.config.characters);
				ACC.checkout.removeErrorClassForCheckoutForm('#specialinstruction', '#errorSpecialinstruction', '#specialinstruction\\.errors');
			}
		}
	},
	countWordsForInstructions: function() {
		$('#specialinstruction').on('keyup', function () {
			ACC.checkout.bindSpecialInstruction();
		});
		ACC.checkout.bindSpecialInstruction();
	},
	checkPONumberReq : function() {
		return new Promise((resolve, reject) => {
			if($("#poNumberReq").length){
				var poNumber = document.getElementById("poNumberReq").value;
				
				$.ajax({
					url: ACC.config.encodedContextPath+"/checkout/multi/order-type/poNumber?poNumber="+poNumber,
					method: "GET",
					success : function(response) {
						if(response == true) {
							$("#isPOValidated").val("true");
						} else {
							$("#isPOValidated").val("false");
						}
						resolve();
					}
				});
			}else{
				resolve();
			}
		});
	},
	bindForms:function(){
		$(document).on("click","#addressSubmit",function(e){
			e.preventDefault();
			$('#addressForm').submit();	
		})
		
		$(document).on("click","#deliveryMethodSubmit",function(e){
			e.preventDefault();
			$('#selectDeliveryMethodForm').submit();	
		})

	},
	
	
	bindSavedPayments:function(){
		$(document).on("click",".js-saved-payments",function(e){
			e.preventDefault();

			var title = $("#savedpaymentstitle").html();

			$.colorbox({
				href: "#savedpaymentsbody",
				inline:true,
				maxWidth:"100%",
				opacity:0.7,
				//width:"320px",
				title: title,
				close:'<span class="glyphicon glyphicon-remove"></span>',
				onComplete: function(){
				}
			});
		})
	},
	
	bindCheckO: function ()
	{
		var cartEntriesError = false;
		
		// Alternative checkout flows options
		$('.doFlowSelectedChange').on('change',function  ()
		{
			if ('multistep-pci' == $('#selectAltCheckoutFlow').val())
			{
				$('#selectPciOption').show();
			}
			else
			{
				$('#selectPciOption').hide();

			}
		});



		$('.js-continue-shopping-button').on('click',function  ()
		{
			var checkoutUrl = $(this).data("continueShoppingUrl");
			window.location = checkoutUrl;
		});
		
		$('.js-create-quote-button').on('click',function  ()
		{
			$(this).prop("disabled", true);
			var createQuoteUrl = $(this).data("createQuoteUrl");
			window.location = createQuoteUrl;
		});

		
		$('.expressCheckoutButton').on('click',function ()
				{
					document.getElementById("expressCheckoutCheckbox").checked = true;
		});
		
		$(document).on("input",".confirmGuestEmail,.guestEmail",function(){
			  
			  var orginalEmail = $(".guestEmail").val();
			  var confirmationEmail = $(".confirmGuestEmail").val();
			  
			  if(orginalEmail === confirmationEmail){
			    $(".guestCheckoutBtn").removeAttr("disabled");
			  }else{
			     $(".guestCheckoutBtn").attr("disabled","disabled");
			  }
		});
		
		$('.js-continue-checkout-button').on('click',function (e)
		{
			if ($('.loginstatus').val() == ''){
				$(".js-continue-checkout-button").addClass("signInOverlayCheckout_guest");
				sessionStorage.setItem('checkoutlogin',$(this).data("checkoutUrl"));
				ACC.cart.userType = "Checkout-Option";
   		} else {
			sessionStorage.removeItem('checkoutlogin');
			var californiaLocation= $("#california_location").val();
			ACC.cart.userType = "Checkout-Signed In";
			try { ACC.cart.cartPageTotal = $(".cart-totals").text().trim().replace('$', '').replaceAll(',', ''); }
			catch { ACC.cart.cartPageTotal = 0 }
			if(californiaLocation === 'CA' && $(".nearbyContinue").val()=="true") {
			
				var checkoutUrl = $(this).data("checkoutUrl");
				$.ajax({
			        success: function(result) {
			        	ACC.cart.prop65Overlay(checkoutUrl);
			        },
			    });
				return false;
			}
			if($(".nearbyContinue").val()=="false" && $(".checkmixedcart").val()=="false" && ($(".changed_selectedFilfillment").val()!='PARCEL_SHIPPING')){
					e.stopImmediatePropagation();
					ACC.cart.nearbyContinue();
					return false;
				}
			else{		
			var checkoutUrl = $(this).data("checkoutUrl");
			var cartEntriesError = ACC.pickupinstore.validatePickupinStoreCartEntires();
			if (!cartEntriesError)
			{
				ACC.cart.ga4AdobeAnalytics(ACC.cart.userType , $(".pagename").val(), [], "scCheckout", $("#cartID").val(), $("#recentCartIds").val(), ACC.cart.cartPageTotal, "signed-in");
				var expressCheckoutObject = $('.express-checkout-checkbox');
				
				if(expressCheckoutObject.is(":checked"))
				{
					window.location = expressCheckoutObject.data("expressCheckoutUrl");
				}
				else
				{
					var flow = $('#selectAltCheckoutFlow').val();
					if ( flow == undefined || flow == '' || flow == 'select-checkout')
					{
						// No alternate flow specified, fallback to default behaviour
						window.location = checkoutUrl;
					}
					else
					{
						// Fix multistep-pci flow
						if ('multistep-pci' == flow)
						{
						flow = 'multistep';
						}
						var pci = $('#selectPciOption').val();

						// Build up the redirect URL
						var redirectUrl = checkoutUrl + '/select-flow?flow=' + flow + '&pci=' + pci;
						window.location = redirectUrl;
					}
				}
			}
			return false;
			
			}
		}});

	},
	pickUpDateClass: '.show-pickupDate-picker',
	checkPickUpInfoOrDate: function(){
		let items = $('.isPickupDateRequired');
		if(items.length && $("#orderType").val() == 'PICKUP'){
			for (let i = 0; i < items.length; i++) {
				if (items.eq(i).val() == 'true') {
					ACC.checkout.pickUpDateClass = '.show-pickupDate-picker'; //reverted from show-pickupDate-message
					break;
				}
			}
			if (ACC.checkout.pickUpDateClass == '.show-pickupDate-picker') { 
				$('.isPickupDateRequired-date').fadeIn();
			}
		}
	},
	bindOrderType:function()
	{
		var radioValue = $("#orderType").val();
		
        if(radioValue == 'PICKUP')
        {
        	$(".delivery--content").hide();
        	$(".pickup--content").show();
			$(ACC.checkout.pickUpDateClass).show();
        	$(".common-content-pickupDelivery").show();
        	$(".delivery-chargesMsg").hide();
        	$(".icon-delivery-charges").hide();
        	$(".message-delivery").hide();
            $(".errorPickupDelivery").hide();
            $(".delivery-details").hide();
            $(".pickup-title").show();
            $(".charges-sec").hide();
            $(".delivery-fee").hide();
            $("#delivery_Details").hide();
            $("#pickup_Details").hide();
            
        }
        else if(radioValue == 'DELIVERY')
        {
        	$(".pickup--content").hide();
			$(ACC.checkout.pickUpDateClass).hide();
        	$(".delivery--content").show();
        	$(".common-content-pickupDelivery").show();
        	$(".delivery-chargesMsg").hide();
        	$(".delivery-details").show();
        	$(".icon-delivery-charges").show();
        	$(".message-delivery").show();
        	$(".errorPickupDelivery").hide();
        	$(".delivery-title").show();
        	$(".pickup-delivery").hide();
        	$(".pick-up-details").hide();
        	$(".delivery-info").hide();
        	$("#delivery_Details").hide();
        	$("#pickup").hide();
        	
        }else{
        	$("#shipping_Details").hide();
        	$(".delivery--content").hide();
        }

        $(".input-dateWrapper").off();
        $(".input-dateWrapper").on("click",function(){$(".input-dateWrapper #date").trigger("focus");});
       
	},

	validateCurrentDate: function()
	{
		var formDate = document.getElementById("date").value;
		var currdate =new Date();
		var formattedCurrDate = ACC.checkout.formatDate(new Date(currdate), 'mdy')
		var today = (formattedCurrDate === formDate);
		if(today)
		{
			if(!ACC.checkout.isAfternoonCheckoutAllowed() )
			{
				document.getElementById("date").value = null;
			}
		}
	},

	validateStoreStatus: function()
	{
		var schedule = JSON.parse(document.getElementsByClassName("openingSchedule")[0].value);
		if(schedule != undefined)
		{
			var weekday = ["Sunday", "Monday", "Tuesday","Wednesday", "Thursday", "Friday", "Saturday"];
			jQuery.each(schedule.weekDayOpeningList, function(i, val)
			{
				if(val.closed)
				{
					if(document.getElementById("date").value != undefined)
					{
						if(val.weekDay == weekday[new Date(document.getElementById("date").value).getDay()])
						{
							document.getElementById("date").value = null;
						}
					}

				}
			});
		}
	},
	

	validateCheckoutFields: function(status)
	{
		var submit = true;
		
		    var orderType = $("#orderType").val();
		    var guestUser = $(".isguestuser").val();
		    if(null == orderType || orderType == "")
		    {
		    	ACC.checkout.addGlobalErrorForPickupDelivery();
		    }
		    else{
		    	
		    	var formDate = document.getElementById("date").value;
				var currdate =new Date();
				var formattedCurrDate = ACC.checkout.formatDate(new Date(currdate), 'mdy');
				var today = (formattedCurrDate === formDate);
				
				if(today)
				{
					if(!ACC.checkout.isAfternoonCheckoutAllowed())
					{
						$('#AM[value="AM"]').removeAttr('checked', 'checked');
						$('#AM[value="AM"]').attr('disabled', 'disabled');
					}
				}
				else
				{
					$('#AM[value="AM"]').removeAttr('disabled', 'disabled');
				}

				ACC.checkout.validateCurrentDate();

				if(orderType == 'PICKUP')
				{
					ACC.checkout.validateStoreStatus();
				}
				
				var date = document.getElementById("date").value;
				var isPastDate = false;
				if(null == date || date == "")
				{
				   	ACC.checkout.addErrorClassForCheckoutForm('#date', '#errorDate', '#date\\.errors', ACC.config.selectDeliveryPickup+'<div class="cl"></div>');
			    
				}
				else if (new Date(formDate) < new Date(formattedCurrDate)) {
					isPastDate = true;
					if(orderType == "PICKUP") {
						ACC.checkout.addErrorClassForCheckoutForm('#date', '#errorDate', '#date\\.errors', ACC.config.selectedPastPickupDate+'<div class="cl"></div>');
					}
					else if(orderType == "DELIVERY") {
						ACC.checkout.addErrorClassForCheckoutForm('#date', '#errorDate', '#date\\.errors', ACC.config.selectedPastDeliveryDate+'<div class="cl"></div>');
					}
				}
			    else{
			    	ACC.checkout.removeErrorClassForCheckoutForm('#date', '#errorDate', '#date\\.errors');
				}
				var isPONumberRequired = document.getElementById("poNumberRequired").value;
				if(isPONumberRequired == "true")
				{
					var poNumber = document.getElementById("poNumberReq").value;
					if(null == poNumber || poNumber == "")
					{
						ACC.checkout.addErrorClassForCheckoutForm('#poNumberReq', '#errorPONumberRequired', '#poNumberReq\\.errors', "Please enter a valid PO number. Call your company purchasing department if you need assistance.");
					}
					else
					{
						var isPOValidated = $("#isPOValidated").val();
						if(null != isPOValidated && isPOValidated == "true" )
						{
							ACC.checkout.removeErrorClassForCheckoutForm('#poNumberReq', '#errorPONumberRequired', '#poNumberReq\\.errors');

						}
						else
						{
							ACC.checkout.addErrorClassForCheckoutForm('#poNumberReq', '#errorPONumberRequired', '#poNumberReq\\.errors', "Please enter a valid PO number. Call your company purchasing department if you need assistance.");
						}
					}
				}

				var radioValue = $("input[name='requestedMeridian']:checked").val();
				if(null == radioValue)
			    {
			       	ACC.checkout.addErrorClassForCheckoutForm('#meridianRadio', '#errorMeridianRadio', '#meridianRadio\\.errors', ACC.config.selectMeridian+'<div class="cl"></div>');
			    }
			    else{
			    	ACC.checkout.removeErrorClassForCheckoutForm('#meridianRadio', '#errorMeridianRadio', '#meridianRadio\\.errors');
				}
			
				if($("#termsAndConditions").prop("checked") == false)
		        {
		        	$(".cr").addClass("error-div");
			    	$(".cr").click(function(){
			    		$(".cr").removeClass("error-div");
			    		});
		        	ACC.checkout.addErrorClassForCheckoutForm('#termsAndConditions', '#errorTermsAndConditionsCheckBox', '#termsAndConditions\\.errors', '<div class="cl"></div>'+ACC.config.termsAndConditions+'<div class="cl"></div>');
			    }
			    else
			    {
			    	ACC.checkout.removeErrorClassForCheckoutForm('#termsAndConditions', '#errorTermsAndConditionsCheckBox', '#termsAndConditions\\.errors');
			    	
				}
				
				if(guestUser == 'false' && orderType == "DELIVERY"){
					var address = $('#deliveryAddress').find(":selected").val();
		        	if(!ACC.checkout.checkoutAddressNotSaved && $("#deliveryAddress").val()== "selectDefault")
		            {
		        		$("#deliveryAddress").addClass("error-div");
				    	$("#deliveryAddress").click(function(){
				    		$("#deliveryAddress").removeClass("error-div");
				    		});
		            	ACC.checkout.addErrorClassForCheckoutForm('#deliveryAddress', '#errorDeliveryAddressRadio', '#deliveryAddress\\.errors', ACC.config.selectDeliveryAddressToContinue+'.<div class="cl"></div><br/><br/>');
				    }
				    else{
				    	ACC.checkout.removeErrorClassForCheckoutForm('#deliveryAddress', '#errorDeliveryAddressRadio', '#deliveryAddress\\.errors');
					}
		         }
				 else{
					if(guestUser == "false" && orderType == "PICKUP"){
						if(!ACC.checkout.checkoutAddressNotSaved && $("#splitDeliveryAddress").val()== "selectDefault")
							{
								$("#splitDeliveryAddress").addClass("error-div");
								$("#splitDeliveryAddress").click(function(){
									$("#splitDeliveryAddress").removeClass("error-div");
								});
								ACC.checkout.addErrorClassForCheckoutForm(".deliveryError",".deliveryError",'.deliveryError\\.errors', ACC.config.selectDeliveryAddressToContinue + '<div class="cl"></div>');
							}
							else{
								ACC.checkout.removeErrorClassForCheckoutForm('.deliveryError','.deliveryError','.deliveryError\\.errors');
							}
					}
					
				 }
				if(isPONumberRequired == "true")
				{
					if(orderType == "DELIVERY" && guestUser == 'false'){
						
						if((date != "" && !isPastDate)&&(null != radioValue)&& (null != isPOValidated && isPOValidated == "true") && (ACC.checkout.checkoutAddressNotSaved || $("#deliveryAddress").val()!= "selectDefault") && ($("#termsAndConditions").prop("checked") != false))
							{
									submit=false;
							}
						
					}else{
						if((date != "" && !isPastDate)&&(null != radioValue)&& (null != isPOValidated && isPOValidated == "true") && (ACC.checkout.checkoutAddressNotSaved || $("#splitDeliveryAddress").val()!= "selectDefault") && ($("#termsAndConditions").prop("checked") != false))
							{
									submit=false;
							}
					}
						
					}
					else{
						if(orderType == "DELIVERY" && guestUser == 'false'){
							
							
							if((date != "" && !isPastDate)&&(null != radioValue) && (ACC.checkout.checkoutAddressNotSaved || $("#deliveryAddress").val()!= "selectDefault") && ($("#termsAndConditions").prop("checked") != false))
							{
									submit=false;
							}
							
						}else{
							if((date != "" && !isPastDate)&&(null != radioValue) && (ACC.checkout.checkoutAddressNotSaved || $("#splitDeliveryAddress").val()!= "selectDefault") &&($("#termsAndConditions").prop("checked") != false))
							{
										submit=false;
							}
						}
						
					}
				// Bulk Delivery message check in checkout page start
				if($("#showAllDayOptions").val() == "true" && $("#specialinstruction").val().trim()==""){
					submit=true;
					ACC.checkout.addErrorClassForCheckoutForm('#specialinstruction', '#errorSpecialinstruction', '#specialinstruction\\.errors', ACC.config.messageForBranchAndDeliveryRequired);
				}
				// Bulk Delivery message check in checkout page end
				}
				
		    return submit; 
	},

	
	
	addGlobalErrorForPickupDelivery: function ()
	{
		if (($('.global-alerts > div.alert:contains("Please")').length == 0) && ($('.global-alerts > div.alert:contains("Cor")').length == 0))
		{
			
			$(".errorPickupDelivery").append("<div class='global-alerts container-lg container-fluid'>	<div class='alert alert-box alert-dismissable edit-user-alert'>" +
			 
			"<div class='msg alert-msg-text'>"+ACC.config.globalCorrectErrors+"</div></div></div>");
			$('html, body').animate({
			                scrollTop: $(".container").offset().top
			            }, 0);
		}
		else
		{
			$(".global-alerts").show();
			$('html, body').animate({
			                scrollTop: $(".container").offset().top
			            }, 0);
		}
	},
	bindBranchPickupDetails: function(){
		$(document).on("click","#branch_pickup_details_tab",function(e)
		{
			e.preventDefault();
    	    $.ajax({
    	            url : ACC.config.encodedContextPath +"/checkout/multi/branchPickUpDetails",
    	            method:"GET",
    	            success : function(response)
    	            {
    	            	$("#pickup-delivery").show();
	        			$("#termsPODiv").show();
	        			$(".direction-link").show();
	        			$(".edit-pickup-information").hide();
	        			 $(".input-dateWrapper").off();
	        		     $(".input-dateWrapper").on("click",function(){$(".input-dateWrapper #date").trigger("focus");});
    	            	window.location.href=ACC.config.encodedContextPath +response;
    	           
    	            }
    	    });
			
		});
	},
	formatDate:function (date, format)
	{
		  var monthNames = [
		    "January", "February", "March",
		    "April", "May", "June", "July",
		    "August", "September", "October",
		    "November", "December"
		  ];

		  var day = date.getDate();
		  var monthIndex = date.getMonth();
		  var month = date.getMonth() + 1;
		  var year = date.getFullYear();
		  var month = monthIndex + 1;

		  if(null != format && format == 'mdy')
		  {
			  return monthNames[monthIndex] + ' ' + day + ', ' + year;
		  }
		  else if(null != format && format == 'display')
		  {
			  return monthNames[monthIndex] + ' ' + day + ', ' + year;
		  }
		  else
		  {
			  return monthNames[monthIndex] + ' ' + day;
		  }
	},

	dateSchedule: function()
	{
		var dayArray=new Array();
		var schedule = JSON.parse(document.getElementsByClassName("openingSchedule")[0].value);
		if(schedule != undefined)
		{
			jQuery.each(schedule.weekDayOpeningList, function(i, val)
			{
				if(val.closed)
				{
					if(val.weekDay == "Sunday")
					{
						dayArray[0]=0;
					}
					else
					{
						dayArray[i+1]=i+1;
					}
				}
				else
				{
					if(val.weekDay == "Sunday")
					{
						dayArray[0]=9;
					}
					else
					{
						dayArray[i+1]=9;
					}
				}
			 });
			return dayArray;
		}
	},
	
	 populateContactAddress:function(contact){
		    if(contact != null && contact != '' && contact != undefined)
					{
						var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
						
						jQuery.each(customers, function(i, val)
						{
							if(val.displayUid === contact)
							{
								if(val.contactNumber != null && val.contactNumber != '' && val.contactNumber != undefined)
								{
									$(".delivery-phone").html("m: <a class='tel-phone' href='tel:"+val.contactNumber+"'>"+val.contactNumber+"</a>");
								}
								else
								{
									$(".delivery-phone").html("m: NA");
								}
							}
						 });
						
						
					}
		    }, 
	checkMissingBranchHours: function()
	{
		let isMissingBranchHours = true;
		var schedule = JSON.parse(document.getElementsByClassName("openingSchedule")[0].value);
		for (let i = 0; i < schedule.weekDayOpeningList.length; i++) {
			if(!schedule.weekDayOpeningList[i].closed){
				isMissingBranchHours = false;
				break;
			}
		}
		if(isMissingBranchHours){
			ACC.checkout.datepickerMinDate = 9;
			let newTiming = [true, false, false, false, false, true, true];
			document.getElementsByClassName("openingSchedule")[0].value = '{"code":"siteone-standard-hours-57","weekDayOpeningList":[{"weekDay":"Monday","closed":' + newTiming[0] + '},{"weekDay":"Tuesday","closed":' + newTiming[1] + '},{"weekDay":"Wednesday","closed":' + newTiming[2] + '},{"weekDay":"Thursday","closed":' + newTiming[3] + '},{"weekDay":"Friday","closed":' + newTiming[4] + '},{"weekDay":"Saturday","closed":' + newTiming[5] + '},{"weekDay":"Sunday","closed":' + newTiming[6] + '}],"specialDayOpeningList":[]}';
		}
	},
	datepickerMinDate: 1,
	deliveryModeSelection: function()
    {	
		// Parses "YYYY-MM-DD" as a local Date
		function parseLocalDate(isoDate) {
			const parts = isoDate.split('-'); // ["2025", "07", "03"]
			return new Date(Number(parts[0]), Number(parts[1]) - 1, Number(parts[2]));
		}
		// Backend holiday string (note it's a string, not an actual array)
		var HolidayDatesStr = $(".siteoneHolidays").val();
		// Wrap the dates in quotes and parse into an array of strings
		var HolidayDates = [];
		if(HolidayDatesStr){
			HolidayDates = JSON.parse(HolidayDatesStr.replace(/(\d{4}-\d{2}-\d{2})/g, '"$1"'));
		}
		// Create a Set of date strings in "YYYY-MM-DD" format
		var holidaySet = new Set(HolidayDates.map(function(dateStr) {
			const preferredLocalDate = parseLocalDate(dateStr);
			return preferredLocalDate.getFullYear() + '-' + (preferredLocalDate.getMonth() + 1).toString().padStart(2, '0') + '-' + preferredLocalDate.getDate().toString().padStart(2, '0');
		}));
		if($("#pageId").val() == 'siteOneCheckoutPage')
		{
			//ACC.checkout.checkMissingBranchHours();Removed checking missing branch hours logic as per SE-25190.
			var dateschedulearray = new Array();
			dateschedulearray = ACC.checkout.dateSchedule();
			var todaysDate = new Date();
			var tomorrow = new Date();
			var orderType = $("#orderType").val();
			tomorrow.setDate(tomorrow.getDate() + 1);
			if(orderType == 'PICKUP'){
				if(!ACC.checkout.isAfternoonCheckoutAllowed() || (!ACC.checkout.isMorningCheckoutAllowed() && ACC.checkout.isHalfDay(todaysDate))|| ((todaysDate.getDay() == 6 || todaysDate.getDay() == 0) && tomorrow.getDate() == 1) || (todaysDate.getDay() == 6 && tomorrow.getDate == 31)){
					ACC.checkout.datepickerMinDate = 1;
				}
				else if(ACC.checkout.isMorningCheckoutAllowed() || (ACC.checkout.isAfternoonCheckoutAllowed() && !ACC.checkout.isHalfDay(todaysDate))){
					ACC.checkout.datepickerMinDate = 0;
				}
				$("#date").datepicker({minDate: ACC.checkout.datepickerMinDate, maxDate:new Date(2100,11,31), dateFormat: "MM dd yy ",
					beforeShowDay: function (date) {
						var day = date.getDay();
						var dateStr = date.getFullYear() + '-' + (date.getMonth() + 1).toString().padStart(2, '0') + '-' + date.getDate().toString().padStart(2, '0');
						var isHoliday = holidaySet.has(dateStr);
						var isClosed = (day == dateschedulearray[day]);

						// Disable the date if it's a closed weekday or a holiday
						return [!isClosed && !isHoliday];
					}
				});
			}
			else if (orderType == 'DELIVERY') { 
				let maxdate = new Date(2100, 11, 31);
				if ($("#bulkdelivery").val() == "true") {
					ACC.checkout.datepickerMinDate = 4;
					maxdate = 17;
				} else { 
					if (todaysDate.getDay() == 6) {
						ACC.checkout.datepickerMinDate = 2;
					}
					else if (todaysDate.getDay() == 0) {
						ACC.checkout.datepickerMinDate = 1;
					}
					else {
						if (ACC.checkout.isHalfDay(todaysDate)) {
							ACC.checkout.datepickerMinDate = 1;
						} else {
							if (ACC.checkout.isOrderPlacedBefore9()) {
								ACC.checkout.datepickerMinDate = 0;
								if (((todaysDate.getDay() == 6 || todaysDate.getDay() == 0) && tomorrow.getDate() == 1) || (todaysDate.getDay() == 6 && tomorrow.getDate == 31)) {
									ACC.checkout.datepickerMinDate = 1;
								}
							} else {
								ACC.checkout.datepickerMinDate = 1;
							}
						}
					}
				}
				
				$("#date").datepicker({minDate: ACC.checkout.datepickerMinDate, maxDate: maxdate, dateFormat: "MM dd yy ",
					beforeShowDay: function (date) {
						var day = date.getDay();
						var dateStr = date.getFullYear() + '-' + (date.getMonth() + 1).toString().padStart(2, '0') + '-' + date.getDate().toString().padStart(2, '0');
						var isHoliday = holidaySet.has(dateStr);
						var isClosed = (day == dateschedulearray[day]);

						// Disable the date if it's a closed weekday or a holiday
						return [!isClosed && !isHoliday];
					}
				});
			}
			ACC.checkout.bindOrderType();

			var contact = null;
			if(null != $('#contactId').val() || $('#contactId').val() != "")
			{
			  contact = $('#contactId').val();
			}
			else
			{
			  contact = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value).displayUid;
			}

			ACC.checkout.populateContactDetails(contact);

			if(null != $('#addressId').val() && $('#addressId').val() != "")
			{
			  ACC.checkout.populateAddressDetails($('#addressId').val());
			}
			else
			{
			  var selectedValue = $('#deliveryAddress').find(":selected").val();
			  if(selectedValue != 'selectDefault')
			  {
				  $('#addressId').val(selectedValue);
				  ACC.checkout.populateAddressDetails($('#addressId').val());
			  }
			  else
			  {
				  $('.delivery-phone').html('');
			  }

			}
			ACC.checkout.removeErrorClassForCheckoutForm('#deliveryAddressRadio', '#errorDeliveryAddressRadio', '#deliveryAddressRadio\\.errors');
			if($('.isSplitCartCheckoutPickup').val() == 'true'){
				ACC.checkout.populateAddressDetails($('#splitDeliveryAddress').val());
			}
			
		}

		
		
		$(document.body).on("input blur","#poNumberReq",function()
				{
					ACC.checkout.removeErrorClassForCheckoutForm('#poNumberReq', '#errorPONumberRequired', '#poNumberReq\\.errors');
				});
	
		$(document.body).on("change",".requested-time",function()
		{
			ACC.checkout.removeErrorClassForCheckoutForm('#meridianRadio', '#errorMeridianRadio', '#meridianRadio\\.errors');
		});
		
		$(document.body).on("click",".saveCustomerSelection",function()
		{
			var selectedValue = $('#customers').find(":selected").val();
			$('#contactId').val(selectedValue);
			ACC.checkout.populateContactDetails(selectedValue);
			ACC.colorbox.close();
		});
		
		
		$(document.body).on("click",".saveCustomerSelectionB2bUser",function(e)
				{
					var selectedValue = $('#customers').find(":selected").val();
				
					  e.preventDefault();
			    	    $.ajax({
			    	            url : ACC.config.encodedContextPath + "/checkout/multi/update-contact?uid=" + selectedValue,
			    	            method:"POST",
			    	          
			    	            success : function(response)
			    	            {
			    	            	$('#contactId').val(selectedValue);
			    					ACC.checkout.populateContactDetails(selectedValue);
			    					ACC.colorbox.close();
			    					$(".data-update").hide();
			    	            }
			    	    })
					
					
					
					//ACC.checkout.enableDisableContinueButton();
				});
		
		$(document).on("change","#deliveryAddress",function()
		{	
			ACC.checkout.checkoutAddressNotSaved = false;
			ACC.checkout.removeErrorClassForCheckoutForm('#deliveryAddress', '#errorDeliveryAddressRadio', '#deliveryAddress\\.errors');
			var selectedValue = $('#deliveryAddress').val();
			$('#addressId').val(selectedValue);
			ACC.checkout.populateAddressDetails($('#addressId').val());
			var orderType = $("#orderType").val();
			var state = $(".delivery-region").html();
			if(orderType === "PARCEL_SHIPPING" && (state!=_AAData.storeState)){
				var b2bSelectmsg = ERRORMSG.global.address;			
				var b2bSelectstateMsg = ERRORMSG.global.shippingStates;
				ACC.checkout.checkIfFlorida('#deliveryAddress', '#errorDeliveryAddressRadio', '#deliveryAddress\\.errors', b2bSelectmsg, b2bSelectstateMsg)
			}
			
			var contact = $('#contactId').val();
			
			ACC.checkout.populateContactAddress(contact);
			//ACC.checkout.enableDisableContinueButton();
		});
 	   $(document).on("change","#splitDeliveryAddress",function(){
		var selectedValue = $('#splitDeliveryAddress').val();
		$('#shippingAddressId, #addressId').val(selectedValue);
		ACC.checkout.populateAddressDetails($('#shippingAddressId').val());
	   });
		$(document).on("change","#customers",function()
		{	
			var selectedValue = $('#customers').find(":selected").val();
			var selectedCustomer = null;
			if(document.getElementsByClassName("allCustomers")[0].value != "")
			{
				var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
				jQuery.each(customers, function(i, val)
				{
					if(val.displayUid === selectedValue)
					{
						selectedCustomer = val;
					}
				 });
			 }
			else
			{
					selectedCustomer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
			}
			
			if(null != selectedCustomer)
			{
				if(selectedCustomer.contactNumber == undefined)
				{
					var details = selectedCustomer.name + "<BR>m: " + "NA" + "<BR>" + selectedCustomer.displayUid;
					 $(".popup-contact-details").html(details);
				}
				else
				{
					 var details = selectedCustomer.name + "<BR>m: " + selectedCustomer.contactNumber + "<BR>" + selectedCustomer.displayUid;
					 $(".popup-contact-details").html(details);
				}
			}
			//ACC.checkout.enableDisableContinueButton();
		});
		
		$(document.body).on("click",".changeContact",function(e)
		{
			try{
					 _satellite.track('contactDetails');
					} catch (e) {}
			e.preventDefault();
			if(document.getElementsByClassName("allCustomers")[0].value != "")
			{
			    var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
				var option = null;
				var selectedCustomerVal = null;
				var selectedCustomer = $("#contactId").val();
				var orderType = this.id;
				var orderTypeDisplayText = "";
				if(orderType == 'pickUpChangeContact') {
					orderTypeDisplayText = "Pickup contact1";
				} else {
					orderTypeDisplayText = "Delivery contact";
				}
				
				jQuery.each(customers, function(i, val)
				{
					if(null != selectedCustomer && selectedCustomer != "" && val.email === selectedCustomer)
	            	{
						selectedCustomerVal = val;
						if(null != option)
						{
							option = option + '<option value="' + val.email + '"selected>' + val.name + '</option>';
						}
						else
						{
							option = '<option value="' + val.email + '"selected>' + val.name + '</option>';
						}
	            	}
					else
					{
						if(null != option)
						{
							option = option + '<option value="' + val.email + '">' + val.name + '</option>';
						}
						else
						{
							option = '<option value="' + val.email + '">' + val.name + '</option>';
						}
					}
				});
			}
			else
			{
				var customer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
				var option = null;
				var selectedCustomerVal = null;
				var selectedCustomer = customer;
				var orderType = this.id;
				var orderTypeDisplayText = "";
				if(orderType == 'pickUpChangeContact') {
					orderTypeDisplayText = "Pickup contact";
				} else {
					orderTypeDisplayText = "Delivery contact";
				}
				if(null != selectedCustomer && selectedCustomer != "" && customer.displayUid === selectedCustomer)
                {
						selectedCustomerVal = customer;
						if(null != option)
						{
							option = option + '<option value="' + customer.displayUid + '"selected>' + customer.name + '</option>';
						}
						else
						{
							option = '<option value="' + customer.displayUid + '"selected>' + customer.name + '</option>';
						}
			     }
				else
				{
					if(null != option)
					{
						option = option + '<option value="' + customer.displayUid + '">' + customer.name + '</option>';
					}
					else
					{
						option = '<option value="' + customer.displayUid + '">' + customer.name + '</option>';
					}
				}
			}
				var selectBox = "<select id='customers' class='form-control'>" + option + "</select>";
				if(null == selectedCustomerVal)
				{
					selectedCustomerVal = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
				}
				
				var details = selectedCustomerVal.name  + (selectedCustomerVal.contactNumber?"<BR>m: "+selectedCustomerVal.contactNumber:"<BR>m: NA " )+ "<BR>" +selectedCustomerVal.displayUid;
				if($(window).width()<=800){
					$("#colorbox #cboxMiddleLeft").remove();
					$("#colorbox #cboxMiddleRight").remove();
					
				}
				$.colorbox({
				html: "<div class='PopupBox pickOrDelivery-changeContact'>" +
						"<label for='customers'>" + orderTypeDisplayText  + "<br></label><div class='pickupContact'>" + selectBox +"</div><br/>" +
						"</div> " +
						"<div class='popup-contact-details'> "+ details + "</div>" +
						"<div class='row'>" +
						"<div class='confrimbtnBox col-xs-12 col-md-6 col-sm-12'>" +
						"<button type='button' id='save' class='saveCustomerSelection btn btn-ConfirmMessage btn-primary btn-block'>"+ACC.config.save+"</button>" +
						"</div>" +
						"<div class='confrimbtnBox  col-xs-12 col-md-6 col-sm-12'>" +
						"<button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >"+ACC.config.cancel+"</button>" +
						"</div>" +
						"</div>" ,
				maxWidth:"100%",
				width:"600px",
				maxHeight:"100%",
				overflow:"auto",
				opacity:0.7,
				title:"<h1 class='headline'>"+ACC.config.selectAnotherContact+"</h1>",
				close:'<span class="glyphicon glyphicon-remove"></span>',
				onComplete: function(){
					$("#colorbox").addClass("change-contact-colorbox");
					$("#colorbox").removeClass("addAddress-checkout");
					$("body").css("overflow-y", "hidden");
				},
				onClosed: function(){
					$("body").css("overflow-y", "auto");
					$("#colorbox").removeClass("change-contact-colorbox");
				}
				
				});
				
			//ACC.checkout.enableDisableContinueButton();
		});
		
		$(document.body).on("click",".changeContactb2b",function(e)
				{
			try{
					 _satellite.track('contactDetails');
					} catch (e) {}
					e.preventDefault();
					if(document.getElementsByClassName("allCustomers")[0].value != "")
					{
					    var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
						var option = null;
						var selectedCustomerVal = null;
						var selectedCustomer = $("#contactId").val();
						var orderType = this.id;
						var orderTypeDisplayText = "";
						if(orderType == 'pickUpChangeContact') {
							orderTypeDisplayText = "Pickup contact1";
						} else {
							orderTypeDisplayText = "Delivery contact";
						}
						
						jQuery.each(customers, function(i, val)
						{
							if(null != selectedCustomer && selectedCustomer != "" && val.email === selectedCustomer)
			            	{
								selectedCustomerVal = val;
								if(null != option)
								{
									option = option + '<option value="' + val.email + '"selected>' + val.name + '</option>';
								}
								else
								{
									option = '<option value="' + val.email + '"selected>' + val.name + '</option>';
								}
			            	}
							else
							{
								if(null != option)
								{
									option = option + '<option value="' + val.email + '">' + val.name + '</option>';
								}
								else
								{
									option = '<option value="' + val.email + '">' + val.name + '</option>';
								}
							}
						});
					}
					else
					{
						var customer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
						var option = null;
						var selectedCustomerVal = null;
						var selectedCustomer = customer;
						var orderType = this.id;
						var orderTypeDisplayText = "";
						if(orderType == 'pickUpChangeContact') {
							orderTypeDisplayText = "Pickup contact";
						} else {
							orderTypeDisplayText = "Delivery contact";
						}
						if(null != selectedCustomer && selectedCustomer != "" && customer.displayUid === selectedCustomer)
		                {
								selectedCustomerVal = customer;
								if(null != option)
								{
									option = option + '<option value="' + customer.displayUid + '"selected>' + customer.name + '</option>';
								}
								else
								{
									option = '<option value="' + customer.displayUid + '"selected>' + customer.name + '</option>';
								}
					     }
						else
						{
							if(null != option)
							{
								option = option + '<option value="' + customer.displayUid + '">' + customer.name + '</option>';
							}
							else
							{
								option = '<option value="' + customer.displayUid + '">' + customer.name + '</option>';
							}
						}
					}
						var selectBox = "<select id='customers' class='form-control'>" + option + "</select>";
						if(null == selectedCustomerVal)
						{
							selectedCustomerVal = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
						}
						
						var details = selectedCustomerVal.name  + (selectedCustomerVal.contactNumber?"<BR>m: "+selectedCustomerVal.contactNumber:"<BR>m: NA " )+ "<BR>" +selectedCustomerVal.displayUid;
						if($(window).width()<=800){
							$("#colorbox #cboxMiddleLeft").remove();
							$("#colorbox #cboxMiddleRight").remove();
							
						}
						$.colorbox({
						html: "<div class='PopupBox pickOrDelivery-changeContact'>" +
								"<label for='customers'>" + orderTypeDisplayText  + "<br></label><div class='pickupContact'>" + selectBox +"</div><br/>" +
								"</div> " +
								"<div class='popup-contact-details'> "+ details + "</div>" +
								"<div class='row'>" +
								"<div class='confrimbtnBox col-xs-12 col-md-6 col-sm-12'>" +
								"<button type='button' id='save' class='saveCustomerSelectionB2bUser btn btn-ConfirmMessage btn-primary btn-block'>"+ACC.config.save+"</button>" +
								"</div>" +
								"<div class='confrimbtnBox  col-xs-12 col-md-6 col-sm-12'>" +
								"<button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >"+ACC.config.cancel+"</button>" +
								"</div>" +
								"</div>" ,
						maxWidth:"100%",
						width:"600px",
						maxHeight:"100%",
						overflow:"auto",
						opacity:0.7,
						title:"<h1 class='headline'>"+ACC.config.selectAnotherContact+"</h1>",
						close:'<span class="glyphicon glyphicon-remove"></span>',
						onComplete: function(){
							$("#colorbox").addClass("change-contact-colorbox");
							$("#colorbox").removeClass("addAddress-checkout");
							$("body").css("overflow-y", "hidden");
						},
						onClosed: function(){
							$("body").css("overflow-y", "auto");
							$("#colorbox").removeClass("change-contact-colorbox");
						}
						
						});
						
					//ACC.checkout.enableDisableContinueButton();
				});
				
		
		$(document.body).on("change","#termsAndConditions",function()
		{
			//ACC.checkout.enableDisableContinueButton();
			ACC.checkout.removeErrorClassForCheckoutForm('#termsAndConditions', '#errorTermsAndConditionsCheckBox', '#termsAndConditions\\.errors');
		});
		
		 $(document).on("click","#termsAndConditionsPopup", function(e){
			    window.scrollTo(0,0);
			    e.preventDefault();
		        var url = ACC.config.encodedContextPath + "/checkout/multi/termsandcondition";
		        loading.start();
		        ACC.colorbox.open("",{
		            href: url,
		            maxWidth:"100%",
		            width:"621px",
		            overflow:"hidden",
		            height:"650px",
		            initialWidth :"380px",
		            onComplete:function(){ 
	                    loading.stop();
	                    $("#colorbox").addClass("termsAndConditionsBox");
	                },
	                onClosed: function(){
				       $("#colorbox").removeClass("termsAndConditionsBox");
					}
		        });
		    });
		 
		 $(document).on("click", ".termsAndConditionsClose", function()
		 {
	 			ACC.colorbox.close();
		 });
    },
    
   
    populateContactDetails:function(contact)
    {
    	var selectedCustomer = null;
    	if(document.getElementsByClassName("allCustomers")[0].value != "")
    	{
		var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
        
        jQuery.each(customers, function(i, val)
		{
	       	if(val.email === contact)
	       	{
	       		selectedCustomer = val;
	       	}
		});
    	}
    	else
    	{
    		selectedCustomer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
    	}
        
        if(null == selectedCustomer)
		{
        	selectedCustomer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
		}
        
        if(selectedCustomer.contactNumber == undefined)  
        {
        	var details = selectedCustomer.name + "<BR><span id='contactPhoneDetails'>M " + "NA" + "</span><BR>" + selectedCustomer.displayUid;
    	    $(".contact-details").html(details);
    	    
    	    $("#addPhoneMessage").show();
    	    $("#isContactRequirePhoneNumber").val("Y");
    	    $("#isAddPhoneNumberUsed").val("N");
    	    if($("#addressId").val() != null && $("#addressId").val() != undefined && $("#addressId").val() != "")
    	    {
    	    	$(".delivery-phone").html("MNA");
    	    }
    	    
        }
        else
        {
	        var details = selectedCustomer.name + "<BR>M <a class='tel-phone' href='tel:"+selectedCustomer.contactNumber+"'>"+selectedCustomer.contactNumber+"</a><BR>" + "<a href='mailto:"+selectedCustomer.displayUid+"'>"+selectedCustomer.displayUid+"</a>";
		    $(".contact-details").html(details);
		    $("#isContactRequirePhoneNumber").val("N");
		    $("#addPhoneMessage").hide();		
		    if($("#addressId").val() != null && $("#addressId").val() != undefined && $("#addressId").val() != "")
    	    {
		    	$(".delivery-phone").html("M <a class='tel-phone' href='tel:"+selectedCustomer.contactNumber+"'>"+selectedCustomer.contactNumber+"</a>");
    	    }
		    
        }
	},
	
	populateAddressDetails:function(address)
    {
		var selectedAddress = null;
		var addresses=[];
		var selectedCustomer = null;
		try{
			addresses= JSON.parse(document.getElementsByClassName("deliveryAddresses")[0].value);
			selectedCustomer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
		}catch(e){
			addresses=[];
			console.log("JSON parse error");
		}
        
        jQuery.each(addresses, function(i, val)
		{
        	if(val.id === address)
	       	{
	       		selectedAddress = val;
				selectedCustomer = val;
	       	}
		});
	    if(null != selectedAddress)
	    {
	    var region="";
	    var fullName=""
	    if(selectedAddress.region && selectedAddress.region.isocodeShort){
	    	region= selectedAddress.region.isocodeShort ;
	    }
	    if(selectedAddress.title){
	    	fullName+=selectedAddress.title + ". ";
	    }
	    if(selectedAddress.firstName){
	    	fullName+=selectedAddress.firstName + " ";
	    }
	    if(selectedAddress.lastName){
	    	fullName+=selectedAddress.lastName;
	    }
	    if(fullName){
	    	fullName+=fullName+"<BR>";
	    }
	   // if(selectedAddress.phone){
	   // 	phone="m: " + "<a class='tel-phone' href='tel:" +selectedAddress.phone + "'>" + selectedAddress.phone + "</a>" + "<BR>";
	   // }
	      var details = fullName
	      			  + selectedAddress.line1 + "<BR>" 
	      			  + selectedAddress.town + ", "
	      			  + region + " " + selectedAddress.postalCode + "<BR>"
					  + "<div class='newDelivery-phone'>M: <a class='tel-phone' href='tel:"+selectedAddress.phone+"'>"+selectedAddress.phone+"</a></div>";
							
					 
					//else{
						$(".delivery-phone").hide();
					//}
	      			 // + phone
	      			 /* + "m: " + selectedCustomer.uid + "<BR>"*/
	      			  ;
	      
	      ACC.checkout.populateRegionDetails(region);
	      $(".delivery-address").html(details);
			if(!selectedCustomer.phone){
				$('.newDelivery-phone').hide();
			}
			else{
				$(".delivery-phone").hide();
			}
	    }
	},
	
	populateRegionDetails:function(region)
    {
		var regionValue = region;
		$(".delivery-region").html(regionValue);
    },
	
    populateNewRegionAddressForm:function(response){
		var region="";
		 if(response.addressData.region && response.addressData.region.isocodeShort){
		    	region= response.addressData.region.isocodeShort ;
		    }

		return region;
	},

	populateNewAddressForm:function(response){
		var details =  response.addressData.line1 + "<BR>" 
				+ response.addressData.town + ", "
				+ ACC.checkout.populateNewRegionAddressForm(response) + " " + response.addressData.postalCode + "<BR>";

		return details;
	},
	
	deliveryNewAddressShowForm:function(){
	  $(".delivery-Newaddress").hide();
   	  $(".delivery-Newregion").hide();
   	  $("#deliveryaddressdata").show();
   	  $("#deliveryaddressdat1").show();
   	  $("#deliverycitydata").show();
   	  $("#deliverystatedata").show();
   	  $("#deliveryzipdata").show();
	},
	
	deliveryNewAddressHideForm:function(){
	  $("#deliveryaddressdata").hide();
	  $("#deliveryaddressdat1").hide();
	  $("#deliverycitydata").hide();
	  $("#deliverystatedata").hide();
	  $("#deliveryzipdata").hide();
	},
	
	deliveryNewAddressDetailsShowForm:function(){
		  $(".delivery-Newaddress").show();
		  $(".delivery-Newregion").show();
	},
	briteVerifyEmailvalidation: function(emailId, status) {
		var briteverify = document.getElementById('briteVerifyEnable').value;
		var orderType = $("#orderType").val();
		let fullfillmentType = (orderType == "PARCEL_SHIPPING") ? "Shipping" : "Delivery";
		let isNationalShipping = ($(".isNationalShipping").length)? $(".isNationalShipping").val() : 'false';
		if (briteverify == "true") {
			if(!ACC.checkout.guestInterstatePilotShippingHubs && $(".isguestuser").val()== 'true' && orderType == "PARCEL_SHIPPING" && isNationalShipping == "false"){
				ACC.checkout.guestInterstatePilotShippingHubs = true;
			}
			url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email=' + emailId;
			$.ajax({
				url: url,
				type: "GET",
				timeout: 5000,
				success: function (response) {
					if (response == "invalid") {
						$("#error" + fullfillmentType + "EmailAddress").html("<div class=''><font color='red'><div class='panel-body'>" + ACC.config.emailInvalid + "</div></font></div>");
					}
					else if (status) {
						$.ajax({
							url: ACC.config.encodedContextPath + "/checkout/multi/validate-address",
							method: "POST",
							data: $('#SiteOneGC' + fullfillmentType + 'Form').serialize(),
							success: function (addressVerificationData) {
								ACC.address.isAddressChanged = false;
								ACC.address.isAddressVerified = true;
								if (addressVerificationData.status.errorCode == '404' || (addressVerificationData.isAddressValid && !addressVerificationData.isAddressCorrected) || (ACC.checkout.guestInterstatePilotShippingHubs && addressVerificationData.isAddressValid && addressVerificationData.isAddressCorrected && addressVerificationData.state != _AAData.storeState)) { //proceed with the filled form address
									ACC.checkout.saveAlternateContactForm(fullfillmentType);
								}
								else { // create popup content address suggestion
									$.colorbox({
										html: ACC.checkout.createAddressPopupContent(addressVerificationData, fullfillmentType),
										maxWidth: "100%",
										width: "550px",
										maxHeight: "100%",
										overflow: "auto",
										opacity: 0.7,
										className: "addNotFound invalidOriginalAddress",
										title: false,
										close: '<span class="glyphicon glyphicon-remove"></span>'
									});
								}
							},
						});
					}
				},
				error: function (response, textstatus, message) {
					if (textstatus == "timeout" || textstatus == "error") {
						$("#error" + fullfillmentType + "EmailAddress").html("<div class=''><font color='red'><div class='panel-body'>" + ACC.config.emailAddressUnable + "</div></font></div>");
					}
				}
			});
		} else {
			ACC.checkout.saveAlternateContactForm(fullfillmentType);
		}
	},
	createAddressPopupContent: function(addressVerificationData, type) {
		var popupContent = "";
		if (!addressVerificationData.isAddressValid) {
			popupContent = "<p class='m-b-15'>" + ACC.config.veryfyAddressError + "</p><button class='btn btn-default btn-block' onclick='ACC.colorbox.close()'>" + ACC.config.editAddress + "</button>";
		}
		else if (addressVerificationData.isAddressCorrected) {
			popupContent = "<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 no-padding-xs'><label class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/>" + ACC.config.originalAddress + "</label><div class='cl'></div><div class='pad-lft-25 marginTop10'><p class='m-b-0'>" + $("#SiteOneGC" + type + "Form #checkout" + type + "addressLine1").val() + "</p>";
			if ($("#SiteOneGC" + type + "Form #checkout" + type + "\\.addressLine2").val() != "") {
				popupContent += "<p class='m-b-0'>" + $("#SiteOneGC" + type + "Form #checkout" + type + "\\.addressLine2").val() + "</p>";
			}
			popupContent += "<p class='m-b-0'>" + $("#SiteOneGC" + type + "Form #checkout" + type + "city").val() + "</p><p class='m-b-0'>" + $("#SiteOneGC" + type + "Form #checkout" + type + "state option:selected").text() + "</p><p class='m-b-0'>" + $("#SiteOneGC" + type + "Form #checkout" + type + "zip").val() + "</p></div></div>";
			popupContent += "<div class='col-md-6 col-xs-12 m-t-20-xs no-padding-xs'><label class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/>" + ACC.config.suggestedAddress + "</label><div class='cl'></div>";
			popupContent += "<div class='pad-lft-25 marginTop10'><p id='suggestedAddress.line1' class='m-b-0'>" + addressVerificationData.street + "</p>";
			popupContent += "<p id='suggestedAddress.line2' class='m-b-0'>" + addressVerificationData.street2 + "</p>";
			popupContent += "<p id='suggestedAddress.city' class='m-b-0'>" + addressVerificationData.city + "</p>";
			popupContent += "<p id='suggestedAddress.state' class='m-b-0'>" + addressVerificationData.state + "</p>";
			popupContent += "<p id='suggestedAddress.county' class='m-b-0 hidden'>" + addressVerificationData.county + "</p>";
			popupContent += "<p id='suggestedAddress.zipcode' class='m-b-0'>" + addressVerificationData.zipcode + "</p></div></div>";
			popupContent += "<div class='cl'></div><div class='col-md-4 col-sm-6 col-xs-4 margin-top-20 m-t-10-xs'><div class='btn btn-primary btn-block' onclick='ACC.checkout.suggestedAddressSubmit(\"" + type + "\",\"" + addressVerificationData.street + "\",\"" + addressVerificationData.street2 + "\",\"" + addressVerificationData.city + "\",\"" + addressVerificationData.state + "\",\"" + addressVerificationData.zipcode + "\")' >" + ACC.config.save + "</div></div><div class='col-md-4 col-sm-6 col-xs-4 margin-top-20 m-t-10-xs'><div class='btn btn-default btn-block' onclick='ACC.colorbox.close()'>" + ACC.config.cancel + "</div></div></form>";
		}
		return popupContent;
	},
	suggestedAddressSubmit: function(type, street, street2, city, state, zipcode) {
		if ($("input[name='address\\.addressSuggestionOption']:checked").val() == "suggestedAddress") {
			$("#SiteOneGC" + type + "Form #checkout" + type + "addressLine1").val(street);
            $("#SiteOneGC" + type + "Form #checkout" + type + "\\.addressLine2").val(street2);
            $("#SiteOneGC" + type + "Form #checkout" + type + "city").val(city);
            $("#SiteOneGC" + type + "Form #checkout" + type + "state").val(state);
            $("#SiteOneGC" + type + "Form #checkout" + type + "zip").val(zipcode);
		}
		ACC.colorbox.close();
		ACC.checkout.saveAlternateContactForm(type);
	},
	saveAlternateContactForm: function(type) {
		$.ajax({
			url: ACC.config.encodedContextPath + "/checkout/multi/saveAlternateContactDetails",
			method: "POST",
			data: $("#SiteOneGC" + type + "Form").serialize(),
			success: function (response) {
				let wTop = $("#SiteOneGCMain" + type + "Form").length ? $("#SiteOneGCMain" + type + "Form").offset().top : $("#siteOneOrderTypeForm").length ? $("#siteOneOrderTypeForm").offset().top : $("#SiteOneGC" + type + "Form").offset().top;
                wTop = (wTop - 10).toFixed(0);
				type = type.toLocaleLowerCase();
				$("." + type + "-Newregion").html(ACC.checkout.populateNewRegionAddressForm(response));
				$("." + type + "-Newaddress").html(ACC.checkout.populateNewAddressForm(response));
				if (type == "shipping") {
					$("#shipmentForm, #" + type + "addressdata, #" + type + "addressdat1, #" + type + "citydata, #" + type + "statedata, #" + type + "zipdata").hide();
					$("#" + type + "_div, #" + type + "_btn").show();
					$("." + type + "-ponumber").removeClass("hidden");
					$(".florida-error-msg").addClass("hidden");
				}
				else {
					$("#" + type + "_location").val(ACC.checkout.populateNewRegionAddressForm(response));
					ACC.checkout.deliveryNewAddressHideForm();
					$("#" + type + "ContactForm").hide();
					$("#" + type + "_content2, #termsPODiv, #pickup-" + type + ", .payment_cbtn").show();
				}
				$(window).scrollTop(wTop);
			}
		});
	},
	binbOrderSubmitMethod: function(e){
		
		$(document).on("blur", "#checkoutdeliveryphone", function(e)
				{
					var phoneNumber = $(this).val();
					if(phoneNumber != null && phoneNumber != '' && phoneNumber != undefined)
				    {
				        if (!ACC.formvalidation.validatePhoneNumber(phoneNumber))
		                {
		                    var msg= ACC.config.phoneNumberError ;
		                    ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors', msg);
		                }
		                else
		                {
		                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors');
		                }
				    }
				    else
				    {
		            	ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors', ERRORMSG.global.phone);
				    }
			    });
				
				$(document).on("input", "#checkoutdeliveryphone", function(e)
				{
					ACC.formvalidation.handlePhoneNumberOnInput('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors');
			    });

		$(document).on('input blur', "#checkoutdeliverycity", function(e)
		{
			ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutdeliverycity', '#errordeliveryCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutdeliverycity');
		});
		
		$(document).on("click", ".adddeliveryFormSubmit", function(e)
				{
			e.preventDefault();
			var status = true;
				ACC.formvalidation.vaildateFields('#checkoutdeliveryfirstName','#errordeliveryFirstName', '#checkoutdeliveryfirstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
				ACC.formvalidation.vaildateFields('#checkoutdeliverylastName','#errordeliveryLastName', '#checkoutdeliverylastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);	
				var msg = ERRORMSG.global.address;
		        ACC.formvalidation.vaildateFields('#checkoutdeliveryaddressLine1', '#errordeliveryAddressLine1', '#checkoutdeliveryaddressLine1\\.errors', msg);
		        ACC.formvalidation.vaildateFields('#checkoutDeliverystate', '#errordeliveryState', '#checkoutDeliverystate\\.errors', ERRORMSG.global.state);
				ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutdeliverycity', '#errordeliveryCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutdeliverycity');
					
				if(null != $("#checkoutdeliveryphone").val() && $("#checkoutdeliveryphone").val() != '')
			    {
			        if (!ACC.formvalidation.validatePhoneNumber($("#checkoutdeliveryphone").val()))
	                {
	                    var message= ACC.config.phoneNumberError ;
	                    status = false;
	                    ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors', message);
	                }
	                else
	                {
	                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors');
	                }
			    }
			    else
			    {
			    	status = false;
	            	ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors', ERRORMSG.global.phone);
			    }
				if(!ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutdeliverycity', '#errordeliveryCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutdeliverycity'))
				{
					status = false;
				}
				if(ACC.formvalidation.validatezipcode(e, $("#checkoutdeliveryzip").val()))
				{
					ACC.formvalidation.removeErrorClassForRegForm('#checkoutdeliveryzip', '#errordeliveryZipcode', '#checkoutdeliveryzip\\.errors');
				}
				else
				{
					status = false;
					ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryzip', '#errordeliveryZipcode', '#checkoutdeliveryzip\\.errors',ACC.config.zipCodeError);
				}
				
				if(ACC.formvalidation.validateEmailPattern($("#checkoutdeliveryemail").val()))
			    {
					 ACC.formvalidation.removeErrorClassForRegForm('#checkoutdeliveryemail', '#errorDeliveryEmailAddress', '#checkoutdeliveryemail\\.errors', ERRORMSG.invalid.email);
				}
				else
				{
					status = false;
					 ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryemail', '#errorDeliveryEmailAddress', '#checkoutdeliveryemail\\.errors', ERRORMSG.invalid.email);
				}
				
				$('*[id*=error]:visible').each(function() 
						{
							if($(this).html() != '')
							{
								status = false;
							}
						});
				
				var deliveryEmail = $("#checkoutdeliveryemail").val();
				 if(status)	{
					 
					 ACC.checkout.briteVerifyEmailvalidation(deliveryEmail,status)
					 
				 }
			
	});
	},
	//Prop65 popup logic starts
	showProp65Popup:function(targetType){
		var californiaLocation= $("#california_location").val();
		var radioValue = $("#orderType").val();
		var isAddresshasCA; 
		
		 if(radioValue=='DELIVERY' || targetType == "delivery"){
			var stateValue = $(".delivery-region").length?$(".delivery-region").text():$("#delivery_location").val();
			var isAddresshasCA = (stateValue.indexOf("CA") != -1)?true:false;
		}
		
		else {
			
			  var pickupDetail = $("#pickup_location").val();
			  var isAddresshasCA = (pickupDetail.indexOf("CA") != -1)?true:false;
			
		 }
	
	
		
		if(sessionStorage.getItem("IsProp65Shown")!="true" && (californiaLocation == 'CA' || isAddresshasCA)) {
			$.ajax({
				success: function(result) {
					ACC.cart.prop65Overlay("#");
				},
				
			});
			
		
		}
	},	
	
	bigbagSpecialInstruction: function(){
	var specialinstructionTxt = $("#specialinstruction").val();
	var divider = ': Big Bag ';
	var bigbagLastIndex = specialinstructionTxt.split(divider);
	var txt = bigbagLastIndex.length > 1 ? bigbagLastIndex[1]: bigbagLastIndex[0];
	$("#specialinstruction").val(txt);
	},
	
	//Prop65 popup logic ends
	continueCheckoutProcess: function(e){
		ACC.checkout.poValueCheck();
		if($("#orderType").val() == 'PICKUP' || $("#orderType").val() == 'DELIVERY'){
			$("#termsAndConditions").trigger("click");
		}
		var submit = ACC.checkout.validateCheckoutFields();
		if(null != $("#requestedDateinUTC").val() && $("#requestedDateinUTC").val() != "")
		{
			var utcDateString = $("#requestedDateinUTC").val() + " " + "UTC";
			var localDate = new Date(utcDateString.toLocaleString());
			$("#requestedDateInLocal").html(ACC.checkout.formatDate(localDate, "display"));
		}
		
		if(submit)
		{
			ACC.checkout.addGlobalErrorForPickupDelivery();
			$(".errorPickupDelivery").show();
		}
		else
		{	
			var tt= $.trim($('#specialinstruction').val().replace(/\n/g," ").replaceAll("|","-"));
			$('#specialinstruction').val(tt);
			$(".orderTypeFormSubmit").removeAttr('disabled');
			if(null == $("#requestedDate").val() || $("#requestedDate").val() == "")
			{
				var reqDate = document.getElementById("date").value +" "+new Date().getFullYear();
				$("#requestedDate").val(new Date(reqDate));
			}
			
			var kount = sessionStorage.MercSessId;
			if($('.isSplitCartCheckoutPickup').val() == 'false'){
				e.preventDefault();
			}
			
			$.ajax({
				 url : ACC.config.encodedContextPath +'/checkout/multi/siteone-payment/setKountSessionId?kountSessionId='+kount,
					method:"POST"
									 
			});
			loading.start();
			var checkoutData;
			if($('.isSplitCartCheckoutPickup').val()=='true'){
				let splitOrderType = $("#orderType").val();
				let splitStoreId=$("#storeId").val();
				let splitContactId=$("#contactId").val();
				let splitAddressId= $("#addressId").val();
				let splitRequestedDate=$("#requestedDate").val();
				let splitDate=$("#date").val();
				let splitMeridianCode=$(".requested-time .selected-time input").val();
				let splitRequestedMeridian=$(".requested-time .selected-time input").val()
				let splitspecialInstruction=$("#specialinstruction").val();
				let splittermsAndConditions=$("#termsAndConditions").val();
				let splitkountSessionId=$("#kountSessionId").val();
				let shippingAddressId=$('#splitDeliveryAddress').val();
				let splitPurchaseOrderNumberOptionalSize = "";
				let splitPurchaseOrderNumberOptional=$("#PurchaseOrderNumber").val();
				if(splitPurchaseOrderNumberOptional != "" && splitPurchaseOrderNumberOptional != null){
					splitPurchaseOrderNumberOptionalSize = splitPurchaseOrderNumberOptional.length;
				}
				let splitPurchaseOrderNumberRequiredSize = "";
				let splitPurchaseOrderNumberRequired=$("#poNumberReq").val();
				if(splitPurchaseOrderNumberRequired != "" && splitPurchaseOrderNumberRequired != null){
					splitPurchaseOrderNumberRequiredSize = splitPurchaseOrderNumberRequired.length;
				}
				let splitPurchaseOrderNumber = "";
				if(splitPurchaseOrderNumberOptionalSize > 0) {
					splitPurchaseOrderNumber = splitPurchaseOrderNumberOptional;
				}
				else if(splitPurchaseOrderNumberRequiredSize > 0) {
					splitPurchaseOrderNumber = splitPurchaseOrderNumberRequired;
				}
				
				let bigbagInstruction=$(".isbigBagInstruction").val();
				if(bigbagInstruction)
				{
					splitspecialInstruction = bigbagInstruction.trim() + ' ' + splitspecialInstruction;
				}
				if($("#orderType").val() == "PICKUP"){
					checkoutData={
						orderType: splitOrderType,
						storeId: splitStoreId,
						contactId: splitContactId,
						addressId: splitAddressId,
						shippingAddressId:splitAddressId,
						requestedDate: splitRequestedDate,
						date: splitDate,
						meridiancode: splitMeridianCode,
						requestedMeridian: splitRequestedMeridian,
						specialInstruction: splitspecialInstruction,
						PurchaseOrderNumber: splitPurchaseOrderNumber,
						termsAndConditions: splittermsAndConditions,
						kountSessionId: splitkountSessionId
					}
				}
				if($("#orderType").val() == "DELIVERY"){
					checkoutData={
						orderType: splitOrderType,
						storeId: splitStoreId,
						contactId: splitContactId,
						deliveryAddressId: splitAddressId,
						shippingAddressId:splitAddressId,
						requestedDate: splitRequestedDate,
						date: splitDate,
						meridiancode: splitMeridianCode,
						requestedMeridian: splitRequestedMeridian,
						specialInstruction: splitspecialInstruction,
						PurchaseOrderNumber: splitPurchaseOrderNumber,
						termsAndConditions: splittermsAndConditions,
						kountSessionId: splitkountSessionId
					}
				}
			}else{
				var bigbagInstruction=($(".isbigBagInstruction").val() || '').trim();

				checkoutData=$('#siteOneOrderTypeForm').serialize().split('&').map((y)=>{
					if(bigbagInstruction.length){
					var yData = y.split("=")[1] || '';
					return y.startsWith('specialInstruction=') ? 'specialInstruction='+ bigbagInstruction + ' '+ yData : y
					}
					else{
						return y;
					}
					}).join('&');	
				
			}
			//creditcard Disable
			$.ajax({
				url: ACC.config.encodedContextPath + "/checkout/multi/saveFulfilmentOptions", 
				method:"POST",
				
				data:checkoutData,	
				
				success: function(response)
				{
					window.scrollTo(0,0);
					ACC.checkout.showProp65Popup();
					var orderType = $("#orderType").val();
					if(orderType == "PICKUP"){
						var requestedDate = new Date(response.cartData.requestedDate);
						
						var localDate = new Date(Date.UTC(requestedDate.getFullYear(), requestedDate.getMonth(), requestedDate.getDate(),  requestedDate.getHours(), requestedDate.getMinutes(), requestedDate.getSeconds(), requestedDate.getMilliseconds()));
						
						$("#requestedDateData").html(ACC.checkout.formatDate(localDate, 'mdy'));
						
						var requestedMeridian = response.cartData.requestedMeridian;
						if(requestedMeridian == "AM")
						{
							$("#requestedMeridianData").html("Morning");
						}else{
							$("#requestedMeridianData").html("Afternoon");
						}
						
						
						var taxAmount = response.cartData.totalTax.formattedValue;
						$("#taxValue").html(taxAmount);
						
						var totalAmountWithTax = response.cartData.totalPriceWithTax.formattedValue;
						$("#totalPriceWithTax").html(totalAmountWithTax);
						
						$("#pickup_Details").show();
						$("#requestedDateData").show();
						$("#requestedMeridianData").show();
						$(".direction-link").hide();
						$("#pickup-delivery").hide();
						$("#termsPODiv").hide();
						$("#pickup_Location_Div").hide();
						$(".edit-pickup-information").show();
						if($('.isSplitCartCheckoutPickup').val()=='true'){
						$(".splitShippingSection, .split-shipping-fee").addClass('hidden');
						$("#pickUpChangeContact, #PurchaseOrderNumber, #poNumberReq").addClass('hidden');
						$(".edit-split-shipping-information, .split-cart-contact-edit-info, .split-shipping-Details, .splitPurchaseOrderNumber").removeClass('hidden');
						var splitPONumber = '';
						if($("#PurchaseOrderNumber").val() != null && $("#PurchaseOrderNumber").val() != '')
						{
							splitPONumber = $("#PurchaseOrderNumber").val();
						}
						var splitPONumberReq = '';
						if($("#poNumberReq").val() != null && $("#poNumberReq").val() != '')
						{
							splitPONumberReq = $("#poNumberReq").val();
						}
						if(splitPONumber != "" && splitPONumber != null && splitPONumber.length > 0)
						{
							$(".splitPurchaseOrderNumber").html(splitPONumber);
						}
						else if(splitPONumberReq != "" && splitPONumberReq != null && splitPONumberReq.length > 0)
						{
							$(".splitPurchaseOrderNumber").html(splitPONumberReq);
						}
						}
					}else{
						 
						var requestedDate = new Date(response.cartData.requestedDate);
						var localDate = new Date(Date.UTC(requestedDate.getFullYear(), requestedDate.getMonth(), requestedDate.getDate(),  requestedDate.getHours(), requestedDate.getMinutes(), requestedDate.getSeconds(), requestedDate.getMilliseconds()));

						
						var requestedMeridian = response.cartData.requestedMeridian;
						if(requestedMeridian == "AM")
						{
							$("#requestedDeliveryDate").html(ACC.checkout.formatDate(localDate, 'mdy')+"| "+"Morning");
						}else{
							$("#requestedDeliveryDate").html(ACC.checkout.formatDate(localDate, 'mdy')+"| "+"Afternoon");
						}
						
						var addline1 = response.cartData.deliveryAddress.line1;
						var addline2 = response.cartData.deliveryAddress.line2;
						var city = response.cartData.deliveryAddress.town;
						var state = response.cartData.deliveryAddress.region.isocodeShort;
						$("#delivery_line1").html(addline1);
						$("#delivery_line2").html(addline2);
						$("#delivery_city").html(city);
						$("#delivery_state").html(state);
						$("#delivery_location").val(state);
						var postalCode = response.cartData.deliveryAddress.postalCode;
						$("#delivery_postalcode").html(postalCode);
						if($(".isSplitCartCheckoutPickupFE").val()=='true' && orderType == "DELIVERY"){
							var deliveryFees = response.cartData.deliveryFreight;
						}else{
							var deliveryFees = response.cartData.freight;
						}
						if(deliveryFees != null){
							$("#deliveryfees").html("$"+deliveryFees);
							$("#delivery_cost").html("$"+deliveryFees);
						}else{
							$("#deliveryfees").html("$0.00");
							$("#delivery_cost").html("$0.00");
							$(".delivery-fee-box").removeClass("hidden");
						}
						var taxAmount = response.cartData.totalTax.formattedValue;
						$("#taxValue").html(taxAmount);
						
						var totalAmountWithTax = response.cartData.totalPriceWithTax.formattedValue;
						$("#totalPriceWithTax").html(totalAmountWithTax);
						
						$("#delivery_fee").show();
					
						$("#delivery_content1").hide();
						$("#delivery_content2").hide();
						$("#pickup-delivery").hide();
						$("#delivery_Details").show();
						$(".edit-delivery-information").show();
						$("#termsPODiv").hide();
						$(".payment_cbtn").hide();
						if($('.isSplitCartCheckoutPickup').val()=='true' && $("#orderType").val() == "DELIVERY"){
							$("#deliveryChangeContact, #PurchaseOrderNumber, #poNumberReq").addClass('hidden');
							$(".split-cart-contact-edit-info, .splitPurchaseOrderNumber").removeClass('hidden');
							var splitPONumber = '';
							if($("#PurchaseOrderNumber").val() != null && $("#PurchaseOrderNumber").val() != '')
							{
								splitPONumber = $("#PurchaseOrderNumber").val();
							}
							var splitPONumberReq = '';
							if($("#poNumberReq").val() != null && $("#poNumberReq").val() != '')
							{
								splitPONumberReq = $("#poNumberReq").val();
							}
							if(splitPONumber != "" && splitPONumber != null && splitPONumber.length > 0)
							{
								$(".splitPurchaseOrderNumber").html(splitPONumber);
							}
							else if(splitPONumberReq != "" && splitPONumberReq != null && splitPONumberReq.length > 0)
							{
								$(".splitPurchaseOrderNumber").html(splitPONumberReq);
							}
						}
						
					}
					var guestUser=$(".isguestuser").val();
					var currentBaseStoreId=$(".currentBaseStoreId").val();
					
					if(guestUser== 'true'){
					transportKeyGCGenerate();
					
					$("#iframe_Popup_guest").show();
					if(currentBaseStoreId=='CA'){
						ACC.checkout.initGlobalPayment();			
					}
					 if(analyticsPaymentMethodCheck==false){
 						analyticsPaymentMethodCheck= true;
	 					try {
	 		            	  _satellite.track("paymentDetails");
	 		            } catch (e) {}
 					}
					}
					else if(guestUser== 'false'){
					paymenthB2BGenerate();
					
					 $(".choosepaymentB2b_GC").show();
					 if(analyticsPaymentMethodCheck==false){
						 analyticsPaymentMethodCheck= true;
						 try {
							  _satellite.track("paymentDetails");
						} catch (e) {}
					 }
					}
					
					if($('.currentBaseStoreId').val() == 'CA' && response.taxForCA ){
						var formatter = new Intl.NumberFormat('en-CA', {
						  style: 'decimal',
						  minimumFractionDigits: 2,
						  maximumFractionDigits: 2,
						});
						
						$(".vertex-item").remove();
						var vertexHtml = '';
						Object.keys(response.taxForCA).forEach(key => {
						        vertexHtml +='<div class="col-xs-12 col-md-12 col-sm-12 border-top padding-LeftZero sale-tax-summary vertex-item">';
			                    vertexHtml +='<div class="col-xs-8 col-md-8 col-sm-9 data-title black-title padding0">';
			                    vertexHtml +=key;
			                    vertexHtml +='</div>';
			                  	
			                    vertexHtml +='<div class="col-md-4  col-sm-3 col-xs-4 confirmation-tax-value text-right bold padding0">'
								vertexHtml +='<strong id="taxValue">$'+formatter.format(response.taxForCA[key])+'</strong>'
								vertexHtml +='</div>'
			                    vertexHtml +='</div>'
						})
						
						if(vertexHtml != ''){
							$(".sale-tax-summary").before(vertexHtml);
						}
					}
				}
			});

			if($('.isSplitCartCheckoutPickup').val()=='true'){
			$(document).on("click", "#split-shipping_Edit", function(e){
				$(".split-shipping-Details").addClass('hidden');
				$(".split-shipping-fee, .splitShippingSection").removeClass('hidden');
				$(".choosepaymentB2b_GC").hide();
			});
			$(document).on("click", "#split-cart-contact-edit", function(e){
				if($("#orderType").val() == "PICKUP") {
					$(".split-shipping-Details, .splitPurchaseOrderNumber").addClass('hidden');
					$("#pickUpChangeContact, #PurchaseOrderNumber, #poNumberReq").removeClass('hidden');
					$(".splitShippingSection, .split-shipping-fee").removeClass('hidden');
					//$(".split-shipping-fee").addClass('hidden');
					$(".choosepaymentB2b_GC").hide();
				}
				if($("#orderType").val() == "DELIVERY") {
					$(".splitPurchaseOrderNumber").addClass('hidden');
					$("#deliveryChangeContact, #PurchaseOrderNumber, #poNumberReq").removeClass('hidden');
					$(".choosepaymentB2b_GC").hide();
					$(".payment_cbtn").show();
				}
			});
		}
        }
	},
	initGlobalPayment: function(){
		var isGPInitialized = $("#isGPInitialized").val()
		
		if(isGPInitialized != '0'){
			return
		}
	   
	const cardForm = GlobalPayments.ui.form({
	      fields: {
	    	  "card-holder-name": {
	              placeholder: "Full Name",
	              target: "#GP-card-holder-name"
	           },
	         "card-number": {
	            placeholder:"   ",
	            target: "#GP-card-number"
	         },
	         "card-expiration": {
	            placeholder: "MM / YYYY",
	            target: "#GP-card-expiration"
	         },
	         "card-cvv": {
	            placeholder: "",
	            target: "#GP-card-cvv"
	         },
	         "submit": {
	            target: "#GP-submit-button",
	            text: "Submit"
	         }
	      },
	      styles: {
	    	    //adding styles to the global payment iframe
	    	    'input[type=text]': {
	    	      'margin-bottom': '10px !important',
	    	      padding: '12px',
	    	      border: '1px solid #ccc',
	    	      'border-radius': '10px',
	    	    },
	
	    	    //adding focus on the fields when selected
	    	    'input[type=text]:focus-visible, input[type=tel]:focus-visible': {
	    	      outline: 'none !important',
	    	      border: '1px solid #78a22f',
	    	      'box-shadow': '0 0 4px 0 #78a22f inset',
	    	    },
	
	    	    //adding a radius on all number inputs
	    	    'input[type=tel]': {
	    	      'margin-bottom': '10px !important',
	    	      padding: '12px',
	    	      border: '1px solid #ccc',
	    	      'border-radius': '10px',
	    	    },
	
	    	    //adding focus on the fields when selected
	    	    'button[type=button]:focus-visible': {
	    	      'background-color': '#78a22f',
	    	      outline: 'none !important',
	    	      border: '1px solid gray',
	    	      'box-shadow': '0 -1px 4px 0 gray inset',
	    	    },
	
	    	    //adding styling to the submit button
	    	    'button[type=button]': {
	    	      'background-color': '#78a22f',
	    	      color: 'white',
	    	      padding: '12px',
	    	      margin: '18px 10px 10px 10px',
	    	      border: 'none',
	    	      'border-radius': '10px',
	    	      cursor: 'pointer',
	    	      'font-size': '17px',
	    	    },
	
	    	    //adding hover color
	    	    'button[type=button]:hover': {
	    	      'background-color': '#78a22f',
	    	      'margin-bottom': '20px',
	    	    },
	
	    	    '.card-number.card-type-visa': {
	    	      background:
	    	        '#f3faff url(https://hps.github.io/token/gp-1.0.0/images/logo-visa@2x.png) no-repeat right',
	    	      'background-position-y': '0px',
	    	      'background-size': '70px 70px',
	    	    },
	    	    '.card-number.card-type-mastercard': {
	    	      background:
	    	        '#f3faff url(https://hps.github.io/token/gp-1.0.0/images/logo-mastercard@2x.png) no-repeat right',
	    	      'background-position-y': '5px',
	    	      'background-size': '60px 64px',
	    	    },
	    	    '.card-number.card-type-discover': {
	    	      background:
	    	        '#f3faff url(https://hps.github.io/token/gp-1.0.0/images/logo-discover@2x.png) no-repeat right',
	    	      'background-position-y': '-2px',
	    	      'background-size': '90px 80px',
	    	    },
	    	    '.card-number.card-type-jcb': {
	    	      background:
	    	        '#f3faff url(https://hps.github.io/token/gp-1.0.0/images/logo-jcb@2x.png) no-repeat right',
	    	      'background-position-y': '0px',
	    	      'background-size': '48px 82px',
	    	    },
	    	    '.card-number.card-type-amex': {
	    	      background:
	    	        '#f3faff url(https://hps.github.io/token/gp-1.0.0/images/logo-amex@2x.png) no-repeat right',
	    	      'background-position-y': '-2px',
	    	      'background-size': '55px 90px',
	    	    },
	
	    	    'input.invalid': {
	    	      '-webkit-box-shadow': 'inset 0px 0px 5px 0px #ff0a0a',
	    	      'box-shadow': 'inset 0px 0px 5px 0px #ff0a0a',
	    	      'border-color': '#ff8282',
	    	    },
	    	  },
	   		});
	
	
		cardForm.ready(()=> {
			$("#isGPInitialized").val('1');
		})
			
		GlobalPayments.configure({
		  'X-GP-Api-Key': ACC.config.gpApiKey,
	      'X-GP-Environment': ACC.config.gpApiEnv,
	      enableAutocomplete: true
	    });
	    
	    $(document).on("input blur", "#GP-b-streetAddress", function(e) {	
			ACC.formvalidation.vaildateFields('#GP-b-streetAddress', '', '', '')
	    });
	    
	    $(document).on("input blur", "#GP-b-zipCode", function(e) {
			var ele= $(this)	
			if(!ACC.formvalidation.validatezipcode(ele, ele.val())) {
				ele.parent().addClass("has-error");
			}else{
				ele.parent().removeClass("has-error");
			}
	    });
					    
		cardForm.on("token-success", (resp) => {
		   console.log("resp",resp)
			var isValid = true
			
			if(!ACC.formvalidation.vaildateFields('#GP-b-streetAddress', '', '', '')){
				isValid = false
			}
			
			var zipCodeEle = $("#GP-b-zipCode")
			
			if(!ACC.formvalidation.validatezipcode(zipCodeEle, zipCodeEle.val())) {
				isValid = false
				zipCodeEle.parent().addClass("has-error");
			}else{
				zipCodeEle.parent().removeClass("has-error");
			}
			
			if(!isValid) {
				return;
			}
			
		   loading.start();
	      $.ajax({
            url: ACC.config.encodedContextPath + "/checkout/multi/siteone-payment/add-globalpayment",
            type: "GET",
            dataType: 'json',
            contentType: 'application/json',
            data: {
              "token": resp.temporary_token,
              "address": $('#GP-b-streetAddress').val(),
              "postalCode": zipCodeEle.val(),
              "cardType": resp.card.type,
          	  "cardNumber": resp.card.masked_card_number.slice(-4),
            },
            success: function (response) {
              loading.stop();
              if(response == "Success"){
               window.parent.location.href = ACC.config.encodedContextPath +"/checkout/multi/order-summary/view";
              }else{
				  $('#colorbox').addClass("gp-not-process");
			        var targetHTML = $(".gp-card-error").html();
			        ACC.colorbox.open("", {
			          html: '<div class="gp-card-error">' + targetHTML + '</div>',
			          width: 700,
			          escKey: true,
			          overlayClose: true,
			          onComplete: function () {
			            
			          }
			        });
			  }
            },
            error: function (response) {
				loading.stop();
               $('#colorbox').addClass("gp-not-process");
		        var targetHTML = $(".gp-card-error").html();
		        ACC.colorbox.open("", {
		          html: '<div class="gp-card-error">' + targetHTML + '</div>',
		          width: 700,
		          escKey: true,
		          overlayClose: true,
		          onComplete: function () {
		            
		          }
		        });
            }
          });
	   });
	
	   // add error handling if token generation is not successful
	   cardForm.on("token-error", (resp) => {
	      // TODO: Add your error handling
	      console.error(resp)
	   });
	
	
	},

	b2bIsFlorida:function(b2bState,currentTarget){
		let isNationalShipping = ($(".isNationalShipping").length)? $(".isNationalShipping").val() : 'false';
		if(isNationalShipping == 'false' && ((b2bState != _AAData.storeState && $(currentTarget).hasClass("new-address-region")===false) || b2bState != 'US-'+_AAData.storeState)){
			var stateMsg = ERRORMSG.global.shippingStates;
			ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.region', '.errorRegion', '#region\\.errors', stateMsg);
		}else{
			ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.region', '.errorRegion', '#region\\.errors', stateMsg);
		}
	},
	bindAddAddressSubmit: function(e){
	
  $(document).on("change","#cboxLoadedContent #checkoutAddress\\.region", function(e){
			var orderType = $("#orderType").val();
			var state = $(this).val();
			if(orderType === "PARCEL_SHIPPING"){
				ACC.checkout.b2bIsFlorida(state,e.target);
			}
		});
		$(document).on("click", "#saveAddressInMyAddressBook", function (e) {
            if ($("#saveAddressInMyAddressBook").prop('checked')) {
                $("#defaultAddressInMyAddressBook").removeAttr('disabled');
                $(".default-address-left-label").removeClass('text-gray');
   
            } else {
				$("#defaultAddressInMyAddressBook").prop('checked', false)
                $("#defaultAddressInMyAddressBook").attr('disabled', 'true');
                $(".default-address-left-label").addClass('text-gray');
            }
		});
		
		$(document).on("click", ".addAddressFormSubmit", function(e)
		{
			
			e.preventDefault();

			var status = true;
			
	        ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.line1', '.errorline1', '#line1\\.errors', ERRORMSG.global.address);
	        ACC.formvalidation.validateFieldBasedOnRegex(e,'#cboxLoadedContent #checkoutAddress\\.townCity', '.errorTownCity', '#townCity\\.errors',ACC.config.checkoutCityMay,ERRORMSG.global.city, 'city');
	        
	        if($("#orderType").val() === "PARCEL_SHIPPING"){
	        	var state = $("#cboxLoadedContent #checkoutAddress\\.region").val();
				ACC.checkout.b2bIsFlorida(state,$("#cboxLoadedContent #checkoutAddress\\.region"));
			}else{
				ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.region', '.errorRegion', '#region\\.errors', ERRORMSG.global.state);
			}
	        ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.companyName', '.errorCompanyName', '#companyName\\.errors', ERRORMSG.global.company);
	        
	        if($("#cboxLoadedContent #checkoutAddress\\.phone").val() != null && $("#cboxLoadedContent #checkoutAddress\\.phone").val() != '' && !ACC.formvalidation.validatePhoneNumber($("#cboxLoadedContent #checkoutAddress\\.phone").val()))
	        {
	        	status = false;
	            ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
	        }
	        else
	        {
	            ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
	        }
	         
	        if(ACC.formvalidation.validatezipcode(e, $('#cboxLoadedContent #checkoutAddress\\.postcode').val()))
			{
				ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors');
			}
			else
			{
				status = false;
				ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors', ACC.config.checkoutValidZip);
			}
	        $('span[class*="error"]').each(function() 
	    	    	{
	    	    		if($(this).html() != '')
	    	    		{
	    	    			status = false;
	    	    		}
			});
			ACC.checkout.b2bCompany=$("#siteOneAddressForm #checkoutAddress\\.companyName").val();
			ACC.checkout.b2bAddy1 = $("#siteOneAddressForm #checkoutAddress\\.line1").val();
			ACC.checkout.b2bAddy2 = $("#siteOneAddressForm #checkoutAddress\\.line2").val();
			ACC.checkout.b2bCity = $("#siteOneAddressForm #checkoutAddress\\.townCity").val();
			ACC.checkout.b2bSiteoneState = $("#siteOneAddressForm #checkoutAddress\\.region option:selected").text() 
			ACC.checkout.b2bZip = $("#siteOneAddressForm #checkoutAddress\\.postcode").val();
			ACC.checkout.b2bPhone = $("#siteOneAddressForm #checkoutAddress\\.phone").val();
			ACC.checkout.addressDataForm = $('#cboxLoadedContent #siteOneAddressForm').serializeArray();
			
			ACC.checkout.siteoneAddJSONData = {};
			$.each(ACC.checkout.addressDataForm, function () { ACC.checkout.siteoneAddJSONData[this.name] = this.value; })
			if (status) {
				
				
				$.ajax({
					url: ACC.config.encodedContextPath + "/checkout/multi/order-type/validate-address",
					method: "POST",
					data: ACC.checkout.siteoneAddJSONData,
					
					success: function (addressVerificationData) { 
						// addressVerificationData = {
						// 	"isAddressValid": true,
						// 	"isAddressCorrected": true,
						// 	"city": "Woodland Hills",
						// 	"county": "Los Angeles",
						// 	"state": "CA",
						// 	"street": "7 Olive Dr",
						// 	"street2": "",
						// 	"zipcode": "91364-5229",
						// 	"status": {
						// 		"code": " ",
						// 		"description": "",
						// 		"internalCode": "No Error"
						// 	}
						// }
						// console.log(addressVerificationData)
				
						ACC.address.isAddressChanged = false;
						ACC.address.isAddressVerified = true;
						 if((addressVerificationData.isAddressValid && !addressVerificationData.isAddressCorrected) || addressVerificationData.status.errorCode == '404')
						 {
							 $.ajax({
								url: ACC.config.encodedContextPath + "/checkout/multi/order-type/add-address", 
								method:"POST",
								data: $('#cboxLoadedContent #siteOneAddressForm').serialize(),	
								beforeSend: function ()
								{
									loading.start();
								},
								success: function(response)
								{
									console.log(response)
									ACC.colorbox.close();
									if(null != response && response !="" && response != undefined) {
										$("#addAddressSuccess").html("<font color='green'><div class='panel-body'>"+ACC.config.addressCreated+"</div></font>");
										if ($("#cboxLoadedContent #saveAddressInMyAddressBook").is(":checked"))	{
											$("#deliveryAddress").append( '<option value="'+response[0].id+'" selected>Address: '+response[0].line1+'</option>' );
											if($('.isSplitCartCheckoutPickup').val() == 'true' && $("#orderType").val() == "PICKUP") {
												$("#splitDeliveryAddress").append( '<option value="'+response[0].id+'" selected>Address: '+response[0].line1+'</option>' );
											}
											$(".deliveryAddresses").val(response[1]);
											$("#deliveryAddress").change();
										} else {
											 var region="";
											 if(response[0].region && response[0].region.isocodeShort){
													region= response[0].region.isocodeShort ;
												}
											 var details =  response[0].line1 + "<BR>" 
															   + response[0].town + ", "
															   + region + " " + response[0].postalCode + "<BR>";
					 
											 ACC.checkout.populateRegionDetails(region);
											 $('#deliveryAddress option')[0].selected = true;
											 if($('.isSplitCartCheckoutPickup').val() == 'true' && $("#orderType").val() == "PICKUP") {
											 	$("#splitDeliveryAddress option")[0].selected = true;
											 }
											 $(".delivery-address").html(details);
											 
											 
												$('#addressId').val(response[0].id);
											if($('.isSplitCartCheckoutPickup').val() == 'true'  && $("#orderType").val() == "PICKUP") {
												$("#shippingAddressId").val(response[0].id);
											}
												var contact = $('#contactId').val();
												
												ACC.checkout.populateContactAddress(contact);
												ACC.checkout.checkoutAddressNotSaved = true;
										}
									}
									loading.stop();
				
								},
								error: function(response, textstatus, message) 
								{
								  loading.stop();
								  if(textstatus == "timeout" || textstatus == "error") 
								  {
									 $("#cboxLoadedContent .addAddressError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.unableToAdd+"</div></font></div>");
									} 
								},
								complete:function(response){
				
								}
							});
						 } else {
							 // create pop up content		        				        			
							 var popupContent = createPopupContent(addressVerificationData);			        			
							 //Popup for address suggestion
							 $.colorbox({
								 html: popupContent,					
								 maxWidth:"100%",
								 width:"550px",
								 maxHeight:"100%",
								 overflow:"auto",
								 opacity:0.7,
								 className:"addNotFound",
								 title:false,
								 close:'<span class="glyphicon glyphicon-remove"></span>',
								 onComplete: function(){
								 }
							 });
						 }
					},
					error: function() 
					{
						window.location.href = ACC.config.encodedContextPath + "/login";
					}
				})
	       }
		});
	},
	
	bindCaliforniaWarning: function(){
		$(document).on("click",".proceed-to-checkout-ca",function(e)
				{	e.preventDefault();
					$.colorbox.close();
				});
	},
	guestInterstatePilotShippingHubs: false,
	
	bindOrderTypeFormSubmit:function()
	{
		
	var orderType = $("#orderType").val();
		if ($(".isInDeliveryFeePilot").val() == "true") {
			$(".delivery-fee-box").addClass("hidden");
			if (orderType == "PARCEL_SHIPPING") {
				$(".checkout-shipping-fee-msg").addClass('hidden');
				if ($("#checkout-shipping-fee-msg-show").val() == 'true') { 
					$(".checkout-shipping-fee-msg").removeClass('hidden');
				}
	
			}
		}
		else if (orderType == "DELIVERY") {
			$(".delivery-fee-box").removeClass("hidden");
			$(".checkout-shipping-fee-msg").addClass('hidden');
		}
		else if (orderType == "PARCEL_SHIPPING") {
			$(".checkout-shipping-fee-msg").addClass('hidden');
			if ($("#checkout-shipping-fee-msg-show").val() == 'true') { 
				$(".checkout-shipping-fee-msg").removeClass('hidden');
			}

		}
		
		$(document).on("click",".addShippingMainFormSubmit",function(e)
		{
				
			ACC.checkout.guestInterstatePilotShippingHubs = false;
			ACC.checkout.checkPONumberReq()
				.then(() => {
			var status = true;
			let isNationalShipping = ($(".isNationalShipping").length)? $(".isNationalShipping").val() : 'false';
			let b2bmsg = ERRORMSG.global.address;
			let b2bstateMsg = ERRORMSG.global.shippingStates;
			if($(".isguestuser").val()== 'false'){
				var state = $(".delivery-region").html();
				let isPONumberRequired = $("#poNumberRequired").val();
				let poNumber = $("#poNumberReq").val();
				let isPOValidated = $("#isPOValidated").val();
				if(!ACC.checkout.checkoutAddressNotSaved && $("#deliveryAddress").val()== "selectDefault")
				{
					$("#deliveryAddress").addClass("error-div");
					$("#deliveryAddress").click(function(){
						$("#deliveryAddress").removeClass("error-div");
					});
					ACC.checkout.addErrorClassForCheckoutForm('#deliveryAddress', '#errorDeliveryAddressRadio', '#deliveryAddress\\.errors', ACC.config.selectDeliveryAddressToContinue+'.<div class="cl"></div><br/><br/>');
					status = false;
				}
				else{
					ACC.checkout.removeErrorClassForCheckoutForm('#deliveryAddress', '#errorDeliveryAddressRadio', '#deliveryAddress\\.errors');
				}
				if(isNationalShipping == 'false' && state != _AAData.storeState){
					ACC.checkout.checkIfFlorida('#deliveryAddress', '#errorDeliveryAddressRadio', '#deliveryAddress\\.errors', b2bmsg, b2bstateMsg)
			        status = false;
				}
				
				if (isPONumberRequired == "true") { //Shipping PO Number check
					if (null == poNumber || poNumber == "") {
						ACC.checkout.addErrorClassForCheckoutForm('#poNumberReq', '#errorPONumberRequired', '#poNumberReq\\.errors', ACC.config.ponumbererror);
						status = false;
					}
					else {
						if (null != isPOValidated && isPOValidated == "true") {
							ACC.checkout.removeErrorClassForCheckoutForm('#poNumberReq', '#errorPONumberRequired', '#poNumberReq\\.errors');
						}
						else {
							ACC.checkout.addErrorClassForCheckoutForm('#poNumberReq', '#errorPONumberRequired', '#poNumberReq\\.errors', ACC.config.ponumbererror);
							status = false;
						}
					}
					
				}
			}
			else if($("#orderType").val() == "PARCEL_SHIPPING" && isNationalShipping == 'false' && $('.shipmentcheck').prop("checked") && !ACC.formvalidation.vaildateShippingState('.addressDatadistrict', '#errorShippingState', '#checkoutShippingstate\\.errors', b2bmsg, '')){ //Guest can not Submit an interstate shipping order for Pilot Shipping Hubs (Tampa/LA)
				$(".shipmentcheck").attr("disabled", true).css("pointer-events","none");
				$(".florida-error-msg").removeClass("hidden");
				$("#shippingaddressdata, #shippingaddressdat1, #shippingcitydata, #shippingstatedata, #shippingzipdata").hide();
				ACC.checkout.showAddressForm();
				$("#checkoutShippingstate").val(_AAData.storeState);
				ACC.checkout.guestInterstatePilotShippingHubs = true;
				status = false;
			}
			if(status){
			loading.start();
			$.ajax({
				url: ACC.config.encodedContextPath + "/checkout/multi/saveFulfilmentOptions", 
				method:"POST",
	    		data:$('#SiteOneGCMainShippingForm').serialize(),	
	    		
	    		success: function(response)
	    		{
	    			window.scrollTo(0,0);
	    			ACC.checkout.showProp65Popup();
	    			var firstname = response.cartData.deliveryAddress.firstName;
        			$("#shipping_fname").html(firstname);
        			
        			var phonedata = response.cartData.deliveryAddress.phone;
        			$("#shipping_phone").html(phonedata);
        			
        			var emaildata = response.cartData.deliveryAddress.email;
        			$("#shipping_email").html(emaildata);
        			
        			var addressdata =  response.cartData.deliveryAddress.line1;
        			$("#shipping_line1").html(addressdata);
        			
        			var addressdata1 =  response.cartData.deliveryAddress.line2;
        			$("#shipping_line2").html(addressdata1);
        			
        			var citydata = response.cartData.deliveryAddress.town;
        			$("#shipping_city").html(citydata);
        			
        			var statedata = response.cartData.deliveryAddress.district;
        			$("#shipping_state").html(statedata);
					$("#delivery_location").val(statedata);
        			
        			var zipdata = response.cartData.deliveryAddress.postalCode;
        			$("#shipping_zipcode").html(zipdata);
        		
        			var shippingFees = response.cartData.freight;
        			if(shippingFees != null && shippingFees == "0.0"){
        				$("#shipping_cost").html("$0.00");
        			}else{
        				$("#shipping_cost").html("$"+shippingFees);
        			}
        			
        			var taxAmount = response.cartData.totalTax.formattedValue;
        			$("#taxValue").html(taxAmount);
        			
        			var totalAmountWithTax = response.cartData.totalPriceWithTax.formattedValue;
        			$("#totalPriceWithTax").html(totalAmountWithTax);
        			
        			
        			$("#shipping_div").hide();
        			$("#shipping_btn").hide();
        			$("#shipment_div2").hide();
        			$("#shipping_fee").hide();
        			$(".shipping-ponumber").addClass("hidden");
	    			$("#shipping_Details").show();
	    			$("#Shipping_Edit").show();
	    			$(".edit-shipping-information").show();
	    			
	    			var guestUser=$(".isguestuser").val();
        			if(guestUser== 'true'){
        			transportKeyGCGenerate();
        			
        			$("#iframe_Popup_guest").show();
        			 if(analyticsPaymentMethodCheck==false){
 						analyticsPaymentMethodCheck= true;
	 					try {
	 		            	  _satellite.track("paymentDetails");
	 		            } catch (e) {}
 					}
        			}
        			else if(guestUser== 'false'){
        			paymenthB2BGenerate();
        			 $(".choosepaymentB2b_GC").show();
        			 if(analyticsPaymentMethodCheck==false){
 						analyticsPaymentMethodCheck= true;
	 					try {
	 		            	  _satellite.track("paymentDetails");
	 		            } catch (e) {}
 					}
        		}
	    			
	    		}
	    	});
			}
			});
		});
		
		$(document).on("click",".orderTypeFormSubmit",function(e)
		{
			ACC.checkout.checkPONumberReq()
				.then(() => {
					ACC.checkout.continueCheckoutProcess(e);						
				});	
		})
	},
	
	bindAddPhone: function(){
		$(document).on("click",".contact-add-phoneNumber",function(e){
			e.preventDefault();
			$('#colorbox').addClass('addPhoneNumberNew');
			ACC.colorbox.open(
				$(this).data("cboxTitle"),
				{
					href: $(this).data("link"),
					width:"480px",
					onComplete: function(){  				
                    	 ACC.checkout.bindAddPhoneSuccess();
                    	 ACC.checkout.removeErrorClassForCheckoutForm('#phoneNo', '#errorPhoneNo', '#phoneNo\\.errors');
					}
				}
			);
		});
	},
	
	bindAddPhoneSuccess:function(){
		$("#addPhoneNumberEmailId").val($("#contactId").val());
		$("#siteOneAddPhoneNumberForm input[name=phoneNumber]").attr("placeholder","Phone Number");
		$('form#siteOneAddPhoneNumberForm').ajaxForm({
			beforeSend : function() {				
				loading.start();
			},
			success: function(data)
			{	
				$("#isAddPhoneNumberUsed").val("Y");
				$("#addPhoneMessage").hide();		
				//ACC.checkout.enableDisableContinueButton();
				loading.stop();
				var contactNumber = $("#user\\.phonenumber").val();
				$(".checkout_addPhoneNumber").replaceWith(data);				
				ACC.colorbox.resize();
				if ($(data).hasClass("addPhoneNumberSucess"))
				{
					ACC.checkout.bindPopulatePhoneNumber(contactNumber,$("#contactId").val());			
				}				
				ACC.checkout.bindAddPhoneSuccess();
			}
		});		 
	},
	
	bindPopulatePhoneNumber:function(contactNumber,contactId){
		$("#contactPhoneDetails").html("m: <a class='tel-phone' href='tel:"+contactNumber+"'>"+contactNumber+"</a>");
		var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
		jQuery.each(customers, function(i, customer)
		{	
			if(customer.displayUid === contactId)
			{				
				customer.contactNumber = contactNumber;
			}
			
		 });
		document.getElementsByClassName("allCustomers")[0].value = JSON.stringify(customers);
	},
	bindIsPhoneNumberChecked: function()
	{
		var isContactPhoneNumberRequired = $("#isContactRequirePhoneNumber").val();
		var isAddPhoneNumberUsed =  $("#isAddPhoneNumberUsed").val();
		if(isContactPhoneNumberRequired == "Y"){
			if(isAddPhoneNumberUsed == "Y"){
				return true;
			}else{
				return false
			}
		}else{
			return true;
		}
	},
	
	addNewAddressCheckout: function()
    {
		var addnewdeliveryaddresshtml = $('#addresscheckout').clone().html();
    	$(document).on("click", ".newaddress", function(e)
    	{
    		$('#addresscheckout').remove();
    		e.preventDefault();
    		var ordertype = $("#orderType").val();
	    	ACC.checkout.removeErrorClassForCheckoutForm('#deliveryAddressRadio', '#errorDeliveryAddressRadio', '#deliveryAddressRadio\\.errors');
	    	$("#deliveryAddress").removeClass("error-div");
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.companyName', '.errorCompanyName', '#companyName\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.line1', '.errorline1', '#line1\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.region', '.errorRegion', '#region\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.townCity', '.errorTownCity', '#townCity\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors');
	    	$("#colorbox").addClass("addAddress-checkout");
	    	$("#colorbox").removeClass("failedgeoLocation-box");
	    	if(ordertype == "PARCEL_SHIPPING" ||( $('.isSplitCartCheckoutPickup').val() == 'true'  && $("#orderType").val() == "PICKUP")){
	    		ACC.colorbox.open("", {
                    html: addnewdeliveryaddresshtml,
                    width: "550",
                    height: "auto",
                    title: "<div class='headline'>"+ACC.config.shippinglocationpop+"</div>",
                    close:'<span class="glyphicon glyphicon-remove"></span>',
                    
                    onComplete: function(){
		    			_AAData.popupPageName= ACC.config.addNewLocationPopup;
			        	_AAData.popupChannel= ACC.config.checkoutpathingChannel;
					 	try {
						    	 _satellite.track('popupView');
				        } catch (e) {}
		    		},
	    		});
	    	}else{
		    	ACC.colorbox.open("", {
	                    html: addnewdeliveryaddresshtml,
	                    width: "550",
	                    height: "auto",
	                    title: "<div class='headline'>"+ACC.config.deliverylocationpop+"</div>",
	                    close:'<span class="glyphicon glyphicon-remove"></span>',
	                    onComplete: function(){
			    			_AAData.popupPageName= ACC.config.addNewLocationPopup2;
				        	_AAData.popupChannel= ACC.config.checkoutpathingChannel;
						 	try {
							    	 _satellite.track('popupView');
					        } catch (e) {}
			    		},
	                     
	            });
	    	}
    	});
     },
	
	bindAddressValidations: function ()
	{
    	$(document).on("blur", "#cboxLoadedContent #checkoutAddress\\.phone", function(e)
    		{ 
    		    var phoneNumber = $(this).val();
    		    if (phoneNumber != "" && !ACC.formvalidation.validatePhoneNumber(phoneNumber))  
    		    {
    		       ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress \\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
    		    }
    		    else
    		    {
    		    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
    		     }
    		 });
    	$(document).on('input blur', "#cboxLoadedContent #checkoutAddress\\.townCity", function(e)
    		{
    				ACC.formvalidation.validateFieldBasedOnRegex(e,'#cboxLoadedContent #checkoutAddress\\.townCity', '.errorTownCity', '#townCity\\.errors',ACC.config.checkoutCityMay,ERRORMSG.global.city, 'city');
    		});
    	$(document).on('input blur', "#cboxLoadedContent #checkoutAddress\.companyName", function(e)
    		{
    				ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.companyName', '.errorCompanyName', '#companyName\\.errors',ERRORMSG.global.company);
    		});
    	$(document).on('input blur', "#cboxLoadedContent #checkoutAddress\\.line1", function(e)
    		{
    				ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.line1', '.errorline1', '#line1\\.errors',ERRORMSG.global.address);
    		});
    	$(document).on('input blur', "#cboxLoadedContent #checkoutAddress\\.region", function(e)
    		{
    		var orderType = $("#orderType").val();
    		if(orderType === "PARCEL_SHIPPING"){
	        	var state = $("#cboxLoadedContent #checkoutAddress\\.region").val();
				    ACC.checkout.b2bIsFlorida(state,e.target);
			}else{
				ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.region', '.errorRegion', '#region\\.errors', ERRORMSG.global.state);
			}
    				
    		});
    	$(document).on("input blur", "#cboxLoadedContent #checkoutAddress\\.postcode", function(e)
    		{	
    				if(ACC.formvalidation.validatezipcode(e, $("#cboxLoadedContent #checkoutAddress\\.postcode").val()))
    				{
    					ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors');
    				}
    				else
    				{
    					ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors', ACC.config.zipCodeError);
    				}
    		});

	},
	  
	
	  bindSaveCard:function(){
		  $(document).on("blur", ".card_holder_nickname", function(e)
	    	        { 
	    	  var nickName=$(".card_holder_nickname").val(); 
	      	  e.preventDefault();
	    	    $.ajax({
	    	            url : ACC.config.encodedContextPath +'/checkout/multi/siteone-payment/setSaveCardInSession?nickName='+nickName+'&saveCard=true',
	    	            method:"POST",
	    	            success : function(response)
	    	            {
	    	            	if (response == true) {
	    	            	$(".card_holder_nickname").val('');
			    	            $("#savecard_check" ).prop( "checked", false );
			    	            $( ".card_holder_nickname" ).prop( "disabled", true );
	    	            }
	    	            }
	    	   
	    	        });
		      
	    	        });
	  },
	  bindSaveCardEnabled:function(){
		  $(document).on("click", " #savecard", function(e)
	    	        {
			  $( ".card_holder_nickname" ).prop( "disabled", false );
	    	        });
	    	        },
	 

	bindSearchpopups: function () {

		$(document).on('click', '.new-credit-card', function(e) {
		      e.preventDefault();
		      e.stopImmediatePropagation()
					
						loading.start();
		     
						$.ajax({
							url: ACC.config.encodedContextPath + "/checkout/multi/siteone-payment/getBoardCardTransportKey?isCheckout="+true,
							method: "POST",
		          
							success: function (transportKey) {
								
								if (transportKey != null && transportKey != "Decline") {
									loading.stop();
									var redirecturl = 'https://transport.merchantware.net/v4/TransportMobile.aspx?transportKey=' + transportKey;
									
									
			    	         
			    	            $(".Pop-up-myIframe").attr('src', redirecturl );
			    	            $("#iframe_Popup").show();
			    	            $("#paymentFailedGc").hide();
			    	            $("#cayanFailure").hide();
			    	          $(".card_holder_nickname").val('');
			    	          $( ".card_holder_nickname" ).prop( "disabled", true );
			    	            $("#savecard_check" ).prop( "checked", false );
			    	           
			    	            }
			    	            }
			    	        });
			    	            
			    	        });
	},
	
	paymentRadioButton: function (id,event) 
	{
		
			if (id.val() == 'PAY_ONLINE_WITH_CREDIT_CARD' && $("#asmSession").val() == 'false') {
				if($("#showCreditCard").val() == 'true'){
				$(".payment-to-branch").hide();
				$(".payment-to-online").show();
				$(".payment-to-acount").hide();
				}
				$('#POA_terms').hide();
				$("#payAtBranch").hide();
				$("#div_SITEONE_ONLINE_ACCOUNT .payOnlineAccount-border").hide();
				$("#div_PAY_ONLINE_WITH_CREDIT_CARD .payOnlineCreditCard-border").show();
				$("#payOnline").removeClass("hidden");
				$("#div_PAY_ONLINE_WITH_CREDIT_CARD .card-selected").show();
				$("#iframe_Popup").hide();	
				$("#paymentFailedGc").hide();
				 $("#cayanFailure").hide();
				 $("#cardselectbox").val('');
				 $(".card_holder_nickname").val('');
 	            $("#savecard_check" ).prop( "checked", false );
 	           $( ".card_holder_nickname" ).prop( "disabled", true );
			   
			   var currentBaseStoreId=$(".currentBaseStoreId").val();
			   if(currentBaseStoreId=='CA'){
			   		ACC.checkout.initGlobalPayment();			
			   }
				
			} else if(id.val() == 'SITEONE_ONLINE_ACCOUNT'){
				var paymentType= id.val();			
				$('#paymentMethodValue').val(paymentType);
				$('#POA_terms').show();
				$(".payment-to-branch").hide();
				$(".payment-to-online").hide();
				$(".payment-to-acount").show();
				$('.payment-to-acount').attr('disabled', false);
				$(".step-head-checkout").show();
				$("#div_SITEONE_ONLINE_ACCOUNT .payOnlineAccount-border").show();
				$("#div_SITEONE_ONLINE_ACCOUNT .payOnlineCreditCard-border").hide();
				$("#div_PAY_ONLINE_WITH_CREDIT_CARD .payOnlineCreditCard-border").hide();
				$("#div_PAY_ONLINE_WITH_CREDIT_CARD .card-selected").hide();
				$("#paymentFailedGc").hide();
				 $("#cayanFailure").hide();
				loading.start();
				$.ajax({
    	            url : ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/getAccountInformation",
    	            method:"GET",
    	            success : function(response)
    	            {
    	            	if(null != response && response !="" && response != undefined) {
    	            		loading.stop();
				var opentobuyAmount = response.customerCreditInfo.openToBuy;
				opentobuyAmount = parseFloat(opentobuyAmount);
				$("#openToBuy").val(opentobuyAmount);
				var orderTotal = $('#orderTotal').val();
				orderTotal = parseFloat(orderTotal);
				var termsCode = response.customerCreditInfo.creditTermDescription;
				$("#termsCode").val(termsCode);
				var creditCode = $('#creditCode').val();
				var maxOpenToBuyAmount =  response.customerCreditInfo.maxOpenToBuy;
				$("#maxOpenToBuy").val(maxOpenToBuyAmount);
				if(event =='load')
				{	
					var openToBuyValue=$("input#openToBuy").val();
					$(".openToBuyValue").html(openToBuyValue);
					var termsCodeValue=$("input#termsCode").val();
					$(".termsCodeValue").html(termsCodeValue);
				}
				if(creditCode == "T" || response.customerCreditInfo.creditCode == "T"){
					$(".payment-to-acount").prop("disabled", false);
					$(".payOnline-account-failure").hide();
					$(".payOnline-account-failure-term").hide();
					$('.payment-openToBuy').removeClass('error-message-open-to-buy');
					$('.pay-account-text-error').removeClass('error-message-open-to-buy-text');
					$(".openToBuyValue").html("Open");
				} else if(orderTotal > maxOpenToBuyAmount){						
					$(".payment-to-acount").prop("disabled", true);
					$(".payOnline-account-failure").show();
					$(".payOnline-account-failure-term").hide();
					 $('.payment-openToBuy').addClass('error-message-open-to-buy');
					 $('.pay-account-text-error').addClass('error-message-open-to-buy-text');
				}else if(creditCode == "H" || creditCode == 'K'){
					$(".payment-to-acount").prop("disabled", true);
					$(".payOnline-account-failure-term").show();
					$(".payOnline-account-failure").hide();
					 $('.payment-openToBuy').removeClass('error-message-open-to-buy');
					 $('.pay-account-text-error').removeClass('error-message-open-to-buy-text');
				}
				else{
					$(".payment-to-acount").prop("disabled", false);
					$(".payOnline-account-failure").hide();
					$(".payOnline-account-failure-term").hide();
					$('.payment-openToBuy').removeClass('error-message-open-to-buy');
					$('.pay-account-text-error').removeClass('error-message-open-to-buy-text');

				}
    	            	}else{
    	            		loading.stop();
    	            		$(".payment-to-acount").prop("disabled", true);
    						$(".payOnline-account-failure").show();
    						$(".payOnline-account-failure-term").hide();
    						$(".payment-openToBuy").hide();
    						$(".pay-online-account-terms").hide();
    	            	}
    	            }
				});
			} else if(id.val() == 'PAY_AT_BRANCH') {
				$(".payment-to-branch").show();
				$(".payment-to-online").hide();
				$(".payment-to-acount").hide();
				$('#POA_terms').hide();
				$("#payAtBranch").show();
				$("#paymentFailedGc").hide();
				$("#cayanFailure").hide();
				$("#div_SITEONE_ONLINE_ACCOUNT .payOnlineAccount-border").hide();
				$("#div_PAY_ONLINE_WITH_CREDIT_CARD .payOnlineCreditCard-border").hide();
				
				$("#div_PAY_ONLINE_WITH_CREDIT_CARD .card-selected").hide();
			}
		
	},

	  bindSearchValue:function(){
			$(document).on('click', '.continue-payment-btn', function(e) {
				 var SelectedValue= $("#div_PAY_ONLINE_WITH_CREDIT_CARD .cardselectedValue").val();
			
				e.preventDefault();
	    	    $.ajax({
	    	            url : ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/placeCustomerOrderWithEWallet?vaultToken=" + SelectedValue,
	    	            method:"GET",
	    	            success : function(response)
	    	            {
	    	            	
	    	            	if (response == 'Success') {
	    	            		window.location.href = ACC.config.encodedContextPath +"/checkout/multi/order-summary/view";
								}
	    	           
	    	            }
			});
		});
			$(document).on('click', '#div_PAY_ONLINE_WITH_CREDIT_CARD .cardselectedValue', function(e) {
				
				$("#iframe_Popup").hide();
				$("#paymentFailedGc").hide();
				 $("#cayanFailure").hide();
			})
			
	},
	
	bindGuestUserValue:function(){
		$(document).on('click', '.guest-Signin-overlay-popup', function(e) {
			 e.preventDefault();
			 var guestUser= "guest";
    	    $.ajax({
    	            url : ACC.config.encodedContextPath +"/cart/guestUser?guestUser=" + guestUser,
    	            method:"GET",
    	            success : function(response)
    	            {
	                    $(".cart-guest").removeClass("hidden");
    	            	window.location.href=ACC.config.encodedContextPath +"/cart";

    	            }

	});
		});

	},

	
	bindPayOnAccountValue:function(){
			$(document).on('click', '.continue-payment-poa-btn', function(e) {
				e.preventDefault();
	    	    $.ajax({
	    	            url : ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/placeCustomerOrderWithPOA",
	    	            method:"GET",
	    	            success : function(response)
	    	            {
	    	            	
	    	            	if (response == 'Success') {
	    	            		window.location.href = ACC.config.encodedContextPath +"/checkout/multi/order-summary/view";
								}
	    	            	
	    	           
	    	            }
			});
		});
			
	},
	
	  bindSavedCardpopup:function(){
		$('.cardselectedValue').on('change', function() {

			  $(".continue-payment-btn").attr('disabled', $('option:selected', this).val() == null || $('option:selected', this).val() == '');

			});
	  },

	  showAddressForm:function() {
			$(".shipmentcheck").attr("checked", false);
			$('.sipping-form').show();
			$("#shipping_div").hide();
			$("#shipping_btn").hide();
			$(".shipping-ponumber").addClass("hidden");
		},
	  
	saveContacForm:function(){
		$.ajax({
			url: ACC.config.encodedContextPath + "/checkout/multi/saveContactDetails", 
    		method:"POST",
    		data:$('#SiteOneGCContactForm').serialize(),	
    		
    		success: function(response)
    		{
				if(response && response.isCreditPaymentBlocked == 'Decline_Limit_Over'){
					loading.stop();
					ACC.checkout.isGuestCCDisbaled = true;
					ACC.checkout.guestCCDisbale();
				}
				else {
    			window.scrollTo(0,0);
    			
    			var orderType = $("#orderType").val();
    			
    			$(".contactcheckout").hide();
    			
    			$(".edit-contact-information").show();
    			$(".edit-contact-information_guest").show();
    			
    			$(".checkout-form-data").show();
    			
    			$("#siteOneOrderTypeForm").show();
    		
    			var firstname = response.customerData.firstName;
    			$("#data").html(firstname);
    			
    			var lastname = response.customerData.lastName;
    			$("#lastNamedata").html(lastname);
    			
    			var phonedata = response.customerData.contactNumber;
    			$("#phonedata").html(phonedata);
    			
    			var emaildata = response.customerData.displayUid;
    			$("#emaildata").html(emaildata);
    			
    			var addressdata = response.addressData.line1;
    			$("#addressdata").html(addressdata);
    			
    			var addressdata1 = response.addressData.line2;
    			$("#addressdata1").html(addressdata1);
    			
    			var citydata = response.addressData.town;
    			$("#citydata").html(citydata);
    			
    			var statedata = response.addressData.district;
    			$("#statedata").html(statedata);
				$("#delivery_location").val(statedata);
    			
    			var zipdata = response.addressData.postalCode;
    			$("#zipdata").html(zipdata);
    			
    			if(orderType == "PICKUP"){
    				$(".delivery--content").hide();
		        	$(".pickup--content").show();
					$(ACC.checkout.pickUpDateClass).show();
		        	$(".common-content-pickupDelivery").show();
		        	$(".delivery-chargesMsg").hide();
		        	$(".icon-delivery-charges").hide();
		        	$(".message-delivery").hide();
		            $(".errorPickupDelivery").hide();
		            $(".delivery-details").hide();
		            $(".pickup-title").show();
		            $(".charges-sec").hide();
    			}else if(orderType == "DELIVERY"){
    				var isSameAsContactInfo = response.isSameAsContactInfo;
    				if(isSameAsContactInfo){
    					$("#isSameAsContactInfo").attr("checked", true);
    					$('.deliveryContact-form').hide();
    					 $("#termsPODiv").show();
        $("#delivery_content1").show();
    			    	  $("#delivery_content2").show();
    			    	  $("#pickup-delivery").show();
           $(".payment_cbtn").show();
    			    	  $("#deliveryaddressdata").html(response.addressData.line1);
			        		$("#deliveryaddressdat1").html(response.addressData.line2);
			        		$("#deliverycitydata").html(response.addressData.town);
			        		$("#deliverystatedata").html(response.addressData.district);
							    $("#delivery_location").val(response.addressData.district);
			        		$("#deliveryzipdata").html(response.addressData.postalCode);
    				}else{
    					$("#isSameAsContactInfo").attr("checked", false);
    					$('.deliveryContact-form').show();
    					$("#termsPODiv").hide();
      	$("#delivery_content1").show();
    					$("#delivery_content2").hide();
    			    		$("#pickup-delivery").hide();
    					
    				}
    				$("#delivery_Details").hide();
    				$("#delivery_fee").hide();
		        		$(".edit-delivery-information").hide();
    			}else{
    				$("#parcelShipping_div").show();
    				$(".delivery--content").hide();
    				var isSameAsContactInfo = response.isSameAsContactInfo;
    				var state = response.addressData.district;
					let isNationalShipping = ($(".isNationalShipping").length)? $(".isNationalShipping").val() : 'false';
    				if(isSameAsContactInfo){
    					if(isNationalShipping == 'false' && state != _AAData.storeState){
        					$(".shipmentcheck").attr("disabled", true);
        					ACC.checkout.showAddressForm();
			        		$(".florida-error-msg").removeClass("hidden");
							$(".shipping-ponumber").addClass("hidden");
			        		$(".shipmentcheck").css("pointer-events","none");
        				}else{
        					$(".shipmentcheck").attr("disabled", false);
        					$(".shipmentcheck").attr("checked", true);
    					 	$('.sipping-form').hide();
    					 	$("#shipping_div").show();
		        			$("#shipping_btn").show();
		        			$(".florida-error-msg").addClass("hidden");
							$(".shipping-ponumber").removeClass("hidden");
		        			$("#shippingaddressdata").html(response.addressData.line1);
			        		$("#shippingaddressdat1").html(response.addressData.line2);
			        		$("#shippingcitydata").html(response.addressData.town);
			        		$("#shippingstatedata").html(response.addressData.district);
							$("#delivery_location").val(response.addressData.district);
			        		$("#shippingzipdata").html(response.addressData.postalCode);
        				}
        				
    			 }

			      else{
			    	  if(isNationalShipping == 'false' && state != _AAData.storeState){
        					$(".shipmentcheck").attr("disabled", true);
        					ACC.checkout.showAddressForm();
			        		$(".florida-error-msg").removeClass("hidden");
							$(".shipping-ponumber").addClass("hidden");
        				}else{
        					$(".shipmentcheck").attr("disabled", false);
        					ACC.checkout.showAddressForm();
			        		$(".florida-error-msg").addClass("hidden");
							$(".shipping-ponumber").removeClass("hidden");
        				}
        				
			    }
    				
    				
    			}
    			$(".direction-link").show();
    			$(".edit-pickup-information").hide();
    			$(".input-dateWrapper").off();
    		    $(".input-dateWrapper").on("click",function(){$(".input-dateWrapper #date").trigger("focus");});
    		    
				}
    		
    		}
		})
	},
	checkoutStepEmailValidation:function(){
					
						var selectedValue=$("#checkoutContactemail").val()
						if(selectedValue){
						$.ajax({
						url : ACC.config.encodedContextPath + "/checkout/multi/isEmailAlreadyExists?email=" + selectedValue,
						method:"GET",

						success : function(response) {
							if(response.isSuccess== true)
							{
							if(response.isMailAvailable== true){

						$(".exitEmail-guestCheckout-form").show();
						$(".addContactFormSubmit").prop('disabled', true);
						}
						else{
						$(".exitEmail-guestCheckout-form").hide();
						$(".exitEmail-guestCheckout-formerror").hide();
						$(".addContactFormSubmit").prop('disabled', false);
						}
						}else {
						$(".exitEmail-guestCheckout-formerror").show();
						$(".exitEmail-guestCheckout-form").hide();
						$(".addContactFormSubmit").prop('disabled', true);
						}
						}
						})
					}
						
				},
	bindContactAddressValidations: function (){
		
		$(".edit-contact-information").hide();
		$(".exitEmail-guestCheckout-form").hide();
		$(".exitEmail-guestCheckout-formerror").hide();
		$(".contactForm_guest-checkout-data").hide();
		
		$(document).on("click", ".edit-contact-information", function(e)
				{
			$(".edit-contact-information").hide();
			$("#siteOneOrderTypeForm").hide();
			$(".checkout-form-data").hide();
			$(".contactcheckout").show();
			$("#iframe_Popup_guest").hide();
			 $(".choosepaymentB2b_GC").hide();
			grecaptcha.reset();
				});
		
		$(".edit-contact-information_guest").click(function() {
			if(analyticsPaymentMethodCheck==false){
 						analyticsPaymentMethodCheck= true;
			try{
				 _satellite.track('contactDetails');
				 } catch (e) {}
			}	 
			$(".checkout-form-data").hide();
			$(".contactcheckout").show();
			$("#iframe_Popup_guest").hide();
			$("#siteOneOrderTypeForm").hide();
			grecaptcha.reset();
			$(".edit-contact-information_guest").hide();
			var firstname=$(".contactPersonfirstName").val();
			$("#checkoutContactfirstName").val(firstname);
			var lastname=$(".contactPersonlastName").val();
			$("#checkoutContactlastName").val(lastname);
			var number=$(".contactPersoncontactNumber").val();
			$("#checkoutContactphone").val(number);
			var email=$(".contactPersondisplayUid").val();
			$("#checkoutContactemail").val(email);
			var line1=$(".addressDataline1").val();
			$("#checkoutContactaddressLine1").val(line1);
			var line2=$(".addressDataline2").val();
			$("#checkoutContact.addressLine2").val(line2);
			var town=$(".addressDatatown").val();
			$("#checkoutContactcity").val(town);
			var district=$(".addressDatadistrict").val();
			$("#checkoutContactstate").val(district);
			var postalcode=$(".addressDatapostalCode").val();
			$("#checkoutContactzip").val(postalcode);
		
		});
		
		$(document).on('input blur', "#checkoutContactfirstName", function(e)
	    		{
	    				ACC.formvalidation.vaildateFields('#checkoutContactfirstName','#errorFirstName', '#checkoutContactfirstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
	    		});
		$(document).on('input blur', "#checkoutContactlastName", function(e)
	    		{
	    				ACC.formvalidation.vaildateFields('#checkoutContactlastName','#errorLastName', '#checkoutContactlastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);
	    		});
		
		$(document).on("blur", "#checkoutContactphone", function(e)
				{
					var phoneNumber = $(this).val();
					if(phoneNumber != null && phoneNumber != '' && phoneNumber != undefined)
				    {
				        if (!ACC.formvalidation.validatePhoneNumber(phoneNumber))
		                {
		                    var msg= ACC.config.phoneNumberError ;
		                    ACC.formvalidation.addErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors', msg);
		                }
		                else
		                {
		                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors');
		                }
				    }
				    else
				    {
		            	ACC.formvalidation.addErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors', ERRORMSG.global.phone);
				    }
			    });
				
				$(document).on("input", "#checkoutContactphone", function(e)
				{
					ACC.formvalidation.handlePhoneNumberOnInput('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors');
			    });
				
		    	      
				$(document).on("input blur", "#checkoutContactemail", function (e) {
					e.preventDefault();
					if (ACC.formvalidation.validateEmailPattern($("#checkoutContactemail").val())) {
						ACC.checkout.checkoutStepEmailValidation();
						ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactemail', '#errorEmailAddress', '#checkoutContactemail\\.errors', ERRORMSG.invalid.email);
					}
					else {
						$(".exitEmail-guestCheckout-form").hide();
						$(".exitEmail-guestCheckout-formerror").hide();
						$(".addContactFormSubmit").prop('disabled', false);
						ACC.formvalidation.addErrorClassForRegForm('#checkoutContactemail', '#errorEmailAddress', '#checkoutContactemail\\.errors', ERRORMSG.invalid.email);
					}
				});
				$(document).on("input blur", "#checkoutContactaddressLine1", function()
						{
					        var msg = ERRORMSG.global.address;
					        ACC.formvalidation.vaildateFields('#checkoutContactaddressLine1', '#errorAddressLine1', '#checkoutContactaddressLine1\\.errors', msg);
					    });
				$(document).on('input blur', "#checkoutContactcity", function(e)
						{
							ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutContactcity', '#errorCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutContactcity');
					    });
				$(document).on("input blur", "#checkoutContactzip", function(e)
						{	
							if(ACC.formvalidation.validatezipcode(e, $("#checkoutContactzip").val()))
							{
								ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactzip', '#errorZipcode', '#checkoutContactzip\\.errors');
							}
							else
							{
								ACC.formvalidation.addErrorClassForRegForm('#checkoutContactzip', '#errorZipcode', '#checkoutContactzip\\.errors',ACC.config.zipCodeError);
							}
					    });
				$(document).on("input blur", "#checkoutContactstate", function()
						{
					        var msg = ERRORMSG.global.state;
					        ACC.formvalidation.vaildateFields('#checkoutContactstate', '#errorState', '#checkoutContactstate\\.errors', msg);
					    });
				
				
				$(document).on("click", ".addContactFormSubmit", function(e)
						{
					e.preventDefault();
					var status = true;
					document.getElementById('recaptchaValidator').value = grecaptcha.getResponse();
					ACC.briteverify.reCaptcha(grecaptcha.getResponse());
					ACC.formvalidation.vaildateFields('#checkoutContactfirstName','#errorFirstName', '#checkoutContactfirstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
					ACC.formvalidation.vaildateFields('#checkoutContactlastName','#errorLastName', '#checkoutContactlastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);	
					var msg = ERRORMSG.global.address;
			        ACC.formvalidation.vaildateFields('#checkoutContactaddressLine1', '#errorAddressLine1', '#checkoutContactaddressLine1\\.errors', msg);
			        ACC.formvalidation.vaildateFields('#checkoutContactstate', '#errorState', '#checkoutContactstate\\.errors', ERRORMSG.global.state);
					ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutContactcity', '#errorCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutContactcity');
			        $(".edit-contact-information").show();
					$(".edit-contact-information_guest").addClass("hidden");	
					if(null != $("#checkoutContactphone").val() && $("#checkoutContactphone").val() != '')
				    {
				        if (!ACC.formvalidation.validatePhoneNumber($("#checkoutContactphone").val()))
		                {
		                    var msg= ACC.config.phoneNumberError ;
		                    status = false;
		                    ACC.formvalidation.addErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors', msg);
		                }
		                else
		                {
		                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors');
		                }
				    }
				    else
				    {
				    	status = false;
		            	ACC.formvalidation.addErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors', ERRORMSG.global.phone);
				    }
					if(ACC.formvalidation.validatezipcode(e, $("#checkoutContactzip").val()))
					{
						ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactzip', '#errorZipcode', '#checkoutContactzip\\.errors');
					}
					else
					{
						status = false;
						ACC.formvalidation.addErrorClassForRegForm('#checkoutContactzip', '#errorZipcode', '#checkoutContactzip\\.errors',ACC.config.zipCodeError);
					}
					
					if(ACC.formvalidation.validateEmailPattern($("#checkoutContactemail").val()))
				    {
						 ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactemail', '#errorEmailAddress', '#checkoutContactemail\\.errors', ERRORMSG.invalid.email);
					}
					else
					{
						status = false;
						 ACC.formvalidation.addErrorClassForRegForm('#checkoutContactemail', '#errorEmailAddress', '#checkoutContactemail\\.errors', ERRORMSG.invalid.email);
					}
					
					$('*[id*=error]:visible').each(function() 
							{
								if($(this).html() != '')
								{
									status = false;
								}
							});
					
					
					 if(status)	{
						 var briteverify= document.getElementById('briteVerifyEnable').value;
						 if(briteverify=="true"){
							 url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+$("#checkoutContactemail").val();
							 $.ajax({
					                url: url,
					                type: "GET",
					                timeout: 5000,
						            success: function (response)
						            {
							            if(response == "invalid")
							            {
							            				grecaptcha.reset();
							                          $("#errorEmailAddress").html("<div class=''><font color='red'><div class='panel-body'>Please enter a valid email address.</div></font></div>");   
							            }
							            else
							            {
								            if(status)
								            {
												$.ajax({
													url : ACC.config.encodedContextPath + "/checkout/multi/isEmailAlreadyExists?email=" + $("#checkoutContactemail").val(),
													method:"GET",
							
													success : function(response)
													{
														if(response.isSuccess== true)
														{
														if(response.isMailAvailable== true){
															$(".exitEmail-guestCheckout-form").show();
															$(e.target).prop('disabled', true);
														}
														else{
															$(".exitEmail-guestCheckout-form").hide();
															$(e.target).prop('disabled', false);
															$.ajax({
									        		url:ACC.config.encodedContextPath + "/checkout/multi/validate-address", 
									        		method:"POST",
									        		data:$('#SiteOneGCContactForm').serialize(),		        	
									        		success: function(addressVerificationData){
							                           ACC.address.isAddressChanged = false;
							                           ACC.address.isAddressVerified = true;
									        			if((addressVerificationData.isAddressValid && !addressVerificationData.isAddressCorrected) || addressVerificationData.status.errorCode == '404')
									        			{
									        				ACC.checkout.saveContacForm();
									        			}
									        			else
									        			{ // create pop up content address suggestion
										        			$.colorbox({
																html: createPopupContent(addressVerificationData),					
																maxWidth:"100%",
																width:"550px",
																maxHeight:"100%",
																overflow:"auto",
																opacity:0.7,
																className:"addNotFound invalidOriginalAddress",
																title:false,
																close:'<span class="glyphicon glyphicon-remove"></span>'
															});
									        			}
									                 }
								        		});
														}
														}}})

								            	
								            	
								            	
								            }
							            }
						            },
					           
						          error: function(response, textstatus, message) 
						          {
						        	  grecaptcha.reset();
						                        if(textstatus == "timeout" || textstatus == "error") 
						                        {
						                        	$("#errorEmailAddress").html("<div class=''><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
						                        } 
						          }
							 });
						 }else{
							 ACC.checkout.saveContacForm();
							 try {
			      	          	  _satellite.track("fullfillmentDetails");
			      	          } catch (e) {}
						 }
					 }
						
						});
	},
	
	
	
	
	bindEditFulFilmentDetails: function() {
		
		
		
		$(document).on("change", "#checkoutShippingstate", function(e){
			var msg = ERRORMSG.global.address;
			var stateMsg = ERRORMSG.global.shippingStates;
			ACC.checkout.checkIfFlorida('#checkoutShippingstate', '#errorShippingState', '#checkoutShippingstate\\.errors', msg, stateMsg);
		});
		$(document).on('input blur', "#checkoutdeliverycity", function(e)
		{
			ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutShippingcity', '#errorShippingCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutdeliverycity');
		});
		
		$(document).on("click", ".addShippingFormSubmit", function(e)
				{
			e.preventDefault();
				var status = true;
				ACC.formvalidation.vaildateFields('#checkoutShippingfirstName','#errorShippingFirstName', '#checkoutShippingfirstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
				ACC.formvalidation.vaildateFields('#checkoutShippinglastName','#errorShippingLastName', '#checkoutShippinglastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);	
				var guestmsg = ERRORMSG.global.address;
				var gueststateMsg = ERRORMSG.global.shippingStates;
		        ACC.formvalidation.vaildateFields('#checkoutShippingaddressLine1', '#errorShippingAddressLine1', '#checkoutShippingaddressLine1\\.errors', guestmsg);
				ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutShippingcity', '#errorShippingCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutShippingcity');
				ACC.checkout.checkIfFlorida('#checkoutShippingstate', '#errorShippingState', '#checkoutShippingstate\\.errors', gueststateMsg);			
				if(null != $("#checkoutShippingphone").val() && $("#checkoutShippingphone").val() != '')
			    {
			        if (!ACC.formvalidation.validatePhoneNumber($("#checkoutShippingphone").val()))
	                {
	                    var message= ACC.config.phoneNumberError ;
	                    status = false;
	                    ACC.formvalidation.addErrorClassForRegForm('#checkoutShippingphone', '#errorShippingPhoneNumber', '#checkoutShippingphone\\.errors', message);
	                }
	                else
	                {
	                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutShippingphone', '#errorShippingPhoneNumber', '#checkoutShippingphone\\.errors');
	                }
			    }
			    else
			    {
			    	status = false;
	            	ACC.formvalidation.addErrorClassForRegForm('#checkoutShippingphone', '#errorShippingPhoneNumber', '#checkoutShippingphone\\.errors', ERRORMSG.global.phone);
			    }
				if(ACC.formvalidation.validatezipcode(e, $("#checkoutShippingzip").val()))
				{
					ACC.formvalidation.removeErrorClassForRegForm('#checkoutShippingzip', '#errorShippingZipcode', '#checkoutShippingzip\\.errors');
				}
				else
				{
					status = false;
					ACC.formvalidation.addErrorClassForRegForm('#checkoutShippingzip', '#errorShippingZipcode', '#checkoutShippingzip\\.errors',ACC.config.zipCodeError);
				}
				if(!ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutShippingcity', '#errorShippingCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutShippingcity'))
				{
					status = false;
				}
				if(ACC.formvalidation.validateEmailPattern($("#checkoutShippingemail").val()))
			    {
					 ACC.formvalidation.removeErrorClassForRegForm('#checkoutShippingemail', '#errorShippingEmailAddress', '#checkoutShippingemail\\.errors', ERRORMSG.invalid.email);
				}
				else
				{
					status = false;
					 ACC.formvalidation.addErrorClassForRegForm('#checkoutShippingemail', '#errorShippingEmailAddress', '#checkoutShippingemail\\.errors', ERRORMSG.invalid.email);
				}
				
				$('*[id*=error]:visible').each(function() 
						{
							if($(this).html() != '')
							{
								status = false;
							}
						});
				
				var shippingEmail = $("#checkoutShippingemail").val();
				 if(status)	{
					 	ACC.checkout.briteVerifyEmailvalidation(shippingEmail , status);
						ACC.checkout.showProp65Popup();
				 }
						
			
	});
		
		$(document).on("click", "#Shipping_Edit", function(e){
			$("#parcelShipping_div").show();
			analyticsPaymentMethodCheck= false;
			try {
	          	  _satellite.track("fullfillmentDetails");
	          } catch (e) {}

			$("#shipping_fee").hide();
			$("#iframe_Popup_guest").hide();
			 $(".choosepaymentB2b_GC").hide();
			var isGuestUser = $(".isguestuser").val();
			var state = $("#statedata").html();
			if(isGuestUser == "true"){
				if($(".shipmentcheck").prop('checked')==true){
					if(state != _AAData.storeState || state != 'US-'+_AAData.storeState){
    					$(".shipmentcheck").attr("disabled", true);
    					$(".shipmentcheck").attr("checked", false);
    					$('.sipping-form').show();
				    	 $("#shipping_div").hide();
		        		$("#shipping_btn").hide();
						$(".shipping-ponumber").addClass("hidden");
    				}else{
    					$(".shipmentcheck").attr("disabled", false);
    					$(".shipmentcheck").attr("checked", true);
    					$('.sipping-form').hide();
  					  	$("#shipping_div").show();
  						$("#shipping_btn").show();
  						$(".shipping-ponumber").removeClass("hidden");
    				}
					  
				}
				else{
					if(state != _AAData.storeState || state != 'US-'+_AAData.storeState){
    					$(".shipmentcheck").attr("disabled", true);
    					$(".shipmentcheck").attr("checked", false);
    					$('.sipping-form').show();
				    	 $("#shipping_div").hide();
		        		$("#shipping_btn").hide();
						$(".shipping-ponumber").addClass("hidden");
    				}else{
    					$(".shipmentcheck").attr("disabled", false);
    					$(".shipmentcheck").attr("checked", false);
    					$('.sipping-form').show();
				    	 $("#shipping_div").hide();
		        		$("#shipping_btn").hide();
						$(".shipping-ponumber").addClass("hidden");
    				}
			      }
				$("#shipping_Details").hide();
				$("#shipment_div2").show();
			}else{
				$("#shipping_div").show();
				$("#shipment_div2").show();
				$("#shipping_btn").show();
				$("#shipping_Details").hide();
				$(".shipping-ponumber").removeClass("hidden");
			}
		});
		
		
		$(document).on("click", "#PickUp_Edit", function(e){
			analyticsPaymentMethodCheck= false;
			$(".delivery--content").hide();
	    	$(".pickup--content").show();
			$(ACC.checkout.pickUpDateClass).show();
	    	$(".common-content-pickupDelivery").show();
	    	$(".delivery-chargesMsg").hide();
	    	$(".icon-delivery-charges").hide();
	    	$(".message-delivery").hide();
	        $(".errorPickupDelivery").hide();
	        $(".delivery-details").hide();
	        $(".pickup-title").show();
	        $(".charges-sec").hide();
	        $(".input-dateWrapper").off();
	        $("#pickup_Location_Div").show();
	        $("#pickup_Details").hide();
	        $("#requestedDateData").hide();
	        $("#requestedMeridianData").hide();
	        $("#termsPODiv").show();
		    $(".input-dateWrapper").on("click",function(){$(".input-dateWrapper #date").trigger("focus");});
			$("#iframe_Popup_guest").hide();
			 $(".choosepaymentB2b_GC").hide();
			 if($(".isSplitCartCheckoutPickupPayment").val() == "true"){
				$(".split-shipping-Details").addClass('hidden');
				$(".split-shipping-fee, .splitShippingSection").removeClass('hidden');
				$(".choosepaymentB2b_GC").hide();
			 }
			 try {
           	  _satellite.track("fullfillmentDetails");
           } catch (e) {}
		    
		});
		$(document).on("click", "#Delivery_Edit", function(e){
			analyticsPaymentMethodCheck= false;
			$("#delivery_fee").hide();
			$("#delivery_Details").hide();
			try {
          	  _satellite.track("fullfillmentDetails");
          } catch (e) {}
          
			var isGuestUser = $(".isguestuser").val();
			if(isGuestUser == "true"){
				if($("#isSameAsContactInfo").prop('checked')==true){
					  $('.deliveryContact-form').hide();
					  $("#delivery_content1").show();
					  $("#termsPODiv").show();
			    	  $("#delivery_content2").show();
			    	  $("#pickup-delivery").show();
			    	  $(".payment_cbtn").show();
			    		$("#iframe_Popup_guest").hide();
			    		 $(".choosepaymentB2b_GC").hide();
			    		 
			    		 ACC.checkout.deliveryNewAddressShowForm();
				  }
	
			      else{
			    	  $('.deliveryContact-form').show();
			    	  $("#termsPODiv").hide();
			    	  $("#delivery_content1").show();
			    	  $("#delivery_content2").hide();
			    	  $("#pickup-delivery").hide();
			    	  $(".payment_cbtn").hide();
			    		$("#iframe_Popup_guest").hide();
			    		 $(".choosepaymentB2b_GC").hide();
			    		 ACC.checkout.deliveryNewAddressDetailsShowForm();
			    		 ACC.checkout.deliveryNewAddressHideForm();
			      }
			}
			else{
				$("#delivery_content1").show();
				  $("#termsPODiv").show();
		    	  $("#delivery_content2").show();
		    	  $("#pickup-delivery").show();
		    	  $(".payment_cbtn").show();
			}
			$("#iframe_Popup_guest").hide();
			 $(".choosepaymentB2b_GC").hide();
		});
	},
	
	checkHomeOwnerCase: function () {
		var tradeClass = $(".trade-class").val();
		var subTotalVal = $(".subTotal-class").val();
		var homeOwnerCode = $(".homeOwnerCode").val();
		var subtotalLimit= $(".subtotalLimit").val();
		if (tradeClass == homeOwnerCode && (parseFloat(subTotalVal) < parseFloat(subtotalLimit))) {
	       $('#DELIVERY').prop('disabled', true);
	       $(".homeOwner-msg").removeClass("hidden");
	       $("#DELIVERY").parent().parent().addClass('disable_section');
	       $("label[for='Delivery").addClass('cursor-notallowed');
	    }
		
		
		$(document.body).on("click","#PICKUP",function(){
			$(".homeOwner-msg").addClass("hidden");
		});
		
		if($(".homeOwner-msg").length > 0){
			$('#DELIVERY').prop('checked', false);
			$('#PICKUP').prop('checked', true);
			$(".delivery--content").hide();
			$(".pickup--content").hide();
			$(ACC.checkout.pickUpDateClass).hide();
			$(".common-content-pickupDelivery").show();
			$(".delivery-chargesMsg").hide();
			$(".icon-delivery-charges").hide();
			$(".message-delivery").hide();
			$(".errorPickupDelivery").show();
			}
	},
	isSameDayDeliveryEnabled: function(){
		var currentDate = new Date();
		var morningTimeLimit = new Date();
		let limitTime = $("#deliveryTimeLimit").val();
		limitTime = (limitTime && limitTime != '')? limitTime : '9:00';
		morningTimeLimit.setHours(parseInt(limitTime.split(":")[0]),parseInt(limitTime.split(":")[1]),0,0);
		return (morningTimeLimit > currentDate);
	},
	isAfternoonCheckoutAllowed : function() //before 2:30PM?
	{
		var currentDate = new Date();
		var afternoonTimeLimit = new Date();
		let limitTime = $("#afternoonTimeLimit").val();
		limitTime = (limitTime && limitTime != '')? limitTime : '03:30';
		afternoonTimeLimit.setHours(parseInt(limitTime.split(":")[0]),parseInt(limitTime.split(":")[1]),0,0);
		return (afternoonTimeLimit > currentDate);
	},
	
	isNoonCheckoutAllowed : function() //is AM?
	{
		var noon =12;
		var currentDate = new Date();
		var afternoonTimeLimit = new Date();
		afternoonTimeLimit.setHours(noon);
		afternoonTimeLimit.setMinutes(0);
		return (afternoonTimeLimit > currentDate);
	},
	isMorningCheckoutAllowed : function() //before 9:30AM?
	{
		var currentDate = new Date();
		var afternoonTimeLimit = new Date();
		let limitTime = $("#timeLimit").val();
		limitTime = (limitTime && limitTime != '')? limitTime : '11:00';
		afternoonTimeLimit.setHours(parseInt(limitTime.split(":")[0]),parseInt(limitTime.split(":")[1]),0,0);
		return (afternoonTimeLimit > currentDate);
	},
	dayReturn: function(date){
		let weekday = ["Sun", "Mon", "Tue","Wed", "Thu", "Fri", "Sat"];
		return weekday[date.getDay()];
	},
	isHalfDay: function (date) {
		var currentDate = date;
		var schedule = JSON.parse(document.getElementsByClassName("openingSchedule")[0].value);
		var currentDay = ACC.checkout.dayReturn(currentDate)
		switch (currentDay) {
			case "Mon":
			  num = 0;
			  break;
			case "Tue":
			  num = 1;
			  break;
			case "Wed":
		      num = 2;
			  break;
			case "Thu":
				num = 3;
			  break;
			case "Fri":
				num = 4;
			  break;
			case  "Sat":
				num = 5;
				break;
			case "Sun":
				num = 6;
				break;
		}
		var aftTimeLimit = $("#afternoonTimeLimit").val();
		var afternoonTimeLimitHours = aftTimeLimit.split(":")[0];
		var afternoonTimeLimitMinutes = aftTimeLimit.split(":")[1];
		if (!schedule.weekDayOpeningList[num].closed) {
			var branchCloseTime=schedule.weekDayOpeningList[num].formattedClosingTime
			var branchCloseTimeHr=branchCloseTime.split(':')[0]
			var branchCloseTimeMin = branchCloseTime.split(':')[1]
			if (branchCloseTimeHr < afternoonTimeLimitHours || (branchCloseTimeHr == afternoonTimeLimitHours && branchCloseTimeMin <= afternoonTimeLimitMinutes)) {
				return true;
			}
		}
		return false;
	},
	isOrderPlacedBefore9: function(){
		var currentDate = new Date();
		var morningTimeLimit = new Date();
		let limitTime = $("#deliveryTimeLimit").val();
		limitTime = (limitTime && limitTime != '')? limitTime : '9:00';
		morningTimeLimit.setHours(parseInt(limitTime.split(":")[0]),parseInt(limitTime.split(":")[1]),0,0);
		return (morningTimeLimit > currentDate);
	},
	setDefaultDate: function(){ //Setting default date for Pickup || Delivery
		if($(".page-siteOneCheckoutPage").length && !$(".mixedcart-checkout").length){
			let today = new Date();
			let day = ACC.checkout.dayReturn(today);
			let orderType = $("#orderType").val();
			let timeSlot = "AM";
			let num = 0;
			if(orderType == 'DELIVERY'){
				if(day == "Thu"){
					num = 4;
				}
				else if(day == "Fri"){
					num = 3;
				}
				else if(day == "Sat" || !ACC.checkout.isNoonCheckoutAllowed()){
					num = 2;
				}
				else {
					num = 1;
				}
			}
			else if(orderType == 'PICKUP'){
				if(day == "Sat"){
					num = 2;
				}
				else if(day == "Sun" || !ACC.checkout.isAfternoonCheckoutAllowed()){
					num = 1;
				}
				else if(!ACC.checkout.isMorningCheckoutAllowed()){
					timeSlot = "PM";
				}
			}
			today.setDate(today.getDate() + num);
			today = ACC.checkout.nextAvailableBranchDate(today);
			$("#date").val(ACC.checkout.formatDate(today, 'mdy'));
			$("#date").datepicker("setDate", today);
			$("#termsAndConditions").trigger("click");
			$("#date").trigger("change");
			$("#" + timeSlot).trigger("click");
			$("[for='"+ timeSlot +"']").trigger("click");
		}
	},
	nextAvailableBranchDate: function(today){
		var dateScheduleArray = new Array();
		dateScheduleArray = ACC.checkout.dateSchedule();
		var newDay = today.getDay();
		var newDate = today.getDate();
		while(newDay == dateScheduleArray[newDay] || ((newDay == 0 || newDay == 1) && newDate == 1) || (newDay == 0 && newDate == 31)){
			today.setDate(today.getDate() + 1);
			newDay = today.getDay();
			newDate = today.getDate();
		}
		return today;
	},
	// Finding next working day
	toFindNextWorkingDay: function() {
		let num = 0;
		var schedule = JSON.parse(document.getElementsByClassName("openingSchedule")[0].value);
		while (num <= 6) {
			if (!schedule.weekDayOpeningList[num].closed) {
			return ACC.checkout.toFindNextWorkingDate(schedule.weekDayOpeningList[num].weekDay);
		}
			num++;
		}
	},
	toFindNextWorkingDate: function (dayName) {
		const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
		let dayIndex = daysOfWeek.indexOf(dayName);

		let today = new Date();
		let currentDayIndex = today.getDay();
		let daysUntilNext = (dayIndex + 7 - currentDayIndex) % 7 || 7;
	 
		let nextDay = new Date(today);
		nextDay.setDate(today.getDate() + daysUntilNext);
		return nextDay;
	
	},
	poValueCheck: function(){ 
		var targetName, targetVal;
		if($("#poNumberReq").length){
			targetName = $("#poNumberReq");
		}
		else{
			targetName = $("#PurchaseOrderNumber");
		}
		targetVal = targetName.val().replaceAll("'","").replaceAll('"','');
		targetName.val(targetVal);
	},
	
	poValueCheckonKeyPress: function(event){ 
	 if(navigator.userAgent.match(/iPhone/i) && (event.keyCode=== 34  || event.keyCode === 39)){
		  event.returnValue=false;
	      event.preventDefault();
	      return false; 
      }
	},
	
	nationalShippingChanges: function() {
        if ($("#orderType").val() == "PARCEL_SHIPPING" || $(".isSplitCartCheckoutPickupPayment").val() == "true") {
            $("#div_PAY_AT_BRANCH").css({position: "relative"}).prepend('<div style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; z-index: 99; background: #fff; opacity: .5; width: 100%; height: 100%; cursor: default;"></div>');
			$("#PAY_AT_BRANCH").prop({disabled: true})
        }
    },
    creditcardDisable: function(){
		var s1Acc = $("input[name='radio-group'][id='SITEONE_ONLINE_ACCOUNT']");
		$("input[name='radio-group'][id='PAY_ONLINE_WITH_CREDIT_CARD']").prop('disabled', true);
		if(s1Acc.length > 0 && $("#div_SITEONE_ONLINE_ACCOUNT").is(':visible') == true){
			s1Acc.prop('checked', true);
		}
		else{
			$("input[name='radio-group'][id='PAY_AT_BRANCH']").prop('checked', true);
		}
		$('#div_PAY_ONLINE_WITH_CREDIT_CARD').addClass('disable-click');
	},

	creditcardDisableErrPopup: function(errmsg=null){
		var errSelecter;
		if(errmsg == 'PICKUP' || errmsg == 'PICKUPHOME' || errmsg == 'PICKUPNEARBY' || errmsg == 'FUTURE_PICKUP'){
			errSelecter = 'declinePickupError';
		}
		else if(errmsg == 'DELIVERY' || errmsg == 'STORE_DELIVERY' || errmsg == 'MULTIPLE_DELIVERIES'){
			errSelecter = 'declinePickupError';
		}
		else{
			errSelecter = 'declineShippingError';
		}
		ACC.colorbox.open("", {
				html: $("."+errSelecter).html(),
				width:"600",
				escKey: false,
				overlayClose: false,
				className:"ccdisable-popup",
				onComplete:function(){
				},
			});
	}
  
};   
$( document ).ready(function() {
	//checkout email validation on load
	ACC.checkout.checkoutStepEmailValidation();
	//checkout email validation on load
    $(document.body).on("click",".delivery-mode",function()
		{
			ACC.checkout.bindOrderType();
			ACC.checkout.removeErrorClassForCheckoutForm('#orderTypeRadio', '#errorOrderTypeRadio', '#orderTypeRadio\\.errors')
			
		});
    
    
    
   var failuretested=$("#cayanFailure").val();
  
   if(failuretested =='failure'){
	   ACC.colorbox.open("", {
		   html:  ["<div class='cartShareEmail PopupBox'>",
                  "<p>"+ACC.config.cayan+"</p>",
                   "</div>"].join(''),
          width: '480px',
          height:'auto',
          title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.cayanTitle+"</span></h4>",
          close:'<span class="glyphicon glyphicon-remove"></span>',
          onComplete: function() {
        	   $('#cboxLoadedContent #cboxClose').click(function(){
        		   window.location.href=ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/add";
             		
             		});
       		$("body").css("overflow-y", "hidden");
       		
       	 
       	},
       	onClosed: function() {
       		$('body').css("overflow-y","auto");
       		window.location.href=ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/add";
       	 
       		}
		  });
   }
});

$( document ).ready(function() {
	$("#paymentFailedGc").hide();
	 $("#iframe_Popup_guest").hide();
	var errorAddEwallet=$("#cayanFailure").val();
	
	var guestUser=$(".isguestuser").val();
	var orderType = $("#orderType").val();
	if(guestUser== 'true'){
		var customer= $(".currentCustomer").val();
		if(customer != null && customer != ""){
			if(orderType == "PARCEL_SHIPPING"){
				$("#parcelShipping_div").show();
			}else{
				$("#siteOneOrderTypeForm").show();
			}
		}else{
			if(orderType == "PARCEL_SHIPPING"){
				$("#parcelShipping_div").hide();
			}else{
				$("#siteOneOrderTypeForm").hide();
			}
		}
	}else{
		if(orderType == "PARCEL_SHIPPING"){
			$("#parcelShipping_div").show();
			 
		}else{
			$("#siteOneOrderTypeForm").show();
		}
	}
	

	if(errorAddEwallet != null && errorAddEwallet != ""){
		   ACC.colorbox.open("", {
			   html: $(".add-eroor-card-ewallet").html(),
	       width: '480px',
	       height:'auto',
	       
	       close:'<span class="glyphicon glyphicon-remove"></span>',
	       onComplete: function() {
	    	   $('#cboxLoadedContent #cboxClose').click(function(){
        		   window.location.href=ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/add";
             		
             		});
	    		$("body").css("overflow-y", "hidden");
	    		
	    	 
	    	},
	    	onClosed: function() {
	    		$('body').css("overflow-y","auto");
	    		window.location.href=ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/add";
	    	 
	    		}
			  });
	}
	
	
	
	$(".panel-title-value ").click(function() {
		  $('.collapsed').slideToggle().toggleClass('active');
		  if ($('.collapsed').hasClass('active')) {
			  $('.panel-title-value').html('<span class="glyphicon glyphicon-chevron-up"></span> ');
		  } else {
		    $('.panel-title-value').html('<span class="glyphicon glyphicon-chevron-down"></span> ');
		  }
		});

	$(".hide-products").click(function() {
		 if(screen.width>=1024){
			  $('.checkout-product').slideToggle().toggleClass('active');
			  if ($('.checkout-product').hasClass('active')) {
				  $('.hide-products').html('<span class="glyphicon green-title glyphicon-plus"></span> ');
			  } else {
			    $('.hide-products').html('<span class="glyphicon green-title glyphicon-minus"></span> ');
			  }
		 }
		 else{
			 $('.checkout-product').slideToggle().toggleClass('active');
			  if ($('.checkout-product').hasClass('active')) {
				  $('.hide-products').html('<span class="glyphicon green-title glyphicon-minus"></span> ');
			  } else {
			    $('.hide-products').html('<span class="glyphicon green-title glyphicon-plus"></span> ');
			  }
			 
		 }
		 
		});
	
		$(".hide-pickup-product").click(function() {
			if(screen.width>=1024){
				 $('.checkout-pickup-product').slideToggle().toggleClass('active');
				 if ($('.checkout-pickup-product').hasClass('active')) {
					 $('.hide-pickup-product').html('<span class="glyphicon green-title glyphicon-plus"></span> ');
				 } else {
				   $('.hide-pickup-product').html('<span class="glyphicon green-title glyphicon-minus"></span> ');
				 }
			}
			else{
				$('.checkout-pickup-product').slideToggle().toggleClass('active');
				 if ($('.checkout-pickup-product').hasClass('active')) {
					 $('.hide-pickup-product').html('<span class="glyphicon green-title glyphicon-minus"></span> ');
				 } else {
				   $('.hide-pickup-product').html('<span class="glyphicon green-title glyphicon-plus"></span> ');
				 }
				
			}
			
		   });
		   
		   $(".hide-shipping-product").click(function() {
			if(screen.width>=1024){
				 $('.checkout-shipping-product').slideToggle().toggleClass('active');
				 if ($('.checkout-shipping-product').hasClass('active')) {
					 $('.hide-shipping-product').html('<span class="glyphicon green-title glyphicon-plus"></span> ');
				 } else {
				   $('.hide-shipping-product').html('<span class="glyphicon green-title glyphicon-minus"></span> ');
				 }
			}
			else{
				$('.checkout-shipping-product').slideToggle().toggleClass('active');
				 if ($('.checkout-shipping-product').hasClass('active')) {
					 $('.hide-shipping-product').html('<span class="glyphicon green-title glyphicon-minus"></span> ');
				 } else {
				   $('.hide-shipping-product').html('<span class="glyphicon green-title glyphicon-plus"></span> ');
				 }
				
			}
			
		   });
	});

function paymentContentLoad(e) {
	
	try {
		
		var oIframe =document.getElementById('myIframe');
    	// for compatibility
		
    	var oDoc = oIframe.contentWindow || oIframe.contentDocument;
    	
    	if (oDoc.document) {
    		loading.start();
    		 var  oDoc = oDoc.document;
    		var sPageURL =oDoc.location.search.substring(1); 
    		var sURLVariables = sPageURL.split('&');
    		 for (var i = 0; i < sURLVariables.length; i++) 
    		{ var sParameterName = sURLVariables[i].split('=');
    		 if (sParameterName[1] == 'DECLINED'  || sParameterName[1] == 'User_Cancelled' || sParameterName[1] == 'FAILED') { 
    			
    			 $.ajax({
						url:ACC.config.encodedContextPath + "/checkout/multi/siteone-payment/getBoardCardTransportKey?isCheckout="+true,
						method: "POST",
	          
						success: function (transportKey) {
							if(transportKey && transportKey == 'Decline_Limit_Over'){
								loading.stop();
								ACC.checkout.isGuestCCDisbaled = true;
								ACC.checkout.guestCCDisbale();
								ACC.pendo.captureEvent("3XGUEST");
							}
							else if (transportKey != null && transportKey != "Decline") {
								loading.stop();
								var redirecturl = 'https://transport.merchantware.net/v4/TransportMobile.aspx?transportKey=' + transportKey;
								
								 $(".Pop-up-myIframe ").attr('src', redirecturl );
								 $("#iframe_Popup_guest").show();
								 $("#paymentFailedGc").show();
								 
								 
							}
							else{
								$("#paymentFailedGc").show();
							}
						},
						error: function(){
							$("#paymentFailedGc").show();
						}
					})
    			 
    		 } 
    		 else if(sParameterName[1] == 'APPROVED' ) { 
    			 var pathArray = oDoc.location.search.substring();
    			 $.ajax({
						url:ACC.config.encodedContextPath + "/checkout/multi/siteone-payment/add-ewalletData" +pathArray,
						method: "GET",
	          
						success: function (response) {
							$("#iframe_Popup_guest").hide();
								
							if (response.isRedirectToOrderSummary == true) {
							window.parent.location.href = ACC.config.encodedContextPath +"/checkout/multi/order-summary/view";
							}
							else{
								$("#paymentFailedGc").show();
							}
						},
						error: function(){
							$("#paymentFailedGc").show();
						}
					})
    			 
    		 }
    		}
    	
    	}setTimeout(alertFunction, 10);
    	
    	loading.stop();
    } catch (err) {
	
	}


    


}

$(document).ready(function () {
		sessionStorage.removeItem("IsProp65Shown");
	$('input[name=requestedMeridian]').click(function () {
        $('input[name=requestedMeridian]:not(:checked)').closest(".radio-wrapper").removeClass("selected-time");
        $('input[name=requestedMeridian]:checked').closest(".radio-wrapper").addClass("selected-time");
    });
	
	$("#iframe_Popup_guest").hide();
	 $(".choosepaymentB2b_GC").hide();
	$('.shipmentcheck').change(function() {
		  if(this.checked){
			  $('.sipping-form').hide();
			  $("#shipping_div").show();
  			$("#shipping_btn").show();
  			$(".shipping-Newaddress").hide();
	    	  $(".shipping-Newregion").hide();
	    	  $("#shippingaddressdata").show();
	    	  $("#shippingaddressdat1").show();
	    	  $("#shippingcitydata").show();
	    	  $("#shippingstatedata").show();
	    	  $("#shippingzipdata").show();
			  $(".shipping-ponumber").removeClass("hidden");
		  }

	      else{
	    	  $('.sipping-form').show();
	    	  $("#shipping_div").hide();
  			$("#shipping_btn").hide();
  			$(".shipping-Newaddress").show();
	    	  $(".shipping-Newregion").show();
	    	  $("#shippingaddressdata").hide();
	    	  $("#shippingaddressdat1").hide();
	    	  $("#shippingcitydata").hide();
	    	  $("#shippingstatedata").hide();
	    	  $("#shippingzipdata").hide();
			  $(".shipping-ponumber").addClass("hidden");
	      }

		 });
	
	$('#isSameAsContactInfo').change(function() {
		  if(this.checked){
			  $('.deliveryContact-form').hide();
			  $("#termsPODiv").show();
	    	  $("#delivery_content2").show();
	    	  $("#pickup-delivery").show();
	    	  $(".payment_cbtn").show();
	    	  ACC.checkout.deliveryNewAddressShowForm();

		  }else{
	    	  $('.deliveryContact-form').show();
	    	  $("#termsPODiv").hide();
	    	  $("#delivery_content2").hide();
	    	  $("#pickup-delivery").hide();
	    	  ACC.checkout.deliveryNewAddressDetailsShowForm();
	    	  ACC.checkout.deliveryNewAddressHideForm();
	      }

		 });
	$(document.body).on("change","#date",function() {
		let target = $("#date");
		var selectedDate = new Date(target.datepicker('getDate'));
		var newDate = new Date(target.datepicker('getDate')).toString('mm/dd/YYYY');
		var currentDate = new Date();
		var tomorrowDate = new Date();
		tomorrowDate.setDate(tomorrowDate.getDate() + 1);
		var tomorrow=(tomorrowDate.toDateString() === selectedDate.toDateString())
		var today = (currentDate.toDateString() === selectedDate.toDateString());
		var nextWorkingday=ACC.checkout.toFindNextWorkingDay() //get date of nextworkingday
		var isNextWorkingday = (nextWorkingday.toDateString() === selectedDate.toDateString()); 
		var orderType = $("#orderType").val();
		var inputAM = $('#AM[value="AM"]');
		var inputPM = $('#PM[value="PM"]');
		var inputAllDay = $('#ANYTIME[value="ANYTIME"]');
		inputAllDay.attr('disabled', false).closest(".radio-wrapper").removeClass("elemoverlayparent").find(".elemoverlay").remove();
		inputAM.attr('disabled', false).closest(".radio-wrapper").removeClass("elemoverlayparent").find(".elemoverlay").remove();
		inputPM.attr('disabled', false).closest(".radio-wrapper").removeClass("elemoverlayparent").find(".elemoverlay").remove();
		if(inputAM.prop('checked')){
			inputAM.prop('checked', false).closest(".radio-wrapper").removeClass("selected-time");
		}
		if(inputPM.prop('checked')){
			inputPM.prop('checked', false).closest(".radio-wrapper").removeClass("selected-time");
		}
		if(inputAllDay.prop('checked')){
			inputAllDay.prop('checked', false).closest(".radio-wrapper").removeClass("selected-time");
		}

		$("#requestedDate").val(new Date(ACC.checkout.formatDate(new Date(newDate), 'mdy')));
		target.val(ACC.checkout.formatDate(new Date(newDate), 'mdy'));
		if (orderType == 'PICKUP') {
			if (today) {
				var hr = parseInt($("#timeLimit").val().split(":")[0]);
				var min = parseInt($("#timeLimit").val().split(":")[1]);
				if ((currentDate.getHours() > hr) || (currentDate.getHours() >= hr && currentDate.getMinutes() >= min)) {
					inputAM.attr('disabled', true).closest(".radio-wrapper").removeClass("selected-time").addClass("elemoverlayparent").append('<div class="elemoverlay"></div>');
				}
				if (ACC.checkout.isHalfDay(selectedDate)) {
					inputPM.attr('disabled', true).closest(".radio-wrapper").addClass("elemoverlayparent").append('<div class="elemoverlay"></div>');
				}
			} else {
				if (ACC.checkout.isHalfDay(selectedDate)) {
					inputPM.attr('disabled', true).closest(".radio-wrapper").addClass("elemoverlayparent").append('<div class="elemoverlay"></div>');
				}
			}
		}
		else if (orderType == 'DELIVERY') {
			if (today) {
				inputAM.attr('disabled', true).closest(".radio-wrapper").removeClass("selected-time").addClass("elemoverlayparent").append('<div class="elemoverlay"></div>');
			}
			else if (tomorrow && !ACC.checkout.isOrderPlacedBefore9()) {
				if (ACC.checkout.isHalfDay(selectedDate)) {
					$("#AM").click();
				} else {
					$("#PM").click();
				}
				$(".requested-time").addClass('hidden');
			} else {
				if (currentDate.getDay()==6 || currentDate.getDay()==0) {
                    if (isNextWorkingday) {
                        $(".requested-time").addClass('hidden');
						if (ACC.checkout.isHalfDay(selectedDate)) {
							$("#AM").click();
						} else {
							$("#PM").click();
						}
                    } else {
                        $(".requested-time").removeClass('hidden');
                    }
                } else {
				if (ACC.checkout.isHalfDay(selectedDate)) {
					inputPM.attr('disabled', true).closest(".radio-wrapper").addClass("elemoverlayparent").append('<div class="elemoverlay"></div>');
					inputAllDay.attr('disabled', true).closest(".radio-wrapper").addClass("elemoverlayparent").append('<div class="elemoverlay"></div>');
				}
				$(".requested-time").removeClass('hidden');
			 }
			}
		}
		ACC.checkout.validateCurrentDate();
		if(orderType == 'PICKUP')
		{
			ACC.checkout.validateStoreStatus();
		}		
		ACC.checkout.removeErrorClassForCheckoutForm('#date', '#errorDate', '#date\\.errors');
	}); // ./change - #date function
});

$(document).on("click", "#suggestedValidAddressSubmit", function()
{			
	try{
		_satellite.track('contactDetails');
	} catch (e) {}
	var addressType = $("input[name='address\\.addressSuggestionOption']:checked").val();
	var pageName = $(".pagename").val();
	if(addressType == "suggestedAddress")
	{
		copySuggestedValidAddressToForm();
		if (pageName == 'SiteOne Checkout Page' && $(".isguestuser").val() == 'false') { 
			ACC.checkout.siteoneAddJSONData.line1 = $("#suggestedAddress\\.line1").text();
			ACC.checkout.siteoneAddJSONData.line2 =$("#suggestedAddress\\.line2").text()
			ACC.checkout.siteoneAddJSONData.townCity = $("#suggestedAddress\\.city").text();
			ACC.checkout.siteoneAddJSONData.postcode = $("#suggestedAddress\\.zipcode").text();
		}

		
	} 
	ACC.colorbox.close();
	if(pageName == "Add Edit Address Page" && (addressType == "suggestedAddress" || addressType == "originalAddress") ){
		$("#siteOneAddressForm" ).submit();
	}
	else if(pageName == 'SiteOne Checkout Page' && $(".isguestuser").val() == 'false'){
		
		$.ajax({
			url: ACC.config.encodedContextPath + "/checkout/multi/order-type/add-address", 
			method:"POST",
			data:ACC.checkout.siteoneAddJSONData,
			// Dummy data
			// {
			// 	addressId: '',
			// 	companyName: "Irrigation",
			// 	line1: b2bSAddyl1,
			// 	line2: "",
			// 	townCity: "Woodland Hills",
			// 	regionIso: "US-CA",
			// 	postcode: "91364",
			// 	phone: "",
			// 	countryIso: "US",
			// 	district: "",
			// 	saveInAddressBook:"true",
			// 	defaultAddress:"true",
			// 	_saveInAddressBook: "on",
			// 	},	
			beforeSend: function ()
			{
				loading.start();
			},
			success: function(response)
			{
				ACC.colorbox.close();
				if(null != response && response !="" && response != undefined) {
					$("#addAddressSuccess").html("<font color='green'><div class='panel-body'>"+ACC.config.addressCreated+"</div></font>");
					if ($("#cboxLoadedContent #saveAddressInMyAddressBook").is(":checked"))	{
						$("#deliveryAddress").append( '<option value="'+response[0].id+'" selected>Address: '+response[0].line1+'</option>' );
						if($('.isSplitCartCheckoutPickup').val() == 'true'  && $("#orderType").val() == "PICKUP") {
							$("#splitDeliveryAddress").append( '<option value="'+response[0].id+'" selected>Address: '+response[0].line1+'</option>' );
						}
							$(".deliveryAddresses").val(response[1]);
						$("#deliveryAddress").change();
						$(".delivery-address").html(details);
					} else {
						 var region="";
						 if(response[0].region && response[0].region.isocodeShort){
								region= response[0].region.isocodeShort ;
							}
						 var details =  response[0].line1 + "<BR>" 
										   + response[0].town + ", "
										   + region + " " + response[0].postalCode + "<BR>"
										   + "<div class='newDelivery-phone'> M: <a class='tel-phone' href='tel:"+response[0].phone+"'>"+response[0].phone+"</a></div>";
							
										   
										 
						 ACC.checkout.populateRegionDetails(region);
						 $('#deliveryAddress option')[0].selected = true;
						 if($('.isSplitCartCheckoutPickup').val() == 'true'  && $("#orderType").val() == "PICKUP") {
						 	$("#splitDeliveryAddress option")[0].selected = true;
						 }
							$(".delivery-address").html(details);
							if(!response[0].phone){
								$(".newDelivery-phone").hide();
							 }
						
							 $('.delivery-phone').hide();
						 
							$('#addressId').val(response[0].id);
						if($('.isSplitCartCheckoutPickup').val() == 'true' && $("#orderType").val() == "PICKUP") {
							$("#shippingAddressId").val(response[0].id);
						}
						var contact = $('#contactId').val();
							
							ACC.checkout.populateContactAddress(contact);
							ACC.checkout.checkoutAddressNotSaved = true;
					}
				}
				loading.stop();

			},
			error: function(response, textstatus, message) 
			{
			  loading.stop();
			  if(textstatus == "timeout" || textstatus == "error") 
			  {
				  $("#cboxLoadedContent .addAddressError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>" + ACC.config.unableToAdd + "</div></font></div>");
				  ACC.colorbox.open("", {
					html: "<div><font color='red'><div class='panel-body'>"+ACC.config.unableToAdd+"</div></font></div>",
                    width: "550",
                    height: "auto",
                    close:'<span class="glyphicon glyphicon-remove"></span>',
				})
				} 
				
			},
			complete:function(response){

			}
		});
	}
	else if(pageName != "Add Edit Address Page" && $(".isguestuser").val()=='true'){
		ACC.checkout.saveContacForm();
		try {
			_satellite.track("fullfillmentDetails");
		} catch (e) {}	
	}
});
        
function paymenthB2BGenerate(){
	$.ajax({
		url:ACC.config.encodedContextPath + "/checkout/multi/siteone-payment/payment",
		method: "GET",

		success: function (response) {
			var asmData=response.asm;
			$("#asmSession").val(asmData);
		
			$(".descption-payment-details-B2b").hide();
			
			var ewalletCardNumber=response.ewallet.length;
			
			 for (var i=0; i< response.ewallet.length; i++){
				 $("#cardselectbox").append('<option value="' + response.ewallet[i]["valutToken"] +'">' + response.ewallet[i]["nickName"] +'</option>');
				 
			 }
			 if(ewalletCardNumber>0){
			 $('#cardselectbox').attr('disabled', false);
			 }
			 else{
					$('#cardselectbox').attr('disabled', true);
			 }
			if(response.paymentconfigData.isPOAEnabled == true && response.paymentconfigData.payWithEwallet == true && response.paymentconfigData.payWithCC == true)
				 {
				 if(response.isPOAEnabled == true){
				 $("#SITEONE_ONLINE_ACCOUNT").prop("checked", true);
				 $("#div_SITEONE_ONLINE_ACCOUNT").show();
				 $("#SITEONE_ONLINE_ACCOUNT").val(response.paymentOption[0].code);
					$("#PAY_ONLINE_WITH_CREDIT_CARD").val(response.paymentOption[1].code);
					$("#PAY_AT_BRANCH").val(response.paymentOption[2].code);	//CA Edit $(".currentBaseStoreId").val() == "CA" ? "" : 
					$("#payment_method_radio").val(response.paymentOption[0].code);
					$(".descption-payment-details-B2b").hide();
					
				 }
				 else{
					 $("#div_SITEONE_ONLINE_ACCOUNT").hide();
					 
					
						$("#PAY_ONLINE_WITH_CREDIT_CARD").val(response.paymentOption[0].code);
						$("#PAY_AT_BRANCH").val(response.paymentOption[1].code);	//CA Edit
						$("#payment_method_radio").val(response.paymentOption[0].code);
						$(".descption-payment-details-B2b").hide();
						$(".descption-payment-details").show();
						if($("#showCreditCard").val() == 'true' && $(".currentBaseStoreId").val() != "CA"){	//CA Modified
							$("#PAY_ONLINE_WITH_CREDIT_CARD").prop("checked", true);
							$(".card-selected").show();
						}
						else{
							$("#payment_method_radio").val(response.paymentOption[1].code);
						}
				 }
				 }
			else if(response.paymentconfigData.isPOAEnabled == true && response.paymentconfigData.payWithEwallet == null && response.paymentconfigData.payWithCC == null)
			 {
				if(response.isPOAEnabled == true){
				 $("#SITEONE_ONLINE_ACCOUNT").prop("checked", true);
				 $("#div_SITEONE_ONLINE_ACCOUNT").show();
				 $("#SITEONE_ONLINE_ACCOUNT").val(response.paymentOption[0].code);
					$("#PAY_ONLINE_WITH_CREDIT_CARD").val(response.paymentOption[1].code);
					$("#PAY_AT_BRANCH").val(response.paymentOption[2].code);	//CA Edit
					$("#payment_method_radio").val(response.paymentOption[0].code);
			 $(".descption-payment-details").hide();
			 $("#div_PAY_ONLINE_WITH_CREDIT_CARD").hide();
			
			 
			 $(".card-selected").hide();
			 	 $(".descption-payment-details-B2b").hide();
			 $("#POA_terms").show();
			 $(".descption-payment-details").show();
			 
			 $(".payment-to-branch").hide();
				$(".payment-to-online").hide();
				$(".payment-to-acount").show();
			
			
			 }
				else{
					 $("#PAY_AT_BRANCH").prop("checked", true);
						
					 $("#payment_method_radio").val(response.paymentOption[0].code);
					
						$("#PAY_AT_BRANCH").val(response.paymentOption[0].code);	//CA Edit
						 $("#div_SITEONE_ONLINE_ACCOUNT").hide();
					 $("#div_PAY_ONLINE_WITH_CREDIT_CARD").hide();
				
				 $(".descption-payment-details").show();
				 $(".card-selected").hide();
				 $(".payment-to-branch").show();
					$(".payment-to-online").hide();
					$(".payment-to-acount").hide();
					
				}
			 }
			 else if(response.paymentconfigData.isPOAEnabled == false && response.paymentconfigData.payWithEwallet == true && response.paymentconfigData.payWithCC == true)
			 {
				 
				 $("#div_SITEONE_ONLINE_ACCOUNT").hide();
				 if($(".currentBaseStoreId").val() != "CA"){	//CA Modified
				 $("#PAY_ONLINE_WITH_CREDIT_CARD").prop("checked", true);
				 
				 $(".card-selected").show();
				 $("#payment_method_radio").val(response.paymentOption[0].code);
				 }
				 else{
					$("#payment_method_radio").val(response.paymentOption[1].code);
				 }
					$("#PAY_ONLINE_WITH_CREDIT_CARD").val(response.paymentOption[0].code);
					$("#PAY_AT_BRANCH").val(response.paymentOption[1].code);	//CA Edit
					
					$(".descption-payment-details-B2b").hide();
					$(".descption-payment-details").show();
					if($("#showCreditCard").val() == 'true'){
					$(".payment-to-branch").hide();
					$(".payment-to-online").show();
					$(".payment-to-acount").hide();
					}
			 }
			 
			
			
			 else if(response.paymentconfigData.payWithEwallet == null && response.paymentconfigData.payWithCC == null && response.paymentconfigData.isPOAEnabled == false)
			 {
				 $("#PAY_AT_BRANCH").prop("checked", true);
				
				 $("#payment_method_radio").val(response.paymentOption[0].code);
				
					$("#PAY_AT_BRANCH").val(response.paymentOption[0].code);	//CA Edit
					 $("#div_SITEONE_ONLINE_ACCOUNT").hide();
				 $("#div_PAY_ONLINE_WITH_CREDIT_CARD").hide();
			
			 $(".descption-payment-details").show();
			 $(".card-selected").hide();
			 $(".payment-to-branch").show();
				$(".payment-to-online").hide();
				$(".payment-to-acount").hide();
			
			 
			 }
			bindSelectBranch();
			loading.stop();
			
			if(response.isCreditPaymentBlocked == true){
				ACC.checkout.creditcardDisable();
				ACC.pendo.captureEvent("3XAUTHENTICATED");
			}	
			
		},
		error: function () {
			ACC.myquotes.quotePopupError();
			loading.stop();	
		}
	})
}

function transportKeyGCGenerate(){
	$.ajax({
			url: ACC.config.encodedContextPath + "/checkout/multi/siteone-payment/getBoardCardTransportKey?isCheckout="+true,
			method: "POST",
	
			success: function (transportKey) {
	
				if (transportKey != null && transportKey != "Decline") {
					loading.stop();
					var redirecturl = 'https://transport.merchantware.net/v4/TransportMobile.aspx?transportKey=' + transportKey;
			
					$(".Pop-up-myIframe ").attr('src', redirecturl );
					$("#iframe_Popup_guest").show();
					if(analyticsPaymentMethodCheck==false){
						analyticsPaymentMethodCheck= true;
					try {
		            	  _satellite.track("paymentDetails");
		            } catch (e) {}
					}
				}
			}
		});
}

function paymentContentLoadB2B(e) {
	
	try {
		
		var oIframe =document.getElementById('myIframe');
    	// for compatibility
		
    	var oDoc = oIframe.contentWindow || oIframe.contentDocument;
    	
    	if (oDoc.document) {
    		loading.start();
    		$("#iframe_Popup").hide();
    		 var  oDoc = oDoc.document;
    		 
    		 var pathArray = oDoc.location.search.substring();
			 $.ajax({
					url:ACC.config.encodedContextPath + "/checkout/multi/siteone-payment/add-ewalletData" +pathArray,
					method: "GET",
          
					success: function (response) {
						loading.start();
						 $("#iframe_Popup").hide();
						if (response.isRedirectToOrderSummary == true) {
						window.parent.location.href = ACC.config.encodedContextPath +"/checkout/multi/order-summary/view";
						}
						
						else if(response.isRedirectToOrderSummary == false && response.isSuccessfull == false){
							ACC.checkout.creditcardDisable();
							window.scrollTo(0,0);
							ACC.checkout.creditcardDisableErrPopup(response.errorMessage); //creditcard Disable
							ACC.pendo.captureEvent("3XAUTHENTICATED");
						}						
						else if(!response.isSuccessfull)
							{
							var errror =response.errorMessage;
							$("#cayanFailure").html(errror);
							$("#cayanFailure").show();
							$("#paymentFailedGc").hide();
							  $(".card_holder_nickname").val('');
			    	            $("#savecard_check" ).prop( "checked", false );
			    	            $( ".card_holder_nickname" ).prop( "disabled", true );
							}
						loading.stop();
					}
				})
    		
    		 
    		}
    	loading.stop();
    	
    } catch (err) {
    	
	}


   


}
function bindSelectBranch() {
	
	
	 $("#iframe_Popup").hide();
	$(".payment-to-branch").show();
	$(".payment-to-online").hide();
	$("#payAtBranch").show();
	$(".card-selected").hide();
	  $(".payment-to-acount").hide();
	$('#POA_terms').hide();
	$("#paymentFailedGc").hide();
	 $("#cayanFailure").hide();
	 $(".descption-payment-details-B2b").hide();
	$("#div_SITEONE_ONLINE_ACCOUNT .payOnlineAccount-border").hide();
	$("#div_SITEONE_ONLINE_ACCOUNT .payOnlineCreditCard-border").hide();
	$("#div_PAY_ONLINE_WITH_CREDIT_CARD .payOnlineCreditCard-border").hide();
	$("#div_PAY_ONLINE_WITH_CREDIT_CARD .card-selected").hide();
	$("#PAY_AT_BRANCH .payOnlineCreditCard-border ,#PAY_AT_BRANCH .payOnlineAccount-border").hide();

		var id= $('input:hidden[id="payment_method_radio"]');
		ACC.checkout.paymentRadioButton(id,'load');
	
		$('input:radio[name="radio-group"]').on('change', function(e) {
		ACC.checkout.paymentRadioButton($(this),'change');
	});


}

function createPopupContent(addressVerificationData){
	
	var popupContent = "";	
	
	if (!addressVerificationData.isAddressValid) {
		if ($(".isguestuser").val() == 'false' && $(".pagename").val() == "SiteOne Checkout Page") {
			popupContent ="<p class='m-b-15'>" + ACC.config.veryfyAddressError + "</p><button class='btn btn-default btn-block' onclick=\"$('.newaddress').click()\">" + ACC.config.editAddress + "</button>";
		 }
		else {
			popupContent ="<p class='m-b-15'>" + ACC.config.veryfyAddressError + "</p><button class='btn btn-default btn-block' onclick='ACC.colorbox.close()'>" + ACC.config.editAddress + "</button>";
		}
		
	}
	else if(addressVerificationData.isAddressCorrected){

		if($(".pagename").val() == "Add Edit Address Page"){

			popupContent ="<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ $("#siteOneAddressForm #address\\.line1").val() +"</span><div class='cl'></div>"

			if($("#siteOneAddressForm #address\\.line2").val() != ""){
				popupContent = popupContent +  $("#siteOneAddressForm #address\\.line2").val() +"<div class='cl'></div>";
			}

		   popupContent = popupContent + $("#siteOneAddressForm #address\\.townCity").val() +"<div class='cl'></div>"+ $("#siteOneAddressForm #address\\.region option:selected").text() +"<div class='cl'></div>"+ $("#siteOneAddressForm #address\\.postcode").val() +" </div></div>";

			popupContent = popupContent+"<div class='col-md-6 col-xs-12 margin-top-add'><span class='hidden-md hidden-lg'><br/><br/></span><span class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.suggestedAddress+"</b></span><div class='cl'></div><p></p>";

			popupContent = popupContent+"<div class='add-address-sec'><span id='suggestedAddress.line1'  data-line1='"+addressVerificationData.street+"'>"+ addressVerificationData.street +"</span>";

			popupContent = popupContent+"<span id='suggestedAddress.line2' data-line2='"+addressVerificationData.street2+"'>"+ addressVerificationData.street2+"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.city' data-city='"+addressVerificationData.city+"'>"+ addressVerificationData.city +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.county' data-county='"+addressVerificationData.county+"'>"+ addressVerificationData.county +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.state'  data-state='"+addressVerificationData.state+"'>"+ addressVerificationData.state +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.zipcode'  data-zipcode='"+addressVerificationData.zipcode+"'>"+ addressVerificationData.zipcode +"</span>";

			popupContent = popupContent+"</div></div>  <div class='cl'></div><br><br> <div class='col-md-4 col-sm-6 col-xs-4'><input type='button' class='btn btn-primary btn-block' value='"+ACC.config.save+"' id= 'suggestedValidAddressSubmit'/></div><div class='col-md-4 col-sm-6 col-xs-4'><div class='btn btn-default btn-block' onclick='ACC.colorbox.close()'>" + ACC.config.cancel + "</div></div></form>";

		} else {
			if ($(".isguestuser").val() == 'false') {
				popupContent ="<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ ACC.checkout.b2bAddy1 +"</span><div class='cl'></div>"
		  
			if($("#siteOneAddressForm #checkoutContact\\.addressLine2").val() != ""){
				popupContent = popupContent +  ACC.checkout.b2bAddy2 +"<div class='cl'></div>";
			}
		
		   popupContent = popupContent + ACC.checkout.b2bCity +"<div class='cl'></div>"+ ACC.checkout.b2bSiteoneState+"<div class='cl'></div>"+ ACC.checkout.b2bZip+" </div></div>";
		
			} else { 
				popupContent ="<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ $("#SiteOneGCContactForm #checkoutContactaddressLine1").val() +"</span><div class='cl'></div>"
		  
				if($("#SiteOneGCContactForm #checkoutContact\\.addressLine2").val() != ""){
					popupContent = popupContent +  $("#SiteOneGCContactForm #checkoutContact\\.addressLine2").val() +"<div class='cl'></div>";
				}
		
		   		popupContent = popupContent + $("#SiteOneGCContactForm #checkoutContactcity").val() +"<div class='cl'></div>"+ $("#SiteOneGCContactForm #checkoutContactstate option:selected").text() +"<div class='cl'></div>"+ $("#SiteOneGCContactForm #checkoutContactzip").val() +" </div></div>";
		
			}
			
			popupContent = popupContent+"<div class='col-md-6 col-xs-12 margin-top-add'><span class='hidden-md hidden-lg'><br/><br/></span><span class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.suggestedAddress+"</b></span><div class='cl'></div><p></p>";
		
			popupContent = popupContent+"<div class='add-address-sec'><span id='suggestedAddress.line1'  data-line1='"+addressVerificationData.street+"'>"+ addressVerificationData.street +"</span>";
		
			popupContent = popupContent+"<span id='suggestedAddress.line2' data-line2='"+addressVerificationData.street2+"'>"+ addressVerificationData.street2+"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.city' data-city='"+addressVerificationData.city+"'>"+ addressVerificationData.city +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.county' data-county='"+addressVerificationData.county+"'>"+ addressVerificationData.county +"</span> <div class='cl'></div>";
			
			popupContent = popupContent+"<span id='suggestedAddress.state'  data-state='"+addressVerificationData.state+"'>"+ addressVerificationData.state +"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.zipcode'  data-zipcode='"+addressVerificationData.zipcode+"'>"+ addressVerificationData.zipcode +"</span>";	        						
        					
			popupContent = popupContent+"</div></div>  <div class='cl'></div><br><br> <div class='col-md-4 col-sm-6 col-xs-4'><input type='button' class='btn btn-primary btn-block' value='"+ACC.config.save+"' id= 'suggestedValidAddressSubmit'/></div><div class='col-md-4 col-sm-6 col-xs-4'><div class='btn btn-default btn-block' onclick='ACC.colorbox.close()'>" + ACC.config.cancel + "</div></div></form>";
		}		
	}
	return popupContent;
}

function copySuggestedValidAddressToForm()
{
	if($(".pagename").val() == "Add Edit Address Page"){

		$("#siteOneAddressForm #address\\.line1").val($("#suggestedAddress\\.line1").data("line1"));
		$("#siteOneAddressForm #address\\.line2").val($("#suggestedAddress\\.line2").data("line2"));
		$("#siteOneAddressForm #address\\.townCity").val($("#suggestedAddress\\.city").data("city"));
		$("#siteOneAddressForm #address\\.region").val($("#siteOneAddressForm #address\\.country").val()+"-"+$("#suggestedAddress\\.state").data("state"));
		$("#siteOneAddressForm #address\\.postcode").val($("#suggestedAddress\\.zipcode").data("zipcode"));

	} else {
			$("#SiteOneGCContactForm #checkoutContactaddressLine1").val($("#suggestedAddress\\.line1").data("line1"));
			$("#SiteOneGCContactForm #checkoutContact\\.addressLine2").val($("#suggestedAddress\\.line2").data("line2"));
			$("#SiteOneGCContactForm #checkoutContactcity").val($("#suggestedAddress\\.city").data("city"));
			$("#SiteOneGCContactForm #checkoutContactstate").val($("#suggestedAddress\\.state").data("state"));
			$("#SiteOneGCContactForm #checkoutContactzip").val($("#suggestedAddress\\.zipcode").data("zipcode"));
			//$("#SiteOneGCContactForm #address\\.district").val($("#suggestedAddress\\.county").data("county"));
		
	}


}
ACC.mixedcartcheckout = {
	_autoload: [
		"bindCheckO",
		"deliveryModeSelection",
		"bindAddPhone",
		"binbOrderSubmitMethod",
		"addNewAddressCheckout",
		"bindAddressValidations",
		"bindAddAddressSubmit",
		"bindSelectBranch",
		"checkHomeOwnerCase",
		"bindContactAddressValidations",
		"bindEditFulFilmentDetails",
		"checkoutStepEmailValidation",
		"bindSingleCheckout",
    	"paymentPOCheck",
    	"yourItemsScroll"
	],
	checkIfFlorida :function(id, errorid, errorPath, errMsg, errStateMsg){
		
        ACC.formvalidation.vaildateShippingState(id, errorid, errorPath, errMsg, errStateMsg);

	},
	removeErrorClassForCheckoutForm: function (input, error, errorText)
	{
		$(error).html('');
		$(input).removeAttr('style');
		$(error).removeAttr('style');
		$(input).css("background", "#aaaaaaa");
		$(input).css("border-color", "#cccccc");
		$(input + "\\.errors").hide();
		$(errorText).html('');
	},
	bindCheckO: function ()
	{
		var cartEntriesError = false;
		$('.doFlowSelectedChange').on('change',function  ()
		{
			if ('multistep-pci' == $('#selectAltCheckoutFlow').val())
			{
				$('#selectPciOption').show();
			}
			else
			{
				$('#selectPciOption').hide();

			}
		});



		$('.js-continue-shopping-button').on('click',function  ()
		{
			var checkoutUrl = $(this).data("continueShoppingUrl");
			window.location = checkoutUrl;
		});
		
		$('.js-create-quote-button').on('click',function  ()
		{
			$(this).prop("disabled", true);
			var createQuoteUrl = $(this).data("createQuoteUrl");
			window.location = createQuoteUrl;
		});

		
		$('.expressCheckoutButton').on('click',function ()
				{
					document.getElementById("expressCheckoutCheckbox").checked = true;
		});
		
		$(document).on("input",".confirmGuestEmail,.guestEmail",function(){
			  
			  var orginalEmail = $(".guestEmail").val();
			  var confirmationEmail = $(".confirmGuestEmail").val();
			  
			  if(orginalEmail === confirmationEmail){
			    $(".guestCheckoutBtn").removeAttr("disabled");
			  }else{
			     $(".guestCheckoutBtn").attr("disabled","disabled");
			  }
		});
		
	},
	bindSingleCheckout: function(){
		var stepnumber = 1;
		var addressnumber=1;
		let deliveryNumber=1;
		 $('.contact-data-box').each(function() {
		    $(this).find(".numberCircle-div").append('<span class="numberCircle"> ' + stepnumber + ' </span>');
		    stepnumber++;
		});
		if($('.pickup-mixedcart-location').length > 1){
			$('.pickup-mixedcart-location').each(function() {
				$(this).find(".address-number").append('<span class="numberorder">'+" #"+addressnumber+' </span>');
					addressnumber++;
			});
		}
		if($('.delivery-mixedcart-location').length > 1){
			$('.delivery-mixedcart-location').each(function() {
				$(this).find(".address-number").append('<span class="numberorder">'+" #"+deliveryNumber+' </span>');
					deliveryNumber++;
			});
		}
		$(document).on("click", ".submit-ordertype-data", function(e)
		{
			var target = $(this);
			let targetNum = Number(target.attr("data-aconum"));
			let targetType = target.attr("data-type");
			let error;
			var guestUser=$(".isguestuser").val();
			if(guestUser == "true"){ //checking for shipping same state
				if(targetType == "shipping" && $(".mixedcart-"+ targetType +"-check").prop("checked") && $("#mixedcart-"+ targetType +"statedata").html() != _AAData.storeState){
					$(".same-"+ targetType +"-state-error").removeClass("hidden");
					error = true;
				}
			}
			else
			{
				if($("."+ targetType +"Error").length && targetType == "shipping" && $("."+ targetType +"-region").html() != _AAData.storeState){
					ACC.mixedcartcheckout.checkIfFlorida('#MixedcartShippingAddress', '#errorShippingAddressRadio', '#MixedcartShippingAddress\\.errors', ERRORMSG.global.address, ERRORMSG.global.shippingStates);
					error = true;
				}
			}
			if(!error){
				
				var bigbagInstruction=$(".isbigBagInstruction").val() || '';

				var checkoutData=$('#siteOneOrderTypeForm').serialize().split('&').map((y)=>{
					if(bigbagInstruction.length){
					var yData = y.split("=")[1] || '';
					return y.startsWith('specialInstruction=') ? 'specialInstruction='+ bigbagInstruction + ' '+ yData : y
					}
					else{
						return y;
					}
					}).join('&');
					
			$.ajax({
				url: ACC.config.encodedContextPath + "/checkout/multi/saveFulfilmentOptions", 
				method:"POST",
				data:checkoutData,	
				
				success: function(response)
				{
					
					var taxAmount = response.cartData.totalTax.formattedValue;
					$("#taxValue").html(taxAmount);
					
					var totalAmountWithTax = response.cartData.totalPriceWithTax.formattedValue;
					$("#totalPriceWithTax").html(totalAmountWithTax);
					var deliveryFees = response.cartData.deliveryFreight;
					if(deliveryFees != null){
						$("#deliveryfees").html("$"+deliveryFees);
						$("#delivery_cost").html("$"+deliveryFees);
					}else{
						$("#deliveryfees").html("$0.00");
						$("#delivery_cost").html("$0.00");
					}
					if(targetType == "pickup"){
						ACC.checkout.showProp65Popup(targetType);
						$("#pickup_Details").show();
						$(".direction-link").hide();
						$("#pickup-delivery").hide();
						$("#pickup_Location_Div").hide();
						$(".edit-pickup-information").show();
					}
					else if(targetType == "delivery"){
						ACC.checkout.showProp65Popup(targetType);
						$(".direction-link").show();
						$(".shipping_fee").show();
					}
					else{ //(targetType == "shipping")
					
					}
					
					
					if(guestUser== 'true'){
						ACC.mixedcartcheckout.transportKeyGCGenerateMxedCart();
						ACC.mixedcartcheckout.openNextBlockAccordion(targetType, targetNum, "#iframe_Popup_guest");
					}
					else if(guestUser== 'false'){
						paymenthB2BGenerate();
						ACC.mixedcartcheckout.openNextBlockAccordion(targetType, targetNum, ".choosepaymentB2b_GC");
						 bindSelectBranch();
						 loading.stop();
					}
				}
			});
			
			
			}
			
			});

		
		$(document).on("click", "#mixedCartEditPickup", function(){
			ACC.mixedcartcheckout.closeOpenBloc("pickup");
		});
	},
	populateContactAddress: function(contact,mode){
		    if(contact != null && contact != '' && contact != undefined)
					{
						var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
						if(mode=="shipping")
						{
								jQuery.each(customers, function(i, val)
						{
							if(val.displayUid === contact)
							{
								if(val.contactNumber != null && val.contactNumber != '' && val.contactNumber != undefined)
								{
									$(".shipping-phone").html("m: <a class='tel-phone' href='tel:"+val.contactNumber+"'>"+val.contactNumber+"</a>");
								}
								else
								{
									$(".shipping-phone").html("m: NA");
								}
							}
						 });
						
						}
						else{
						jQuery.each(customers, function(i, val)
						{
							if(val.displayUid === contact)
							{
								if(val.contactNumber != null && val.contactNumber != '' && val.contactNumber != undefined)
								{
									$(".delivery-phone").html("m: <a class='tel-phone' href='tel:"+val.contactNumber+"'>"+val.contactNumber+"</a>");
								}
								else
								{
									$(".delivery-phone").html("m: NA");
								}
							}
						 });
						}
						
						
					}
		    },
		    
		    
	deliveryModeSelection: function()
    {	
		if($(".mixedcart-checkout").length)
		{
		if($("#pageId").val() == 'siteOneCheckoutPage')
		{
			var contact = null;
			if(null != $('#contactId').val() || $('#contactId').val() != "")
			{
			  contact = $('#contactId').val();
			}
			else
			{
			  contact = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value).displayUid;
			}

			ACC.mixedcartcheckout.populateContactDetails(contact,null);

			
			var selectedValue = $('#MixedcartdeliveryAddress').find(":selected").val();
	         var selectedValue1 = $('#MixedcartShippingAddress').find(":selected").val();
			  if(selectedValue != 'selectDefault')
			  {
					$('#deliveryAddressId').val(selectedValue);
				  	ACC.mixedcartcheckout.populateAddressDetails($('#deliveryAddressId').val(),$('#MixedcartdeliveryAddress').data('mode'));
					$('#shippingAddressId').val(selectedValue1);
				  ACC.mixedcartcheckout.populateAddressDetails($('#shippingAddressId').val(),$("#MixedcartShippingAddress").data('mode'));
				  $('#addressId').val(selectedValue);
				  ACC.mixedcartcheckout.populateAddressDetails($('#addressId').val(),null);
			  }
			  else
			  {
				  $('.delivery-phone').html('');
		          $('.shipping-phone').html('');
			  }

			ACC.mixedcartcheckout.removeErrorClassForCheckoutForm('#deliveryAddressRadio', '#errorDeliveryAddressRadio', '#deliveryAddressRadio\\.errors');
		}

		
		
		$(document.body).on("input blur","#poNumberReq",function()
				{
					ACC.mixedcartcheckout.removeErrorClassForCheckoutForm('#poNumberReq', '#errorPONumberRequired', '#poNumberReq\\.errors');
				});
	
		$(document.body).on("change",".requested-time",function()
		{
			ACC.mixedcartcheckout.removeErrorClassForCheckoutForm('#meridianRadio', '#errorMeridianRadio', '#meridianRadio\\.errors');
		});
		
		$(document.body).on("click",".saveCustomerSelection",function()
		{
			var selectedValue = $('#customers').find(":selected").val();
			$('#contactId').val(selectedValue);
			ACC.mixedcartcheckout.populateContactDetails(selectedValue,null);
			ACC.colorbox.close();
		});
		
		
		$(document.body).on("click",".saveCustomerSelectionB2bUserMixedCart",function(e)
				{
					var selectedValue = $('#customers').find(":selected").val();
				    var deliveryMode=$(this).data('mode');
					  e.preventDefault();
			    	    $.ajax({
			    	            url : ACC.config.encodedContextPath + "/checkout/multi/update-contact?uid=" + selectedValue+"&deliveryMode="+deliveryMode,
			    	            method:"POST",
			    	          
			    	            success : function(response)
			    	            {
	              			                      if(deliveryMode==null){
										 $('#contactId').val(selectedValue);
										}
										  else
										{ 
										      if(deliveryMode=="pickup"){
										          	    $('#contactId').val(selectedValue);
										      }else if(deliveryMode=="standard-net"){
										      	$('#deliveryContactId').val(selectedValue);
										      }else{
										      	$('#shippingContactId').val(selectedValue);
										      }
				                        }
			    	            	
			    					ACC.mixedcartcheckout.populateContactDetails(selectedValue,deliveryMode);
			    					ACC.colorbox.close();
			    					$(".data-update").hide();
			    	            }
			    	    });
				});
		
		$(document).on("change","#MixedcartdeliveryAddress",function()
		{	
			var selectedValue = $('#MixedcartdeliveryAddress').val();
			var deliveryMode = $(this).data('mode');
			$('#deliveryAddressId').val(selectedValue);
			ACC.mixedcartcheckout.populateAddressDetails(selectedValue, deliveryMode);
			ACC.mixedcartcheckout.populateContactAddress($('#deliveryContactId').val(), deliveryMode);
			
		});
		$(document).on("change","#MixedcartShippingAddress",function()
		{
			var deliveryMode = $(this).data('mode');
			var address = $('#MixedcartShippingAddress').val();
		 	$('#shippingAddressId').val(address);
			ACC.mixedcartcheckout.populateAddressDetails(address, deliveryMode);
			if($(".shipping-region").html() != _AAData.storeState){
				ACC.mixedcartcheckout.checkIfFlorida('#MixedcartShippingAddress', '#errorShippingAddressRadio', '#MixedcartShippingAddress\\.errors', ERRORMSG.global.address, ERRORMSG.global.shippingStates)
			}
			else{
				ACC.mixedcartcheckout.removeErrorClassForCheckoutForm('#MixedcartShippingAddress', '#errorShippingAddressRadio', '#MixedcartShippingAddress\\.errors');
			}
			ACC.mixedcartcheckout.populateContactAddress($('#shippingContactId').val(), deliveryMode);
		});
 	   
		$(document).on("change","#customers",function()
		{	
			var selectedValue = $('#customers').find(":selected").val();
			var selectedCustomer = null;
			if(document.getElementsByClassName("allCustomers")[0].value != "")
			{
				var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
				jQuery.each(customers, function(i, val)
				{
					if(val.displayUid === selectedValue)
					{
						selectedCustomer = val;
					}
				 });
			 }
			else
			{
					selectedCustomer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
			}
			
			if(null != selectedCustomer)
			{
				if(selectedCustomer.contactNumber == undefined)
				{
					var details = selectedCustomer.name + "<BR>m: " + "NA" + "<BR>" + selectedCustomer.displayUid;
					 $(".popup-contact-details").html(details);
				}
				else
				{
					 var details = selectedCustomer.name + "<BR>m: " + selectedCustomer.contactNumber + "<BR>" + selectedCustomer.displayUid;
					 $(".popup-contact-details").html(details);
				}
			}
		});
		
		$(document.body).on("click",".mixCartChangeContact",function(e)
		{
			e.preventDefault();
			try{
				 _satellite.track('contactDetails');
				 } catch (e) {}
			if(document.getElementsByClassName("allCustomers")[0].value != "")
			{
			    var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
				var option = null;
				var selectedCustomerVal = null;
				var selectedCustomer = $("#contactId").val();
				var orderType = this.id;
				var deliveryMode=null;
				var orderTypeDisplayText = "";
				if(orderType == 'pickUpChangeContact') {
					orderTypeDisplayText = "Pickup contact1";
					deliveryMode="pickup"
				} else if(orderType == 'deliveryChangeContact') {
					orderTypeDisplayText = "Delivery contact";
					deliveryMode="standard-net";
				}else{
					orderTypeDisplayText ="Shipping Contact"
					deliveryMode="shipping";
				}
				
				jQuery.each(customers, function(i, val)
				{
					if(null != selectedCustomer && selectedCustomer != "" && val.email === selectedCustomer)
	            	{
						selectedCustomerVal = val;
						if(null != option)
						{
							option = option + '<option value="' + val.email + '"selected>' + val.name + '</option>';
						}
						else
						{
							option = '<option value="' + val.email + '"selected>' + val.name + '</option>';
						}
	            	}
					else
					{
						if(null != option)
						{
							option = option + '<option value="' + val.email + '">' + val.name + '</option>';
						}
						else
						{
							option = '<option value="' + val.email + '">' + val.name + '</option>';
						}
					}
				});
			}
			else
			{
				var customer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
				var option = null;
				var selectedCustomerVal = null;
				var selectedCustomer = customer;
				var orderType = this.id;
				var orderTypeDisplayText = "";
				if(orderType == 'pickUpChangeContact') {
					orderTypeDisplayText = "Pickup contact";
				} else {
					orderTypeDisplayText = "Delivery contact";
				}
				if(null != selectedCustomer && selectedCustomer != "" && customer.displayUid === selectedCustomer)
                {
						selectedCustomerVal = customer;
						if(null != option)
						{
							option = option + '<option value="' + customer.displayUid + '"selected>' + customer.name + '</option>';
						}
						else
						{
							option = '<option value="' + customer.displayUid + '"selected>' + customer.name + '</option>';
						}
			     }
				else
				{
					if(null != option)
					{
						option = option + '<option value="' + customer.displayUid + '">' + customer.name + '</option>';
					}
					else
					{
						option = '<option value="' + customer.displayUid + '">' + customer.name + '</option>';
					}
				}
			}
				var selectBox = "<select id='customers' class='form-control'>" + option + "</select>";
				if(null == selectedCustomerVal)
				{
					selectedCustomerVal = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
				}
				
				var details = selectedCustomerVal.name  + (selectedCustomerVal.contactNumber?"<BR>m: "+selectedCustomerVal.contactNumber:"<BR>m: NA " )+ "<BR>" +selectedCustomerVal.displayUid;
				if($(window).width()<=800){
					$("#colorbox #cboxMiddleLeft").remove();
					$("#colorbox #cboxMiddleRight").remove();
					
				}
				$.colorbox({
				html: "<div class='PopupBox pickOrDelivery-changeContact'>" +
						"<label for='customers'>" + orderTypeDisplayText  + "<br></label><div class='pickupContact'>" + selectBox +"</div><br/>" +
						"</div> " +
						"<div class='popup-contact-details'> "+ details + "</div>" +
						"<div class='row'>" +
						"<div class='confrimbtnBox col-xs-12 col-md-6 col-sm-12'>" +
						"<button type='button' id='save' class='saveCustomerSelectionB2bUserMixedCart btn btn-ConfirmMessage btn-primary btn-block' data-mode="+deliveryMode+">"+ACC.config.save+"</button>" +
						"</div>" +
						"<div class='confrimbtnBox  col-xs-12 col-md-6 col-sm-12'>" +
						"<button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >"+ACC.config.cancel+"</button>" +
						"</div>" +
						"</div>" ,
				maxWidth:"100%",
				width:"600px",
				maxHeight:"100%",
				overflow:"auto",
				opacity:0.7,
				title:"<h1 class='headline'>"+ACC.config.selectAnotherContact+"</h1>",
				close:'<span class="glyphicon glyphicon-remove"></span>',
				onComplete: function(){
					$("#colorbox").addClass("change-contact-colorbox");
					$("#colorbox").removeClass("addAddress-checkout");
					$("body").css("overflow-y", "hidden");
				},
				onClosed: function(){
					$("body").css("overflow-y", "auto");
					$("#colorbox").removeClass("change-contact-colorbox");
				}
				
				});
				
		});
		
		$(document.body).on("click",".changeContactb2b",function(e)
				{
					e.preventDefault();
					if(document.getElementsByClassName("allCustomers")[0].value != "")
					{
					    var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
						var option = null;
						var selectedCustomerVal = null;
						var selectedCustomer = $("#contactId").val();
						var orderType = this.id;
						var orderTypeDisplayText = "";
						if(orderType == 'pickUpChangeContact') {
							orderTypeDisplayText = "Pickup contact1";
						} else {
							orderTypeDisplayText = "Delivery contact";
						}
						
						jQuery.each(customers, function(i, val)
						{
							if(null != selectedCustomer && selectedCustomer != "" && val.email === selectedCustomer)
			            	{
								selectedCustomerVal = val;
								if(null != option)
								{
									option = option + '<option value="' + val.email + '"selected>' + val.name + '</option>';
								}
								else
								{
									option = '<option value="' + val.email + '"selected>' + val.name + '</option>';
								}
			            	}
							else
							{
								if(null != option)
								{
									option = option + '<option value="' + val.email + '">' + val.name + '</option>';
								}
								else
								{
									option = '<option value="' + val.email + '">' + val.name + '</option>';
								}
							}
						});
					}
					else
					{
						var customer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
						var option = null;
						var selectedCustomerVal = null;
						var selectedCustomer = customer;
						var orderType = this.id;
						var orderTypeDisplayText = "";
						if(orderType == 'pickUpChangeContact') {
							orderTypeDisplayText = "Pickup contact";
						} else {
							orderTypeDisplayText = "Delivery contact";
						}
						if(null != selectedCustomer && selectedCustomer != "" && customer.displayUid === selectedCustomer)
		                {
								selectedCustomerVal = customer;
								if(null != option)
								{
									option = option + '<option value="' + customer.displayUid + '"selected>' + customer.name + '</option>';
								}
								else
								{
									option = '<option value="' + customer.displayUid + '"selected>' + customer.name + '</option>';
								}
					     }
						else
						{
							if(null != option)
							{
								option = option + '<option value="' + customer.displayUid + '">' + customer.name + '</option>';
							}
							else
							{
								option = '<option value="' + customer.displayUid + '">' + customer.name + '</option>';
							}
						}
					}
						var selectBox = "<select id='customers' class='form-control'>" + option + "</select>";
						if(null == selectedCustomerVal)
						{
							selectedCustomerVal = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
						}
						
						var details = selectedCustomerVal.name  + (selectedCustomerVal.contactNumber?"<BR>m: "+selectedCustomerVal.contactNumber:"<BR>m: NA " )+ "<BR>" +selectedCustomerVal.displayUid;
						if($(window).width()<=800){
							$("#colorbox #cboxMiddleLeft").remove();
							$("#colorbox #cboxMiddleRight").remove();
							
						}
						$.colorbox({
						html: "<div class='PopupBox pickOrDelivery-changeContact'>" +
								"<label for='customers'>" + orderTypeDisplayText  + "<br></label><div class='pickupContact'>" + selectBox +"</div><br/>" +
								"</div> " +
								"<div class='popup-contact-details'> "+ details + "</div>" +
								"<div class='row'>" +
								"<div class='confrimbtnBox col-xs-12 col-md-6 col-sm-12'>" +
								"<button type='button' id='save' class='saveCustomerSelectionB2bUserMixedCart btn btn-ConfirmMessage btn-primary btn-block'>"+ACC.config.save+"</button>" +
								"</div>" +
								"<div class='confrimbtnBox  col-xs-12 col-md-6 col-sm-12'>" +
								"<button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >"+ACC.config.cancel+"</button>" +
								"</div>" +
								"</div>" ,
						maxWidth:"100%",
						width:"600px",
						maxHeight:"100%",
						overflow:"auto",
						opacity:0.7,
						title:"<h1 class='headline'>"+ACC.config.selectAnotherContact+"</h1>",
						close:'<span class="glyphicon glyphicon-remove"></span>',
						onComplete: function(){
							$("#colorbox").addClass("change-contact-colorbox");
							$("#colorbox").removeClass("addAddress-checkout");
							$("body").css("overflow-y", "hidden");
						},
						onClosed: function(){
							$("body").css("overflow-y", "auto");
							$("#colorbox").removeClass("change-contact-colorbox");
						}
						
						});
				});
				
		
		$(document.body).on("change","#termsAndConditions",function()
		{
			ACC.mixedcartcheckout.removeErrorClassForCheckoutForm('#termsAndConditions', '#errorTermsAndConditionsCheckBox', '#termsAndConditions\\.errors');
		});
		
		 $(document).on("click","#termsAndConditionsPopup", function(e){
			    window.scrollTo(0,0);
			    e.preventDefault();
		        var url = ACC.config.encodedContextPath + "/checkout/multi/termsandcondition";
		        loading.start();
		        ACC.colorbox.open("",{
		            href: url,
		            maxWidth:"100%",
		            width:"621px",
		            overflow:"hidden",
		            height:"650px",
		            initialWidth :"380px",
		            onComplete:function(){ 
	                    loading.stop();
	                    $("#colorbox").addClass("termsAndConditionsBox");
	                },
	                onClosed: function(){
				       $("#colorbox").removeClass("termsAndConditionsBox");
					}
		        });
		    });
		 
		 $(document).on("click", ".termsAndConditionsClose", function()
		 {
	 			ACC.colorbox.close();
		 });
		 }
    },
    populateContactDetails: function(contact,deliveryMode)
    {
    	var selectedCustomer = null;
    	if(document.getElementsByClassName("allCustomers")[0].value != "")
    	{
		var customers = JSON.parse(document.getElementsByClassName("allCustomers")[0].value);
        
        jQuery.each(customers, function(i, val)
		{
	       	if(val.email === contact)
	       	{
	       		selectedCustomer = val;
	       	}
		});
    	}
    	else
    	{
    		selectedCustomer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
    	}
        
        if(null == selectedCustomer)
		{
        	selectedCustomer = JSON.parse(document.getElementsByClassName("currentCustomer")[0].value);
		}
        
        if(selectedCustomer.contactNumber == undefined)  
        {
        	var details = selectedCustomer.name + "<BR><span id='contactPhoneDetails'>M " + "NA" + "</span><BR>" + selectedCustomer.displayUid;
	       if(deliveryMode==null)
	       {
		      	$(".contact-details").html(details);
				$(".delivery-contact-details").html(details);
			    $(".shipping-contact-details").html(details);
				$("#deliveryContactId").val(selectedCustomer.displayUid);
	 			$("#shippingContactId").val(selectedCustomer.displayUid);
			}
	         else
	        { 
	              if(deliveryMode=="pickup")
	              {
	              	$(".contact-details").html(details);
	              }
	              else if(deliveryMode=="standard-net"){
	              	 $(".delivery-contact-details").html(details);
	              }
	              else{
	              	 $(".shipping-contact-details").html(details);
	              }
    	    
	    	    $("#addPhoneMessage").show();
	    	    $("#isContactRequirePhoneNumber").val("Y");
	    	    $("#isAddPhoneNumberUsed").val("N");
	    	    if($("#addressId").val() != null && $("#addressId").val() != undefined && $("#addressId").val() != "")
	    	    {
	    	    	$(".delivery-phone").html("MNA");
	    	    }
    	    }
        }
        else
        {
	        var details = selectedCustomer.name + "<BR>M <a class='textDecorationNone tel-phone' href='tel:"+selectedCustomer.contactNumber+"'>"+selectedCustomer.contactNumber+"</a><BR>" + "<a class='textDecorationNone' href='mailto:"+selectedCustomer.displayUid+"'>"+selectedCustomer.displayUid+"</a>";
		 if(deliveryMode==null){
	      $(".contact-details").html(details);
			 $(".delivery-contact-details").html(details);
		    $(".shipping-contact-details").html(details);
            $("#deliveryContactId").val(selectedCustomer.displayUid);
             $("#shippingContactId").val(selectedCustomer.displayUid);
		}else{ 
        
             if(deliveryMode=="pickup"){
                  	    $(".contact-details").html(details);
              }else if(deliveryMode=="standard-net"){
              	 $(".delivery-contact-details").html(details);
              }else{
              	 $(".shipping-contact-details").html(details);
              }
		    $("#isContactRequirePhoneNumber").val("N");
		    $("#addPhoneMessage").hide();		
		    if($("#addressId").val() != null && $("#addressId").val() != undefined && $("#addressId").val() != "")
    	    {
		    	$(".delivery-phone").html("M <a class='tel-phone' href='tel:"+selectedCustomer.contactNumber+"'>"+selectedCustomer.contactNumber+"</a>");
    	    }
           }
		    
        }
	},
	populateAddressDetails: function(address,mode)
    {
		var selectedAddress = null;
		var addresses=[];
		try{
			addresses= JSON.parse(document.getElementsByClassName("deliveryAddresses")[0].value);
		}catch(e){
			addresses=[];
		}
        
        jQuery.each(addresses, function(i, val)
		{
        	if(val.id === address)
	       	{
	       		selectedAddress = val;
	       	}
		});
	    if(null != selectedAddress)
	    {
	    var region="";
	    var fullName=""
	    if(selectedAddress.region && selectedAddress.region.isocodeShort){
	    	region= selectedAddress.region.isocodeShort ;
	    }
	    if(selectedAddress.title){
	    	fullName+=selectedAddress.title + ". ";
	    }
	    if(selectedAddress.firstName){
	    	fullName+=selectedAddress.firstName + " ";
	    }
	    if(selectedAddress.lastName){
	    	fullName+=selectedAddress.lastName;
	    }
	    if(fullName){
	    	fullName+=fullName+"<BR>";
	    }
	      var details = fullName
	      			  + selectedAddress.line1 + "<BR>" 
	      			  + selectedAddress.town + ", "
	      			  + region + " " + selectedAddress.postalCode + "<BR>";
	      
	      ACC.mixedcartcheckout.populateRegionDetails(region,mode);
          if(mode=="shipping"){
	        $(".shipping-address").html(details);
            }
         else{
         	  $(".delivery-address").html(details);
            }
	    }
	},
	
	populateRegionDetails: function(region,mode)
    {
	var regionValue = region;
		if(mode=="shipping"){
	       $(".shipping-region").html(regionValue);
            }
         else{
         	 $(".delivery-region").html(regionValue);
            }
		
		
    },
	
    populateNewRegionAddressForm: function(response){
		var region="";
		 if(response.addressData.region && response.addressData.region.isocodeShort){
		    	region= response.addressData.region.isocodeShort ;
		    }

		return region;
	},

	populateNewAddressForm: function(response){
		var details =  response.addressData.line1 + "<BR>"
	      			  + response.addressData.line2 + "<BR>"  
				+ response.addressData.town + ", "
				+ ACC.mixedcartcheckout.populateNewRegionAddressForm(response) + " " + response.addressData.postalCode + "<BR>";

		return details;
	},
	populateNewContactForm: function(response){
		var details =  response.addressData.firstName + " " + response.addressData.lastName + "<br>" 
				+ response.addressData.phone + "<br>"
				+ response.addressData.email;

		return details;
	},
	deliveryNewAddressShowForm: function(){
	  $(".delivery-Newaddress").hide();
   	  $(".delivery-Newregion").hide();
   	  $("#mixedcart-deliveryaddressdata").show();
   	  $("#mixedcart-deliveryaddressdat1").show();
   	  $("#mixedcart-deliverycitydata").show();
   	  $("#mixedcart-deliverystatedata").show();
   	  $("#mixedcart-deliveryzipdata").show();
	},
	deliveryNewAddressHideForm: function(){
		 $(".delivery-Newaddress").show();
		 $(".delivery-Newregion").show();
	  $("#mixedcart-deliveryaddressdata").hide();
	  $("#mixedcart-deliveryaddressdat1").hide();
	  $("#mixedcart-deliverycitydata").hide();
	  $("#mixedcart-deliverystatedata").hide();
	  $("#mixedcart-deliveryzipdata").hide();
	},
	saveAlternateDeliveryContactForm: function(){
		$.ajax({
			url: ACC.config.encodedContextPath + "/checkout/multi/saveAlternateContactDetails", 
    		method:"POST",
    		data:$('#mixedcart-deliveryContactForm :input').serialize(),	
    		
    		success: function(response)
    		{
    		  	$(".delivery-Newregion").html(ACC.mixedcartcheckout.populateNewRegionAddressForm(response));
				$("#delivery_location").val(ACC.mixedcartcheckout.populateNewRegionAddressForm(response));
	 		    $(".delivery-Newaddress").html(ACC.mixedcartcheckout.populateNewAddressForm(response));
	 		    $(".delivery-address").html($(".delivery-Newaddress").html());
	 		    $(".delivery-contact-details").html(ACC.mixedcartcheckout.populateNewContactForm(response));
	 		    ACC.mixedcartcheckout.deliveryNewAddressHideForm();
    			$("#mixedcart-deliveryContactForm").hide();
				$(".mixedcartDeliveryBoxGC").show();
    			$("#delivery_content2").show();
    			$("#termsPODiv").show();
    			$("#pickup-delivery").show();
    			$(".payment_cbtn").show();
    		}
			});
	},
	saveShippingAlternateContactForm: function() {
		
		$.ajax({
			url: ACC.config.encodedContextPath + "/checkout/multi/saveAlternateContactDetails", 
    		method:"POST",
    		data:$('#mixedcart-shipmentForm :input').serialize(),	
    		
    		success: function(response)
    		{
    			$(".mixedcart-shipping-Newregion").html(ACC.mixedcartcheckout.populateNewRegionAddressForm(response));
	 			$(".mixedcart-shipping-Newaddress").html(ACC.mixedcartcheckout.populateNewAddressForm(response));
	 			$(".shipping-address").html($(".mixedcart-shipping-Newaddress").html());
	 			$(".shipping-contact-details").html(ACC.mixedcartcheckout.populateNewContactForm(response));
    			$("#mixedcart-shipmentForm").hide();
				$(".mixedcartShippingBoxGC").show();
    			$("#shipping_div").show();
    			$("#shipping_btn").show();			        			
    			$("#mixedcart-shippingaddressdata").hide();
    			$("#mixedcart-shippingaddressdata").hide();
  	    	    $("#mixedcart-shippingaddressdat1").hide();
  	    	    $("#mixedcart-shippingcitydata").hide();
  	    	    $("#mixedcart-shippingstatedata").hide();
  	    	    $("#mixedcart-shippingzipdata").hide();
    			$(".mixedcart-florida-error-msg").addClass("hidden");
    		   
    			}
			});
	},
	briteVerifyEmailvalidation: function(emailId, status, orderType){
		var briteverify= document.getElementById('briteVerifyEnable').value;
		 if(briteverify=="true"){
			 url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+emailId;
			 $.ajax({
	                url: url,
	                type: "GET",
	                timeout: 5000,
		            success: function (response)
		            {
			            if(response == "invalid")
			            {
			            	if(orderType == "PARCEL_SHIPPING"){
			            			$("#errorShippingEmailAddress").html("<div class=''><font color='red'><div class='panel-body'>Please enter a valid email address.</div></font></div>");
			            	}else{
			            		$("#errordeliveryEmailAddress").html("<div class=''><font color='red'><div class='panel-body'>Please enter a valid email address.</div></font></div>");   
			            	}
			            }
			            else
			            {
				            if(status)
				            {
				            	if(orderType == "PARCEL_SHIPPING"){
				            		$.ajax({
						        		url:ACC.config.encodedContextPath + "/checkout/multi/validate-address", 
						        		method:"POST",
						        		data:$('#mixedcart-shipmentForm :input').serialize(),		        	
						        		success: function(addressVerificationData){
				                           ACC.address.isAddressChanged = false;
				                           ACC.address.isAddressVerified = true;
						        			if((addressVerificationData.isAddressValid && !addressVerificationData.isAddressCorrected) || addressVerificationData.status.errorCode == '404')
						        			{
						        				ACC.mixedcartcheckout.saveShippingAlternateContactForm();
						        			}
						        			else
						        			{		        				        			
							        			var popupContent = ACC.mixedcartcheckout.createShippingPopupContentMixedCart(addressVerificationData);
							        			$.colorbox({
													html: popupContent,					
													maxWidth:"100%",
													width:"550px",
													maxHeight:"100%",
													overflow:"auto",
													opacity:0.7,
													className:"addNotFound",
													title:false,
													close:'<span class="glyphicon glyphicon-remove"></span>',
													onComplete: function(){
													}
												});
						        				
						        			}
						                 },
						               
					        		});
				            		
				            	}else{
				            		$.ajax({
						        		url:ACC.config.encodedContextPath + "/checkout/multi/validate-address", 
						        		method:"POST",
						        		data:$('#mixedcart-deliveryContactForm :input').serialize(),		        	
						        		success: function(addressVerificationData){
				                           ACC.address.isAddressChanged = false;
				                           ACC.address.isAddressVerified = true;
						        			if((addressVerificationData.isAddressValid && !addressVerificationData.isAddressCorrected) || addressVerificationData.status.errorCode == '404')
						        			{
						        				ACC.mixedcartcheckout.saveAlternateDeliveryContactForm();
						        			}
						        			else
						        			{	        				        			
							        			var popupContent = ACC.mixedcartcheckout.createDeliveryPopupContentMixedCart(addressVerificationData)
							        			$.colorbox({
													html: popupContent,					
													maxWidth:"100%",
													width:"550px",
													maxHeight:"100%",
													overflow:"auto",
													opacity:0.7,
													className:"addNotFound",
													title:false,
													close:'<span class="glyphicon glyphicon-remove"></span>',
													onComplete: function(){
													}
												});
						        				
						        			}
						                 },
						               
					        		});
				            		
				            	}
				            }
			            }
		            },
	           
		            error: function(response, textstatus, message) 
		            {
		        	  if(textstatus == "timeout" || textstatus == "error") 
                       {
		        		  if(orderType == "PARCEL_SHIPPING"){
		        			  $("#errorShippingEmailAddress").html("<div class=''><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
		        		  }else{
		        			  $("#errordeliveryEmailAddress").html("<div class=''><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
		        		  }
                       } 
		            }
			 });
		 }else{
			 if(orderType == "PARCEL_SHIPPING"){
				 ACC.mixedcartcheckout.saveShippingAlternateContactForm();
			 }else{
				 ACC.mixedcartcheckout.saveAlternateDeliveryContactForm();
			 }
		 }
	},
	binbOrderSubmitMethod: function(e){
		
		$(document).on("blur", "#checkoutdeliveryphone", function(e)
				{
					var phoneNumber = $(this).val();
					if(phoneNumber != null && phoneNumber != '' && phoneNumber != undefined)
				    {
				        if (!ACC.formvalidation.validatePhoneNumber(phoneNumber))
		                {
		                    var msg= ACC.config.phoneNumberError ;
		                    ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors', msg);
		                }
		                else
		                {
		                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors');
		                }
				    }
				    else
				    {
		            	ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors', ERRORMSG.global.phone);
				    }
			    });
				
				$(document).on("input", "#checkoutdeliveryphone", function(e)
				{
					ACC.formvalidation.handlePhoneNumberOnInput('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors');
			    });
		
		$(document).on("click", ".adddeliveryFormSubmitMixedCart", function(e)
				{
			e.preventDefault();
			var status = true;
				ACC.formvalidation.vaildateFields('#checkoutdeliveryfirstName','#errordeliveryFirstName', '#checkoutdeliveryfirstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
				ACC.formvalidation.vaildateFields('#checkoutdeliverylastName','#errordeliveryLastName', '#checkoutdeliverylastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);	
				var msg = ERRORMSG.global.address;
		        ACC.formvalidation.vaildateFields('#checkoutdeliveryaddressLine1', '#errordeliveryAddressLine1', '#checkoutdeliveryaddressLine1\\.errors', msg);
		        ACC.formvalidation.vaildateFields('#checkoutdeliverystate', '#errordeliveryState', '#checkoutdeliverystate\\.errors', ERRORMSG.global.state);
					
				if(null != $("#checkoutdeliveryphone").val() && $("#checkoutdeliveryphone").val() != '')
			    {
			        if (!ACC.formvalidation.validatePhoneNumber($("#checkoutdeliveryphone").val()))
	                {
	                    var message= ACC.config.phoneNumberError ;
	                    status = false;
	                    ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors', message);
	                }
	                else
	                {
	                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors');
	                }
			    }
			    else
			    {
			    	status = false;
	            	ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryphone', '#errordeliveryPhoneNumber', '#checkoutdeliveryphone\\.errors', ERRORMSG.global.phone);
			    }
				if(ACC.formvalidation.validatezipcode(e, $("#checkoutdeliveryzip").val()))
				{
					ACC.formvalidation.removeErrorClassForRegForm('#checkoutdeliveryzip', '#errordeliveryZipcode', '#checkoutdeliveryzip\\.errors');
				}
				else
				{
					status = false;
					ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryzip', '#errordeliveryZipcode', '#checkoutdeliveryzip\\.errors',ACC.config.zipCodeError);
				}
				
				if(ACC.formvalidation.validateEmailPattern($("#checkoutdeliveryemail").val()))
			    {
					 ACC.formvalidation.removeErrorClassForRegForm('#checkoutdeliveryemail', '#errordeliveryEmailAddress', '#checkoutdeliveryemail\\.errors', ERRORMSG.invalid.email);
				}
				else
				{
					status = false;
					 ACC.formvalidation.addErrorClassForRegForm('#checkoutdeliveryemail', '#errordeliveryEmailAddress', '#checkoutdeliveryemail\\.errors', ERRORMSG.invalid.email);
				}
				
				$('*[id*=error]:visible').each(function() 
						{
							if($(this).html() != '')
							{
								status = false;
							}
						});
				
				var deliveryEmail = $("#checkoutdeliveryemail").val();
				 if(status)	{
					 
					 ACC.mixedcartcheckout.briteVerifyEmailvalidation(deliveryEmail,status)
					 
				 }
			
	});
	},
	bindAddAddressSubmit: function(e){
	
  		$(document).on("change",".mixedcart-popup #checkoutAddress\\.region", function(e){
			if($(this).attr("data-mode") === "shipping"){
				ACC.checkout.b2bIsFlorida($(this).val(),e.target);
			}
		});
		
		$(document).on("click", ".mixedcart-addAddressFormSubmit", function(e){
			e.preventDefault();
			var status = true;
			var deliveryMode=$(this).data('mode');
	        ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.line1', '.errorline1', '#line1\\.errors', ERRORMSG.global.address);
	        ACC.formvalidation.validateFieldBasedOnRegex(e,'#cboxLoadedContent #checkoutAddress\\.townCity', '.errorTownCity', '#townCity\\.errors',ACC.config.checkoutCityMay,ERRORMSG.global.city, 'city');
	        
	        if(deliveryMode === "shipping"){
				ACC.checkout.b2bIsFlorida($("#cboxLoadedContent #checkoutAddress\\.region").val(),$("#cboxLoadedContent #checkoutAddress\\.region"));
			}else{
				ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.region', '.errorRegion', '#region\\.errors', ERRORMSG.global.state);
			}
	        ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.companyName', '.errorCompanyName', '#companyName\\.errors', ERRORMSG.global.company);
	        
	        if($("#cboxLoadedContent #checkoutAddress\\.phone").val() != null && $("#cboxLoadedContent #checkoutAddress\\.phone").val() != '' && !ACC.formvalidation.validatePhoneNumber($("#cboxLoadedContent #checkoutAddress\\.phone").val()))
	        {
	        	status = false;
	            ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
	        }
	        else
	        {
	            ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
	        }
	         
	        if(ACC.formvalidation.validatezipcode(e, $('#cboxLoadedContent #checkoutAddress\\.postcode').val()))
			{
				ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors');
			}
			else
			{
				status = false;
				ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors', ACC.config.checkoutValidZip);
			}
	        $('span[class*="error"]').each(function() 
	    	    	{
	    	    		if($(this).html() != '')
	    	    		{
	    	    			status = false;
	    	    		}
	    	    	});
		        
	        if(status)	{
			$.ajax({
				url: ACC.config.encodedContextPath + "/checkout/multi/order-type/add-address", 
        		method:"POST",
        		data:$('#cboxLoadedContent #siteOneAddressForm').serialize(),	
        		beforeSend: function ()
    			{
        			loading.start();
    			},
        		success: function(response)
        		{
        			ACC.colorbox.close();
        			if(null != response && response !="" && response != undefined) {
        				$("#addAddressSuccess").html("<font color='green'><div class='panel-body'>"+ACC.config.addressCreated+"</div></font>");
        				if ($("#cboxLoadedContent #saveAddressInMyAddressBook").is(":checked"))	{
	                        if(deliveryMode=="shipping")
                               {
                               	 $("#MixedcartShippingAddress").append( '<option value="'+response[0].id+'" selected>Address: '+response[0].line1+'</option>' );
                     	 	         
                     	 		     $(".deliveryAddresses").val(response[1]);
                     	 		     $( "#MixedcartShippingAddress" ).change();
                               }
                               else
                               {
                     	  		     $("#MixedcartdeliveryAddress").append( '<option value="'+response[0].id+'" selected>Address: '+response[0].line1+'</option>' );
                     	 	         
                     	 		     $(".deliveryAddresses").val(response[1]);
                     	 		     $( "#MixedcartdeliveryAddress" ).change();
                                 }        
                      				} else {
        					 var region="";
        					 if(response[0].region && response[0].region.isocodeShort){
        					    	region= response[0].region.isocodeShort ;
        					    }
        					 var details =  response[0].line1 + "<BR>" 
       	      			  				+ response[0].town + ", "
       	      			  				+ region + " " + response[0].postalCode + "<BR>";
     
        					 ACC.mixedcartcheckout.populateRegionDetails(region,deliveryMode);
                              if(deliveryMode=="shipping")
                               {
	                            $('#MixedcartShippingAddress option')[0].selected = true;
        					 $(".shipping-address").html(details);
        					$('#shippingAddressId').val(response[0].id);
                                }
                                else
                                {
                                	$('#MixedcartdeliveryAddress option')[0].selected = true;
        				    	 $(".delivery-address").html(details);
        					    $('#deliveryAddressId').val(response[0].id);
                                }
        						var contact = $('#contactId').val();
        						
        						ACC.mixedcartcheckout.populateContactAddress(contact,deliveryMode);
        				}
        			}
        			loading.stop();

        		},
        		error: function(response, textstatus, message) 
				{
                  loading.stop();
				  if(textstatus == "timeout" || textstatus == "error") 
				  {
					 $("#cboxLoadedContent .addAddressError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.unableToAdd+"</div></font></div>");
				    } 
				},
				complete:function(response){

				}
			});
	       }
		});
	},
	bindAddPhone: function(){
		$(document).on("click",".contact-add-phoneNumber",function(e){
			e.preventDefault();
			$('#colorbox').addClass('addPhoneNumberNew');
			ACC.colorbox.open(
				$(this).data("cboxTitle"),
				{
					href: $(this).data("link"),
					width:"480px",
					onComplete: function(){  				
                    	 ACC.mixedcartcheckout.bindAddPhoneSuccess();
                    	 ACC.mixedcartcheckout.removeErrorClassForCheckoutForm('#phoneNo', '#errorPhoneNo', '#phoneNo\\.errors');
					}
				}
			);
		});
	},
	
	bindAddPhoneSuccess:function(){
		$("#addPhoneNumberEmailId").val($("#contactId").val());
		$("#siteOneAddPhoneNumberForm input[name=phoneNumber]").attr("placeholder","Phone Number");
		$('form#siteOneAddPhoneNumberForm').ajaxForm({
			beforeSend : function() {				
				loading.start();
			},
			success: function(data)
			{	
				$("#isAddPhoneNumberUsed").val("Y");
				$("#addPhoneMessage").hide();
				loading.stop();
				var contactNumber = $("#user\\.phonenumber").val();
				$(".checkout_addPhoneNumber").replaceWith(data);				
				ACC.colorbox.resize();
				if ($(data).hasClass("addPhoneNumberSucess"))
				{
					ACC.checkout.bindPopulatePhoneNumber(contactNumber,$("#contactId").val());			
				}				
				ACC.mixedcartcheckout.bindAddPhoneSuccess();
			}
		});		 
	},
	addNewAddressCheckout: function()
    {
    	
    	$(document).on("click", ".newaddress-mixedcart", function(e)
    	{
    		e.preventDefault();
    		var ordertype = $(this).attr("data-mode");
	    	ACC.mixedcartcheckout.removeErrorClassForCheckoutForm('#deliveryAddressRadio', '#errorDeliveryAddressRadio', '#deliveryAddressRadio\\.errors');
	    	$("#MixedcartdeliveryAddress").removeClass("error-div");
           $("#MixedcartShippingAddress").removeClass("error-div");
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.companyName', '.errorCompanyName', '#companyName\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.line1', '.errorline1', '#line1\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.region', '.errorRegion', '#region\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.townCity', '.errorTownCity', '#townCity\\.errors');
	    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors');
	    	$("#colorbox").addClass("addAddress-checkout");
	    	$("#colorbox").removeClass("failedgeoLocation-box");
	    	if(ordertype == "shipping"){
	    		ACC.colorbox.open("", {
                    html: $("#addresscheckout").html(),
                    width: "550",
                    height: "auto",
                    title: "<div class='headline'>"+ACC.config.shippinglocationpop+"</div>",
                    close:'<span class="glyphicon glyphicon-remove"></span>',
                    
                    onComplete: function(){
		    			_AAData.popupPageName= ACC.config.addNewLocationPopup;
			        	_AAData.popupChannel= ACC.config.checkoutpathingChannel;
					 	try {
						    	 _satellite.track('popupView');
				        } catch (e) {}
		    		},
	    		});
	    	}else{
		    	ACC.colorbox.open("", {
	                    html: $("#addresscheckout").html(),
	                    width: "550",
	                    height: "auto",
	                    title: "<div class='headline'>"+ACC.config.deliverylocationpop+"</div>",
	                    close:'<span class="glyphicon glyphicon-remove"></span>',
	                    onComplete: function(){
			    			_AAData.popupPageName= ACC.config.addNewLocationPopup2;
				        	_AAData.popupChannel= ACC.config.checkoutpathingChannel;
						 	try {
							    	 _satellite.track('popupView');
					        } catch (e) {}
			    		},
	                     
	            });
	    	}
	    	$(".mixedcart-addAddressFormSubmit").attr("data-mode", ordertype);
	    	$("#checkoutAddress\\.region").attr("data-mode", ordertype);
	    	$("#cboxLoadedContent").addClass("mixedcart-popup");
    	});
     },
	
	bindAddressValidations: function ()
	{
    	$(document).on("blur", "#cboxLoadedContent #checkoutAddress\\.phone", function(e)
    		{ 
    		    var phoneNumber = $(this).val();
    		    if (phoneNumber != "" && !ACC.formvalidation.validatePhoneNumber(phoneNumber))  
    		    {
    		       ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress \\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
    		    }
    		    else
    		    {
    		    	ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.phone', '.errorPhoneNumber', '#phoneNumber\\.errors');
    		     }
    		 });
    	$(document).on('input blur', "#cboxLoadedContent #checkoutAddress\\.townCity", function(e)
    		{
    				ACC.formvalidation.validateFieldBasedOnRegex(e,'#cboxLoadedContent #checkoutAddress\\.townCity', '.errorTownCity', '#townCity\\.errors',ACC.config.checkoutCityMay,ERRORMSG.global.city, 'city');
    		});
    	$(document).on('input blur', "#cboxLoadedContent #checkoutAddress\.companyName", function(e)
    		{
    				ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.companyName', '.errorCompanyName', '#companyName\\.errors',ERRORMSG.global.company);
    		});
    	$(document).on('input blur', "#cboxLoadedContent #checkoutAddress\\.line1", function(e)
    		{
    				ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.line1', '.errorline1', '#line1\\.errors',ERRORMSG.global.address);
    		});
    	$(document).on('input blur', ".mixedcart-popup #checkoutAddress\\.region", function(e)
    	{
    		if($(this).attr("data-mode") === "shipping"){
				    ACC.checkout.b2bIsFlorida($(this).val(), e.target);
			}
			else{
				ACC.formvalidation.vaildateFields('#cboxLoadedContent #checkoutAddress\\.region', '.errorRegion', '#region\\.errors', ERRORMSG.global.state);
			}		
    	});
    	$(document).on("input blur", "#cboxLoadedContent #checkoutAddress\\.postcode", function(e)
    		{	
    				if(ACC.formvalidation.validatezipcode(e, $("#cboxLoadedContent #checkoutAddress\\.postcode").val()))
    				{
    					ACC.formvalidation.removeErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors');
    				}
    				else
    				{
    					ACC.formvalidation.addErrorClassForRegForm('#cboxLoadedContent #checkoutAddress\\.postcode', '.errorPostCode', '#postcode\\.errors', ACC.config.zipCodeError);
    				}
    		});

	},
	showAddressForm: function() {
		$(".mixedcart-shipping-check").attr("checked", false);
		$('.shipping-mixedcart-form').show();
		$(".mixedcartShippingBoxGC").hide();
		$("#shipping_div").hide();
		$("#shipping_btn").hide();
	},
	saveContacForm: function(){
		$.ajax({
			url: ACC.config.encodedContextPath + "/checkout/multi/saveContactDetails", 
    		method:"POST",
    		data:$('#SiteOneGCContactForm').serialize(),	
    		
    		success: function(response)
    		{
    			window.scrollTo(0,0);
    			
    			if(response.customerData || response.addressData){
    			var orderType;
    			let modes = ["PICKUP","DELIVERY","SHIPPING"];
    			for(let i=0; i<modes.length; i++){
					if($('[data-aconum="1"]').parents("." + modes[i] + "-section").length){
						orderType = modes[i];
					}
				}
    			
    			$(".contactcheckout").hide();
    			
    			$(".edit-contact-information").show();
    			$(".edit-contact-information_guest").show();
    			
    			$(".checkout-form-data").show();
    			
    			$("#siteOneOrderTypeForm").show();
    		
    			var firstname = response.customerData.firstName;
    			$("#mixedcart-data").html(firstname);
    			
    			var lastname = response.customerData.lastName;
    			$("#mixedcart-lastNamedata").html(lastname);
    			
    			var phonedata = response.customerData.contactNumber;
    			$("#mixedcart-phonedata").html(phonedata);
    			
    			var emaildata = response.customerData.displayUid;
    			$("#mixedcart-emaildata").html(emaildata);
    			
    			var addressdata = response.addressData.line1;
    			$("#mixedcart-addressdata").html(addressdata);
    			
    			var addressdata1 = response.addressData.line2;
    			$("#mixedcart-addressdat1").html(addressdata1);
    			
    			var citydata = response.addressData.town;
    			$("#mixedcart-citydata").html(citydata);
    			
    			var statedata = response.addressData.district;
    			$("#mixedcart-statedata").html(statedata);
				$("#delivery_location").val(statedata);
    			
    			var zipdata = response.addressData.postalCode;
    			$("#mixedcart-zipdata").html(zipdata);
    			
    			if(orderType == "PICKUP"){
    				$(".delivery--content").hide();
		        	$(".pickup--content").show();
		        	$(".common-content-pickupDelivery").show();
		        	$(".delivery-chargesMsg").hide();
		        	$(".icon-delivery-charges").hide();
		        	$(".message-delivery").hide();
		            $(".errorPickupDelivery").hide();
		            $(".delivery-details").hide();
		            $(".pickup-title").show();
    			}else if(orderType == "DELIVERY"){
    				var isSameAsContactInfo = response.isSameAsContactInfo;
    				if(isSameAsContactInfo){
    					$(".mixedcart-delivery-check").attr("checked", true);
    					$('.deliveryContact-form').hide();
						$(".mixedcartDeliveryBoxGC").show();
    					 $("#termsPODiv").show();
        $("#delivery_content1").show();
    			    	  $("#delivery_content2").show();
    			    	  $("#pickup-delivery").show();
           $(".payment_cbtn").show();
    			    	  $("#mixedcart-deliveryaddressdata").html(response.addressData.line1);
			        		$("#mixedcart-deliveryaddressdat1").html(response.addressData.line2);
			        		$("#mixedcart-deliverycitydata").html(response.addressData.town);
			        		$("#mixedcart-deliverystatedata").html(response.addressData.district);
							    $("#delivery_location").val(response.addressData.district);
			        		$("#mixedcart-deliveryzipdata").html(response.addressData.postalCode);
    				}else{
    					$(".mixedcart-delivery-check").attr("checked", false);
    					//$('.deliveryContact-form').show();
						$(".mixedcartDeliveryBoxGC").hide();
    					$("#termsPODiv").hide();
      	$("#delivery_content1").show();
    					$("#delivery_content2").hide();
    			    		$("#pickup-delivery").hide();
    					
    				}
    				$("#delivery_Details").hide();
    				$("#delivery_fee").hide();
		        		$(".edit-delivery-information").hide();
    			}else{
    				$("#parcelShipping_div").show();
    				$(".delivery--content").hide();
    				var isSameAsContactInfo = response.isSameAsContactInfo;
    				var state = response.addressData.district;
    				if(isSameAsContactInfo){
    					if(state != _AAData.storeState){
        					$(".mixedcart-shipping-check").attr("disabled", true);
        					ACC.mixedcartcheckout.showAddressForm();
			        		$(".mixedcart-florida-error-msg").removeClass("hidden");
			        		//$(".mixedcart-shipping-check").css("pointer-events","none");
        				}else{
        					$(".mixedcart-shipping-check").attr("disabled", false);
        					$(".mixedcart-shipping-check").attr("checked", true);
    					 	$('.shipping-mixedcart-form').hide();
							$(".mixedcartShippingBoxGC").show();
    					 	$("#shipping_div").show();
		        			$("#shipping_btn").show();
		        			$(".mixedcart-florida-error-msg").addClass("hidden");
		        			$("#mixedcart-shippingaddressdata").html(response.addressData.line1);
			        		$("#mixedcart-shippingaddressdat1").html(response.addressData.line2);
			        		$("#mixedcart-shippingcitydata").html(response.addressData.town);
			        		$("#mixedcart-shippingstatedata").html(response.addressData.district);
							$("#delivery_location").val(response.addressData.district);
			        		$("#mixedcart-shippingzipdata").html(response.addressData.postalCode);
        				}
        				
    			 }

			      else{
			    	  if(state != _AAData.storeState){
        					$(".mixedcart-shipping-check").attr("disabled", true);
        					ACC.mixedcartcheckout.showAddressForm();
			        		$(".mixedcart-florida-error-msg").removeClass("hidden");
        				}else{
        					$(".mixedcart-shipping-check").attr("disabled", false);
        					ACC.mixedcartcheckout.showAddressForm();
			        		$(".mixedcart-florida-error-msg").addClass("hidden");
        				}
        				
			    }
    				
    				
    			}
    			$(".direction-link").show();
    			$(".edit-pickup-information").hide();
    		    
    		   //for guest user next fulfillment checking
				if($(".isguestuser").val() == "true"){
					ACC.mixedcartcheckout.openNextBlockAccordion('mixedcart-contact', 0);
					$(".mixedcart-delivery-check").prop("checked", $(".mixedcart-sameaddress-delivery").prop("checked"));
					
					if(!$(".mixedcart-shipping-check").prop("disabled")){
						$(".mixedcart-shipping-check").prop("checked", $(".mixedcart-sameaddress-shipping").prop("checked"));
					}
					
					if($(".mixedcart-delivery-check").prop("checked")){
						ACC.mixedcartcheckout.copySameDataFor('delivery', firstname,lastname,phonedata,emaildata,addressdata,addressdata1,citydata,statedata,zipdata);
						$(".deliveryContact-form").hide();
					}
					else{
						$(".deliveryContact-form").show();
					}
					
					if($(".mixedcart-shipping-check").prop("checked")){
						ACC.mixedcartcheckout.copySameDataFor('shipping', firstname,lastname,phonedata,emaildata,addressdata,addressdata1,citydata,statedata,zipdata);
						$(".shipping-mixedcart-form").hide();
					}
					else{
						$(".shipping-mixedcart-form").show();
					}
				}
    		
    			}
    		} //./success
		})
	},
	checkoutStepEmailValidation: function(){
					
						var selectedValue=$("#checkoutContactemail").val()
						if(selectedValue){
						$.ajax({
						url : ACC.config.encodedContextPath + "/checkout/multi/isEmailAlreadyExists?email=" + selectedValue,
						method:"GET",

						success : function(response) {
							if(response.isSuccess== true)
							{
							if(response.isMailAvailable== true){

						$(".exitEmail-guestCheckout-form").show();
						$(".addContactFormSubmitMixCart").prop('disabled', true);
						}
						else{
						$(".exitEmail-guestCheckout-form").hide();
						$(".exitEmail-guestCheckout-formerror").hide();
						$(".addContactFormSubmitMixCart").prop('disabled', false);
						}
						}else {
						$(".exitEmail-guestCheckout-formerror").show();
						$(".exitEmail-guestCheckout-form").hide();
						$(".addContactFormSubmitMixCart").prop('disabled', true);
						}
						}
						})
					}
						
				},
	bindContactAddressValidations: function (){
		$(".edit-contact-information").hide();
		$(".exitEmail-guestCheckout-form").hide();
		$(".exitEmail-guestCheckout-formerror").hide();
		$(".contactForm_guest-checkout-data").hide();
		
		$(document).on("click", ".edit-contact-information", function(e)
				{
			$(".edit-contact-information").hide();
			$("#siteOneOrderTypeForm").hide();
			$(".checkout-form-data").hide();
			$(".contactcheckout").show();
			$("#iframe_Popup_guest").hide();
			 $(".choosepaymentB2b_GC").hide();
			grecaptcha.reset();
				});
		
		$(".edit-mixedcart-contact-information").click(function() {
			
			grecaptcha.reset();
				$("#iframe_Popup_guest").slideUp();
			$(".checkout-form-data").hide();
			$(".mixCartChangeContact").removeClass("hidden").show();
			if($(".contactPersonfirstName").length){
			$(".edit-contact-information_guest").hide();
			var firstname=$(".contactPersonfirstName").val();
			$("#checkoutContactfirstName").val(firstname);
			var lastname=$(".contactPersonlastName").val();
			$("#checkoutContactlastName").val(lastname);
			var company=$(".contactPersoncompanyName").val();
				$("#checkoutContact\\.companyName").val(company);
			var number=$(".contactPersoncontactNumber").val();
			$("#checkoutContactphone").val(number);
			var email=$(".contactPersondisplayUid").val();
			$("#checkoutContactemail").val(email);
			var line1=$(".addressDataline1").val();
			$("#checkoutContactaddressLine1").val(line1);
			var line2=$(".addressDataline2").val();
			$("#checkoutContact\\.addressLine2").val(line2);
			var town=$(".addressDatatown").val();
			$("#checkoutContactcity").val(town);
			var district=$(".addressDatadistrict").val();
			$("#checkoutContactstate").val(district);
			var postalcode=$(".addressDatapostalCode").val();
			$("#checkoutContactzip").val(postalcode);
		}
			ACC.mixedcartcheckout.closeOpenBloc("mixedcart-contact");
		});
		
		$(document).on('input blur', "#checkoutContactfirstName", function(e)
	    		{
	    				ACC.formvalidation.vaildateFields('#checkoutContactfirstName','#errorFirstName', '#checkoutContactfirstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
	    		});
		$(document).on('input blur', "#checkoutContactlastName", function(e)
	    		{
	    				ACC.formvalidation.vaildateFields('#checkoutContactlastName','#errorLastName', '#checkoutContactlastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);
	    		});
		
		$(document).on("blur", "#checkoutContactphone", function(e)
				{
					var phoneNumber = $(this).val();
					if(phoneNumber != null && phoneNumber != '' && phoneNumber != undefined)
				    {
				        if (!ACC.formvalidation.validatePhoneNumber(phoneNumber))
		                {
		                    var msg= ACC.config.phoneNumberError ;
		                    ACC.formvalidation.addErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors', msg);
		                }
		                else
		                {
		                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors');
		                }
				    }
				    else
				    {
		            	ACC.formvalidation.addErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors', ERRORMSG.global.phone);
				    }
			    });
				
				$(document).on("input", "#checkoutContactphone", function(e)
				{
					ACC.formvalidation.handlePhoneNumberOnInput('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors');
			    });
				
		    	      
				$(document).on("input blur", "#checkoutContactemail", function (e) {
					e.preventDefault();
					if (ACC.formvalidation.validateEmailPattern($("#checkoutContactemail").val())) {
						ACC.mixedcartcheckout.checkoutStepEmailValidation();
						ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactemail', '#errorEmailAddress', '#checkoutContactemail\\.errors', ERRORMSG.invalid.email);
					}
					else {
						$(".exitEmail-guestCheckout-form").hide();
						$(".exitEmail-guestCheckout-formerror").hide();
						$(".addContactFormSubmitMixCart").prop('disabled', false);
						ACC.formvalidation.addErrorClassForRegForm('#checkoutContactemail', '#errorEmailAddress', '#checkoutContactemail\\.errors', ERRORMSG.invalid.email);
					}
				});
				$(document).on("input blur", "#checkoutContactaddressLine1", function()
						{
					        var msg = ERRORMSG.global.address;
					        ACC.formvalidation.vaildateFields('#checkoutContactaddressLine1', '#errorAddressLine1', '#checkoutContactaddressLine1\\.errors', msg);
					    });
				$(document).on('input blur', "#checkoutContactcity", function(e)
						{
							
							ACC.formvalidation.validateFieldBasedOnRegex(e,'#checkoutContactcity', '#errorCity', '#checkoutContactcity\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'checkoutContactcity');
					    });
				$(document).on("input blur", "#checkoutContactzip", function(e)
						{	
							if(ACC.formvalidation.validatezipcode(e, $("#checkoutContactzip").val()))
							{
								ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactzip', '#errorZipcode', '#checkoutContactzip\\.errors');
							}
							else
							{
								ACC.formvalidation.addErrorClassForRegForm('#checkoutContactzip', '#errorZipcode', '#checkoutContactzip\\.errors',ACC.config.zipCodeError);
							}
					    });
				$(document).on("input blur", "#checkoutContactstate", function()
						{
					        var msg = ERRORMSG.global.state;
					        ACC.formvalidation.vaildateFields('#checkoutContactstate', '#errorState', '#checkoutContactstate\\.errors', msg);
					    });
				
				
				$(document).on("click", ".addContactFormSubmitMixCart", function(e)
						{
					e.preventDefault();
					var status = true;
					document.getElementById('recaptchaValidator').value = grecaptcha.getResponse();
					ACC.briteverify.reCaptcha(grecaptcha.getResponse());
					ACC.formvalidation.vaildateFields('#checkoutContactfirstName','#errorFirstName', '#checkoutContactfirstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
					ACC.formvalidation.vaildateFields('#checkoutContactlastName','#errorLastName', '#checkoutContactlastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);	
					var msg = ERRORMSG.global.address;
			        ACC.formvalidation.vaildateFields('#checkoutContactaddressLine1', '#errorAddressLine1', '#checkoutContactaddressLine1\\.errors', msg);
			        ACC.formvalidation.vaildateFields('#checkoutContactstate', '#errorState', '#checkoutContactstate\\.errors', ERRORMSG.global.state);
			        $(".edit-contact-information").show();
					$(".edit-contact-information_guest").addClass("hidden");	
					if(null != $("#checkoutContactphone").val() && $("#checkoutContactphone").val() != '')
				    {
				        if (!ACC.formvalidation.validatePhoneNumber($("#checkoutContactphone").val()))
		                {
		                    var msg= ACC.config.phoneNumberError ;
		                    status = false;
		                    ACC.formvalidation.addErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors', msg);
		                }
		                else
		                {
		                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors');
		                }
				    }
				    else
				    {
				    	status = false;
		            	ACC.formvalidation.addErrorClassForRegForm('#checkoutContactphone', '#errorPhoneNumber', '#checkoutContactphone\\.errors', ERRORMSG.global.phone);
				    }
					if(ACC.formvalidation.validatezipcode(e, $("#checkoutContactzip").val()))
					{
						ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactzip', '#errorZipcode', '#checkoutContactzip\\.errors');
					}
					else
					{
						status = false;
						ACC.formvalidation.addErrorClassForRegForm('#checkoutContactzip', '#errorZipcode', '#checkoutContactzip\\.errors',ACC.config.zipCodeError);
					}
					
					if(ACC.formvalidation.validateEmailPattern($("#checkoutContactemail").val()))
				    {
						 ACC.formvalidation.removeErrorClassForRegForm('#checkoutContactemail', '#errorEmailAddress', '#checkoutContactemail\\.errors', ERRORMSG.invalid.email);
					}
					else
					{
						status = false;
						 ACC.formvalidation.addErrorClassForRegForm('#checkoutContactemail', '#errorEmailAddress', '#checkoutContactemail\\.errors', ERRORMSG.invalid.email);
					}
					
					$('*[id*=error]:visible').each(function() 
							{
								if($(this).html() != '')
								{
									status = false;
								}
							});
					
					
					 if(status)	{
						 var briteverify= document.getElementById('briteVerifyEnable').value;
						 if(briteverify=="true"){
							 url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+$("#checkoutContactemail").val();
							 $.ajax({
					                url: url,
					                type: "GET",
					                timeout: 5000,
						            success: function (response)
						            {
							            if(response == "invalid")
							            {
							            				grecaptcha.reset();
							                          $("#errorEmailAddress").html("<div class=''><font color='red'><div class='panel-body'>Please enter a valid email address.</div></font></div>");   
							            }
							            else
							            {
								            if(status)
								            {
												$.ajax({
													url : ACC.config.encodedContextPath + "/checkout/multi/isEmailAlreadyExists?email=" + $("#checkoutContactemail").val(),
													method:"GET",
							
													success : function(response)
													{
														if(response.isSuccess== true)
														{
														if(response.isMailAvailable== true){
															$(".exitEmail-guestCheckout-form").show();
															$(e.target).prop('disabled', true);
														}
														else{
															$(".exitEmail-guestCheckout-form").hide();
															$(e.target).prop('disabled', false);
															$.ajax({
									        		url:ACC.config.encodedContextPath + "/checkout/multi/validate-address", 
									        		method:"POST",
									        		data:$('#SiteOneGCContactForm').serialize(),		        	
									        		success: function(addressVerificationData){
							                           
							                           ACC.address.isAddressChanged = false;
							                           ACC.address.isAddressVerified = true;
									        			if((addressVerificationData.isAddressValid && !addressVerificationData.isAddressCorrected) || addressVerificationData.status.errorCode == '404')
									        			{
									        				ACC.mixedcartcheckout.saveContacForm();
									        			}
									        			else
									        			{		        				        			
										        			var popupContent = ACC.mixedcartcheckout.createPopupContent(addressVerificationData);
										        			$.colorbox({
																html: popupContent,					
																maxWidth:"100%",
																width:"550px",
																maxHeight:"100%",
																overflow:"auto",
																opacity:0.7,
																className:"addNotFound",
																title:false,
																close:'<span class="glyphicon glyphicon-remove"></span>',
																onComplete: function(){
																}
															});
									        				
									        			}
									                 },
								        		});
														}
														}}})

								            	
								            	
								            	
								            }
							            }
						            },
					           
						          error: function(response, textstatus, message) 
						          {
						        	  grecaptcha.reset();
						                        if(textstatus == "timeout" || textstatus == "error") 
						                        {
						                        	$("#errorEmailAddress").html("<div class=''><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
						                        } 
						          }
							 });
						 }else{
							 ACC.mixedcartcheckout.saveContacForm();
						 }
					 }
						
						});
	},
	bindEditFulFilmentDetails: function() {
		$(document).on("change", "#checkoutShippingstate", function(e){
			var msg = ERRORMSG.global.address;
			var stateMsg = ERRORMSG.global.shippingStates;
			ACC.mixedcartcheckout.checkIfFlorida('#checkoutShippingstate', '#errorShippingState', '#checkoutShippingstate\\.errors', msg, stateMsg);
		});
		
		
		
		$(document).on("click", ".mixedcart-addShippingFormSubmit", function(e)
		{
			e.preventDefault();
			var status = true;
			var guestmsg = ERRORMSG.global.address;
			ACC.formvalidation.vaildateFields('#checkoutShippingfirstName','#errorShippingFirstName', '#checkoutShippingfirstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
			ACC.formvalidation.vaildateFields('#checkoutShippinglastName','#errorShippingLastName', '#checkoutShippinglastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);
			
	        ACC.formvalidation.vaildateFields('#checkoutShippingaddressLine1', '#errorShippingAddressLine1', '#checkoutShippingaddressLine1\\.errors', guestmsg);
			ACC.mixedcartcheckout.checkIfFlorida('#checkoutShippingstate', '#errorShippingState', '#checkoutShippingstate\\.errors', guestmsg, ERRORMSG.global.shippingStates);				
			if(null != $("#checkoutShippingphone").val() && $("#checkoutShippingphone").val() != '')
		    {
		        if (!ACC.formvalidation.validatePhoneNumber($("#checkoutShippingphone").val()))
                {
                    var message= ACC.config.phoneNumberError ;
                    status = false;
                    ACC.formvalidation.addErrorClassForRegForm('#checkoutShippingphone', '#errorShippingPhoneNumber', '#checkoutShippingphone\\.errors', message);
                }
                else
                {
                    ACC.formvalidation.removeErrorClassForRegForm('#checkoutShippingphone', '#errorShippingPhoneNumber', '#checkoutShippingphone\\.errors');
                }
		    }
		    else
		    {
		    	status = false;
            	ACC.formvalidation.addErrorClassForRegForm('#checkoutShippingphone', '#errorShippingPhoneNumber', '#checkoutShippingphone\\.errors', ERRORMSG.global.phone);
		    }
			if(ACC.formvalidation.validatezipcode(e, $("#checkoutShippingzip").val()))
			{
				ACC.formvalidation.removeErrorClassForRegForm('#checkoutShippingzip', '#errorShippingZipcode', '#checkoutShippingzip\\.errors');
			}
			else
			{
				status = false;
				ACC.formvalidation.addErrorClassForRegForm('#checkoutShippingzip', '#errorShippingZipcode', '#checkoutShippingzip\\.errors',ACC.config.zipCodeError);
			}
			
			if(ACC.formvalidation.validateEmailPattern($("#checkoutShippingemail").val()))
		    {
				 ACC.formvalidation.removeErrorClassForRegForm('#checkoutShippingemail', '#errorShippingEmailAddress', '#checkoutShippingemail\\.errors', ERRORMSG.invalid.email);
			}
			else
			{
				status = false;
				 ACC.formvalidation.addErrorClassForRegForm('#checkoutShippingemail', '#errorShippingEmailAddress', '#checkoutShippingemail\\.errors', ERRORMSG.invalid.email);
			}
			
			$('*[id*=error]:visible').each(function() 
					{
						if($(this).html() != '')
						{
							status = false;
						}
					});
			
			var shippingEmail = $("#checkoutShippingemail").val();
			 if(status)	{
				 	ACC.mixedcartcheckout.briteVerifyEmailvalidation(shippingEmail , status, "PARCEL_SHIPPING");
					ACC.checkout.showProp65Popup();
			 }
						
			
	});
		
		$(document).on("click", "#mixedCartEditShipping", function(e){
			$("#parcelShipping_div").show();
			$("#iframe_Popup_guest").hide();
			 $(".choosepaymentB2b_GC").hide();
			var isGuestUser = $(".isguestuser").val();
			var state = $("#mixedcart-statedata").html();
			if(isGuestUser == "true"){
				if($(".mixedcart-shipping-check").prop('checked')==true){
					if(state != _AAData.storeState || state != 'US-'+_AAData.storeState){
    					$(".mixedcart-shipping-check").attr("disabled", true);
    					$(".mixedcart-shipping-check").attr("checked", false);
    					$('.shipping-mixedcart-form').show();
						$(".mixedcartShippingBoxGC").hide();
				    	 $("#shipping_div").hide();
		        		$("#shipping_btn").hide();
    				}else{
    					$(".mixedcart-shipping-check").attr("disabled", false);
    					$(".mixedcart-shipping-check").attr("checked", true);
    					$('.shipping-mixedcart-form').hide();
						$(".mixedcartShippingBoxGC").show();
  					  	$("#shipping_div").show();
  						$("#shipping_btn").show();
  						
    				}
					  
				}
				else{
					if(state != _AAData.storeState || state != 'US-'+_AAData.storeState){
    					$(".mixedcart-shipping-check").attr("disabled", true);
    					$(".mixedcart-shipping-check").attr("checked", false);
    					$('.shipping-mixedcart-form').show();
						$(".mixedcartShippingBoxGC").hide();
				    	 $("#shipping_div").hide();
		        		$("#shipping_btn").hide();
    				}else{
    					$(".mixedcart-shipping-check").attr("disabled", false);
    					$(".mixedcart-shipping-check").attr("checked", false);
    					$('.shipping-mixedcart-form').show();
						$(".mixedcartShippingBoxGC").hide();
				    	 $("#shipping_div").hide();
		        		$("#shipping_btn").hide();
    				}
			      }
				$("#mixedcart-shipping_Details").hide();
				$("#mixedcart-shipment_div2").show();
			}else{
				$("#shipping_div").show();
				$("#mixedcart-shipment_div2").show();
				$("#shipping_btn").show();
				$("#mixedcart-shipping_Details").hide();
			}
			$(".direction-link").show();
			ACC.mixedcartcheckout.closeOpenBloc("shipping");
		});
		
		
		
		$(document).on("click", "#mixedCartEditDelivery", function(e){
			$("#delivery_fee").hide();
			$("#delivery_Details").hide();
			
          
			var isGuestUser = $(".isguestuser").val();
			if(isGuestUser == "true"){
				if($(".mixedcart-delivery-check").prop('checked')==true){
					  $('.deliveryContact-form').hide();
					  $(".mixedcartDeliveryBoxGC").show();
					  $("#delivery_content1").show();
					  $("#termsPODiv").show();
			    	  $("#delivery_content2").show();
			    	  $("#pickup-delivery").show();
			    	  $(".payment_cbtn").show();
			    		$("#iframe_Popup_guest").hide();
			    		 $(".choosepaymentB2b_GC").hide();
			    		 
			    		 ACC.mixedcartcheckout.deliveryNewAddressShowForm();
				  }
	
			      else{
			    	  $('.deliveryContact-form').show();
					 $(".mixedcartDeliveryBoxGC").hide();
			    	  $("#termsPODiv").hide();
			    	  $("#delivery_content1").show();
			    	  $("#delivery_content2").hide();
			    	  $("#pickup-delivery").hide();
			    	  $(".payment_cbtn").hide();
			    		$("#iframe_Popup_guest").hide();
			    		 $(".choosepaymentB2b_GC").hide();
			    		 ACC.mixedcartcheckout.deliveryNewAddressHideForm();
			      }
			}
			else{
				$("#delivery_content1").show();
				  $("#termsPODiv").show();
		    	  $("#delivery_content2").show();
		    	  $("#pickup-delivery").show();
		    	  $(".payment_cbtn").show();
			}
			$("#iframe_Popup_guest").hide();
			$(".choosepaymentB2b_GC").hide();
			 
			ACC.mixedcartcheckout.closeOpenBloc("delivery");
		});
	},
	
	checkHomeOwnerCase: function () {
		var tradeClass = $(".trade-class").val();
		var subTotalVal = $(".subTotal-class").val();
		var homeOwnerCode = $(".homeOwnerCode").val();
		var subtotalLimit= $(".subtotalLimit").val();
		if (tradeClass == homeOwnerCode && (parseFloat(subTotalVal) < parseFloat(subtotalLimit))) {
	       $('#DELIVERY').prop('disabled', true);
	       $(".homeOwner-msg").removeClass("hidden");
	       $("#DELIVERY").parent().parent().addClass('disable_section');
	       $("label[for='Delivery").addClass('cursor-notallowed');
	    }
		
		
		$(document.body).on("click","#PICKUP",function(){
			$(".homeOwner-msg").addClass("hidden");
		});
	},
	
	paymentPOCheck: function () {
		$(document.body).on("click", ".js-ponumber-continue", function () {

			var poNumber = $(".js-payment-po-number").val();
			var currentElement = $(this)
			if (poNumber) {
				$.ajax({
					url:ACC.config.encodedContextPath + "/checkout/multi/order-type/poNumber?poNumber=" + poNumber,
					method: "GET",
					success: function (response) {
						if ($(currentElement).data("isporequired") === true) {
							if (response == true) {
								$(".js-mixed-cart-payment-section").removeClass("hidden")
								$(".js-po-error-msg").addClass("hidden")
								$(".js-payment-po-number").removeClass("po-error").prop("disabled",true)
								$(currentElement).addClass("hidden")
							}
							else {
								$(".js-mixed-cart-payment-section").addClass("hidden");
								$(".js-po-error-msg").removeClass("hidden");
								$(".js-payment-po-number").addClass("po-error").prop("disabled",false)
								$(currentElement).removeClass("hidden")
							}
						}

					}

				});
			}
			else {
				$(".js-mixed-cart-payment-section").addClass("hidden");
				$(".js-po-error-msg").removeClass("hidden");
				$(".js-payment-po-number").addClass("po-error").prop("disabled",false)
				$(currentElement).removeClass("hidden")
			}
			
		})
		$(document.body).on("input", ".js-payment-po-number", function () {
			$(".js-po-error-msg").addClass("hidden")
			$(".js-payment-po-number").removeClass("po-error");			
		});
		$(document.body).on("blur", ".js-optional-po-txt-box", function () {
			var poNumber = $(this).val();
			if (poNumber) {
				$.ajax({
					url: ACC.config.encodedContextPath + "/checkout/multi/order-type/poNumber?poNumber=" + poNumber,
					method: "GET",
					success: function (response) {
						$(".js-payment-po-number").removeClass("po-error").prop("disabled",true)
					}
				})
			}
		})
		
	},
	checkoutAccordian: function(checkAco, defaultAco)
    {
		let firstBox;
		let counter=0;
		let guestUser = $(".isguestuser").val();
		let contactFilled = $("#mixedcart-data").html();
		if(guestUser == "true" && contactFilled == ""){ //guest user without address
			firstBox = true;
			$(".mixCartChangeContact").show();
		}
		else if(guestUser == "true" && contactFilled != ""){ //guest user with address
			$(".edit-mixedcart-contact-information, .saved-mixedcart-contact-details").show();
		}
		 if($(".page-siteOneCheckoutPage").length > 0){
		 	try{
					 _satellite.track('contactDetails');
					} catch (e) {}
		}
		for (let i=0; i<checkAco.length; i++){
			let target = $("." + checkAco[i]);
			var type = checkAco[i].split("-")[0];
			
			if(target.length){
				$(".addAddressFormSubmit").addClass("mixedcart-addAddressFormSubmit").removeClass("addAddressFormSubmit");
				counter++;
				let targetData = $("." + type + "-section");
				if(!firstBox){
					for (let j=0; j<defaultAco.length; j++){
						if(type == defaultAco[j]){
							if((type == "delivery" || type == "shipping") && $("." + type + "-region").html() == ""){ //updating saved data for closed accordion
								$("." + type + "-address").html($("#mixedcart-" + type + "addressdata").html()+"<br>"+$("#mixedcart-" + type + "addressdat1").html()+"<br>"+$("#mixedcart-" + type + "citydata").html()+", "+$("#mixedcart-" + type + "statedata").html() +" " + $("#mixedcart-" + type + "zipdata").html());
								$("." + type + "-region").html($("#mixedcart-" + type + "statedata").html());
							}
							targetData.removeClass("hidden");
							firstBox = true;
							
							if(type=="pickup"){
								 try{
									 _satellite.track('branchPickup');
									 } catch (e) {}
								}
							else if(type=="delivery"){
								 try{
									 _satellite.track('localDelivery');
									 } catch (e) {}
							}
			
							else if(type=="shipping"){
								 try{
									 _satellite.track('shippingDetails');
									 } catch (e) {}
							}
							
							break;
						}
					}
				}
				else{
					targetData.hide().removeClass("hidden");
				}
				targetData.find(".submit-ordertype-data").attr({"data-type": type, "data-aconum":  counter});
				$(".mixedcart-sameaddress-" + type).attr("data-mode", type).on("change", ACC.mixedcartcheckout.isSameAddress);
			}
			else{
				$(".mixedcart-sameaddress-" + type).parents(".mixedcart-sameaddress").hide();
			}
		}
	},
	closeOpenBloc: function(target){ //on edit button open current block
		let modes = ["mixedcart-contact","pickup","delivery","shipping"];
		for(let i=0; i<modes.length; i++){
			if(modes[i] != target && $("."+ modes[i] + "-section").length && $("."+ modes[i] + "-section").css("display") == "block"){
				$("."+ modes[i] + "-box").find(".saved-"+ modes[i] +"-details, .edit-"+ modes[i] +"-information").show();
				$("."+ modes[i] + "-box").find("." + modes[i] +"_fee").hide();
				$("."+modes[i] + "-section").hide();
			}
			if(target == "mixedcart-contact"){
				$("."+ modes[i] + "-box").find(".edit-"+ modes[i] +"-information").hide();
			}
			
		}
		//Opening New Block
		$(".mixedcart-checkout").children("#siteOneOrderTypeForm").show();
		$("."+ target + "-box").find(".saved-"+ target +"-details, .edit-"+ target +"-information").hide();
		$("."+ target + "-box").find("." + target +"_fee").show();
		$("." + target + "-section").slideDown(function(){
			$(window).scrollTop($("." + target + "-box").offset().top);
			if($(".mixedcart-" + target + "-check").prop("disabled")){
				$(".mixedcart-" + target + "-check").prop("checked", false);
				$("."+ target + "-mixedcart-form").show();
			}
		});
		if(target=="mixedcart-contact"){
			 try{
				 _satellite.track('contactDetails');
				 } catch (e) {}
			}
		else if(target=="pickup"){
			 try{
				 _satellite.track('branchPickup');
				 } catch (e) {}
			}
				else if(target=="delivery"){
					 try{
						 _satellite.track('localDelivery');
						 } catch (e) {}
				}

			else if(target=="shipping"){
				 try{
					 _satellite.track('shippingDetails');
					 } catch (e) {}
			}
		
	},
	openNextBlockAccordion: function(type, num, paymentBlock){ //on continue open next block
		let NextBtn = $("[data-aconum="+ (num+1) +"]");
		let modes = ["pickup","delivery","shipping"];
		//closing current Block
		if((type == "delivery" || type == "shipping")){ //updating saved data for closed accordion
			if($(".mixedcart-" + type + "-check").prop("checked")){
				$("." + type + "-address").html($("#mixedcart-" + type + "addressdata").html()+"<br>"+$("#mixedcart-" + type + "addressdat1").html()+"<br>"+$("#mixedcart-" + type + "citydata").html().split(",")[0] + ", " + $("#mixedcart-" + type + "statedata").html() +" " + $("#mixedcart-" + type + "zipdata").html());
			}
			else{
				$("." + type + "-address").html($("." + type + "-Newaddress").html());
			}
		}
		$(".saved-" + type + "-details").show();
		$(".edit-" + type + "-information").show();
		$("." + type +"_fee").hide();
		$("." + type +"-section").hide();
		
		if(NextBtn.length){
			for(let i=0; i<modes.length; i++){
				if(NextBtn.parents("." + modes[i] + "-section").length){ //opening new Block
					$(".saved-" + modes[i] + "-details").hide();
					$(".edit-" + modes[i] + "-information").hide();
					$("." + modes[i] +"_fee").show();
					if($(".isguestuser").val() == "true"){
						if(modes[i] == "shipping" && $(".mixedcart-"+ modes[i] +"-check").prop("checked") && $("#mixedcart-"+ modes[i] +"statedata").html() != _AAData.storeState){
							$(".mixedcart-"+ modes[i] +"-check").prop("checked", false)
						}
						$(".mixedcart-"+ modes[i] +"-check").trigger("change")
					}
					$("." + modes[i] + "-section").slideDown(function(){
						$(window).scrollTop($("." + modes[i] + "-box").offset().top);
					});
					
					if(modes[i]=="pickup"){
							 try{
								 _satellite.track('branchpickup');
								 } catch (e) {}
						}
					else if(modes[i]=="delivery"){
							 try{
								 _satellite.track('localDelivery');
								 } catch (e) {}
						}
					else if(modes[i]=="shipping"){
								 try{
									 _satellite.track('shippingDetails');
									 } catch (e) {}
							}
					break;
				}
			}
			$("#iframe_Popup_guest").hide();
		}
		else{
			$(paymentBlock).css({overflow: (paymentBlock == ".choosepaymentB2b_GC")?"visible": "hidden"}).slideDown(function(){
				$(window).scrollTop($(paymentBlock).offset().top-60);
				try {
					 _satellite.track("paymentDetails");
					} catch (e) {}
			});
		}
		
	},
	copySameDataFor: function(type, firstname,lastname,phonedata,emaildata,addressdata,addressdata1,citydata,statedata,zipdata ){
		//saved Data section
		$("." + type + "-address").html(addressdata+"<br>"+addressdata1+"<br>"+citydata+", "+statedata +" " + zipdata);
		$("." + type + "-contact-details").html(firstname+" "+lastname+"<br>"+phonedata+"<br>"+emaildata);
		
		//same address data section
		$("#mixedcart-" + type + "addressdata").html(addressdata);
		$("#mixedcart-" + type + "addressdat1").html(addressdata1);
		$("#mixedcart-" + type + "citydata").html(citydata + ", ");
		$("#mixedcart-" + type + "statedata").html(statedata);
		$("#mixedcart-" + type + "zipdata").html(zipdata);
	},
	isSameAddress: function(){
		let ref = $(this);
		let mode = ref.attr("data-mode");

		if($(".mixedcart-contact-section").css("display") == "block"){
			if(!$(".mixedcart-" +mode+ "-check").prop("disabled")){
				$(".mixedcart-" +mode+ "-check").prop("checked", ref.prop("checked"));
			}
		}
	},
	transportKeyGCGenerateMxedCart: function (){
	$.ajax({
			url: ACC.config.encodedContextPath + "/checkout/multi/siteone-payment/getBoardCardTransportKey?isCheckout="+true,
			method: "POST",
	
			success: function (transportKey) {
	
				if (transportKey != null) {
					loading.stop();
					var redirecturl = 'https://transport.merchantware.net/v4/TransportMobile.aspx?transportKey=' + transportKey;
			
					$(".Pop-up-myIframe ").attr('src', redirecturl );
				}
			}
		});
}, 
createDeliveryPopupContentMixedCart: function(addressVerificationData){
	
	var popupContent = "";	
	
	if(addressVerificationData.isAddressCorrected){
		popupContent ="<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ $("#mixedcart-deliveryContactForm #checkoutdeliveryaddressLine1").val() +"</span><div class='cl'></div>"
		  
		if($("#mixedcart-deliveryContactForm #checkoutdelivery\\.addressLine2").val() != ""){
			popupContent = popupContent +  $("#mixedcart-deliveryContactForm #checkoutdelivery\\.addressLine2").val() +"<div class='cl'></div>";
		  }
		
		   popupContent = popupContent + $("#mixedcart-deliveryContactForm #checkoutdeliverycity").val() +"<div class='cl'></div>"+ $("#mixedcart-deliveryContactForm #checkoutdeliverystate option:selected").text() +"<div class='cl'></div>"+ $("#mixedcart-deliveryContactForm #checkoutdeliveryzip").val() +" </div></div>";
		
		popupContent = popupContent+"<div class='col-md-6 col-xs-12 margin-top-add'><span class='hidden-md hidden-lg'><br/><br/></span><span class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.suggestedAddress+"</b></span><div class='cl'></div><p></p>";
		
			popupContent = popupContent+"<div class='add-address-sec'><span id='suggestedAddress.line1'  data-line1='"+addressVerificationData.street+"'>"+ addressVerificationData.street +"</span>";
		
			popupContent = popupContent+"<span id='suggestedAddress.line2' data-line2='"+addressVerificationData.street2+"'>"+ addressVerificationData.street2+"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.city' data-city='"+addressVerificationData.city+"'>"+ addressVerificationData.city +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.county' data-county='"+addressVerificationData.county+"'>"+ addressVerificationData.county +"</span> <div class='cl'></div>";
			
			popupContent = popupContent+"<span id='suggestedAddress.state'  data-state='"+addressVerificationData.state+"'>"+ addressVerificationData.state +"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.zipcode'  data-zipcode='"+addressVerificationData.zipcode+"'>"+ addressVerificationData.zipcode +"</span>";	        						
        					
			popupContent = popupContent+"</div></div>  <div class='cl'></div><br><br> <div class='col-md-4 col-sm-6 col-xs-4'><input type='button' class='btn btn-primary btn-block' value='"+ACC.config.save+"' id= 'suggestedValidDeliveryAddressSubmitMixedCart'/></div><div class='col-md-4 col-sm-6 col-xs-4'> <input type='button' class='btn btn-default btn-block' value='"+ACC.config.cancel+"' id= 'suggestedAddressCancel'/> </div></form>";		        				    
			
	}else if(!addressVerificationData.isAddressValid){
		popupContent = "<p style='margin-top:-18px;'>"+ACC.config.veryfyAddressError+"</p> <br> <div class='row'><div class='col-md-6 col-xs-12  col-sm-12'><input type='button' value='Proceed Anyway'  class='btn btn-primary btn-block' id='proceedDeliveryOriginalAddressMixedCart'/></div> <span class='hidden-xs hidden-md hidden-lg visible-sm'><div class='cl'></div><br/></span><div class='col-md-6 col-xs-12 col-sm-12'><input type='button' value='Edit Address' class='btn btn-default btn-block' id='editOriginalAddress'/></div></div>";
		
	}
	
return popupContent;
},
copySuggestedValidDeliveryAddressToForm: function()
{
	$("#mixedcart-deliveryContactForm #checkoutdeliveryaddressLine1").val($("#suggestedAddress\\.line1").data("line1"));
    $("#mixedcart-deliveryContactForm #checkoutdelivery\\.addressLine2").val($("#suggestedAddress\\.line2").data("line2"));
    $("#mixedcart-deliveryContactForm #checkoutdeliverycity").val($("#suggestedAddress\\.city").data("city"));
    $("#mixedcart-deliveryContactForm #checkoutdeliverystate").val($("#suggestedAddress\\.state").data("state"));
    $("#mixedcart-deliveryContactForm #checkoutdeliveryzip").val($("#suggestedAddress\\.zipcode").data("zipcode"));
},
createShippingPopupContentMixedCart: function(addressVerificationData){
	
	var popupContent = "";	
	
	if(addressVerificationData.isAddressCorrected){
		popupContent ="<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ $("#mixedcart-shipmentForm #checkoutShippingaddressLine1").val() +"</span><div class='cl'></div>"
		  
		if($("#mixedcart-shipmentForm #checkoutShipping\\.addressLine2").val() != ""){
			popupContent = popupContent +  $("#mixedcart-shipmentForm #checkoutShipping\\.addressLine2").val() +"<div class='cl'></div>";
		  }
		
		   popupContent = popupContent + $("#mixedcart-shipmentForm #checkoutShippingcity").val() +"<div class='cl'></div>"+ $("#mixedcart-shipmentForm #checkoutShippingstate option:selected").text() +"<div class='cl'></div>"+ $("#mixedcart-shipmentForm #checkoutShippingzip").val() +" </div></div>";
		
		popupContent = popupContent+"<div class='col-md-6 col-xs-12 margin-top-add'><span class='hidden-md hidden-lg'><br/><br/></span><span class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.suggestedAddress+"</b></span><div class='cl'></div><p></p>";
		
			popupContent = popupContent+"<div class='add-address-sec'><span id='suggestedAddress.line1'  data-line1='"+addressVerificationData.street+"'>"+ addressVerificationData.street +"</span>";
		
			popupContent = popupContent+"<span id='suggestedAddress.line2' data-line2='"+addressVerificationData.street2+"'>"+ addressVerificationData.street2+"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.city' data-city='"+addressVerificationData.city+"'>"+ addressVerificationData.city +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.county' data-county='"+addressVerificationData.county+"'>"+ addressVerificationData.county +"</span> <div class='cl'></div>";
			
			popupContent = popupContent+"<span id='suggestedAddress.state'  data-state='"+addressVerificationData.state+"'>"+ addressVerificationData.state +"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.zipcode'  data-zipcode='"+addressVerificationData.zipcode+"'>"+ addressVerificationData.zipcode +"</span>";	        						
        					
			popupContent = popupContent+"</div></div>  <div class='cl'></div><br><br> <div class='col-md-4 col-sm-6 col-xs-4'><input type='button' class='btn btn-primary btn-block' value='"+ACC.config.save+"' id= 'suggestedValidShippingAddressSubmitMixedCart'/></div><div class='col-md-4 col-sm-6 col-xs-4'> <input type='button' class='btn btn-default btn-block' value='"+ACC.config.cancel+"' id= 'suggestedAddressCancel'/> </div></form>";		        				    
			
	}else if(!addressVerificationData.isAddressValid){
		popupContent = "<p style='margin-top:-18px;'>"+ACC.config.veryfyAddressError+"</p> <br> <div class='row'><div class='col-md-6 col-xs-12  col-sm-12'><input type='button' value='Proceed Anyway'  class='btn btn-primary btn-block' id='proceedShippingOriginalAddressMixedCart'/></div> <span class='hidden-xs hidden-md hidden-lg visible-sm'><div class='cl'></div><br/></span><div class='col-md-6 col-xs-12 col-sm-12'><input type='button' value='Edit Address' class='btn btn-default btn-block' id='editOriginalAddress'/></div></div>";
		
	}
	
return popupContent;
},
copySuggestedValidShippingAddressToForm: function()
{
	$("#mixedcart-shipmentForm #checkoutShippingaddressLine1").val($("#suggestedAddress\\.line1").data("line1"));
    $("#mixedcart-shipmentForm #checkoutShipping\\.addressLine2").val($("#suggestedAddress\\.line2").data("line2"));
    $("#mixedcart-shipmentForm #checkoutShippingcity").val($("#suggestedAddress\\.city").data("city"));
    $("#mixedcart-shipmentForm #checkoutShippingstate").val($("#suggestedAddress\\.state").data("state"));
    $("#mixedcart-shipmentForm #checkoutShippingzip").val($("#suggestedAddress\\.zipcode").data("zipcode"));
},
createPopupContent: function(addressVerificationData){
	
	var popupContent = "";	
	
	if(addressVerificationData.isAddressCorrected){

		if($(".pagename").val() == "Add Edit Address Page"){

			popupContent ="<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ $("#siteOneAddressForm #address\\.line1").val() +"</span><div class='cl'></div>"

			if($("#siteOneAddressForm #address\\.line2").val() != ""){
				popupContent = popupContent +  $("#siteOneAddressForm #address\\.line2").val() +"<div class='cl'></div>";
			}

		   popupContent = popupContent + $("#siteOneAddressForm #address\\.townCity").val() +"<div class='cl'></div>"+ $("#siteOneAddressForm #address\\.region option:selected").text() +"<div class='cl'></div>"+ $("#siteOneAddressForm #address\\.postcode").val() +" </div></div>";

			popupContent = popupContent+"<div class='col-md-6 col-xs-12 margin-top-add'><span class='hidden-md hidden-lg'><br/><br/></span><span class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.suggestedAddress+"</b></span><div class='cl'></div><p></p>";

			popupContent = popupContent+"<div class='add-address-sec'><span id='suggestedAddress.line1'  data-line1='"+addressVerificationData.street+"'>"+ addressVerificationData.street +"</span>";

			popupContent = popupContent+"<span id='suggestedAddress.line2' data-line2='"+addressVerificationData.street2+"'>"+ addressVerificationData.street2+"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.city' data-city='"+addressVerificationData.city+"'>"+ addressVerificationData.city +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.county' data-county='"+addressVerificationData.county+"'>"+ addressVerificationData.county +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.state'  data-state='"+addressVerificationData.state+"'>"+ addressVerificationData.state +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.zipcode'  data-zipcode='"+addressVerificationData.zipcode+"'>"+ addressVerificationData.zipcode +"</span>";

			popupContent = popupContent+"</div></div>  <div class='cl'></div><br><br> <div class='col-md-4 col-sm-6 col-xs-4'><input type='button' class='btn btn-primary btn-block' value='"+ACC.config.save+"' id= 'suggestedValidAddressSubmitMixCart'/></div><div class='col-md-4 col-sm-6 col-xs-4'> <input type='button' class='btn btn-default btn-block' value='"+ACC.config.cancel+"' id= 'suggestedAddressCancel'/> </div></form>";

		} else {

			popupContent ="<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 margin-top-add'> <span class='colored-radio'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.originalAddress+"</b></span><div class='cl'></div><p></p><div class='add-address-sec'> <span>"+ $("#SiteOneGCContactForm #checkoutContactaddressLine1").val() +"</span><div class='cl'></div>"
		  
			if($("#SiteOneGCContactForm #checkoutContact\\.addressLine2").val() != ""){
				popupContent = popupContent +  $("#SiteOneGCContactForm #checkoutContact\\.addressLine2").val() +"<div class='cl'></div>";
			}
		
		   popupContent = popupContent + $("#SiteOneGCContactForm #checkoutContactcity").val() +"<div class='cl'></div>"+ $("#SiteOneGCContactForm #checkoutContactstate option:selected").text() +"<div class='cl'></div>"+ $("#SiteOneGCContactForm #checkoutContactzip").val() +" </div></div>";
		
			popupContent = popupContent+"<div class='col-md-6 col-xs-12 margin-top-add'><span class='hidden-md hidden-lg'><br/><br/></span><span class='colored-radio'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/></span> <span class='black-title'><b>"+ACC.config.suggestedAddress+"</b></span><div class='cl'></div><p></p>";
		
			popupContent = popupContent+"<div class='add-address-sec'><span id='suggestedAddress.line1'  data-line1='"+addressVerificationData.street+"'>"+ addressVerificationData.street +"</span>";
		
			popupContent = popupContent+"<span id='suggestedAddress.line2' data-line2='"+addressVerificationData.street2+"'>"+ addressVerificationData.street2+"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.city' data-city='"+addressVerificationData.city+"'>"+ addressVerificationData.city +"</span> <div class='cl'></div>";

			popupContent = popupContent+"<span id='suggestedAddress.county' data-county='"+addressVerificationData.county+"'>"+ addressVerificationData.county +"</span> <div class='cl'></div>";
			
			popupContent = popupContent+"<span id='suggestedAddress.state'  data-state='"+addressVerificationData.state+"'>"+ addressVerificationData.state +"</span> <div class='cl'></div>";
		
			popupContent = popupContent+"<span id='suggestedAddress.zipcode'  data-zipcode='"+addressVerificationData.zipcode+"'>"+ addressVerificationData.zipcode +"</span>";	        						
        					
			popupContent = popupContent+"</div></div>  <div class='cl'></div><br><br> <div class='col-md-4 col-sm-6 col-xs-4'><input type='button' class='btn btn-primary btn-block' value='"+ACC.config.save+"' id= 'suggestedValidAddressSubmitMixCart'/></div><div class='col-md-4 col-sm-6 col-xs-4'> <input type='button' class='btn btn-default btn-block' value='"+ACC.config.cancel+"' id= 'suggestedAddressCancel'/> </div></form>";
		}


			
	}else if(!addressVerificationData.isAddressValid){
		popupContent = "<p style='margin-top:-18px;'>"+ACC.config.veryfyAddressError+"</p> <br> <div class='row'><div class='col-md-6 col-xs-12  col-sm-12'><input type='button' value='Proceed Anyway'  class='btn btn-primary btn-block' id='proceedOriginalAddressMixedCart'/></div> <span class='hidden-xs hidden-md hidden-lg visible-sm'><div class='cl'></div><br/></span><div class='col-md-6 col-xs-12 col-sm-12'><input type='button' value='Edit Address' class='btn btn-default btn-block' id='editOriginalAddress'/></div></div>";
		
	}
	
		return popupContent;
	},
	yourItemsScroll: function(){
		let target = $(".mixedcart-ordersummary");
		let itemHeight = target.eq(0).height();
		let isIOS = ACC.mixedcartcheckout.iOS();
		itemHeight = (itemHeight == 0)? target.eq(1).height() : itemHeight;
		if(itemHeight > 1200 || itemHeight == 0){
			target.each(function(){
				$(this).addClass((!isIOS)? "notIOS" : "").parent().addClass("scroll-r");
			})
		}
	},
	iOS: function() {
	  return [
	    'iPad Simulator',
	    'iPhone Simulator',
	    'iPod Simulator',
	    'iPad',
	    'iPhone',
	    'iPod'
	  ].includes(navigator.platform)
	  // iPad on iOS 13 detection
	  || (navigator.userAgent.includes("Mac") && "ontouchend" in document)
	}
};   
$( document ).ready(function() {
	
	ACC.mixedcartcheckout.checkoutStepEmailValidation();
	
    $(document.body).on("click",".delivery-mode",function()
		{
			ACC.mixedcartcheckout.bindOrderType();
			ACC.mixedcartcheckout.removeErrorClassForCheckoutForm('#orderTypeRadio', '#errorOrderTypeRadio', '#orderTypeRadio\\.errors')
			
		});
    
    
    
   var failuretested=$("#cayanFailure").val();
  
   if(failuretested =='failure'){
	   ACC.colorbox.open("", {
		   html:  ["<div class='cartShareEmail PopupBox'>",
                  "<p>"+ACC.config.cayan+"</p>",
                   "</div>"].join(''),
          width: '480px',
          height:'auto',
          title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.cayanTitle+"</span></h4>",
          close:'<span class="glyphicon glyphicon-remove"></span>',
          onComplete: function() {
        	   $('#cboxLoadedContent #cboxClose').click(function(){
        		   window.location.href=ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/add";
             		
             		});
       		$("body").css("overflow-y", "hidden");
       		
       	 
       	},
       	onClosed: function() {
       		$('body').css("overflow-y","auto");
       		window.location.href=ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/add";
       	 
       		}
		  });
   }

	$("#paymentFailedGc").hide();
	 $("#iframe_Popup_guest").hide();
	var errorAddEwallet=$("#cayanFailure").val();
	
	var guestUser=$(".isguestuser").val();
	var orderType = $("#orderType").val();
	if(guestUser== 'true'){
		var customer= $(".currentCustomer").val();
		if(customer != null && customer != ""){
			if(orderType == "PARCEL_SHIPPING"){
				$("#parcelShipping_div").show();
			}else{
				$("#siteOneOrderTypeForm").show();
			}
		}else{
			if(orderType == "PARCEL_SHIPPING"){
				$("#parcelShipping_div").hide();
			}else{
				$(".mixedcart-checkout #siteOneOrderTypeForm").show();
			}
		}
	}else{
		if(orderType == "PARCEL_SHIPPING"){
			$("#parcelShipping_div").show();
			 
		}else{
			$("#siteOneOrderTypeForm").show();
		}
	}
	

	if(errorAddEwallet != null && errorAddEwallet != ""){
		   ACC.colorbox.open("", {
			   html: $(".add-eroor-card-ewallet").html(),
	       width: '480px',
	       height:'auto',
	       
	       close:'<span class="glyphicon glyphicon-remove"></span>',
	       onComplete: function() {
	    	   $('#cboxLoadedContent #cboxClose').click(function(){
        		   window.location.href=ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/add";
             		
             		});
	    		$("body").css("overflow-y", "hidden");
	    		
	    	 
	    	},
	    	onClosed: function() {
	    		$('body').css("overflow-y","auto");
	    		window.location.href=ACC.config.encodedContextPath +"/checkout/multi/siteone-payment/add";
	    	 
	    		}
			  });
	}
	
	
	
	$(".panel-title-value ").click(function() {
		  $('.collapsed').slideToggle().toggleClass('active');
		  if ($('.collapsed').hasClass('active')) {
			  $('.panel-title-value').html('<span class="glyphicon glyphicon-chevron-up"></span> ');
		  } else {
		    $('.panel-title-value').html('<span class="glyphicon glyphicon-chevron-down"></span> ');
		  }
		});
	

	if($("body").hasClass("page-orderConfirmationPage")){
		sessionStorage.removeItem("IsProp65Shown");
	}
	$('input[name=requestedMeridian]').click(function () {
        $('input[name=requestedMeridian]:not(:checked)').closest(".radio-wrapper").removeClass("selected-time");
        $('input[name=requestedMeridian]:checked').closest(".radio-wrapper").addClass("selected-time");
    });
	
	$("#iframe_Popup_guest").hide();
	 $(".choosepaymentB2b_GC").hide();
	$('.mixedcart-shipping-check').change(function() {
		$(".mixedcart-sameaddress-shipping").prop("checked", this.checked);
		$(".same-shipping-state-error").addClass("hidden");
		  if(this.checked){
			  $('.shipping-mixedcart-form').hide();
			$(".mixedcartShippingBoxGC").show();
			  $("#shipping_div").show();
  			$("#shipping_btn").show();
  			$(".mixedcart-shipping-Newaddress").hide();
	    	  $(".mixedcart-shipping-Newregion").hide();
	    	  $("#mixedcart-shippingaddressdata").show();
	    	  $("#mixedcart-shippingaddressdat1").show();
	    	  $("#mixedcart-shippingcitydata").show();
	    	  $("#mixedcart-shippingstatedata").show();
	    	  $("#mixedcart-shippingzipdata").show();
	    	  let firstname = $("#mixedcart-data").html();
	    	  let lastname = $("#mixedcart-lastNamedata").html();
	    	  let phonedata = $("#mixedcart-phonedata").html();
	    	  let emaildata = $("#mixedcart-emaildata").html();
	    	  let addressdata = $("#mixedcart-addressdata").html();
	    	  let addressdata1 = $("#mixedcart-addressdat1").html();
	    	  let citydata = $("#mixedcart-citydata").html();
	    	  let statedata = $("#mixedcart-statedata").html();
	    	  let zipdata = $("#mixedcart-zipdata").html();
	    	  
	    	  $(".shipping-address").html(addressdata+"<br>"+addressdata1+"<br>"+citydata+", "+statedata +" " + zipdata);
				$(".shipping-contact-details").html(firstname+" "+lastname+"<br>"+phonedata+"<br>"+emaildata);
		  
		  }

	      else{
	    	  $('.shipping-mixedcart-form').show();
			$(".mixedcartShippingBoxGC").hide();
	    	  $("#shipping_div").hide();
  			$("#shipping_btn").hide();
  			$(".mixedcart-shipping-Newaddress").show();
	    	 $(".mixedcart-shipping-Newregion").show();
	    	  $("#mixedcart-shippingaddressdata").hide();
	    	  $("#mixedcart-shippingaddressdat1").hide();
	    	  $("#mixedcart-shippingcitydata").hide();
	    	  $("#mixedcart-shippingstatedata").hide();
	    	  $("#mixedcart-shippingzipdata").hide();
	      }

		 });
	
	$('.mixedcart-delivery-check').change(function() {
		$(".mixedcart-sameaddress-delivery").prop("checked", this.checked)
		  if(this.checked){
			  $('.deliveryContact-form').hide();
			  $(".mixedcartDeliveryBoxGC").show();
			  $("#termsPODiv").show();
	    	  $("#delivery_content2").show();
	    	  $("#pickup-delivery").show();
	    	  $(".payment_cbtn").show();
	    	  ACC.mixedcartcheckout.deliveryNewAddressShowForm();
	    	  let firstname = $("#mixedcart-data").html();
	    	  let lastname = $("#mixedcart-lastNamedata").html();
	    	  let phonedata = $("#mixedcart-phonedata").html();
	    	  let emaildata = $("#mixedcart-emaildata").html();
	    	  let addressdata = $("#mixedcart-addressdata").html();
	    	  let addressdata1 = $("#mixedcart-addressdat1").html();
	    	  let citydata = $("#mixedcart-citydata").html();
	    	  let statedata = $("#mixedcart-statedata").html();
	    	  let zipdata = $("#mixedcart-zipdata").html();
	    	  
	    	  $(".delivery-address").html(addressdata+"<br>"+addressdata1+"<br>"+citydata+", "+statedata +" " + zipdata);
				$(".delivery-contact-details").html(firstname+" "+lastname+"<br>"+phonedata+"<br>"+emaildata);
	    	  

		  }else{
	    	  $('.deliveryContact-form').show();
			  $(".mixedcartDeliveryBoxGC").hide();
	    	  $("#termsPODiv").hide();
	    	  $("#delivery_content2").hide();
	    	  $("#pickup-delivery").hide();
	    	  ACC.mixedcartcheckout.deliveryNewAddressHideForm();
	      }

		 });
		 
		 $(document).on("click", "#suggestedValidAddressSubmitMixCart", function()
		{			
			var addressOption = $("input[name='address\\.addressSuggestionOption']:checked").val();
		 	try{
					 _satellite.track('contactDetails');
					} catch (e) {}
			if(addressOption == "originalAddress")
			{
				if($(".pagename").val() == "Add Edit Address Page"){
					ACC.colorbox.close();
					$("#siteOneAddressForm" ).submit();
				}else{
					ACC.colorbox.close();
					ACC.mixedcartcheckout.saveContacForm();
				}

			}
			
            if(addressOption == "suggestedAddress")
            {
            	if($(".pagename").val() == "Add Edit Address Page"){
					copySuggestedValidAddressToForm();
					ACC.colorbox.close();
				} else {
					copySuggestedValidAddressToForm();
					ACC.colorbox.close();
					ACC.mixedcartcheckout.saveContacForm();
				}

			}
		});
$(document).on("click", "#proceedDeliveryOriginalAddressMixedCart", function()
		{							
			ACC.mixedcartcheckout.saveAlternateDeliveryContactForm();
			ACC.colorbox.close();
	
		});

$(document).on("click", "#proceedOriginalAddressMixedCart", function()
		{							
			if($(".pagename").val() != "Add Edit Address Page"){
				ACC.mixedcartcheckout.saveContacForm();
				ACC.colorbox.close();
			}

		});

$(document).on("click", "#proceedShippingOriginalAddressMixedCart", function()
		{							
			ACC.mixedcartcheckout.saveShippingAlternateContactForm();
			ACC.colorbox.close();
		});

$(document).on("click", "#suggestedValidShippingAddressSubmitMixedCart", function()
		{			
			var addressOption = $("input[name='address\\.addressSuggestionOption']:checked").val();
			if(addressOption == "originalAddress")
			{
				  ACC.colorbox.close();
				ACC.mixedcartcheckout.saveShippingAlternateContactForm();
			}
			
            if(addressOption == "suggestedAddress")
            {
            	ACC.mixedcartcheckout.copySuggestedValidShippingAddressToForm();
            	  ACC.colorbox.close();
            	ACC.mixedcartcheckout.saveShippingAlternateContactForm();
			}
		});
		
$(document).on("click", "#suggestedValidDeliveryAddressSubmitMixedCart", function()
		{			
			var addressOption = $("input[name='address\\.addressSuggestionOption']:checked").val();
			if(addressOption == "originalAddress")
			{
				  ACC.colorbox.close();
				ACC.mixedcartcheckout.saveAlternateDeliveryContactForm();
			}
			
            if(addressOption == "suggestedAddress")
            {
            	ACC.mixedcartcheckout.copySuggestedValidDeliveryAddressToForm();
            	  ACC.colorbox.close();
            	ACC.mixedcartcheckout.saveAlternateDeliveryContactForm();
			}
		});

        $(document).on("click", "#editOriginalAddress", function()
        {
	 		ACC.colorbox.close();		
	    });
        
        $(document).on("click", "#suggestedAddressCancel", function()
	    {
	 	   ACC.colorbox.close();		
	    });
		 	
});
ACC.checkoutaddress = {

	spinner: $("<img src='" + ACC.config.commonResourcePath + "/images/spinner.gif' />"),
	addressID: '',

	showAddressBook: function ()
	{
		$(document).on("click", "#viewAddressBook", function ()
		{
			var data = $("#savedAddressListHolder").html();
			$.colorbox({

				height: false,
				html: data,
				onComplete: function ()
				{

					$(this).colorbox.resize();
				}
			});

		})
	},

	showRemoveAddressConfirmation: function ()
	{
		$(document).on("click", ".removeAddressButton", function ()
		{
			var addressId = $(this).data("addressId");
			$.colorbox({
				inline: true,
				height: false,
				href: "#popup_confirm_address_removal_" + addressId,
				onComplete: function ()
				{

					$(this).colorbox.resize();
				}
			});

		})
	}
}

// Address Verification
$(document).ready(function ()
{
	with (ACC.checkoutaddress)
	{

		showAddressBook();
		showRemoveAddressConfirmation();
	}
});


ACC.checkoutsteps = {

	_autoload: [
		"permeateLinks"
	],
			
	permeateLinks: function() {
	
		$(document).on("click",".js-checkout-step",function(e){
			e.preventDefault();
			window.location=$(this).closest("a").attr("href")
		})		
	}


};
ACC.cms = {
	loadComponent: function(id, type, target, onSuccess, onError) {
		var self = this;
		if(id) {
			$.ajax({
				url:  ACC.config.encodedContextPath + '/cms/component?componentUid=' + id,
				cache: false,
				type: 'GET',
				success: function (result) {
					reprocess = result.indexOf('js-responsive-image') > -1;
					self.insertHtml(result, target, reprocess);
					if(onSuccess) {
						onSuccess(result, id, type, target);
					}
				},
				error: function (result) {
					if(onError) {
						onError(result, id, type, target);
					}
				}
			});
		}
	},
	
	insertHtml: function(html, target, reprocess) {
		if(target) {
			$(target).html(html);
			if(reprocess) {
				ACC.global.reprocessImages();
			}
		}
	}
}
//Makes Color Box Responsive
var cboxOptions = {
	width: '95%',
	height: '95%',
	maxWidth: '960px',
	maxHeight: '960px',
}
var windowWidth = $(window).width();

$('.cbox-link').colorbox(cboxOptions);

$(window).resize(function(){

	//iOS should not trigger resize when scrolling
	if ($(window).width() != windowWidth) {
		windowWidth = $(window).width();
	} else {
		return;
	}

    if(!$('#colorbox').hasClass('variantSelectMobile')){
    	if($('#colorbox').find(".pickOrDelivery-changeContact").length){
    		ACC.colorbox.resizeTo("560","530");
    	} else if($('#colorbox').hasClass("add-to-cart-overlay")){
    		ACC.colorbox.resizeTo("650","550");
    	} else if($('#colorbox').hasClass("order-details-email-pop-up")){
    		ACC.colorbox.resizeTo("450","720");
    	} else if($('#colorbox').hasClass("share_By_Email_Popup")){
    		ACC.colorbox.resizeTo("450","479");
    	} else if($('#colorbox').hasClass("item-add-list-box")){
    		ACC.colorbox.resizeTo("621","150");
    	} else if($('#colorbox').hasClass("share-list-email-box")){
    		ACC.colorbox.resizeTo("430","500");
    	} else if($('#colorbox').hasClass("list_item_added")){
    		ACC.colorbox.resizeTo("650","224");
    	}
    	else{
	        $.colorbox.resize({
	            width: window.innerWidth > parseInt(cboxOptions.maxWidth) ? cboxOptions.maxWidth : cboxOptions.width,
	            height: window.innerHeight > parseInt(cboxOptions.maxHeight) ? cboxOptions.maxHeight : cboxOptions.height
	        });
    	}
    }
});


ACC.colorbox = {
	config: {
		maxWidth:"100%",
		opacity:0.7,
		width:"auto",
		transition:"none",
		close:'<span class="icon-close"></span>',
		title:'<div class="headline"><span class="headline-text">{title}</span></div>',
		onComplete: function() {
			$.colorbox.resize();
			ACC.common.refreshScreenReaderBuffer();
		},
		onClosed: function() {
			ACC.common.refreshScreenReaderBuffer();
		}
	},

	open: function(title,config){
		var config = $.extend({},ACC.colorbox.config,config);
		config.title = config.title.replace(/{title}/g,title);
		return $.colorbox(config);
	},

	resize: function(){
	
		$.colorbox.resize();
	},
	
	resizeTo: function(wdth,ht){
		if(wdth &&  ht){
			$.colorbox.resize({width:wdth,height:ht});
		}else if(wdth && !ht){
			$.colorbox.resize({width:wdth,height:"max-content"});
		}else if(!wdth && ht){
			$.colorbox.resize({height:ht});
		}
		
	},
	getSize: function(){
		var wdth=$("#colorbox").css("width");
		wdth=wdth.replace("px","");
		wdth=wdth.replace("rem","");
		wdth=wdth.replace("pt","");
		return wdth;
		
	},

	close: function(){
		$.colorbox.close();
	}
};

$(document).on('click', '#colorbox input, #colorbox textarea', function() {
	if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
		$(window).off('resize');
	}
});
ACC.common = {
		
		
	currentCurrency: $("main").data('currencyIsoCode') || "USD",
	processingMessage: $("<img src='" + ACC.config.commonResourcePath + "/images/spinner.gif'/>"),


	blockFormAndShowProcessingMessage: function (submitButton)
	{
		var form = submitButton.parents('form').first();
		form.block({ message: ACC.common.processingMessage });
	},
	
	refreshScreenReaderBuffer: function ()
	{
		// changes a value in a hidden form field in order
		// to trigger a buffer update in a screen reader
		$('#accesibility_refreshScreenReaderBufferField').attr('value', new Date().getTime());
	},

	checkAuthenticationStatusBeforeAction: function (actionCallback)
	{
		$.ajax({
			url: ACC.config.authenticationStatusUrl,
			statusCode: {
				401: function () {
					location.href = ACC.config.loginUrl;
				}
			},
			success: function (data) {
				if (data == "authenticated") {
					actionCallback();
				}
			}
		});
	}
};




jQuery.extend({
	postJSON: function (url, data, callback)
	{
		return jQuery.post(url, data, callback, "json");
	}
});

// add a CSRF request token to POST ajax request if its not available
$.ajaxPrefilter(function (options, originalOptions, jqXHR)
{
	// Modify options, control originalOptions, store jqXHR, etc
	if (options.type === "post" || options.type === "POST")
	{
		var noData = (typeof options.data === "undefined");
		if (noData)
		{
			options.data = "CSRFToken=" + ACC.config.CSRFToken;
		}
		else
		{
			var patt1 = /application\/json/i;
			if (options.data instanceof window.FormData)
			{
				options.data.append("CSRFToken", ACC.config.CSRFToken);
			}
			// if its a json post, then append CSRF to the header. 
			else if (patt1.test(options.contentType))
			{
				jqXHR.setRequestHeader('CSRFToken', ACC.config.CSRFToken);
			}
			// if its a logo upload form, then check for CSRF 
			else if (options.url.indexOf("uploadImage") !== -1)
			{
				$("#uploadImage").append(($("#uploadImage").find("[name='CSRFToken']").length)? '' : '<input type="hidden" name="CSRFToken" value="'+ ACC.config.CSRFToken +'">');
			}
			else if (options.data.indexOf("CSRFToken") === -1)
			{
				options.data = options.data + "&" + "CSRFToken=" + ACC.config.CSRFToken;
			}
		}
		
	}
});
ACC.forgottenpassword = {

	_autoload: [
		"bindLink",
		"forgotpasswordNew"
	],

	bindLink: function(){
		$(document).on("click",".js-password-forgotten,#lock-resetPassword",function(e){
			e.preventDefault();
			ACC.colorbox.open("", {
					href: $(this).data("link"),
					//title:"<div class='headline'><span class='headline-text'>"+ACC.config.error+"</span></div>",
					width:"480px",
					className: "overlay-forgot-pwd",
					onOpen: function()
					{
						$('#validEmail').remove();
					},
					onComplete: function(){ 
						_AAData.popupPageName= ACC.config.forgotpswrdpathingPageName;
						_AAData.popupChannel= ACC.config.myaccountpathingChannel;
        			 	try {
        				    	 _satellite.track('popupView');
        		        } catch (e) {}
						$(document).on("blur","#cboxContent #forgottenPwdForm input[name=email]",function(){   
							$(this).val($(this).val().trim());
						});
						ACC.forgottenpassword.setEvents();
					}
				}
			);
			
		});
		
		/*document.addEventListener('dragleave', function(e){
		    var top = e.pageY;
		    var right = document.body.clientWidth - e.pageX;
		    var bottom = document.body.clientHeight - e.pageY;
		    var left = e.pageX;
		    if(top < 10 || right < 20 || bottom < 10 || left < 10){
		        console.log('Mouse has moved out of window');
		    }
		});*/
		
		/*$(document).on('mouseleave','body',function(){
			CONDITIONS HERE
			alert("SCREEN LEAVE");
		});*/
		
	},
	setEvents : function() {
	
		$("#forgottenPwdForm input[name=email]").attr("placeholder",ACC.config.placeHolderEmail);
		$('form#forgottenPwdForm').ajaxForm({
			beforeSend: function () {
				var submitForm=true;
				loading.start();
				var briteverify = document.getElementById('briteVerifyEnable').value;
				if (ACC.formvalidation.validateEmailPattern($("#forgottenPwdForm .js-forgotpwd-input").val().trim())) {
					
					if (briteverify == "true") {
						var bUrl = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email=' + $("#forgottenPwdForm .js-forgotpwd-input").val().trim();
						loading.start();
						$.ajax({
							url: bUrl,
							type: "get",
							timeout: 5000,
							async:false,
							success: function (response) {

								if (response == "invalid") {
									loading.stop();
									$("#forgotPwdEmailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>" + ACC.config.emailAddressError1 + "</div></font></div>");
									ACC.colorbox.resize();
									submitForm= false;
								}

							}
						})
					}
				}
				else {
					loading.stop();
					$("#forgotPwdEmailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>" + ACC.config.dashboardValidEmail + "</div></font></div>");
					ACC.colorbox.resize();
					submitForm= false;
				}
				return submitForm;

			},

			success: function(data)
			{
			
			//	$("#forgottenPwdForm input[name=email]").attr("placeholder",ACC.config.placeHolderEmail);
			//	var  email=$("#forgottenPwdForm input[name=email]").val();
				//var correctEmail=email.trim();
				//$("#forgottenPwdForm input[name=email]").val(correctEmail);
				//console.log(correctEmail);
							loading.stop();
			     			$(".forgotten-password").replaceWith(data);
			     			ACC.forgottenpassword.setEvents();
							if ($(data).closest('#fgtPwdResponseSection').length)
							{
								
										$("#cboxTitle .headline-text").html(ACC.config.forgotPasswordMailSent);

							}
							ACC.colorbox.resize();
				
			}
			
			
			
		});
	},
	
	forgotpasswordNew:function(){
		 $(document.body).on('click','.forgotPass',function(e){
			 
			 if(($('#forgottenPwd-emailNew').val()).trim() == ''){
				 $(".help-block").show();
				 $("#forgottenPwd-emailNew").css({"background-color": "#fec3c3", "border-color": "#fd7b7b"});
			   }
			 
			 else{
			 $.colorbox({
					html: $("#fgtPwdResponseSection").html(),
					maxWidth:"450px",
					width:"auto",
					maxHeight:"100%",
					overflow:"auto",
					className:"newclass",
					title:"<h1 class='headline'>"+ACC.config.sentEmail+"</h1>",
					close:'<span class="glyphicon glyphicon-remove"></span>',
					onComplete: function(){
						
						$("#cboxClose").click(function(){
								  $("#forgottenPwd-emailNew").val('');
								});
		 				 
						}
				});
			 } 
			 
		}) 
	},

};
ACC.global = {

    _autoload: [
        ["passwordStrength", $('.password-strength').length > 0],
        "globalHeaderInitial",
        "bindToggleOffcanvas",
        "bindToggleXsSearch",
        "bindHoverIntentMainNavigation",
        "initImager",
        "backToHome",
        "bindHeaderWelcomeOverlay",
        "playVideo",
        ["countrySelection",  $('#User_Agent').val()!="SiteOneEcomApp"],
        "verticalNavigation",
        "bindShipToSelection",
        "disableImageRightClick",
        "pdfClicks",
        "successPopupbinding",
        "showToolTip",
        "disableClickToCall",
        "bindInvoiceCalendar",
        "bindcurrentdate",
        "bindInvoice",
        "bindpreviousdate",
        "bindCalendarCurrentdate",
        "bindCalendarpreviousdate",
        "bindInvoiceFormData",
        "bindShipToFormData",
        "getinvoicelastdate",
        "rememberMe",
               "rememberMePopup",
        "signInOverlay",
        "carouselClickEvent",
        "carouselClickEventPDP",
        "handleFlyoutIpad",
        "bindManagerUser",
        "userCheckboxMethods",
        "ndspage",
        "galleryboxpopup",
        "signInoverlayOpen",
        "getUserFirstName",
         "resetShiptoDropDown",
         "signInoverlayOpen",
		 "openMediaInPopup",
 	    "bindEwallet",
        "footerCurrentYear",
	    "analyticsPageIndentifier",
	    "analyticProductFindingMethod",
	    "analyticsExternalReferrer",
	    "analyticSearchEmpty",
	    "analyticProductRecommendation",
		"hardScapeDatePicker",
		"signInOverlay1",
		"hidecspSignInOverlay",
		"resetSortOnCategoryselect",
		"hardscapePLPLink",
		"hardscapePDPLink",
		"analytichardscapes",
        "analyticCuratedplp",
		"showRecommendedProduct",
		"passwordShowHideBtn",
		"passwordShowHideBtnOnCreatePasswordPage",
        "showContent",
        "showContent",
        "showPdpSticky",
        "pdpimageGalleryCarousel",
        "uomDropdowninventoryId",
        "bindLinkToPayDetails",
        "bindLinkToPayConfirmation",
        "bindsetactivetab",
        "hardscapeProductsAlertMsg",
        "analyticsProjectCalculator",
        "checkConsent",
        "pageIdSetforOrder",
        "getAllCategory",
        "addOgTags",
		"plpMobileViewResponse",
		["bindNumberInputEvent", $('.js-number-input-event-bind').length],
        ["bindScriptInputEvent", $('.js-script-input-event-bind').length]
    ],
    productAnalyticsRecAtc: false,
    productCutatedplp: false,
    productCutatedplpLoginToBuy: false,
    productCutatedplpList: false,
    productCutatedplpLink: false,
    productCutatedplpPagination: false,
    CutatedplpName: " ",
    curatedplpLinkName: " ",
    wWidth: $(window).width(),
    wHeight: $(window)[0].innerHeight,
    globalHeaderHeight: 0,
    windowScrollTop: $(window).scrollTop(),
    toastCounter: 1,
    toastShow: function (type, text, animateClasses) {
        if(!$(".toast-main-section").length){
            $("body").append('<section class="toast-main-section animated transition-3s"></section>');
        }
        $(".toast-main-section").append('<div type="'+ type +'" id="js-toast-'+ ACC.global.toastCounter +'" data-toastcounter="'+ ACC.global.toastCounter +'" data-text1="'+ text[0] +'" data-text2="'+ text[1] +'" data-class1="'+ animateClasses[0] +'" data-class2="'+ animateClasses[1] +'" class="row animated-3s '+ animateClasses[0] +' bg-dark-black text-white border-radius-3 flex-center p-y-20 position-relative m-b-10 toast-parent"><div class="col-md-3 sending-circle-loading hidden"><span></span></div><div class="col-md-3 f-s-8 sending-circle-confirm text-center"><span class="glyphicon glyphicon-ok"></span><p class="bg-dark-black transition-10s"></p></div><div class="col-md-9 f-s-12 l-h-14 p-l-35 text-uppercase ajax-text-success">' + text[0] + '</div><button class="close f-s-12 f-w-400 p-a-10 p-x-10 text-white" onclick="ACC.global.toastClose(this)">x</button></div>');
        return ACC.global.toastCounter++;
    },
    toastActions: function (target, num, type) {
        if(num == 1){
            target.find(".sending-circle-loading").addClass("hidden");
            target.find(".sending-circle-confirm").removeClass("hidden");
        }
        else if (num == 2){
            target.find(".sending-circle-confirm p").addClass("ajax-confirmed");
            target.find(".ajax-text-" + type).html(target.data("text2"));
        }
        else if (num == 3){
            target.removeClass(target.data("class1")).addClass(target.data("class2")).fadeOut();
        }
        else if (num == 4){
            target.fadeOut();
        }
    },
    toastClose: function (e) {
        $(e).parent('.toast-parent').fadeOut();
    },
    bindScriptInputEvent: function () {
        $(".js-script-input-event-bind").each(function () {
            $(this).on({ "keydown": ACC.global.scriptInputKeyDown, "keyup": ACC.global.scriptInputKeyUp, "paste": ACC.global.scriptInputPaste, "blur": ACC.global.scriptInputBlur });
        });
    },
    scriptInputKeyDown: function (pEvent) { // Remove disallowed characters (like HTML/JS code symbols)
        let refVal = pEvent.key ? pEvent.key.replace(/[<>{}\/\\;:`]/g, "") : "";
        if (refVal == "") {
            pEvent.preventDefault();
        }
    },
    scriptInputKeyUp: function (pEvent) {
        let ref = $(pEvent.currentTarget);
        ref.prop("value", ref.prop("value").replace(/[<>{}\/\\;:`]/g, " "));
    },
    scriptInputPaste: function (pEvent) {
        let ref = $(pEvent.currentTarget);
        ref.prop("value", ref.prop("value").replace(/[<>{}\/\\;:`\n]/g, " ").replace(/[\^|~]/g, "-").trim());
    },
    scriptInputBlur: function (pEvent) {
        let ref = $(pEvent.currentTarget);
        let refVal = ref.prop("value").replace(/[<>{}\/\\;:`\n]/g, " ").replace(/\^|~/g, "-").trim().replace(/\t/g, '');
        let newrefval = "";
        for (let i = 0; i < refVal.length; i++) {
            if(i < refVal.length -1 && refVal[i] == " " && refVal[i+1] == " "){
                newrefval += "";
            }
            else{
                newrefval += refVal[i];
            }
        }
        ref.prop("value", newrefval);
    },
    globalHeaderInitial: function () {
        ACC.global.headreResize();
        ACC.global.globalHeaderHeight = $(".linktracking-header").height();
        $(".linktracking-header").addClass('global-header-sticky');
        $(".js-mainHeader").css({ paddingTop: ACC.global.globalHeaderHeight });
        $(".new-vertical-categories").css({ height: Math.round(ACC.global.wHeight - ACC.global.globalHeaderHeight), top: Math.round(ACC.global.globalHeaderHeight) });
        ACC.global.fetchListData();
        ACC.global.removeFormHeader();
        $("[data-global-linkname]").on("click", function () {
            let linkName = $(this).data("global-linkname");
            ACC.global.globalHeaderV2("", linkName, "v2: home");
        });
        $(document).on("click", function (e) {
            let target = $(e.target);
            if (ACC.global.wWidth > 1023 && $(".js-document-global-btn").hasClass("active") && !target.hasClass("js-document-global-btn") && !target.parents().hasClass("js-document-global-btn")) {
                if (!target.parents(".js-document-global-box").length ) {
                    $(".js-document-global-btn.active").trigger("click");
                }
            }
            if ($(".js-document-invoice-btn").hasClass("active") && !target.hasClass("js-document-invoice-btn") && !target.parents().hasClass("js-document-invoice-btn")) {
                if (!target.parents(".js-document-global-box").length && !$(".ui-datepicker").is(":visible")) {
                    $(".js-document-invoice-btn.active").trigger("click");
                }
            }
            if($(".js-plp-uom-btn").hasClass("active") && !target.hasClass("js-plp-uom-btn") && !target.parents().hasClass("js-plp-uom-btn"))
            {
                $('.popup-box-muom').hide();

            }
            if($(".js-change-branch-btn").hasClass("active") && !target.hasClass("js-change-branch-btn") && !target.parents().hasClass("js-change-branch-btn") && !target.hasClass("facet__list__mark") && !target.hasClass("list-of-nearby-stores-plp") && !target.hasClass("search_nearby_enabled"))
                {
                    $('.nearby_more_locations').hide();
                    $(".nearby_locale").removeClass("active");
    
                }
            if($(".js-btn-variant").hasClass("active"))
            {
               if(!target.hasClass("js-btn-variant") && !target.parents().hasClass("js-btn-variant")){
				    $('.popup-box-variant').hide();  
				    $(".js-btn-variant").removeClass("active");
			   }
            }
        });
        if (ACC.global.wWidth > 1023) { //WEB 
            $(document).on('click', '.language-value', function (e) {
                if ($('.global-popup-box').is(":visible")) {
                    $('.global-popup-box').hide();
                    $(".js-document-global-btn.active").removeClass("active");
                }
                if ($(".global-category-section").hasClass("active")) {
                    $(".global-category-section").trigger("click");
                }
            });
        }
        else{ //Mobile WEB 
            $(".mob-store-details-block").fadeOut();
        }
    },
    removeFormHeader: function () {
        let pageName = $(".pagename").val();
        if ((pageName == "Saved List Page" && $(".pdpredesign-container #siteoneSavedListCreateForm").length) || pageName == "Edit Saved List Page" || (pageName == "Assembly Page List Page" && $(".pdpredesign-container #siteoneAssemblyCreateForm").length) || pageName == "Edit assembly Page") {
            $(".global-savedlist-box #siteoneSavedListHeaderCreateForm").remove();
        }
    },
    fetchListData: function () {
        if ($(".global-savedlist-box").length && !$(".list-group-item-savedlist .list-group-item").length && !$(".list-group-item-recommended .list-group-item").length) {
            let foundOneList;
            $.ajax({
                url: ACC.config.encodedContextPath + "/savedList/getAllLists",
                type: "GET",
                dataType: 'json',
                data:
                {
                    "numberOfLists": 5
                },
                success: function (response) {
                    let itemName = ["savedlist", "recommended"];
                    let itemLinkName = ["most recent", "recommended"];
                    if (response && typeof (response) == "object") {
                        if($(".page-accountDashboardPage").length){
                            ACC.accountdashboard.showListData(response);
                        }
                        for (let i = 0; i < itemName.length; i++) {
                            let ref = i == 0 ? response.savedLists : response.recommendedLists;
                            for (let j = 0; j < ref.length; j++) {
                                let refPath = i == 0 ? "" : ref[j].categoryName.replace("&", "%26");
                                refPath = ACC.config.encodedContextPath + (i == 0 ? '/savedList/listDetails?code=' + ref[j].code : '/savedList/recommendedListDetails?categoryName=' + refPath);
                                let refName = i == 0 ? ref[j].name : ref[j].categoryName;
                                let linkname = itemLinkName[i] + ": " + refName.toLowerCase();
                                $(".list-group-item-" + itemName[i]).append('<a data-global-linkname="list: ' + linkname + '" href="' + refPath + '" class="list-group-item transition-3s">' + refName + '</a>');
                            }
                            if ($(".list-group-item-" + itemName[i] + " .list-group-item").length) {
                                $(".global-" + itemName[i] + "-empty").addClass("hidden");
                                $(".global-" + itemName[i] + "-filled").removeClass("hidden");
                                foundOneList = true;
                            }
                            else {
                                $(".global-" + itemName[i] + "-filled").addClass("hidden");
                                $(".global-" + itemName[i] + "-empty").removeClass("hidden");
                            }
                        }
                    }
                    else {
                        for (let i = 0; i < itemName.length; i++) {
                            $(".global-" + itemName[i] + "-filled").addClass("hidden");
                            $(".global-" + itemName[i] + "-empty").removeClass("hidden");
                        }
                    }
                    if(!foundOneList && ACC.global.wWidth < 1024){
                        for (let i = 0; i < itemName.length; i++) {
                            $(".global-" + itemName[i] + "-empty").addClass("hidden");
                        }
                        $(".global-all-empty").removeClass("hidden");
                    }
                },
                error: function (response) {
                    let itemName = ["savedlist", "recommended"];
                    if(ACC.global.wWidth < 1024){
                        for (let i = 0; i < itemName.length; i++) {
                            $(".global-" + itemName[i] + "-filled, .global-" + itemName[i] + "-empty").addClass("hidden");
                        }
                        $(".global-all-empty").removeClass("hidden");
                    }
                    else{
                        for (let i = 0; i < itemName.length; i++) {
                            $(".global-" + itemName[i] + "-filled, .global-" + itemName[i] + "-empty").removeClass("hidden");
                            $(".global-" + itemName[i] + "-filled, .global-" + itemName[i] + "-filled").addClass("hidden");
                        }
                    }
                    
                }
            });
            $(".global-savedlist-box [data-global-linkname]").on("click", function () {
                let linkName = $(this).data("global-linkname");
                ACC.global.globalHeaderV2("", linkName, "v2: home");
            });
        }
    },
    categorySlide: function (e, ref, leftRef, time) {
        ACC.global.wWidth = $(window).width();
        ACC.global.wHeight = $(window)[0].innerHeight;
        let target = $(ref);
        let leftCal = typeof (leftRef) == 'number' ? leftRef : Math.floor($(leftRef).offset().left);
        if (target.hasClass("showing-menu")) {
            $('html').css({ 'overflow-y': "auto", paddingRight: 0 });
            $('.linktracking-header').width('100%');
            $('.L2CategoryHeader, .L3CategoryHeader').animate({ left: 0 }, function () {
                $(this).css("display", 'none');
            });
            $('.categories-overlay').fadeOut();
            $('.global-category-section').removeClass("active");
            $('.ham-icon').removeClass("icon-rotate");
            target.removeClass("showing-menu").animate({ left: -target.outerWidth() - 20 }, time);
        }
        else {
            $(".new-vertical-categories").css({ height: Math.round(ACC.global.wHeight - ACC.global.globalHeaderHeight) });
            if ($('.global-popup-box').is(":visible")) {
                $('.global-popup-box').hide();
                $(".js-document-global-btn.active").removeClass("active");
            }
            if ($('.language-dropdown').is(":visible")) {
                $('.language-value').trigger("click");
            }
            $(".L1CatLinks").removeClass("active");
            target.addClass("showing-menu").animate({ left: leftCal }, time);
            $('html').css({ overflow: "hidden", paddingRight: 17 });
            $('.linktracking-header').width(ACC.global.wWidth);
            $('.categories-overlay').fadeIn();
            $('.ham-icon').addClass("icon-rotate");
            $('.global-category-section').addClass("active");
        }
    },
    mobMenuSlide: function (e, ref, btnRef, time) {
        ACC.global.wWidth = $(window).width();
        ACC.global.wHeight = $(window)[0].innerHeight;
        let target = $(ref);
        if (target.hasClass("showing-menu")) {
            $(".new-vertical-categories").animate({ left: "-100%" });
            $('.L2CategoryHeader, .L3CategoryHeader').animate({ left: 0 }, function () {
                $(this).css("display", 'none');
            });
            $(".after-overlay").fadeOut();
            target.removeClass("showing-menu").animate({ left: -target.outerWidth() - 20 }, time);
        }
        else {
            $(window).scrollTop(0);
            let topHatHeight = $(".header-top-hat").outerHeight();
            $(".global-menu-section").css({ height: ACC.global.wHeight - topHatHeight, top: topHatHeight });
            if ($('.global-popup-box').is(":visible")) {
                $('.global-popup-box').hide();
                $(".js-document-global-btn.active").removeClass("active");
            }
            if ($('.language-dropdown').is(":visible")) {
                $('.language-value').trigger("click");
            }
            $(".L1CatLinks").removeClass("active");
            target.addClass("showing-menu").animate({ left: 0 }, time);
            let categoryTop = Math.round($(".global-categories-btn").offset().top + $(".global-categories-btn").outerHeight());
            $(".new-vertical-categories").css({ height: ACC.global.wHeight - categoryTop, top: categoryTop, display: "block" });
            $(".new-vertical-categories").eq(2).animate({ left: 0 }, time);
            $(".new-vertical-categories").eq(1).css({ left: "100%" });
            $(".new-vertical-categories").eq(0).css({ left: "100%" });
            $(btnRef + ', .global-categories-btn').addClass("active");
            $(".after-overlay").fadeIn();
        }
    },
    globalHeaderSticky: function (e, scrollTop) {
        let target = $(".linktracking-header");
        if (scrollTop < ACC.global.globalHeaderHeight + 20 || ACC.global.windowScrollTop > scrollTop) {
            target.removeClass('animateInUp');
            target.addClass('animateInDown');
        }
        else {
            target.addClass('animateInUp');
            target.removeClass('animateInDown');
        }
        ACC.global.windowScrollTop = scrollTop;
    },
    categories: function (e, type, targetParent) {
        let refNextTarget;
        let target = $(e);
        type = type.toLowerCase();
        let linkname = target.data("global-linkname");
        $(targetParent).empty();
        let targetClass = "L3";
        let targetLink = "L2";
        let targetHTML = "";
        let targetText = target.text();
        if (targetParent == ".L2CategoryHeader") {
            refNextTarget = '.L3CategoryHeader';
            targetClass = "L2";
            targetLink = "L1";
            $(refNextTarget).animate({ left: 0 }, function () {
                $(this).css("display", 'none');
            });
        }
        targetHTML += '<li class="categoriesBack hidden-md hidden-lg"><button class="transition-3s btn btn-block bold text-align-left" onclick="ACC.global.categoriesBack(this,\'' + targetParent + '\',\'' + targetText + '\')" alt="' + targetText + '">' + targetText + '</button></li>';
        targetHTML += '<li class="' + targetClass + 'Categories"><a data-global-linkname="' + linkname + ': shop all" class="L3CatLinks transition-3s bold shop-all" href="' + ACC.config.encodedContextPath + target.data("href") + '" alt="' + targetText + '">Shop All</a></li>';
        $("." + targetLink + "CatLinks").removeClass("active");
        target.addClass("active");
        $('[data-' + type + ']').each(function () {
            let ref = $(this);
            let refCode = ref.data(type).toLowerCase();
            refHref = ref.data("href");
            let refText = ref.text();
            if (ref.data("children") && targetParent == ".L2CategoryHeader") {
                targetHTML += '<li class="L2Categories"><button data-global-linkname="' + linkname + ': ' + refText.toLowerCase() + '" onclick="ACC.global.categories(this,\'' + refCode + '\',\'' + refNextTarget + '\')" data-code="' + refCode + '" class="btn btn-block text-align-left L2CatLinks text-default transition-3s" data-href="' + refHref + '" title="' + refText + '">' + refText + '</button></li>';
            }
            else if(!ref.hasClass('L2Images')) {
                targetHTML += '<li class="L3Categories"><a data-global-linkname="' + linkname + ': ' + refText.toLowerCase() + '" class="L3CatLinks transition-3s" href="' + ACC.config.encodedContextPath + refHref + '" alt="' + refText + '">' + refText + '</a></li>';
            }
        });
        
        if(targetParent == ".L3CategoryHeader"){
            $(".L2Images[data-" + type + "]").each(function () {
                let ref = $(this);
                let refHref = ref.data(type);
                let refSrc = ref.data("href");
                let refText = ref.text();
                targetHTML += '<li class="L3Categories L2banner"><a data-global-linkname="' + linkname + ': ' + refText.toLowerCase() + '" class="L3CatLinks transition-3s" href="' + refHref + '" alt="' + refText + '"><img class="border-radius-3 L3Images display-block" src="' + refSrc + '" alt="' + refText + '" /></a></li>';
            });  
        }
        
        $(targetParent).append(targetHTML);
        $(targetParent + " [data-global-linkname]").on("click", function () {
            let linkName = $(this).data("global-linkname");
            ACC.global.globalHeaderV2("", linkName, "v2: home");
        });
        $(targetParent).css("display", 'block').animate({ left: ACC.global.wWidth < 1024 ? '-100%' : targetParent == ".L2CategoryHeader" ? 330 : 634 });
    },
    categoriesBack: function (e, type, targetParent) {
        let target = $(type);
        target.animate({ left: 0 });
    },
    headreResize: function () {
        ACC.global.wWidth = $(window).outerWidth();
        if(ACC.global.wWidth < 1024){ //ipad iphone
            $(".global-search-section").removeAttr('style');
            $(".global-category-section, .global-logo-section, .global-search-section, .global-menu-section").removeClass("width-auto");
        }
        else{
            $(".global-category-section, .global-logo-section, .global-menu-section").addClass("width-auto");
            $(".global-menu-section").css({ height: 'auto' });
            var searchWidth = $("#header-store-links").outerWidth() - $(".global-category-section").outerWidth() - $(".global-logo-section").outerWidth() - $(".global-menu-section").outerWidth();
            $(".global-search-section").width(searchWidth-87);
        }
    },
	globalHeaderV2: function(linkType, linkName, onClickPageName) {
		if (onClickPageName && onClickPageName != "") {
			digitalData.eventData = {
				linktype: linkType,
				linkName: linkName,
				onClickPageName: _AAData.pathingPageName && _AAData.pathingPageName != "" ? _AAData.pathingPageName : _AAData.page.pageName && _AAData.page.pageName != "" ? _AAData.page.pageName : onClickPageName
			}
			try {
				_satellite.track("linkClicks");
			} catch (e) { }
		}
	},
    functionalCarouselIndicators: function(ref) {
        let target = $(ref);
        let slideTo = target.attr('data-slide-to');
        let parentId = target.data('target');
        target.parents(parentId).carousel(parseInt(slideTo) - 1);
    },
  	popupHeightSet: function (e, target) {  // Invoice page Redesign Start
		$(target).css({height: ACC.global.wHeight - ACC.global.globalHeaderHeight, top: ACC.global.globalHeaderHeight + 1});
	},
    hardscapeProductsAlertMsg: function() {
    if ($(".page-orderSummaryPage").length || $(".page-orderConfirmationPage").length) {
        let hardscapeProductFound = false;
        $(".orderDetailUom").each(function () {
            let target = $(this);
            let uom = target.data("uom");
            let l1Category = (ACC.config.encodedContextPath == '/es') ? 'Materiales duros & Vida al Aire Libre' : 'Hardscapes & Outdoor Living';
            let landscapeCategory = (ACC.config.encodedContextPath == '/es') ? 'Material de Jardinera' : 'Landscape Supply';
			let cosumableCategory = (ACC.config.encodedContextPath == '/es') ? 'Consumibles' : 'Consumables';
            if ((target.data('level1category') == l1Category || (target.data('level1category') == landscapeCategory && target.data('level2category') == cosumableCategory )) && (uom.includes("Net Ton") || uom.includes("Cubic Yard"))) {
                hardscapeProductFound = true;
            }
            //Refundable pallet message for pickup and delivery
            let orderTypeRefund = $("#orderType").val();
            if ((orderTypeRefund == 'PICKUP' || orderTypeRefund == 'DELIVERY') && (target.data('level1category') == 'Materiales duros & Vida al Aire Libre' || target.data('level1category')== 'Hardscapes & Outdoor Living') && (uom.includes("Net Ton") || uom.includes("Pallet"))) {
                $(this).closest(".item__list--header").find(".refundableMsg").removeClass('hidden')
            }
        });
        if (hardscapeProductFound) {
            $(".hardscape-PA-orderConfirm").removeClass('hidden');
        }
    }
},
    
	openMediaInPopup:function(){
		function popupMedia(thisHtml){
			ACC.colorbox.open("", {
      			html: thisHtml,
      			width: "750px",
      			open: true,
				onComplete: function () {
					setTimeout($.colorbox.resize, 500);
          $("#cboxContent").addClass("trio-mobile-size");
				},
				onClosed: function () {
					$(".trio-video").attr("src","");
				},
			})
		}
		$(document).on("click", ".promo-banner-media", function(e){
			e.preventDefault();
			var popupContent="";
			if($(this).data("youtube-url")===undefined ||$(this).data("youtube-url")==="" ||$(this).data("youtube-url")===null ){
				
				if($(this).data("target-value")==="_self")
				{
					window.location.href=$(this).data("encoded-url");
				}
			else
				{
					window.open($(this).data("encoded-url"),"_blank");
				}			
			
			}
			else{
				trioVideoId=$(this).data("youtube-url");
				popupContent=`<div class="video-responsive"><iframe class="trio-video" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" 
        frameborder="0"  src="https://www.youtube.com/embed/${trioVideoId}"></iframe></div>`;
				popupMedia(popupContent)
				}
		})
	},
	//for spanish account creation form spanish radio btn is selected
	 
	
	uomDropdowninventoryId: function() {
        let pdpinventoryUomId = $('.custom-dropdown-label:first').data("value");
        if(pdpinventoryUomId){
            $('[id="inventoryUomId"]').each(function(){$(this).val(pdpinventoryUomId)});
            $('[id="inventoryUOMIDVal"]').each(function(){$(this).val(pdpinventoryUomId)});
        }
    },
    
    handleFlyoutIpad: function() {
        $('.article-box:nth-child(3n+3)').after('<div class="clearfix"></div>');

        $('.L1CatLinks').on('touchstart', function(e) {
            var touched = $(this).closest('.L1Categories').find('.L2Categories').is(':visible');
            $(this).attr('touched', touched);
        }).on('click', function(e) {
            if ($(this).attr('touched') == 'false') {
                e.preventDefault();
            }
        });

        $('.L2CatLinks').on('touchstart', function(e) {
            var touched = $(this).closest('.L2Categories').find('.L3Categories').is(':visible');
            $(this).attr('touched', touched);
        }).on('click', function(e) {
            if ($(this).attr('touched') == 'false') {
                e.preventDefault();
            }
        });
    },
	resetSortOnCategoryselect: function(){
		//reset sort selection once the user clicks on any category
		$(document).on("click", ".L1CatLinks,.L2CatLinks,.L3CatLinks", function(e){
		 
			sessionStorage.removeItem('selectedDropdownValueSession');
		})
        $(document).on("click", ".mobile-l1,.mobile-l2,.mobile-l3", function(e){
            sessionStorage.removeItem('mobileSortSelection');
        })
	},
    galleryboxpopup: function(){
        $('a.gallery').colorbox({
            arrowKey: true,
            rel:'gallery',
            className:"gallerypopup",

            scalePhotos: true ,
            opacity: 0.7,
            close:'<span class="glyphicon glyphicon-remove"></span>',
        });

        var x = window.matchMedia("(max-width: 1023px)")
        popresize(x)
        x.addListener(popresize)
        function popresize(x) {
            if (x.matches) {
                $('a.gallery').colorbox({
                    maxWidth:"100%",
                    width:"100%",
                });
            }

            else{
                $(window).resize(function(){
                    $.colorbox.resize({
                        maxWidth:"auto",
                        width:95+'%',
                    });
                });
            }
        }

        $(document).bind('cbox_complete', function(){
            $("#cboxTitle").addClass("headline");
            var gallerytitle = $('#cboxTitle').text();
            var src=$("#cboxContent img.cboxPhoto").attr("src");
            var count=$("a.gallery[href='"+src+"']").data("count")+1;
            var size=$("a.gallery[href='"+src+"']").data("size")+1;
            var title=$("a.gallery[href='"+src+"']").attr("title");

            if (isNaN(count) && isNaN(size)) {
                $('.gallerypopup #cboxCurrent').prepend('<span id="popup_title"> '+ title + ' Gallery</span>');
            }
            else{
                $('.gallerypopup #cboxCurrent').prepend('<span id="popup_title"> '+ title + ' image '+count+' of '+size+'</span>');
            }
        });
    },
    
    /***ProjectCalculator***/
    analyticsProjectCalculator: function () {
        let projectCalculatorName = $(".pagename").val();

        if ($('.page-stoneWallsCalculatorPage').length > 0 || $('.page-flagStoneCalculatorPage').length > 0 || $('.page-roadBasefillCalculatorPage').length > 0 || $('.page-barkMulchCalculatorPage').length > 0 || $('.page-decorativeRockCalculatorPage').length > 0 || $('.page-topSoilCalculatorPage').length > 0) {
            _AAData.page.pageName = 'content: project calculators: ' + projectCalculatorName;
            _AAData.pathingChannel = 'content';
            _AAData.pathingPageName='content: project calculators: ' + projectCalculatorName;
        }
    },

    /***LinkToPay*******/
    linkToPayClick: function () {
        loading.start();
        //Cayan iFrame cancel button event check
        if (sessionStorage.getItem("cayancancel")) {
          sessionStorage.setItem("cayancancel", 0);
        }
        var kountSessionId = document.getElementById("kountSessionIdLink").value;
        var orderNumber = document.getElementById("orderNumberLink").value;
        var orderAmount = document.getElementById("orderAmountLink").value;
        if (!orderNumber || !orderAmount || !kountSessionId || orderNumber == "" || orderAmount == "" || kountSessionId == "") {
            console.log("AJAX Prams: ", orderNumber , orderAmount , kountSessionId);
          ACC.global.linkToPayError('payment-not-process', 'link-payment-error');
        }
        else {
          $.ajax({
            url: ACC.config.encodedContextPath + "/link-to-pay/fetchOrderDetails",
            type: "GET",
            dataType: 'json',
            contentType: 'application/json',
            data:
            {
              "orderNumber": orderNumber,
              "orderAmount": orderAmount,
              "kountSessionId": kountSessionId
            },
            success: function (response) {
              transportKeyLink = response;
              if (transportKeyLink != null && transportKeyLink != 'Decline') {
                var redirecturl = 'https://transport.merchantware.net/v4/TransportMobile.aspx?transportKey=' + transportKeyLink;
                $(".linktopay-iframe").html('<iframe id="myIframeLink" title="myIframeLink" class="Pop-up-myIframe-Link" src="'+ redirecturl +'" name="myIframeLink" onLoad="ACC.global.paymentConfirmationLoad(this)"></iframe>');
                $(".token-valid").css("display", "none");
                $(".cayan-iframe").css("display", "block");
                _AAData.pathingChannel = "link2pay";
                _AAData.pathingPageName = "link2pay: cardInfo";
                _AAData.orderNumber = orderNumber;
                _AAData.orderAmount = orderAmount;
                _satellite.track("pageload");
                loading.stop();
              }
              else if (transportKeyLink != null && transportKeyLink == 'Decline') {
                ACC.global.linkToPayError('payment-not-process', 'link-payment-error');
              }
              else {
                ACC.global.linkToPayError('payment-not-process', 'link-payment-error');
              }
            },
            error: function (response) {
              ACC.global.linkToPayError('payment-not-process', 'link-payment-error');
            }
          });
        }
        ACC.global.linkToPayAdobeTracking("", "pay now", "link2pay: verification", "linkClicks");
    },
    mycayanInterval: '',
    cayanIframeClose: function()
	{
	    clearInterval(ACC.global.mycayanInterval);
	},
    paymentConfirmationLoad: function() { // LinkToPay //
        try {
            var oIframe = document.getElementById('myIframeLink');
            var oDoc = oIframe.contentWindow || oIframe.contentDocument; // for compatibility
            if (oDoc.document) {
                console.log("payment Function: document found");
                var oDoc = oDoc.document;
                var sPageURL = oDoc.location.search.substring(1);
                var sURLVariables = sPageURL.split('&');
                if (sURLVariables && sURLVariables != "") {
                    loading.start();
                    $("#myIframeLink").hide();
                    ACC.global.cayanIframeClose();
                    console.log("payment Function: having parameters");
                    for (var i = 0; i < sURLVariables.length; i++) {
                        var sParameterName = sURLVariables[i].split('=');
                        console.log("payment Function: checking ", sParameterName[1]);
                        if (sParameterName[1] && sParameterName[1] != "") {
							   var pathArray = oDoc.location.search.substring();
                            if (sParameterName[1] == 'APPROVED') {                             
                                console.log("payment Function: approved");
                                $.ajax({
                                    url: ACC.config.encodedContextPath + "/link-to-pay/paymentDetails" + pathArray,
                                    method: "GET",
                                    async: false,
                                    success: function (response) {
                                        if (typeof response == 'string' && response.toLowerCase() == 'success') {
                                            window.parent.location.href = ACC.config.encodedContextPath + "/linkpayconfirmation";
                                        } else {
                                            $(".cayan-iframe, .token-valid").css("display", "none");
                                            $(".cayan-payment-failed").css("display", "block");
                                            ACC.pendo.captureEvent("3XLINK2PAY");
                                            loading.stop();
                                        }
                                    },
                                    error: function () {
                                        window.parent.location.href = ACC.config.encodedContextPath + "/linkpayconfirmation";
                                    }
                                });
                                $("#myIframeLink").remove();
                                ACC.global.linkToPayAdobeTracking("", "cardInfo: submit", "link2pay: cardInfo", "linkClicks");
                                break;
                            }
                            else {
                                if (sParameterName[1] == 'User_Cancelled') {
                                    console.log("payment Function: canceled");
                                    var cayanctn = parseInt(sessionStorage.getItem("cayancancel"));
                                    cayanctn = cayanctn + 1;
                                    sessionStorage.setItem("cayancancel", cayanctn);
                                    $("#myIframeLink").remove();
                                    if (sessionStorage.getItem("cayancancel") == 1) {
                                        ACC.global.linkToPayAdobeTracking("", "cardInfo: cancel", "link2pay: cardInfo", "linkClicks", "link2pay", "link2pay: verification");
                                    }
                                    $(".try-again-btn button").trigger("click");
                                    break;
                                }
                                else {
									 $.ajax({
                                    url: ACC.config.encodedContextPath + "/link-to-pay/paymentDetails" + pathArray,
                                    method: "GET",
                                    async: false,
                                    success: function (response) {
                                        if (typeof response == 'string' && response.toLowerCase() == 'success') {
                                         alert('/link-to-pay/paymentDetails wrong response');
                                        } else {
                                            $(".cayan-iframe, .token-valid").css("display", "none");
                                            $(".cayan-payment-failed").css("display", "block");
                                            ACC.pendo.captureEvent("3XLINK2PAY");
                                            loading.stop();
                                        }
                                    },
                                    error: function () {
                                      $(".cayan-iframe, .token-valid").css("display", "none");
                                            $(".cayan-payment-failed").css("display", "block");
                                            loading.stop();
                                    }
                                });
                                    $("#myIframeLink").remove();
                                    console.log("payment Function: declined");
                                    setTimeout(function () {
                                        $(".cayan-iframe").css("display", "none");
                                        $(".cayan-payment-failed").css("display", "block");
                                        $(".token-valid").css("display", "none");
                                        $(".try-again-btn").removeClass("hidden");
                                        loading.stop();
                                        ACC.global.linkToPayAdobeTracking("", "cardInfo: submit", "link2pay: cardInfo", "linkClicks", "link2pay", "link2pay: payment decline", orderNumber, orderAmount);
                                    }, 2000);
                                }
                            }
                        }
                    }
                }
            }
        } catch (err) {
        }
    },
    linkToPayAdobeTracking: function(type, name, page, click, pChannel, pPage, oNumber, oAmount) {
        digitalData.eventData = {
            "linktype": type,
            "linkName": name,
            "onClickPageName": page
        }
        try {
            _satellite.track(click);
        } catch (e) { }
        if (pChannel) {
            _AAData.pathingChannel = pChannel;
            _AAData.pathingPageName = pPage;
        }
        if (oNumber) {
            _AAData.orderNumber = oNumber;
            _AAData.orderAmount = oAmount;
        }
    },
    linkToPayError: function (ref, className) {
        $('#colorbox').addClass(className);
        var targetHTML = $("." + ref).html();
        ACC.colorbox.open("", {
          html: '<div class="' + ref + '">' + targetHTML + '</div>',
          width: 700,
          escKey: false,
          overlayClose: false,
          onComplete: function () {
            digitalData.eventData = {
              "linktype": "",
              "linkName": "error: payment not procesed",
              "onClickPageName": "link2pay: verification"
            }
            try {
              _satellite.track('linkClicks');
            } catch (e) { }
            loading.stop();
          }
        });
        ACC.pendo.captureEvent("LINK2PAYFAIL");
    },
    bindLinkToPayDetails: function(){
    	
    	 var orderNumber = document.getElementById("orderNumberLink").value;
         var orderAmount = document.getElementById("orderAmountLink").value;
    	
    	if(orderNumber){
            _AAData.pathingChannel="link2pay";
            _AAData.pathingPageName="link2pay: verification";
            _AAData.orderNumber=orderNumber;
            _AAData.orderAmount=orderAmount;
           
        }else{
            _AAData.pathingChannel="link2pay";
            _AAData.pathingPageName="link2pay: token expired";
           
        }
    	
        
        
        },
        
        bindLinkToPayConfirmation: function(){
        	if($(".page-linktopayverification").length){
                loading.start();
                ACC.global.mycayanInterval = setInterval(ACC.global.paymentConfirmationLoad, 1000);
            }
            if($(".page-linkConfirmationPage").length){
                $("#cDate").html(ACC.global.getDate());
                $("#cTime").html(ACC.global.getTime());
        	 $(document).on("click",".print-linktopay",function(e)
                     {
             			window.print();
             			
             			digitalData.eventData={
 		                          "linktype": "",
 		                          "linkName": "print",
 		                          "onClickPageName": "link2pay: payment confirmation"
 		                      }
 		                                      
 		                      try {
 		                      _satellite.track('linkClicks');
 		                      }catch(e){}
                   	
                     });
        	 
        	 $(document).on("click",".share-email-linktopay",function(e)
                     {
                   	 $('#colorbox').addClass('link-share-by-mail');
                   	 var targetHTML = $(".share-by-mail").html();
	       	   		  ACC.colorbox.open("", {
	       						 html: '<div class="share-by-mail">'+targetHTML+'</div>',
	       						 className: 'email-share-link2pay',
	       		                 escKey: false,
	       		                 maxWidth: 700,
	       		                 overlayClose: false,
	       		                 onComplete: function(){
	       		                	digitalData.eventData={
	       		                          "linktype": "",
	       		                          "linkName": "send Email",
	       		                          "onClickPageName": "link2pay: payment confirmation"
	       		                      }
	       		                                      
	       		                      try {
	       		                      _satellite.track('linkClicks');
	       		                      }catch(e){}
	       		                	 
	       		                 }
	       		                
	       		            });
                   	
                     });
             
             $(document).on("click",".linktopay-email",function(e)
                     {
                   	
             		let emailId = $(".email-share-link2pay #linktopay-share-email").val();
     	        	 $.ajax({
     	                 type: 'GET',
     	                 url: ACC.config.encodedContextPath + '/sendOrderConfirmationEmail',
     	                 cache: false,
     	                 dataType: "json",
     	                 data: {"email":emailId},
     	                 success: function()
     	                 {
     	                	 ACC.colorbox.close();
     	                 }
     	             });
                   	
                     });
                     
            }
        },
        bindsetactivetab: function() {
        	$(document).on("click", ".js-setactivetab", function(){
        		var pageId = $(this).data("key");
    			$.cookie("accountPageId", pageId, { path: '/' });
        		sessionStorage.setItem("activeTab", $(this).data("active"));
        		sessionStorage.setItem("selectedDropdownValueSession", ACC.config.defaultSortValue);
        	})
        },
    getinvoicelastdate:function(){
        $(document).on("click", ".last-invoice", function()
        {

            var datarange=$(".last-invoice").text();
            var href= ACC.config.encodedContextPath +'/my-account/invoices/'+($("#unitUid").val()).trim();

            href=href+'?datarange='+datarange;
            $(".last-invoice").attr('href',href);

        });
    },

    bindShipToFormData: function getData() {
        $(".shipto-pagination .pagination li a").on('click',function(){
            var searchParam = $("#search-ship-to").val();
            var sort = $("#sortShhipTo").val();
            $(this).prop('href',$(this).prop('href')+"&searchParam="+searchParam+"&sort="+sort);
        });
    },


    bindInvoiceCalendar: function() {

        $('.datepickerinvoiceFrom').datepicker({
            onSelect: function (selected) {
                var dt = new Date(selected);
                dt.setDate(dt.getDate() + 1);
                $("#dateTo").datepicker("option", "minDate", dt);
            }
        });

        $('.datepickerinvoiceTo').datepicker({
            maxDate: '0',
            onSelect: function (selected) {
                var dt = new Date(selected);
                dt.setDate(dt.getDate() - 1);
                $("#dateFrom").datepicker("option", "maxDate", dt);
            }
        });
       
    },


    bindInvoice: function() {
        $(".invoiceButton").on('click',function () {
            var invoiceSearchURL = ACC.config.encodedContextPath + '/my-account/invoices/'+($("#unitUid").val()).trim();

	    var selectedInvoice = $("#shipToSelected_inv").val();
	    sessionStorage.setItem('selectedInvoiceSession',selectedInvoice);
            $('#invShipTo').val(selectedInvoice);	
            var invoicesearchForm = $('#invoicesearchForm');
            invoicesearchForm.submit();
        });
    },

    bindOrderHistory: function() {
        $(".orderHistoryButton").on('click',function () {
            var searchParam = '/my-account/orders/'+($("#unitUid").val()).trim() +($("#searchOrderHistory").val()).trim();
            var searchForm = $('#searchForm');
            searchForm.submit();
        });
    },
    bindBuyItAgain: function(e) {
        let qPage = $("#filterByDateBuyagain option:selected").val().split(':');
        let qval = ($("#searchBuyItAgain").val()).trim() + ":" + qPage[1] + ":" + qPage[2] + ":" + qPage[3];
        ($("#unitUid").val()).trim();
        $("#searchTermWithQueryParam").val(qval);
        $('#searchForm').submit();
    },
    bindManagerUser:function(){
        $(".manager-user-Button").on('click',function () {
            var searchParam = ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/'+($("#unitUid").val()).trim() +($("#manager-user-voice").val()).trim();
            var MangerusersearchForm = $('#MangerusersearchForm');
            MangerusersearchForm.submit();
        });

    },
   
    bindEwallet:function(){
		$(".eWallet-user-Button").on('click',function () {	 
		       var searchParam = ACC.config.encodedContextPath + '/my-account/ewallet/'+($("#unitUid").val()).trim() +($("#ewallet-page-card").val()).trim();
		       var EwalletsearchForm = $('#EwalletsearchForm');
		       EwalletsearchForm.submit();
		   });

	},

    userCheckboxMethods:function(){
        $("#admin_User").on('click',function () {

            var viewpagination =$(".user-manager").val();
            var searchParam = $("#manager-user-voice").val();
            var unitid=$("#unitUid").val();
            var sort =$(".user_sort").val();
            var shipto =$(".ship-TosUsers").val();
            var adminCheck = $('#admin_User').val();

            if(document.getElementById('admin_User').checked) {
                $('#admin_User').prop('checked', true);
                window.location.href ='?searchParam='+searchParam+'&shiptounit='+shipto+'&sort='+sort+'&pagesize='+viewpagination+'&filterAdmin=true'
            }else{
                $('#admin_User').prop('checked', false);
                window.location.href ='?searchParam='+searchParam+'&shiptounit='+shipto+'&sort='+sort+'&pagesize='+viewpagination+'&filterAdmin=false'
            }
        })
    },

  resetShiptoDropDown:function(e){
		$(document).on("click", "#userPopup", function()
        {

			var selecteduser =this.innerText +'_US';  
			sessionStorage.setItem("selecteduserSession",selecteduser);

        });
		$(document).on("click", "#orderPopup", function()
        {

			var selectedOrder =$(this).attr('data-index')+' '+$(this).attr('data-name');
			sessionStorage.setItem('selectedOrderSession',selectedOrder);

        });
		$(document).on("click", "#invoicePopup", function()
        {
			var selectedInvoice =$(this).attr('data-index')+' '+$(this).attr('data-name');
			console.log('selectedInvoice');
			sessionStorage.setItem('selectedInvoiceSession',selectedInvoice);

        });
		$(document).on("click", "#ewalletPopup", function()
		        {

					var selectedewallet =this.innerText +'_US';  
					sessionStorage.setItem("selectedewalletSession",selectedewallet);

		        });

	},
  
  bindcurrentdate: function() {

        $('#dateTo').datepicker({
            changeMonth: false,
            stepMonths: 0,
            dateFormat: "mm/dd/yy",
            firstDay: 1,
        }).datepicker("setDate",$("#hidDateTo").val()!= ''? $("#hidDateTo").val() : "+0d" );
        
  	},

    bindpreviousdate: function(){

        $( "#dateFrom" ).datepicker( "setDate", ($("#hidDateFrom").val()!= ''? $("#hidDateFrom").val() : "-90d") );
        

    },

    bindCalendarCurrentdate: function() {
        $( ".current-invoice-calendar" ).datepicker({
            showOn: "button",
            buttonImage: "/_ui/responsive/theme-lambda/images/siteone-calendar.png",
            buttonImageOnly: true,
            buttonText: "Select date"
        });

    },


    bindCalendarpreviousdate: function() {
        var daysArgs=document.getElementById("daysArgs").value;
        if(daysArgs=='over120'){
            $(".previous-invoice-calendar").datepicker({
                showOn: "button",
                buttonImage: "/_ui/responsive/theme-lambda/images/siteone-calendar.png",
                buttonImageOnly: true,
                buttonText: "Select date",
            }).datepicker("setDate", ''  );


        }
        else{
            $(".previous-invoice-calendar").datepicker({
                showOn: "button",
                buttonImage: "/_ui/responsive/theme-lambda/images/siteone-calendar.png",
                buttonImageOnly: true,
                buttonText: "Select date",
            }).datepicker("setDate", ($("#hidDateFrom").val()!= ''? $("#hidDateFrom").val() : "-90d")  );
            
        }
    },


    bindInvoiceFormData: function getData() {

        $(".account-invoice").on('click',function(){
            sessionStorage.removeItem('selectedInvoiceSession');
        });

        $(".account-history, .orderHistoryButton").on('click',function(){
            sessionStorage.removeItem('selectedOrderSession');
        });

        $(".manager-user-Button, .account-manage-user").on('click',function(){
            sessionStorage.removeItem('selecteduserSession');
        });

        $(".selected-dropdown-value, .removeSortbySession").on('click',function(){
            sessionStorage.removeItem('selectedDropdownValueSession');
        });
        
        $("#cboxLoadedContent .card_holder_nickname").on('blur',function(){
            sessionStorage.removeItem('selectedNicknameValueSession');
        });
        
        $(".orderTypeFormSubmit, .payment-to-branch, .payment-to-online").on('click',function(){
            sessionStorage.removeItem('selectedPaymentSession');
        });
        	
        $(".eWallet-user-Button, .account-invoice").on('click',function(){
            sessionStorage.removeItem('selectedewalletSession');
        });
    },

    successPopupbinding : function()
    {

        $(document).on("click", "#successemailSubmit", function()
        {
            ACC.colorbox.close();
        });

    },

    showToolTip: function ()
    {
        var toolTip=false;
        $(".showToolTip").on("click", function () {
            if(!toolTip){
                $(".account-req").addClass("showTip");
                toolTip = !toolTip;
                event.stopPropagation();
            }
            else{
                $(".account-req").removeClass("showTip");
            }
        });
        $(document).on('click',function (){
            if(toolTip){
                toolTip = !toolTip;
                $(".account-req").removeClass("showTip");
            }
        });
    },

	setCookie: function (cname, cvalue, exdays) {
	    const d = new Date();
	    d.setTime(d.getTime() + (exdays*24*60*60*1000));
	    let expires = "expires="+ d.toUTCString();
	    document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
	},

	// Delete cookie
	 deleteCookie: function (cname) {
	    const d = new Date();
	    d.setTime(d.getTime() + (24*60*60*1000));
	    let expires = "expires="+ d.toUTCString();
	    document.cookie = cname + "=;" + expires + ";path=/";
	},
    successPopup: function()
    {
    	if(digitalData.pfm)
    	{
    	  delete digitalData.pfm;
    	  delete digitalData.pfmdetails;
    	}
    	
    	if ($('.loginstatus').val() != ''){
			var cartID= $("#cartID").val();
		}
		else{
			var cartID= $("#anonymousCartId").val();
		}
        $("#colorbox").addClass("success-msg-email-pop-up");
        ACC.colorbox.open("", {
            html : "<div class='PopupBox'><h1 class='headline2'>"+ACC.config.emailMessage+"!</h1><div class='submit-btn-wrapper' style='width:100%;'><input id='successemailSubmit' class='btn btn-primary' type='button' value='"+ACC.config.continueShopping+"'></div></div>",
            width: '500px',
            height: 'auto',
            onComplete: function(){
            	if ($('.page-detailsSavedListPage').length > 0){
			        _AAData.popupPageName= ACC.config.emaillistsuccesspathingPageName;
			        _AAData.popupChannel= ACC.config.myaccountpathingChannel;
				 	try {
					    	 _satellite.track('popupView');
			        } catch (e) {} 
				}
				if ($('.page-detailsAssemblyPage').length > 0){
					_AAData.popupPageName= ACC.config.emailassemblysuccesspathingPageName;
					_AAData.popupChannel= ACC.config.myaccountpathingChannel;
				 	try {
					    	 _satellite.track('popupView');
			        } catch (e) {} 
				}
				if ($('.page-cartPage').length > 0){

					_AAData.popupPageName= ACC.config.emailcartsent;
        			_AAData.popupChannel= ACC.config.checkoutpathingChannel;
    			 	try {
    				    	 _satellite.track('popupView');
    		        } catch (e) {}
					digitalData.eventData={
        	                cartID: cartID,
        	            }
        	            try {
        	            	  _satellite.track("emailCart");
        	            } catch (e) {}
				}
                $('body').css("overflow-y", "hidden");
                $("#colorbox").removeClass("email-invoice-popup");
            },
            onClosed: function() {
                $("#colorbox").removeClass("success-msg-email-pop-up");
                $('body').css("overflow-y","auto");
            }
        });

    },

    passwordStrength: function () {
        $('.password-strength').pstrength({
            verdicts: [ACC.pwdStrengthTooShortPwd,
                ACC.pwdStrengthVeryWeak,
                ACC.pwdStrengthWeak,
                ACC.pwdStrengthMedium,
                ACC.pwdStrengthStrong,
                ACC.pwdStrengthVeryStrong],
            minCharText: ACC.pwdStrengthMinCharText
        });
    },

    bindHeaderWelcomeOverlay: function ()
    {
        $(".headerWelcome ").on('click',function (e)
        {
            e.preventDefault();
            e.stopPropagation();
            $("#welcomeOverlay").show();
 
            _AAData.popupPageName= ACC.config.selectorderaccountPageName;
		     	_AAData.popupChannel= ACC.config.myaccountpathingChannel;
		 	try {
			    	 _satellite.track('popupView');
	        } catch (e) {}
 
	        if($("#welcomeOverlay").is(":visible")== false){
            	_AAData.popupPageName= "";
    			_AAData.popupChannel= "";
            	
            }
        });

        $("body").on("click",function(e){

            if($(e.target).parents("#welcomeOverlay").length  == 0 && !$(e.target).hasClass("headerShow")){

                $("#welcomeOverlay").css("display","none");
                
            }
            else{
                console.log("off box");
            }
        });

    },


    playVideo: function () {
        $("#playvideo").on('click',function ()
        {
            //window.location.href = document.getElementById("video").src;
        });

    },
    showContent: function () {
        $(".bottom-conent-show-more").on('click',function ()
        {
            $(".bottom-conent-show-more").css("display","none");
            $(".bottom-conent-hidden-content").css("display","block");
        });

        $(".bottom-content-store-details").on('click',function ()
        {
            $(".bottom-content-show-more").css("display","none");
            $(".bottom-content-hidden").css("display","block");
        });
    },
    pdpimageGalleryCarousel: function(){
        //active border for Image
        if($(".gallery-thumbnail .galleyImageItem").eq(0)) $(".gallery-thumbnail .galleyImageItem").eq(0).addClass('hactive'); 
            $(".galleyImageItem").click(function(){
            $('.galleyImageItem').removeClass('hactive');
            $(this).addClass('hactive')
        });
    },
    
    showPdpSticky: function(){
        var isFirst =  0;
        var fixImgTop = $('.product-main-info').length ? $('.product-main-info').offset().top : 0;
        let target =  $('.image-popup');
        let targetWidth = target.length ? target.outerWidth() : 0;        
        $(window).scroll(function() 
        {         
            let scrollTop = $(this).scrollTop();
            if($('.page-productDetails').length){ 
            let removeSticky = $(".rightDivArea").outerHeight()-$(".rightDivArea").offset().top - 82;
            if(!($('.productDetailsHeighlights').is(':visible'))){
	            if (scrollTop > fixImgTop && scrollTop < removeSticky){
	                target.addClass('img-sticky').css({width: targetWidth});
	            }
	            else {
	                target.removeClass('img-sticky').removeAttr("style");
	            }
			 }
                if($('.pdpredesignDescription').is(':visible')){
                    var fixmeTop = $('.pdpredesignDescription').offset().top;
                    if ($(this).scrollTop() > fixmeTop && $(".product-content").find('.product-variant-table').length <= 0)
                    {
                       $('.pdp-sticky').show();    
                       $('.pdp-sticky').addClass("pdpSticky_header");    
                       isFirst++;                          
                     }
                      else
                    {
                       $('.pdp-sticky').removeClass("pdpSticky_header");
                       $('.pdp-sticky').hide();                   
                     }
                }                
                  
                 if(isFirst == 1){                    
                     if($(".price-detail .callBranchForPrice").is(":visible")){
                         if($(".pdpRedesignuom-wrapper .retail-your-price-container .simple-product-pdp__value--retail-price.pdp-non-anonymous").is(':visible')){
                             $($(".price-detail").children()[0]).addClass('calforbranchDesign');
                             if($(".price-detail").children().length > 0) $($(".price-detail").children()[1]).find('.callBranchForPrice').remove()
                         }
                         else {
                             $(".price-detail").children()[1].remove();
                         }
                     }
                     if($(".price-detail .logInToSeeYourPrice").is(":visible") && $(".price-detail .simple-your-price-title").hasClass("hide")){
                         $(".price-detail .logInToSeeYourPrice").addClass('pdpmarg-left');
                     }
                     if($(".redesign-rgt-content .retail-your-price-container").find('.callBranchForPrice').is(":visible")){
                         if($(".price-detail").find('.callBranchForPrice').hasClass('hide')){
                             $(".price-detail").find('.callBranchForPrice').removeClass('hide');
                         }
                     }
                      if($(".simple-product-pdp__value--your-price").hasClass("pdp-anonymous")){
                        $(".simple-product-pdp__value--your-price").find(".callBranchForPrice").addClass("hidden");
                        $(".simple-product-pdp__value--your-price").find(".callBranchForPrice").parent().parent().addClass("hidden");
                    }  
                    if($(".simple-product-pdp__value--retail-price").hasClass("pdp-non-anonymous")){
                        $(".simple-product-pdp__value--retail-price").find(".callBranchForPrice").addClass("hidden");
                        $(".simple-product-pdp__value--retail-price").find(".callBranchForPrice").parent().parent().addClass("hidden");
                    }
                 }

                 if($('.addtocart-detail').find('.bg-lightGrey').hasClass('hidden')){                    
                    if($(".price-detail").find('.callBranchForPrice').is(':visible')){
                        $('.price-addcart-detail').addClass('text-right');
                    }
                }
            }
            if(ACC.global.wWidth > 1023){
                ACC.global.globalHeaderSticky(this, scrollTop);
            }
        });        
        $('.simple-product-pdp__value--your-price').parent().removeClass("col-md-6 col-sm-12 col-xs-12 text-center");
        $(".pdp-ul li").click(function(){
            $(".pdp-ul li").removeClass("active");
            $(this).addClass("active");
            if($(this).text() == "Specifications" || $(this).text() ==  "Especificaciones"){
                $('html,body').animate({
                    scrollTop: $(".specDiv").offset().top - 170},
                'slow');
            }
            else if($(this).text() == "Information & Guides" || $(this).text() == "informacin y guas"){
                if($('.mob-stores').is(":visible")){
					$('html,body').animate({
	                    scrollTop: $(".infoDiv").offset().top - 230},
	                'slow');
				}else{
					$('html,body').animate({
                   	    scrollTop: $(".infoDiv").offset().top - 170},
                	'slow');
				}
            }
            else{
                $('html,body').animate({
                    scrollTop: 0},
                'slow');
            }
            
        });

        $(".pdpStoreDetail").html($(".pdp-store-detail").html());
        
        if($("#addToCartSection").html()){
            $(".addtocart-detail").html($("#addToCartSection").html());    
        }                    
        else{
            $(".addtocart-detail").html($(".bg-lightGrey").parent().html());
            $(".addtocart-detail .bg-lightGrey").find('svg').remove();
            $(".addtocart-detail").children().eq(1).remove();
        }
            
        
        if($(".addtocart-detail").find(".select-grey")) $(".addtocart-detail").find(".select-grey").remove();

        if($('.addtocart-detail').find('.bg-lightGrey').hasClass('hidden')){
            $('.emptDivforspace').removeClass('hidden');            
        }
        else{
            $('.emptDivforspace').addClass('hidden');            
        }
        
        $(".addtocart-detail #showAddtoCart").click(function(){
            ACC.global.atcButtonClickEvent='header';
            $("#addToCartForm").submit();
            
        });        
        
        if($('.pdpRedesignuom-wrapper .uom-dropdown-button').is(':visible')){
            $(".price-detail").html('');
            $(".price-detail").append($('.custom-dropdown-option').clone());
           

            if($(".pdpRedesignuom-wrapper .logInToSeeYourPrice").is(":visible")){
                $(".price-detail").append($($('.retail-your-price-container').children()[1]).html());
                if($('#mulUOMRedesignpdp').val() == 'true'){
                	$('.price-detail').find('.simple-product-pdp__value:first').addClass('hide');
                }
            }
            $(".price-detail").append($(".uom-dropdown-button").clone());
        }
        else{
            $(".price-detail").html($(".retail-your-price-container").html());
            $(".price-detail").append($('.custom-dropdown-option').clone());
            $('#pdpRedesignuom-wrapper').find('.custom-dropdown-option').addClass('hidden');
        }
       
        
        $(".info,.spec").hide();
        if($('.specDiv').is(':visible')){
            $(".spec").show();
        }
        if($('.infoDiv').is(':visible')){
            $(".info").show();
        }        
        
        if($('.pdpRedesignuom-wrapper .uom-dropdown-button').length > 0){
            $(".mobile-price").html('');
            $(".mobile-price").append($('.pdpRedesignuom-wrapper .custom-dropdown-option').clone());
            $(".mobile-price").append($(".pdpRedesignuom-wrapper .uom-dropdown-button").clone());

            if($(".pdpRedesignuom-wrapper .logInToSeeYourPrice").length > 0){
                $(".mobile-price").append($($('.retail-your-price-container').children()[1]).html());
            }
        }
        else{
            $(".mobile-price").html($(".retail-your-price-container").html());
        }
        //$(".mobile-price").html($(".retail-your-price-container").html());
        
        if($(".mobile-price .callBranchForPrice").is(":visible")){
            $(".mobile-price").children()[1].remove();
        }
        $(".count-section").html($(".qty-Box").html());
        //$(".btn-section").html($("#addToCartSection").html());    
        
        if($("#addToCartSection").html()){
            $(".btn-section").html($("#addToCartSection").html());    
        }                    
        else{
            $(".mobile-addcart").html($(".bg-lightGrey").parent().html());
            $(".mobile-addcart .bg-lightGrey").find('svg').remove();
            $(".mobile-addcart").children().eq(1).remove();
        }    
        
        $(".btn-section #showAddtoCart").click(function(){
            $('#qty').val($('.js-qty-selector-input').val());
            $("#addToCartForm").submit();
        });
        
        if($('.mobile-price .callBranchForPrice').is(":visible") || $('.mobile-price .simple-your-price-title').hasClass('hide')){
            $('.mobile-price .simple-your-price-title').remove();
        }
        $('.mobile-price').find('.uom-dropdown-option').removeClass('hidden');        

        if($('.mobile-pdp-sticky').is(':visible')){
            $('.pdpRedesignuom-wrapper .uom-dropdown-option').remove();
            var getH = Math.ceil($('.mobile-pdp-sticky').outerHeight() + 30);
            $('.pdpredesignfooter').css('padding-bottom',getH+'px');
            $('.featureBullets').removeClass('hide');
            if($(".simple-product-pdp__value--your-price").hasClass("pdp-anonymous")){
                $(".simple-product-pdp__value--your-price").find(".callBranchForPrice").addClass("hidden");
                $(".simple-product-pdp__value--your-price").find(".callBranchForPrice").parent().parent().addClass("hidden");
            }  
            if($(".simple-product-pdp__value--retail-price").hasClass("pdp-non-anonymous")){
                $(".simple-product-pdp__value--retail-price").find(".callBranchForPrice").addClass("hidden");
                $(".simple-product-pdp__value--retail-price").find(".callBranchForPrice").parent().parent().addClass("hidden");
            }
            
        }
        let pdpspecLen = $('.product-classifications .pdp-specification .pdp-specification__value').length;
        let paraTxt = $('.product-classifications .pdp-specification .pdp-specification__value p');
        for(var i=0;i<pdpspecLen;i++){
            var getTxt = paraTxt.eq(i).text();
            if(paraTxt.eq(i).text().trim().length > 110){
                paraTxt.eq(i).addClass('spec-two-line-text');
                paraTxt.eq(i).attr('title',getTxt);
            }
        }

    },
    bindToggleOffcanvas: function () {
        $(document).on("click", ".js-toggle-sm-navigation", function (e) {
            e.preventDefault();
            e.stopPropagation();
            ACC.global.toggleClassState($("main"), "offcanvas");
            ACC.global.toggleClassState($("html"), "offcanvas");
            ACC.global.toggleClassState($("body"), "offcanvas");
            $(window).scrollTop(0);
            ACC.global.toggleClassState($(".store-head"), "hidden");
            ACC.global.toggleClassState($("#header-store-links"), "hidden");
            ACC.global.resetXsSearch();
        });
    },

    bindToggleXsSearch: function () {
        $(document).on("click", ".js-toggle-xs-search", function () {
            ACC.global.toggleClassState($(".site-search"), "active");
            ACC.global.toggleClassState($(".js-mainHeader .navigation--middle"), "search-open");
        });
    },

    resetXsSearch: function () {
        $('.site-search').removeClass('active');
        $(".js-mainHeader .navigation--middle").removeClass("search-open");
    },

    toggleClassState: function ($e, c) {
        $e.hasClass(c) ? $e.removeClass(c) : $e.addClass(c);
        return $e.hasClass(c);
    },
    bindHoverIntentMainNavigation: function () {

        enquire.register("screen and (min-width:" + screenMdMin + ")", {

            match: function () {
                // on screens larger or equal screenMdMin (1024px) calculate position for .sub-navigation
                $(".js-enquire-has-sub").hoverIntent(function () {
                    var $this = $(this),
                        itemWidth = $this.width();
                    var $subNav = $this.find('.js_sub__navigation'),
                        subNavWidth = $subNav.outerWidth();
                    var $mainNav = $('.js_navigation--bottom'),
                        mainNavWidth = $mainNav.width();

                    console.log($subNav);

                    // get the left position for sub-navigation to be centered under each <li>
                    var leftPos = $this.position().left + itemWidth / 2 - subNavWidth / 2;
                    // get the top position for sub-navigation. this is usually the height of the <li> unless there is more than one row of <li>
                    var topPos = $this.position().top + $this.height();

                    if (leftPos > 0 && leftPos + subNavWidth < mainNavWidth) {
                        // .sub-navigation is within bounds of the .main-navigation
                        $subNav.css({
                            "left": leftPos,
                            "top": topPos,
                            "right": "auto"
                        });
                    } else if (leftPos < 0) {
                        // .suv-navigation can't be centered under the <li> because it would exceed the .main-navigation on the left side
                        $subNav.css({
                            "left": 0,
                            "top": topPos,
                            "right": "auto"
                        });
                    } else if (leftPos + subNavWidth > mainNavWidth) {
                        // .suv-navigation can't be centered under the <li> because it would exceed the .main-navigation on the right side
                        $subNav.css({
                            "right": 0,
                            "top": topPos,
                            "left": "auto"
                        });
                    }
                    $this.addClass("show-sub");
                }, function () {
                    $(this).removeClass("show-sub")
                });
            },

            unmatch: function () {
                // on screens smaller than screenMdMin (1024px) remove inline styles from .sub-navigation and remove hoverIntent
                $(".js_sub__navigation").removeAttr("style");
                $(".js-enquire-has-sub").hoverIntent(function () {
                    // unbinding hover
                });
            }

        });
    },

    initImager: function (elems) {
        elems = elems || '.js-responsive-image';
        this.imgr = new Imager(elems);
    },

    reprocessImages: function (elems) {
        elems = elems || '.js-responsive-image';
        if (this.imgr == undefined) {
            this.initImager(elems);
        } else {
            this.imgr.checkImagesNeedReplacing($(elems));
        }
    },

    
    addGoogleMapsApi: function (callback) {
        if (callback != undefined && $(".js-googleMapsApi").length == 0) {
            $('head').append('<script class="js-googleMapsApi" type="text/javascript" src="//maps.googleapis.com/maps/api/js?key=' + ACC.config.googleApiKey + '&sensor=false&callback=' + callback + '"></script>');
        } else if (callback != undefined) {
            eval(callback + "()");
        }
    },

    backToHome: function () {
        $(".backToHome").on("click", function () {
            var sUrl =  ACC.config.encodedContextPath;
            window.location = sUrl;
        });

        $(".changePwdbackToHome").on("click", function () {
            var myAccountUrl =  ACC.config.encodedContextPath + "/my-account/account-dashboard";
            window.location = myAccountUrl;
        });
    },

    verticalNavigation: function ()
    {
        var dropdown=false;
        $(".btn-ProductFlyout").on("click", function () {
            $(".showCategories").toggle();
            dropdown = !dropdown;
        });
        $(document).on('click',function (){
            if(dropdown){
                dropdown = !dropdown;
                $(".showCategories").toggle();
            }
        });
    },

    countrySelection: function()
    {
        if(!sessionStorage.getItem("country"))
        {
            navigator.geolocation.getCurrentPosition(function(position)
            {
                var GEOCODING = 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + position.coords.latitude + '%2C' + position.coords.longitude + '&language=en';

                $.getJSON(GEOCODING).done(function(location)
                {
                    if(location.results.length != 0)
                    {
                        var currentCountry = location.results[0].address_components[location.results[0].address_components.length - 2].long_name;
                        if(currentCountry.toLowerCase() == document.getElementById('popupcountry').value.toLowerCase())
                        {
                            ACC.global.countryPopup();
                        }
                        sessionStorage.setItem("country", currentCountry.toLowerCase());
                    }
                });
            });
        }
        ACC.global.countrySelectEvents();

    },
    countrySelectEvents : function() {
        $('.country-dropdown').on('click', function() {
            ACC.global.countryPopup();
        });

        $(document.body).on("click","#countrySelect",function()
        {
            var radioValue = $("input[name='country']:checked").val();
            if(radioValue == 'ca')
            {
                $('.country-dropdown').html('CA');
                window.location = "https://www.siteone.ca";
            }
            else if(radioValue == 'us')
            {
                $('.country-dropdown').html('US');
                window.location = "";
            }
        });
    },

    countryPopup: function()
    {
        $.colorbox({
            html: "<div class='PopupBox'><p class='countrypopup-text'>"+ACC.config.selectCountry+"</p><label class='country-select'><div class='border-div'><label><span class='colored-radio'><input type='radio' name='country' value='us' checked></span><span class='icon-flag-us'></span><span>US</span></label></div></label><br> <label class='country-select'><div class='border-div'><label><span class='colored-radio'><input type='radio' name='country' value='ca'></span><span class='icon-flag-canada'></span><span>Canada</span></label></div></label><br/><div class='row'><div class='col-md-5 countrySelect-btn-wrapper'><input id='countrySelect' class='btn btn-primary btn-block' type='button' value='"+ACC.config.select+"'></div></div>",
            /*maxWidth:"100%",*/
            width:"500px",
            maxHeight:"100%",
            overflow:"auto",
            opacity:0.7,
            className:"countrypopup",
            title:"<h1 class='headline'>Country Selector</h1>",
            close:'<span class="glyphicon glyphicon-remove"></span>',
            onComplete: function(){
            }
        });
    },


    bindShipToSelection: function ()
    {
        //desktop

        $('.headerShipToOptions a').on('click', function(e) {
            e.preventDefault();
            var unitId = $(this).data('uid');
            ACC.global.updateShipToCall(unitId);
        });
        //mobile


        var previous;
        $('.shipToSelection').on('focus', function () {
            // Store the current value on focus and on change
            previous = $(this).val();
        }).on('change',function () {
            // Do something with the previous value after the change
            if($(this).val() === 'shipToMore')
            {
                $(".searchMoreShip-TosLink.shipToPopup").click();
                $(this).val(previous);

            }else {
                var unitId=$('.shipToSelection').find(":selected")[0].value;
                ACC.global.updateShipToCall(unitId);
            }

            // Make sure the previous value is updated

        });

    },
    rememberMe: function () {
        $('#loginsubmit').click(function()
        {
            if($('#remember').is(':checked'))
            {
                var email=$('#j_username').val();
                $.cookie("j_username", email, { expires: 365 });
                $.cookie("j_username", email, { secure: true });
            }
            else{
                $.cookie('j_username', null);
            }
        });
        var j_username=$.cookie("j_username");
        if(j_username!=undefined)
        {
            $('#j_username').val(j_username);
            $('#remember').prop('checked', true);
        }

    },
    rememberMePopup: function () {
        $(document).on("click", "#cboxLoadedContent #loginsubmitPopup",function(e)
        {

            if($('#cboxLoadedContent #rememberPopup').is(':checked'))
            {
                var email=$('#cboxLoadedContent #usernamePopup').val();
                $.cookie("j_username", email, { expires: 365 });
                $.cookie("j_username", email, { secure: true });
            }
            else{
                $.cookie('j_username', null);
            }


        });
        var j_username=$.cookie("j_username");
        if(j_username!=undefined)
        {
            $('#usernamePopup').val(j_username);
            $('#rememberPopup').prop('checked', true);

        }

    },
    signInoverlayOpen : function(){
        $(document).ready(function(){
            if ($('.loginstatus').val() != ''){
                $(".removesignInlink").removeClass("signInOverlay");
                $(".logInToSeeYourPrice").removeClass("signInOverlay");
                $(".hideLogIn").hide();
                $(".wishlistAddProLink-wrapper").removeClass("signInOverlay");
                $(".wishlistAddProLink").removeClass("signInOverlay");
                $(".addToListPosition").removeClass("signInOverlay");
            }
        });
    },
    signInOverlay1: function(){

    	$(document).on("click", ".signInOverlayCheckout_guest", function(e){
    			e.preventDefault();
                     ACC.colorbox.open("", {
                         html: $("#signinId-checkout").html(),
                         width: "1200px",                    
                         close:'<span class="glyphicon glyphicon-remove"></span>',
                         className: "login-product-detail",
                         onComplete:function(){
                        	 _AAData.popupPageName= ACC.config.signinpathingPageName;
                        	 _AAData.popupChannel= ACC.config.myaccountpathingChannel;
                			 	try {
                				    	 _satellite.track('popupView');
                		        } catch (e) {} 
                		        ACC.global.singoverlayOncompleteData(e);
                		        setTimeout(function(){
                		        	$('.login-product-detail').eq(1).css({opacity: 1, display: 'none'}).fadeIn();
                		        }, 300)
                         },
                     });
            });
        },
        
    hidecspSignInOverlay : function(){
    	$(document).on("click", ".js-login-to-buy", function(e){
			e.preventDefault();
              sessionStorage.setItem("loginToBuyATC",$(this).data("prod-code"));
                 ACC.colorbox.open("", {
                     html: $("#signinId-hidecsp").html(),
                     width: "1320px",                    
                     close:'<span class="glyphicon glyphicon-remove"></span>',
                     className: "hidecsp-overlay",
					 height: "420px",
                     onComplete:function(){
            		        ACC.global.singoverlayOncompleteData(e);
                     }
                 });
        });
    },
      hardscapePDPLink: function(){
        $(document).on("click", ".hardscape_overlay_Pdp", function(e){
            e.preventDefault();
            var hardscape_productCode= $(".col-xs-12 .brand-itemnumber").text().trim();
			var hardscape_productName= $(".pdp-productname").text().trim().slice(0,85);
			var hardscape_imagePath= $(".image-inner-wrapper img").attr('src');
            ACC.global.hardscapesOverlay(hardscape_imagePath,hardscape_productName,hardscape_productCode);
        });
    },
    carouselIndicators: function(type){
        let target = $('#recommendedProductBanner').nextAll('.carousel-indicators').find('span.carouselA');
        if(type=='prev' && target.prev("span").length){
            target.removeClass('carouselA');
            target.prev("span").addClass('carouselA');
        }
        else if(type=='next' && target.next("span").length){
            target.removeClass('carouselA');
            target.next("span").addClass('carouselA');
        }

    },
    carouselIndicatorsPDP: function(type){
        let target = $('#recommendedProductBannerrr1').nextAll('.carousel-indicators').find('span.carouselA');
        if(type=='prevrr1' && target.prev("span").length){
            target.removeClass('carouselA');
            target.prev("span").addClass('carouselA');
        }
        else if(type=='nextrr1' && target.next("span").length){
            target.removeClass('carouselA');
            target.next("span").addClass('carouselA');
        }

    },

    hardscapePLPLink : function(){
        $(document).on("click", ".hardscape_overlay_Plp", function(e){
            e.preventDefault();
            var hardscape_productName=$(this).parents(".product-item-box").find("a.name").text().slice(0,85);
            var hardscape_productCode =$(this).parents(".product-item-box").find("span.item-number-format").text();
            var hardscape_imagePath= $(this).parents(".product-item-box").find("a.thumb img").attr('src');
            ACC.global.hardscapesOverlay(hardscape_imagePath,hardscape_productName,hardscape_productCode);
        });
    },

    hardscapesOverlay:function(hardscape_imagePath,hardscape_productName,hardscape_productCode){
            ACC.colorbox.open("", {
	            html: $(".hardscape_content").html(),
	            width: "710px",
	            className:"hardscape__overlay",
	            close:'<span class="icon-close"></span>',
	            onComplete:function(){
                    $(".hardscape_product_id").html(hardscape_productCode);
                    $(".hardscape_box_img img").attr('src', hardscape_imagePath);
                    $(".hardscape_product_name").html(hardscape_productName);
                    
	            	$(document).on("click",".hardscapeContinueShopping", function(e){
	                    ACC.colorbox.close();
	                });
	            	
	            	$(document).on("click",".btn-hardscape-first", function(e){
	            		
	            		if(digitalData.pfm)
	                	{
	                	  delete digitalData.pfm;
	                	  delete digitalData.pfmdetails;
	                	}
	            		
	            		var onClickPageName= $(".siteonepagename").val();
	            		
	            		digitalData.eventData={
				    		    linktype:"Hardscapes page",
				                linkName:"Submit Question to Expert",
				                onClickPageName:onClickPageName
				            }
				      
				       try {
				    	   _satellite.track('linkClicks');
				    	   window.open("/en/contactus/hardscapes", '_blank');
						}catch(e){} 
						
	                    
	                });
	            },
            
         });  
    },
    
    
    uomdropdownwidth:function(){
        let dropwidth=$(".pdpRedesignuom-sticky").width();
        $(".uom-dropdown-option").width(dropwidth);

    }, 
    dropDownOpenClose(elem, status, dropdownTag) {
        let target = $(elem);
        let offTarget = $("." + dropdownTag + "-option");
        if((dropdownTag="uom-dropdown")&& (screen.width<480) ){

            ACC.global.uomdropdownwidth();
        }
        if($(".uom-dropdown-button").parent('.pdpRedesignuom-sticky') && (screen.width>600)){
            let newwidth=$(".price-detail").width();
            $('.pdpRedesignuom-sticky').children('.uom-dropdown-option').width(newwidth-3);
        }
        let targetText = target.find("." + dropdownTag + "-text:first").text();
        if (status == "open") {
            target.attr("onclick", "ACC.global.dropDownOpenClose(this,'close','" + dropdownTag + "')");
            target.addClass("dropdown-open");
            $("[data-" + dropdownTag + "]").each(function () {
                let optionElem = $(this);
                let optionVal = optionElem.data(dropdownTag);
                if (optionVal == targetText) {
                    optionElem.hide();
                } else {
                    optionElem.show();
                }
            });
            offTarget.slideDown();
        }
        else {
            target.attr("onclick", "ACC.global.dropDownOpenClose(this,'open','" + dropdownTag + "')");
            target.removeClass("dropdown-open");
            offTarget.slideUp();
        }
    },
    
    dropDownSelection(elem, dropdownTag) {
        let target = $(elem);
        let targetBtn = $("." + dropdownTag + "-button");
        let uomVal = target.data("value");
        /* if($(".mobile-pdp-sticky").length && $(".mobile-pdp-sticky").is(":visible")) {
            ACC.productDetail.updatePriceForUOMDropdownSelection(target);
        } */
        $('[id="inventoryUomId"]').each(function(){$(this).val(uomVal)});
        $('[id="inventoryUOMIDVal"]').each(function(){$(this).val(uomVal)});
        $('[id="inventoryQty"]').each(function(){$(this).val(target.data("inventory"))});
        if($('#pdpAddtoCartInput').length) {
            ACC.product.checkMinQuantity($('#pdpAddtoCartInput'),1);
        }
        targetBtn.attr("onclick", "ACC.global.dropDownOpenClose(this,'open','" + dropdownTag + "')");
        targetBtn.removeClass("dropdown-open");
        $('.custom-dropdownselect').hide();
        $("." + dropdownTag + "-text").html(target.data(dropdownTag));
        $("." + dropdownTag + "-text1").html(target.data("retail-price"));
        $("." + dropdownTag + "-option").slideUp();
        if (ACC.global.wWidth < 1240) {
            ACC.global.findSelectedUom(uomVal);
        }
    },
    findSelectedUom: function(uomVal){
        if(uomVal != $(".selected-uom-item").data("inventoryid")){
            $(".multipleUomItem[data-inventoryid='" + uomVal + "']").trigger("click");  
        }
    },
    openCloseAccordion(elem, status, num, accordionTag, icon, keepAll) {
        let target = $(elem);
        if (!target.hasClass("disabled")) {
            let iconOpen = (icon && icon != "" && icon != "undefined") ? icon.split(",")[0] : 'plus';
            let iconClose = (icon && icon != "" && icon != "undefined") ? icon.split(",")[1] : 'minus';
            if (status == "open") {
                $("." + accordionTag + "-data-" + num).slideUp();
                target.removeClass("" + accordionTag + "-open");
                target.addClass("" + accordionTag + "-close");
                target.attr("onclick", "ACC.global.openCloseAccordion(this,'close', " + num + ",'" + accordionTag + "','" + icon + "', " + keepAll + ")");
                target.find(".glyphicon-" + iconClose).addClass("glyphicon-" + iconOpen).removeClass("glyphicon-" + iconClose);
            }
            else {
                if (!keepAll) {
                    let offTarget = $("." + accordionTag + "-open");
                    let offNum = offTarget.data("acconum");
                    $("." + accordionTag + "-data-" + offNum).slideUp();
                    offTarget.removeClass("" + accordionTag + "-open");
                    offTarget.attr("onclick", "ACC.global.openCloseAccordion(this,'close',  " + offNum + ",'" + accordionTag + "','" + icon + "', " + keepAll + ")");
                    offTarget.find(".glyphicon-" + iconClose).addClass("glyphicon-" + iconOpen).removeClass("glyphicon-" + iconClose);
                }
                $("." + accordionTag + "-data-" + num).slideDown();
                target.removeClass("" + accordionTag + "-close");
                target.addClass("" + accordionTag + "-open");
                target.attr("onclick", "ACC.global.openCloseAccordion(this,'open',  " + num + ",'" + accordionTag + "','" + icon + "', " + keepAll + ")");
                target.find(".glyphicon-" + iconOpen).addClass("glyphicon-" + iconClose).removeClass("glyphicon-" + iconOpen);
            }
        }
    },
       
    signInOverlay: function(){
    	$(document).on("click", ".signInOverlay", function(e){
    			e.preventDefault();
                     ACC.colorbox.open("", {
                         html: $("#signinId").html(),
                         width: "1200px",
                         close:'<span class="glyphicon glyphicon-remove"></span>',
                         className: "login-product-detail",
						 height: "420px",
                         onComplete:function(){
                        	 _AAData.popupPageName= ACC.config.signinpathingPageName;
                        	 _AAData.popupChannel= ACC.config.myaccountpathingChannel;
                			 	try {
                				    	 _satellite.track('popupView');
                		        } catch (e) {} 
                			 
                		        ACC.global.singoverlayOncompleteData(e);
                		        setTimeout(function(){
                		        	$('.login-product-detail').eq(1).css({opacity: 1, display: 'none'}).fadeIn();
                		        }, 300)
                         },
                         
                     });
                     
           
            });


        },
        
        singoverlayOncompleteData:function(e){
        	var url=e.currentTarget.href;
       	 	var windowLocation=window.location.href;
       	 	if(url != null ){
	       		 if(url.includes("account-dashboard") || url.includes("savedList") || url.includes("pay-account-online") || url.includes("buy-again") || url.includes("orders") || url.includes("accountPartnerProgram"))
	     	       {
	     	    	  $.cookie("urllogin", url, { path: '/' });
	     	       }
				  
	     	      else
	     	      {
	     	    	  $.cookie("urllogin",null, { path: '/' });
	     	      }
     		 }
     	 else
     	    {
     		 $.cookie("urllogin",null, { path: '/' });
     	    }
       	 
       	 if( $.cookie("urllogin")==null)
       	    {
       		  	$.cookie("urllogin",windowLocation, { path: '/' });                      		
       	    }	 
       	 var j_username=$.cookie("j_username");
     	   	 if(j_username!=undefined)
     	     	{
                  $('#cboxLoadedContent #usernamePopup').val(j_username);  
                  $('#cboxLoadedContent #rememberPopup').prop('checked', true);  
     		    }
        	
        },
    getUserFirstName : function(){
        $(document).ready(function(){
            var userFirstName = $("#userfname").val();
            if (userFirstName != '' || userFirstName != null){
                var j_username=$.cookie("j_username");
                var userfirstname=$.cookie("newfirstname");
                if(j_username!=undefined && userfirstname==undefined && (userFirstName != "" || userFirstName != null) ){
                    $.cookie("newfirstname", userFirstName, { expires: 365 , path:'/', secure: true });
               }
            }

        });

    },
  updateShipToCall: function (unitId)
    {
        loading.start();
        $.ajax({
            type: 'GET',
            url: ACC.config.encodedContextPath + '/change-ship-to',
            cache: false,
            dataType: "json",
            data: {"unitId":unitId},
            success: function()
            {
                if($(".page-accountOverviewPage").length){
                    
                    window.location.href= ACC.config.encodedContextPath +"/my-account/account-overview?accountId="+ unitId;
                }
                else {
                    location.reload();
                }
            }
        });
    },
    checkConsent: function () {
        let cookie_consent = $.cookie("user_cookie_consent");
        let targetGUID = _AAData.GUID ? _AAData.GUID : '';
        let target = document.getElementById("cookieNotice");
        let targetCookieNoticeShow = localStorage.getItem("cookieNotice" + targetGUID);
        if (target) {
            if (targetCookieNoticeShow || (cookie_consent && cookie_consent != "")) {
                target.style.display = "none";
            }
            else {
                target.style.display = "block";
                localStorage.setItem("cookieNotice" + targetGUID, true);
            }
        }
    },
    pageIdSetforOrder: function () {
        $(document).on("click", ".account-list-group .account-pageid", function () {
			var pageId = $(this).data("key");
			if(pageId){
			$.cookie("accountPageId", pageId, { path: '/' });
			sessionStorage.setItem("activeTab", $(this).data("active"));
			}

		});
    },
 
 //Category Ajax call Start
    
    getAllCategory: function(){
		
		$.ajax({
            type: 'GET',
            url: ACC.config.encodedContextPath + '/c/getCategoryDataAll',
            cache: false,
            dataType: "json",
            success: function(data)
            {
               ACC.global.generateCategoryList(data);
            }
        });
	},
	
	generateCategoryList: function(data){
		var targetHTML = "";
		var pageName = $(".pagename").val();
		var catObj = data.subCategories;
		
		targetHTML += '<input id="pageType" type="hidden" value="'+ pageName +'" />';
		
		if(catObj){
		targetHTML += '<ul class="L1CategoryHeader margin0 padding0 full-height scroll-bar-5">';
		var navL1Cat = $.trim($('#navL1Cat').html());
		var navL2Cat = $.trim($('#navL2Cat').html());
		var navL3Cat = $.trim($('#navL3Cat').html());
		var navL2Images = $.trim($('#navL2Images').html());
		
		var nearbyStoresToggle = ($("#nearbyStoresToggle").val() || '');
		var hardscapeFeatureSwitch = ($("#hardscapeFeatureSwitch").val() || '').split(',');
		var catCode = ["SH13","SH14","SH12","SH11","SH16","SH17","SH15","SH18"];
		
		catObj = catObj.map(function(cObj){
			cObj.sequence = catCode.findIndex((x) => x == cObj.code)
			
			return cObj;
		});
		
		catObj = catObj.sort(function(a,b){return a.sequence - b.sequence});
		
		
		var hardScapeUrl = '/?q=%3Arelevance&viewtype=All&inStock=on&nearby=on&selectedNearbyStores='+nearbyStoresToggle;
		//L1 Category
		$.each(catObj,function(indx,obj){
			
			if(obj.productCount != null && obj.productCount > 0){
			var x = navL1Cat.replace(/{{name}}/ig, obj.name).replace(/{{code}}/ig, obj.code).replace(/{{url}}/ig, obj.url);
			
			var subCat = '';
			
			//L2 Category
			obj.subCategories = obj.subCategories.sort(function(a,b){return a.sequence - b.sequence});
			
			$.each(obj.subCategories,function(indx,obj2){
				
				var urlL2 = obj2.url;
				if(hardscapeFeatureSwitch.includes(obj2.code))
				{
					urlL2 += hardScapeUrl;
				}
				
				if(obj2.productCount != null && obj2.productCount > 0){
				var y = navL2Cat.replace(/{{L1code}}/ig, obj.code).replace(/{{code}}/ig, obj2.code).replace(/{{url}}/ig, urlL2)
				.replace(/{{name}}/ig, obj2.name).replace(/{{havechildren}}/ig, !!obj2.subCategories.length);
				}
				subCat += y;
				
				//L3 Category
				obj2.subCategories = obj2.subCategories.sort(function(a,b){return a.sequence - b.sequence});
				
				$.each(obj2.subCategories,function(indx,obj3){
					
					var urlL3 = obj3.url;
					if(hardscapeFeatureSwitch.includes(obj3.code))
					{
						urlL3 += hardScapeUrl;
					}
					
					if(obj3.productCount != null && obj3.productCount > 0){
					var z = navL3Cat.replace(/{{L2code}}/ig, obj2.code).replace(/{{code}}/ig, obj3.code).replace(/{{url}}/ig, urlL3)
					.replace(/{{name}}/ig, obj3.name);
					}
					
					subCat += z;
				
				});
				
				var imgaltText = '';
				
				if(obj2.marketingBannerList){
					var arrImgs = Array.isArray(obj2.marketingBannerList) ? obj2.marketingBannerList : [obj2.marketingBannerList];
					$.each(arrImgs,function(indx,objImg){
						if(objImg.altText != null)
						{
							imgaltText = objImg.altText;
						}
						else{
							imgaltText = "#";
						}
				
						var bImg = navL2Images.replace(/{{L2code}}/ig, obj2.code).replace(/{{imageUrl}}/ig, objImg.url).replace(/{{url}}/ig, imgaltText)
						.replace(/{{name}}/ig, obj2.name).replace(/{{havechildren}}/ig, !!obj2.subCategories.length);
						
						subCat += bImg;
					});
					
				}
				
			});
			x = x ? x.replace(/{{L2Cat}}/ig, subCat) : "";
			targetHTML += x;
			}
		});
		
		targetHTML += '</ul>';
		}
		
		$(".nav-categories-ajx").append(targetHTML);
	},
	
	//Category Ajax call End
	
    updateConsent: function () {
        var consent = "Approved";
        ACC.global.deleteCookie('user_cookie_consent');
        ACC.global.setCookie('user_cookie_consent', 1, 1);
        document.getElementById("cookieNotice").style.display = "none";
        $.ajax({
            type: 'GET',
            url: ACC.config.encodedContextPath + '/consentForm',
            cache: false,
            dataType: "json",
            data: { "consent": consent },
            success: function (res) {
                if (res == "success") {
                    $(".addonbottompanel").hide();
                }
                //location.reload();
            }
        });
    },
    disableImageRightClick : function() {
        $('img').on('contextmenu', function(e){e.preventDefault()});
    },
    pdfClicks : function() {
        $('[dtm^=pdf-]').on('click', function(){
            try{
                _AAData.fileName = $(this).attr('dtm').split("pdf-")[1];
            } catch(e) {console.log("analytics: filename exception", e);}
        });
    },
    
    disableClickToCall : function() {
        if ($(window).width() > 1023 && !navigator.userAgent.match(/iPad/i)) {       // if width is less than 600px
            $('a[href^=tel]').on('click',function(e){
                e.preventDefault();
            });
        }
    },
    flyoutIpad : function() {
        $('.L1CatLinks').on('touchstart', function(e) {
            var touched = $(this).closest('.L1Categories').find('.L2Categories').is(':visible');
            $(this).attr('touched', touched);
        }).on('click', function(e) {
            if ($(this).attr('touched') == 'false') {
                e.preventDefault();
            }
        });

        $('.L2CatLinks').on('touchstart', function(e) {
            var touched = $(this).closest('.L3category').find('.L3categoryli').is(':visible');
            $(this).attr('touched', touched);
        }).on('click', function(e) {
            if ($(this).attr('touched') == 'false') {
                e.preventDefault();
            }
        });
    },

    carouselClickEvent : function() {
        $('.carousel-indicators li').click(function(e){
            e.stopPropagation();
            $('#siteoneHomepageBanner').carousel($(this).data('slide-to')-1);
        });
        function realignRotatingCarousal(){
        if(screen.width>=1024){
        	$("#siteoneHomepageBanner .img-container img").height($(".top-promo-banner-slot").height());
        }
        }

        var topImgLen = $("#siteoneHomepageBanner .img-container img").length,
            counter = 0;
        function incrementTopImageCounter() {
            counter++;
            if (counter === topImgLen) {
                realignRotatingCarousal();
            }
        }
        $("#siteoneHomepageBanner .img-container img").each(function () {
            if (this.complete) {
                incrementTopImageCounter()
            }
            else {
                this.addEventListener('load', incrementTopImageCounter, false);
            }
        });
        
        $(window).resize(function () {
            realignRotatingCarousal();
            ACC.global.headreResize();
        });
        if($(".desktop-carousal .item").length == 1){
        	$(".desktop.carousel-indicators").hide();
        }
        if($(".mobile-carousal .item").length == 1){
        	$(".mobile.carousel-indicators").hide();
        }
        $('.category-tile-prev').on("click", function(e){
            ACC.global.carouselIndicators('prev')
                        
                    });
        $('.category-tile-next').on("click", function(e){
            ACC.global.carouselIndicators('next')
            
                    });
    },
     carouselClickEventPDP : function() {
        $('.carousel-indicators li').click(function(e){
            e.stopPropagation();
            $('#siteoneHomepageBanners').carousel($(this).data('slide-to')-1);
        });
        function realignRotatingCarousal(){
        if(screen.width>=1024){
        	$("#siteoneHomepageBanners .img-container img").height($(".top-promo-banner-slot").height());
        }
        }

        var topImgLen = $("#siteoneHomepageBanners .img-container img").length,
            counter = 0;
        function incrementTopImageCounter() {
            counter++;
            if (counter === topImgLen) {
                realignRotatingCarousal();
            }
        }
        $("#siteoneHomepageBanners .img-container img").each(function () {
            if (this.complete) {
                incrementTopImageCounter()
            }
            else {
                this.addEventListener('load', incrementTopImageCounter, false);
            }
        });
        
        $(window).resize(function () {
            realignRotatingCarousal();
            ACC.global.headreResize();
        });
        if($(".desktop-carousal .item").length == 1){
        	$(".desktop.carousel-indicators").hide();
        }
        if($(".mobile-carousal .item").length == 1){
        	$(".mobile.carousel-indicators").hide();
        }
        $('.category-tile-prevrr1').on("click", function(e){
            ACC.global.carouselIndicatorsPDP('prevrr1')
                        
                    });
        $('.category-tile-nextrr1').on("click", function(e){
            ACC.global.carouselIndicatorsPDP('nextrr1')
            
                    });
    },

    ndspage: function(){
        $(document).ready(function(){
        	if(digitalData.pfm)
        	{
        	  delete digitalData.pfm;
        	  delete digitalData.pfmdetails;
        	}
            $(document).on("click", "#viewpdf", function(){
                digitalData.eventData=   {
                    CTAname: "ndsPDF",
                }
                try {
                    _satellite.track('ndsCTAClick');
                } catch (e) {}
            });

            $(document).on("click", "#getapp", function(){
                digitalData.eventData= {
                    CTAname: "ndsAPP",
                }
                try {
                    _satellite.track('ndsCTAClick');
                } catch (e) {}
            });
        });


        $(document).ready(function(){
            $(document).on("click", ".title-name", function(){
            	if(digitalData.pfm)
            	{
            	  delete digitalData.pfm;
            	  delete digitalData.pfmdetails;
            	}
                var productName=$(this).text();
                var productHeading=$(this).closest(".column3").find(".product-title").text();
                var productPosition=productHeading.trim();
                digitalData.eventData= {
                    productName: productName,
                    productPosition: productPosition,
                }
                try {
                    _satellite.track('ndsProductClick');
                } catch (e) {}
            });
        });

    },

    footerCurrentYear: function() {
    	document.getElementById("current_year").innerHTML = new Date().getFullYear();    
    },
    
    
    analyticProductFindingMethod :function(){
    	
    	if ($('.page-detailsSavedListPage').length > 0){
			 try {
					_AAData.method = "list";
					_AAData.methodMetaData =$("h1").text();
				}catch(e){}
		 }
    	
		 if ($('.page-detailsAssemblyPage').length > 0){
			 try {
					_AAData.method = "assembly";
					_AAData.methodMetaData =$(".assembly-name").text();
				}catch(e){}
		 }
		 
		 
		 if ($('.page-productDetails, .template-pages-category-categoryLandingPage, .page-productGrid ').length > 0) {
			 
			 if (window.location.href.indexOf("cid") > -1){
					    if (window.location.href.indexOf("icid") > -1){
					    	var methodData= window.location.href.split("icid=");
							 var methodDataVal= methodData[1];
					    	try {
								_AAData.method = "internal campaign";
								_AAData.methodMetaData = methodDataVal;
							}catch(e){} 
					    } 
					    else {
					    	var methodData2= window.location.href.split("cid=");
							var methodDataVal2= methodData2[1];
					    	try {
								_AAData.method = "external campaign";
								_AAData.methodMetaData = methodDataVal2;
							}catch(e){} 
					    }
				}
		 }
			 
			 if ($('.buy-it-again-container').length > 0) {
				 try {
						_AAData.method = "previous orders";
						_AAData.methodMetaData = "buy-again";
					}catch(e){} 
			 }
			 
			 if ($('.page-quickOrderPage').length > 0) {
				 try {
						_AAData.method = "previous orders";
						_AAData.methodMetaData = "quick-order";
					}catch(e){} 
			 }
			 
			 if ($('.page-order').length > 0) {
				 try {
						_AAData.method = "previous orders";
						_AAData.methodMetaData = "order-detail";
					}catch(e){} 
			 }
			 
			 if ($('.page-orderConfirmationPage').length > 0) {
				 try {
						_AAData.method = "previous orders";
						_AAData.methodMetaData = "order-confirmation";
					}catch(e){} 
			 }
			 
		 
		 
		 if ($('.page-searchGrid').length > 0){
			 
			 try {
					_AAData.method = "internal search";
					_AAData.methodMetaData = _AAData.productSearchTerm;
				}catch(e){}
			 
		 }
		 
		 
		 
    },
    
    analyticsExternalReferrer: function(){
    	if($(".referrermethod").val()== "naturalReferrer"){
	    	try {
	    	_AAData.method = "natural referrer";
	    	_AAData.methodMetaData = $(".referrermethoddata").val();
	    	}catch(e){}
    	}
    	
    	if($(".referrermethod").val()== "browse"){
	    	try {
	    	_AAData.method = "browse";
	    	_AAData.methodMetaData = "navigation";
	    	}catch(e){}
	    }
    	
    	if ($('.page-productDetails').length > 0) {
            let inventorystockPDP = $('.custom-dropdown-label').data("stock");
            let inventorymulPDP =  $('.custom-dropdown-label').data("inventory");
			 
			 if (window.location.href.indexOf("isrc") > -1){
					    	var methodData= window.location.href.split("isrc=");
							 var methodDataVal= methodData[1];
					    	try {
								_AAData.method = "browse";
								_AAData.methodMetaData = methodDataVal;
								
								//Product Recommendation
								
								digitalData.pfm = "recommendation";
							 	digitalData.pfmdetails = localStorage.getItem("pageNameRecc");
							}catch(e){} 
    	
			 }
		
		try {
			if($('.loginstatus').val() != ''){
				var PDPproductprice=$(".simple-product-pdp__value--retail-price .yourPriceValue").text().replace(/[^0-9\.]/g, '');
			}
			else{
				var PDPproductprice=$(".simple-product-pdp__value--retail-price .price").text().replace(/[^0-9\.]/g, '');
			}
			if( inventorystockPDP < inventorymulPDP){
                _AAData.productStockStatus = $(".js-pdp-store-detail-1 ").text().trim();
                _AAData.productprice = PDPproductprice; 
            }else{
                _AAData.productStockStatus = $(".js-pdp-store-detail").text().trim();
                _AAData.productprice = PDPproductprice;
            }
	    	}catch(e){}
    	}
   	},
    
     analyticsPageIndentifier :function(){
		let currentPage;
		let pageName = $(".pagename").val();
		if($('.loginstatus').val() == ''){
			sessionStorage.setItem("loginstatus", false);
		}
		
    	if ($('.loginstatus').val() != '' && (!sessionStorage.getItem("loginstatus") || sessionStorage.getItem("loginstatus") == 'false')){
			currentPage = 'login-success';
			sessionStorage.setItem("loginstatus", true);
        }
  		else if ($('.page-searchGrid').length > 0){
			currentPage = 'search-product-search';
  		 }
  		else if ($('.page-productDetails').length > 0){
  			currentPage = 'prod-details';
  		 }
  		else if ($('.template-pages-category-categoryLandingPage').length > 0 && _AAData.eventType=="search-product"){
			currentPage = 'search-product-category';
  		 }
  		  

         if(pageName == "HomePage"){
            _AAData.page.pageName = "v2: home";
            _AAData.pathingChannel = "home";
            _AAData.pathingPageName = "v2: home"; 
         }
         
             if (currentPage) {
                 try {
                     _satellite.track(currentPage);
                 } catch (e) { }

             }
             if (fireSearchLandingPage) {
                 try {
                     _satellite.track("search landing page");
                 } catch (e) { }
             }
             try {
                 _satellite.track("pageload");
             } catch (e) { }

             if ($(".page-siteOneCheckoutPage").length > 0) {
                 let checkAco = ["pickup-box", "delivery-box", "shipping-box"];
                 let defaultAco = ["pickup", "delivery", "shipping"];
                 ACC.mixedcartcheckout.checkoutAccordian(checkAco, defaultAco);//mixed cart check
                 if ($('.orderTypeFormSubmit, .addShippingMainFormSubmit, .addShippingFormSubmit').is(":visible") == true) {//non-mixed cart check
                     console.log('fullfillmentDetails');
                     try {
                         _satellite.track("fullfillmentDetails");
                     } catch (e) { }
                 }
             }
             if (_AAData.page.pageName == "Checkout:Order Confirmation") {
                 var productData = [];
                 var itemCount = 0;
                 $(".item__image-wrapper").each(function () {
                     productData.push({
                         id: $(this).find(".item__code").eq(0).text(),
                         name: $(this).find(".item__name-wrapper").text(),
                         category: ""
                     });
                     itemCount++;
                 });
                 rdt('track', 'Purchase', {
                     "currency": "USD",
                     "itemCount": itemCount,
                     "transactionId": _AAData.orderNumber,
                     "value": _AAData.totalPurchaseAmount,
                     "products": productData
                 });
             }
            if($('.multipleUomContents').length > 0){
                $("#inventoryQty").val($('.multipleUomItem').eq(0).data('inventorymultiplier'));
                ACC.product.checkMinQuantity($('#pdpAddtoCartInput'),1);
            }
            if($('.inventoryDownload').is(":visible") && localStorage.getItem("inventorydownload") == 'true'){
                var URL = "/my-account/downloadNurseryInventoryCSV?storeId=" + $('#storeId').val();
                window.location = URL;
                localStorage.setItem("inventorydownload", false);
            }
            if($('#plpcategoryName').is(":visible")){
                var plpCategoryList = '';
                if($('#breadcrumbName3').val() != undefined){
                  plpCategoryList = $('#breadcrumbName1').val() +' '+$('#breadcrumbName3').val();
                }
                else{
                    if($('#breadcrumbName2').val() != undefined){
                    plpCategoryList = $('#breadcrumbName1').val() +' '+$('#breadcrumbName2').val();
                    }
                    else{
                        plpCategoryList =  $('#breadcrumbName1').val();
                    }
                }
                if($('#breadcrumbName1').val() == undefined){
                  plpCategoryList = $('#breadcrumbName0').val();
                  //document.getElementById('plpcategorynameAnalyticss').innerText = plpCategoryList;
                }
                document.getElementById('plpproductcountviewDesktop').innerText = $('#plpproductCount').val();
                document.getElementById('plpcategorynameAnalytics').innerText = plpCategoryList;
                if(!$('.category-tiles-heading').is(":visible")){
                    $('#plpproductcountviewMobile').removeClass('plpfilterbycategoryMobile');
                }
                
            }
            if($('.product-variant-table').length > 0){
                $("#addToListMobile").hide();
            }    
            $(document).ready(function(){
				if($('.productDetailsHeighlights').is(":visible")){
					if($('.infoDiv').is(":visible")){
						$('.viewSpecSheet').removeClass('hidden');
					}
					if($('.productDetailsHighlights-VariantSection').is(":visible")){
						$('.productDetailsHeighlights').addClass('productDetailsHeighlightsVariant');
					}
				}
                if($('.js-login-to-buy').is(":visible") && $('#mobile-addcart-qty-section').is(":visible")){
                    $('#mobile-addcart-qty-section').addClass('countsection-margin');
                    if($('.22').is(":visible")){
                        $('.22').addClass('login-to-buy-simpleproduct');
                    }
                }
                //PLP Toggle
                if (($(".plpviewtype").val() == "card")) {  
                   /* $('.card-toggle').addClass("active");
                    $('.list-toggle').removeClass("active");*/
                    var list = document.querySelectorAll('.qty-section-productcode');
                    for (let count = 0; count < list.length; count++) {
                        var qty = $(list[count]).val();
                        if(!(($('#listPageAddToCart_'+qty).is(":visible")) || ($('#orderOnlineATC_'+qty).is(":visible")))){                             
                            $('.cardview-errorpart-'+qty).remove();
                       }
                        sessionStorage.setItem("baseUOM_"+qty, 'true');
                    }   
                }
             else {   
                   /* $('.list-toggle').addClass("active");
                    $('.card-toggle').removeClass("active");*/
                    var list = document.querySelectorAll('.qty-section-productcode');
                    for (let count = 0; count < list.length; count++) {
                        var qty = $(list[count]).val();
                        /*if(!(($('#listPageAddToCart_'+qty).is(":visible")) || ($('#orderOnlineATC_'+qty).is(":visible")))){                             
                             $('.qty-section_'+qty).remove();
                        }*/
                        sessionStorage.setItem("baseUOM_"+qty, 'true');
                    }     
                } 
            });
    },
    analyticSearchEmpty: function(){

   	 $('#searchBoxempty').submit(function() {
   		   if($('.search-empty-input').val() == ''){
   		      $(".errormessage").removeClass("hidden");
   		      $('.search-empty-input').addClass("input-error");
   		      return false;
   		   }
   		 });
            $('.pseudo-search-icon').click(function(e) {
                if(!$(e.target).hasClass('search-empty-input')){
                    $('#searchBoxempty').submit(); 
                }                          
            });
             $('.search-empty-input').blur(function(){
                         if( !$(this).val() ) {
                             $(".errormessage").removeClass("hidden");
                             $(this).addClass("input-error");
                         }
                      else{
                        $(".errormessage").addClass("hidden");
                        $(this).removeClass("input-error");
                      }
               });
   },
   
    analyticCuratedplp: function(){
        if($('body').hasClass('template-pages-layout-siteOneCuratedPlpLayout')){
        	
        	if(digitalData.pfm)
        	{
        	  delete digitalData.pfm;
        	  delete digitalData.pfmdetails;
        	}
        	
            _AAData.pfm= "curated-plp";
            _AAData.pfmDetails= $(".pagename").val();
            
            
            
            $('.curated-analytics').on("click",function() {
                ACC.global.productCutatedplp = true;
            });
            $('.js-login-to-buy').click(function() {

                digitalData.eventData={
                     linkName: 'product-grid',
                     linkType: 'login to buy',
                    onClickPageName: $(".pagename").val()
                     }
               
                try {
                    _satellite.track('linkClicks');
                 }catch(e){} 
                 
               });
            $('.curatedplp-list').on("click",function() {
                ACC.global.productCutatedplpList = true;
            });
            $('.curatedplp-branch').on("click",function() {
                CutatedplpName = $(this).parent(".store").find(".storeName").text();
                curatedplpLinkName = 'visit branch page'
                ACC.global.productCutatedplpLink = true;
            });
            $('.curatedplp-promo').on("click",function() {
                CutatedplpName = $(this).parent(".promo-wrapper").find(".headline2").text();
                curatedplpLinkName = 'Contact us'
                ACC.global.productCutatedplpLink = true;
            });
            $('.curated-promo-btn').on("click",function() {
                CutatedplpName = 'button'
                curatedplpLinkName =$(this).text().trim();
                ACC.global.productCutatedplpLink = true;
            }); 
            $('.logInToSeeYourPrice').on("click",function() {
                CutatedplpName = 'product-grid'
                curatedplpLinkName ='login to se your price';
                ACC.global.productCutatedplpLink = true;
            });
            $('.name').on("click",function() {
                CutatedplpName = 'product-grid'
                curatedplpLinkName =$(this).parents(".product-item-box").find("a.name").text().slice(0,85).trim();
                ACC.global.productCutatedplpLink = true;
            });
            $('.thumb').on("click",function() {
                CutatedplpName = 'product-grid'
                curatedplpLinkName =$(this).parents(".product-item-box").find("a.name").text().slice(0,85).trim();
                ACC.global.productCutatedplpLink = true;
            });
            $('.banner-click').on("click",function() {
                CutatedplpName = 'banner'
                curatedplpLinkName =$('img', this).attr('title');
                ACC.global.productCutatedplpLink = true;
            });
            $('.nav-click').on("click",function() {
                CutatedplpName = 'ribbon-menu'
                curatedplpLinkName =$(this).text().trim();
                ACC.global.productCutatedplpLink = true;
            });
            $('.cplp-pagination').on("click",function() {
                ACC.global.productCutatedplpPagination = true;
            });
        }
            
    },

	analyticProductRecommendation: function(){
		   
		   $('.recomm-analytics').click(function() {
			 
			   localStorage.setItem("pageNameRecc",  _AAData.page.pageName);
		       
		       digitalData.pfm = "recommendation";
			   digitalData.pfmdetails = _AAData.page.pageName;
		       
		       
		       digitalData.eventData={
		    		    linktype:linkType,
		                linkName:linkName,
		                onClickPageName:onClickPageName
		            }
		      
		       try {
		    	   _satellite.track('linkClicks');
				}catch(e){} 
				

				
			  });
		   
		   $('.btn-carousel_addtocart').on("click",function() {
			   
			   ACC.global.productAnalyticsRecAtc = true;
		   });
		   	
		   },
		   
	analytichardscapes : function(){
	
		var onClickPageName= $(".siteonepagename").val();
		
		    	$('.askexp-anlytcs').click(function() {
		    		
		    		if(digitalData.pfm)
		        	{
		        	  delete digitalData.pfm;
		        	  delete digitalData.pfmdetails;
		        	}

				       digitalData.eventData={
				    		    linktype:"Hardscapes page",
				                linkName:"Ask an Expert",
				                onClickPageName:onClickPageName
				            }
				      
				       try {
				    	   _satellite.track('linkClicks');
						}catch(e){} 
						
					  });
		    	
		    },	   

	hardScapeDatePicker: function(){
		$(".projectDatepicker").datepicker();
		  $('.pointer .icon-calendar').click(function() {
		    $(".projectDatepicker").focus();
		  });
		 
		$('#typeOfCustomer').on('change', function() {
            var typeofcustomer= $(this).val();
            let labelParent = $('.contractor-mycompany-name');
            labelParent.children("label").html(labelParent.data("companyname"));
            if (typeofcustomer == ACC.config.contactUsidentityoption1) {
                labelParent.children("label").html(labelParent.data("contractorname"));
                labelParent.show();
            }
            else if (typeofcustomer == ACC.config.contactUsidentityoption2) {
                labelParent.show();
            }
            else {
                labelParent.hide();
            }
        });
		 
	},
	showRecommendedProduct: function(){
		var pageId = $("#pageId").val();
		if(pageId=='productGrid' || pageId=='searchGrid' || pageId=='searchEmpty' || pageId.includes('CategoryLandingPage') || pageId=='cartPage' || 
			pageId.includes('orderConfirmationPage') || pageId=='productDetails' || pageId=='siteonehomepage'){
		var requestData;
		if (pageId=='productGrid' || pageId.includes('CategoryLandingPage')){
			var categoryId = $("#categoryCodePR").val();
			if(!categoryId){
				var url = window.location.href;
				var spliturl = url.split("/");
				var intCat = spliturl[spliturl.length-1];
				var splitIntCat = intCat.split("?");
				var categoryId = splitIntCat[0];
			}
			var productcode = '';
            var productCount=0;
            $(".productCodeValue").each(function(){
                if(productCount<15){
                    if(productCount==0){
                        productcode=productcode+$(this).val();
                    }
                    if(productCount>0){
                        productcode=productcode+'|'+$(this).val();
                    }
                }
                productCount++;
            });
			requestData={"placementPage":"categoryPage","categoryId":categoryId,"productId":productcode};
		}
		if (pageId.includes('orderConfirmationPage')){
			var orderId = $(".orderId").text();
			requestData= {"placementPage":"purchaseCompletePage","orderId":orderId};
		}
		if (pageId=='productDetails'){
			var productcode = $("#productcode").val();
			requestData= {"placementPage":"itemPage","productId":productcode};
		}
        if (pageId=='siteonehomepage'){
			requestData= {"placementPage":"homePage"};
		}		
		if (pageId=='searchGrid' || pageId=='searchEmpty'){
            var searchTerm = $(".highlightedSearchText").text();
            if(pageId=='searchEmpty'){
                var searchTerm = $(".emptySearchTerm").val();
            }
			var productcode = '';
            var productCount=0;
            $(".productCodeValue").each(function(){
                if(productCount<15){
                    if(productCount==0){
                        productcode=productcode+$(this).val();
                    }
                    if(productCount>0){
                        productcode=productcode+'|'+$(this).val();
                    }
                }
                productCount++;
            });
			requestData= {"placementPage":"searchPage","searchTerm":searchTerm,"productId":productcode};
		}
		if (pageId=='cartPage'){
			var productcode = '';
            var productCount=0;
            $(".productCodeValue").each(function(){
                    if(productCount==0){
                        productcode=productcode+$(this).val();
                    }
                    if(productCount>0){
                        productcode=productcode+'|'+$(this).val();
                    }
                productCount++;
            });
			requestData= {"placementPage":"cartPage","productId":productcode};
		}
		$(document).ready(function(){
				$.ajax({
				type: 'GET',
				url: ACC.config.encodedContextPath + '/recommendedProducts',
				cache: false,
				dataType: "json",
				data: requestData,
				success: function(response) {
						if (pageId=='productGrid' || pageId=='searchGrid' || pageId=='searchEmpty' || pageId.includes('CategoryLandingPage')){
							$("#RecommendedProductSlotCategory").html(response.recommendedProductsLayer);
						}
						if (pageId.includes('orderConfirmationPage')){
							$("#RecommendedProductCheckoutSlot").html(response.recommendedProductsLayer);
						}
						if (pageId.includes('cartPage')){
							$("#RecommendedProductCartSlot").html(response.recommendedProductsLayer);
						}
						if (pageId=='productDetails'){
							$("#RecommendedProductSlotPDPTop").html(response.recommendedProductsLayer1);
							$("#RecommendedProductSlotPDPBottom").html(response.recommendedProductsLayer2);
						}
                        if (pageId=='siteonehomepage'){
							$("#RecommendedProductSlotHomePageTop").html(response.recommendedProductsLayer1);
							$("#RecommendedProductSlotHomePageBottom").html(response.recommendedProductsLayer2);
						}
						ACC.global.getRecommendedProducts(response);
		            }
	        	});
			});
		}
	},
    getRecommendedProducts: function(res) {
	    if(res) {
            ACC.global.createCarouselIndicators();
            ACC.global.createCarouselIndicatorsPDP();
            $ajaxCallEvent = true;
            ACC.product.enableAddToCartButton();
            ACC.product.bindToAddToCartForm();
            ACC.global.carouselClickEvent();
            ACC.global.carouselClickEventPDP();
            ACC.product.checkCSP();

            $('.btn-carousel_addtocart').on("click",function() {
               ACC.global.productAnalyticsRecAtc = true;
             });

            $('input[id^=regulated]').each(function () {
                var thisRegulated=$(this);
                var productCode = this.id.split('regulated')[1];
                var isRegulatory = ($(this).val() == 'true');
                if (isRegulatory) {
                  var isProductSellable = ($("#isProductSellable" + productCode).val() == 'true');
                  var isSellableInventoryHit = ($("#isSellableInventoryHit_" + productCode).val() == 'true');
                  var isStockAvailable = ($("#isStockAvailable_" + productCode).val() == 'true');
                  var isLicensed = ($("#isLicensed" + productCode).val() == 'true');
                  var isMyStoreProduct = ($("#isMyStoreProduct" + productCode).val() == "true");
                  if (isProductSellable && isMyStoreProduct) {
                    $.ajax({
                      url: ACC.config.encodedContextPath + "/cart/rupcheck",
                      data: { "productCode": productCode, "isRegulatory": isRegulatory },
                      type: "GET",
                      success: function (result) {
                        $("#isRup" + productCode).val(result);

                        if ((result && !isLicensed)) {
                          $('#listPageAddToCart_' + productCode).attr('disabled', 'disabled');
                          $('#orderOnlineATC_' + productCode).attr('disabled', 'disabled');
                          $('#regulatoryLicenceCheck_' + productCode).removeClass('hidden');
                          thisRegulated.closest(".product-item-box").find(".js-login-to-buy").attr('disabled', 'disabled');

                        }
                        else {
                          $('#regulatoryMessage_' + productCode).removeClass('hidden');
                          $('#regulatoryLicenceCheck_' + productCode).addClass('hidden');
                        }
                      }
                    });
                  }
                  if (!isProductSellable && isMyStoreProduct) {
                    $('#listPageAddToCart_' + productCode).attr('disabled', 'disabled');
                    $('#orderOnlineATC_' + productCode).attr('disabled', 'disabled');
                    $('#regulatoryMessage_' + productCode).removeClass('hidden');
                    $('#regulatoryLicenceCheck_' + productCode).addClass('hidden');
                    thisRegulated.closest(".product-item-box").find(".js-login-to-buy").attr('disabled', 'disabled');
                  }
                }
            });
	    }
	},
    createCarouselIndicators: function(){
		let target = $("#recommendedProductBanner");
		let scrollMultiplier = Math.round(target.outerWidth() / target.find(".category-tile-item").outerWidth());
        let productLen ;
        if(target.find('#carouselProduct').val()<=4)		
        {
            productLen = 1;
        }
        else{
            productLen = Math.ceil((target.find('#carouselProduct').val() / scrollMultiplier));
        }
		
        productLen = (productLen == 0)? 1 : productLen;       
		for(let i=0; i < productLen ; i++){
		target.next(".carousel-indicators").append('<span data-target="#siteoneHomepageBanner" data-slide-to="'+ (i+1) +'" class="'+ (i==0? "carouselA" : "") +'"></span>');
		}
	},
    createCarouselIndicatorsPDP: function(){
		let target = $("#recommendedProductBannerrr1");
		let scrollMultiplier = Math.round(target.outerWidth() / target.find(".category-tile-item").outerWidth());
        let productLen ;
        if(target.find('#carouselProduct').val()<=4)		
        {
            productLen = 1;
        }
        else{
            productLen = Math.ceil((target.find('#carouselProduct').val() / scrollMultiplier));
        }
		
        productLen = (productLen == 0)? 1 : productLen;       
		for(let i=0; i < productLen ; i++){
		target.next(".carousel-indicators").append('<span data-target="#siteoneHomepageBanners" data-slide-to="'+ (i+1) +'" class="'+ (i==0? "carouselA" : "") +'"></span>');
		}
	},
    carouselTileMoveFlag: false,
    carouselTileAutoMove: [],
	partnerCarouselIndicators: function (parentId, targetId, autoMove) {
        let target = $(parentId);
        let itemWidth = target.find(".category-tile-item").outerWidth();
        target.find(".category-tile-item").width(itemWidth);
        let scrollMultiplier = Math.floor(target.outerWidth() / itemWidth);
        let productLen = Math.ceil(target.find('#carouselProduct').val() / scrollMultiplier);
        scrollMultiplier = (ACC.global.wWidth < 1000)? scrollMultiplier : 2;
        let tileWidth = Math.round((target.find(".category-tile-item").eq(scrollMultiplier).length)? target.find(".category-tile-item").eq(scrollMultiplier).position().left-(ACC.global.wWidth < 1000?0:45) : 0);
        productLen = (productLen == 0) ? 1 : productLen;
        for (let i = 0; i < productLen; i++) {
            target.next(".carousel-indicators").append('<span onclick="ACC.global.carouselTileMove(' + (i + 1) + ','  + productLen + ','  + tileWidth + ',\'' + parentId + '\')" data-target="' + targetId + '" data-slide-to="' + (i + 1) + '" class="pointer' + (i == 0 ? " carouselA" : "") + '"></span>');
        }
        target.find(".category-tile-prev").removeClass("category-tile-prev").addClass("carousel-prev").attr("onclick", 'ACC.global.carouselTileMove(1,' + productLen + ','  + tileWidth + ',\'' + parentId + '\')');
        target.find(".category-tile-next").removeClass("category-tile-next").addClass("carousel-next").attr("onclick", 'ACC.global.carouselTileMove(2,' + productLen + ','  + tileWidth + ',\'' + parentId + '\')');
        if(autoMove){
            ACC.global.carouselTileAutoMove = [parentId, 1, productLen];
            setInterval(function(){
                if(ACC.global.carouselTileAutoMove[1] == ACC.global.carouselTileAutoMove[2]){
                    ACC.global.carouselTileAutoMove[1] = 1;
                }
                else{
                    ACC.global.carouselTileAutoMove[1]++;
                }
                $(ACC.global.carouselTileAutoMove[0]).next(".carousel-indicators").find("[data-slide-to='"+ ACC.global.carouselTileAutoMove[1] +"']").trigger("click");
            }, autoMove*1000 );
        }
    },
    carouselTileMove: function (num, slides, tileWidth, parentId) {
        if(!ACC.global.carouselTileMoveFlag){
            ACC.global.carouselTileMoveFlag = true;
            let target = $(parentId);
            let pervNum = (num != 1)? num -1: 1;
            let nextNum = (num != slides)? num + 1 : slides;
            target.animate({scrollLeft: tileWidth * (num - 1)}, 800, function(){ACC.global.carouselTileMoveFlag = false});
            target.find(".carousel-prev").attr("onclick", 'ACC.global.carouselTileMove(' + pervNum + ',' + slides + ','  + tileWidth + ',\'' + parentId + '\')');
            target.find(".carousel-next").attr("onclick", 'ACC.global.carouselTileMove(' + nextNum + ','  + slides + ','  + tileWidth + ',\'' + parentId + '\')');
            target.next(".carousel-indicators").find(".carouselA").removeClass("carouselA");
            target.next(".carousel-indicators").find("[data-slide-to='"+ num +"']").addClass("carouselA");
        }
    },
	passwordShowHideBtn: function(){
		 $('input[type=password][id=j_password]').wrap('<div class="pswrd-container"/>');
		 $('.pswrd-container').append('<span class="glyphicon glyphicon-eye-open showhide-pswrd hidden"></span>');
		 $('.pswrd-container').append('<span class="glyphicon glyphicon-eye-close showhide-pswrd hidden"></span>');
		 
		 $(document).on("input", "input[id=j_password]", function() {
			var ele = $(this).parent(".pswrd-container").find('.showhide-pswrd');
			
			if($(this).val() !== "") {			
				var iconIdx = $(this).attr('type') == 'password' ? 0: 1;
				ele.eq(iconIdx).removeClass("hidden");
			}else {
				ele.addClass("hidden");
				$(this).attr('type', 'password');
			}
		 });
		 		 		 
		 $(document).on("click", ".showhide-pswrd", function (e) {
			 var pwd = $(this).parent(".pswrd-container").find("#j_password");
			 const type = pwd.attr('type') === 'password' ? 'text' : 'password';
			 var ele = $(this).parent(".pswrd-container").find('.showhide-pswrd');
			 
			 if(type === 'text'){
				 ele.addClass("hidden");
				 ele.eq(1).removeClass("hidden");
			 }else{
				 ele.addClass("hidden");
				 ele.eq(0).removeClass("hidden");
			 }
			 
			 pwd.attr('type', type);
		 })
	},
	passwordShowHideBtnOnCreatePasswordPage: function(){
		if($('body').hasClass('page-setPasswordPage') || $('body').hasClass('page-updatePassword')){
			var funAttachEyeIcon = function (targetName){
				$('input[type=password][name='+targetName+']').wrap('<div class="pswrd-container"/>');
				
				var targetParent = $('input[type=password][name='+targetName+']').parent(".pswrd-container");
				
				targetParent.append('<span class="glyphicon glyphicon-eye-open showhide-pswrd pswrdCreatePage hidden"></span>');
				targetParent.append('<span class="glyphicon glyphicon-eye-close showhide-pswrd pswrdCreatePage hidden"></span>');
				
				$(document).on("input", 'input[name='+targetName+']', function() {
					var ele = $(this).parent(".pswrd-container").find('.showhide-pswrd');

					if($(this).val() !== "") {			
						var iconIdx = $(this).attr('type') == 'password' ? 0: 1;
						ele.eq(iconIdx).removeClass("hidden");
					}else {
						ele.addClass("hidden");
						$(this).attr('type', 'password');
					}
				 });

				
			}
			
			funAttachEyeIcon('pwd');
			funAttachEyeIcon('checkPwd');
			
			 $(document).on("click", ".pswrd-container > .pswrdCreatePage", function (e) {
				 var pwd = $(this).parent(".pswrd-container").find('input').first();
				 const type = pwd.attr('type') === 'password' ? 'text' : 'password';
				 var ele = $(this).parent(".pswrd-container").find('.showhide-pswrd');

				 if(type === 'text'){
					 ele.addClass("hidden");
					 ele.eq(1).removeClass("hidden");
				 }else{
					 ele.addClass("hidden");
					 ele.eq(0).removeClass("hidden");
				 }

				 pwd.attr('type', type);
			 });
		}
	},
	throttleFunction: (func, delay)=> {
      let prev = 0;
      return (...args) => {
        let now = new Date().getTime();
        
        if(now - prev>= delay) {
          prev = now;
          return func(...args); 
        }
      }
	},
    //Local Storage value set for inventory download
    gustInventoryDownload(){
        localStorage.setItem("inventorydownload", true);
    },
    getDate: function() {
        const month = ["January","February","March","April","May","June","July","August","September","October","November","December"];
        const d = new Date();
        var cDay = d.getDate();
        var cMonth = month[d.getMonth()];
        var cYear = d.getFullYear();
        return cMonth + " " + cDay + ", " + cYear;
    },
    getTime: function() {
        const d = new Date();
        var hours = d.getHours();
        var minutes = d.getMinutes();
        var ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        minutes = minutes < 10 ? '0' + minutes : minutes;
        return hours + ":" + minutes + " " + ampm;
    },
    numberInputEvents: function (ref, min, max, step) {
        let target = $(ref);
        target.prop({ type: "number", min: min, max: max, step: step }).on({ "keydown": ACC.global.numberInputKeyDown, "keyup": ACC.global.numberInputKeyup, "focus": ACC.global.numberInputFocus, "blur": ACC.global.numberInputBlur, "paste": function (e) { e.preventDefault(); } });
    },
    numberInputKeyDown: function (pEvent) {
        let ref = $(pEvent.currentTarget);
        let refVal = ref.prop("value");
        if ((ref.prop("step") == 1 && pEvent.key == ".") || pEvent.key == "e" || pEvent.key == "E" || pEvent.key == "-" || pEvent.key == "+" || (ref.prop("maxlength") <= refVal.length && ((pEvent.keyCode > 47 && pEvent.keyCode < 58) || (pEvent.keyCode > 95 && pEvent.keyCode < 106)))) {
            pEvent.preventDefault();
        }
    },
    numberInputKeyup: function (pEvent) {
        let ref = $(pEvent.currentTarget);
        let refVal = ref.prop("value");
        if (Number(ref.prop("max")) < refVal) {
            ref.val(refVal.slice(0, -1));
        }
    },
    numberInputFocus: function (pEvent) {
        var ref = $(pEvent.currentTarget);
        let refVal = ref.prop("value");
        if (Number(ref.prop("max")) < refVal) {
            ref.val(refVal.slice(0, -1));
        }
        else if (Number(ref.prop("min")) > refVal) {
            ref.val("");
        }
    },
    numberInputBlur: function (pEvent) {
        var ref = $(pEvent.currentTarget);
        let refVal = ref.prop("value");
		if(refVal && refVal != ""){
	        if (Number(ref.prop("max")) < refVal) {
	            ref.val(refVal.slice(0, -1));
	            ref.trigger('blur');
	        }
	        else if (Number(ref.prop("min")) > refVal) {
	            ref.val("");
	            ref.trigger('blur');
	        }
		}
    },
    toggleOffElems: function (e, eElem, className, offTarget) {
        let target = $(eElem);
        let ref = (e) ? $(e) : target;
        if (!ref.hasClass("signInOverlay") && !(ACC.global.wWidth < 1024 && ref.hasClass("active"))) {
            $(".global-categories-btn.active").removeClass("active");
            if (target.is(":visible")) {
                $(eElem + '-overlay').hide();
                target.hide();
                $(eElem + '-button').removeClass(className);;
                ref.removeClass(className);
            }
            else {
                if (eElem == ".global-savedlist-box") {
                    ACC.global.fetchListData();
                    $(".global-savedlist-box .listName").removeAttr("style").next();
                    $(".global-savedlist-box #nameError").empty();
                }
                if (offTarget && $(offTarget).is(":visible")) {
                    $(offTarget).hide();
                    $(".js-document-global-btn.active").removeClass("active");
                }
                if ($(".global-category-section").hasClass("active")) {
                    $(".global-category-section").trigger("click");
                }
                if ($('.language-dropdown').is(":visible")) {
                    $('.language-value').trigger("click");
                }
                if (ACC.global.wWidth < 1024 && $(".js-document-global-box").is(":visible")) {
                    $(".js-document-global-box").hide();
                }
                $(eElem + '-overlay').show();
                target.show();
                ref.addClass(className);
            }
        }
    },
	elemHeightEqual: function(className, wWidth) {
        wWidth = wWidth ? wWidth : 0;
        let target = $(className);
        if (target.length > 1 && ACC.global.wWidth > wWidth) {
            var minHeight = 0;
            target.each(function () {
                let tempHeight = $(this).height();
                $(this).height("auto");
                minHeight = minHeight > tempHeight ? minHeight : tempHeight;
                minHeight = minHeight > $(this).height() ? minHeight : $(this).height();
            });
            target.height(minHeight);
        }
    },
    toggleOffElemsplp: function (e, eElem, className,pCode) {
        let target = $(eElem);
        let ref = (e) ? $(e) : target;
        let dropdownFlag = false;
        let offTarget = $(eElem + "_" + pCode);
            if($(".popup-box-muom").hasClass("active") && !$(".popup-box-muom_"+pCode).hasClass("active")){
                $(".popup-box-muom").hide();
                ref.removeClass("dropdown-open");
                ref.removeClass("muomdropdownopen");
                ref.removeClass(className);
                $('.popup-box-muom').removeClass(className);
                dropdownFlag = true;
                 offTarget.show();
                        ref.addClass(className);
                        $('.popup-box-muom_'+pCode).addClass(className);
                        ref.addClass("muomdropdownopen");
                        ref.addClass("dropdown-open");
                        $(".popup-box-muom.active").addClass("clickactive");
                        
            }
       
            if (target && target.is(":visible") && $('[id="js-btn-muom"]').hasClass('active') && !dropdownFlag) {
                
                    if($('[id="js-btn-muom"]').hasClass('muomdropdownopen')){
                    offTarget.hide();
                    ref.removeClass("dropdown-open");
                    ref.removeClass("muomdropdownopen");
                    ref.removeClass(className);
                    $('.popup-box-muom_'+pCode).removeClass(className);
                    }
                }
                else{
                    if(!dropdownFlag){
                        offTarget.show();
                        ref.addClass(className);
                        $('.popup-box-muom_'+pCode).addClass(className);
                        ref.addClass("muomdropdownopen");
                        ref.addClass("dropdown-open");
                        $(".popup-box-muom.active").addClass("clickactive");
                        dropdownFlag = false;
                    }   
                }
    },
	toggleOffElemsVariantplp: function (e, pCode) {
		//Stock Data
		var codeData;
		var stockMessage;
		var stockCount;
		var stockLocation;
		var htmlCodes;
		for(i=0; i<4; i++){
			htmlCodes = '';
			if($('.variant-codes-cardDropdown-' +pCode)[i] != undefined){
					var codeData =	$('.variant-codes-cardDropdown-' +pCode)[i].value;
					stockMessage = Number($('.stockMessageShown_' +codeData).val());
					stockCount = Number($('.stockCountShown_' +codeData).val());
					stockLocation = $('.stockLocationData_' +codeData).val();
					if(stockMessage == 13 || stockMessage == 16 || stockMessage == 17 || stockMessage == 18 || stockMessage == 27){
						htmlCodes =  '<span class="vdropdownInStock">'+stockCount+'&nbsp;'+ACC.config.vdropdownInStock+'</span>';
					}
					else if(stockMessage == 14){
						htmlCodes =  '<span class="vdropdownInStock">'+stockCount+'&nbsp;'+ACC.config.vdropdownInStock+'&nbsp;<span class="vdropdownForShippingOnly">'+ACC.config.vdropdownForShippingOnly+'</span></span>';
					}
					else if(stockMessage == 15 || stockMessage == 24 || stockMessage == 25 || stockMessage == 26){
						htmlCodes =  '<span class="vdropdownBackorder">-&nbsp;'+ACC.config.vdropdownBackorder+'</span>';
					}
					else if(stockMessage == 19 || stockMessage == 20 || stockMessage == 21 || stockMessage == 28){
						htmlCodes =  '<span class="vdropdownInStockNearby">'+stockCount+'&nbsp;'+ACC.config.vdropdownInStockNearby+'&nbsp;Branch #'+stockLocation+'</span>';
					}
					else if(stockMessage == 22 || stockMessage == 23){
						htmlCodes =  '<span class="vdropdownMoreOnTheWay">!&nbsp;'+ACC.config.vdropdownMoreOnTheWay+'</span>';
					}
					else if(stockMessage == 29 || stockMessage == 30 || stockMessage == 31 || stockMessage == 32){
						htmlCodes =  '<span class="vdropdownNotAvailable">'+ACC.config.vdropdownNotAvailable+'</span>';
					}
					$('.variantDropdownStockSection_' +codeData).html(htmlCodes);
			}
		}
		//Stock Data
		if($(".js-btn-variant").hasClass("active")){
			   $('.popup-box-variant').hide(); 
			   $(".js-btn-variant").removeClass("active");
		}else{
		   var eElem = $('.DropdownClassAction_' +pCode).val();
		   var className = $('.DropdownClassActive_' +pCode).val();
	       let target = $(eElem);
	       let ref = $('.js-btn-variant_' +pCode);
	       let offTarget = $(eElem + "_" + pCode);
	       var variantcount = $('.product-data-variant-count-' +pCode).val();
	       if(variantcount > 4){
			    $('.showmore_' +pCode).removeClass("hidden");
		   }else{
			    $('.showmore_' +pCode).addClass("hidden");
		   }
	       if (target && target.is(":visible") && $('[id="js-btn-muom"]').hasClass('active')) {
	          
	           if($('[id="js-btn-muom"]').hasClass('muomdropdownopen')){
	            offTarget.hide();
	            //ref.removeClass("dropdown-open");
	           }
	        }
	        else{
	           if(target.is(":visible")){
	               //hide 
	               offTarget.hide();
	               ref.removeClass(className);
	               //ref.removeClass("dropdown-open");
	           }
	           else{
	               //show
	               offTarget.show();
	               ref.addClass(className);
	               //ref.addClass("muomdropdownopen");
	               //ref.addClass("dropdown-open");
	           }
	        }
		}
	   },
	   redirectPDP: function(pCode){ 
		     var redirectURL = $('.product-data-variant-redirect-' +pCode).val();
		     window.location.href = redirectURL;
	},
    qtyTotalPriceUpdaterPLP: function(pCode){  
        var inventoryUomId = $('#plpselectedUOM_' +pCode).val();
        var identifier = inventoryUomId+ '-' +pCode
        let target = $('.qtyprice-' +identifier);
        let productCode=target.data("productcode");
        let quantity=$('#productPLPPostQty_' +productCode).val();
        let uomDesc=target.data("uom");
        let viewPage = $(".plpviewtype").val();
        let login = $(".isloggeduser").val(); 
        let uomCode =target.data("desccode"); 

        //let offTarget = $(".popup-box-muom_" +pCode);

     $.ajax({
                 type: 'GET',
                 url: ACC.config.encodedContextPath + '/p/customerpriceforuom',
                 data: {
                     productCode:productCode,
                     quantity:quantity,
                     inventoryUomId:inventoryUomId
                 },
                 success: function(result){
                    if(viewPage == "card"){
                        if(login == "true"){
                            console.log('Loginif:',login); 
                            target.parents().find('.multipleuom-price-update'+'_'+pCode).find('.csp-price-format').html("<span class='check_price'>"+result.totalPrice.formattedValue+"</span><span class='check_price'><br><sup>"+uomCode+"</sup></span>");
                        }
                        else{
                            console.log('Loginelse:',!login); 
                            target.parents().find('.multipleuom-price-update'+'_'+pCode).find('.list-price-format').html("<span class='black-title b-price add_price atc-price-analytics'>"+result.totalPrice.formattedValue+"</span><br><sup>"+uomCode+"</sup>");
                    
                        }
                        target.parents(".multipleuom-plp").next().find('#inventoryUomId').val(inventoryUomId);
                      
                        target.parents().find('.multipleuom-price-update'+'_'+pCode).parents().find('.multiplpuomatlist'+'_'+pCode).find('#inventoryUOMIDVal').val(inventoryUomId);

                        
                    }
                    else{
                        if(login == "true"){
                            console.log('Loginif:',login); 
                            target.parents('.multipleuom-plp').nextAll('.priceSection'+'_'+pCode).find('.csp-price-format').html("<span class='check_price'>"+result.totalPrice.formattedValue+"</span><span class='check_price'><br><sup>"+uomCode+"</sup></span>");
                        }
                        else{
                            console.log('Loginelse:',!login); 
                            target.parents('.multipleuom-plp').nextAll('.priceSection'+'_'+pCode).find('.list-price-format').html("<span class='black-title b-price add_price atc-price-analytics'>"+result.totalPrice.formattedValue+"</span><br><sup>"+uomCode+"</sup>");
                    
                        }
                        target.parents(".multipleuom-plp").nextAll('.atc-section').find('#inventoryUomId').val(inventoryUomId);
                        target.parents('.multipleuom-plp').nextAll('.listSection'+'_'+pCode).find('#inventoryUOMIDVal').val(inventoryUomId);
                        
                    }
                    //offTarget.hide();
                    //target.parents('.uom-wrapper-plp').find('.uom-text-wrapper').html(uomDesc);
                    //target.parents('.uom-wrapper-plp').find('.uom-text-wrapper').removeClass("dropdown-open");
                    //target.parents('.multipleuom-plp'+'_'+pCode).nextAll('.plp-ordermultiplesaddtocart').find('[id="inventoryUomId"]').val(inventoryUomId);
                    $('#plpselectedUOM_' +productCode).val(inventoryUomId);
                    console.log('data success:',result);  
                 },
                 error: function(xhr, ajaxOptions, thrownError) {
                      console.log('data failure');               

                  },


               })

    },
    multipleUomTotalPriceUpdaterPLP: function (elem, pCode, login, uomCode, viewPage) {
        let target = $(elem);
        let productCode = target.data("productcode");
        let inventoryUomId = target.data("inventoryid");
        let quantity = target.data("qty");
        let uomDesc = target.data("uom");
        let offTarget = $(".popup-box-muom_" + pCode);
        let baseUOM = target.data("baseuom");
        sessionStorage.setItem("baseUOM_" + pCode, baseUOM);
        $('.js-btn-muom.active').removeClass("active");
        let inventoryMultiplier = target.data("inventorymultiplier");
        let stockDataSection = (viewPage == "cardView") ? target.closest('.product-item').find('.cardstocksection'): target.closest('.product-item').find('.stock-section') 
        if (stockDataSection.length && stockDataSection.is(":visible")) {
            if (stockDataSection.find(".stock-section-instock").length || stockDataSection.find(".stock-section-instock-nearby").length || stockDataSection.find(".stock-section-outofstock").length) {
                let stockData = target.data("stockdata");
                if (stockData < inventoryMultiplier) {
                    stockDataSection.find(".stock-section-outofstock").prev().addClass("hidden");
                    stockDataSection.find(".stock-section-outofstock").removeClass("hidden");
                    stockDataSection.find('.bg-color').text(0);
                    if($(".hardscapeProd_" + productCode).length && target.closest('.product-item').find(".getAQuoteFlagForB2BUser").val() == "true") {
                        let atcSection = (viewPage == "cardView") ? target.closest('.product-item').find(".card-atc-wrapper-section") : target.closest('.product-item').find('.list-atc-wrapper-section');
                        let getAQuoteSection = target.closest('.product-item').find(".getAQuoteSection");
                        atcSection.addClass('hidden');
                        getAQuoteSection.removeClass("hidden");
                        if((".change-branch-section-"+ productCode).length){
                            let changeBranchSection = (viewPage == "cardView") ? target.closest('.product-item').find(".card-change-branch-section") : target.closest('.product-item').find('.list-change-branch-section');
                            let changeBranchGetAQuoteSection = target.closest('.product-item').find(".changeBranchGetAQuoteSection");
                            changeBranchSection.addClass('hidden');
                            changeBranchGetAQuoteSection.removeClass("hidden");
                         }
                        target.closest('.product-item').find(".plp-warning_info_" + productCode).find('.plp-commonerror').text(ACC.config.changeUOMForAvailability);
                    } else { 
                        target.closest('.product-item').find(".plp-warning_info_" + productCode).find('.plp-commonerror').text(ACC.config.expectDelay);
                    }
                    target.closest('.product-item').find(".plp-warning_info_" + productCode).removeClass("hidden");
                    if (target.closest('.product-item').find("#plp-commonerror-" + productCode).is(":visible")) {
                        target.closest('.product-item').find("#plp-commonerror-" + productCode).addClass("hidden");
                    }
                } else {
                    stockDataSection.find(".stock-section-outofstock").prev().removeClass("hidden");
                    stockDataSection.find(".stock-section-outofstock").addClass("hidden");
                    stockDataSection.find('.bg-color').text(Math.floor(Number(stockData) / Number(inventoryMultiplier)));
                    target.closest('.product-item').find(".plp-warning_info_" + productCode).addClass("hidden");
                    if($(".hardscapeProd_" + productCode).length && target.closest('.product-item').find(".getAQuoteFlagForB2BUser").val() == "true") {
                        let atcSection = (viewPage == "cardView") ? target.closest('.product-item').find(".card-atc-wrapper-section") : target.closest('.product-item').find('.list-atc-wrapper-section');
                        let getAQuoteSection = target.closest('.product-item').find(".getAQuoteSection");
                        atcSection.removeClass('hidden');
                        getAQuoteSection.addClass("hidden");
                        if((".change-branch-section-"+ productCode).length){
                            let changeBranchSection = (viewPage == "cardView") ? target.closest('.product-item').find(".card-change-branch-section") : target.closest('.product-item').find('.list-change-branch-section');
                            let changeBranchGetAQuoteSection = target.closest('.product-item').find(".changeBranchGetAQuoteSection");
                            changeBranchSection.removeClass('hidden');
                            changeBranchGetAQuoteSection.addClass("hidden");
                         }
                    }
                }
            }
        }
        $.ajax({
            type: 'GET',
            url: ACC.config.encodedContextPath + '/p/customerpriceforuom',
            data: {
                productCode: productCode,
                quantity: quantity,
                inventoryUomId: inventoryUomId
            },
            success: function (result) {
                if (viewPage == "cardView") {
                    if (login == "true") {
                        target.parents().find('.multipleuom-price-update' + '_' + pCode).find('.csp-price-format').html("<span class='check_price'>" + result.uomPrice.formattedValue + "</span><span class='check_price'><br><sup>" + uomCode + "</sup></span>");
                        if(result.retailPrice && result.retailPrice.formattedValue) {
                            target.parents().find('.multipleuom-price-update' + '_' + pCode).find('.list-price-format').find(".black-title.b-price.add_price.atc-price-analytics").text(result.retailPrice.formattedValue);
                        }
                    } else {
                        target.parents().find('.multipleuom-price-update' + '_' + pCode).find('.list-price-format').html("<span class='black-title b-price add_price atc-price-analytics'>" + result.uomPrice.formattedValue + "</span><br><sup>" + uomCode + "</sup>");
                    }
                    target.parents(".multipleuom-plp").next().find('#inventoryUomId').val(inventoryUomId);
                    target.parents().find('.multipleuom-price-update' + '_' + pCode).parents().find('.multiplpuomatlist' + '_' + pCode).find('#inventoryUOMIDVal').val(inventoryUomId);
                    target.closest('.product-item').find(".productInventoryUOMID_" + productCode).val(inventoryUomId);
                } else {
                    if (login == "true") {
                        target.parents('.multipleuom-plp').nextAll('.qty-price-section').find('.priceSection' + '_' + pCode).find('.csp-price-format').html("<span class='check_price'>" + result.uomPrice.formattedValue + "</span><span class='check_price'><br><sup>" + uomCode + "</sup></span>");
                    } else {
                        target.parents('.multipleuom-plp').nextAll('.qty-price-section').find('.priceSection' + '_' + pCode).find('.list-price-format').html("<span class='black-title b-price add_price atc-price-analytics'>" + result.uomPrice.formattedValue + "</span><br><sup>" + uomCode + "</sup>");
                    }
                    target.parents(".multipleuom-plp").nextAll('.list-atc-section').find('.atc-section').find('#inventoryUomId').val(inventoryUomId);
                    target.parents('.multipleuom-plp').nextAll('.list-atc-section').find('.listSection' + '_' + pCode).find('#inventoryUOMIDVal').val(inventoryUomId);
                    target.closest('.product-item').find(".productInventoryUOMID_" + productCode).val(inventoryUomId);
                }
                offTarget.hide();
                target.parents('.uom-wrapper-plp').find('.uom-text-wrapper').html('<span title="' + uomDesc + '">' + uomDesc + '</span>');
                target.parents('.uom-wrapper-plp').find('.uom-text-wrapper').removeClass("dropdown-open");
                $('.popup-box-muom_' + pCode).removeClass('active');
                target.parents('.multipleuom-plp' + '_' + pCode).nextAll('.plp-ordermultiplesaddtocart').find('[id="inventoryUomId"]').val(inventoryUomId);
                $('#plpselectedUOM_' + productCode).val(inventoryUomId);
                ACC.product.checkMinQuantityPLP($('#productPLPPostQty_' + productCode), 'dropdown');
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log('data failure');
            },
        });
    },
    variantSelector: function(elem, pCode, selectedVariantCode, inventoryUomId){  
        let targetElement = $(elem);
        let target = $(".variant-dropdown-option_" +selectedVariantCode);
        var variantOptionName = $('.variantname_' +selectedVariantCode).val();
        var variantOptionAvailability = $('.variantnameavailability_' +selectedVariantCode).val();
        var selectedVariantItem = $('.variantitemnumber_' +selectedVariantCode).val();
        var selectedVariantItemDesc = $('.variantitemdesc_' +selectedVariantCode).val();
        let offTarget = $(".popup-box-variant_" +pCode);
        $('.js-btn-variant.active').removeClass("active");
        offTarget.hide();
        let checkboxEle = target.closest(".product-item").find(".custom-checkbox");
        $(checkboxEle).each(function() {
            $(this).prop("checked", false).trigger('change');
        });
		let checkboxList = target.closest(".product-item").find(".custom-checkboxlistplp");
		       $(checkboxList).each(function() {
		           $(this).prop("checked", false).trigger('change');
		       });
        if(variantOptionAvailability == 'true'){
			   var splitValues = variantOptionName.split('|');
        	   var selectedData = splitValues[1];
		}
     	else{
			   var selectedData = variantOptionName;
		 }
         $('.popup-box-variant_'+pCode).find('.variant-dropdown-option.selected').removeClass('selected');
         $('.variant-dropdown-option_'+selectedVariantCode).addClass('selected');	
        target.parents('.variant-wrapper-plp').find('.variant-text-wrapper').find('.span-text').html(selectedData);
        target.parents('.variant-wrapper-plp').find('.variant-text-wrapper').removeClass("dropdown-open");
        $('.productVariantSection-' +pCode +'-' +selectedVariantCode).prev('.productInventoryUOMID_' + selectedVariantCode).val(inventoryUomId);    
        //Hide show
        $('.productVariantSection-' +pCode +'-' +selectedVariantCode).removeClass("hidden");
        $('.productInventoryUOMID_' + selectedVariantCode).prevAll(".plp-item-code").first().val(selectedVariantCode);
        $('.productInventoryUOMID_' + selectedVariantCode).prevAll(".plp-item-number").first().val(selectedVariantItem);
        $('.productInventoryUOMID_' + selectedVariantCode).closest(".product-item").find('#requestQuoteButtonItemnumber').val(selectedVariantItem);
        $('.productInventoryUOMID_' + selectedVariantCode).closest(".product-item").find('#requestQuoteButtonDesc').val(selectedVariantItemDesc);
        var variantData = $('.variant-codes-' +pCode).val();
        var variantList = variantData.split(',');
        var variantId;
        var Id;
        for (let count = 0; count < variantList.length; count++) {
			  if(count == 0){
				 Id = variantList[count].split('[');
				 variantId = Id[1];
			  }
			  else if(count == (variantList.length - 1)){
				 Id = variantList[count].split(']');
				 variantId = Id[0];
			  }else{
				 var variantId = variantList[count];
			  }
              if(variantId.trim() != selectedVariantCode){
				   $('.productVariantSection-' +pCode +'-' +variantId.trim()).addClass("hidden");  
                   $('.productVariantSection-' +pCode +'-' +variantId.trim()).prev('.productInventoryUOMID_' + variantId.trim()).val('');
                   $('.productInventoryUOMID_' + variantId.trim()).prevAll(".plp-item-code").first().val('');
                   $('.productInventoryUOMID_' + variantId.trim()).prevAll(".plp-item-number").first().val('');
			  }                                                       
        }   
    },
    dropDownOpenCloseuom(elem, status, dropdownTag) {
        let target = $(elem);
        let offTarget = $("." + dropdownTag + "-option");
        if((dropdownTag="uom-dropdown")&& (screen.width<480) ){

            ACC.global.uomdropdownwidth();
        }
        let targetText = target.find("." + dropdownTag + "-text:first").text();
        if (status == "open") {
            target.attr("onclick", "ACC.global.dropDownOpenClose(this,'close','" + dropdownTag + "')");
            target.addClass("dropdown-open");
            $("[data-" + dropdownTag + "]").each(function () {
                let optionElem = $(this);
                let optionVal = optionElem.data(dropdownTag);
                if (optionVal == targetText) {
                    optionElem.hide();
                }
                else {
                    optionElem.show();
                }
            });
            offTarget.slideDown();
        }
        else {
            target.attr("onclick", "ACC.global.dropDownOpenClose(this,'open','" + dropdownTag + "')");
            target.removeClass("dropdown-open");
            offTarget.slideUp();
        }
        target.removeClass("selected-uom-items");
    },
    plpMobileViewResponse: function(){
        if (window.matchMedia("(max-width:" + screenXsMax + ")").matches) {
            let pageName = $(".pagename").val();
            let viewType = $("#ViewType").val();
            if(pageName == "Product Grid"  || pageName == "Search Results"){
                mobileView = "mobileView";  
                $.ajax({
                    type: 'POST',
                    url: ACC.config.encodedContextPath + "/search/setView",
                    dataType: "json",
                    data: {
                        mobileView:mobileView,
                        viewType: viewType
                    },
                    success: function () {
                        console.log(mobileView);
                    },
                })   
            }   
        } 
    },
    //PLP-Toggle Function
    plpToggleCard: function(){     
        sessionStorage.setItem("plp-view", "card");
        ACC.global.plpToggleFunctionality();
    },
    plpToggleList: function(){
        sessionStorage.setItem("plp-view", "list");
        ACC.global.plpToggleFunctionality();
    },
    plpToggleFunctionality: function(){    
            var view = sessionStorage.getItem("plp-view");   
            $.ajax({
                url: ACC.config.encodedContextPath + "/search/setView?viewType=" +view,
                method: 'POST',
                success: function (response) {
                    window.location.reload();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // log the error to the console
                    console.log("The following error occured: " + textStatus, errorThrown);
                }
            });
        },
    toggleGlobalElems: function (e, eElem, offTarget) {
        let target = $(eElem);
        let ref = $(e);
        if (!ref.hasClass("signInOverlay")) {
            if (target.is(":visible")) {
                target.slideUp();
                if (offTarget) {
                    $(offTarget).show();
                }
            }
            else {
                target.slideDown();
                if (offTarget) {
                    $(offTarget).hide();
                }
            }
            ref.hide();
        }
 },
 //SEO 
 addOgTags: function(){
    var currentUrl = window.location.pathname;
    const match = currentUrl.match(/^\/(?:([a-z]{2})\/)?articles\/([^\/]+)\/([^\/]+)\/?/);
    if(match){
        let cTitle = $('[name="article-content-title"]').val();
        let cDesc = $('[name="article-content-description"]').val();
        let cImageUrl = $('[name="article-content-url"]').val();
        let cLocale = $('[name="article-content-locale"]').val();
        var ogMetaTags = $(
            '<meta property="og:title" content="'+ cTitle +'">' +
            '<meta property="og:description" content="'+ cDesc +'">' +
            '<meta property="og:image" content="'+ cImageUrl +'">' +
            '<meta property="og:url" content="'+ currentUrl +'">' +
            '<meta property="og:type" content="article">' +
            '<meta property="og:site_name" content="SiteOne Landscape Supply">' +
            '<meta property="og:locale" content="'+ cLocale +'"></meta>'
        );         
        var existingMeta = $('head meta[name="robots"]');
        if(existingMeta.length){
            existingMeta.after(ogMetaTags);
        }
        else{
            $("head").append(ogMetaTags);
        }   
    }
},
bindNumberInputEvent: function(){
    $(".js-number-input-event-bind").each(function(){
        ACC.global.numberInputEvents('#' + $(this).attr("id"), 1, 999999, 1);
    });
}
};

ERRORMSG = {
    global : {
        firstname     : ACC.config.enterFirstName,
        lastname      : ACC.config.enterLastName,
        email         : ACC.config.dashboardValidEmail,
        phone         : ACC.config.validPhoneNumber,
        city          : ACC.config.enterCity,
        state         : ACC.config.selectState,//enter not select
        zip           : ACC.config.validZipPostal,
        address       : ACC.config.addressInfo,
        country       : "Please enter a country.",
        company       : ACC.config.enterCompanyName,
        title         : ACC.config.selectTitle,
        parentunit    : ACC.config.selectShipTo,
        shippingStates: ACC.config.shippingStates,
    },
    invalid : {
        email       : ACC.config.dashboardValidEmail
    },
    atcButtonClickEvent: 'body'
};

$('.faq-panel a').on('click',function () {
    $('.faq-panel').removeClass('active');
    $(this).parents('.faq-panel').addClass('active');
    $(this).parent().addClass('active');
    var url=$(this).attr("href")
    if($(url).hasClass('in'))
    {

        $(this).find(".arrowDown").hide();
        $(this).find(".arrowRight").show();
        $(this).parents('.faq-panel').removeClass('active');
        $(this).parents('.panel-title').removeClass('active');
    }
    else{
        $('.faq-sec a span.arrowDown').hide();
        $('.faq-sec a span.arrowRight').show();
        $(".faq-accordion .panel-title").removeClass("active");
        $(".faq-accordion .panel-collapse.in").removeClass("in");
        $(this).find(".arrowRight").hide();
        $(this).find(".arrowDown").show();

    }


});
$(".product_view").on('click',function (){
    var currDiv=$(this).siblings(".product_info.hidden").first();
    if(currDiv !=undefined){
        $(currDiv).removeClass("hidden");
        $(this).attr('href','#'+$(currDiv).attr("id"));
    }
    else{
        $(this).hide();

    }
});

$(".promotion-category").on('click',function(e){
    if($(this).find(".disable-category").length==0){
        $(".promotion-category").removeClass("active-promotion-category");
        $(this).addClass("active-promotion-category");
        e.preventDefault();
    }

});

$(document).bind('cbox_complete', function(){
	$.colorbox.resize();
});

///   window load function for sign in overlay
$( window ).on( "load", function() {
    var loginErrorMsg = $("#loginErrorMsg").val();
    let creditCodeError = $("#creditCodeError");
    let localizedBranch = $("#localizedBranch");
    let trackBranch = $("#trackBranch").val();
    let localizedstore = $("#localized-store").val();
    if (creditCodeError.length) {
        ACC.colorbox.open($("#logo-svg").html(), {
            html: creditCodeError.html(),
            width: "900px",
            escKey: false,
            overlayClose: false,
            close: '',
            className: "text-center",
            onComplete: function (e) { },
            onClosed: function (e) { window.location.href = ACC.config.encodedContextPath + "/"; }
        });
    }
    else if (localizedBranch.length && trackBranch != "" && localizedstore != "" && trackBranch != localizedstore) {
        setTimeout(function(){
        ACC.colorbox.open('', {
            html: localizedBranch.html(),
            width: "600px",
            escKey: true,
            overlayClose: true,
            close: '<span class="glyphicon glyphicon-remove"></span>',
            className: "text-center localized-branch",
            onComplete: function (e) { }
        });
    }, 500)
    }
    else if(loginErrorMsg != null && loginErrorMsg != "" && loginErrorMsg !== undefined )
    {
        if(loginErrorMsg != " " && sessionStorage.getItem("logintobuy")==="false")
        {
            ACC.colorbox.open("", {
                html: $("#signinId").html(),
                width: "1200px",
                escKey: false,
                overlayClose: false,
                close:'<span class="glyphicon glyphicon-remove"></span>',
                className: "login-product-detail",
                onComplete: function(e) {
                	setTimeout(function(){
    		        	$('.login-product-detail').eq(1).css({opacity: 1, display: 'none'}).fadeIn();
    		        }, 300)
    		        
                    $("#cboxClose").click(function(){
                        window.location = "/";
                    });
                },
            });
        }
		else if(loginErrorMsg != " " && sessionStorage.getItem("logintobuy")==="true"){
              ACC.colorbox.open("", {
            	html: $("#signinId-hidecsp").html(),
            	width: "1320px",                    
            	close:'<span class="glyphicon glyphicon-remove"></span>',
                escKey: false,
                overlayClose: false,
                className: "hidecsp-overlay",
				height: "420px",
                onComplete: function(e) {
                    $("#cboxClose").click(function(){
                        window.location = "/";
                    });
                },
				onClosed: function(e){
					$("#colorbox").removeClass("hidecsp-overlay");
				}
            });
		}
    }
    /// link to anchor tag on load
    if(location.hash) location.href = location.hash;
    
    if($(".page-linktopayverification").length){    //link 2 pay loading
        setTimeout(function () {
            loading.stop();
        }, 2000);
        $(".step-body").css("opacity", 1);
    }
});


$(".promotionName").on('click',function(){

    $(".promotionName").parents("li").removeClass("active");
    $(this).parents("li").addClass("active");


});
$(".promotion-category").first().addClass("active-promotion-category");
$(".promotionName").first().parents("li").addClass("active");


$(function() {
    $('.faq-links').each(function() {
        if($(this).find('a').attr('href') == window.location.pathname) {
            $(this).addClass('active-link');
        }
    });
});

$('.inspireSortOrder').on('change', function() {
    var sortOrder = $(this).val();
    console.log(sortOrder);
    var url = ACC.config.encodedContextPath + "/inspire?sortOrder="+sortOrder;
    window.location.href = url;

});

$(document).ready(function() {
    var text_max;
    if($('#contactUsMessage').length!=0){
        var text_max= $('#contactUsMessage').val();
    }
    else {
        var text_max = 200;
    }
    if($('#message').length!=0)
    {
        var text_length = $('#message').val().length;
        var text_remaining = text_max - text_length;
    }
    if(text_length!=0)
    {
        $('#message_feedback').html(ACC.config.remaining +text_remaining + ACC.config.characters);
        if(text_remaining==0)
        {
            $('#message_feedback').css("color","red");
        }
    }
    else
    {
        $('#message_feedback').html(ACC.config.remaining +text_max + ACC.config.characters);
    }

    $('#message').on('keyup',function () {
        var text_length = $('#message').val().length;
        var text_remaining = text_max - text_length;
        if(text_remaining==0)
        {
            $('#message_feedback').css("color","red");
        }
        else
        {
            $('#message_feedback').css("color","#999");
        }
        $('#message_feedback').html(ACC.config.remaining + text_remaining + ACC.config.characters);
    });
		if($('#User_Agent').val()==="SiteOneEcomApp") {
			$(".hideelementforapp").addClass("hidden");
		}
});

loading = {
    start : function() {
        if($('#floatBarsG').length) {
            return;
        }
        var loadingHtml = ['<div id="floatBarsG">',
            '<div id="floatBarsG_1" class="floatBarsG"></div>',
            '<div id="floatBarsG_2" class="floatBarsG"></div>',
            '<div id="floatBarsG_3" class="floatBarsG"></div>',
            '<div id="floatBarsG_4" class="floatBarsG"></div>',
            '<div id="floatBarsG_5" class="floatBarsG"></div>',
            '<div id="floatBarsG_6" class="floatBarsG"></div>',
            '<div id="floatBarsG_7" class="floatBarsG"></div>',
            '<div id="floatBarsG_8" class="floatBarsG"></div>',
            '</div>',
            '<div id="loadingOverlay"></div>'].join('');
        $('body').append(loadingHtml);
    },
    stop: function() {
        $('#floatBarsG, #loadingOverlay').remove();
    }
}

function loginSubmitOnce(){
    $("form[action*='j_spring_security_check']").on("submit", function(e){
        var submitButton = $(this).find('button');
        submitButton.attr('disabled', 'disabled');
        setTimeout(function(){
            submitButton.removeAttr('disabled');
        }, 30000);
    });
}

function addToCartLTB(){
	if ("true" === $.cookie("loginToBuyCk") && $(".js-atc-"+sessionStorage.getItem("loginToBuyATC")).is(":disabled")===false){
        $(".js-atc-"+sessionStorage.getItem("loginToBuyATC")).click();
		$.cookie("loginToBuyCk", "", { path: '/' });
      }
}
$(document).ready(function() {
    loginSubmitOnce();
    setTimeout(function(){loginSubmitOnce();}, 750);
    setTimeout(function(){addToCartLTB();}, 850); 
});
$(document).ready(function() {
    if($('body').hasClass('page-siteonehomepage') && sessionStorage.getItem('updateAccount')==='true'){
        sessionStorage.removeItem('updateAccount') 
        if(screen.width>=1024){
            setTimeout(function(){
                $('.headerWelcome').click()
                setTimeout(function(){
                    $('#headerShipToBtn').click()   
                },500)
            },500)
        }
        else{
            setTimeout(function(){                
                $('.mobile__nav__row--btn').trigger('click')
                setTimeout(function(){                   
                    $('.js_nav__link--drill__down').click()   
                },500)
            },500)
        
        }       
    }
    
})
$(document).on("click", "#cboxLoadedContent #loginsubmitPopup", function (e) {
    sessionStorage.setItem("logintobuy", $(e.target).closest("#colorbox").hasClass("hidecsp-overlay"));
    var url = sessionStorage.getItem("checkoutlogin");
    if (url != null) {
        $('#loginForm').attr('action', sessionStorage.getItem('checkoutlogin'));
        sessionStorage.removeItem('checkoutlogin');
    }
});
$(document).on("click", ".signInOverlay", function(){
    loginSubmitOnce();
    setTimeout(function(){loginSubmitOnce();}, 750);
});

$(document).ready(function() {
    /** Curatedplp Horizondal Scroll start**/
    if(document.getElementById("desktophorizondalscroll") != null && document.getElementById("desktophorizondalscroll") != undefined){
        if(screen.width <= 639){
          var curatedplphsmobile = 10;
          while(curatedplphsmobile > 0){
            const element = document.getElementById("desktophorizondalscroll"); 
            if(element != null && element != undefined){
            element.remove();
            curatedplphsmobile = curatedplphsmobile - 1;
            }
            else{
              break;
            }
          }
        }
      }
        /** Curatedplp Horizondal Scroll End**/
  if(screen.width>=1024 && $(".bottom-banner .bottom-video-container").length){
  $(".bottom-banner-img").css("height",$(".bottom-banner .bottom-video-container").height())
  }
  var getURL = window.location.href;
  var urlCase = getURL.toLowerCase();

  // App suggestion
  var isIOS = ( navigator.userAgent.match(/(iPad|iPhone)/i) ? true : false );
  var isAndroid = navigator.userAgent.indexOf("Android") > -1;
       

  if((isIOS || isAndroid) && sessionStorage.getItem("showAppSuggestion") !=="false" && $('#User_Agent').val()!="SiteOneEcomApp"
	  && $.cookie('isMobileApp') != "true"){
      if ($.cookie('banner_shown') == null && urlCase.indexOf('cid=') == -1) {
          $.cookie('banner_shown', 'yes', { expires: 14, path: '/' });
          $('.native-banner').removeClass("hide");
          $(document).on("click", ".app-download", function () {
            var anchorTag = $(this).find('a');
              if (isIOS) {
                var iosURL = $('#appStoreUrlId').val();
                anchorTag.attr('href', iosURL);
              } else if (isAndroid) {
                var androidURL = $('#playStoreUrlId').val();
                anchorTag.attr('href', androidURL);
              }
              anchorTag[0].click();
              sessionStorage.setItem("showAppSuggestion", "false");
              $('.native-banner').addClass("hide");
          });
      }
                }

});

$(document).ready(function() {
    document.cookie = "clientURL=" + window.location.href;
    !function (w, d) {
        if (!w.rdt) {
            var p = w.rdt = function () {
                p.sendEvent ? p.sendEvent.apply(p, arguments) : p.callQueue.push(arguments)
            };
            p.callQueue = [];
            var t = d.createElement("script");
            t.src = "https://www.redditstatic.com/ads/pixel.js", t.async = !0;
            var s = d.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(t, s)
        }
    }(window, document);
    rdt('init', 'a2_eag8k29zexvh');
    rdt('track', 'PageVisit');
});

//Custom tool tip

$( function()
{
    var targets = $( '[rel~=custom-tooltip]' ),
        target  = false,
        newTooltip = false,
        title   = false;
 
    targets.bind( 'mouseenter', function()
    {
        target  = $( this );
        tip     = target.find(".tooltip-content").html();
        newTooltip = $( '<div id="custom-tooltip"></div>' );
 
        if( !tip || tip == '' )
            return false;
 
        target.removeAttr( 'title' );
        newTooltip
               .html( tip )
               .appendTo( 'body' );
 
        var init_tooltip = function()
        {
            if( $( window ).width() < newTooltip.outerWidth() * 1.5 )
                newTooltip.css( 'max-width', 250 );
            else
                newTooltip.css( 'max-width', 340 );
 
            var pos_left = target.offset().left + ( target.outerWidth() / 2 ) - ( newTooltip.outerWidth() / 2 ),
                pos_top  = target.offset().top - newTooltip.outerHeight() - 20;
 
            if( pos_left < 0 )
            {
                pos_left = target.offset().left + target.outerWidth() / 2 - 20;
                newTooltip.addClass( 'left' );
            }
            else
                newTooltip.removeClass( 'left' );
 
            if( pos_left + newTooltip.outerWidth() > $( window ).width() )
            {
                pos_left = target.offset().left - newTooltip.outerWidth() + target.outerWidth() / 2 + 20;
                newTooltip.addClass( 'right' );
            }
            else
                newTooltip.removeClass( 'right' );
 
            if( pos_top < 0 )
            {
                var pos_top  = target.offset().top + target.outerHeight();
                newTooltip.addClass( 'top' );
            }
            else
                newTooltip.removeClass( 'top' );
 
            newTooltip.css( { left: pos_left, top: pos_top } )
                   .fadeIn( "slow");
        };
 
        init_tooltip();
        $(newTooltip).siblings('#custom-tooltip').each(function(){
            $(this).remove();
        })
        $( window ).resize( init_tooltip );
 
        var remove_tooltip = function()
           {   
        	setTimeout(function(){
                 if(newTooltip.hasClass("active")===false){
                    newTooltip.css( "display","none")
                  }
            },500);   
            //target.attr( 'title', tip );  
            };
 
        target.bind( 'mouseleave',remove_tooltip);
        newTooltip.bind( 'click', remove_tooltip );
    });
    
    $(document).on("mouseenter","#custom-tooltip",function(){
        $(this).fadeIn("fast").addClass("active")

    })
    $(document).on("mouseleave","#custom-tooltip",function(){
        $(this).fadeOut("fast").removeClass("active")
        if(newTooltip.hasClass("active")===false){
            $(this).css( "display","none");     
        }
    })
});
 
//Custom tool tip ends

// Function to fire click tracking url on click of recommended products
function clickTracking(obj){
	var clickTrackingURL = $(obj).find('#clickTrackingURL').val();
	if(clickTrackingURL!=''){
		$.ajax({
			async: false,			
			url: clickTrackingURL
		});
	}
	return true;
}
ACC.hopdebug = {

	bindAll: function ()
	{
		this.bindShowDebugMode();
	},

	bindShowDebugMode: function ()
	{
		var debugModeEnabled = $('#hopDebugMode').data("hopDebugMode");
		
		if (!debugModeEnabled && !$('#showDebugPage').val())
		{
			$('#hostedOrderPagePostForm').submit();
		}
	}
};


$(document).ready(function ()
{
	ACC.hopdebug.bindAll();
});
/* Youtube analytics*/
var player;
var players=[];
var zeroWatched;
var oneFourthWatched;
var halfWatched;
var threeFourthWatched;
var listWatched;
/* Youtube analytics variables*/

ACC.imagegallery = {

	_autoload: [
		"bindImageGallery",
		"bindGalleryPopup",
		"openImageZoom",
			],
	resetWatchPercentage: function () {
		/*reset watch percentage when the video ends*/
		zeroWatched = false;
		oneFourthWatched = false;
		halfWatched = false;
		threeFourthWatched = false;
		listWatched = false;

		/*--reset watch percentage when the video ends--*/
	},
	openVideoIframe: function (ytUrl) {

		$('a.popup-big-image').trigger('zoom.destroy');
		$(".popup-enlarged-image").addClass("hidden");
		$(".popup-hover--message").addClass("hidden");
		$(".pdp-video-responsive").removeClass("hidden");
		$('a.popup-big-image').addClass("hidden");
		$("#cboxLoadedContent .pdp-video-responsive iframe").remove()
		$('<iframe id="popupIframe" class="popup-video-iframe" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0"  src=""></iframe>').attr("src", ytUrl).appendTo("#cboxLoadedContent .pdp-video-responsive");
		var videoIframeId = $("#cboxLoadedContent .pdp-video-responsive iframe").attr("id");
		ACC.imagegallery.resetWatchPercentage();
		ACC.imagegallery.onYouTubeIframeAPIReady(videoIframeId);

	},
	openImageZoom: function (zoomImage, largeImage) {
		$("#cboxLoadedContent .pdp-video-responsive iframe").attr("src", "");
		$('a.popup-big-image').css("display", "inline-block")
		$(".popup-enlarged-image").attr("src", largeImage).removeClass("hidden");
		$(".popup-hover--message").removeClass("hidden");
		$('a.popup-big-image').removeClass("hidden");
		$(".js-click-here-to-zoom").data("assistive-large-img-url", largeImage);
		$(".js-click-here-to-zoom").data("assistive-zoom-img-url", zoomImage);
		if($('body').hasClass("un-assistive")){
			$(".js-click-here-to-zoom").parent().removeClass('hidden');
		}
    else{
      $(".js-click-here-to-zoom").parent().addClass('hidden');
    }
		$.colorbox.resize();
		$('a.popup-big-image').zoom({
			url: zoomImage, 
			on: 'mouseover'

			});
	},
	showTitleInPopup:function(element){
		$(element).slice(1).remove();
		$(element).removeClass("hidden");
	},
	galleryPopup:function(largeImage, zoomImage, videoUrl, variantPopup, _curEle){
    var curContainer = $(".gallery-popup-container").html();
    if(variantPopup) {
        $('.gallery-popup-container-variant').find('.photo-thumbnails')
            .html($(_curEle).find('.photoThumbImage').html());
        curContainer = $(".gallery-popup-container-variant").html();
    } else {
        curContainer = $(".gallery-popup-container").html();
    }

    ACC.colorbox.open("", {
        html: curContainer,
        className: 'cb-image-popup',
        close: '<span class="close-menu"></span>',
        onOpen: function(){
            $('.zoom-image-overlay').remove();
        },

        onComplete: function(){
            $(document).ready(function () {
                $('#cboxTitle').hide();
                $('#cboxLoadedContent').attr("style", "margin-top:0px !important");
                ACC.imagegallery.showTitleInPopup("#cboxLoadedContent .popup-gallery-thumbnail");
                ACC.imagegallery.showTitleInPopup("#cboxLoadedContent .popup-video-thumbnail");

                
                if (videoUrl === "" || videoUrl === undefined || videoUrl === null) {
                    ACC.imagegallery.openImageZoom(zoomImage, largeImage);
                } else {
                    ACC.imagegallery.openVideoIframe(videoUrl + ACC.config.youTubeQueryParams);
                }

              
                setTimeout(function(){
                    var $thumbs = $("#cboxLoadedContent .popup-product-thumb");
                    $thumbs.removeClass("selected");

                    var $target = $();

                
                    if (largeImage) {
                        $target = $("#cboxLoadedContent .popup-product-thumb[data-large-image='" + largeImage + "']");
                    }

                    
                    if (!$target.length && zoomImage) {
                        $target = $("#cboxLoadedContent .popup-product-thumb[data-zoom-image='" + zoomImage + "']");
                    }

                    
                    if (!$target.length && videoUrl) {
                        $target = $("#cboxLoadedContent .video-thumb[data-youtube-url='" + videoUrl + "']");
                    }

                   
                    if (!$target.length) {
                        $target = $("#cboxLoadedContent .popup-thumbnails_0 .popup-product-thumb");
                    }

                    var idx = Number($target.data("index")) || 0;
                    $("#inputdataprev").val(idx);
                    $target.addClass("selected");

                    
                    if (!$target.hasClass("video-thumb")) {
                        var large = $target.data("large-image");
                        var zoom  = $target.data("zoom-image");
                        ACC.imagegallery.openImageZoom(zoom, large);
                    } else {
                        var yt = $target.data("youtube-url");
                        ACC.imagegallery.openVideoIframe(yt + ACC.config.youTubeQueryParams);
                    }

                    $.colorbox.resize();
                }, 0);

              
                $(document).on("click", ".js-click-here-to-zoom", function (e) {
                    e.preventDefault();
                    var assistiveZoomImg = $(".js-click-here-to-zoom").data("assistive-zoom-img-url");
                    var assistiveLargeImg = $(".js-click-here-to-zoom").data("assistive-large-img-url");
                    ACC.colorbox.open("", {
                        html: `<div class="row zoom-image-overlay">
                                 <div class="col-xs-12">
                                   <a href="#" class="cb-back">back</a>
                                 </div>
                                 <div class="col-xs-12">
                                   <img class="img-responsive text-align-center" src="${assistiveZoomImg}" alt=""/>
                                 </div>
                               </div>`,
                        width: '800px',
                        height: '500px',
                        onOpen: function(){ $('.gallery-popup-overlay').remove(); },
                        onComplete: function () {
                            setTimeout(function(){ $.colorbox.resize(); }, 1000);
                            $(document).on("click", "#cboxContent .cb-back", function () {
                                ACC.imagegallery.galleryPopup(assistiveLargeImg, assistiveZoomImg, "")
                            });
                        }
                    });
                });
            });
        },

        onClosed: function() {
            
            $(".pdp-video-responsive").addClass("hidden");
            $('a.popup-big-image').removeClass("hidden");
            $(".js-click-here-to-zoom").parent().addClass('hidden');

            
            $("#inputdataprev").val(0);
        }
    });
},
	bindImageGallery: function (){
		
		function currentCarouselImage(currentItem,itemsAmount){
			$(".pdp-current-item").text(currentItem+1);
			$(".pdp-total-item").text(itemsAmount);
			$(".owl-item.active").find(".launch-image-popup .lazyOwl").css("display","block")
			$(".owl-item").not(".active").find(".launch-image-popup .lazyOwl").css("display","block")
		}
		
		$(".js-gallery").each(function(){
			var $image = $(this).find(".js-gallery-image");
			var $carousel = $(this).find(".js-gallery-carousel")
			var imageTimeout;

			
			$image.owlCarousel({
				singleItem : true,
				pagination:true,
				navigation:true,
				lazyLoad:true,
				addClassActive:true,
				pdpImageCarousel: true,
				navigationText : ["<span class='glyphicon glyphicon-chevron-left'></span>", "<span class='glyphicon glyphicon-chevron-right'></span>"],
				afterAction : function(){
					ACC.imagegallery.syncPosition($image,$carousel,this.currentItem)
					$image.data("zoomEnable",true);
					currentCarouselImage(this.currentItem,this.itemsAmount)				
				},
				afterInit:function(e){
					currentCarouselImage(this.currentItem,this.itemsAmount)	
				},
				
				startDragging: function(e){
					
					$image.data("zoomEnable",false)
				},
				afterLazyLoad:function(e){

					var b = $image.data("owlCarousel") || {}
					if(!b.currentItem){
						b.currentItem = 0
					}

					var $e = $($image.find("img.lazyOwl")[b.currentItem]);
					if ($e.hasClass("disable-zoom") === false) {
						startZoom($e.parent())
					}
				}
			});


			$carousel.owlCarousel({
				navigation:true,
				navigationText : ["<span class='glyphicon glyphicon-chevron-left'></span>", "<span class='glyphicon glyphicon-chevron-right'></span>"],
				pagination:false,
				items:2,
				itemsDesktop : [5000,7], 
				itemsDesktopSmall : [1200,5], 
				itemsTablet: [768,4], 
				itemsMobile : [480,3],
				lazyLoad:true,
				afterAction : function(){

				},
			});


			$carousel.on("click","a.item",function(e){
				e.preventDefault();
				if($(this).hasClass("exceeded")===false){
				$image.trigger("owl.goTo",$(this).parent(".owl-item").data("owlItem"));
				}
				else {
					var firstZoomImage=$(this).data("first-zoom-image");
					var firstLargeImage=$(this).data("first-src");
					var firstVideoUrl=$(this).data("first-video-url");
					ACC.imagegallery.galleryPopup(firstLargeImage,firstZoomImage,firstVideoUrl);
				}
			})



			function startZoom(e){	
				
				if(($(window).width()) <= 600)
					{
						var device = (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()));
						if(device == true) {
							return false;
						}
					}
				$(e).zoom({
					url: $(e).find("img.lazyOwl").data("zoomImage"),
					touch: true,
					on: "grab",
					touchduration:300,

					onZoomIn:function(){
					
					},

					onZoomOut:function(){
						var owl = $image.data('owlCarousel');
						owl.dragging(true)
						$image.data("zoomEnable",true)
					},

					zoomEnableCallBack:function(){
						var bool = $image.data("zoomEnable")

						var owl = $image.data('owlCarousel');
						if(bool==false){
							owl.dragging(true)
						}
						else{

						 	owl.dragging(false)
						}
						return bool;
					}
				});
			}
		})
	},
	carouselGalleryPdp: function(ref,index,formateVal) {
		$('#inputdataprev').val(index);
	},
	caroselGalleryprevnext: function(ref,carouselClick) {
			target = $(ref);
			index = $('#inputdataprev').val();
			galleryCount = $('#galleryImageCount').val();
			indexdata = index;
			if(index > 0 && Number(index) < galleryCount){
				if(carouselClick == 'prev'){
					index = Number(index) - 1;
				}
				if(carouselClick == 'next'){
					index = Number(index) + 1;
				}
			}
			if(index == 0 &&  indexdata != 1){
                if(carouselClick == 'next'){
					index = Number(index)+ 1;}
                if(carouselClick == 'prev'){
					index = galleryCount-1;}
            }
    		if(index == galleryCount){index=0;}
			$('#inputdataprev').val(index);
			var imgThumbnail=$(".popup-thumbnails_"+index).find(".popup-product-thumb");
			$(".popup-product-thumb").removeClass("selected");
			imgThumbnail.addClass("selected");
			if(imgThumbnail.hasClass("video-thumb")=== false){
				$(".pdp-video-responsive").addClass("hidden");
				var largeImageUrl=imgThumbnail.data("large-image");
				var zoomImageUrl=imgThumbnail.data("zoom-image");
				$(".popup-enlarged-image").attr("src",largeImageUrl).removeClass("hidden");
				$(".popup-hover--message").removeClass("hidden");
				$('a.popup-big-image').addClass("hidden");
				$.colorbox.resize();
				ACC.imagegallery.openImageZoom(zoomImageUrl,largeImageUrl);	
			}
			else{	
				var youtubeURL=$(".popup-thumbnails_"+index).find(".video-thumb").data("youtube-url");
				ACC.imagegallery.openVideoIframe(youtubeURL+ACC.config.youTubeQueryParams);
				$.colorbox.resize();	
			}
	},

	bindGalleryPopup: function() {
		$(document).on("click", ".launch-image-popup", function(e) {
            if($(this).find(".lazyOwl").length > 0){
                var zoomImage=$(this).find(".lazyOwl").data("zoom-image");
                var largeImage=$(this).find(".lazyOwl").data("src");
                var videoUrl=$(this).find(".lazyOwl").data("video-url");
                ACC.imagegallery.galleryPopup(largeImage,zoomImage,videoUrl);   
            }
            else{               
                var zoomImage=$('.image-inner-wrapper.launch-image-popup').find(".lazyOwl").data("zoom-image");
                var largeImage=$('.image-inner-wrapper.launch-image-popup').find(".lazyOwl").data("src");
                var videoUrl=$('.image-inner-wrapper.launch-image-popup').find(".lazyOwl").data("video-url");
                ACC.imagegallery.galleryPopup(largeImage,zoomImage,videoUrl);   
            }  
			
		})
		$(document).on("click", ".launch-image-popup-variant", function(e) {
            if($(this).find(".lazyOwl").length > 0){
                var zoomImage=$(this).find(".lazyOwl").data("zoom-image");
                var largeImage=$(this).find(".lazyOwl").data("src");
                var videoUrl=$(this).find(".lazyOwl").data("video-url");
                ACC.imagegallery.galleryPopup(largeImage,zoomImage,videoUrl,true,this);   
            }
            else{               
                var zoomImage=$('.image-inner-wrapper.launch-image-popup-variant').find(".lazyOwl").data("zoom-image");
                var largeImage=$('.image-inner-wrapper.launch-image-popup-variant').find(".lazyOwl").data("src");
                var videoUrl=$('.image-inner-wrapper.launch-image-popup-variant').find(".lazyOwl").data("video-url");
                ACC.imagegallery.galleryPopup(largeImage,zoomImage,videoUrl,true,this);   
            }  
			
		})
		$(document).on("click", ".popup-thumbnails", function(e) {
				e.preventDefault();
				var imgThumbnail=$(this).find(".popup-product-thumb");
				$(".popup-product-thumb").removeClass("selected");
				imgThumbnail.addClass("selected");
				if(imgThumbnail.hasClass("video-thumb")=== false){
				$(".pdp-video-responsive").addClass("hidden");
				var largeImageUrl=imgThumbnail.data("large-image");
				var zoomImageUrl=imgThumbnail.data("zoom-image");
				$(".popup-enlarged-image").attr("src",largeImageUrl).removeClass("hidden");
				$(".popup-hover--message").removeClass("hidden");
				$('a.popup-big-image').addClass("hidden");
				$.colorbox.resize();
				ACC.imagegallery.openImageZoom(zoomImageUrl,largeImageUrl);
				
			}
			else{
				
				var youtubeURL=$(this).find(".video-thumb").data("youtube-url");
				ACC.imagegallery.openVideoIframe(youtubeURL+ACC.config.youTubeQueryParams);
				$.colorbox.resize();
				
			}
		})
	},
	syncPosition: function($image, $carousel, currentItem) {
		$carousel.trigger("owl.goTo", currentItem);
	},

	onYouTubeIframeAPIReady: function (videoIframeId) {
		if (videoIframeId) {
			player = new YT.Player(videoIframeId, {
				events: {
					'onReady': ACC.imagegallery.onPlayerReady,
					'onStateChange': ACC.imagegallery.onPlayerStateChange
				}
			});
			players.push({player:player,isStopped:false});
		}
	},

	
	youTubeData: function(name,id,player,trackData){
		digitalData.eventData = {
			videoName: name,
			videoID: id,
			videoPlayer: player
		}
		try {
			_satellite.track(trackData);
		} catch (e) { }
	},
	
	onPlayerStateChange: function (event) {

		var playerStatus = event.data;
		var playerName = "youtube"
		var playerData = event.target.getVideoData();
		switch (playerStatus) {
			case 0: {
				if (!event.target.getVideoData().list) {
					ACC.imagegallery.youTubeData(playerData.title, playerData.video_id, "Youtube", "videoComplete");
				}

				ACC.imagegallery.resetWatchPercentage();
				console.log("ended");
				break;
			}

				case 1: {

				setInterval(ACC.imagegallery.showPercentage, 50, event);
				if (Math.round(event.target.getCurrentTime()) > 1) {
					ACC.imagegallery.youTubeData(playerData.title, playerData.video_id, "Youtube", "videoResume");
					console.log("Resume");
				}

				break;
			}

			case 2: {

				ACC.imagegallery.youTubeData(playerData.title, playerData.video_id, "Youtube", "videoPause");
				console.log("Paused");
			    if($(event.target.g).hasClass("marketing-videos")){
					ACC.imagegallery.resetWatchPercentage();
				}
				break;
			}
		}

	},
	showPercentage: function (videoEvent) {
		var percent = 0;
		var currentTime = !videoEvent.target.getCurrentTime ? 0.0 : videoEvent.target.getCurrentTime();
		var totalDuration = !videoEvent.target.getDuration ? 0.0 : videoEvent.target.getDuration();
		var playerDetails = videoEvent.target.getVideoData();
		percent = Math.ceil((currentTime / totalDuration) * 100);

		switch (percent) {
			case 1: {

				if ($(videoEvent.target.h).hasClass("marketing-videos")) {

					var currentUrl = videoEvent.target.h.src;
					for (var i = 0; i < players.length; i++) {
						if (players[i].player.h.src != currentUrl && players[i].isStopped===true) {
							players[i].player.stopVideo();
							players[i].isStopped=false;

						}
						else if(players[i].player.h.src == currentUrl && players[i].isStopped===false){
							players[i].isStopped=true;
							ACC.imagegallery.resetWatchPercentage();
						}

					}

				}
				if (zeroWatched === false) {
					console.log("started");
					ACC.imagegallery.youTubeData(playerDetails.title, playerDetails.video_id, "Youtube", "videoStart");
					zeroWatched = true;
				}
				break;
			}
			case 25: {
				if(oneFourthWatched ===false){
				console.log("25");
				ACC.imagegallery.youTubeData(playerDetails.title,playerDetails.video_id,"Youtube","videoMilestone25");
				oneFourthWatched =true;
				}
				break;
			}
			case 50: {
				if(halfWatched===false){
				console.log("50");
				ACC.imagegallery.youTubeData(playerDetails.title,playerDetails.video_id,"Youtube","videoMilestone50");
				halfWatched=true
			}
				break;
			}
			case 75: {
				if(threeFourthWatched===false){
				console.log("75");
				ACC.imagegallery.youTubeData(playerDetails.title,playerDetails.video_id,"Youtube","videoMilestone75");
				threeFourthWatched=true;
			}
				break;
			}
			case 99: {
				if (listWatched === false) {
					if (videoEvent.target.getVideoData().list) {
						ACC.imagegallery.youTubeData(playerDetails.title, playerDetails.video_id, "Youtube", "videoComplete");
						listWatched = true;
					}
			}
				break;
			}
		}
	},
	videoAnalyticsFlag: true,
	videoAnalyticsAdd() {
		$(".marketing-videos").each(function (e) {
			let target = $(this);
			let targetParent = target.parent();
			targetParent.html();
			let videoWidth = target.attr("width");
			let videoHeight = target.attr("height");
			let videoAllow = target.attr("allow");
			let videoId = target.attr("id");
			let videoTitle = target.attr("title");
			let videoSrc = target.attr("src");
			targetParent.html('<iframe width="' + videoWidth + '" height="' + videoHeight + '" allow="' + videoAllow + '" allowfullscreen="" class="marketing-videos" title="' + videoTitle + '" frameborder="0" id="' + videoId + '" onload="ACC.imagegallery.videoAnalyticsCapture(this)" data-videonum="' + e + '" src="' + videoSrc + '" ></iframe>');
		});
	},
	videoAnalyticsCapture(element) {
		$(document).ready(function () {
			if ($(element).hasClass("marketing-videos")) {
				var elemId = $(element).attr("id");
				ACC.imagegallery.resetWatchPercentage();
				ACC.imagegallery.onYouTubeIframeAPIReady(elemId);
			}
		});
	},
	thumnailGalleryImagePDP: function (btn){
				totalGalleryImage = $('#totalGalleryImage').val();
				nextBtnValue = $('#nextBtnValue').val();
				startIndex = $('#startIndex').val();
				if(btn == 'down'){
					$('.down-arrow-icon').removeClass('disabled');
					if(nextBtnValue < Number(totalGalleryImage) + 1){
						$("#galleyImageItem_"+Number(nextBtnValue)).removeClass('hidden');
						$("#galleyImageItem_"+Number(startIndex)).addClass('hidden');
						$("#startIndex").val(Number(startIndex)+1);
						$("#nextBtnValue").val(Number(nextBtnValue)+1);	
						$('.up-arrow-icon').removeClass('disabled');
					}
					if($('#nextBtnValue').val() >= Number(totalGalleryImage) + 1){
						$('.down-arrow-icon').addClass('disabled');
					}
				}
				if(btn == 'up'){
					if(startIndex != 1){
						$('.down-arrow-icon').removeClass('disabled');
						$("#startIndex").val(Number(startIndex)-1);
						 $("#nextBtnValue").val(Number(nextBtnValue)-1);	
						nextBtnValue = $('#nextBtnValue').val();
						startIndex = $('#startIndex').val();
						$("#galleyImageItem_"+Number(nextBtnValue)).addClass('hidden');
						$("#galleyImageItem_"+Number(startIndex)).removeClass('hidden');
					}
					if(startIndex == 1){
						$('.up-arrow-icon').addClass('disabled');
					}
				}
			},
	mainImageGallery: function(index){
		$(".js-gallery").find(".js-gallery-image").trigger("owl.goTo",index-1);
	},
			
	
},

$(document).ready(function () {
	$(".overlay-text-visible").attr("style", "");

	var tag = document.createElement('script');
	tag.id = 'iframe-demo';
	tag.src = 'https://www.youtube.com/iframe_api';
	var firstScriptTag = document.getElementsByTagName('script')[0];
	firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
})
function marketingVideoAnalytics(element) {
	if($(element).hasClass("marketing-videos") && ACC.imagegallery.videoAnalyticsFlag){
		ACC.imagegallery.videoAnalyticsFlag = false;
		ACC.imagegallery.videoAnalyticsAdd();
	}
}
ACC.langcurrency = {

	_autoload: [
		"bindLangCurrencySelector"
	],

	bindLangCurrencySelector: function (){
//		$('#lang-selector').on('change',function (){
//			$('#lang-form').submit();
//		});
		$(document).on('click','.language-value', function(e) {
			$('.language-dropdown').toggleClass('active');
		});
		$(document).on('click', '.lang-item', function (e) {
			let target = $(e.target).closest('.lang-item')
			let selectedLang = target.attr('data-value');
			let currentLanguage = '';
			if ($(".language-es").length) {
				currentLanguage = 'es';
			}else {
				currentLanguage = 'en';
			}
			if(currentLanguage != selectedLang) {
				$('input[name=code]').val(selectedLang);
				$('#lang-form').submit();
			}else{
				e.stopPropagation();
				$('.language-dropdown').removeClass('active');
			}
		})

		$('#currency-selector').on('change',function (){
			$('#currency-form').submit();
		});
	}
};
ACC.minicart = {

    _autoload: [
        "bindMiniCart"
    ],
    
    bindMiniCart: function(){

        $(document).on("click",".js-mini-cart-link", function(e){
            e.preventDefault();

            if($('#checkout-cart-link').length) {
                window.location.href = ACC.config.encodedContextPath + '/cart';
                return;
            }

            var url = $(this).data("miniCartUrl") + "?v=" + Date.now();
            var cartName = ($(this).find(".js-mini-cart-count").html() != 0) ? $(this).data("miniCartName"):$(this).data("miniCartEmptyName");
            loading.start();
            ACC.colorbox.open("",{
                href: url,
                maxWidth:"100%",
                width:"621px",
                overflow:"hidden",
                initialWidth :"380px",
                onComplete:function(){ 
                    $("#cboxContent").addClass("mini-cart-page");
                    $("#colorbox").addClass("mini-cart-colorbox");
                    loading.stop();
                }
            });
        });

        $(document).on("click",".js-mini-cart-close-button", function(e){
            $("#cboxContent").removeClass("mini-cart-page");
            $("#colorbox").removeClass("mini-cart-colorbox");
            e.preventDefault();
            ACC.colorbox.close();
            ACC.minicart.updateMiniCartDisplay();
        });
    },
    
    updateMiniCartDisplay: function(){
        var cartItems = $(".mini-cart-link").data("miniCartItemsText");
        var miniCartRefreshUrl = $(".mini-cart-link").data("miniCartRefreshUrl");
        $.ajax({
            url: miniCartRefreshUrl,
            cache: false,
            type: 'GET',
            success: function(jsonData){
            	$('#cartCountId').val(jsonData.miniCartCount);
                $(".mini-cart-link .js-mini-cart-count").html('<span class="nav-items-total">' + jsonData.miniCartCount + '</span>' ); }
           
        });
    }

};
var oDoc = document;

ACC.navigation = {

    _autoload: [
        "offcanvasNavigation",
        "myAccountNavigation",
        "orderToolsNavigation",
        "footerNav",
        "hoverIntentMainMenu"
    ],

    offcanvasNavigation: function(){

        //flyout - extend height of L1 to match L2 height
        $('.L1Categories').hover(function(){
            $('.showCategories').css('height', $(this).find('.L2Categories').height());
        }, function(){
            $('.showCategories').css('height', 'auto');
        });

        enquire.register("screen and (max-width:"+screenSmMax+")", {

            match : function() {
                $(".js-enquire-offcanvas-navigation .js-enquire-has-sub .js_nav__link--drill__down").off();
                $(".js-enquire-offcanvas-navigation .js-enquire-has-sub .js_nav__link--drill__down").bind("click",function(e){
                    e.preventDefault();
                    $(".js-userAccount-Links").hide();
                    $(".js-enquire-offcanvas-navigation ul.js-offcanvas-links").addClass("active");
                    $(".js-enquire-offcanvas-navigation .js-enquire-has-sub").removeClass("active");
                    $(this).closest('.js-enquire-has-sub').addClass('active');
                    
                    
                });
                
                $('.category_item').on('click', function(e){ 
                    var fclick =  true;
                    if(fclick){
                        fclick =  false;
                            e.preventDefault();
                            $(".js-userAccount-Links").hide();
                            $(".js-enquire-offcanvas-navigation ul.js-offcanvas-links").addClass("active");
                            $(".js-enquire-offcanvas-navigation .js-enquire-has-sub").removeClass("active");
                            $(".js-enquire-offcanvas-navigation .js-enquire-has-sub .js_nav__link--drill__down").closest('.js-enquire-has-sub').addClass('active');
                            $('.partner-cat').addClass('active');                           
                          
                    }
                    var getIndex = $(this).index();                  
                    $('.level1-new').find('.l1-img').eq(getIndex).find('.sub-category-new').click();
                });
                
                $('.level1-cat > li .js-L2-nav').on('click', function(e){
                    //$(this).addClass('active');
                    $(this).closest('.level1-cat').addClass('active');
                    $(this).parent().find('.level2-cat').addClass('active');
                });
                $('.level2-cat .js-L2-item').on('click', function(e){
                    if($(this).hasClass("shopall_txt") != true){
                        e.preventDefault();
                        var level2child=$(this).children()[1].value;
                        if(level2child > 0)
                        {
                            $(this).closest('.level2-cat').addClass('selected');
                            $(this).find('.level3-cat').addClass('active');
                        }
                        else{
                    	    window.location.href=$(this).children()[0].href;
                        }
                    }
                });
                $('.js-back-L1').off().on('click', function(e){
                    $(".js-enquire-offcanvas-navigation ul.js-offcanvas-links").removeClass('active');
                    $(this).closest('.js-enquire-has-sub').removeClass('active');
                    $(this).closest('.selected').removeClass('selected');
                    $('.partner-cat').removeClass('active');
                });
                $('.js-back-L2').off().on('click', function(e){
                    $(this).closest('.active').removeClass('active');
                    $(this).closest('.active').removeClass('active');
                    //$('.partner-cat').removeClass('active');
                });
                $('.js-back-L3').off().on('click', function(e){
                    e.stopPropagation();
                    $(this).closest('.active').removeClass('active');
                    $(this).closest('.selected').removeClass('selected');
                });
                $('.level3-cat a').off().on('click', function(e) {
                    e.stopPropagation();
                });
                
                $(document).on("click",".js-enquire-offcanvas-navigation .js-enquire-sub-close",function(e){
                    e.preventDefault();
                    $(this).parent().parent(".js-enquire-has-sub").removeClass("active");
                    //$(".js-userAccount-Links").show();
                    //$(".js-enquire-offcanvas-navigation ul.js-offcanvas-links").removeClass("active");
                    //$(".js-enquire-offcanvas-navigation .js-enquire-has-sub").removeClass("active");
                });
            },

            unmatch : function() {

                
            }


        });

    },

    myAccountNavigation: function(){
        //Add the order form img in the navigation
        $('.nav-form').html($('<span class="glyphicon glyphicon-list-alt"></span>'));


        var aAcctData = [];
        var sSignBtn = "";

        //my account items
        var oMyAccountData = $(".accNavComponent");

        //the my Account hook for the desktop
        var oMMainNavDesktop = $(".js-secondaryNavAccount > ul");

        //offcanvas menu for tablet/mobile
        var oMainNav = $(".navigation--bottom > ul.nav__links.nav__links--products");

        if(oMyAccountData){
            var aLinks = oMyAccountData.find("a");
            for(var i = 0; i < aLinks.length; i++){
                aAcctData.push({link: aLinks[i].href, text: aLinks[i].title});
            }
        }

        var navClose = '';
        navClose += '<div class="close-nav">';
        navClose += '<button type="button" class="js-toggle-sm-navigation btn bold">X</button>';
        navClose += '</div>';
        
       

        //create Sign In/Sign Out Button
        if($(".liOffcanvas a") && $(".liOffcanvas a").length > 0){
            sSignBtn += '<li class=\"auto liUserSign\" ><a class=\"userSign\" href=\"' + $(".liOffcanvas a")[0].href + '\">' + $(".liOffcanvas a")[0].innerHTML + '</a></li>';
        }

        //create Welcome User + expand/collapse and close button
        //This is for mobile navigation. Adding html and classes.
        var oUserInfo = $(".nav__right ul li.logged_in");
        //Check to see if user is logged in
        if(oUserInfo && oUserInfo.length === 1)
        {
            var sUserBtn = '';
            sUserBtn += '<li class=\"auto \">';
            sUserBtn += '<div class=\"userGroup\">';
            sUserBtn += '<span class="glyphicon glyphicon-user myAcctUserIcon"></span>';
            sUserBtn += '<div class=\"userName\">' + oUserInfo[0].innerHTML + '</div>';
            if(aAcctData.length > 0){
                sUserBtn += '<a class=\"collapsed js-nav-collapse\" id="signedInUserOptionsToggle" data-toggle=\"collapse\"  data-target=\".offcanvasGroup1\">';
                sUserBtn += '<span class="glyphicon glyphicon-chevron-up myAcctExp"></span>';
                sUserBtn += '</a>';
            }
            sUserBtn += '</div>';
            sUserBtn += navClose;

            $('.js-sticky-user-group').html(sUserBtn);


            $('.js-userAccount-Links').append(sSignBtn);
            $('.js-userAccount-Links').append($('<li class="auto"><div class="myAccountLinksContainer js-myAccountLinksContainer"></div></li>'));


            //FOR DESKTOP
            var myAccountHook = $('<a class=\"myAccountLinksHeader collapsed js-myAccount-toggle\" data-toggle=\"collapse\" data-parent=".nav__right" href=\"#accNavComponentDesktopOne\">' + oMyAccountData.data("title") + '</a>');
            myAccountHook.insertBefore(oMyAccountData);

            //FOR MOBILE
            //create a My Account Top link for desktop - in case more components come then more parameters need to be passed from the backend
            var myAccountHook = [];
            myAccountHook.push('<div class="sub-nav">');
            myAccountHook.push('<a id="signedInUserAccountToggle" class=\"myAccountLinksHeader collapsed js-myAccount-toggle\" data-toggle=\"collapse\" data-target=".offcanvasGroup2">');
            myAccountHook.push(oMyAccountData.data("title"));
            myAccountHook.push('<span class="glyphicon glyphicon-chevron-down myAcctExp"></span>');
            myAccountHook.push('</a>');
            myAccountHook.push('</div>');

            $('.js-myAccountLinksContainer').append(myAccountHook.join(''));

            //add UL element for nested collapsing list
            $('.js-myAccountLinksContainer').append($('<ul data-trigger="#signedInUserAccountToggle" class="offcanvasGroup2 offcanvasNoBorder collapse js-nav-collapse-body subNavList js-myAccount-root sub-nav"></ul>'));


            //offcanvas items
            //TODO Follow up here to see the output of the account data in the offcanvas menu
            for(var i = aAcctData.length - 1; i >= 0; i--){
                var oLink = oDoc.createElement("a");
                oLink.title = aAcctData[i].text;
                oLink.href = aAcctData[i].link;
                oLink.innerHTML = aAcctData[i].text;

                var oListItem = oDoc.createElement("li");
                oListItem.appendChild(oLink);
                oListItem = $(oListItem);
                oListItem.addClass("auto ");
                $('.js-myAccount-root').append(oListItem);
            }

        } else {
            //var navButtons = (sSignBtn.substring(0, sSignBtn.length - 5) + navClose) + '</li>';
            var navButtons = navClose + '</li>';
            $('.js-sticky-user-group').html(navButtons);

        }
        //guest user
        if(!$('#welcomeOverlay').length ) {
            $('.liOffcanvas').find('a').css('width', '100%');
            $('.js-offcanvas-links')
                .append("<li class='hide-li'>" + $('.liOffcanvas').html() + "</li>");
        }
        $('.js-offcanvas-links')
            .append("<li class='hide-li'>" + $('#js-mobile-flyoutlink').html() + "</li>");
        $('.js-mobile-links').each(function() {
            $('.js-offcanvas-links').append("<li class='hide-li'>" + $(this).html() + "</li>");
        });
        ACC.global.countrySelectEvents();

        //desktop
        for(var i = 0; i < aAcctData.length; i++){
            var oLink = oDoc.createElement("a");
            oLink.title = aAcctData[i].text;
            oLink.href = aAcctData[i].link;
            oLink.innerHTML = aAcctData[i].text;

            var oListItem = oDoc.createElement("li");
            oListItem.appendChild(oLink);
            oListItem = $(oListItem);
            oListItem.addClass("auto col-md-4");
            oMMainNavDesktop.get(0).appendChild(oListItem.get(0));
        }

        //hide and show contnet areas for desktop
        $('.js-secondaryNavAccount').on('shown.bs.collapse', function () {

            if($('.js-secondaryNavCompany').hasClass('in')){
                $('.js-myCompany-toggle').trigger('click');
            }

        });

        $('.js-secondaryNavCompany').on('shown.bs.collapse', function () {

            if($('.js-secondaryNavAccount').hasClass('in')){
                $('.js-myAccount-toggle').trigger('click');
            }

        });

        //change icons for up and down


        $('.js-nav-collapse-body').on('hidden.bs.collapse', function(e){

            var target = $(e.target);
            var targetSpan = target.attr('data-trigger') + ' > span';
            if(target.hasClass('in')) {
                $(targetSpan).removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
            }
            else {
                $(targetSpan).removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
            }

        });

        $('.js-nav-collapse-body').on('show.bs.collapse', function(e){
            var target = $(e.target)
            var targetSpan = target.attr('data-trigger') + ' > span';
            if(target.hasClass('in')) {
                $(targetSpan).removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');

            }
            else {
                $(targetSpan).removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
            }

        });

        //$('.offcanvasGroup1').collapse();
        //Blank space issue fix
        $(document).on("click", ".mobile__nav__row--btn-menu", function (e) {
            document.body.classList.add('max-height-mobile-menu');
        });

    },

    orderToolsNavigation: function(){
        $('.js-nav-order-tools').on('click', function(e){
            $(this).toggleClass('js-nav-order-tools--active');
        });
    },
    footerNav: function() {
        $('.js-footer-dropdown').on('click', function(e) {
            e.stopPropagation();

            var $icon = $(this).find('.glyphicon');

            //apply only for mobile
            if(!$icon.is(':visible')){
                return;
            }

            if($icon.hasClass('glyphicon-triangle-right')) {
                $(this).closest('.footer__nav--container').find('.footer__nav--links').slideDown();
                $icon.removeClass('glyphicon-triangle-right').addClass('glyphicon-triangle-bottom');
            } else {
                $(this).closest('.footer__nav--container').find('.footer__nav--links').slideUp();
                $icon.removeClass('glyphicon-triangle-bottom').addClass('glyphicon-triangle-right');
            }
        });
    },

    hoverIntentMainMenu: function() {
        $(window).on('load resize', function () { 
            var viewportWidth = $(window).width();
            var $menuSubRight = "",
                $menuSubLeft = "";
            if(viewportWidth >= 1000 && viewportWidth < 1200){
                $menuSubRight = $(".js-navigation--middle .L2Categories:not(.SH16,.SH17,.SH11,.SH15)");
                $menuSubLeft = $(".js-navigation--middle .L2Categories.SH16, .js-navigation--middle .L2Categories.SH17, .js-navigation--middle .L2Categories.SH11 ,.js-navigation--middle .L2Categories.SH15");
                $menuSubRight.menuAim("destroy");
                $menuSubLeft.menuAim("destroy");

            } else if(viewportWidth >= 1200) {
                $menuSubRight = $(".js-navigation--middle .L2Categories:not(.SH16,.SH17,.SH15)");
                $menuSubLeft = $(".js-navigation--middle .L2Categories.SH16, .js-navigation--middle .L2Categories.SH17 ,.js-navigation--middle .L2Categories.SH15");
                $menuSubRight.menuAim("destroy");
                $menuSubLeft.menuAim("destroy");
            }
			
			if(viewportWidth >= 1000){
				$menuSubRight.menuAim({
                submenuDirection: "right",
                activate: activateSubmenu,
                deactivate: deactivateSubmenu
            	});
            
           	    $menuSubLeft.menuAim({
                submenuDirection: "left",
                activate: activateSubmenu,
                deactivate: deactivateSubmenu
                });
			}
            
        });
        
        function activateSubmenu(row) {
            var $row = $(row),
                $submenu = $row.find('.L3categoryli');
        
            $row.find('a.L2CatLinks').addClass('hover');
            $submenu.css({display: 'block'});
        }
        
        function deactivateSubmenu(row) {
            var $row = $(row),
                $submenu = $row.find('.L3categoryli');
        
            $row.find('a.L2CatLinks').removeClass('hover');
            $submenu.css('display', 'none');
        }

    }
};
ACC.order = {

	_autoload: [
		"backToOrderHistory",
		"bindMultidProduct",
		"bindPlaceOrder",
		"bindOrderTabs",
		"bindRequestNotesOverlay",
		"onOrderClick",
		"bindOrderQtyBia",
		"showTrackingDetails",
		"searchTabClick",
		["bindOrderDetailEvent", $('.page-order').length || $('.page-invoicedetailspage').length],
    	"tabClicked",
    	"removeSortsession",
    	"shipToApply"
	],

	backToOrderHistory: function () {
		$(".orderBackBtn > button").on("click", function () {
			var sUrl = $(this).data("backToOrders");
			window.location = sUrl;
		});

		if ($(".page-order").length && $(".add_to_cart_form").length) {
			$(".add_to_cart_form").each(function (e) {
				let ref = $(this);
				let target = ref.find("#showAddtoCartUom");
				let prodCode = ref.find('[name="productCodePost"]').val();
				if (target.prop("disabled") &&((ref.find('#stockLevel' + prodCode).val() >= 1 && ref.find('#inStockImage' + prodCode).val() == 'true' && ref.find('#outOfStockImage' + prodCode).val() != 'true' && ref.find("#doesHomeStoreAvail"+prodCode).val()=='true') || (ref.find('#toEnableBuyagain' + prodCode).val() == 'true'))){
					target.prop("disabled", false);
				}
			});
		}
	},

	bindMultidProduct: function () {
		// link to display the multi-d grid in read-only mode
		$(document).on("click", '.js-show-multiD-grid-in-order', function (event) {
			ACC.multidgrid.populateAndShowGrid(this, event, true);
			return false;
		});

		// link to display the multi-d grid in read-only mode
		$(document).on("click", '.showMultiDGridInOrderOverlay', function (event) {
			ACC.multidgrid.populateAndShowGridOverlay(this, event);
		});

	},
	showTrackingDetails: function(){
		if($(window).width()<1023){
			$(".acc-dashboard-mobile-tms .order-shipment-data, .my-orders-mobile-tms .order-shipment-data").removeClass("hidden");
		}
		
		$(document).on("click", '.show-tracking-details', function (event) {
		event.preventDefault();
        var state = $(this).data('state');
        var element = "";
        var productContainer = $(this).closest(".track-order-table__values").find(".transit-product-details");
        var stateText="";
        if($(this).hasClass("xs-product-details")){
        	stateText=ACC.config.orderDetails
        }
		ACC.product.showMoreAndLess(this, state, element, stateText, stateText, 0);
		switch (state) {
			case "expand": {
				
				if($(productContainer).find(".singleorder-product-section").length===0){
				loading.start();
				$(productContainer).removeClass("hidden");
				$.ajax({
					url: ACC.config.encodedContextPath + "/my-account/orderdetails/" + $(this).attr("data-order"),
					method: "GET",
					success: function (response) {
						loading.stop();
						$(productContainer).find(".transit-product-details__header").after(response);		
						ACC.product.enableAddToCartButton();
						ACC.product.bindToAddToCartForm();
					}
				});
				}
				else{
					$(productContainer).removeClass("hidden");
				}
				break;
			}
			 case "collapse": {
				 $(productContainer).addClass("hidden");
				 
				 break;
			 }
		}
		});
		
		$(document).on("click", '.close-product', function (event) {
			event.preventDefault();
			var row=$(this).closest(".track-order-table__values");			
        	row.find(".transit-product-details").addClass("hidden");
         
        	row.find(".xs-product-details").data('state','expand').html("<span class='icon-plus-circle'></span>&nbsp;" + ACC.config.orderDetails);
		   
          row.find(".md-product-details").data('state','expand').html("<span class='icon-plus-circle'></span>");
         
    });
	},
	bindPlaceOrder: function () {
		$(document).on("click", ".btn-place-order", function (e) {
			let target = e;
			$(".btn-place-order").attr('disabled', 'disabled');
			var kount = sessionStorage.MercSessId;
			console.log("order kount : " + kount);
			e.preventDefault();
			ACC.colorbox.open("", {
				html: $(".lodding-popup").html(),
				width: "450px",
				height: "400px",
				escKey: false,
				overlayClose: false,
				closeButton: false,
				className:"order-kount-error-popup"
			});
			$.ajax({
				url: ACC.config.encodedContextPath + "/checkout/multi/kount/evaluateInquiry?kountSessionId=" + kount,
				type: "POST",

				success: function (fraud) {
					console.log("Successful>>>" + fraud)
					
					if(typeof fraud  == 'string' && fraud.toUpperCase() == 'DECLINE'){
						ACC.colorbox.open("", {
							html: $(".order-error-popup").html(),
							width: "470px",
							height: "auto",
							escKey: false,
							overlayClose: false,
							closeButton: false,
							className:"order-kount-error-popup"
						});
					}else{
						if($(e.target).hasClass("orderapproval_btn")){
							ACC.adobelinktracking.approveOrder(target, '', 'submit for approval', 'checkout: order review', false);
						}
						else {
						ACC.adobelinktracking.approveOrder(target, '', 'place an order', 'checkout: order review', false);
						}
						$("#placeOrderForm1").submit();
					}
				},
				error: function (fraud) {
					console.log("UnSuccessful>>>" + fraud);
					$("#placeOrderForm1").submit();
				}
			});
		});

	},

	bindRequestNotesOverlay: function (e) {
		$(document).on("click", ".requestnotes", function (e) {
			e.preventDefault();
			$(".req_productId").html($(this).data("productid"));
			$(".req_productName").html($(this).data("productname"));
			$(".req_productPrice").html($(this).data("productprice"));
			$(".req_uom").html($(this).data("productuom"));
			$("#colorbox").addClass("addrequestnotes");
			ACC.colorbox.open("", {
				html: $("#requestordernotes").html(),
				width: "650px",
				height: "auto",
				close: '<span class="glyphicon glyphicon-remove"></span>',
			});

		});
	},

	onOrderClick: function () {
		$('.collapse').on('show.bs.collapse', function (e) {
			$('.collapse').not(e.target).removeClass('in');
			$(this).parent(".order-section").addClass("active-product");
			$(".order-section").removeClass("active-product");
			$(".icon-Expand").addClass("icon-plus-circle");
			$(".icon-Expand").removeClass("icon-minus-circle");
			$(".hidetext").addClass("hidden");
			$(".showtext").removeClass("hidden");
		});
		$('.close-collapse').click(function () {
			$(".order-section").removeClass("active-product");
			$(".icon-Expand").addClass("icon-plus-circle");
			$(".icon-Expand").removeClass("icon-minus-circle");
			$(".more-link").hide();
			$(".hidetext").addClass("hidden");
			$(".showtext").removeClass("hidden");
		});
		function showMoreLink(productSection){
			if ($(productSection+' '+".singleorder-product-section").length > 10) {
				$(".more-link").css("display", "block");
				$(productSection+' '+".singleorder-product-section").slice(10).css("display", "none");
			}
		}
		
		$(document).on("click", ".product-row", function (e) {
			if($(this).attr('aria-expanded') === "false"){
				$(this).closest(".order-section").removeClass("active-product");
				$(this).find(".icon-Expand").addClass("icon-plus-circle").removeClass("icon-minus-circle");
				$(this).find(".showtext").removeClass("hidden");
				$(this).find(".hidetext").addClass("hidden");
				$(".more-link").hide();
				//$(this).closest(".order-section").find(".consigmentList").addClass("hidden");
			}
			else {
				
				$(".more-link").css("display", "none");
				//$(this).closest(".order-section").addClass("active-product");
				$(this).find(".icon-Expand").removeClass("icon-plus-circle").addClass("icon-minus-circle");
				$(this).find(".hidetext").removeClass("hidden");
				$(this).find(".showtext").addClass("hidden");
				
				$(this).closest(".order-section").find(".consignment-code").each(function(){
					var consigment = $(this).val();
					var businessUnitId = $("#businessUnitId").val();
					console.log(consigment);
					loading.start();
					$.ajax({
						url: ACC.config.encodedContextPath + "/my-account/orderdetails/" + consigment + "?unitId=" + businessUnitId,
						method: "GET",
						success: function (response) {
							loading.stop();
							console.log("response==",response);
							if (response && response.orderData !=null) {
							$("."+consigment+"_trackingUrl").removeClass("hidden");
							$("."+consigment+"_trackingUrl").attr("href",response.orderData.trackingUrl);
							if(response.orderData.statusDisplay == "SHIPPED")
							{
								$("."+consigment+"_trackingUrl").text($("#trans_trackshiping").val());
							}
							else{
								$("."+consigment+"_trackingUrl").text($("#trans_trackdelivery").val());	
							}
							
							}
							
							
						}
					});
				});
				
			}
		});
		$(document).on("click", ".buy-again-atc", function (e) {
			$(".buy-again-atc").removeClass("selected-btn");
			$(this).addClass("selected-btn")
		});


	},
	bindOrderTabs: function () {
		if($("body").hasClass("page-accountDashboardPage") || $("body").hasClass("page-order")){
			$.cookie("accountPageId", "orderhistorypage", { path: '/' });
			sessionStorage.setItem("activeTab", "orderHistoryTab");
		}

		$(document).on("click", ".orders-tabs-container .orders-tab,a.orders-link", function () {
			var pageId = $(this).data("key");
			$.cookie("accountPageId", pageId, { path: '/' });
			sessionStorage.setItem("activeTab", $(this).data("active"));
			sessionStorage.setItem("selectedDropdownValueSession", ACC.config.defaultSortValue);

		});

		var currentTab = sessionStorage.getItem("activeTab");
		if (currentTab) $(".orders-tabs-container").find("[data-active='" + currentTab + "']").addClass("active-account-tab").removeClass("tab-font-color");
		sessionStorage.removeItem("activeTab");
		
		if ($(".page-accountOrdersPage .alert-danger").length == 1) {
			$(".invoice-serach-sec").addClass("order-search-sec");
			$(".orders-tab-content").addClass("order-tab-sec");
		}
		if ($('.buy-it-again-container').length > 0) {
			_AAData.eventType="Buy Again";
		}

		if($(".page-invoicelistingpage").length){
			$(".invoices-dropdown-box .dropdown-menu").width($(".invoices-dropdown-box button").outerWidth()-1);
		}
		
		if($(".page-accountOrdersPage").length){
			$(".order-dropdown-box .dropdown-menu").width($(".order-dropdown-box button").outerWidth()-2);
		}
		
	},
	
	orderDropdownSearchType: function (e, type, val, ref) {
		let target = $(e);
		if(!target.parent("li").hasClass("disabled")){
			$(".order-dropdown-box .dropdown-menu li").removeClass("disabled");
			target.parent("li").addClass("disabled");
			$(".order-dropdown-select").html(type + " #");
			$(ref).prop("name", val);
		}
	},

	invoicesDropdownSearchType: function (e, type, val, ref) {
		let target = $(e);
		if(!target.parent("li").hasClass("disabled")){
			$(".invoices-dropdown-box .dropdown-menu li").removeClass("disabled");
			target.parent("li").addClass("disabled");
			$(".invoices-dropdown-select").html(type + " #");
			$(ref).prop("name", val);
		}
	},

	bindOrderQtyBia: function () {
		$(document).on("input change", ".qty-container .bia-qty-txt-field", function () {
			var qtyInput = $(this).val();
			$(".qty-hidden-bia").val(qtyInput);
			$(this).closest(".bia-table-row").find(".js-bia-qty-error").addClass("hide");
			$(this).closest(".qty-button-wrapper").find('.js-enable-btn').removeAttr("disabled");
			$(this).removeClass("add-border border-red text-red");
			if ($(this).data('is-nursery') === true) {
				if ($(this).val().trim() > $(this).data("available-qty")) {
					$(this).addClass("add-border border-red text-red");
					$(this).closest(".bia-table-row").find(".js-bia-qty-error").removeClass("hide");
					$(this).closest(".qty-button-wrapper").find('.js-enable-btn').attr("disabled", "disabled");
				}
			}
		})
	},
	addOrderToList: [],
	bindOrderDetailEvent: function () {
		let heightElem = ["grey", "white"];
		for (let i = 0; i < heightElem.length; i++) {
			if (ACC.global.wWidth < 1024 & i != 0) {
				for (let j = 0; j < 1; j++) {
					let target1 = $(".order-height-adjust-" + heightElem[i]).eq(j);
					let target2 = $(".order-height-adjust-" + heightElem[i]).eq(j + 1);
					if (target1.height() > target2.height()) {
						target2.height(target1.height());
					}
					else if (target2.height() > target1.height()) {
						target1.height(target2.height());
					}
				}
			}
			else if (ACC.global.wWidth >= 1024) {
				let maxHeightAdjust = 0;
				for (let j = 0; j < 6; j++) {
					let target = $(".order-height-adjust-" + heightElem[i]).eq(j);
					maxHeightAdjust = (maxHeightAdjust < target.height()) ? target.height() : maxHeightAdjust;
				}
				$(".order-height-adjust-" + heightElem[i]).height(maxHeightAdjust);
			}
		}
		if (ACC.global.wWidth < 1024) {
			$(".order-accordion-parent").each(function (e) {
				let target = $(this);
				target.addClass("bg-white").removeClass("disabled");
				if (e+1 != 1) {
					target.find(".order-accordion-data-" + (e+1)).hide();
				}
			});
		}
		$(".item__list--header").each(function () {
			let orderCode = $(this).find(".product-code").val();
			let orderItemNumber = $("#checkbranch-itemnumber-" + orderCode).val();
			let quantity = Number($(this).find(".qtyValue").text().trim() || 1);

			let orderKey = `${orderItemNumber}|${quantity}|${orderCode}`;
			if (orderItemNumber && ACC.order.addOrderToList.indexOf(orderKey) === -1) {
				ACC.order.addOrderToList.push(orderKey);
			}
		});
		ACC.order.addOrderToList = ACC.order.addOrderToList.join(" ");
  	},
  	/*Order page Redesign Start */
  	
	tabClicked: function () {
		$(document).on("click", ".tabClick", function () {
			var targetClass = $(this).attr("data-target");
			$('.'+targetClass).removeClass("hidden").fadeIn("slow");
			
			$("body").click(function(e) {
			   let target = $(e.target);
			   if ($('.'+targetClass).is(":visible") && (ACC.global.wWidth > 1023 || ACC.global.wWidth < 576)) {
				   if (!target.parents('.'+targetClass).length) {
			       $('.'+targetClass).fadeOut();
			       }
			   }
			});
			
		});
		
		$(document).on("submit","#searchForm, #searchFormMob",function(){
			$('#searchForm input[name="s-by"]').removeAttr('name');
			$('#searchFormMob input[name="s-by"]').removeAttr('name');
			$('#searchForm input[name="accountShiptos"]').eq(1).removeAttr('name');
			$('#searchForm input[name="paymentType"]').eq(1).removeAttr('name');
		});
		
		ACC.order.sbyRadioUpdate();
		
	},
	
	orderSortBy: function(sort){
		if(sessionStorage.getItem("sOrder") == "desc" && sessionStorage.getItem("sOrderField") == sort)
		{
			sessionStorage.setItem("sOrder", "asc");
			sessionStorage.removeItem("sOrderField");
		}
		else{
			sessionStorage.setItem("sOrder", "desc");
			sessionStorage.setItem("sOrderField", sort);
		}
		
		var sByOrder = sessionStorage.getItem("sOrder");
		
		$('#searchForm input[name="sort"]').val(sort);
		$('#searchForm input[name="sortOrder"]').val(sByOrder);
		$('#searchFormMob input[name="sort"]').val(sort);
		if(ACC.global.wWidth > 1023){
			$('#searchForm').submit();
		}
	},
	
	removeSortsession: function(){
		if(!$("body").hasClass("page-accountOrdersPage") || $(".order-tab").length == 0){
			sessionStorage.removeItem("sOrder");
			sessionStorage.removeItem("sOrderField");
		}
	},
	
	sbyRadioUpdate: function(){
		
		$('.sbyData').on('change', function() {
			if ($(this).is(':checked')) {
			sessionStorage.setItem("sbyData", $(this).val());
			$('#dateSort').val($(this).val());
			}
		});
		
		var getsbyData = sessionStorage.getItem("sbyData");
		if(getsbyData){
		$('#dateSort').val(getsbyData);	
		$('input:radio[name="dateSort"][value="'+getsbyData+'"]').prop("checked",true);
		}
	
	},
	
	searchTabClick: function(){
		$(document).on("click", ".mob-searchby", function () {
			ACC.colorbox.open("", {
				html: '<form id="searchFormMob">'+$(".search-dropdown").html()+'</form>',
				width:"95%",
				escKey: false,
				overlayClose: false,
				className:"search-dropdown",
				onComplete:function(){
				ACC.order.sbyRadioUpdate();
				},
			});
		});
	},
	
	shipToApply: function(){
		$(document).on("click", ".shipToAppBtn", function () {	
					
					var currentSelect = $("input[name='shipToAc-m']:checked").val();	
					
					if(ACC.global.wWidth > 1023){
					currentSelect = $("input[name='shipToAc']:checked").val();
					}
					
				
					//sessionStorage.setItem('selectedOrderSession',currentSelect);

					var $form = $("#sortForm1");
					
						var searchParam = $("#searchOrderHistory").val();
						var dateSort= $("#dateSort").val();
						var viewpagination =$("#pageSizeOrder1").val();
						//var accountShiptos = $("#shipToSelected_order").val();
						var searchParam = $("#search-ship-to").val();
						var paymentType= $("#paymentTypeOrder").val();
						$form.find("input#search-shipto").val(searchParam);
						//$form.find("input#shipToSelected_order").val(accountShiptos);
					$form.find("input#search-ordernew").val(searchParam);
					$form.find("input#dateSortOrder").val(dateSort);
					$form.find("input#ViewPaginationOrder").val(viewpagination);
					//$form.find("input#accountShiptos").val(accountShiptos);
					$form.find("input#paymentTypeOrder").val(paymentType);
					$form.find("input#accountShiptos").val(currentSelect);
					
					$form.submit();
					
		});
		
		$(document).on("click", ".moreShipTos", function () {	
					
					var data = {
							dateSort:$("#dateSort").val(),
							paymentType:$("#paymentTypeOrder").val()
						}
					let searchVal = ($("#search-ship-to-popup-order").length)?($("#search-ship-to-popup-order").val()).trim():"";
						var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-orders/'+($("#unitUid").val()).trim()+'?searchParam='+searchVal;	
						removeShipToSortbySessionValue();
						var wShiptoPopup = '800px';
						var shipToPopupTitle = 'Search or Select a Ship-To';
						if(ACC.global.wWidth < 500){
							wShiptoPopup = '95%';
							shipToPopupTitle = 'Ship-to';
						}
						$.ajax({
					            url: shipToPopupURL,
					            data:data,
					            method: "GET",		
					            success: function(searchPageData) {
					                ACC.colorbox.open(shipToPopupTitle, {
					                    html: searchPageData,
					                    width: wShiptoPopup,
					                    className:"shipto-popup-order-mb invoice-shiptopopup",
					                    overlayClose: false,
					                    onComplete: function(e) {
					                    	//sessionStorage.removeItem('selectedOrderSession');
					                    	$(".ship-TosOrder").val('shipToopenPopupNew');
					        				
					        				checkShipToPopUpOrder();
					        				$(document).on('click keyup', '#search-ship-to-popup-order', function(){
					                    		checkShipToPopUpOrder();
					                    	});
					                    },
					                    onClosed: function() {
					                    	//sessionStorage.setItem('selectedOrderSession','All');
				        					location.reload(true);
				        					//window.location.href= ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateSort='+($("#dateSort").val()).trim()+'&paymentType=ALL&pagesize=25&sort=byDate';
				        				
					                    }
					                });
					            }
					        });
					
		});
		
				$(document).on("blur", "#search-ship-to-popup-order-new", function () {	
			if(ACC.global.wWidth > 1023){
			ACC.order.shipToNewPopUpAjax();
			}
		});

		$(document).on("click", ".moreShipToSearch", function () {	
			ACC.order.shipToNewPopUpAjax(true);
		});

		$(document).on("click", ".moreShipToClear", function () {	
			$("input[name='sortByRadio']").prop('checked', false);
			$("#search-ship-to-popup-order-new").val('');
		});

		$(document).on("click", ".shipToURLRadio", function () {	
			var redURL = $("input[name='shiptoURL']:checked").val();
			window.location.href = redURL;
		});
	},

	shipToNewPopUpAjax: function(shortBy=false){

		var sortParam;

		if(shortBy == true){
			sortParam = $("input[name='sortByRadio']:checked").val();
			sessionStorage.setItem('selectedRadioValueSession',sortParam);
		}
		var wShiptoPopup = '800px';
		var shipToPopupTitle = 'Search or Select a Ship-To';
		if(ACC.global.wWidth < 500){
			wShiptoPopup = '95%';
			shipToPopupTitle = 'Ship-to';
		}

		var dateSortPopup =$("#dateSort").data('datesort');

		var data = {
					searchParam : ($("#search-ship-to-popup-order-new").val()).trim(),
					dateSortPopup:dateSortPopup,
					sort:sortParam	
				}
		var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-orders/'+($("#unitUid").val()).trim() + '?paymentType=ALL';
		var poupClass = $("#cboxOverlay").prop("class");
		$.ajax({
			url : shipToPopupURL,
			method : "GET",
			data : data,
			success : function(searchPageData) {
			ACC.colorbox.open(shipToPopupTitle, {
			html : searchPageData,
			width : wShiptoPopup,
			className : poupClass,
			overlayClose : false,
			onComplete:function(){
				$(".ship-TosOrder").val('shipToopenPopupNew');
				checkShipToPopUpOrder();
				var getShortByRadio = sessionStorage.getItem("selectedRadioValueSession");
				if(getShortByRadio){
					$("input[name='sortByRadio'][value='"+getShortByRadio+"']").prop('checked', true);
					sessionStorage.removeItem("selectedRadioValueSession");
				}

			},
			onClosed: function() {

					sessionStorage.setItem('selectedOrderSession','All');
					location.reload(true);
					//window.location.href= ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateSort='+($("#dateSort").val()).trim()+'&paymentType=ALL&pagesize=25&sort=byDate';

				}
			});
			}
			});
	},
	/*Order page Redesign End */
	
	addOrderToListBtn: function () {
		ACC.productDetail.plpCommonBtn = "false";
		ACC.productDetail.plpMobileAddListCode = '';
		$(".pdplistpopup1").removeClass('hidden');
		$(".pdp-newlist-popup-error-text").hide();
		$(".pdp-emptynewlist-popup-error-text").hide();
		$('.listpopupsavebtn').removeClass("disabled");
		$('.createnewlistbtn').removeClass("disabled");
		$(".pdp-atl-popup").colorbox.resize();
		if($('.loginstatus').val()!=''){
			ACC.colorbox.open("", {
				html:  $("#listpopup").html(),
				width: "500px",
				className: "pdp-atl-popup",
				onComplete:function(){
				$(document).on("click",".listpopupclosebtn", function(e){
					ACC.colorbox.close();
				});
				}
			})
		}
	},
	currentWishListCode: false,
    moveItemsToList: function (wishlistCode) {
        if (!ACC.order.currentWishListCode) {
            ACC.order.currentWishListCode = wishlistCode;
            console.log(wishlistCode);
            $.ajax({
                type: 'POST',
                url: ACC.config.encodedContextPath + "/savedList/addSelectedToSavedWishlist",
                datatype: "json",
                data: {
                    productItemNumbers: ACC.order.addOrderToList,
                    wishListCode: wishlistCode,
                    currentWishlist: ''
                },
                success: function (result) {
                    ACC.colorbox.open("", {
                        html: ACC.productDetail.pdppopupHtmlExistingList(ACC.config.listaddedMsg, wishlistCode),
                        width: "500px",
                        onComplete: function () {
                            $('#colorbox').addClass('item-add-list-box');
                            $('body').css("overflow-y", "hidden");
                            $(document).on("click", ".successListCreation", function () {
                                ACC.colorbox.close();
                            });
                        },
                        onClosed: function () {
                            $('body').css("overflow-y", "auto");
                            $('#colorbox').removeClass('item-add-list-box');
                        }
                    });
                    console.log('success: ', wishlistCode, result);
                    ACC.order.currentWishListCode = false;
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log('error: ', wishlistCode, xhr);
                    ACC.order.currentWishListCode = false;
                    ACC.myquotes.quotePopupError();
                }
            });
        }
    },
    saveContinueList: function () {
        var pdppopuplistname = $("#pdppopupinput").val().trim();
        if (pdppopuplistname != '' && pdppopuplistname != null) {
            $.ajax({
                type: 'POST',
                url: ACC.config.encodedContextPath + "/savedList/createWishlistAndFetch",
                datatype: "json",
                data: {
                    wishListName: pdppopuplistname
                },
                success: function (result) {
                    console.log(result);
                    if (result.isDuplicate == true) {
                        $('.pdp-newlist-popup-error-text').show();
                        $('.listpopupsavebtn').addClass("disabled");
                        $('.createnewlistbtn').addClass("disabled");
                        $('input.createnewlistinput').keyup(function (e) {
                            $(".pdp-newlist-popup-error-text").hide();
                            $(".pdp-atl-popup").colorbox.resize();
                            $('.listpopupsavebtn').removeClass("disabled");
                            $('.createnewlistbtn').removeClass("disabled");
                        });
                        $(".pdp-atl-popup").colorbox.resize();
                    }
                    else {
                        $('.pdp-newlist-popup-error-text').hide();
                        $('.listpopupsavebtn').removeClass("disabled");
                        $('.createnewlistbtn').removeClass("disabled");
                        $(".pdp-atl-popup").colorbox.resize();
                        if (result.allWishlist.length > 0) {
                            $('.popupsavedlistoptions').parent().removeClass('hidden');
                        }
                        //create new buttons 
                        //call new  function and pass whishlist code
                        var item = "";
                        if ($('.page-order').length > 0) {
                            result.allWishlist.forEach(addtolistpopup => {
                                item += '<button type="button" class="list-group-item Ordlistoption hidden-xs"  id="' + addtolistpopup.code + '" data-value="' + addtolistpopup.code + '"onclick="ACC.order.moveItemsToList(\'' + addtolistpopup.code + '\')">' + addtolistpopup.name + '</button>'
                                item += '<button type="button" class="list-group-item Ordlistoptionmobile hidden-md hidden-lg hidden-sm " id="' + addtolistpopup.code + '" data-value="' + addtolistpopup.code + '" onclick="ACC.order.moveItemsToList(\'' + addtolistpopup.code + '\')">' + addtolistpopup.name + '</button>'
                            });
                            $(".popupoptionlistitem").empty().append(item);
                            var wishlistCode = $(".Ordlistoption:first").data('value');
                            ACC.order.moveItemsToList(wishlistCode)
                            $(".createnewlistinput").val("");
                        }
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log('data failure');
                }
            });
        }
        else {
            $('.pdp-emptynewlist-popup-error-text').show();
            $('.listpopupsavebtn').addClass("disabled");
            $('.createnewlistbtn').addClass("disabled");
            $('input.createnewlistinput').keyup(function (e) {
                $(".pdp-emptynewlist-popup-error-text").hide();
                $(".pdp-atl-popup").colorbox.resize();
                $('.listpopupsavebtn').removeClass("disabled");
                $('.createnewlistbtn').removeClass("disabled");
            });
            $(".pdp-atl-popup").colorbox.resize();
            $(".pdplistpopupoption:first").addClass('selected');
        }
    }
};

function checkShipToPopUpInvoice(){
	var searchShipToPopupInvoiceVal = $('#search-ship-to-popup-invoice').val();
	disableShipToSearch(searchShipToPopupInvoiceVal);
}

function disableShipToSearch(searchShipToVal){
	if (typeof searchShipToVal !== 'undefined') {
		if (searchShipToVal.size == 0 || searchShipToVal == '') {
			$('button[id="shipToSearchBoxButton"]').attr('disabled', 'disabled');
		}
		else {
			$('button[id="shipToSearchBoxButton"]').removeAttr("disabled");
		}
	}
}
 ACC.paginationsort = {
		
	downUpKeysPressed: false,
	 bindAll: function ()
	{
		this.bindPaginationSort();
		this.changePageSize();
		this.changeinvoicesort();
		this.chooseTab();
		this.changeUserSort();
		
	},
	bindPaginationSort: function ()
	{
		let sortClass = ACC.global.wWidth < 1024 ? 'web' : 'mob';
		$(".js-plp-sort-" + sortClass).remove();
		with (ACC.paginationsort)
		{
			
			ACC.paginationsort.chooseTab();
			bindSortForm($('#sortForm1'));
			bindSortForm($('#invoicesearchForm'));
			bindSortForm($('#searchForm'))
			bindSortForm($('#sortForm2'));
			bindMobileSortForm($('#mobileSortForm1'));
			bindMobileSortForm($('#mobileSortForm2'));
			bindContentSortForm($('#contentSortForm1'));
			bindContentSortForm($('#contentSortForm2'));
			var url = window.location.href;
			if(((url.indexOf('content')>0)) && $("#pageId").val() == 'searchGrid')
				{
					
				$('#productTab').addClass('hidden');
				$('.productResults .pagination-bar').first().addClass('hidden');
				$('#selectedProductTab').removeClass('seletedTab');
				$('#selectedContentTab').addClass('seletedTab');
				if(url.indexOf("type=content") < 0) {
					$('#contentSearchType').trigger("click");
				}
				
			}
			else {
					
				$('#contentTab').addClass('hidden');
				$('#selectedContentTab').removeClass('seletedTab');
				$('#selectedProductTab').addClass('seletedTab');
				
			}
			
		}
		
		
	},
	bindSortForm: function (sortForm)
	{

		
			
			$("#sortOptions1").on('change', function(){
				var sortType1 = $("#sortOptions1").val();
				sessionStorage.setItem('selectedDropdownValueSession',sortType1);
			});
			$("#sortOptions2").on('change', function(){
				var sortType2 = $("#sortOptions2").val();
				sessionStorage.setItem('selectedDropdownValueSession',sortType2);
			});
			$("#dateSort").on('change', function(){
				var sortType3 = $("#dateSort").val();
				sessionStorage.setItem('selectedDropdownValueSession',sortType3);
				sessionStorage.setItem('selectedDateSort',sortType3)
			});
			$(".mobile-sort").on('change', function(){
				sessionStorage.setItem('mobileSortSelection', $(".mobile-sort").val());
			});
			sortForm.on('change',function  ()
					{
			
            function submitSortForm1(thisForm){

            	var searchParam = $("#search-invoice").val();
                var dateFrom = $("#dateFrom").val();
                var dateTo = $("#dateTo").val();
                var viewpagination = $("#pageSizeInvoice1").val();
                var invoiceShiptos = $("#shipToSelected_inv").val();
                var searchParam = $("#search-ship-to").val();
                $(thisForm).find("input#search-shipto").val(searchParam);
                $(thisForm).find("input#shipToSelected_inv").val(invoiceShiptos);
                $(thisForm).find("input#search-invoicenew").val(searchParam);
                $(thisForm).find("input#dateFromnew").val(dateFrom);
                $(thisForm).find("input#dateTonew").val(dateTo);
                $(thisForm).find("input#ViewPaginationInvoice").val(viewpagination);
                $(thisForm).find("input#shipToSelected_inv").val(invoiceShiptos);

               
                $(thisForm).submit();
            }
            function submitSortForm2(thisForm){
            	 var searchParam = $("#searchOrderHistory").val();
                 var dateSort = $("#dateSort").val();
                 var viewpagination = $("#pageSizeOrder1").val();
                 var accountShiptos = $("#shipToSelected_order").val();
                 var searchParam = $("#search-ship-to").val();
                 $(thisForm).find("input#search-shipto").val(searchParam);
                 $(thisForm).find("input#shipToSelected_order").val(accountShiptos);
                 $(thisForm).find("input#search-ordernew").val(searchParam);
                 $(thisForm).find("input#dateSortOrder").val(dateSort);
                 $(thisForm).find("input#ViewPaginationOrder").val(viewpagination);
                 $(thisForm).find("input#shipToSelected_order").val(accountShiptos);
                 
                 $(thisForm).submit();
            }
            function submitSortForm3(thisForm){
            	var searchParam = $("#manager-user-voice").val();
                var viewpagination = $("#pageSizeManagerUser1").val();
                var shiptounit = $("#shipToSelected_user").val();
                var adminCheck = $('#admin_User').val();
                $(thisForm).find("input#search-shipto").val(searchParam);
                $(thisForm).find("input#shipToSelected_user").val(shiptounit);
                $(thisForm).find("input#search-ordernew").val(searchParam);
                $(thisForm).find("input#ViewPaginationManager").val(viewpagination);
                $(thisForm).find("input#admin_User").val(adminCheck);

               
                $(thisForm).submit();
            }
            
            function submitSortForm4(thisForm){
            	var searchParam = $("#ewallet-page-card").val();
				var viewpagination =$("#pageSizeeWallet1").val();
				var shiptounit = $("#shipToSelected_eWallet").val();				
				$(this).find("input#search-shipto").val(searchParam);
				$(this).find("input#shipToSelected_eWallet").val(shiptounit);
				$(this).find("input#ViewPaginationeWallet").val(viewpagination);
				


               
                $(thisForm).submit();
            }
            if (!$("body.page-invoicelistingpage").length) {
                if (!$("body.page-accountOrdersPage").length || $("div.open-order").length) {
                    if (!$("body.page-my-company").length) {
                    	if(!$("body.page-ewalletdetailspage").length){

                        if (!ACC.paginationsort.downUpPressed) {
                        	if(!$("div.open-order").length) {
                        		submitSortForm1(this);
                        		submitSortForm2(this);
                        		submitSortForm3(this);
                        		submitSortForm4(this);
                        	} else {this.submit();}


                        }
                        ACC.paginationsort.downUpPressed = false;
                       
                    }
                }
                }     
            }

        });

    },
	
	
	bindMobileSortForm: function (mobileSortForm)
	{
//  browser.msie has been removed from jQuery as of version 1.9. Modernizr is recommended as a replacement
//	issue created
//		if ($.browser.msie)
//		{
// 			this.sortFormIEFix($(sortForm).children('select'), $(sortForm).children('select').val());
//		}

		mobileSortForm.on('change',function  ()
		{
//			if (!$.browser.msie)
//			{
//				this.submit();
//			}
//			else
//			{
				if (!ACC.paginationsort.downUpPressed)
				{
					this.submit();
				}
				ACC.paginationsort.downUpPressed = false;
//			}
				
		});
		
	},
	
	
	
	
	bindContentSortForm: function (contentSortForm)
	{
//  browser.msie has been removed from jQuery as of version 1.9. Modernizr is recommended as a replacement
//	issue created
//		if ($.browser.msie)
//		{
// 			this.sortFormIEFix($(sortForm).children('select'), $(sortForm).children('select').val());
//		}

		contentSortForm.on('change',function  ()
		{
//			if (!$.browser.msie)
//			{
//				this.submit();
//			}
//			else
//			{
			
				if (!ACC.paginationsort.downUpPressed)
				{
					
					this.submit();
				}
				ACC.paginationsort.downUpPressed = false;
				
				
//			}
		});
		
	},
	sortFormIEFix: function (sortOptions, selectedOption)
	{
		sortOptions.keydown(function (e)
		{
			// Pressed up or down keys
			if (e.keyCode === 38 || e.keyCode === 40)
			{
				ACC.paginationsort.downUpPressed = true;
			}
			// Pressed enter
			else if (e.keyCode === 13 && selectedOption !== $(this).val())
			{
				$(this).parent().submit();
			}
			// Any other key
			else
			{
				ACC.paginationsort.downUpPressed = false;
			}
		});
	},
	changePageSize: function ()
	{	
		$(document).on("change","#pageSize1",function()
		{
		     $('#changePageSizeForm1').submit();
			 
		})
		
		$(document).on("change","#pageSizeInvoice1",function() 
		{    
		var searchParam = $("#search-invoice").val();
		var dateFrom= $("#dateFrom").val();
		var dateTo= $("#dateTo").val();
		var viewpagination =$("#pageSizeInvoice1").val();
		var invoiceShiptos = $("#shipToSelected_inv").val();
		var sortType = $("#sortOptions1").val();
		$('#changePageSizeFormInvoice1').find("input#search-invoicenew").val(searchParam);
		$('#changePageSizeFormInvoice1').find("input#dateFromnew").val(dateFrom);
		$('#changePageSizeFormInvoice1').find("input#dateTonew").val(dateTo);
		$('#changePageSizeFormInvoice1').find("input#ViewPaginationInvoice").val(viewpagination);
		$('#changePageSizeFormInvoice1').find("input#sortType").val(sortType);
		$('#changePageSizeFormInvoice1').find("input#shipToSelected_inv").val(invoiceShiptos);
		$('#changePageSizeFormInvoice1').submit();
		})
		
		$(document).on("change","#pageSizeInvoice2",function() 
		{    
		var searchParam = $("#search-invoice").val();
		var dateFrom= $("#dateFrom").val();
		var dateTo= $("#dateTo").val();
		var viewpagination =$("#pageSizeInvoice2").val();
		var invoiceShiptos = $("#shipToSelected_inv").val();
		$('#changePageSizeFormInvoice2').find("input#search-invoicenew").val(searchParam);
		$('#changePageSizeFormInvoice2').find("input#dateFromnew").val(dateFrom);
		$('#changePageSizeFormInvoice2').find("input#dateTonew").val(dateTo);
		$('#changePageSizeFormInvoice2').find("input#ViewPaginationInvoice").val(viewpagination);
		$('#changePageSizeFormInvoice2').find("input#shipToSelected_inv").val(invoiceShiptos);
		$('#changePageSizeFormInvoice2').submit();
		})
		
		$(document).on("change","#pageSizeOrder1",function() 
		{    
		var searchParam = $("#searchOrderHistory").val();
		var dateSort= $("#dateSort").val();
		var viewpagination =$("#pageSizeOrder1").val();
		var accountShiptos = $("#shipToSelected_order").val();
		var sortType = $("#sortOptions1").val();
		$('#changePageSizeFormOrder1').find("input#search-ordernew").val(searchParam);
		$('#changePageSizeFormOrder1').find("input#dateSortOrder").val(dateSort);
		$('#changePageSizeFormOrder1').find("input#ViewPaginationOrder").val(viewpagination);
		$('#changePageSizeFormOrder1').find("input#sortType").val(sortType);
		$('#changePageSizeFormOrder1').find("input#shipToSelected_order").val(accountShiptos);
		$('#changePageSizeFormOrder1').submit();
		})
		
		$(document).on("change","#pageSizeOrder2",function() 
		{    
		var searchParam = $("#searchOrderHistory").val();
		var dateSort= $("#dateSort").val();
		var viewpagination =$("#pageSizeOrder2").val();
		var accountShiptos = $("#shipToSelected_order").val();
		$('#changePageSizeFormOrder2').find("input#search-ordernew").val(searchParam);
		$('#changePageSizeFormOrder2').find("input#dateSortOrder").val(dateSort);
		$('#changePageSizeFormOrder2').find("input#ViewPaginationOrder").val(viewpagination);
		$('#changePageSizeFormOrder2').find("input#shipToSelected_order").val(accountShiptos);
		$('#changePageSizeFormOrder2').submit();
		})
			$(document).on("change","#pageSizeManagerUser1",function() 
		{    
		var searchParam = $("#manager-user-voice").val();
		var viewpagination =$("#pageSizeManagerUser1").val();
		var shiptounit = $("#shipToSelected_user").val();
		var sortType = $("#sortOptions1").val();
		var adminCheck = $('#admin_User').val();
		$('#changePageSizeFormManagerUser1').find("input#manager-user-voice").val(searchParam);
		$('#changePageSizeFormManagerUser1').find("input#ViewPaginationmanager").val(viewpagination);
		$('#changePageSizeFormManagerUser1').find("input#sortType").val(sortType);
		$('#changePageSizeFormManagerUser1').find("input#shipToSelected_user").val(shiptounit);
		$('#changePageSizeFormManagerUser1').find("input#admin_User").val(adminCheck);
		$('#changePageSizeFormManagerUser1').submit();
		})
		
			$(document).on("change","#pageSizeManagerUser2",function() 
		{    
		var searchParam = $("#manager-user-voice").val();
		var viewpagination =$("#pageSizeManagerUser2").val();
		var shiptounit = $("#shipToSelected_user").val();
		var adminCheck = $('#admin_User').val();
		$('#changePageSizeFormManagerUser2').find("input#manager-user-voice").val(searchParam);
		$('#changePageSizeFormManagerUser2').find("input#ViewPaginationmanager").val(viewpagination);
		$('#changePageSizeFormManagerUser2').find("input#sortType").val(sortType);
		$('#changePageSizeFormManagerUser2').find("input#shipToSelected_user").val(shiptounit);
		$('#changePageSizeFormManagerUser1').find("input#admin_User").val(adminCheck);
		$('#changePageSizeFormManagerUser2').submit();
		})
		$(document).on("change","#pageSizeeWallet1",function() 
		{    
		var searchParam = $("#ewallet-page-card").val();
		var viewpagination =$("#pageSizeeWallet1").val();
		var shiptounit = $("#shipToSelected_eWallet").val();
		var sortType = $("#sortOptions1").val();
		
		$('#changePageSizeFormEwallet1').find("input#ewallet-page-card").val(searchParam);
		$('#changePageSizeFormEwallet1').find("input#ViewPaginationeWallet").val(viewpagination);
		$('#changePageSizeFormEwallet1').find("input#sortType").val(sortType);
		$('#changePageSizeFormEwallet1').find("input#shipToSelected_eWallet").val(shiptounit);	
		$('#changePageSizeFormEwallet1').submit();
		})
		
			$(document).on("change","#pageSizeeWallet2",function() 
		{    
		var searchParam = $("#ewallet-page-card").val();
		var viewpagination =$("#pageSizeeWallet2").val();
		var shiptounit = $("#shipToSelected_eWallet").val();
		
		$('#changePageSizeFormEwallet2').find("input#ewallet-page-card").val(searchParam);
		$('#changePageSizeFormEwallet2').find("input#ViewPaginationeWallet").val(viewpagination);
		$('#changePageSizeFormEwallet2').find("input#sortType").val(sortType);
		$('#changePageSizeFormEwallet2').find("input#shipToSelected_eWallet").val(shiptounit);
		$('#changePageSizeFormEwallet2').submit();
		})
	

		$(document).on("change","#pageSize2",function()
		{
		     $('#changePageSizeForm2').submit();
			 
		})
		
		$(document).on("change","#pageSizeContent1",function()
		{
			$('#changePageSizeContentForm1').submit();
		})
		$(document).on("change","#pageSizeContent2",function()
		{
			$('#changePageSizeContentForm2').submit();
		})
		
        $(document).on("change", "#pageSizeBuyagain1", function() {
	
		var viewpagination =$("#pageSizeBuyagain1").val();
		$('#changePageSizebuyAgainForm1').find("input#ViewPaginationbuyagain").val(viewpagination);
            
        		$('#changePageSizebuyAgainForm1').submit();
        })
        $(document).on("change", "#pageSizeBuyagain2", function() {
	
	
		var viewpagination =$("#pageSizeBuyagain2").val();
		$('#changePageSizebuyAgainForm2').find("input#ViewPaginationbuyagain").val(viewpagination);
            
        		$('#changePageSizebuyAgainForm2').submit();
        })

        
		$("#filterByDateBuyagain, #pageSizeBuyagain1").on("change",function()
		{
			
		var viewpagination =$("#pageSizeBuyagain1").val();
		$('#changePageSizebuyAgainForm1').find("input#ViewPaginationbuyagain").val(viewpagination);
			$('#changePageSizebuyAgainForm1').submit();
		});
			
	},
	
	changeinvoicesort: function ()
	{
		 var cmspageid = $("#cmspageuid").val();
		$(document).on("change",".invoice_sort",function() 
		{  
		  if(cmspageid != 'orders')
	    {
			var searchParam = $("#search-invoice").val();
			var dateFrom= $("#dateFrom").val();
			var dateTo= $("#dateTo").val();
			var viewpagination =$("#pageSizeInvoice1").val();
			var invoiceShiptos = $("#shipToSelected_inv").val();
			var sortType = $("#sortOptions1").val();
			$('#sortForm1').find("input#search-invoice").val(searchParam);
			$('#sortForm1').find("input#dateFromnew").val(dateFrom);
			$('#sortForm1').find("input#dateTonew").val(dateTo);
			$('#sortForm1').find("input#sortOptions1").val(sortType);
			$('#sortForm1').find("input#ViewPaginationInvoice").val(viewpagination);
			$('#sortForm1').submit();
			$('$search-invoice').text($('$search-invoice-id').val());
		 }
		  else
			  {
			  var searchParam = $("#searchOrderHistory").val();
				var dateSort= $("#dateSort").val();
				var viewpagination =$("#pageSizeOrder1").val();
				var accountShiptos = $("#shipToSelected_order").val();
				var sortType = $("#sortOptions1").val();
				$('#sortForm1').find("input#searchOrderHistory").val(searchParam);
				$('#sortForm1').find("input#dateSortOrder").val(dateSort);
				$('#sortForm1').find("input#sortOptions1").val(sortType);
				$('#sortForm1').find("input#ViewPaginationOrder").val(viewpagination);
				$('#sortForm1').submit();
				$('$searchOrderHistory').text($('$search-order-id').val());
				
				
			  }
		})
		$(document).on("change","#sortOptions2",function() 
		{    
			if(cmspageid != 'orders')
		    {
			var searchParam = $("#search-invoice").val();
			var dateFrom= $("#dateFrom").val();
			var dateTo= $("#dateTo").val();
			var viewpagination =$("#pageSizeInvoice2").val();
			var invoiceShiptos = $("#shipToSelected_inv").val();
			var sortType = $("#sortOptions1").val();
			$('#sortForm2').find("input#search-invoicenew").val(searchParam);
			$('#sortForm2').find("input#dateFromnew").val(dateFrom);
			$('#sortForm2').find("input#dateTonew").val(dateTo);
			$('#sortForm2').find("input#ViewPaginationInvoice").val(viewpagination);
			$('#sortForm2').find("input#shipToSelected_inv").val(invoiceShiptos);
			$('#sortForm2').find("input#sortOptions1").val(sortType);
			$('#sortForm2').submit();
			$('$search-invoice').text($('$search-invoice-id').val());
		    }
			else
			  {
			  var searchParam = $("#searchOrderHistory").val();
			  var dateSort= $("#dateSort").val();
				var viewpagination =$("#pageSizeOrder2").val();
				var accountShiptos = $("#shipToSelected_order").val();
				var sortType = $("#sortOptions1").val();
				$('#sortForm2').find("input#searchOrderHistory").val(searchParam);
				$('#sortForm2').find("input#dateSortOrder").val(dateSort);
				$('#sortForm2').find("input#sortOptions1").val(sortType);
				$('#sortForm2').find("input#ViewPaginationOrder").val(viewpagination);
				$('#sortForm2').find("input#shipToSelected_order").val(accountShiptos);
				$('#sortForm2').submit();
				$('$searchOrderHistory').text($('$search-order-id').val());
			  }
		})
	},
	changeUserSort : function(){
		 var cmspageid = $("#cmspageuid").val();
			$(document).on("change",".user_sort",function() 
			{  
			  if(cmspageid == 'my-company')
		    {
				  var searchParam = $("#manager-user-voice").val();
				  var viewpagination =$("#pageSizeManagerUser1").val();
				  var shiptounit = $("#shipToSelected_user").val();
				  var adminCheck = $('#admin_User').val();
				  var sortType = $("#sortOptions1").val();
				  $('#sortForm1').find("input#manager-user-voice").val(searchParam);
				  $('#sortForm1').find("input#ViewPaginationmanager").val(viewpagination);
				  $('#sortForm1').find("input#sortType").val(sortType);
				  $('#sortForm1').find("input#shipToSelected_user").val(shiptounit);
				  $('#sortForm1').find("input#admin_User").val(adminCheck);
				  $('#sortForm1').submit();
				  $('$manager-user-voice').text($('$manager-user-voice').val());
			 }
			})
			  $(document).on("change","#sortOptions2",function() {    
						if(cmspageid == 'my-company')
				{
				  var searchParam = $("#manager-user-voice").val();
				  var viewpagination =$("#pageSizeManagerUser1").val();
				  var shiptounit = $("#shipToSelected_user").val();
				  var adminCheck = $('#admin_User').val();
				  var sortType = $("#sortOptions2").val();
				  $('#sortForm2').find("input#manager-user-voice").val(searchParam);
				  $('#sortForm2').find("input#ViewPaginationmanager").val(viewpagination);
				  $('#sortForm2').find("input#sortType").val(sortType);
				  $('#sortForm2').find("input#shipToSelected_user").val(shiptounit);
				  $('#sortForm2').find("input#admin_User").val(adminCheck);
				  $('#sortForm2').submit();
				  $('$manager-user-voice').text($('$manager-user-voice').val());
					
					
				  }
			})
		
	},
	chooseTab : function ()
	{	
		$(document).on("click","ul.tabs li",function(e)
		{
			e.preventDefault();
			var freeText='';
			var tabId = $(this).attr('data-tab');
			var url = window.location.href;
			var textParamStr = url.split('&')[1];
			var textParamValue='';
			if(textParamStr != ""){
				textParamValue =  textParamStr.substring(textParamStr.indexOf('=') + 1);
			}
			if(window.location.href.indexOf('content') > 0){
				$('#type').val('content');
				freeText = $('#contentSearchType').data("freeText");
			}
			else{
				$('#type').val('product');
				freeText = textParamValue;
			}
						
			if(tabId == 'productTab') {
				$('#js-site-search-input').val(freeText);
				$('#type').val('product');
				$('#searchBox').submit();
				tabId = 'product';
			}
			else {
				$('#js-site-search-input').val(freeText);
				$('#type').val('content');
				$('#searchBox').submit();
				$('#productTab').addClass('hidden');
				$('.productResults .pagination-bar').first().addClass('hidden');
				tabId = 'content';
				
			}
			if(window.location.href.indexOf('content') < 0){
				$('#type').val('content');
			}
			else{
				$('#type').val('product');
			}
			
		})
	},	
};

 $(document).ready(function ()
{
	ACC.paginationsort.bindAll();
	if($('#type')) {
		if(window.location.href.indexOf('content') > 0) {
			$('#type').val('content');
		} else {
			$('#type').val('product');
		}
		
	}
	if(sessionStorage.getItem("selectedDropdownValueSession")){
		$(".sortSelectSpan option").each(function(){
			if($(this).val()==sessionStorage.getItem("selectedDropdownValueSession")){ 
	            $(this).prop('selected', true);   
	        }
			else if(!$(".page-accountOrdersPage").length){
				$(this).prop('selected', false); 
			}
		});
		}
	if(sessionStorage.getItem("selectedDateSort")){
		$(".date-sort-my-orders option").each(function(){
			if($(this).val()==sessionStorage.getItem("selectedDateSort")){ 
	            $(this).prop('selected', true);    
	        }
			else{
				$(this).prop('selected', false); 
			}
		});
		}
	if(sessionStorage.getItem("mobileSortSelection")){
		$(".mobile-sort option").each(function(){
			
			if($(this).val()==sessionStorage.getItem("mobileSortSelection")){ 
				$(this).prop('selected', true);   
			}
			else{
				$(this).prop('selected', false); 
			}
		});
		}
	
	 
});
ACC.partner = {
	_autoload: [
		"popupEnable",
		"PartnerPageAnalyticData"
	],
	dashboardPage: ($(".page-accountPartnerProgramPage").length) ? true : false,
	contentPage: ($(".page-pilotPartnersProgramPage").length) ? true : false,
	perksPage: ($(".page-partnerPerksPage").length) ? true : false,
	popupEnable: function () { //creating partners enroll popup's HTML
		if (ACC.partner.contentPage || ACC.partner.dashboardPage || ACC.partner.perksPage) {
			let popupHtml = '<div class="enroll-popup-content hidden"><div class="row text-default font-Geogrotesque text-center"><div class="col-md-offset-2 col-md-8 col-xs-offset-2 col-xs-8 m-b-20-xs"><img src="/_ui/responsive/theme-lambda/images/partner_logo.png" alt="partners-program" title="partners-program" /></div><div class="col-md-12 enroll-confirm"><h4 class="bold">' + ACC.config.partnerBecome + '</h4><p>' + ACC.config.partnerGet1 + '</p></div><div class="col-md-12 enroll-done"><h4 class="bold">' + ACC.config.partnerCongratulations + '</h4><h4 class="bold">' + ACC.config.partnerPPMember + '</h4><p>' + ACC.config.partnerEarningRewards + '</p></div><div class="col-md-6 marginTop40 no-margin-xs hidden-xs hidden-sm enroll-confirm enroll-done"><button class="btn btn-default btn-block enroll-close enroll1">' + ACC.config.partnerCancel + '</button></div><div class="col-md-6 marginTop40 enroll-confirm enroll-done"><button class="btn btn-primary btn-block enroll-confirm" onclick="ACC.partner.enrollModal(\'progress\',\'false\')">' + ACC.config.partnerEnroll + '</button><button class="btn btn-primary btn-block enroll-done enroll-tracking" onclick="location.href=\'' + ACC.config.encodedContextPath + '/my-account/accountPartnerProgram\'">' + ACC.config.partnerPoints + '</button></div><div class="col-md-6 marginTop40 no-margin-xs hidden-md hidden-lg enroll-confirm enroll-done"><button class="btn btn-default btn-block enroll-close enroll2">' + ACC.config.partnerCancel + '</button></div><div class="col-md-12 col-xs-12 enroll-progress"><div id="floatBarsG"><div id="floatBarsG_1" class="floatBarsG"></div><div id="floatBarsG_2" class="floatBarsG"></div><div id="floatBarsG_3" class="floatBarsG"></div><div id="floatBarsG_4" class="floatBarsG"></div><div id="floatBarsG_5" class="floatBarsG"></div><div id="floatBarsG_5" class="floatBarsG"></div><div id="floatBarsG_6" class="floatBarsG"></div><div id="floatBarsG_7" class="floatBarsG"></div><div id="floatBarsG_8" class="floatBarsG"></div></div><h4 class="bold marginTop40">' + ACC.config.partnerHang + '</h4></div></div></div>';
			$(".page-pilotPartnersProgramPage, .page-accountPartnerProgramPage, .page-partnerPerksPage").append(popupHtml);
			if ($(".partner-enrolled-true").length && ACC.partner.dashboardPage) {
				ACC.partner.partnersEnrollStatus();
			}
			
			_AAData.pathingPageName= "Contractor Services: Partners";
			_AAData.pathingChannel= "Contractor Services";
		}
		if(ACC.partner.dashboardPage && $(".partner-section").attr("data-pilot") == "true"){
			$(".global-alerts").addClass("hidden");
		}
		if(ACC.partner.perksPage){
			ACC.global.partnerCarouselIndicators("#partnerCarousel", "#perksCarousel", 100);
		}
	},
	enrollModal: function (mode, close, conentPage) {	//opening partners enroll popup
		let modalClose = (close == 'true') ? true : false;
		$(".enroll-popup-content").find(".enroll-confirm, .enroll-progress, .enroll-done").addClass("hidden");
		$(".enroll-popup-content .enroll-" + mode).removeClass("hidden");
		$(".enroll-popup-content .enroll-close").attr("onclick", (conentPage) ? "location.href=\'" + ACC.config.encodedContextPath + "/Partners\'" : (modalClose) ? "ACC.colorbox.close()" : "location.href=\'" + ACC.config.encodedContextPath + "/my-account/accountPartnerProgram\'");
		ACC.colorbox.open("", {
			html: $(".enroll-popup-content").html(),
			width: "450px",
			escKey: false,
			overlayClose: modalClose,
			closeButton: modalClose,
			className: "enroll-popup"
		});
		if (mode == "progress") {
			$.ajax({
				url: ACC.config.encodedContextPath + '/my-account/enrollCustomerInTalonOne',
				type: 'post',
				success: function (response) {
					if (response) {
						ACC.partner.enrollModal('done', 'false', ACC.partner.contentPage);
					}
				},
				error: function (response) {
					if (response) {
						ACC.partner.enrollModal('done', 'false', ACC.partner.contentPage);
					}
				}
			});
		}
	},
	partnersEnrollStatus: function () {	//checking the Talon One Enroll Status
		$.ajax({
			url: ACC.config.encodedContextPath + '/my-account/getTalonOneLoyaltyStatus',
			type: 'get',
			success: function (response) {
				if (response == true) {
					$(".partner-enrolled-true").removeClass("hidden");
				}
				else {
					$(".partner-enrolled-false").removeClass("hidden");
				}
			},
			error: function () {
				$(".partner-enrolled-false").removeClass("hidden");
			}
		});
	},
	PartnerPageAnalyticData:function(){
		$(document).on("click", ".enroll-tracking, button.enroll-confirm", function(e){
			var linkName= $(this).text();
			digitalData.eventData={
				  linktype:"",
				  linkName:linkName,
				  onClickPageName: "Contractor Services: Partners"
			}
			try {
				_satellite.track('linkClicks');
			}catch(e){}
		})
		
		$(document).on("click", "button.enroll-close", function(){
			console.log("lll");
			if($(this).attr("onClick")=="ACC.colorbox.close()"){
				 var linkName="Cancel: Enroll";
			}
			if($(this).attr("onClick")=="location.href=\'" + ACC.config.encodedContextPath + "/Partners\'"){
				 var linkName="Cancel: see your points";
			}
			
			digitalData.eventData={
				  linktype:"",
				  linkName:linkName,
				  onClickPageName: "Contractor Services: Partners"
			}
			try {
				_satellite.track('linkClicks');
			}catch(e){}
		})
		
		 
	}
}
ACC.payment = {
		
		activateSavedPaymentButton: function(){

			$(document).on("click",".js-saved-payments",function(e){
				e.preventDefault();
				
				var title = $("#savedpaymentstitle").html();
				
				$.colorbox({
					href: "#savedpaymentsbody",
					inline:true,
					maxWidth:"100%",
					opacity:0.7,
					width:"320px",
					title: title,
					close:'<span class="glyphicon glyphicon-remove"></span>',
					onComplete: function(){
					}
				});
			})
		},
		bindPaymentCardTypeSelect: function ()
		{
			ACC.payment.filterCardInformationDisplayed();
			$("#card_cardType").on('change',function  ()
			{
				var cardType = $(this).val();
				if (cardType == '024')
				{
					$('#startDate, #issueNum').show();
				}
				else
				{
					$('#startDate, #issueNum').hide();
				}
			});
		},
		filterCardInformationDisplayed: function ()
		{
			var cardType = $('#card_cardType').val();
			if (cardType == '024')
			{
				$('#startDate, #issueNum').show();
			}
			else
			{
				$('#startDate, #issueNum').hide();
			}
		}
}

$(document).ready(function () {
	with (ACC.payment) {
		activateSavedPaymentButton();
		bindPaymentCardTypeSelect();
	}
});
	
	
	
ACC.paymentDetails = {
	_autoload: [
		"showRemovePaymentDetailsConfirmation"
	],
	
	showRemovePaymentDetailsConfirmation: function ()
	{
		$(document).on("click", ".removePaymentDetailsButton", function ()
		{
			var paymentId = $(this).data("paymentId");
			var popupTitle = $(this).data("popupTitle");

			ACC.colorbox.open(popupTitle,{
				inline: true,
				href: ACC.config.encodedContextPath + "#popup_confirm_payment_removal_" + paymentId,
				onComplete: function ()
				{
					$(this).colorbox.resize();
				}
			});

		})
	}
}
ACC.pickupinstore = {

	_autoload: [
		"bindClickPickupInStoreButton",
		"bindPickupButton",
		"bindPickupClose",
		"bindPickupInStoreSearch"
	],

	storeId:"",

	unbindPickupPaginationResults:function ()
	{
		$(document).off("click","#colorbox .js-pickup-store-pager-prev")
		$(document).off("click","#colorbox .js-pickup-store-pager-next")
	},

	bindPickupPaginationResults:function ()
	{
		var listHeight=  $("#colorbox .js-pickup-store-list").height();
		var $listitems= $("#colorbox .js-pickup-store-list > li");
		var listItemHeight = $listitems.height();
		var displayCount = 5;
		var totalCount= $listitems.length;
		var curPos=0
		var pageEndPos = (((totalCount/displayCount)-1) * (displayCount*listItemHeight)) * -1;


		$("#colorbox .js-pickup-store-pager-item-all").html(totalCount);

		$("#colorbox .store-navigation-pager").show();



		checkPosition()

		$(document).on("click","#colorbox .js-pickup-store-pager-prev",function(e){
			e.preventDefault();
			$listitems.css("transform","translateY("+(curPos+listHeight)+"px)")
			curPos = curPos+listHeight;
			checkPosition("prev");
		})

		$(document).on("click","#colorbox .js-pickup-store-pager-next",function(e){
			e.preventDefault();
			$listitems.css("transform","translateY("+(curPos-listHeight)+"px)")
			curPos = curPos-listHeight;
			checkPosition("next");
		})

		function checkPosition(){

			var curPage = Math.ceil((curPos/(displayCount*listItemHeight))*-1)+1;
			$("#colorbox .js-pickup-store-pager-item-from").html(curPage*displayCount-4);

			var tocount = (curPage*displayCount > totalCount)? totalCount :curPage*displayCount;

			if(curPage*displayCount-4 == 1){
				$("#colorbox .js-pickup-store-pager-prev").hide()
			}else{
				$("#colorbox .js-pickup-store-pager-prev").show()
			}

			if(curPage*displayCount >= totalCount){
				$("#colorbox .js-pickup-store-pager-next").hide()
			}else{
				$("#colorbox .js-pickup-store-pager-next").show()
			}


			$("#colorbox .js-pickup-store-pager-item-to").html(tocount);
		}
	},



	bindPickupInStoreQuantity:function(){
		$('.pdpPickupQtyPlus').on('click',function (e){
			e.preventDefault();

			var inputQty = $('.js-add-pickup-cart #pdpPickupAddtoCartInput');
			var currentVal = parseInt(inputQty.val());
			var maxVal = inputQty.data('max');

			if (!isNaN(currentVal) && currentVal < maxVal) {
				inputQty.val(currentVal + 1);
				inputQty.change();
			}
		});

		$('.pdpPickupQtyMinus').on('click',function (e){
			e.preventDefault();
			var inputQty = $('.js-add-pickup-cart #pdpPickupAddtoCartInput');
			var currentVal = parseInt(inputQty.val());
			var minVal = inputQty.data('min');

			if (!isNaN(currentVal) && currentVal > minVal) {
				inputQty.val(currentVal - 1);
				inputQty.change();
			}
		});

		$("body").on("keyup", ".js-add-pickup-cart #pdpPickupAddtoCartInput", function(event) {
			var input = $(event.target);
			input.val(this.value.match(/[0-9]*/));
			var value = input.val();
		});
	},

	bindPickupInStoreSearch: function ()
	{
		$(document).on('click', '#pickupstore_location_search_button', function (e)
		{
			ACC.pickupinstore.locationSearchSubmit($('#locationForSearch').val(), $('#atCartPage').val(), $('#entryNumber').val(), $(this).parents('form').attr('action'));
			return false;
		});

		$(document).on('keypress', '#locationForSearch', function (e)
		{
			if (e.keyCode === 13)
			{
				e.preventDefault();
				ACC.pickupinstore.locationSearchSubmit($('#locationForSearch').val(), $('#atCartPage').val(), $('input.entryNumber').val(), $(this).parents('form').attr('action'));
				return false;
			}
		});
	},

	bindPickupHereInStoreButtonClick: function ()
	{
		$(document).on('click','.pickup_add_to_bag_instore_button', function (e){
			$(this).prev('.hiddenPickupQty').val($('#pickupQty').val());
		});

		$(document).on('click','.pickup_here_instore_button', function (e){
			$(this).prev('.hiddenPickupQty').val($('#pickupQty').val());
			ACC.colorbox.close();
		});
	},

	locationSearchSubmit: function (location, cartPage, entryNumber, productCode, latitude, longitude)
	{
		$("#colorbox .js-add-to-cart-for-pickup-popup, #colorbox .js-qty-selector-minus, #colorbox .js-qty-selector-input, #colorbox .js-qty-selector-plus").attr("disabled","disabled");

		$.ajax({
			url: productCode,
			data: {locationQuery: location, cartPage: cartPage, entryNumber: entryNumber, latitude: latitude, longitude: longitude},
			type: "post",
			success: function (response)
			{
				ACC.pickupinstore.refreshPickupInStoreColumn(response);
			}
		});
	},

	createListItemHtml: function (data,id){

		var item="";
		item+='<li class="pickup-store-list-entry">';
		item+='<input type="radio" name="storeNamePost" value="'+data.displayName+'" id="pickup-entry-'+id+'" class="js-pickup-store-input" data-id="'+id+'">';
		item+='<label for="pickup-entry-'+id+'" class="js-select-store-label">';
		item+='<span class="pickup-store-info">';
		item+='<span class="pickup-store-list-entry-name">'+data.displayName+'</span>';
		item+='<span class="pickup-store-list-entry-address">'+data.line1+' '+data.line2+'</span>';
		item+='<span class="pickup-store-list-entry-city">'+data.town+'</span>';
		item+='</span>';
		item+='<span class="store-availability">';
		item+='<span class="available">'+data.formattedDistance+'<br>'+data.stockPickup+'</span>';
		item+='</span>';
		item+='</label>';
		item+='</li>';

		return item;
	},

	refreshPickupInStoreColumn: function (data){

		data = JSON.parse(data);

		var listitems = "";

		$("#colorbox .js-pickup-component").data("data",data);

		for(i = 0;i < data["data"].length;i++){
			listitems += ACC.pickupinstore.createListItemHtml(data["data"][i],i)
		}

		$('#colorbox .js-pickup-store-list').html(listitems);
		ACC.pickupinstore.unbindPickupPaginationResults()
		ACC.pickupinstore.bindPickupPaginationResults()

		// select the first store
		var firstInput= $("#colorbox .js-pickup-store-input")[0];
		$(firstInput).trigger('click');


		$("#colorbox .js-add-to-cart-for-pickup-popup, #colorbox .js-qty-selector-minus, #colorbox .js-qty-selector-input, #colorbox .js-qty-selector-plus").removeAttr("disabled");


	},

	bindClickPickupInStoreButton :function()
	{


		$(document).on("click",".js-pickup-in-store-button",function(e){
			e.preventDefault();
			var ele = $(this);
			var productId = "pickupModal_" + $(this).attr('id');
			var cartItemProductPostfix = '';
			var productIdNUM = $(this).attr('id');
			productIdNUM = productIdNUM.split("_");
			productIdNUM = productIdNUM[1];

			if (productId !== null)
			{
				cartItemProductPostfix = '_' + productId;
			}

			var boxContent =  $("#popup_store_pickup_form > #pickupModal").clone();
			var titleHeader = $('#pickupTitle > .pickup-header').html();


			ACC.colorbox.open(titleHeader,{
				html:boxContent,
				width:"960px",
				onComplete: function(){

					$("#colorbox .js-add-to-cart-for-pickup-popup, #colorbox .js-qty-selector-minus, #colorbox .js-qty-selector-input, #colorbox .js-qty-selector-plus").attr("disabled","disabled");


					boxContent.show();
					ACC.pickupinstore.pickupStorePager();
					var tabs = $("#colorbox .js-pickup-tabs").accessibleTabs({
						tabhead:'.tabhead',
						tabbody: '.tabbody',
						fx:'show',
						fxspeed: 0,
						currentClass: 'active',
						autoAnchor:true,
						cssClassAvailable:true
					});

					$("#colorbox #pickupModal *").each(function ()
					{
						if($(this).attr("data-id")!= undefined)
						{
							$(this).attr("id", $(this).attr("data-id"));
							$(this).removeAttr("data-id");
						}
					});

					$("#colorbox input#locationForSearch").focus();

					// set a unique id
					$("#colorbox #pickupModal").attr("id", productId);

					// insert the product image
					$("#colorbox #" + productId + " .thumb").html(ele.data("img"));

					// insert the product cart details
					$("#colorbox #" + productId + " .js-pickup-product-price").html(ele.data("productcart"));


					var variants=ele.data("productcartVariants");
					var variantsOut="";

					$.each(variants,function(key,value){

						variantsOut += "<span>"+value+"</span>";

					})

					$("#colorbox #" + productId + " .js-pickup-product-variants").html(variantsOut);


					// insert the product name
					$("#colorbox  #" + productId + " .js-pickup-product-info").html(ele.data("productname"))

					// insert the form action
					$("#colorbox #" + productId + " form.searchPOSForm").attr("action", ele.data("actionurl"));

					// set a unique id for the form
					$("#colorbox #" + productId + " form.searchPOSForm").attr("id", "pickup_in_store_search_form_product_" + productIdNUM);

					// set the quantity, if the quantity is undefined set the quantity to the data-value defined in the jsp
					$("#colorbox #" + productId + " #pdpPickupAddtoCartInput").attr("value", ($('#pdpPickupAddtoCartInput').val() !== undefined ? $('#pdpPickupAddtoCartInput').val() : ele.data("value")));
					// set the entry Number
					$("#colorbox #" + productId + " input#entryNumber").attr("value", ele.data("entrynumber"));
					// set the cartPage bolean
					$("#colorbox #" + productId + " input#atCartPage").attr("value", ele.data("cartpage"));

					
					if(navigator.geolocation){
						navigator.geolocation.getCurrentPosition(
							function (position){
								ACC.pickupinstore.locationSearchSubmit('', $('#atCartPage').val(),  ele.data("entrynumber"), ele.data("actionurl"),position.coords.latitude, position.coords.longitude);
							},
							function (error){
									console.log("An error occurred... The error code and message are: " + error.code + "/" + error.message);
							}
						);
					}
					
					ACC.product.bindToAddToCartStorePickUpForm();

					
				}

			});

		})
	},

	pickupStorePager:function()
	{
		$(document).on("change","#colorbox .js-pickup-store-input",function(e){
			e.preventDefault();


			$("#colorbox .js-pickup-tabs li.first a").trigger('click');

			var storeData=$("#colorbox .js-pickup-component").data("data");
			storeData=storeData["data"];

			var storeId=$(this).data("id");

			var $ele = $("#colorbox .display-details");


			$.each(storeData[storeId],function(key,value){
				if(key=="url"){
					if(value!=""){
						$ele.find(".js-store-image").html('<img src="'+value+'" alt="" />');
					}else{
						$ele.find(".js-store-image").html('');
					}
				}else if(key=="productcode"){
					$ele.find(".js-store-productcode").val(value);
				}
				else if(key=="openings"){
					if(value!=""){
						var $oele = $ele.find(".js-store-"+key);
						var openings = "";
						$.each(value,function(key2,value2){
							openings += "<dt>"+key2+"</dt>";
							openings += "<dd>"+value2+"</dd>";
						});

						$oele.html(openings);

					}else{
						$ele.find(".js-store-"+key).html('');
					}

				}
				else if(key=="specialOpenings"){}
				else{
					if(value!=""){
						$ele.find(".js-store-"+key).html(value);
					}else{
						$ele.find(".js-store-"+key).html('');
					}
				}

			})





			$(document).one("click", "#colorbox .js-pickup-map-tab",function(){
				ACC.pickupinstore.storeId = storeData[storeId];
				ACC.global.addGoogleMapsApi("ACC.pickupinstore.drawMap");
			})

			
			

			var e=$("#colorbox .pickup-store-list-entry input:checked");


			$("#add_to_cart_storepickup_form .js-store-id").attr("id",e.attr("id"))
			$("#add_to_cart_storepickup_form .js-store-id").attr("name",e.attr("name"))
			$("#add_to_cart_storepickup_form .js-store-id").val(e.val())

			if(storeData[storeId]["stockLevel"] > 0 || storeData[storeId]["stockLevel"] == "")
			{
				var input = $("#add_to_cart_storepickup_form .js-qty-selector-input");
				input.data("max",storeData[storeId]["stockLevel"]); 
				ACC.productDetail.checkQtySelector(input, "reset");
				$("#add_to_cart_storepickup_form").show()
				
			} else{
				$("#add_to_cart_storepickup_form").hide()
			}


		})

		$(document).on("click",".js-select-store-label",function(e){
			$("#colorbox .js-pickup-component").addClass("show-store");
			$("#colorbox #cboxTitle .headline-inner").addClass('hidden-xs hidden-sm');
			$("#colorbox #cboxTitle .back-to-storelist").removeClass('hidden-xs hidden-sm');
		})

		$(document).on("click",".js-back-to-storelist",function(e){
			$("#colorbox .js-pickup-component").removeClass("show-store");
			$("#colorbox #cboxTitle .headline-inner").removeClass('hidden-xs hidden-sm');
			$("#colorbox #cboxTitle .back-to-storelist").addClass('hidden-xs hidden-sm');
		})

	},


	bindPickupButton : function(){
		$(document).on("click",".js-pickup-button",function(e){
			e.preventDefault();
			$e = $(this).parent().nextAll(".js-inline-layer")
			$e.addClass("open")

			//$e.height($e.height())
			var h= $e.height()
			$e.removeClass("open")

			$e.animate({
				height: h
			})
		})
	},


	bindPickupClose : function(){
		$(document).on("click",".js-close-inline-layer",function(e){
			e.preventDefault();
			$e = $(this).parents(".js-inline-layer")

			$e.animate({
				height: 0
			})
		})
	},
	
	checkIfPointOfServiceIsEmpty: function (cartEntryDeliveryModeForm)
	{
		return (!cartEntryDeliveryModeForm.find('.pointOfServiceName').text().trim().length);
	},
	
	validatePickupinStoreCartEntires: function ()
	{
		var validationErrors = false;
		$("form.cartEntryShippingModeForm").each(function ()
		{
			var formid = "#" + $(this).attr('id');
			if ($(formid + ' input[value=pickUp][checked]').length && ACC.pickupinstore.checkIfPointOfServiceIsEmpty($(this)))
			{
				$(this).addClass("shipError");
				validationErrors = true;
			}
		});

		if (validationErrors)
		{
			$('div#noStoreSelected').show().focus();
			$(window).scrollTop(0);
		}
		return validationErrors;
	},

	
	drawMap: function(){

		storeInformation = ACC.pickupinstore.storeId;

		if($("#colorbox .js-map-canvas").length > 0)
		{			


			$("#colorbox .js-map-canvas").attr("id","pickup-map")
			var centerPoint = new google.maps.LatLng(storeInformation["storeLatitude"], storeInformation["storeLongitude"]);
			
			var mapOptions = {
				zoom: 13,
				zoomControl: true,
				panControl: true,
				streetViewControl: false,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				center: centerPoint
			}
			
			var map = new google.maps.Map(document.getElementById("pickup-map"), mapOptions);
			
			var marker = new google.maps.Marker({
				position: new google.maps.LatLng(storeInformation["storeLatitude"], storeInformation["storeLongitude"]),
				map: map,
				title: storeInformation["name"],
				icon: "https://maps.google.com/mapfiles/marker" + 'A' + ".png"
			});
			var infowindow = new google.maps.InfoWindow({
				content: storeInformation["name"],
				disableAutoPan: true
			});
			google.maps.event.addListener(marker, 'click', function (){
				infowindow.open(map, marker);
			});
		}
		
	}

};
ACC.product = {

  _autoload: [
    "bindToAddToCartForm",
    "enableStorePickupButton",
    "enableVariantSelectors",
    "bindFacets",
    "bindRetailPrice",
    "bindCustomerSpecificPrice",
    "bindProductCompare",
    "bindCompareSpan",
    "imageResize",
    "searchSuggestion",
    "orderOnlinePopup",
    "getProductCodeName",
    "disableRightclick",
    "checkProductImagePdp",
    "getsortValue",
    "pdpPlusMinusQty",
    "showMoreAndLess",
    "productVariant",
    "checkAvlQuantity",
    "checkMinQuantity",
    "checkMinQuantityPLP",
    "checkMaxQuantityonhandPLP",
    "CheckMinintervalPLP",
    "bindRelatedArticle",
    "checkPdpStoreDetail",
    "curatedplp",
    "cplpredirectUrl",
    "constructCompareProducts",
    "bindSelectedProducts",
    "bindSelectedProductslistview",
    ["bindCompareRemoveDisable", $('.remove_compare_product').length >= 3]
    /* ,"handleLeftFacetSectionHeight" */
  ],
  selectedProductsToList: [],

  showMoreAndLess: function (thisElement, state, element, contentMore, contentLess, numberOfitems) {
    switch (state) {
      case "expand": {
        if(element){ 
        element.slice(numberOfitems).removeClass("hidden");
        }
		
		if($(thisElement).hasClass("pdp-variant-link")){
			$(thisElement).text(contentLess+' '+ACC.config.variantItems);
		}
		else if(!$(thisElement).hasClass("add-cart_selected_filter")){
        	$(thisElement).text(contentLess);
		} 
        if ($(thisElement).hasClass("show-tracking-details")) {
          $(thisElement).prepend("<span class='icon-minus-circle'></span>&nbsp;");
        }
        $(thisElement).data('state', 'collapse');
        $(window).scrollTop(window.scrollY-10);
        windowimageScroll();
        if($(element).parent().hasClass("js-facet-list")) {
          $(thisElement).remove();
      }
        break;
      }
      case "collapse": {
      	if(element){ 
        element.slice(numberOfitems).addClass("hidden");
        }
		if($(thisElement).hasClass("pdp-variant-link")){
			$(thisElement).text(contentMore+' '+$(thisElement).data("remaining")+' '+ACC.config.variantMoreitems);
		}
		else if(!$(thisElement).hasClass("add-cart_selected_filter")){
        	$(thisElement).text(contentMore);
		}
        if ($(thisElement).hasClass("show-tracking-details")) {
          $(thisElement).prepend("<span class='icon-plus-circle'></span>&nbsp;");
        }
        $(thisElement).data('state', 'expand');
        windowimageScroll();
        break;
      }
      case undefined: break;
    }
  },
  validateShippingQty: function(cardelement){
    if($(".pagename").val()=='Product Grid' || $(".pagename").val()== 'Search Results'){ //search handled
    let enteredQty = $(cardelement).val();
    let maxShipQty =$(cardelement).data("maxqty");
    let productCode = $(cardelement).data("productcode");
    let isShippingOnlyPLP = $(`#shipping_${productCode}`).data("shippingonly");
    if(isShippingOnlyPLP==="shippingonly" && enteredQty>maxShipQty){
        $(`#plp-commonshippingonlyqtyerror-${productCode}`).removeClass('hidden');
        $(`.js-atc-${productCode}`).prop("disabled", true).addClass("disabled");
        // console.log("qty exceeds");
    }else{
        $(`#plp-commonshippingonlyqtyerror-${productCode}`).addClass('hidden');
        $(`.js-atc-${productCode}`).prop("disabled", false).removeClass("disabled");
        //  console.log("qty ok");
    }
    }
},
  bindSelectedProducts: function () {
    $(document).on("change", ".custom-checkbox", function(e) {
      if (($(".plpviewtype").val() == "card")) {
        let checkboxLabel = $(this).siblings(".checkbox-label");
        let productItem = $(this).closest('.plp-card');
        if($(this).is(":checked")) {
          checkboxLabel.text("Selected");
          productItem.addClass("selected");
        } else {
          checkboxLabel.text("Select");
          productItem.removeClass("selected");
        }
        const checkedCount = $(".custom-checkbox:checked").length;
         $(".add-multiple-to-cart-btn").text(`Add (${checkedCount}) to Cart`);
         $(".add-multiple-to-list-btn").text(`Add (${checkedCount}) to List`);
        if(checkedCount > 0) {
          $(".add-multiple-to-cart-btn").removeAttr("disabled");
          $(".add-multiple-to-list-btn").removeAttr("disabled");
        } else {
          $(".add-multiple-to-cart-btn").attr("disabled", "disabled");
          $(".add-multiple-to-list-btn").attr("disabled", "disabled");
        }
      }
      ACC.product.restrictProductsToCart();
    });
    $(".add-multiple-to-cart-btn").click(function() {
      const selectedProducts = [];
      $(".custom-checkbox:checked").each(function() {
        let productCode = $(this).closest(".product-item").find('.plp-item-code[value!=""]').first().val();
        let quantity = Number($('#productPLPPostQty_' + productCode).val() || 1);
        if($(this).closest('.product-item').hasClass("card-variant-item")) {
          quantity = Number($(this).closest('.card-variant-item').find('.js-variant-qty').val() || 1);
        }
        let uomId = $(this).closest(".product-item").find('.productInventoryUOMID_' + productCode + '[value!=""]').first().val() || '';
        if (selectedProducts.indexOf(`${productCode}|${quantity}|${uomId}`) == -1) {
          selectedProducts.push(`${productCode}|${quantity}|${uomId}`);
        }
      });
      $(".custom-checkboxplp:checked").each(function() {
        let productCode = $(this).closest(".product-item").find('.plp-item-code[value!=""]').first().val();
        let quantity = Number($('#productPLPPostQty_' + productCode).val() || 1);
        if($(this).closest('.product-item').hasClass("card-variant-item")) {
          quantity = Number($(this).closest('.card-variant-item').find('.js-variant-qty').val() || 1);
        }
        let uomId = $(this).closest(".product-item").find('.productInventoryUOMID_' + productCode + '[value!=""]').first().val() || '';
        if (selectedProducts.indexOf(`${productCode}|${quantity}|${uomId}`) == -1) {
          selectedProducts.push(`${productCode}|${quantity}|${uomId}`);
        }
      });
      $(".custom-checkboxplpvariant:checked").each(function() {
        let productCode = $(this).closest(".variant-item").find('.plp-item-code[value!=""]').first().val();
        let quantity = Number($('#productPLPPostQty_' + productCode).val() || 1);
        if($(this).closest('.variant-item').hasClass("card-variant-item")) {
          quantity = Number($(this).closest('.card-variant-item').find('.js-variant-qty').val() || 1);
        }
        let uomId = $(this).closest(".variant-item").find('.productInventoryUOMID_' + productCode + '[value!=""]').first().val() || '';
        if (selectedProducts.indexOf(`${productCode}|${quantity}|${uomId}`) == -1) {
          selectedProducts.push(`${productCode}|${quantity}|${uomId}`);
        }
      });
      if(selectedProducts.length && selectedProducts.length > 0) {
        ACC.product.addSelectedProductsToCart(selectedProducts.join(" "));
      }
    });
    $(".add-multiple-to-list-btn").click(function() {
	  ACC.product.selectedProductsToList = [];
      $(".custom-checkbox:checked").each(function() {
        let productItemNumber = $(this).closest(".product-item").find('.plp-item-number[value!=""]').first().val();
        let productCode = $(this).closest(".product-item").find('.plp-item-code[value!=""]').first().val();
        let quantity = Number($('#productPLPPostQty_' + productCode).val() || 1);
        if($(this).closest('.product-item').hasClass("card-variant-item")) {
          quantity = Number($(this).closest('.card-variant-item').find('.js-variant-qty').val() || 1);
        }
        let uomId = $(this).closest(".product-item").find('.productInventoryUOMID_' + productCode + '[value!=""]').first().val() || '';
        if(ACC.product.selectedProductsToList.indexOf(`${productItemNumber}|${quantity}|${uomId}`) == -1) {
          ACC.product.selectedProductsToList.push(`${productItemNumber}|${quantity}|${uomId}`);
        }
      });
      $(".custom-checkboxplp:checked").each(function() {
        let productItemNumber = $(this).closest(".product-item").find('.plp-item-number[value!=""]').first().val();
        let productCode = $(this).closest(".product-item").find('.plp-item-code[value!=""]').first().val();
        let quantity = Number($('#productPLPPostQty_' + productCode).val() || 1);
        if($(this).closest('.product-item').hasClass("card-variant-item")) {
          quantity = Number($(this).closest('.card-variant-item').find('.js-variant-qty').val() || 1);
        }
        let uomId = $(this).closest(".product-item").find('.productInventoryUOMID_' + productCode + '[value!=""]').first().val() || '';
        if(ACC.product.selectedProductsToList.indexOf(`${productItemNumber}|${quantity}|${uomId}`) == -1) {
          ACC.product.selectedProductsToList.push(`${productItemNumber}|${quantity}|${uomId}`);
        }
      });
      $(".custom-checkboxplpvariant:checked").each(function() {
        let productItemNumber = $(this).closest(".variant-item").find('.plp-item-number[value!=""]').first().val();
        let productCode = $(this).closest(".variant-item").find('.plp-item-code[value!=""]').first().val();
        let quantity = Number($('#productPLPPostQty_' + productCode).val() || 1);
        if($(this).closest('.variant-item').hasClass("card-variant-item")) {
          quantity = Number($(this).closest('.card-variant-item').find('.js-variant-qty').val() || 1);
        }
        let uomId = $(this).closest(".variant-item").find('.productInventoryUOMID_' + productCode + '[value!=""]').first().val() || '';
        if(ACC.product.selectedProductsToList.indexOf(`${productItemNumber}|${quantity}|${uomId}`) == -1) {
          ACC.product.selectedProductsToList.push(`${productItemNumber}|${quantity}|${uomId}`);
        }
      });
    });
  },
  bindSelectedProductslistview: function (){
    $(document).on("change", ".custom-checkboxlistplp", function(e) {
     
    if (($(".plpviewtype").val() == "list")) {
      if($(this).is(":checked")) {
        $(this).closest('.product-list-view').addClass("selected");
      } else {
        $(this).closest('.product-list-view').removeClass("selected");
      }
      const checkedCount = $(".custom-checkboxlistplp:checked").length;
       $(".add-multiple-to-cart-btn").text(`Add (${checkedCount}) to Cart`);
       $(".add-multiple-to-list-btn").text(`Add (${checkedCount}) to List`);
      if(checkedCount > 0) {
        $(".add-multiple-to-cart-btn").removeAttr("disabled");
        $(".add-multiple-to-list-btn").removeAttr("disabled");
      } else {
        $(".add-multiple-to-cart-btn").attr("disabled", "disabled");
        $(".add-multiple-to-list-btn").attr("disabled", "disabled");
      }
    }
    ACC.product.restrictProductsToCart();
  });
  
  },
  addSelectedProductsToCart: function (prodCodes) {
    loading.start();
    $.ajax({
      type: 'POST',
      url: ACC.config.encodedContextPath + "/savedList/addSelectedItemsToCart",
      dataType: "json",
      data: {
        wishListCode: '',
        productCodes: prodCodes,
      },
      success: function (result) {
        //console.log('---->', result);
        if(result) {
          window.location.href = ACC.config.encodedContextPath +"/cart";
        } else {
          loading.stop();
          window.location.reload(true);
        }
      },
      error: function (jqXHR, textStatus, errorThrown) {
        loading.stop();
        //console.log('Error: ', textStatus, errorThrown);
      }
    });
  },
  addSelectedProductsToList: function (wishlistCode) {
	  const productList = ACC.product.selectedProductsToList.join(" ");
	  let params = {
		  		wishListCode: wishlistCode,
				productItemNumbers: productList,
				currentWishlist: '',
			};
			let apiname = "/savedList/addSelectedToSavedWishlist";
			$.ajax({
				type: 'POST',
				url: ACC.config.encodedContextPath + apiname,
				datatype: "json",
				data: params,
				success: function (result) {
					ACC.colorbox.open("", {
						html: ACC.productDetail.pdppopupHtmlExistingList(ACC.config.listaddedMsg, wishlistCode),
						width: "500px",
						onComplete: function () {
							$('#colorbox').addClass('item-add-list-box');
							$('body').css("overflow-y", "hidden");
							$(document).on("click", ".successListCreation", function () {
								ACC.colorbox.close();
							});
						},
						onClosed: function () {
							$('body').css("overflow-y", "auto");
							$('#colorbox').removeClass('item-add-list-box');
						}
					})
				},
				error: function (xhr, ajaxOptions, thrownError) {
					//console.log('data failure');
				}
			})
  },
  restrictProductsToCart: function () {
		var notAvailable,notAvailable1,callBranchForPrice,changeBranch,changeBranch1,commonATCRestrict,minProductCount = false;
      	$(".custom-checkbox:checked").each(function() {
			  minProductCount = true;
			  notAvailable = $(this).closest(".product-item").find('.stock-section-notavailable-banner').is(":visible");
			  notAvailable1 = $(this).closest(".product-item").find('.stock-section-notavailableonline-listview').is(":visible");
			  callBranchForPrice = $(this).closest(".product-item").find('.callBranchForPrice').is(":visible");
			  changeBranch  = $(this).closest(".product-item").find('.change-contact-branch-section').is(":visible");
			  changeBranch1  = $(this).closest(".product-item").find('.changeBranchSection').is(":visible");
			  if(notAvailable || callBranchForPrice || changeBranch || changeBranch1 || notAvailable1){
				  commonATCRestrict = true;
			  }
		});
		$(".custom-checkboxplp:checked").each(function() {
			  minProductCount = true;
			  notAvailable = $(this).closest(".product-item").find('.stock-section-notavailable-banner').is(":visible");
			  notAvailable1 = $(this).closest(".product-item").find('.stock-section-notavailableonline-listview').is(":visible");
			  callBranchForPrice = $(this).closest(".product-item").find('.callBranchForPrice').is(":visible");
			  changeBranch  = $(this).closest(".product-item").find('.change-contact-branch-section').is(":visible");
			  changeBranch1  = $(this).closest(".product-item").find('.changeBranchSection').is(":visible");
			  if(notAvailable || callBranchForPrice || changeBranch || changeBranch1 || notAvailable1){
				  commonATCRestrict = true;
			  }
		});
		$(".custom-checkboxplpvariant:checked").each(function() {
			  minProductCount = true;
			  notAvailable = $(this).closest(".variant-item").find('.stock-section-notavailable-banner').is(":visible");
			  notAvailable1 = $(this).closest(".variant-item").find('.stock-section-notavailableonline-listview').is(":visible");
			  callBranchForPrice = $(this).closest(".variant-item").find('.callBranchForPrice').is(":visible");
			  changeBranch  = $(this).closest(".variant-item").find('.change-contact-branch-section').is(":visible");
			  changeBranch1  = $(this).closest(".variant-item").find('.changeBranchSection').is(":visible");
			  if(notAvailable || callBranchForPrice || changeBranch || changeBranch1 || notAvailable1){
				  commonATCRestrict = true;
			  }
    	});
    	if(commonATCRestrict){
			 $(".add-multiple-to-cart-btn").attr("disabled", "disabled");
			 $('.common-atc-tooltipmsg').removeClass('remove');
		}else{
			if(minProductCount){
				$(".add-multiple-to-cart-btn").removeAttr("disabled");
			}
			$('.common-atc-tooltipmsg').addClass('remove');
		}
  },
  plpMobileAddListFunction: function (wishlistCode,id) {
        let productItemNumber = $('.plpAddToListMobile-' + id).closest(".product-item").find('.plp-item-number[value!=""]').first().val();
        let productCode = $('.plpAddToListMobile-' + id).closest(".product-item").find('.plp-item-code[value!=""]').first().val();
        let quantity = Number($('#productPLPPostQty_' + productCode).val() || 1);
        if($('.plpAddToListMobile-' + id).closest('.product-item').hasClass("card-variant-item")) {
          quantity = Number($('.plpAddToListMobile-' + id).closest('.card-variant-item').find('.js-variant-qty').val() || 1);
        }
        let uomId = $('.plpAddToListMobile-' + id).closest(".product-item").find('.productInventoryUOMID_' + productCode + '[value!=""]').first().val() || '';
        const productData = `${productItemNumber}|${quantity}|${uomId}`;
	  let params = {
		  		wishListCode: wishlistCode,
				productItemNumbers: productData,
				currentWishlist: '',
			};
			let apiname = "/savedList/addSelectedToSavedWishlist";
			$.ajax({
				type: 'POST',
				url: ACC.config.encodedContextPath + apiname,
				datatype: "json",
				data: params,
				success: function (result) {
					ACC.colorbox.open("", {
						html: ACC.productDetail.pdppopupHtmlExistingList(ACC.config.listaddedMsg, wishlistCode),
						width: "500px",
						onComplete: function () {
							$('#colorbox').addClass('item-add-list-box');
							$('body').css("overflow-y", "hidden");
							$(document).on("click", ".successListCreation", function () {
								ACC.colorbox.close();
							});
						},
						onClosed: function () {
							$('body').css("overflow-y", "auto");
							$('#colorbox').removeClass('item-add-list-box');
						}
					})
				},
				error: function (xhr, ajaxOptions, thrownError) {
					//console.log('data failure');
				}
			})
  },
  bindFacets: function () {
	
	$(document).on("keyup", '.js-plp-qty', function (e) {
		/*let ref = $(this);
		var plpQty=ref.val();
		var isNurseryProduct = ref.data("nurseryproduct");
	 	var nearestStoreStockLevel = ref.data("maxqty");
		if(isNurseryProduct == true && plpQty > nearestStoreStockLevel){
			ref.parents(".product-item-box").find(".qtyerror-plp").removeClass("hidden");
			ref.parents(".product-item-box").find(".btn-primary").attr("disabled", true);
			ref.parents(".product-item-box").find(".icon-red-exclamation").removeAttr("style");
			ref.parents(".product-item-box").find(".plp-qtysection").addClass("plp-qtyBoxError");
	}
	else{
		ref.parents(".product-item-box").find(".qtyerror-plp").addClass("hidden");
		ref.parents(".product-item-box").find(".btn-primary").attr("disabled", false);
		ref.parents(".product-item-box").find(".plp-qtysection").removeClass("plp-qtyBoxError");
	}*/
 	if($(".inventoryCheck_Atc").val() == 'true' && $(".isEligibleForBackorder_Atc").val() == 'true' && $(".item-isForceInStock").val() != "true") {
   		$(".inventoryCheck-and-isEligibleForBackorder").attr("disabled","disabled");
  	}
 });
    $(document).ready(function () {
	horizontalScroll();
      $(window).on("resize", function (e) {
        if(!ACC.product.expandableFacetsFlag){
          expandableFacetsOnMobile();
        }
      });


      $(document).on("click", ".hideShowMoreLink", function(a){
        a.preventDefault();
        var state = $(this).data('state');
        var element = $(this).parent().find('ul.js-facet-list li');
        ACC.product.showMoreAndLess(this, state, element, ACC.config.showAll, ACC.config.showLess, 10);
      });

      expandableFacetsOnMobile();

      function expandableFacetsOnMobile() {
        var newWindowWidth = $(window).width();
          ACC.product.expandableFacetsFlag = true;
          $(document).on("click", ".js-show-facets", function (e) {
            e.preventDefault();
            $('.js-product-facet:not(.category-tiles)').show();
            $('.js-product-facet:not(.category-tiles)').addClass("facet-overflow");
            $('.js-product-facet:not(.category-tiles)').css("position", "fixed");
            $('.js-product-facet:not(.category-tiles)').css("overflow-y", "scroll");
            $('body').addClass("body-overflow");
          });

          $(document).on("click", ".js-product-facet:not(.category-tiles) .js-facet-name", function (e) {
            e.preventDefault();
            if ($(this).parents(".js-facet").hasClass("active")) {
              $(this).parents(".js-facet").removeClass("active");
              $(this).parents(".js-facet").find(".js-facet-values").slideUp();
            } else {
              $(this).parents(".js-facet").addClass("active");
              $(this).parents(".js-facet").find(".js-facet-values").attr("style", "height:max-content");
              $(this).parents(".js-facet").find(".js-facet-values").slideDown();
            }
          });
          $('.refinement-titleWrapper .glyphicon-leanChevron-left').on('click', function () {
            $('.js-product-facet:not(.category-tiles)').removeClass("facet-overflow");
            $('body').removeClass("body-overflow");
            $('.js-product-facet:not(.category-tiles)').hide("slide", { direction: "left" });
          });
          if (newWindowWidth < 481) {
          enquire.register("screen and (min-width:" + screenSmMax + ")", function () {
            $("#cboxClose").trigger('click');
          });
          }
      }
    });

    $(window).on('load', function () {
    });
  },

  expandableFacetsFlag: false,
  //resize images which are not 300 x 300 in PLP
  imageResize: function () {

    $(window).on('load', function () {
      $('.product-item-box img:not(.inventory-message-icon)').each(function () {
        if ($(this).width() != $(this).height()) {
          $(this).css('height', $(this).width());
          $(this).css('width', '100%');
        }
      });
    });
  },

  searchSuggestion: function () {
    var searchText = $("#search").val();
    var suggestion = $("#suggestion").val();
    if (searchText != suggestion) {
      $(".searchSpellingSuggestionPrompt").show();
    }
  },
  bindProductCompare: function () {
    var productCodes = "";
    var categoryCode = $("#categoryCode").val();
    function constructCompareProducts(elem,productCode,productImage){

        if ($(elem).is(':checked')) {
        $(".compareBox .product__compare__checkbox").append("<div class='col-md-4 p" + productCode + "'><div class='img-sec'><div class='delete_product'style='position: absolute; right:13px; top:2px; cursor:pointer;' data-role=" + productCode + ">X</div><img src=" + productImage + "></div></div>");
        productCodes = productCodes.concat(productCode);
        productCodes = productCodes.concat(",");
        if ($(".product__compare__checkbox:checked").length > 1) {
            $(".compareBox").css("display", "block");
          } else {

            $(".compareBox").css("display", "none");
          }
        if ($(".product__compare__checkbox:checked").length >= 3) {
          $(".product__compare__checkbox").not(":checked").attr("disabled", true);

        }

      }
      else {

        if (null != productCode) {
          var selector = ".p" + productCode;
          $(selector).remove();
        }

        var x = productCode + ",";
        productCodes = productCodes.replace(x, "");
        if ($(".product__compare__checkbox:checked").length < 3) {
          $(".product__compare__checkbox").not(":checked").attr("disabled", false);
        }
      }
        
        return productCodes
        
    }
    
    $(".product__compare__checkbox:checked").each(function () {
        var selectedId = $(this).attr('data-role');
        var selectedProductCode = $('#prodCode' + selectedId).val();
        var selectedProductImage = $('#prodImage' + selectedId).val();
        productCodes=constructCompareProducts(this,selectedProductCode,selectedProductImage)
      })
      
      $(document).on("click", ".product__compare__checkbox", function (e) {
          var id = $(this).attr('data-role');
          var productCode = $('#prodCode' + id).val();
          var productImage = $('#prodImage' + id).val();
          if ($(".product__compare__checkbox:checked").length > 1) {
            $(".compareBox").css("display", "block");
          } else {

            $(".compareBox").css("display", "none");
          }
          productCodes=constructCompareProducts(this,productCode,productImage)

        });
        $(document).on("click", ".delete_product", function (e) {
          var productCode = $(this).parent("div").attr("class").split('p')[1];          
          $("input[value=" + productCode + "][name=code]").parent("span").children().closest(".product__compare__checkbox").trigger('click');         

        });
        
        $(document).on("click", "#removeAllCompare", function (e) {
            $(".product__compare__checkbox:checked").trigger('click');

        });

    $(document).on("click", "#btn_Compare", function (e) {
    	
    	if(digitalData.pfm)
    	{
    	  delete digitalData.pfm;
    	  delete digitalData.pfmdetails;
    	}
    	
      if($('body').hasClass("template-pages-layout-siteOneCuratedPlpLayout")){
        digitalData.eventData = {
          linktype:"product-grid",
          linkName:"Add to Cart",
          onClickPageName: $(".pagename").val()
        }
      }else{
        digitalData.eventData = {
          linktype:"catalog",
          linkName:"Add to Cart",
          onClickPageName: $(".pagename").val()
        }
      }
      try {
        _satellite.track("linkClicks");
      } catch (e) { }
      var url = ACC.config.encodedContextPath + "/compare" + "?productCodes=" + productCodes + "&categoryCode=" + categoryCode
      window.location.href = url;
    });


  },
  bindCompareRemoveDisable: function () {

    $(document).on("click", ".remove_compare_product", function (e) {
      e.preventDefault();
      var productCode = $(this).siblings(".details").children("input").attr("value");
      var productCodes = $("#productCodes").val();
      var categoryCode = $("#compare_category_code").val();
      var products = productCodes.split(",");
      var productCodes = '';
      products.forEach(function (e) {
        if (e != productCode) {

          productCodes = productCodes + e + ",";
        }
      });

      var url = ACC.config.encodedContextPath + "/compare" + "?productCodes=" + productCodes + "&categoryCode=" + categoryCode

      window.location.href = url;

    });
  },
 
  enableAddToCartButton: function () {
    $('.js-enable-btn').each(function () {
      if (!($(this).hasClass('outOfStock') || $(this).hasClass('out-of-stock') || ($(this).hasClass('inventoryCheck-and-isEligibleForBackorder')) && ($(".isForceinstockUOM").val() != 'true')) && $(".shippingOnlyDisabled").val() != "true") { 
        $(this).removeAttr("disabled");
      }
      if ($("body").hasClass("page-detailsAssemblyPage") || $("body").hasClass("page-detailsSavedListPage")) {     
        
        var element = $(this).closest(".saved-list-sec").find(".js-update-entry-quantity-input");
        ACC.product.checkAvlQuantity(element);
        }
	  if ($("body").hasClass("page-order")) {
			if($(this).closest(".item__list--header").find(".js-cart-qty-error").is(":visible")){
				 $(this).attr("disabled","disabled")
			}
		}
	  if ($(".account-section-content").hasClass("my-order")) {
			if($(this).closest(".singleorder-product-section").find(".js-cart-qty-error").is(":visible")){
				 $(this).attr("disabled","disabled")
			}
		}
    });
	$("#pdpAddtoCartInput").each(function () {      
	      var $input =$(this);
	        ACC.product.checkMinQuantity($input,0);
	    });
  },
  enableVariantSelectors: function () {
    $('.variant-select').removeAttr("disabled");
  },

  checkCSP: function () {
    $('.productcspCode').each(function () {
      var productCode = $(this).val();
      if ($('#mycspDiv' + productCode).is(':visible')) {
        var isStockAvailable = ($(".isStockAvailablecsp" + productCode).val() == 'true');
        var isLicensed = ($(".isLicensed" + productCode).val() == 'true');
        var isMyStoreProduct = ($(".isMyStoreProduct" + productCode).val() == "true");
        var isRegulateditem = ($(".isRegulateditemcsp" + productCode).val() == "true");
        var isOrderingAccount = ($(".isOrderingAccount" + productCode).val() == "true");
        var csp = $(".csp" + productCode).val();
        var isRup = ($("#isRup" + productCode).val() == 'true');
        var isProductSellable = ($("#isProductSellable" + productCode).val() == 'true');
        let inventoryCheck = ($(".inventoryCheck_" + productCode).val() == "true");
        let isEligibleForBackorder = ($(".isEligibleForBackorder_" + productCode).val() == "true");
        if (csp > 0 && isOrderingAccount && isMyStoreProduct && ((isRegulateditem && isProductSellable && ((isRup && isLicensed) || !isRup)) || !isRegulateditem) && !(inventoryCheck && isEligibleForBackorder)) {
          var eleId="listPageAddToCart_" + productCode;
		  $('[id='+eleId+']').each(function(){
			$(this).attr("disabled", false);
		 });
		  var eleId1="orderOnlineATC_" + productCode;
		  $('[id='+eleId1+']').each(function(){
			$(this).attr("disabled", false);
		 });
        }
      }
    });
  },

  bindToAddToCartForm: function () {
    
   

    var addToCartForm = $('.add_to_cart_form');
    if ((window.location.href.indexOf('/p/') != -1) && $('.js-qty-selector-input').val() != null && $('.js-qty-selector-input').val() != '' && $('.js-qty-selector-input').val() != 0) {
      $(".js-qty-selector-input").attr("value", $('.js-qty-selector-input').val());
    }

    addToCartForm.ajaxForm({
      beforeSubmit: ACC.product.showRequest,
      success: function (data, statusText, xhr, formElement) {
        var productId = formElement.find("[name=productCodePost]").val();
        var productName = formElement.find("[name=productNamePost]").val();
		  if (data != null && data.cartAnalyticsData != null) {
			  var productCategory = data.cartAnalyticsData.productCategory;
			  var productSubCategory = data.cartAnalyticsData.productSubCategory;
			  cartAddAnalytics(productId, productName, productCategory, productSubCategory, _AAData.eventType);
	      if($('.cart-page-container').is( ":visible" )){
	    	  /***For GA4 Analytics add_to_cart Start***/
	    	  ACC.ga4analytics.add_to_cart(
	    			productId,
	    			productName,
    	     		parseFloat(data.cartAnalyticsData.productPostPrice),
    	     		parseInt(formElement.find("[name=productPostPLPQty]").val()),
    	     		'',
    	     		data.cartAnalyticsData.productCategory,
    	     		data.cartAnalyticsData.productSubCategory,
    	     		'',
    	     	);
          rdt("track", "AddToCart", {
            currency: "USD",
            itemCount: 1,
            value: parseFloat(data.cartAnalyticsData.productPostPrice),
            products: [
              {
                id: productId,
                name: productName,
                category: data.cartAnalyticsData.productCategory
              }
            ]
          });
	    	  /***For GA4 Analytics add_to_cart end***/
          window.location.href = ACC.config.encodedContextPath + '/cart';
        }
        else{
          ACC.product.displayAddToCartPopup(data);
        }     
		  }
		else{
				$.cookie("code",$('#productcode').val());
				$.cookie("qty",$(".add_to_cart_form").find('.js-qty-selector-input').val());
				 window.location.reload();
		} 
		
        loading.stop();
      }
    });
    setTimeout(function () {
      $ajaxCallEvent = true;
    }, 2000);

    

    $(document).on("keypress", '.js-qty-updateOne,.js-qty-selector-input', function (e) {
	  if (($(this).val() != " " && ((e.which >= 48 && e.which <= 57) || e.which == 8 ))) {
      }
      else {
        e.preventDefault();
      }
    });


    $(".js-qty-updateOne").keyup(function (e) {
      if (this.value.substring(0, 1) == "0") {
        this.value = this.value.replace(/^0+/g, '1');
      }
    });
    $(".js-qty-updateOne").keyup(function (e) {
	  var productcode = $(e.target).data('productcode');
      ACC.product.checkMinQuantityPLP(('#productPLPPostQty_' +productcode), '');
      $('#productPostPLPQty_' + productcode).val($('#productPLPPostQty_' + productcode).val());
      //ACC.global.qtyTotalPriceUpdaterPLP(productcode);
      if($(".hardscapeProd_" + productcode).length) {
        ACC.product.handleQtyChangeForHardscapeProducts(productcode);
      } else {
        let qtyTarget = $('#productPLPPostQty_' + productcode);
        if (qtyTarget.length) {
          ACC.product.handleQtyChangeForProducts(qtyTarget, productcode);
        }
      }
    });

	  let prevQty = $.cookie("qty");
	  let prevCode = $.cookie("code");
	  let prevForm = $(".add_to_cart_form");
	  if(prevQty && $.trim(prevQty) != "" && prevCode && $.trim(prevCode) ){
					$.cookie("code", '');
	  $.cookie("qty", '');
	  if (prevForm.length == 1) {
		  prevForm.find('.js-qty-selector-input').val(prevQty);
		  prevForm.find('.js-atc-' + prevCode).eq(0).trigger("click");

	  }
  }
  },
  showRequest: function (arr, $form, options) {
    if ($ajaxCallEvent) {
      loading.start();
      $ajaxCallEvent = false;
      return true;
    }
    return false;

  },

  bindToAddToCartStorePickUpForm: function () {
    var addToCartStorePickUpForm = $('#colorbox #add_to_cart_storepickup_form');
    addToCartStorePickUpForm.ajaxForm({ success: ACC.product.displayAddToCartPopup });
  },

  enableStorePickupButton: function () {
    $('.js-pickup-in-store-button').removeAttr("disabled");
  },

   addToModal: function (cartResult) {
		var popupClass="addtocart-bg add-to-cart-overlay-mixedcart";
		var popupWidth="350px";
		var productPriceNum = 0;
		if(cartResult.isSellable){ //recommendation ATC
			popupClass="addtocart-bg add-to-cart-overlay-mixedcart recommendation-overlay";
			popupWidth="445px";
			productPriceNum = 1;
		}
		else { //standard ATC
			if(!$(".customerSpecificPrice").length){
				productPriceNum = 1;
			}
		}
		
		
    ACC.colorbox.open("", {
      html: cartResult.addToCartLayer,
      width: popupWidth,
      open: true,
      right: "0px",
      className: popupClass,
      onComplete: function () {
        (function () {
            const addedFromPDPBulkCalc = $("#showBulkCalculator").is(":visible")
            if (addedFromPDPBulkCalc) {
              const elements = $(".atc-price-analytics")
              const bulkCalcPrice = $(elements[0]).text();
              $(elements[1]).text(bulkCalcPrice);
            }
          })()

		if($(".atc-backorderMsg").val()=="true"){
			var productBackOrder=$(".atc-productQty").val();
		}
		else{
			var productBackOrder="";
		}
		var productUnitPrice = (!$(".add-to-cart-overlay-mixedcart .atc-price-analytics").length)? "$00.00": ($(".add-to-cart-overlay-mixedcart .atc-price-analytics").length == 1)? $(".add-to-cart-overlay-mixedcart .atc-price-analytics").eq(0).text(): $(".add-to-cart-overlay-mixedcart .atc-price-analytics").eq(productPriceNum).text();
     	digitalData.product = [{
		    productInfo: {
			  productQty:$(".atc-productQty").val(),
			  productID:$(".atc-prodCode").val(),
		      productName: $(".atc-prodName").val(),
			  productCategory:$(".atc-categoryLeve1").val(),
			  productSubCategory:$(".atc-categoryLeve2").val(),
			  productStockStatus:$(".atc-storeStock").val().replace(/<(.|\n)*?>/g, ''),
			  productBackOrder:productBackOrder,
			  addToCartLocation: (ACC.global.productCutatedplp == true ? $(".pagename").val() : (ACC.global.productAnalyticsRecAtc == true ? "recommendation" : _AAData.eventType)),
		 	  productPrice: $.trim(productUnitPrice).replace('$', ""),
		 	  productID:$(".atc-prodCode").val()
		    }
		  }];
     	
     	/***For GA4 Analytics add_to_cart Start***/
     	ACC.ga4analytics.add_to_cart(
     		$(".atc-prodCode").val(),
     		$(".atc-prodName").val(),
     		parseFloat($.trim(productUnitPrice).replace('$', "")),
     		parseInt($(".atc-productQty").val()),
     		$(".atc-prodBrand").val(),
     		$(".atc-categoryLeve1").val(),
     		$(".atc-categoryLeve2").val(),
     		$(".atc-categoryLeve3").val(),
     	);
     	/***For GA4 Analytics add_to_cart end***/

       rdt("track", "AddToCart", {
        currency: "USD",
        itemCount: parseInt($(".atc-productQty").val()),
        value: parseFloat($.trim(productUnitPrice).replace('$', "")),
        products: [
          {
            id: $(".atc-prodCode").val(),
            name: $(".atc-prodName").val(),
            category: $(".atc-categoryLeve1").val()
          }
        ]
       });

     	if($("body").hasClass("page-productDetails")){
            var getUOMval = '';
  	        if($('.pdpRedesignuom-wrapper').is(':visible')){	            
  	            if($('.pdpRedesignuom-wrapper .bulk-price').hasClass('uom-dropdown-text')){
  	                if($('.pdpRedesignuom-wrapper .bulk-price.uom-dropdown-text').text()){
                      const isUOMCaseSelected = $('.pdpRedesignuom-wrapper .selected-uom-item input')[0].checked;
  	                  getUOMval = isUOMCaseSelected ? $('.pdpRedesignuom-wrapper .selected-uom-item input')[1].value : $('.pdpRedesignuom-wrapper .bulk-price.uom-dropdown-text:first').text().split('/')[1];
  	                }
  	            }
  	            else{
  	              if($('.pdpRedesignuom-wrapper .bulk-price .price').text() && $('.pdpRedesignuom-wrapper .bulk-price .price').text().trim().split('/')[1]){
  	                getUOMval = $('.pdpRedesignuom-wrapper .bulk-price .price').text().trim().split('/')[1].trim();
  	              }                     
  	            }	            
  	        }
            else{
              if($('.redesign-rgt-content .retail-your-price-container .bulk-price .price').text() && $('.redesign-rgt-content .retail-your-price-container .bulk-price .price').text().trim().split('/').length){
                var len = $('.redesign-rgt-content .retail-your-price-container .bulk-price .price').text().trim().split('/').length;
                getUOMval = $('.redesign-rgt-content .retail-your-price-container .bulk-price .price').text().trim().split('/')[len-1].trim();
              }
              else{
                var len = $('.redesign-rgt-content .retail-your-price-container .bulk-price').text().trim().split('/').length;
                getUOMval = $('.redesign-rgt-content .retail-your-price-container .bulk-price').text().trim().split('/')[len-1].trim();
              } 
            }
            digitalData.product[0].productInfo['ProductUoM'] = getUOMval;
            if(ACC.global.atcButtonClickEvent == undefined) ACC.global.atcButtonClickEvent = 'body'
            digitalData.product[0].productInfo['addToCartTracking'] = ACC.global.atcButtonClickEvent;
            ACC.global.atcButtonClickEvent = 'body';
  	    }

    	  _AAData.popupPageName= ACC.config.atcPageName;
    	  _AAData.popupChannel= ACC.config.checkoutpathingChannel;
    	  
    	  if(digitalData.pfm)
	      	{
	      	  delete digitalData.pfm;
	      	  delete digitalData.pfmdetails;
	      	}
    	  
    	  if(ACC.global.productAnalyticsRecAtc)
    		  {
		      
		      digitalData.pfm = "recommendation";
		 	  digitalData.pfmdetails = _AAData.page.pageName;
		     
		      
		      digitalData.eventData={
		    		    linktype:"recommendation",
		                linkName:"Add to Cart",
		                onClickPageName: $(".siteonepagename").val()
		            }
    		  
    		  }
		 	try {
			    	 _satellite.track('popupView');
	        } catch (e) {}
        
          var getURL = window.location.href;
          var urlCase = getURL.toLowerCase();

          if (urlCase.indexOf('isrc=featured') > 0) {
            
            try {
            _AAData.method = "recommendation";
            _AAData.methodMetaData = "featured";
            }catch(e){}
            
            digitalData.eventData={
              linkName: 'recommendation',
              linkType: 'Add to Cart',
              onClickPageName: $(".pagename").val()
            }
            digitalData.product[0].productInfo['addToCartLocation'] = "recommendation";
            
          }
          if (urlCase.indexOf('isrc=featuredpopup') > 0) {
            
            if(digitalData.pfm)
            {
              delete digitalData.pfm;
              delete digitalData.pfmdetails;
            }
            try {
              if(_AAData.method){
              delete _AAData.method;
              delete _AAData.methodMetaData ;
              }
            }catch(e){}
              
            _AAData.pfm= "recommendation";
            _AAData.pfmDetails= $(".pagename").val();
           

            digitalData.eventData={
              linkName: 'recommendation',
              linkType: 'Add to Cart',
              onClickPageName: $(".pagename").val()
            }
            
          digitalData.product[0].productInfo['addToCartLocation'] = "recommendation";

          }

        if ($(".orderhistoryDetails-singleOrder").hasClass("sub-section")) {
          $(".qty-title-atc").text(($(".selected-btn").closest(".sub-section").find(".qty-buyagain").text()).trim());
        }
        else if ($("#bia-qty").hasClass("bia-qty-txt-field")) {
          $(".qty-title-atc").text(($(".selected-btn").closest(".qty-button-wrapper").find("#bia-qty").val()).trim());

        }
        else {
          $(".qty-title-atc").text(($(".selected-btn").closest(".item__list--header").find(".qtyValue").text()).trim());

        }
        $('.page-quickOrderPage .js-mini-cart-close-button').text(ACC.config.returnToQuick);
        $('.page-quickOrderPage .add-to-cart-button').text(ACC.config.viewFullCart);
        $('.page-quickOrderPage .minicart-title').text(ACC.config.productsAdded);
        $('.page-quickOrderPage #colorbox').addClass('quick-order-colorbox');
        $('body').css("overflow-y", "hidden");
        let target = $(".add-to-cart-overlay-mixedcart");
        if(target.find(".product-recs-wrapper").length){
          let tempHeight = $(window).outerHeight() - $("#addToCartLayer").outerHeight() - $(".cartpage-popup_btn").outerHeight()-35;
          target.find(".product-recs-wrapper").height(tempHeight);
        }
      },
      onClosed: function () {       
        ACC.global.productAnalyticsRecAtc = false;
	        
      }
    });
  },
  displayAddToCartPopup: function (cartResult, statusText, xhr, formElement) {

    $ajaxCallEvent = true;
    $('#addToCartLayer').remove();
    if (typeof ACC.minicart.updateMiniCartDisplay == 'function') {
      ACC.minicart.updateMiniCartDisplay();
    }
    var titleHeader = $('#addToCartTitle').html();
    if (($('.page-quickOrderPage').length > 0) && (/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))) {

      var elements = $(cartResult.addToCartLayer);
      var numberItemsInCart = $('#numberItemsInCart', elements).val();

      if (numberItemsInCart > 1) {
        $("#itemCountForMobile").html("You have " + numberItemsInCart + " items in your cart");
      }
      else {
        $("#itemCountForMobile").html("You have " + numberItemsInCart + " item in your cart");
      }
      $("#itemCountForMobile").removeClass('hidden');
      $("#addToCartMobileMesage").removeClass('hidden');
      $("#ForMobileLink").removeClass('hidden');
      window.scrollTo(0, 0);

    } else {

      ACC.product.addToModal(cartResult);


    }
    var productCode = $('[name=productCodePost]', formElement).val();
    var quantityField = $('[name=qty]', formElement).val();

    var quantity = 1;
    if (quantityField != undefined) {
      quantity = quantityField;
    }

    var cartAnalyticsData = cartResult.cartAnalyticsData;

    var cartData = {
      "cartCode": cartAnalyticsData.cartCode,
      "productCode": productCode, "quantity": quantity,
      "productPrice": cartAnalyticsData.productPostPrice,
      "productName": cartAnalyticsData.productName
    };
    ACC.track.trackAddToCart(productCode, quantity, cartData);
  },

  bindRetailPrice: function () {
    $(document).on("click", ".retailPriceLink", function (e) {
      var productCode = $(this).data('productcode');
      var isOrderingAccount = $(this).data('isOrderingaccount');
      var isRegulatedItem = $(this).data('isRegulateditem');
      var isStoreproduct = $(this).data('isStoreproduct');
      var isLicensed = $(this).data('isLicensed');
      var isProductsellable = $(this).data('isProductsellable');
      var index = $(this).data('index');
      var isRup = ($("#isRup" + productCode).val() == 'true');
      var phoneNumber = $("#sessionStorePhoneNumber").val();
      loading.start();
      $.ajax({
        url: ACC.config.encodedContextPath + "/p/branchRetailPrice?productCode=" + productCode + "&quantity=1",
        method: "POST",
        success: function (siteOneCspResponse) {
          if (siteOneCspResponse.isSuccess) {
            $("#retailPriceLink" + productCode).hide();
            $("#retailPriceSection" + productCode).show();
            $("#callForPriceEnabled" + productCode).hide();
            if ((siteOneCspResponse.price != null) && (siteOneCspResponse.price != undefined)) {
              $("#retailPrice" + productCode).html(siteOneCspResponse.price.formattedValue);
              $("#retailPriceValue" + index).val(siteOneCspResponse.price.value);
            } else {
              var minPrice = siteOneCspResponse.priceRange.minPrice.formattedValue;
              var maxPrice = siteOneCspResponse.priceRange.maxPrice.formattedValue;
              $("#retailPrice" + productCode).html(minPrice + " - " + maxPrice);
              $("#retailPriceValue" + index).val(minPrice + " - " + maxPrice);
            }
            ACC.promotions.calculatePromotionPrice($("#productPromotion" + index), productCode);
            $("#retailPriceLink" + productCode).parent().siblings(".price").children().find(".add_price").css("text-decoration", "line-through")
            if (isOrderingAccount && isStoreproduct && ((isRegulatedItem && isProductsellable && (!isRup || (isRup && isLicensed))) || !isRegulatedItem)) {
              $("#listPageAddToCart_" + productCode).attr("disabled", false);
              $("#orderOnlineATC_" + productCode).attr("disabled", false);
            }
          } else {
            $("#retailPriceLink" + productCode).hide();
            $("#callForPriceEnabled" + productCode).hide();
            if ($('#retailPrice' + productCode == "")) {
              $("#basePrice" + index).show();
              $('#salePrice' + index).show();
            } else {
              $("#basePrice" + index).hide();
              $('#salePrice' + index).hide();
            }
            if (siteOneCspResponse.errorMessageToDisplay == "true") {
              $("#callForPriceEnabled" + productCode).show();
            }
          }
        }
      }).always(function () {
        loading.stop();
      });
    });
  },

  bindCustomerSpecificPrice: function () {
    $(document).on("click", ".customerSpecificPriceLink", function (e) {
      //alert("customerSpecificPriceLink clicked");
      var productCode = $(this).data('productcode');
      var isOrderingAccount = $(this).data('isOrderingaccount');
      var isRegulatedItem = $(this).data('isRegulateditem');
      var isStoreproduct = $(this).data('isStoreproduct');
      var isLicensed = $(this).data('isLicensed');
      var isProductsellable = $(this).data('isProductsellable');
      var index = $(this).data('index');
      var isRup = ($("#isRup" + productCode).val() == 'true');
      var phoneNumber = $("#sessionStorePhoneNumber").val();
      loading.start();
      $.ajax({

        url: ACC.config.encodedContextPath + "/p/customerprice?productCode=" + productCode + "&quantity=1",
        method: "POST",

        success: function (siteOneCspResponse) {
          if (siteOneCspResponse.isSuccess) {
            $("#customerSpecificPriceLink" + productCode).hide();
            $("#customerSpecificPriceSection" + productCode).show();
		        $("#callForPriceEnabled" + productCode).hide();

            if ((siteOneCspResponse.price != null) && (siteOneCspResponse.price != undefined)) {
              $("#customerSpecificPrice" + productCode).html(siteOneCspResponse.price.formattedValue);
              $("#customerSpecificPriceValue" + index).val(siteOneCspResponse.price.value);
            } else {
              var minPrice = siteOneCspResponse.priceRange.minPrice.formattedValue;
              var maxPrice = siteOneCspResponse.priceRange.maxPrice.formattedValue;
              $("#customerSpecificPrice" + productCode).html(minPrice + " - " + maxPrice);
              $("#customerSpecificPriceValue" + index).val(minPrice + " - " + maxPrice);
            }

            ACC.promotions.calculatePromotionPrice($("#productPromotion" + index), productCode);
            /*$('.strikk > span').css("text-decoration","line-through");*/
            $("#customerSpecificPriceLink" + productCode).parent().siblings(".price").children().find(".add_price").css("text-decoration", "line-through")

            if (isOrderingAccount && isStoreproduct && ((isRegulatedItem && isProductsellable && (!isRup || (isRup && isLicensed))) || !isRegulatedItem)) {
              $("#listPageAddToCart_" + productCode).attr("disabled", false);
              $("#orderOnlineATC_" + productCode).attr("disabled", false);
            }

            $("#priceUnavailabilityMsg" + index).addClass('hidden');
            $("#cspError" + index).hide();
          }
          else {
            $("#customerSpecificPriceLink" + productCode).hide();
	          $("#callForPriceEnabled" + productCode).hide();
            if ($('#customerSpecificPrice' + productCode == "")) {
              $("#basePrice" + index).show();
              $('#salePrice' + index).show();
            } else {
              $("#basePrice" + index).hide();
              $('#salePrice' + index).hide();
            }
            if(siteOneCspResponse.errorMessageToDisplay == "true")
               {
                  $("#callForPriceEnabled" + productCode).show();
               }
            $("#cspError" + index).html("Price not available. Please contact store <a href='tel:" + phoneNumber + "'>" + phoneNumber + "</a>").show();

            $("#priceUnavailabilityMsg" + index).addClass('hidden');
          }
        }
      }).always(function () {
        loading.stop();
      });

    });
  },

  orderOnlinePopup: function () {
    $(document).on("click", "#orderOnlineATC", function () {
      ACC.colorbox.open("", {
        html: $("#orderOnlinePopup").html(),
        width: '520px',
        height: 'auto',
        close: '<span class="glyphicon glyphicon-remove"></span>',
      });

    });
    $(document).on("click", "button[name='atclistoo']", function () {
      ACC.colorbox.open("", {
        html: $("#orderOnlinePopup").html(),
        width: '520px',
        height: 'auto',
        close: '<span class="glyphicon glyphicon-remove"></span>',
      });

    });
  },

  getProductCodeName: function () {
    $(document.body).on('click', '.name', function (e) {
      var productNameFirst = $(this).text();
      var productName = productNameFirst.trim();
      var productCode = $(this).parent().find(".productCodeValue").val();
      var productDetail = productCode + " | " + productName;
      try {
        _AAData.searchresultClicked = productDetail;
        _satellite.track("searchresultclicked");
      } catch (e) { }
    });
  },


  getsortValue: function () {
    $('#sortOptions1').on('change', function (e) {
    
    	if(digitalData.pfm)
    	{
    	  delete digitalData.pfm;
    	  delete digitalData.pfmdetails;
    	}
    	
      var optionSelected = $("option:selected", this);
      var sortName = this.value;
      digitalData.eventData = {
        sortName: sortName,
      }
      try {
        _satellite.track("sortByClick");
      } catch (e) { }
    });

  },

  disableRightclick: function () {
    $(document).ready(function (e) {
      $(".js-qty-selector-input, .js-qty-updateOne, .js-quick-order-qty").on("contextmenu", function (e) {
        return false;
      });
    });

  },
  checkProductImagePdp: function () {
    if ($(".page-productDetails").find(".product-thumb").length > 0) {
      $(".js-gallery-image").addClass("image-gallery-box");
    }
  },
  checkNurseryBackorder: function (lineItem) {
      var variantProductFullfilledStoreType = lineItem.find(".variantProductFullfilledStoreType").val();
      var variantProductType = $("#level1").val();
      return variantProductFullfilledStoreType === 'InventoryHit' && variantProductType === 'Nursery';
  },
  productVariant: function () {
    $(".product-variant-table .pdp-variant-qty").on('input', function (e) {
      var lineItem = $(this).closest('.product-variant-table__values');
      $(this).removeClass("variant-qty-error-message");
      lineItem.find(".qty-alert").css("display", "none");
      lineItem.find('.js-available-qty').removeClass("variant-qty-error-message");
      lineItem.find(".product-variant-table__data--atcbtn").removeAttr("disabled");
      if ($(this).val() === "0") {
        $(this).val("1");
      }
      else {

        if ($('.js-available-qty').length && lineItem.find(".pdp-variant-qty").val().trim() > lineItem.find(".product-variant-table__data--atcbtn").data("available-qty") && !ACC.product.checkNurseryBackorder(lineItem)) {
          lineItem.find(".qty-alert").css("display", "inline");
          lineItem.find(".product-variant-table__data--atcbtn").attr("disabled", "disabled");
          $(this).addClass("variant-qty-error-message");
          lineItem.find('.js-available-qty').addClass("variant-qty-error-message")
        }

      }
    });

    $(".product-variant-table .product-variant-table__data--atcbtn").on('click', function (e) {

      var lineItem = $(this).closest('.product-variant-table__values');

      if ($('.js-available-qty').length && lineItem.find(".pdp-variant-qty").val().trim() > $(this).data("available-qty") && !ACC.product.checkNurseryBackorder(lineItem)) {
        e.preventDefault();
      }
      else {
        lineItem.find('.qty-hidden-variant').val(lineItem.find(".pdp-variant-qty").val().trim());
        $(this).closest('form').submit();
        lineItem.find(".qty-alert").css("display", "none");
        lineItem.find(".pdp-variant-qty").removeClass("variant-qty-error-message");
        $(lineItem.find('.js-available-qty')).removeClass("variant-qty-error-message")
        lineItem.find(".pdp-variant-qty").val("1");
      }
    });

    $(".viewMoreLess").on("click", function (a) {
      a.preventDefault();
      ACC.product.showMoreVariant(this);
      //var state = $(this).data('state');
      //var element = $(this).parent().parent().find('.product-variant-table__values');
      //ACC.product.showMoreAndLess(this, state, element, ACC.config.variantShow, ACC.config.variantHide, 7);
    });
    $(".qty-alert").tooltip();

  },
  checkShippingOnlyPdp : function(element){
    let shippingOnlyProduct = $('.trackProductCode').val();
    if ($(element).val().trim() > $(element).data("available-qty")) {
      $(".shippingOnlyDisabled").val("true");
      $('.js-atc-'+shippingOnlyProduct).attr("disabled", "disabled");
      $(".intervalQtyError").removeClass("hidden");
    }
    else{
      $(".shippingOnlyDisabled").val("false");
      $('.js-atc-'+shippingOnlyProduct).attr("disabled", false);
      $(".intervalQtyError").addClass("hidden");
    }
  },
   checkAvlQuantity :function(element) {

    let shippingOnly = $('.isShippingHubOnlyPDP').val();
    if(shippingOnly == 'true') {
      ACC.product.checkShippingOnlyPdp(element);
    }
	  var variantisForceInStock = $('#variantisForceinstock').val();
	  if ($(element).data('is-nursery') === true && !variantisForceInStock) {
      if ($(element).val().trim() > $(element).data("available-qty")) {
        $(element).addClass("add-border border-red text-red variant-qty-error-message");
        if ($(element).hasClass("js-list-add-to-cart")) {
          $(element).closest(".saved-list-sec").find(".js-my-order-qty-error").removeClass("hide");
          $(element).closest(".saved-list-sec").find(".js-enable-btn").attr("disabled", "disabled");
          ACC.savedlist.bindEnableList();
        }

        else {
          $("#qtyError").html('<img class="icon-red-exclamation cart-qty-alert" src="/_ui/responsive/theme-lambda/images/Exclamation-point.svg" alt=""/>' + $(element).data("availableQty") + " " + ACC.config.quantityExceeded).css("display", "block");
          $(".js-pdp-availability").addClass("text-red");
          $('.pdp-btn #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
 		 if($(element).hasClass("pdp-variant-qty")){
			$(element).closest(".product-variant-table__values").find(".js-available-qty").addClass("variant-qty-error-message");
		  }
        }



      }
      else {
        if ($(element).hasClass("js-list-add-to-cart")) {
          $(element).closest(".saved-list-sec").find(".js-my-order-qty-error").addClass("hide");
          $(element).closest(".saved-list-sec").find(".js-enable-btn").removeAttr("disabled");
          $(element).removeClass("add-border border-red text-red variant-qty-error-message");
          ACC.savedlist.bindEnableList();
        }
        else {
          $("#qtyError").css("display", "none");
		  if($(element).hasClass("pdp-variant-qty")){
			$(element).closest(".product-variant-table__values").find(".js-available-qty").removeClass("variant-qty-error-message");
		  }
          $(".js-pdp-availability").removeClass("text-red");
          $('.pdp-btn #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $(element).removeClass("add-border border-red text-red variant-qty-error-message");
        }

      }
    }
  },
  
  checkMinQuantity :function(element,bulkuomselection) {
    var UOMRestrict = true;
    $(".intervalQtyInfo").removeClass("hidden");
    if ($('.multipleUomContents').length > 0) {
      if (!$('.pdp-slider-text').is(':Visible')) {
        for (let UOMoption = 0; UOMoption < $('.multipleUomItem ').length; UOMoption++) {
          if ($('.multipleUomItem ').eq(UOMoption).hasClass("selected-uom-item") && Number($('.multipleUomItem ').eq(UOMoption).data('inventorymultiplier')) > 1) {
            UOMRestrict = false;
            break;
          }
        }
      }
      if (Number($("#inventoryQty").val()) > 1 && $('.pdp-slider-text').is(':Visible')) {
            UOMRestrict = false;
      }
      if(Number($(element).data('min-qty')) > 1 || Number($(element).data('minimum-qty')) > 1){
        if(bulkuomselection == 1 && !UOMRestrict){
          $('.js-qty-selector-input').val(1);
          $(".multipleUomItem").attr("data-qty", 1);
          ACC.productDetail.multipleUomTotalPriceUpdater();
        }
        else if(bulkuomselection == 1 && UOMRestrict && Number($(element).data('min-qty')) > 1 ){
          $('.js-qty-selector-input').val(Number($(element).data('min-qty')));
          $(".multipleUomItem").attr("data-qty", Number($(element).data('min-qty')));
          ACC.productDetail.multipleUomTotalPriceUpdater();
        }
        else if(bulkuomselection == 1 && UOMRestrict && Number($(element).data('minimum-qty')) > 1 ){
          $('.js-qty-selector-input').val(Number($(element).data('minimum-qty')));
          $(".multipleUomItem").attr("data-qty", Number($(element).data('minimum-qty')));
          ACC.productDetail.multipleUomTotalPriceUpdater();
        }
      }
    }
    if (UOMRestrict) {
      var minqtyerror = 0;
      $(".intervalQtyInfo-mobile").removeClass("intervalQtyInfo-bottom");
      if ($(element).data('min-qty') != null && $(element).data('min-qty') != "0" && $(element).data('min-qty') != "1" && $(element).data('min-qty') != '') {
        $(".mobile-pdp-sticky").addClass("mobile-pdp-box-removal");
        if ((Number($(element).val().trim())!=0)&&(Number($(element).val().trim()) % $(element).data('min-qty')) == 0 && $(element).val().trim() != '') {
          $(".intervalQtyError").addClass("hidden");
          $('.pdp-btn #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $('.addtocart-detail #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $('.mobile-addcart #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $(".js-qty-selector-input").removeClass("qtyBoxError");
          minqtyerror = 0;
        }
        else {
          $(".intervalQtyError").removeClass("hidden");
          $('.pdp-btn #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
          $('.addtocart-detail #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
          $('.mobile-addcart #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
          $(".js-qty-selector-input").addClass("qtyBoxError");
          minqtyerror = 1;
        }
      }
      else {
        $(".mobile-pdp-sticky").removeClass("mobile-pdp-box-removal");
      }
      if ($(".page-detailsSavedListPage").length) {
        $("#selectedProdType" + $(element).attr("id").split("_")[1]).data("listqty", $(element).val());
      }
      else {
        if ($(pdpAddtoCartInput).data('available-qty') != null && $(pdpAddtoCartInput).data('available-qty') != '' && $(pdpAddtoCartInput).data('eeee')) {
          if (Number(document.getElementById('pdpAddtoCartInput').value.trim()) > $(pdpAddtoCartInput).data('available-qty')) {
            $(".mobile-pdp-sticky").addClass("mobile-pdp-box-removal");
            $(".availQtyError").removeClass("hidden");
            $(".availQtyError1").removeClass("hidden");
            $(".intervalQtyError").addClass("hidden");
            $('.pdp-btn #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
            $('.addtocart-detail #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
            $('.mobile-addcart #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
            $(".js-qty-selector-input").addClass("qtyBoxError");
            if ($(pdpAddtoCartInput).data('min-qty') != null && $(pdpAddtoCartInput).data('min-qty') != "0" && $(pdpAddtoCartInput).data('min-qty') != "1" && $(pdpAddtoCartInput).data('min-qty') != '') {
              $(".availQtyError").addClass("hidden");
              $(".availQtyError1").addClass("hidden");
              $(".availQtyError2").removeClass("hidden");
              $(".intervalQtyInfo-mobile").addClass("intervalQtyInfo-bottom");

            }
          } else {
            $(".availQtyError").addClass("hidden");
            $(".availQtyError1").addClass("hidden");
            $(".availQtyError2").addClass("hidden");
            if ($(element).data('min-qty') == null && $(element).data('min-qty') == "0" && $(element).data('min-qty') == "1" && $(element).data('min-qty') == '') {
              $(".mobile-pdp-sticky").removeClass("mobile-pdp-box-removal");
            }
            if (minqtyerror == 0) {
              $('.pdp-btn #productSelect').find('.js-enable-btn').removeAttr("disabled");
              $('.addtocart-detail #productSelect').find('.js-enable-btn').removeAttr("disabled");
              $('.mobile-addcart #productSelect').find('.js-enable-btn').removeAttr("disabled");
              $(".js-qty-selector-input").removeClass("qtyBoxError");
            }
          }
        }
      }
    }
    else {
      if(($(element).data('min-qty') != null && $(element).data('min-qty') != "0" && $(element).data('min-qty') != "1" && $(element).data('min-qty') != '') || 
        ($(pdpAddtoCartInput).data('available-qty') != null && $(pdpAddtoCartInput).data('available-qty') != '' && $(pdpAddtoCartInput).data('eeee'))){
          $(".intervalQtyInfo").addClass("hidden");
          $(".intervalQtyError").addClass("hidden");
          $(".availQtyError").addClass("hidden");
          $(".availQtyError1").addClass("hidden");
          $(".availQtyError2").addClass("hidden");
          $(".js-qty-selector-input").removeClass("qtyBoxError");
          $('.pdp-btn #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $('.addtocart-detail #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $('.mobile-addcart #productSelect').find('.js-enable-btn').removeAttr("disabled");
        }
    }
    if (UOMRestrict){
      if(Number($(element).data('minimum-qty')) > 1){
        $(".minQtyInfo").removeClass("hidden");
        $(".mobile-pdp-sticky").addClass("mobile-pdp-box-removal");
        if ((Number($(element).val().trim()) < $(element).data('minimum-qty')) && $(element).val().trim() != '') {
          $(".intervalQtyError").removeClass("hidden");
          $('.pdp-btn #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
          $('.addtocart-detail #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
          $('.mobile-addcart #productSelect').find('.js-enable-btn').attr("disabled", "disabled");
          $(".js-qty-selector-input").addClass("qtyBoxError");
        }
        else{
          $(".intervalQtyError").addClass("hidden");
          $('.pdp-btn #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $('.addtocart-detail #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $('.mobile-addcart #productSelect').find('.js-enable-btn').removeAttr("disabled");
          $(".js-qty-selector-input").removeClass("qtyBoxError");
        }
      } 
    }
    else{
       if(Number($(element).data('minimum-qty')) > 1){
        $(".minQtyInfo").addClass("hidden");
        $(".mobile-pdp-sticky").removeClass("mobile-pdp-box-removal");
        $(".intervalQtyError").addClass("hidden");
        $('.pdp-btn #productSelect').find('.js-enable-btn').removeAttr("disabled");
        $('.addtocart-detail #productSelect').find('.js-enable-btn').removeAttr("disabled");
        $('.mobile-addcart #productSelect').find('.js-enable-btn').removeAttr("disabled");
        $(".js-qty-selector-input").removeClass("qtyBoxError");
       }
    }
  },
  CheckMinintervalPLP : function() {
   /* if($('.js-plp-uomqtyinterval').parent().next().find('.orderAccountingMsgPLP').hasClass("orderAccountingMsgPLP")){  
      $('.js-plp-uomqtyinterval').closest('.plp-ordermultiplesaddtocart').siblings('.plp-message2').addClass("plpintervalmargintop");
      $('.js-plp-uomqtyinterval').closest('.plp-ordermultiplesaddtocart').siblings('.plp-message1').addClass("plpintervalmargintop");
        
    }*/
  },
  checkMaxQuantityonhandPLP :function() {
	  /*if ($('.ohhandqty').data('eeeevalue') && $('.ohhandqty').val() > $('.ohhandqty').data('maxqty')){
      $('.ohhandqty').closest('.plp-ordermultiplesaddtocart').siblings('.plp-message3').removeClass("hidden");
      $('.ohhandqty').addClass("plp-qtyBoxError");
      $('.ohhandqty').parent().next().find('.js-enable-btn').addClass("PLPaddtocartmessage");
      $('.ohhandqty').parent().next().find('.js-plp-uomqtyinterval').addClass("PLPaddtocartmessage");
      $('.ohhandqty').closest('.plp-ordermultiplesaddtocart').siblings('.plp-message1').removeClass("hidden");
      $('.ohhandqty').closest('.plp-ordermultiplesaddtocart').siblings('.plp-message2').addClass("hidden");
    }*/
  },
  checkMinQuantityPLP: function (element, option) {
    var productCode = $(element).data('productcode');
    var baseUOM = sessionStorage.getItem("baseUOM_"+productCode);
    var qtyBox = $('#productPLPPostQty_'+productCode);
    var minqty = Number($(element).data('min-qty'));
    var minorderqty = Number($(element).data('min-orderqty'));
    var maxqty = Number($(element).data('maxqty'));
    var isIntervalQtyError = false;
    if(baseUOM == "true"){
	if(option == 'dropdown'){
		if (minqty != null && minqty != 0 && minqty > 0 && minqty != 1 && minqty != ''){
			qtyBox.val(minqty);
		}
		else if (minorderqty != null && minorderqty != 0 && minorderqty > 0 && minorderqty != 1 && minorderqty != ''){
			qtyBox.val(minorderqty);
		}
		else{
			qtyBox.val(1);
		}
	}
    if (minqty != null && minqty != 0 && minqty > 0 && minqty != 1 && minqty != '') {
      if ((Number($(element).val().trim()) % minqty) == 0 && Number($(element).val().trim()) != '') {
        $('.plp-message2-'+productCode).addClass("hidden");
        $('.plp-message1-'+productCode).removeClass("hidden");
        $('.plp-message3-'+productCode).addClass("hidden");
        $('#productPLPPostQtysection_'+productCode).removeClass("plp-qtyBoxError");
        //$(e.target).removeClass("plp-qtyBoxError");
        $('#listPageAddToCart_'+productCode).removeClass("plp-disable");
        $('#orderOnlineATC_'+productCode).removeClass("plp-disable");
        $('#plp-commonerror-'+productCode).addClass("hidden");
        /*$(e.target).parent().next().find('.js-enable-btn').removeClass("PLPaddtocartmessage");
          $(e.target).parent().next().find('.js-plp-uomqtyinterval').removeClass("PLPaddtocartmessage");
          if ($(e.target).parent().next().find('.orderAccountingMsgPLP').hasClass("orderAccountingMsgPLP")) {
          $(e.target).closest('.plp-ordermultiplesaddtocart').siblings('.plp-message2').addClass("plpintervalmargintop");
        }*/
      }
      if (!((Number($(element).val().trim()) % minqty) == 0 && Number($(element).val().trim()) != '')) {
		isIntervalQtyError = true;
        $('.plp-message2-'+productCode).removeClass("hidden");
        $('.plp-message1-'+productCode).addClass("hidden");
        $('.plp-message3-'+productCode).addClass("hidden");
        $('#productPLPPostQtysection_'+productCode).addClass("plp-qtyBoxError");
        //$(e.target).addClass("plp-qtyBoxError");
        $('#listPageAddToCart_'+productCode).addClass("plp-disable");
        $('#orderOnlineATC_'+productCode).addClass("plp-disable");
        $('#plp-commonerror-'+productCode).removeClass("hidden");
        /*$(e.target).parent().next().find('.js-enable-btn').addClass("PLPaddtocartmessage");
          $(e.target).parent().next().find('.js-plp-uomqtyinterval').addClass("PLPaddtocartmessage");
          if ($(e.target).parent().next().find('.orderAccountingMsgPLP').hasClass("orderAccountingMsgPLP")) {
          $(e.target).closest('.plp-ordermultiplesaddtocart').siblings('.plp-message1').addClass("plpintervalmargintop");
        }*/
      }
    } else {
      $(".mobile-pdp-sticky").removeClass("mobile-pdp-box-removal");
    }

    if (minorderqty != null && minorderqty != '') {
      if (Number($(element).val().trim()) != '') {
        if ((Number($(element).val().trim()) < minorderqty)) {
        $('.plp-message4-'+productCode).removeClass("hidden");
         $('.plp-message5-'+productCode).addClass("hidden");
         $('#listPageAddToCart_'+productCode).addClass("plp-disable");
         $('#orderOnlineATC_'+productCode).addClass("plp-disable");
         /*$(e.target).parent().next().find('.js-enable-btn').addClass("PLPaddtocartmessage");
          $(e.target).parent().next().find('.js-plp-uomqtyinterval').addClass("PLPaddtocartmessage");*/
          //$(e.target).addClass("plp-qtyBoxError");
          $('#productPLPPostQtysection_'+productCode).addClass("plp-qtyBoxError");
          $('#plp-commonerror-'+productCode).removeClass("hidden");
        } else {
          $('.plp-message4-'+productCode).addClass("hidden");
          $('.plp-message5-'+productCode).removeClass("hidden");
          $('#listPageAddToCart_'+productCode).removeClass("plp-disable");
          $('#orderOnlineATC_'+productCode).removeClass("plp-disable");
          /*$(e.target).parent().next().find('.js-enable-btn').removeClass("PLPaddtocartmessage");
          $(e.target).parent().next().find('.js-plp-uomqtyinterval').removeClass("PLPaddtocartmessage");*/
          //$(e.target).removeClass("plp-qtyBoxError");
          $('#productPLPPostQtysection_'+productCode).removeClass("plp-qtyBoxError");
          $('#plp-commonerror-'+productCode).addClass("hidden");
        }
      } else {
        $('.plp-message4-'+productCode).removeClass("hidden");
        $('.plp-message5-'+productCode).addClass("hidden");
        $('#listPageAddToCart_'+productCode).addClass("plp-disable");
        $('#orderOnlineATC_'+productCode).addClass("plp-disable");
        /*$(e.target).parent().next().find('.js-enable-btn').addClass("PLPaddtocartmessage");
        $(e.target).parent().next().find('.js-plp-uomqtyinterval').addClass("PLPaddtocartmessage");*/
        //$(e.target).addClass("plp-qtyBoxError");
        $('#productPLPPostQtysection_'+productCode).addClass("plp-qtyBoxError");
        $('#plp-commonerror-'+productCode).removeClass("hidden");
      }
    }

    if (maxqty != null && maxqty != 0 && maxqty > 0 && maxqty != 1 && maxqty != '' && $(element).data('eeeevalue') == true) {
      if (Number($(element).val().trim()) > maxqty && Number($(element).val().trim()) != '' && $(element).data('eeeevalue') == true) {

        $('.plp-message3-'+productCode).removeClass("hidden");
        //$(e.target).addClass("plp-qtyBoxError");
        $('#productPLPPostQtysection_'+productCode).addClass("plp-qtyBoxError");
        $('#plp-commonerror-'+productCode).removeClass("hidden");
        $('#listPageAddToCart_'+productCode).addClass("plp-disable");
        $('#orderOnlineATC_'+productCode).addClass("plp-disable");
        /*$(e.target).parent().next().find('.js-plp-uomqtyinterval').addClass("PLPaddtocartmessage");
        $(e.target).parent().next().find('.js-enable-btn').addClass("PLPaddtocartmessage");*/
        $('.plp-message1-'+productCode).removeClass("hidden");
        $('.plp-message2-'+productCode).addClass("hidden");
      }else{
		$('.plp-message3-'+productCode).addClass("hidden");
        //$(e.target).addClass("plp-qtyBoxError");
        if(isIntervalQtyError == true){
			$('#productPLPPostQtysection_'+productCode).addClass("plp-qtyBoxError");
	        $('#plp-commonerror-'+productCode).removeClass("hidden");
	        $('#listPageAddToCart_'+productCode).addClass("plp-disable");
	        $('#orderOnlineATC_'+productCode).addClass("plp-disable");
	        $('.plp-message1-'+productCode).addClass("hidden");
	        $('.plp-message2-'+productCode).removeClass("hidden");
		}else{
			$('#productPLPPostQtysection_'+productCode).removeClass("plp-qtyBoxError");
	        $('#plp-commonerror-'+productCode).addClass("hidden");
	        $('#listPageAddToCart_'+productCode).removeClass("plp-disable");
	        $('#orderOnlineATC_'+productCode).removeClass("plp-disable");
	        $('.plp-message1-'+productCode).removeClass("hidden");
	        $('.plp-message2-'+productCode).addClass("hidden");
		}
	  }
    }
  }else{
	  if(option == 'dropdown'){
      $('.plp-message1-'+productCode).addClass("hidden");
      $('.plp-message2-'+productCode).addClass("hidden");
      $('.plp-message3-'+productCode).addClass("hidden");
      $('.plp-message4-'+productCode).addClass("hidden");
      $('.plp-message5-'+productCode).addClass("hidden");
      $('#productPLPPostQtysection_'+productCode).removeClass("plp-qtyBoxError");
      $('#plp-commonerror-'+productCode).addClass("hidden");
      $('#listPageAddToCart_'+productCode).removeClass("plp-disable");
      $('#orderOnlineATC_'+productCode).removeClass("plp-disable");
      qtyBox.val(1);
      }
    }
  },
    
  bindRelatedArticle: function () {
    $(".related-article-container").on("click", function(e){
      if($(this).find(".show-related-article>span").hasClass("plus-circle")){
        $(this).find(".show-related-article").click()
      }
    })
    $(".show-related-article").on("click", function (a) {
      a.preventDefault();
      a.stopPropagation();
      var state = $(this).data('state');
      var element = $(this).closest(".related-article-container").find(".related-article-block");
      ACC.product.showMoreAndLess(this,state, element,"", "", 0);
      switch (state) {
      case "expand": {
    	  $(this).prepend('<span><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"><defs><style>.minus-a{fill:#fff;stroke:#78a22f;}.minus-b{fill:#78a22f;}.minus-c{stroke:none;}.minus-d{fill:none;}</style></defs><g transform="translate(-139 -1306)"><g class="minus-a" transform="translate(139 1306)"><circle class="minus-c" cx="12.5" cy="12.5" r="12.5"/><circle class="minus-d" cx="12.5" cy="12.5" r="12"/></g><path class="minus-b" d="M6.5,208H.5a.5.5,0,0,0-.5.5v.5a.5.5,0,0,0,.5.5h6A.5.5,0,0,0,7,209v-.5A.5.5,0,0,0,6.5,208Z" transform="translate(148 1110)"/></g></svg></span>');
    	  $('.content-show-hide-items').text(ACC.config.relatedarticlehideTextname+" "+$(this).data('show-items')+" "+ACC.config.relatedarticleitemTextname);
    	  break;
      }
      case "collapse": {
	
		   $(this).prepend('<span class="plus-circle"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"><defs><style>.plus-a{fill:#fff;}.plus-b{fill:#78a22f;}.plus-c,.d{stroke:none;}.plus-d{fill:#e0e0e0;}</style></defs><g transform="translate(-495 -1215)"><g class="plus-a" transform="translate(495 1215)"><path class="plus-c" d="M 12.5 24.5 C 9.294679641723633 24.5 6.281219959259033 23.25177955627441 4.01471996307373 20.98527908325195 C 1.748219966888428 18.71878051757812 0.5 15.70532035827637 0.5 12.5 C 0.5 9.294679641723633 1.748219966888428 6.281219959259033 4.01471996307373 4.01471996307373 C 6.281219959259033 1.748219966888428 9.294679641723633 0.5 12.5 0.5 C 15.70532035827637 0.5 18.71878051757812 1.748219966888428 20.98527908325195 4.01471996307373 C 23.25177955627441 6.281219959259033 24.5 9.294679641723633 24.5 12.5 C 24.5 15.70532035827637 23.25177955627441 18.71878051757812 20.98527908325195 20.98527908325195 C 18.71878051757812 23.25177955627441 15.70532035827637 24.5 12.5 24.5 Z"/><path class="plus-d" d="M 12.5 1 C 9.428239822387695 1 6.54033088684082 2.196210861206055 4.368270874023438 4.368270874023438 C 2.196210861206055 6.54033088684082 1 9.428239822387695 1 12.5 C 1 15.5717601776123 2.196210861206055 18.45967102050781 4.368270874023438 20.63172912597656 C 6.54033088684082 22.80379104614258 9.428239822387695 24 12.5 24 C 15.5717601776123 24 18.45967102050781 22.80379104614258 20.63172912597656 20.63172912597656 C 22.80379104614258 18.45967102050781 24 15.5717601776123 24 12.5 C 24 9.428239822387695 22.80379104614258 6.54033088684082 20.63172912597656 4.368270874023438 C 18.45967102050781 2.196210861206055 15.5717601776123 1 12.5 1 M 12.5 0 C 19.40356063842773 0 25 5.596439361572266 25 12.5 C 25 19.40356063842773 19.40356063842773 25 12.5 25 C 5.596439361572266 25 0 19.40356063842773 0 12.5 C 0 5.596439361572266 5.596439361572266 0 12.5 0 Z"/></g><path class="plus-b" d="M6.708,66.917H4.083V64.292A.292.292,0,0,0,3.792,64H3.208a.292.292,0,0,0-.292.292v2.625H.292A.292.292,0,0,0,0,67.208v.583a.292.292,0,0,0,.292.292H2.917v2.625A.292.292,0,0,0,3.208,71h.583a.292.292,0,0,0,.292-.292V68.083H6.708A.292.292,0,0,0,7,67.792v-.583A.292.292,0,0,0,6.708,66.917Z" transform="translate(504 1160)"/></g></svg></span>');
    	  $('.content-show-hide-items').text(ACC.config.relatedarticleshowTextname+" "+$(this).data('show-items')+" "+ACC.config.relatedarticleitemTextname);
    	    break;
      }
      case undefined: break;
    }
    });
  },
  pdpPlusMinusQty: function () {
    $('.pdp-qtyBtn').on("click", function (e) {
      var $target = $(e.target);
      var qty = $(this).siblings('#pdpAddtoCartInput').val();
      var orderQtyInterval = Number($('#orderQtyInterval').val());
      if (qty && !isNaN(qty)) {
        qty = Number(qty);
      } else {
        qty = 0;
      }
      if ($('.intervalQtyInfo').is(":Visible")) {
        if ($target.hasClass("plusQty")) {
          if (qty < 9999) {
            var currentMultiple = Math.floor(qty / orderQtyInterval);
            var nextMultiple = currentMultiple + 1;
            qty = nextMultiple * orderQtyInterval;
          }
        } else {
          if (qty > 1) {
            var isMultiple = qty % orderQtyInterval === 0;
            var previousMultiple = isMultiple ? qty - orderQtyInterval : qty - (qty % orderQtyInterval);
            qty = Math.max(orderQtyInterval, previousMultiple);
          }
        }
        qty = Math.max(orderQtyInterval, qty);
        $('.js-pdp-add-to-cart').val(qty);
        $(".multipleUomItem").attr("data-qty", qty);
        ACC.productDetail.multipleUomTotalPriceUpdater();
      } else {
        if ($target.hasClass("plusQty")) {
          if (qty < 9999) {
            $('.js-pdp-add-to-cart').val(qty + 1);
            $(".multipleUomItem").attr("data-qty", qty + 1);
            ACC.productDetail.multipleUomTotalPriceUpdater();
          }
        } else {
          if (qty > 1) {
            $('.js-pdp-add-to-cart').val(qty - 1);
            $(".multipleUomItem").attr("data-qty", qty - 1);
            ACC.productDetail.multipleUomTotalPriceUpdater();
          }
        }
      }
      $(this).siblings('#pdpAddtoCartInput').blur();
      $(this).siblings('#pdpAddtoCartInput').focus();
      $(this).trigger("qtyUpdated");
      return false;
    });

    $(".js-pdp-add-to-cart,.js-list-add-to-cart").on("input", function (e) {
      if ($(this).hasClass("js-pdp-add-to-cart")) {
        $('.js-pdp-add-to-cart').val($(this).val());
      }
      ACC.product.checkAvlQuantity(this);
      ACC.product.checkMinQuantity(this,0);
    });
    $(document).on("qtyUpdated", function (e) {
      var elem = '';
      if ($(e.target).hasClass("js-update-entry-quantity-list-btn")) {
        elem = $(e.target).siblings(".js-update-entry-quantity-input");
      }
      else {
        elem = $(e.target).siblings("#pdpAddtoCartInput");
      }
      ACC.product.checkAvlQuantity(elem);
      ACC.product.checkMinQuantity(elem,0);
    });
    $(document).ready(function () {
      var stockCheck = $('.product_stockCheck').val();
      if (stockCheck == "true") {
        $(".stock-icon").addClass("outstock");
        $(".stock-icon").removeClass("instock");
      } else {
        $(".stock-icon").addClass("instock");
        $(".stock-icon").removeClass("outstock");
      }
      if ($(".image-inner-wrapper").length == 1) {
        $(".owl-pagination").addClass("hidden");
      }
    });
    $(document).ready(function () {
      if ($(".js-gallery-carousel").length == 0) {
        $(".image-gallery__image .owl-item").removeClass("owl-itemSec");
      } else {
        $(".image-gallery__image .owl-item").addClass("owl-itemSec");
      }
    });
  },
  
  checkPdpStoreDetail: function(){
	  $(document.body).on('click','.pdp-store-link',function(e){
      $(".branchpopup_click").removeClass('pdpvarianttopLink');
      $('.pdp-store-link').removeClass('selectedVariantCode');
      $(e.target).addClass('selectedVariantCode');
      ACC.mystores.changebranchPopupFn();
      /*var newWindowWidth = $(window).width();
  			if (newWindowWidth > 481) {
          $(e.target).addClass('selectedVariantCode');
          ACC.mystores.changebranchPopupFn();
        }
        else{
          window.location.href= ACC.config.encodedContextPath + "/store-finder";          
        }*/
		  if(digitalData.pfm)
	      	{
	      	  delete digitalData.pfm;
	      	  delete digitalData.pfmdetails;
	      	}
		  var productSKU= $("#productcode").val();
		  var productAvailabilityStatus = $("input[name=productAvailabilityStatus]").val();
		  var storeNo = null;
		  if($(".pdp-store-detail").text().includes('#')){
			  storeNo= $(".pdp-store-detail").text().split('#')[1].split('.')[0];
		   }
		    digitalData.eventData={
				    productSKU: productSKU,
				  	storeNo: storeNo,
				  	productAvailabilityStatus: productAvailabilityStatus
		  	}
		  try {
              _satellite.track("checkStoreWhenonPDP");
          } catch (e) {}
	  });
  },
  
  curatedplp: function(){
	  ACC.product.showSlides(ACC.product.slideIndex);  
  },
  
  	slideIndex: 1,
	navigateButton: function(numb){
		$('.dropdown-content2').fadeIn('fast');
		ACC.product.showSlides(ACC.product.slideIndex += numb);
	},
	showSlides: function(numb){
	   let slides = $('.mobile-navbar').find('.mobile-navbar-angle');
	   
	   if (numb > slides.length) {ACC.product.slideIndex = 1}    
	   if (numb < 1) {ACC.product.slideIndex = slides.length}
	   slides.addClass('hidden');
	   slides.eq(ACC.product.slideIndex-1).removeClass('hidden');
	},
	cplpredirectUrl: function () {
		if(window.location.href.indexOf("redirectedlink")!= -1){
			   var cplpCart = $(".branch-selection").siblings('#cplpnumberitemcart').val();
			   var cplpCntstore = $(".branch-selection").siblings('#cplp-sessionstore').val();
			   var storeId =window.location.href.split("redirectedlink")[1];
			   var url =window.location.href.split("?")[0];
			   $('#cplp-storeid').val(storeId);
			   var cplpStoreid = $(".branch-selection").siblings('#cplp-storeid').val();

			  if (cplpCntstore!=cplpStoreid){
          setTimeout(function(){
            ACC.colorbox.open("", {
              html: $(".branch-selection").html(),
              width: "900px",
              className:"branch-selection-popup",
              close:'<span class="icon-close"></span>',
              onComplete:function(){
                $(document).on("click",".cplp-homebranchnotupdated", function(e){
                        ACC.colorbox.close();
                    });
                history.pushState(null, null, url+'?');
              },
            }); 
          },1000); 
			  }	
		  }	   
	},
	cplpredirectUrlBranchlink:function(){
		var cplpStoreid1 = $(".branch-selection").siblings('#cplp-storeid').val();
		 window.location.href= ACC.config.encodedContextPath + "/store-finder/make-my-store/"+cplpStoreid1;

	},

	cplpredirectUrlPopup: function(url,storeid){
		window.location=url+"?redirectedlink"+storeid;
	},

  handleLeftFacetSectionHeight: function () {
    var productListHeight = $(".prod-list-section").outerHeight();
    var leftSectionMainFiltersHeight = $(".main-facet-nav-filters").outerHeight();
    var currentHeight = $("#plpproductcountviewDesktop").outerHeight(true) + leftSectionMainFiltersHeight + $(".morewaytofilters").outerHeight(true);
    var moreFiltersBtnFlag = false;
    $('.morewaytofilters').nextAll('.facet.js-facet').each(function () {
      currentHeight += $(this).outerHeight();
      if (currentHeight > productListHeight) {
        $(this).addClass("hidden-md hidden-lg");
        if (!moreFiltersBtnFlag) {
          moreFiltersBtnFlag = true;
          $(".more-filters-btn-section").removeClass("hidden");
        }
      }
    });
  },

  plpPlusMinusQty: function (productcode, type) {
      var qtyBox = $('#productPLPPostQty_' + productcode);
      var qty = qtyBox.val();
      var orderQtyInterval = qtyBox.data('min-qty');
      if (qty && !isNaN(qty)) {
        qty = Number(qty);
      } else {
        qty = 0;
      }
      if (orderQtyInterval > 1) {
        if (type == "plus") {
          if (qty < 9999) {
            var currentMultiple = Math.floor(qty / orderQtyInterval);
            var nextMultiple = currentMultiple + 1;
            qty = nextMultiple * orderQtyInterval;
          }
        } else {
          if (qty > 1) {
            var isMultiple = qty % orderQtyInterval === 0;
            var previousMultiple = isMultiple ? qty - orderQtyInterval : qty - (qty % orderQtyInterval);
            qty = Math.max(orderQtyInterval, previousMultiple);
          }
        }
        qty = Math.max(orderQtyInterval, qty);
        qtyBox.val(qty);
      } else {
        if (type == "plus") {
          if (qty < 9999) {
            qtyBox.val(qty + 1);
          }
        } else {
          if (qty > 1) {
            qtyBox.val(qty - 1);
          }
        }
      } 
      $('#productPostPLPQty_' + productcode).val($('#productPLPPostQty_' + productcode).val());
      //ACC.global.qtyTotalPriceUpdaterPLP(productcode);
      ACC.product.checkMinQuantityPLP($('#productPLPPostQty_' +productcode), '');
      if($(".hardscapeProd_" + productcode).length) {
        ACC.product.handleQtyChangeForHardscapeProducts(productcode);
      } else {
        let qtyTarget = $('#productPLPPostQty_' + productcode);
        if (qtyTarget.length) {
          ACC.product.handleQtyChangeForProducts(qtyTarget, productcode);
        }
      }
      qtyBox.blur();
      qtyBox.focus();
      //qtyBox.trigger("qtyUpdated");
  },

  handleQtyChangeForHardscapeProducts: function (productCode) {
    let target = $(".hardscapeProd_" + productCode);
    let stockDataSection = ($(".plpviewtype").val() == "card") ? target.closest('.product-item').find('.cardstocksection') : target.closest('.product-item').find('.stock-section');
    let atcSection = ($(".plpviewtype").val() == "card") ? target.closest('.product-item').find(".card-atc-wrapper-section") : target.closest('.product-item').find('.list-atc-wrapper-section');
    let getAQuoteSection = target.closest('.product-item').find(".getAQuoteSection");
    if (stockDataSection.length && stockDataSection.is(":visible")) {
      if (stockDataSection.find(".stock-section-instock").length || stockDataSection.find(".stock-section-instock-nearby").length) {
        let stockDataCount = Number(stockDataSection.find('.bg-color').html());
        let qtyInput = Number($('#productPLPPostQty_' + productCode).val() || 1);
        let hardscapeForceStock = $(".hardscapeForceStock_" + productCode).val();
        if (qtyInput > stockDataCount && hardscapeForceStock !== "true") {
          if (target.closest('.product-item').find(".getAQuoteFlagForB2BUser").val() == "true") {
            atcSection.addClass('hidden');
            getAQuoteSection.removeClass("hidden");
            let multipleUOMEle = target.closest('.product-item').find('.uom-wrapper-plp');
            if (multipleUOMEle.length && multipleUOMEle.is(":visible")) {
              target.closest('.product-item').find(".plp-warning_info_" + productCode).find('.plp-commonerror').text(ACC.config.changeUOMForAvailability);
              target.closest('.product-item').find(".plp-warning_info_" + productCode).removeClass("hidden");
            }
          } else {
            target.closest('.product-item').find(".plp-warning_info_" + productCode).find('.plp-commonerror').text(ACC.config.expectDelay);
            target.closest('.product-item').find(".plp-warning_info_" + productCode).removeClass("hidden");
          }
        } else {
          if (target.closest('.product-item').find(".getAQuoteFlagForB2BUser").val() == "true") {
            atcSection.removeClass('hidden');
            getAQuoteSection.addClass("hidden");
          }
          target.closest('.product-item').find(".plp-warning_info_" + productCode).addClass("hidden");
        }
      }
    }
  },

  handleQtyChangeForProducts: function (target, productCode) {
    let multipleUOMEle = target.closest('.product-item').find('.uom-wrapper-plp');
    if (multipleUOMEle.length && multipleUOMEle.is(":visible")) {
      let stockDataSection = ($(".plpviewtype").val() == "card") ? target.closest('.product-item').find('.cardstocksection') : target.closest('.product-item').find('.stock-section');
      if (stockDataSection.length && stockDataSection.is(":visible")) {
        if (stockDataSection.find(".stock-section-instock").length || stockDataSection.find(".stock-section-instock-nearby").length) {
          let stockDataCount = Number(stockDataSection.find('.bg-color').html());
          let qtyInput = Number($('#productPLPPostQty_' + productCode).val() || 1);
          if (qtyInput > stockDataCount) {
            target.closest('.product-item').find(".plp-warning_info_" + productCode).find('.plp-commonerror').text(ACC.config.expectDelay);
            target.closest('.product-item').find(".plp-warning_info_" + productCode).removeClass("hidden");
            if (target.closest('.product-item').find("#plp-commonerror-" + productCode).is(":visible")) {
              target.closest('.product-item').find("#plp-commonerror-" + productCode).addClass("hidden");
            }
          } else {
            target.closest('.product-item').find(".plp-warning_info_" + productCode).addClass("hidden");
          }
        }
      }
    }
  },
  isVariantsExpanded: false,
  isLoading: false,
  showMoreVariant: function(a) {
      if(ACC.product.isLoading){ 
        return;
      } 
      var state = $(a).data('state');
      var element = $(a).parent().parent().find('.product-variant-table__values');
      if(ACC.product.isVariantsExpanded){
        ACC.product.showMoreAndLess(a, state, element, ACC.config.variantShow, ACC.config.variantHide, 7);
      }
      else{
        ACC.product.bindPDPVariant(a, state, element, ACC.config.variantShow, ACC.config.variantHide, 7);
      }
  },
  bindPDPVariant: function(thisElement, state, element, contentMore, contentLess, numberOfitems) {   
      ACC.product.isLoading = true;
    $.ajax({

        url: ACC.config.encodedContextPath + '/p/getPDPVariantProducts',
        type: 'GET',
        cache: false,
        async: true,
        success: function (response) {
            var decoded = $('<div>').html(response.variants).text();
            $('.product-variant-table__values').last().after(decoded); 
            element = $(thisElement).parent().parent().find('.product-variant-table__values');
            ACC.product.isLoading = false;
            if( !ACC.product.isVariantsExpanded ){
              ACC.product.showMoreAndLess(thisElement, state, element, contentMore, contentLess, numberOfitems);
              ACC.product.isVariantsExpanded= true ; 
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            //console.log('Error: ', textStatus, errorThrown); 
        }
    }); 

},
//SEO
  addPlpSchema: function(){
    const viewType = $(".plpviewtype").val();
    const productElm = Array.from(document.querySelectorAll(".product-item")).slice(0,10);
    const itemListElement = [];
    var offersElement = [];
    productElm.forEach((productitem, index) =>{
      const name = $(productitem).find("#ga4-productName").val().trim();
      const image = $(productitem).find(".thumb img").attr("src");
      const url = $(productitem).find(".linktracking-product").attr("href");
      var price = $(productitem).find(".atc-price-analytics").text().trim().replace("$", "");
      const sku = productitem.dataset.productId;
      var variantProducts;
      if(viewType == "list"){
        variantProducts = productitem.querySelectorAll(".variant-item");
      }
      else{
        variantProducts = productitem.querySelectorAll(".card-variant-item"); 
      }
      
      if(variantProducts.length){
        variantProducts.forEach((elements, indexv) => {
          if(price !== undefined && price !== null && price !== ""){
            offersElement.push(ACC.product.schemaOffers(elements, sku, url));
          } 
        });
      }
      else if($(productitem).find(".product-row").length){
        if(price !== undefined && price !== null && price !== ""){
          offersElement.push(ACC.product.schemaOffers($(productitem).find(".product-row"),sku, url));
        }       
      }
      else if($(productitem).find(".product-item-box").length){
        if(price !== undefined && price !== null && price !== ""){
          offersElement.push(ACC.product.schemaOffers($(productitem).find(".product-item-box"),sku, url));
        } 
      }
      if(name && url){
        const item = {       
            "@type": "Product",       
            "name": name,       
            "url": url,
            "image":  image
         }
         if(offersElement.length> 0){
          item["offers"] = offersElement.length === 1 ? offersElement[0] : offersElement;
         }
         itemListElement.push({
          "@type": "ListItem",       
          "position": index+1,
          "item": item
         });
        offersElement = [];
      }
    });
    if(itemListElement.length > 0){
      const plpSchema ={
        "@context": "http://schema.org",
        "@type": "ItemList",    
        "itemListElement": itemListElement 
    }
    const schemaScriptPlp = document.getElementById("plp-schema");
    const newSchema = document.createElement("script");
    newSchema.type = "application/Id+json";
    newSchema.id="plp-schema";
    newSchema.textContent = JSON.stringify(plpSchema, null, 2);
    if(schemaScriptPlp){
      schemaScriptPlp.parentNode.replaceChild(newSchema, schemaScriptPlp);
    }
    }
    
 },
 schemaOffers: function(element, sku, url){
    var offersElement;
    var price = $(element).find(".atc-price-analytics").text().trim().replace("$", "");
    let priceAsNumber;
    if(price !== undefined && price !== null && price !== ""){
      priceAsNumber = parseFloat(price);
    } 
    const currency = $("main").data('currencyIsoCode') || "USD";
    var availability;
    if($(element).find(".stock-section-instock").length == 1 || $(element).find(".stock-section-instock-nearby").length == 1){
      availability = "InStock";
    } 
    else{
      availability = "OutOfStock";
    }
    offersElement ={
      "@type": "Offer",
      "price": priceAsNumber,
      "priceCurrency": currency,
      "availability": availability,
      "url": url,
      "sku": sku
    };
  return offersElement;
 }
};

$(document).ready(function () {     
  $ajaxCallEvent = true;
  ACC.product.enableAddToCartButton();



  $(".qtyChanged").on('blur', function () {
    $(this).parents(".quantityInputSection").find(".add_to_cart_form #quantity").val($(this).val());
    $(this).parents(".saved-list-sec").find(".fetchWishList #assembly_qty").val($(this).val());
    $(this).parents(".saved-list-sec").find(".fetchWishList #list_qty").val($(this).val());

  });





  $('input[id^=regulated]').each(function () {
  	var thisRegulated=$(this);
    var productCode = this.id.split('regulated')[1];
    var isRegulatory = ($(this).val() == 'true');
    if (isRegulatory) {
      var isProductSellable = ($("#isProductSellable" + productCode).val() == 'true');
      var isSellableInventoryHit = ($("#isSellableInventoryHit_" + productCode).val() == 'true');
      var isStockAvailable = ($("#isStockAvailable_" + productCode).val() == 'true');
      var isLicensed = ($("#isLicensed" + productCode).val() == 'true');
      var isMyStoreProduct = ($("#isMyStoreProduct" + productCode).val() == "true");
      if (isProductSellable && isMyStoreProduct) {
        $.ajax({
          url: ACC.config.encodedContextPath + "/cart/rupcheck",
          data: { "productCode": productCode, "isRegulatory": isRegulatory },
          type: "GET",
          success: function (result) {
            $("#isRup" + productCode).val(result);

            if ((result && !isLicensed)) {
              $('#listPageAddToCart_' + productCode).attr('disabled', 'disabled');
              $('#orderOnlineATC_' + productCode).attr('disabled', 'disabled');
              $('#regulatoryLicenceCheck_' + productCode).removeClass('hidden');
              thisRegulated.closest(".product-item-box").find(".js-login-to-buy").attr('disabled', 'disabled');
              
            }
            else {
              $('#regulatoryMessage_' + productCode).removeClass('hidden');
              $('#regulatoryLicenceCheck_' + productCode).addClass('hidden');
            }
            
            /* unused code - commenting
            else if((!result || (result && isLicensed)) && isSellableInventoryHit)
            {
                $('#regulatoryMessage_' + productCode).removeClass('hidden');
                $('#regulatoryLicenceCheck_' + productCode).addClass('hidden');
            }
            else if((!result || (result && isLicensed)) && !isSellableInventoryHit)
            {
                $('#regulatoryUnavailablemsg_' + productCode).removeClass('hidden');
                $('#regulatoryLicenceCheck_' + productCode).addClass('hidden');
            }*/
          }
        });
      }
      if (!isProductSellable && isMyStoreProduct) {
        $('#listPageAddToCart_' + productCode).attr('disabled', 'disabled');
        $('#orderOnlineATC_' + productCode).attr('disabled', 'disabled');
        $('#regulatoryMessage_' + productCode).removeClass('hidden');
        $('#regulatoryLicenceCheck_' + productCode).addClass('hidden');
        thisRegulated.closest(".product-item-box").find(".js-login-to-buy").attr('disabled', 'disabled');
      }
    }
  });

  window.addEventListener("pageshow", function (event) {
    if($(".page-productGrid, .page-searchGrid, .template-pages-layout-siteOneCuratedPlpLayout, .template-pages-category-categoryLandingPage").length) {
      $(".custom-checkbox").prop("checked", false).trigger('change');
	  $(".custom-checkboxlistplp").prop("checked", false).trigger('change');
      $(".js-qty-updateOne").each(function () {
        var e = { target: this };
        var productCode = $(e.target).data('productcode');
        ACC.product.checkMinQuantityPLP($('#productPLPPostQty_' +productCode), '');
	    ACC.product.handleQtyChangeForHardscapeProducts(productCode);
      });
    }
  });

  $(".more-filters-btn").on('click', function () {
    let hiddenItems = $('.morewaytofilters').nextAll('.facet.js-facet.hidden-md.hidden-lg');
    if (hiddenItems && hiddenItems.length) {
      hiddenItems.each(function (i) {
        $(this).removeClass("hidden-md hidden-lg");
      });
    }
    $(".more-filters-btn-section").remove();
  });


});
function plpBorderAlignment(){
if ($(window).width() >= 1024) {
if($('body').hasClass("page-searchGrid") && $('.product-item-box').length>4){
	$('.product-item-box').slice(4).css('border-bottom', '0');
}
else{
$('.product-item-box').slice(0).css('border-bottom', '0');
}
$('.product-item-box').slice(-4).css('border-bottom', '1px solid #e0e0e0');
$('.product-item').filter(function(i) {
    
      return (i + 1) % 4 == 0
   
   
}).find('.product-item-box').each(function(){
  if(!$(this).hasClass("unset_border")){
    $(this).css('border-right', '1px solid #e0e0e0');
  }
})
}

else if ($(window).width() <= 1023 && $(window).width()>=640) {
if($('body').hasClass("page-searchGrid") && $('.product-item-box').length>2){
$('.product-item-box').slice(4).css('border-bottom', '0');
}
else{
$('.product-item-box').slice(0).css('border-bottom', '0');
}
$('.product-item-box').slice(-2).css('border-bottom', '1px solid #e0e0e0');
$('.product-item').filter(function(i) {
    
      return (i + 1) % 2 == 0
   
   
}).find('.product-item-box').css('border-right', '1px solid #e0e0e0')
}
else if ($(window).width()<640){
	if ($('body').hasClass("page-searchGrid") && $('.product-item-box').length>2){
		$('.product-item-box').eq(1).css('border-bottom', '1px solid #e0e0e0');
	}
}
}
$(document).ready(function () {
  plpBorderAlignment();
  if($(".page-productGrid, .page-searchGrid").length) {
    ACC.product.addPlpSchema();
  }
$(window).resize(function(){
	plpBorderAlignment();
});

// Realign article images in CLP starts
function bottomArticleRealign(){
if(screen.width>=1024){
	$(".related-article-big-image").height($(".clp-related-articles-small-image").height()-30)
}
}
var imgLen = $(".clp-related-articles-small-image .slide img").length,
    counter = 0;
function incrementImageCounter(){
  counter++;
  if ( counter === imgLen ) {
    bottomArticleRealign();
  }
}
$(".clp-related-articles-small-image .slide img").each(function() {
  if(this.complete) {
    incrementImageCounter()
  }
  else{
      this.addEventListener( 'load', incrementImageCounter, false );
  }
});

$(window).resize(function(){
  bottomArticleRealign();
});
// Realign article images in CLP ends
  if($('.simple-product-pdp__value--retail-price #uomPrice').children(':visible').length === 0){
    
    $('.simple-product-pdp__value--retail-price').parent().addClass("hide");
	$('.simple-product-pdp__value--your-price').removeClass("right-price-section");
	$('.simple-product-pdp__value--your-price').parent().removeClass("col-md-2 col-sm-6 col-xs-6 text-align-right").addClass("col-md-6 col-sm-12 col-xs-12 text-center");
    }
  
  if($('.simple-product-pdp__value--your-price #uomPrice').children(':visible').length === 0 && $('.askAnExpertEnable').val() == false){
    $('.simple-product-pdp__value--your-price').parent().addClass("hide");
	$('.simple-product-pdp__value--retail-price').parent().removeClass("col-md-2 col-sm-6 col-xs-6 ").addClass("col-md-6 col-sm-12 col-xs-12");
    }
  if(($('.simple-product-pdp__value--retail-price #uomPrice').children(':visible').length === 0) && ($('.simple-product-pdp__value--your-price #uomPrice').children(':visible').length === 0)){
		$('.simple-product-pdp__value--availability').css('border-left','0');
	}   
  if($(".simple-product-pdp__value--your-price").hasClass("pdp-anonymous")){
	$(".simple-product-pdp__value--your-price").find(".callBranchForPrice").addClass("hide")
  }  
  if($(".simple-product-pdp__value--retail-price").hasClass("pdp-non-anonymous")){
	$(".simple-product-pdp__value--retail-price").find(".callBranchForPrice").addClass("hide")
  }
  if($(".simple-product-pdp__value--your-price").find(".callBranchForPrice").length){
	$(".simple-your-price-title").addClass("hide");
  }
  $(document).on("click", ".update-qty-btn", function (e) {
    var updateQtyUrl = ACC.config.encodedContextPath + "/cart/updateQuantities"
    var updateQty = $(".order-qtybox").val();
    $.ajax({
      url: updateQtyUrl,
      cache: false,
      data: {
        productQty: updateQty,
        productCode: $(".product-image-cart-popup").data("prdcode"),

      },
      type: 'POST',
      success: function (data) {
        if (data === true) {
          $(".status-message").text("Product has been added to your cart.").removeClass("alert-error").addClass("alert-info");
        }
        else {
          $(".status-message").text("Problem occured while adding to your cart.").removeClass("alert-info").addClass("alert-error");
        }
      },
      error: function (error) {

      }
    })

  })
  $(document).on("click", ".js-click-tracking", function(){
		var clickTrackingURL = $(this).parents('.produc-recomm-item').find('#clickTrackingURL').val();
		if(clickTrackingURL!=''){
			$.ajax({
				async: false,
				url: clickTrackingURL
			});
		}
  })
  $(document).on("click", ".js-addtocart-productrecs", function(){
	  	var currentparent = $(this);
      var categoryProductlength = $('.js-addtocart-productrecs').parents('.category-tile-item').length;
      currentparent.removeClass("js-addtocart-productrecs");
		var clickTrackingURL = $(this).parents('.popupproductrecomment-container').find('#clickTrackingURL').val();
		$.ajax({
			async: false,
			url: clickTrackingURL
		});
		var productrecscode = $(this).parents('.popupproductrecomment-container').find('#productrecscode').val();
		var productrecsNamePost = $(this).parents('.popupproductrecomment-container').find('#productrecsNamePost').val();
		var productrecsPostPrice = $(this).parents('.popupproductrecomment-container').find('#productrecsPostPrice').val();
		var productrecsqty = $(this).parents('.popupproductrecomment-container').find('#productrecsqty').val();
		var productrecsstoreId = $(this).parents('.popupproductrecomment-container').find('#productrecsstoreId').val();
		var productrecsBrand = $(this).parents('.popupproductrecomment-container').find('#productrecsPostBrand').val();
		var productrecsPostCategoryLeve1 = $(this).parents('.popupproductrecomment-container').find('#productrecsPostCategoryLeve1').val();
		var productrecsPostCategoryLeve2 = $(this).parents('.popupproductrecomment-container').find('#productrecsPostCategoryLeve2').val();
		var productrecsPostCategoryLeve3 = $(this).parents('.popupproductrecomment-container').find('#productrecsPostCategoryLeve3').val();
		var productrecsPostPriceFromHtml = $(this).parents('.popupproductrecomment-container').find('.atc-price-analytics').text().trim().replace('$','').replaceAll(',','');
		
			$.ajax({
			        type: 'POST',
			        url: ACC.config.encodedContextPath + "/cart/add",
			        data: { 
			        	"productCodePost":  productrecscode, 
			        	"productNamePost": productrecsNamePost,
			        	"productPostPrice": productrecsPostPrice,
			        	"storeId": productrecsstoreId,
			        	"productPostPLPQty": productrecsqty
			        	},
					success: function(result) {
						currentparent.parents('.popupproductrecomment-container').find('.productrecs-Itemadded').removeClass('hidden').fadeIn("fast");
						setTimeout(function(){currentparent.parents('.category-tile-item').remove()}, 1000);
						if(categoryProductlength == '1'){
							$('.product-recs-wrapper').remove();
						}
						ACC.minicart.updateMiniCartDisplay();
						ACC.ga4analytics.add_to_cart(
							productrecscode,
							productrecsNamePost,
							parseFloat(productrecsPostPriceFromHtml),
							parseInt(productrecsqty),
							productrecsBrand,
							productrecsPostCategoryLeve1,
							productrecsPostCategoryLeve2,
							productrecsPostCategoryLeve3,
						);
            rdt("track", "AddToCart", {
              currency: "USD",
              itemCount: 1,
              value: productrecsPostPrice,
              products: [
                {
                  id: productrecscode,
                  name: productrecsNamePost,
                  category: productrecsPostCategoryLeve1
                }
              ]
             });
					}
			});
			
	//Adobe Analytics
	
	if ($('#isAnonymous').val() == "false") {
		var currentCartId = $("#currentCartId").val();
	}
	else {
		  var currentCartId = $("#anonymousCartId").val();
	}
    
	_AAData.cartId= currentCartId;
	
	 digitalData.pfm = "recommendation";
	 digitalData.pfmdetails = "checkout: item added to cart popup";
	 
	 digitalData.eventData={
			 linktype:"recommendation",
			 linkName:"Add to Cart",
             onClickPageName: "checkout: item added to cart popup"
         }
	 
	 
	 try {
		 _satellite.track('Add Cart');
	 } catch (e) {}
	 
	});
  
   //Adobe Analytics	
  
  $(document).on("click", ".recomm-popupcart-analytics", function(){
	  
	  if ($('#isAnonymous').val() == "false") {
			var currentCartId = $("#currentCartId").val();
		}
		else {
			  var currentCartId = $("#anonymousCartId").val();
		}
	  	_AAData.cartId= currentCartId;
		
		digitalData.pfm = "recommendation";
		digitalData.pfmdetails = "checkout: item added to cart popup";
		 
		 digitalData.eventData={
				 linktype:"recommendation",
				 linkName:"product:"+digitalData.eventData.linkName,
	             onClickPageName: "checkout: item added to cart popup"
	         }
		 
  });

  if ($("body").hasClass("pageType-ProductPage") || $("body").hasClass("pageType-CategoryPage") || $("body").hasClass("page-savedListPage") || $("body").hasClass("page-compareProductPage") || $("body").hasClass("page-searchGrid")) {
    $.cookie("accountPageId", "", { path: '/' });
  }
  if ($('.product-item').length <= 2) {
    $(".remove_compare_product").hide();
  }

  ACC.product.checkCSP();
});

function cartAddAnalytics() {
	
if(digitalData.pfm)
	{
	  delete digitalData.pfm;
	  delete digitalData.pfmdetails;
	}

  var cartItems = $(".mini-cart-link").data("miniCartItemsText");
  var miniCartRefreshUrl = $(".mini-cart-link").data("miniCartRefreshUrl");
  $.ajax({
    url: miniCartRefreshUrl,
    cache: false,
    type: 'GET',
    success: function (jsonData) {
	if(ACC.global.productAnalyticsRecAtc){
		
		digitalData.pfm = "recommendation";
		digitalData.pfmdetails = _AAData.page.pageName;
		
		digitalData.eventData={
		linktype:"recommendation",
		linkName:"Add to Cart",
		onClickPageName: $(".siteonepagename").val()
		}
	}
  else if(ACC.global.productCutatedplp){ 

      digitalData.eventData={
      linktype:"product-grid",
      linkName:"Add to Cart",
      onClickPageName: $(".pagename").val()
      }
    }
	else{

		digitalData.eventData={
		linktype:_AAData.eventType,
		linkName:"Add to Cart",
		onClickPageName: $(".siteonepagename").val()
		}
    var getURL = window.location.href;
    var urlCase = getURL.toLowerCase();
    if (urlCase.indexOf('isrc=featured') > 0 || urlCase.indexOf('isrc=featuredpopup') > 0) {
        digitalData.eventData={
        linkName: 'recommendation',
        linkType: 'Add to Cart',
        onClickPageName: $(".pagename").val()
        }
      }
      
	}
	
      if ($('#isAnonymous').val() == "false") {
        var currentCartId = $("#currentCartId").val();
      }
      else {
        var currentCartId = $("#anonymousCartId").val();
      }
      if (jsonData.miniCartCount === 1 && $(".nav-cart .js-mini-cart-count .nav-items-total:visible").text().trim() === "0") {
        digitalData.cart = {
          cartId: currentCartId,
          event: "scOpen, scAdd",

        };
      }
      else {
        digitalData.cart = {
          cartId: currentCartId,
          event: "scAdd",
        };
      }

      try {
        _satellite.track("Add Cart");
      } catch (e) { }
    }


  });

}

function windowimageScroll(){
  var fixImgTop = ($('.product-main-info').length)?$('.product-main-info').offset().top : 0;
  let target =  $('.image-popup');
  let targetWidth = target.outerWidth();
  let removeSticky = ($(".rightDivArea").length)?$(".rightDivArea").outerHeight()-$(".rightDivArea").offset().top - 30: 0;
  $(window).scroll(function() 
  {           
      let scrollTop = $(this).scrollTop();
      if (scrollTop > fixImgTop && scrollTop < removeSticky){
          target.addClass('img-sticky').css({width: targetWidth});
      }
      else {
          target.removeClass('img-sticky').removeAttr("style");
      }
  });
}


function horizontalScroll(){
  var newWindowWidth = $(window).width();
  //if (newWindowWidth > 481) {
    var slider = '';
    if($('body').hasClass("template-pages-layout-siteOneCuratedPlpLayout")){      
       slider = $('.category_tiles')[1];
    }
    else{
       slider = document.querySelector('.category_tiles');
    }
    
    let isDown = false;
    let startX;
    let scrollLeft;
    if (slider) {
      slider.addEventListener('mousedown', (e) => {
        isDown = true;
        slider.classList.add('active');
        startX = e.pageX - slider.offsetLeft;
        scrollLeft = slider.scrollLeft;
      });
      slider.addEventListener('mouseleave', () => {
        isDown = false;
        slider.classList.remove('active');
      });
      slider.addEventListener('mouseup', () => {
        isDown = false;
        slider.classList.remove('active');
      });
      slider.addEventListener('mousemove', (e) => {
        if(!isDown) return;
        e.preventDefault();
        const x = e.pageX - slider.offsetLeft;
        const walk = (x - startX) * 3; //scroll-fast
        slider.scrollLeft = scrollLeft - walk;
        //console.log(walk);
      });
    }
  //}
}


$(".js-plp-qty").on("input", function(){
    ACC.product.validateShippingQty(this)
})

$(".plusQty, .minusQty").on("click", function(){
    if($(".pagename").val()=='Product Grid' || $(".pagename").val()== 'Search Results'){
    let productCode = this.id.split("_")[1];
    let inputElement = $(`#productPLPPostQty_${productCode}`);
     ACC.product.validateShippingQty(inputElement)
}
})
ACC.productVariant = {
    _autoload: [
        "bindVariantProducts"
    ],

    bindVariantProducts: function() {
        if ($(".plpviewtype").val() === "list") {
            const hasVariantProducts = $('.product-item[data-variantcount!=""]').length > 0;
            if (!hasVariantProducts) {
                return;
            }
            const products = $(".product-item");
            const totalProducts = products.length;
            const batchSize = 4;

            if (totalProducts > 4) {
                loadVariantsBatch(4);
            }

            function loadVariantsBatch(startIndex) {
                if (startIndex >= totalProducts) {
                    //loading.stop();
                    return;
                }
                const batch = products.slice(startIndex, startIndex + batchSize);
                const payload = {};
                batch.each(function () {
                    if ($(this).data('variantcount') !== "" && $(this).data('variantcount') > 1) {
                        const productCode = $(this).data('product-id');
                        const variantCodes = $(this).find('.variant-codes').attr('value');
                        if (variantCodes) {
                            const variantCodesInArrOfStr = JSON.parse(variantCodes).map(num => num.toString());
                            payload[productCode] = variantCodesInArrOfStr;
                        }
                    }
                });
                if (Object.keys(payload).length === 0) {
                    loadVariantsBatch(startIndex + batchSize);
                    return;
                }
                /* const requestData = Object.entries(payload).map(([key, values]) => {
                    return `${key}~${values}`;
                }).join("|"); */
                if (startIndex === 4) {
                    //loading.start();
                }
                $.ajax({
                    url: ACC.config.encodedContextPath + '/c/getVariantProducts',
                    type: 'POST',
                    cache: false,
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    data: JSON.stringify({ viewType: "list", "count": 2, "variantSkus": payload }),//{ "count": 2, "variantSkus": requestData },
                    success: function (response) {
                        /* console.log("**************** START");
                        console.log(response.variants);
                        console.log("**************** END"); */
                        const variantsHTML = $("<div>").html($("<div>").html(response.variants).text());
                        Object.keys(payload).forEach(function (productCode) {
                            $.each(payload[productCode], function (index, variantCode) {
                                const variantContent = variantsHTML.find(`.variant-item[data-variant-code="${variantCode}"]`);
                                if (variantContent.length) {
                                    $(`#variants-${productCode}`).append(variantContent);
                                }
                            });
                        });
                        loadVariantsBatch(startIndex + batchSize);
                    },
                    error: function () {
                        console.error('Failed to load initial variants for Product ID:', Object.keys(payload));
                        console.error('Failed to load initial variants for Products in batch starting at index:', startIndex);
                        loadVariantsBatch(startIndex + batchSize);
                        if (startIndex + batchSize >= totalProducts) {
                            loader.stop();
                        }
                    }
                });
            }

            $(document).on("click", '.toggle-variants', function () {
                const button = $(this);
                const productCode = button.data('product-id');
                const variantCount = button.data('variant-count');
                const variantCodes = button.data('variant-codes');
                const variantCodesInArrOfStr = variantCodes.join(',').split(',');
                const isLoaded = button.data('loaded');

                const displayedVariantCodes = $(`#variants-${productCode} .variant-item`).map(function () {
                    return $(this).data('variant-code').toString();
                }).get();

                const remainingVariantCodes = variantCodesInArrOfStr.filter(code => !displayedVariantCodes.includes(code));

                if (!isLoaded && remainingVariantCodes.length > 0) {
                    let variantsToFetch;
                    if (displayedVariantCodes.length === 2) {
                        variantsToFetch = remainingVariantCodes.length > 8 ? remainingVariantCodes.slice(0, 8) : remainingVariantCodes;
                    } else {
                        variantsToFetch = remainingVariantCodes;
                    }
                    /* const data = {[productCode]: remainingVariantCodes};
                    const requestData = Object.entries(data).map(([key, values]) => `${key}~${values.join(",")}`).join("|"); */
                    const requestPayload = {};
                    requestPayload['viewType'] = "list";
                    requestPayload['count'] = variantsToFetch.length;
                    requestPayload['variantSkus'] = {};
                    requestPayload['variantSkus'][productCode] = remainingVariantCodes;
                    loading.start();
                    $.ajax({
                        url: ACC.config.encodedContextPath + '/c/getVariantProducts',
                        type: 'POST',
                        cache: false,
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        data: JSON.stringify(requestPayload), //{"count": variantsToFetch.length, "variantSkus": requestData },
                        success: function (response) {
                            /* console.log("**************** Button Click START");
                            console.log(response.variants);
                            console.log("**************** Button Click END"); */
                            var decoded = $('<div>').html(response.variants).text();
                            $(`#variants-${productCode}`).append(decoded);
                            /* console.log(displayedVariantCodes.length + variantsToFetch.length);
                            console.log(variantCount); */
                            if (displayedVariantCodes.length + variantsToFetch.length >= variantCount) {
                                button.find('.option-label').text('Hide Extra');
                                button.find('.toggle-down, .toggle-up').toggle();
                                button.data('loaded', true);
                            } else {
                                button.find('.option-label').text('Show All (' + variantCount + ')');
                                button.data('loaded', false);
                            }
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log('Error: ', textStatus, errorThrown);
                            /* console.log('Response text: ', jqXHR.responseText); */
                            console.error(`Failed to load variants for Product ID: ${productCode}`);
                        }
                    }).always(function () {
                        loading.stop();
                    });
                } else {
                    const isHidden = $(`#variants-${productCode}`).find('.variant-item:gt(1)').is(':visible');
                    /* console.log(isHidden); */
                    if (isHidden) {
                        $(`#variants-${productCode}`).find('.variant-item:gt(1)').hide();
                        button.find('.option-label').text('Show All (' + variantCount + ')');
                    } else {
                        $(`#variants-${productCode}`).find('.variant-item:gt(1)').show();
                        button.find('.option-label').text('Hide Extra');
                    }
                    button.find('.toggle-up, .toggle-down').toggle();
                    $(window).scrollTop($(`#variants-${productCode}`).offset().top-200);
                }
            });
        }
    },
    handleVariantAddToCart: function(e, button) {
        ACC.product.bindToAddToCartForm();
        var variantItem = $(button).closest('.variant-item');
        var variantItemCategory=$(button).closest('.product-item-box').find('#ga4-categoryLeve1').val();
        if (variantItem.find('.stock-section-instock').length) {
            if ((variantItem.find(".js-variant-qty").val().trim() <= variantItem.find('.stock-section-instock').data("available-qty"))) {
                variantItem.parent().siblings(".plp-commonerror-section").addClass("hidden");
                variantItem.find('.qty-hidden-variant').val(variantItem.find(".js-variant-qty").val().trim());
                $(button).closest('form').submit();
                variantItem.find(".js-variant-qty").val("1");
            } else {
                variantItem.parent().siblings(".plp-commonerror-section").removeClass("hidden");
                e.preventDefault();
            }
        } else if(variantItem.find('.stock-section-instock-nearby').length) {
             if ((variantItem.find(".js-variant-qty").val().trim() <= variantItem.find('.stock-section-instock-nearby').data("available-qty"))) {
                variantItem.parent().siblings(".plp-commonerror-section").addClass("hidden");
	            variantItem.find('.qty-hidden-variant').val(variantItem.find(".js-variant-qty").val().trim());
	            $(button).closest('form').submit();
	            variantItem.find(".js-variant-qty").val("1");
            } else {
                variantItem.parent().siblings(".plp-commonerror-section").removeClass("hidden");
                e.preventDefault();
            }
        } else if(variantItem.find('.stock-section-backorder').length && variantItemCategory=='Nursery') {
              $(button).closest('form').submit();
               variantItem.find(".js-variant-qty").val("1");
        } 
        else {
            /* variantItem.parent().siblings(".plp-commonerror-section").removeClass("hidden"); */
            e.preventDefault();
        }
    },
    validateErrorCase: function(element) {
        var variantItem = $(element).closest('.variant-item');
        let getAQuoteFlag = variantItem.find(".getAQuoteFlagForB2BUser").val();
        if (variantItem.find('.stock-section-instock').length) {
            if (variantItem.find(".js-variant-qty").val().trim() !== "" && variantItem.find(".js-variant-qty").val().trim() <= variantItem.find('.stock-section-instock').data("available-qty")) {
                variantItem.parent().siblings(".plp-commonerror-section").addClass("hidden");
                variantItem.find('.qty-hidden-variant').val(variantItem.find(".js-variant-qty").val().trim());
                variantItem.find('.variant-login-to-buy_atc').removeAttr("disabled");
                if(getAQuoteFlag == "true") {
                    variantItem.find(".getAQuoteSection").addClass("hidden");
                    variantItem.find(".variant-atc-wrapper-section").removeClass("hidden");
                }
            } else {
                variantItem.parent().siblings(".plp-commonerror-section").removeClass("hidden");
                variantItem.parent().siblings(".plp-commonerror-section").find(".plp-commonerror").text(ACC.config.enterValidQuantity);
                variantItem.find('.variant-login-to-buy_atc').attr("disabled", "disabled");
                if(getAQuoteFlag == "true") {
                    variantItem.find(".getAQuoteSection").removeClass("hidden");
                    variantItem.find(".variant-atc-wrapper-section").addClass("hidden");
                    variantItem.parent().siblings(".plp-commonerror-section").find(".plp-commonerror").text(ACC.config.adjustQuantityToAddtoCart);
                }
            }
        } else if(variantItem.find('.stock-section-instock-nearby').length) {
           if (variantItem.find(".js-variant-qty").val().trim() !== "" && variantItem.find(".js-variant-qty").val().trim() <= variantItem.find('.stock-section-instock-nearby').data("available-qty")) {
                variantItem.parent().siblings(".plp-commonerror-section").addClass("hidden");
                variantItem.find('.qty-hidden-variant').val(variantItem.find(".js-variant-qty").val().trim());
                variantItem.find('.variant-login-to-buy_atc').removeAttr("disabled");
                if(getAQuoteFlag == "true") {
                    variantItem.find(".getAQuoteSection").addClass("hidden");
                    variantItem.find(".variant-atc-wrapper-section").removeClass("hidden");
                }
            } else {
                variantItem.parent().siblings(".plp-commonerror-section").removeClass("hidden");
                variantItem.parent().siblings(".plp-commonerror-section").find(".plp-commonerror").text(ACC.config.enterValidQuantity);
                variantItem.find('.variant-login-to-buy_atc').attr("disabled", "disabled");
                if(getAQuoteFlag == "true") {
                    variantItem.find(".getAQuoteSection").removeClass("hidden");
                    variantItem.find(".variant-atc-wrapper-section").addClass("hidden");
                    variantItem.parent().siblings(".plp-commonerror-section").find(".plp-commonerror").text(ACC.config.adjustQuantityToAddtoCart);
                }
            }
        } /* else {
            variantItem.parent().siblings(".plp-commonerror-section").removeClass("hidden");
        } */
    },
    decreaseQuantity: function(button) {
        var input = $(button).siblings(".js-variant-qty");
        var qty = parseInt(input.val(), 10) || 1;
        if(qty > 1) {
            input.val(qty - 1).trigger("input");
        }
        input.blur();
        input.focus();
        ACC.productVariant.validateErrorCase(button);
    },
    increaseQuantity: function(button) {
        var input = $(button).siblings(".js-variant-qty");
        var qty = parseInt(input.val(), 10) || 1;
        if(qty < 99999) {
            input.val(qty + 1).trigger("input");
        }
        input.blur();
        input.focus();
        ACC.productVariant.validateErrorCase(button);
    },
    isNumberKey: function(evt) {
        var charCode = evt.which ? evt.which : evt.keyCode;
        if(charCode < 48 || charCode > 57) {
            return false;
        }
        return true;
    },
    updateQty: function(input) {
        input.value = input.value.replace(/\D/g, "");
        if(input.value === '0') {
            input.value = "1";
        }
        if(input.value !== "" && parseInt(input.value, 10) > 99999) {
            input.value = "99999";
        }        
        var form = $(input).closest(".variant-item").find(".add_to_cart_form");
        form.find(".js-qty-selector-input").val(input.value || '1');
        ACC.productVariant.validateErrorCase(input);
    },
    setDefaultValue: function(input) {
        if(input.value.trim() === "") {
            input.value = "1";
        }
        var form = $(input).closest(".variant-item").find(".add_to_cart_form");
        form.find(".js-qty-selector-input").val(input.value);
        ACC.productVariant.validateErrorCase(input);
    }
};
ACC.productcardvariant = {
    _autoload: [
        "bindCardVariantProducts"
    ],

    bindCardVariantProducts: function() {
	   if ($(".plpviewtype").val() === "card") {
		   const hasVariantProducts = $('.product-item[data-cardvariantcount!=""]').length > 0;
            if (!hasVariantProducts) {
                return;
            }
      	const products = $(".product-item");
        const totalProducts = products.length;
        const batchSize = 4;
    
        if (totalProducts > 4) {
            loadVariantsBatch(4);
        }
    
        function loadVariantsBatch(startIndex) {
			if (startIndex >= totalProducts) {
                    //loading.stop();
                    return;
            }
            const batch = products.slice(startIndex, startIndex + batchSize);
            const payload = {};
            batch.each(function () {
				if ($(this).data('cardvariantcount') !== "" && $(this).data('cardvariantcount') > 1) {
                        const productCode = $(this).data('product-id');
                        const variantCodes = $(this).find('.variant-codes').attr('value');
                        if (variantCodes) {
                            const variantCodesInArrOfStr = JSON.parse(variantCodes).map(num => num.toString());
                            payload[productCode] = variantCodesInArrOfStr;
                        }
                }
            });
            if (Object.keys(payload).length === 0) {
                    loadVariantsBatch(startIndex + batchSize);
                    return;
            }
                /* const requestData = Object.entries(payload).map(([key, values]) => {
                    return `${key}~${values}`;
                }).join("|"); */
            if (startIndex === 4) {
                    //loading.start();
            }
            $.ajax({
                url: ACC.config.encodedContextPath + '/c/getVariantProducts',
                type: 'POST',
                cache: false,
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                data: JSON.stringify({ "count": 4, "variantSkus": payload, viewType: "card"}),//{ "count": 2, "variantSkus": requestData },
                success: function (response) {
                    /* console.log("**************** START");
                    console.log(response.variants);
                    console.log("**************** END"); */
                    const variantsHTML = $("<div>").html($("<div>").html(response.cardvariants).text());
                    Object.keys(payload).forEach(function (productCode) {	
                            const productContent = variantsHTML.find(`.cardview-variant-item[data-product-code="${productCode}"]`);
                            if (productContent.length) {
                                $(`#cardview-variants-${productCode}`).append(productContent);
                            }
                            const productListContent = variantsHTML.find(`.cardview-variant-item-list[data-product-code="${productCode}"]`);
                            if (productListContent.length) {
                                $(`#cardview-variants-list-${productCode}`).append(productListContent);
                            }
                    });
                    loadVariantsBatch(startIndex + batchSize);
                },
                error: function (jqXHR, textStatus, errorThrown) {
					console.log('Error: ', textStatus, errorThrown);
                    console.error('Failed to load initial variants for Product ID:', Object.keys(payload));
                    loadVariantsBatch(startIndex + batchSize);
                        if (startIndex + batchSize >= totalProducts) {
                            loader.stop();
                     }
                }
            });
        }
      }
    },
     cardvariantdecreaseQuantity: function(button) {
        var input = $(button).siblings(".js-variant-qty");
        var qty = parseInt(input.val(), 10) || 1;
        if(qty > 1) {
            input.val(qty - 1).trigger("input");
        }
        input.blur();
        input.focus();
        ACC.productcardvariant.cardvariantvalidateErrorCase(button);
    },
    cardvariantisNumberKey: function(evt) {
        var charCode = evt.which ? evt.which : evt.keyCode;
        if(charCode < 48 || charCode > 57) {
            return false;
        }
        return true;
    },
    cardvariantupdateQty: function(input) {
        input.value = input.value.replace(/\D/g, "");
        if(input.value === '0') {
            input.value = "1";
        }
        if(input.value !== "" && parseInt(input.value, 10) > 99999) {
            input.value = "99999";
        }        
        var form = $(input).closest(".card-variant-item").find(".add_to_cart_form");
        form.find(".js-qty-selector-input").val(input.value || '1');
        ACC.productcardvariant.cardvariantvalidateErrorCase(input);
    },
    cardvariantsetDefaultValue: function(input) {
        if(input.value.trim() === "") {
            input.value = "1";
        }
        var form = $(input).closest(".card-variant-item").find(".add_to_cart_form");
        form.find(".js-qty-selector-input").val(input.value);
        ACC.productcardvariant.cardvariantvalidateErrorCase(input);
    },
    cardvariantincreaseQuantity: function(button) {
        var input = $(button).siblings(".js-variant-qty");
        var qty = parseInt(input.val(), 10) || 1;
        if(qty < 99999) {
            input.val(qty + 1).trigger("input");
        }
        input.blur();
        input.focus();
        ACC.productcardvariant.cardvariantvalidateErrorCase(button);
    },
    cardvarianthandleVariantAddToCart: function(e, button) {
        ACC.product.bindToAddToCartForm();
        var variantItem = $(button).closest('.card-variant-item');
        var variantItemCategory=$(button).closest('.product-item-box').find('#ga4-categoryLeve1').val();
        if (variantItem.find('.stock-section-instock').length) {
            if ((Number(variantItem.find(".js-variant-qty").val().trim()) <= variantItem.find('.stock-section-instock').data("available-qty"))) {
                variantItem.find(".plp-commonerror-section").addClass("hidden")
                variantItem.find('.qty-hidden-variant').val(variantItem.find(".js-variant-qty").val().trim());
                $(button).closest('form').submit();
                variantItem.find(".js-variant-qty").val("1");
            } else {
                variantItem.find(".plp-commonerror-section").removeClass("hidden");
                e.preventDefault();
            }
        }else if(variantItem.find('.stock-section-instock-nearby').length) {
			if ((Number(variantItem.find(".js-variant-qty").val().trim()) <= variantItem.find('.stock-section-instock-nearby').data("available-qty"))) {
                variantItem.find(".plp-commonerror-section").addClass("hidden");
	            variantItem.find('.qty-hidden-variant').val(variantItem.find(".js-variant-qty").val().trim());
	            $(button).closest('form').submit();
	            variantItem.find(".js-variant-qty").val("1");
            } else {
                variantItem.find(".plp-commonerror-section").removeClass("hidden");
                e.preventDefault();
            }
        }else if(variantItem.find('.stock-section-backorder').length && variantItemCategory=='Nursery') {
             $(button).closest('form').submit();
             variantItem.find(".js-variant-qty").val("1");
        } else {
            /* variantItem.parent().siblings(".plp-commonerror-section").removeClass("hidden"); */
            e.preventDefault();
        }
    },
    cardvariantvalidateErrorCase: function(element) {
        var variantItem = $(element).closest('.card-variant-item');
        let getAQuoteFlag = variantItem.find(".getAQuoteFlagForB2BUser").val();
        if (variantItem.find('.stock-section-instock').length) {
            if (Number(variantItem.find(".js-variant-qty").val().trim()) !== "" && Number(variantItem.find(".js-variant-qty").val().trim())  <= variantItem.find('.stock-section-instock').data("available-qty")) {
                variantItem.find(".plp-commonerror-section").addClass("hidden")
                variantItem.find('.qty-hidden-variant').val(variantItem.find(".js-variant-qty").val().trim());
                variantItem.find('.variant-login-to-buy_atc').removeAttr("disabled");
                if(getAQuoteFlag == "true") {
                    variantItem.find(".getAQuoteSection").addClass("hidden");
                    variantItem.find(".cardvariant-atc-wrapper-section").removeClass("hidden");
                }
            } else {
                variantItem.find(".plp-commonerror-section").removeClass("hidden");
                variantItem.find(".plp-commonerror-section").find(".plp-commonerror").text(ACC.config.enterValidQuantity);
                variantItem.find('.variant-login-to-buy_atc').attr("disabled", "disabled");
                if(getAQuoteFlag == "true") {
                    variantItem.find(".getAQuoteSection").removeClass("hidden");
                    variantItem.find(".cardvariant-atc-wrapper-section").addClass("hidden");
                    variantItem.find(".plp-commonerror-section").find(".plp-commonerror").text(ACC.config.adjustQuantityToAddtoCart);
                }
            }
        } else if(variantItem.find('.stock-section-instock-nearby').length) {
			 if (Number(variantItem.find(".js-variant-qty").val().trim()) !== "" && Number(variantItem.find(".js-variant-qty").val().trim())  <= variantItem.find('.stock-section-instock-nearby').data("available-qty")) {
                variantItem.find(".plp-commonerror-section").addClass("hidden")
                variantItem.find('.qty-hidden-variant').val(variantItem.find(".js-variant-qty").val().trim());
                variantItem.find('.variant-login-to-buy_atc').removeAttr("disabled");
                if(getAQuoteFlag == "true") {
                    variantItem.find(".getAQuoteSection").addClass("hidden");
                    variantItem.find(".cardvariant-atc-wrapper-section").removeClass("hidden");
                }
            } else {
                variantItem.find(".plp-commonerror-section").removeClass("hidden");
                variantItem.find(".plp-commonerror-section").find(".plp-commonerror").text(ACC.config.enterValidQuantity);
                variantItem.find('.variant-login-to-buy_atc').attr("disabled", "disabled");
                if(getAQuoteFlag == "true") {
                    variantItem.find(".getAQuoteSection").removeClass("hidden");
                    variantItem.find(".cardvariant-atc-wrapper-section").addClass("hidden");
                    variantItem.find(".plp-commonerror-section").find(".plp-commonerror").text(ACC.config.adjustQuantityToAddtoCart);
                }
            }
        }  /* else {
            variantItem.parent().siblings(".plp-commonerror-section").removeClass("hidden");
        } */
    }
};
ACC.facets = {
    _autoload: [
       // "bindFacets"
    ],
    showMoreFacet: function(event) {
        var facetTotalCount = $("#totalFacetSize").val();
        var limit = $("#facetLimit").val();
        var currentOffset = parseInt($(event).data('offset'), 10);
        ACC.facets.bindFacets(currentOffset, limit);
        currentOffset += parseInt(limit);
        if(currentOffset >= parseInt(facetTotalCount)){
            $(event).parent().hide();
        } 
    },
    bindFacets: function(currentOffset, limit) {   
        var pageId = $("#pageId").val();
        var categoryCode = "";
        var queryParam = "";
        var apiPath = ACC.config.encodedContextPath;
        var url = window.location.href;
        var spliturl = url.split("/");
        var intCat = spliturl[spliturl.length-1];
        var _queryString = intCat.split("?");
        if(_queryString.length > 1){
            queryParam =  _queryString[1];
        }
        if (pageId == 'searchGrid' ){
            apiPath = apiPath + '/search/facets' + '?facetOffset=' + currentOffset + '&' + queryParam ;
        }
        if (pageId == 'productGrid' ){
            categoryCode = $("#categoryCodePR").val();
            var _param = "";
            if(queryParam.includes('?')){
                _param = '?facetOffset=' + currentOffset + '&' + queryParam;
            } 
            else{
                _param = '?facetOffset=' + currentOffset;
            } 
            apiPath = apiPath + '/c/'+ categoryCode +'/facets' + _param;
        }  
        $.ajax({
            url: apiPath,
            type: 'GET',
            cache: false,
            async: true,
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            success: function (response) {
                var decoded = $('<div>').html(response.facets).text();
                $('#productFacets').append(decoded);  
                $("#showMoreFilters").data("offset", parseInt(currentOffset) + parseInt(limit));       
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log('Error: ', textStatus, errorThrown); 
            }
        });  
    }
};
ACC.productDetail = {

    _autoload: [
        "initPageEvents",
        "bindVariantOptions",
        "bindCSPForCarousal",
		"bindAddtoList",
		"hideEmptyTabs",
		"AddReadMore",
		"regulatedLabel",
		"multipleUomItemSelector",
		"hardscapesStonePDPAlert",
		"landscapeNotePDPAlert",
		"pdpBulletPointLoad"
		
    ],

	BulkUomCode: '',
	varientProductQTY: '',
	plpProductQTY: '',
	plpCommonBtn: "false",
	plpMobileAddListCode: '',
	hideEmptyTabs: function(){
		$(".tab-pane").each(function(){ 
			if($(this).children().length == 0){
				var thisID = $(this).attr("id");
				var thisLink = $(".nav-tabs li a[href$='" + thisID + "']");
				if(thisLink.parent().hasClass('active')){
					thisLink.parent().next().addClass('active');
				}
				if($(this).hasClass('active')){
					$(this).removeClass('active');
					$(this).next().addClass('active');
				}
				thisLink.hide();
			}
		 });
	},
	
	regulatedLabel: function() {
		if($('.regulatedItemLabel').hasClass('hide'))
			{
			    $('.regulatedItemwithoutprice').show();
			    $('.regulatedItemwithprice').hide();
		    }
	},
	
	AddReadMore: function() {
        var maxLmt = 400;
        var readMoreTxt = " Read More";
        var readLessTxt = " Read Less";
        $(".addReadMore").each(function() {
            var allstr = $(this).html();
            if (allstr.length > maxLmt) {
                var firstSet = allstr.substring(0, maxLmt);
                var secdHalf = allstr.substring(maxLmt, allstr.length);
                var appendContent ="<div class=' bottom-overflow-fade'>" + firstSet+ "<span class=' SecSec'>" + secdHalf + "</span></div><br><button class='col-md-3 btn-secondary  readMore bottom-btn'>" + readMoreTxt + "<i class='downArrow'></i><br></button><button class='col-md-3 btn-secondary  readLess bottom-btn' >" + readLessTxt + "<i class='upArrow'></button>";
                $(this).html(appendContent);
                $('.bottom-overflow-fade').css('-webkit-mask-image', 'linear-gradient(to bottom, black 50%, transparent 100%)');
            }
        });
        $(document).on("click", ".readMore,.readLess", function() {
            $(this).closest(".addReadMore").toggleClass("showlesscontent showmorecontent");
        });
        $(document).on("click", ".readMore", function() {
            $('.bottom-overflow-fade').css('-webkit-mask-image', 'none');
        });
        $(document).on("click", ".readLess", function() {
            $('.bottom-overflow-fade').css('-webkit-mask-image', 'linear-gradient(to bottom, black 50%, transparent 100%)');
        });
    },

    checkQtySelector: function (self, mode) {
        var input = $(self).parents(".js-qty-selector").find(".js-qty-selector-input");
        var inputVal = parseInt(input.val());
        var max = input.data("max");
        var minusBtn = $(self).parents(".js-qty-selector").find(".js-qty-selector-minus");
        var plusBtn = $(self).parents(".js-qty-selector").find(".js-qty-selector-plus");

        $(self).parents(".js-qty-selector").find(".btn").removeAttr("disabled");

        if (mode == "minus") {
            if (inputVal != 1) {
                ACC.productDetail.updateQtyValue(self, inputVal - 1)
                if (inputVal - 1 == 1) {
                    minusBtn.attr("disabled", "disabled")
                }

            } else {
                minusBtn.attr("disabled", "disabled")
            }
        } else if (mode == "reset") {
            ACC.productDetail.updateQtyValue(self, 1)

        } else if (mode == "plus") {
            if(max == "FORCE_IN_STOCK") {
                ACC.productDetail.updateQtyValue(self, inputVal + 1)
            } else if (inputVal <= max) {
                ACC.productDetail.updateQtyValue(self, inputVal + 1)
                if (inputVal + 1 == max) {
                    plusBtn.attr("disabled", "disabled")
                }
            } else {
                plusBtn.attr("disabled", "disabled")
            }
        } else if (mode == "input") {
            if (inputVal == 1) {
                minusBtn.attr("disabled", "disabled")
            } else if(max == "FORCE_IN_STOCK" && inputVal > 0) {
                ACC.productDetail.updateQtyValue(self, inputVal)
            } else if (inputVal == max) {
                plusBtn.attr("disabled", "disabled")
            } else if (inputVal < 1) {
                ACC.productDetail.updateQtyValue(self, 1)
                minusBtn.attr("disabled", "disabled")
				ACC.productDetail.multipleUomTotalPriceUpdater()
            } else if (inputVal > max) {
                ACC.productDetail.updateQtyValue(self, max)
                plusBtn.attr("disabled", "disabled")
            }
        } else if (mode == "focusout") {
        	var reg = new RegExp('[^0-9]','g');
            if (reg.test(inputVal) || isNaN(inputVal)){
                $("#qtyError").html("<div class='bg-danger' style='margin:10px 0px;'><div class='panel-body'><font color='red'>"+ACC.config.productDetail+"</font></div></div> ");
                ACC.productDetail.updateQtyValue(self, 1);
                minusBtn.attr("disabled", "disabled");
            } else if(inputVal >= max) {
                plusBtn.attr("disabled", "disabled");
            }
        }

    },

    updateQtyValue: function (self, value) {
        var input = $(self).parents(".js-qty-selector").find(".js-qty-selector-input");
        var addtocartQty = $(self).parents(".addtocart-component").find("#addToCartForm").find(".js-qty-selector-input");
        var configureQty = $(self).parents(".addtocart-component").find("#configureForm").find(".js-qty-selector-input");
        input.val(value);
        addtocartQty.val(value);
        configureQty.val(value);
        var addtocartQtyVariant = $(self).parents(".qty-atc-wrapper").find("#addToCartForm").find(".js-qty-selector-input");
        addtocartQtyVariant.val(value);
    },
    
    plpMobileAddList: function (productCode) {
			ACC.productDetail.plpCommonBtn = "false";
			ACC.productDetail.plpMobileAddListCode = productCode;
			$('.pdplistpopupoption').removeClass('selected');
			$(".pdplistpopup1").removeClass('hidden');
			$(".pdp-newlist-popup-error-text").hide();
			$(".pdp-emptynewlist-popup-error-text").hide();
			$('.listpopupsavebtn').removeClass("disabled");
			$('.createnewlistbtn').removeClass("disabled");
			$(".pdp-atl-popup").colorbox.resize();
			if($('.loginstatus').val()!=''){
				ACC.colorbox.open("", {
					html:  $("#listpopup").html(),
					width: "500px",
					className: "pdp-atl-popup",
					onComplete:function(){
					$(document).on("click",".listpopupclosebtn", function(e){
						ACC.colorbox.close();
					});
					}
				})
			}
    },

    initPageEvents: function () {
		
		$(document).on("click", '.js-qty-selector .js-qty-selector-minus', function () {
            ACC.productDetail.checkQtySelector(this, "minus");
        })

        $(document).on("click", '.js-qty-selector .js-qty-selector-plus', function () {
            ACC.productDetail.checkQtySelector(this, "plus");
        })

        $(document).on("keydown", '.js-qty-selector .js-qty-selector-input', function (e) {

            if (($(this).val() != " " &&  ((e.which >= 48 && e.which <= 57 ) || (e.which >= 96 && e.which <= 105 ))  ) || e.which == 8 || e.which == 46 || e.which == 37 || e.which == 39 || e.which == 9) {
            }
            else if (e.which == 38) {
                ACC.productDetail.checkQtySelector(this, "plus");
            }
            else if (e.which == 40) {
                ACC.productDetail.checkQtySelector(this, "minus");
            }
            else {
                e.preventDefault();
            }
            $('#qtyError').html('');
        })

        $(document).on("keyup", '.js-qty-selector .js-qty-selector-input', function (e) {
            ACC.productDetail.checkQtySelector(this, "input");
            ACC.productDetail.updateQtyValue(this, $(this).val());

        })
        
        $(document).on("focusout", '.js-qty-selector .js-qty-selector-input', function (e) {
            ACC.productDetail.checkQtySelector(this, "focusout");
            ACC.productDetail.updateQtyValue(this, $(this).val());
        })
        
                  $('#sellableUoms').show();
        if($("#sellableUoms").length!=0)
        	{
        		$('#optionAddToList').hide();
        		$('#showOptionAddToList').show();
        	}
        else
        	{
        	$('#optionAddToList').show();
    		$('#showOptionAddToList').hide();
        	}
                $('#orderingAccountMsg').hide();
       
		ACC.productDetailBulkUomCode = $('.bulk-uom').text().trim().slice(0,20);
        $(document).on("change", ".js-uom-selector-input", function (e) 
        {
            var basePrice=$("#listPrice").val();
            var customerPrice=$("#customerPrice").val();
            if(basePrice != "" || customerPrice != "" )
             {
                
            $('#inventoryUomId').val($(this).val());
            $('#inventoryUOMIDVal').val($(this).val());
            
            if($(this).val() == "select"){
                window.location.reload(); 
                  $('#sellableUoms').show();
                  if($("#sellableUoms").length!=0)
              	{
              		$('#optionAddToList').hide();
              		$('#showOptionAddToList').show();
              	}
              else
              	{
              	$('#optionAddToList').show();
          		$('#showOptionAddToList').hide();
              	}
                  $('#showAddtoCartUom').hide();
                  $('#orderingAccountMsg').hide();
            } else {
                var productCode = $('#productcode').val(); 
				var productUom = $('.bulk-uom').text().trim().slice(0,20);
                var formatter = new Intl.NumberFormat('en-US', {
                      style: 'currency',
                      currency: 'USD',
                      minimumFractionDigits: 2,
                 });
                var inventoryMultiplier= $(this).find(":selected").data("inventory");
				        var uomMeasure = $(this).find(":selected").text();
                   $('#showAddtoCartUom').show();
                   $('#orderingAccountMsg').show();
                   $('#sellableUoms').hide(); 
                   $('#optionAddToList').show();
           		$('#showOptionAddToList').hide();
				url= ACC.config.encodedContextPath +'/p/getUOMPrice';
                    $.ajax({
                        url: url,
                        cache: false,
                        type: "get",
                        dataType: 'json',
                        contentType: 'application/json',
                        data : 
                        {
                            "productCode": productCode,
                            "inventoryMultiplier":inventoryMultiplier
                        },
                       success: function (productData) 
                       {
                          if(null != productData)
                          {
                              if(productData.customerPrice != null && $("#uomPrice > .yourPrice" ).length)
                              {
									$("#uomPrice  .siteOneListPrice").nextAll(".price_variant").addClass("hide");
									
									
									$("#uomPrice  .siteOneListPrice" ).next().html('<del>'+formatter.format(productData.price.value) +' / '+uomMeasure +'</del>');
									
									if(inventoryMultiplier > 1){
										$("#uomPrice  .yourPriceValue" ).html('<div class="row"><div class="col-md-10 col-sm-12 bulk-price">'+formatter.format(productData.customerPrice.value)+' / '+uomMeasure +'</div><div class="col-md-2 col-sm-12 bulk-uom">'+ACC.productDetailBulkUomCode+'</div></div>');
									}else{
										productUom = ''
										$("#uomPrice  .yourPriceValue" ).html('<div class="csp-uom-change">'+formatter.format(productData.customerPrice.value)+' / '+uomMeasure +'</div>');
									}
									$(".list-uom-change").html()
									
									                     
                              }
                              else
                              {
								
								$("#uomPrice  .siteOneListPrice").nextAll(".price_variant").addClass("hide");
								if($(".PdpUomListPrice").length===0){
							    $("#uomPrice  .siteOneListPrice" ).after('<div class="PdpUomListPrice row">');
								}
								if(inventoryMultiplier > 1){
									$(".PdpUomListPrice").html('<div class="col-md-10 col-sm-12 bulk-price-guest">'+formatter.format(productData.price.value) +' / '+uomMeasure + '  '+ '</div><div class="col-md-2 col-sm-12 bulk-uom-guest">'+productUom+'</div>'+'</div>')
								}else{
									productUom = ''
									$(".PdpUomListPrice").html(formatter.format(productData.price.value) +' / '+uomMeasure+'</div>')
								}	
                              }
                          }
                       },
                    });
					  $('#sellableUoms').hide(); 
                      $('#optionAddToList').show();
              		  $('#showOptionAddToList').hide();
                      $('#showAddtoCartUom').show();
                    
            }
                }

			else {
					  $('#sellableUoms').hide(); 
                      $('#optionAddToList').show();
              		  $('#showOptionAddToList').hide();
                      $('#showAddtoCartUom').show();
				}
    }),
        

        $("#Size").change(function () {
            changeOnVariantOptionSelection($("#Size option:selected"));
        });

        $("#variant").change(function () {
            changeOnVariantOptionSelection($("#variant option:selected"));
        });

        $(".selectPriority").change(function () {
            window.location.href = $(this[this.selectedIndex]).val();
        });

        function changeOnVariantOptionSelection(optionSelected) {
            window.location.href = optionSelected.attr('value');
        }
    },

    bindVariantOptions: function () {
        ACC.productDetail.bindCurrentStyle();
        ACC.productDetail.bindCurrentSize();
        ACC.productDetail.bindCurrentType();
    },
    
   
    
    bindCSPForCarousal: function() 
    {
        
                
   $('a[id^="customerPrice"]').click(function() 
      {
        var code = $(this).data("code");
        var IsBuyable=$(this).data('isBuyable');
        //var index = $(this).data('index');
        var phoneNumber = $("#sessionStorePhoneNumber").val();
        loading.start();
        $.ajax({
          url : ACC.config.encodedContextPath + "/p/salecustomerprice?productCode="+code+"&quantity=1",
          method:"POST",
          success : function(siteOneCspWithSaleResponse)
          {
              //console.log(siteOneCspWithSaleResponse.salePrice);
            var siteOneCspResponse = siteOneCspWithSaleResponse.cspResponse;
            if(siteOneCspResponse != null && siteOneCspResponse.isSuccess)
            {
                $("#cspSection"+code).show();
                if(siteOneCspWithSaleResponse.salePrice != '$0.00') 
                {
                    if(IsBuyable)
                    {
                     $("#carosuelPageAddToCart_"+code).attr("disabled", false);
                    }
                
                }
                if(siteOneCspWithSaleResponse.salePrice != null) {
                    var salePriceString=siteOneCspWithSaleResponse.salePrice;
                    var salePrice=parseInt(salePriceString).toFixed(2);
                    //$("#cspSection"+code).show();
                    $("#customerPrice"+code).hide();
                    //var salePrice=siteOneCspWithSaleResponse.salePrice.toFixed(2);
                    $("#csp"+code).html("$"+ salePrice +"<br>"+ "<del>" + siteOneCspResponse.price.formattedValue + "</del>")
                } else {
                    //alert(siteOneCspResponse.price.formattedValue);
                    $("#customerPrice"+code).hide();
                    $("#csp"+code).html(siteOneCspResponse.price.formattedValue);
                }
                
                
                
             /* $("#customerSpecificPriceLink"+productCode).hide();
              $("#customerSpecificPriceSection"+productCode).show();
              $("#customerSpecificPrice"+productCode).html(siteOneCspResponse.price.formattedValue);
              $("#customerSpecificPriceValue"+index).val(siteOneCspResponse.price.value);
              ACC.promotions.calculatePromotionPrice($("#productPromotion"+index), productCode);
              $("#listPageAddToCart_"+productCode).attr("disabled", false);
              $("#priceUnavailabilityMsg"+index).addClass('hidden');*/
            }
            else
            {
                $("#customerPrice"+code).hide();
                $("#customerPriceError"+code).html("Price not available. Please contact store <a class='tel-phone' href='tel:"+phoneNumber+"'>"+phoneNumber+"</a>");
                $("#priceUnavailabilityMsg"+code).addClass('hidden');
                $("#priceUnavailable"+code).addClass('hidden');
              /*if($('#customerSpecificPrice' + productCode == ""))
              {
                  $("#basePrice"+index).show();
                    $('#salePrice' + index).show();
              }else{
                  $("#basePrice"+index).hide();
                    $('#salePrice' + index).hide();
              }
                     
                    $("#cspError"+index).html("Price not available. Please contact store " + phoneNumber);
                
                    $("#priceUnavailabilityMsg"+index).addClass('hidden');*/
            }
          }
        }).always(function() {
          loading.stop();
        });
          
      }); 
    },
    

    bindCurrentStyle: function () {
        var currentStyle = $("#currentStyleValue").data("styleValue");
        var styleSpan = $(".styleName");
        if (currentStyle != null) {
            styleSpan.text(": " + currentStyle);
        }
    },

    bindCurrentSize: function () {
        var currentSize = $("#currentSizeValue").data("sizeValue");
        var sizeSpan = $(".sizeName");
        if (currentSize != null) {
            sizeSpan.text(": " + currentSize);
        }
    },

    bindCurrentType: function () {
        var currentSize = $("#currentTypeValue").data("typeValue");
        var sizeSpan = $(".typeName");
        if (currentSize != null) {
            sizeSpan.text(": " + currentSize);
        }
    },
    
    reAlignColorBoxToPage:function(){
        var window_height = $(window)[0].innerHeight;
        var top_position = 0;
         $.colorbox.resize();
         var colorbox_height = $('#colorbox').height();
         if(window_height > colorbox_height) {
            top_position = (window_height - colorbox_height) / 2;
        }
         $('#colorbox').css({'top':top_position, 'position':'fixed'});
    },
popupHtmlCreateNewList: function(successmsg, wishlistCode){
	let htmlCode = "<div class='PopupBox'><h1 class='headline'>"+successmsg+"</h1><div class='row marginTop40 mob-list-confo'><div class='col-md-6 col-xs-12'><input class='btn btn-primary btn-block successListCreation' type='button' value='"+ACC.config.continueShopping+"'></div><div class='col-md-6 col-xs-12'><a href='"+ACC.config.encodedContextPath+'/savedList/listDetails?code=' + wishlistCode +"' class='btn btn-block btn-default'>"+ACC.config.viewlistBtn+"</a></div></div></div>";
	return htmlCode;
},
popupHtmlExistingList: function(successmsg, wishlistCode){
	let htmlCode = "<div class='PopupBox'><h1 class='headline'>"+successmsg+"</h1><div class='row marginTop40 mob-list-confo'><div class='col-md-6 col-xs-12'><input class='btn btn-primary btn-block successListCreation' type='button' value='"+ACC.config.continueShopping+"'></div><div class='col-md-6 col-xs-12'><a href='"+ACC.config.encodedContextPath+'/savedList/listDetails?code=' + wishlistCode +"' class='btn btn-block btn-default'>"+ACC.config.viewlistBtn+"</a></div></div></div>";
	return htmlCode;
},
pdppopupHtmlExistingList: function(successmsg, wishlistCode){
	let htmlCode = "<div class='PopupBox'><h1 class='headline'>"+successmsg+"</h1><div class='row marginTop40 mob-list-confo'><div class='col-md-6 col-xs-12'><input class='btn btn-primary btn-block successListCreation' type='button' value='"+ACC.config.continueShopping+"'></div><div class='col-md-6 col-xs-12'><a href='"+ACC.config.encodedContextPath+'/savedList/listDetails?code=' + wishlistCode +"' class='btn btn-block btn-default'>"+ACC.config.viewlistBtn+"</a></div></div></div>";
	return htmlCode;
},
    bindAddtoList:function(){
    	
    	function validateProductAndQty(isEmptyProduct,isInvalidqty){
    		if(isEmptyProduct){
      	    	$("#empty_code").show()
      	    }
      	    else{
      	    	$("#empty_code").hide();
      	    }
      	    
      	    if(isInvalidqty){
      		  $("#empty_quantity").show();
    	    }
    	    else{
    	    	$("#empty_quantity").hide();
    	    }
    	}
    	

  	$(".editList").click(function() {
  	    var size = $("#listSize").val();
  	     console.log(size);
  	    if (size >= 1) {
  	    $(this).next(".fetchWishList").toggle();
  	    }

  	    });
		
  	$('.qtyChanged').on('change', function() {

  	    var quantity = $(this).val();
  	    console.log("qty"+quantity);
  	    var productCode = $(this).siblings("#productCodeQtyChange").val();
  	    console.log("proCode"+productCode);
  	    var listCode = $("#listCodeQtyChange").val();
  	    console.log("listCode"+listCode);
  	     $.ajax({
  	          type: 'POST',
  	          url: ACC.config.encodedContextPath + "/savedList/add",
  	          datatype: "json",
  	          data: {
  	              productCode: productCode,
  	              wishListCode: listCode,
  	              quantity:quantity,
  	              prodQtyFlag: true
  	          },
  	          success: function(result) {
  	              window.location.reload(true);
  	          },
  	          error: function(xhr, ajaxOptions, thrownError) {
  	              console.log('data failure');
  	          }
  	      }); 
  	});

  	$('.moveToSaveList').on('click', function() {
  	       var moveWishList=$(this).attr("id");
  	       var prodCode=$(this).siblings('#addproductCode').val();
  	       var quantity=$(this).siblings('#list_qty_').val();
  	       var inventryUOM=$(this).parents(".saved-list-sec").find("#inventoryUomId").val();
  	       console.log(quantity);
  	       var savedListName=$(this).siblings('#savedListName').val();
  	       digitalData={
    					 	event: 'add product to list',
    						item: $(this).siblings('#productID').val(),
    						listName:$(this)[0].outerText
    				   }				
    	   try {
    					_satellite.track('productAddedToList');
    		   }catch(e){} 
  	       $.ajax({
  	              type: 'POST',
  	              url: ACC.config.encodedContextPath + "/savedList/add",
  	              datatype: "json",
  	              data: {
  	                  productCode: prodCode,
  	                  wishListCode: moveWishList,
  	                  quantity:quantity,
  	                  inventoryUOMId :inventryUOM
  	              },
  	              success: function(result) {
  	                  
  	                  $.ajax({
  	                      type: 'POST',
  	                      url: ACC.config.encodedContextPath + "/savedList/moveSavedList",
  	                      datatype: "json",
  	                      data: {
  	                          productCode: prodCode,
  	                          wishListCode: savedListName,
  	                          quantity:quantity
  	                      },
  	                      success: function(result) {
  	                    	ACC.colorbox.open("", {
  		 	                    html: ACC.productDetail.popupHtmlExistingList(ACC.config.listaddedMsg,moveWishList),
  		 	                    width: "500px",
  		 	                    onComplete: function(){
  		 	                        $('#colorbox').removeClass('add-to-list-box');
  		 	                        $('#colorbox').addClass('item-add-list-box');
  		 	                        $(document).on("click",".successListCreation", function(e){
  		 	                            ACC.colorbox.close();
  		 	                        });
  		 	                    },
  		 	                    onClosed: function() {
  		 	                        $('#colorbox').removeClass('item-add-list-box');
  		 	                        $('body').css("overflow-y","auto");
 		 	                        window.location.reload(true);
  		 	                    } 
  		 	                });
  	                          
  	                      },
  	                      error: function(xhr, ajaxOptions, thrownError) {
  	                          console.log('data failure');
  	                      }
  	                  }); 
  	              },
  	              error: function(xhr, ajaxOptions, thrownError) {
  	                  console.log('data failure');
  	              }
  	          });
  	         
  	    });


  	$(document).on('click', '.addToWhishlistpopupcart', function() {
  	    var wishlistCode = $("#cboxContent .popupWishlist").val();
  	    var productCode = $("#productCode").val();
  	    var quantity=$("#qty").val();
  	    var cartuomId= $(".uomId_popup").val();

  	    $.ajax({
  	        type: 'POST',
  	        url: ACC.config.encodedContextPath + "/savedList/add",
	        datatype: "json",
  	        data: {
  	            productCode: productCode,
  	            wishListCode: wishlistCode,
  	            quantity:quantity,
                inventoryUOMId :cartuomId
  	        },
  	        success: function(result) {
  	            ACC.colorbox.open("", {
  	               html: ACC.productDetail.popupHtmlExistingList(ACC.config.listaddedMsg, wishlistCode),
  	                width: "500px",
  	                onComplete: function(){
  	                    $('#colorbox').removeClass('add-assembly-to-list-box');
  	                    $('#colorbox').removeClass('add-item-to-list-box');
  	                    $('#colorbox').addClass('item-add-list-box');
  	                    $('body').css("overflow-y", "hidden");
  	                    $(document).on("click", ".successListCreation", function(){
  	                        ACC.colorbox.close();
  	                     });
  	                },
  	                onClosed: function() {
  	                    $('body').css("overflow-y","auto");
  	                    $('#colorbox').removeClass('item-add-list-box');
  	                }
  	            }); 
  	        },
  	        error: function(xhr, ajaxOptions, thrownError) {
  	            console.log('data failure');
  	        }
  	    });
  	    
  	    
  	    });

	$(document).on("click", "#pdpPromotion", function (e){

    	var productCode = $("#productcode").val();
         var isPdpPromotion=false;
if($(this).prop("checked") == true){
isPdpPromotion=true;
}
$("#isCouponEnabled").val(isPdpPromotion);
$("#promoProductCode").val(productCode);

});
function addingOptionToList(wishlistCode){
	var wishlistCode = $('.pdplistpopupoption.selected').data('value');
	var wishListname = ($('.pdplistpopupoption.selected').text());
	var productCode = ($('.pdplistpopupoption.selected').data('productcode'));
	var listQty;
	var inventryUOM;
	if($('.product-variant-table').length > 0){
		 listQty=ACC.productDetail.varientProductQTY;
		 inventryUOM = '';
	}
	else{
		 listQty=getListQuantity(this);
		 inventryUOM = $("#inventoryUOMIDVal").val();
	}
	ACC.productDetail.pdpAddListAjax(wishlistCode, productCode, inventryUOM, wishListname,listQty);
};

$(document).on("click", ".pdpAddtoListPopupBtn", function (e){
	ACC.productDetail.plpCommonBtn = "false";
	ACC.productDetail.plpMobileAddListCode = '';
	$('.pdplistpopupoption').removeClass('selected');
	$(".pdplistpopup1").removeClass('hidden');
	$(".pdp-newlist-popup-error-text").hide();
	$(".pdp-emptynewlist-popup-error-text").hide();
	$('.listpopupsavebtn').removeClass("disabled");
	$('.createnewlistbtn').removeClass("disabled");
	$(".pdp-atl-popup").colorbox.resize();
	if($('.loginstatus').val()!=''){
		ACC.colorbox.open("", {
			html:  $("#listpopup").html(),
			width: "500px",
			className: "pdp-atl-popup",
			onComplete:function(){
			$(document).on("click",".listpopupclosebtn", function(e){
				ACC.colorbox.close();
			});
			}
		})
	}
});

$(document).on("click", ".pdpAddtoListCommonBtn", function (e){
	ACC.productDetail.plpCommonBtn = "true";
	ACC.productDetail.plpMobileAddListCode = '';
	$('.pdplistpopupoption').removeClass('selected');
	$(".pdplistpopup1").removeClass('hidden');
	$(".pdp-newlist-popup-error-text").hide();
	$(".pdp-emptynewlist-popup-error-text").hide();
	$('.listpopupsavebtn').removeClass("disabled");
	$('.createnewlistbtn').removeClass("disabled");
	$(".pdp-atl-popup").colorbox.resize();
	if($('.loginstatus').val()!=''){
		ACC.colorbox.open("", {
			html:  $("#listpopup").html(),
			width: "500px",
			className: "pdp-atl-popup",
			onComplete:function(){
			$(document).on("click",".listpopupclosebtn", function(e){
				ACC.colorbox.close();
			});
			}
		})
	}
});

$(document).on("click",".listpopupsavebtn", function(e){
	var listpopupsavebtn = $(this);
	var pdppopuplistname=$("#pdppopupinput").val().trim();
	var optionList = '';
	var exit = true;
	var id;
	if(pdppopuplistname !='' && pdppopuplistname != null){
		$.ajax({
			type: 'POST',
			url: ACC.config.encodedContextPath + "/savedList/createWishlistAndFetch",
			datatype: "json",
			data: {
				wishListName: pdppopuplistname
			},
			success: function (result) {
				console.log(result);
				if (result.isDuplicate == true) {
					$('.pdp-newlist-popup-error-text').show();
					$('.listpopupsavebtn').addClass("disabled");
					$('.createnewlistbtn').addClass("disabled");
					$('input.createnewlistinput').keyup(function (e) {
						$(".pdp-newlist-popup-error-text").hide();
						$(".pdp-atl-popup").colorbox.resize();
						$('.listpopupsavebtn').removeClass("disabled");
						$('.createnewlistbtn').removeClass("disabled");
					});
					$(".pdp-atl-popup").colorbox.resize();
				}
				else {
					$('.pdp-newlist-popup-error-text').hide();
					$('.listpopupsavebtn').removeClass("disabled");
					$('.createnewlistbtn').removeClass("disabled");
					$(".pdp-atl-popup").colorbox.resize();
					if (result.allWishlist.length > 0) {
						$('.popupsavedlistoptions').parent().removeClass('hidden');
					}
					var item = "";
					if($('.product-variant-table').length > 0){
						productitemNumber = listpopupsavebtn.data('productcode');
					}
					else{
						productitemNumber = $("#productitemNumber").attr('value');
					}
					if (ACC.savedlist.isRecommendedListPage) {
						let recommendedCategoryName = $(".recommendCatName").val();
						let btnName = $(".reccomendBtnName").val();
						result.allWishlist.forEach(addtolistpopup => {
							item += '<div class="recommendedlistname wish-item hidden-xs" buttonname="' + btnName + '" categoryname="' + recommendedCategoryName + '" id="' + addtolistpopup.code + '" data-value="' + addtolistpopup.code + '" onclick="ACC.savedlist.recCopyToMyListPopup(' + addtolistpopup.code + ')">' + addtolistpopup.name + '</div>'
							item += '<div class="recommendedlistmobile hidden-md hidden-lg hidden-sm"  onclick="ACC.savedlist.recCopyToMyList(' + addtolistpopup.code + ')">' + addtolistpopup.name + '</div>'
						})
						$(".popupoptionlistitem").empty().append(item);
						var wishlistCode = $(".recommendedlistname:first").data('value');
						ACC.productDetail.pdpAddListAjax(wishlistCode)
						$(".createnewlistinput").val("");
					} else {
						if($('.product-variant-table').length > 0){
							result.allWishlist.forEach(addtolistpopup => {
								if(exit){
									id =  addtolistpopup.code + productitemNumber;
									exit = false;
								}
								item += '<div class="pdplistpopupoption hidden-xs" id="' + addtolistpopup.code +  productitemNumber +'" data-value="' + addtolistpopup.code + '" data-productcode="' + productitemNumber + '">' + addtolistpopup.name + '</div>'
								item += '<div class="pdplistpopupoptionmobile hidden-md hidden-lg hidden-sm"  onclick="ACC.productDetail.triggerpdplistpopupoption(\'' + addtolistpopup.code +  productitemNumber + '\')">' + addtolistpopup.name + '</div>'
							});
						}
						else{
							result.allWishlist.forEach(addtolistpopup => {
								if(exit){
									id =  addtolistpopup.code;
									exit = false;
								}
								item += '<div class="pdplistpopupoption hidden-xs" id="' + addtolistpopup.code + '" data-value="' + addtolistpopup.code + '" data-productcode="' + productitemNumber + '">' + addtolistpopup.name + '</div>'
								item += '<div class="pdplistpopupoptionmobile hidden-md hidden-lg hidden-sm"  onclick="ACC.productDetail.triggerpdplistpopupoption(' + addtolistpopup.code + ')">' + addtolistpopup.name + '</div>'
							});
						}
						console.log(item);		
						if(productitemNumber) productitemNumber = productitemNumber.replace(".","\\.");		
						optionList =  '.popupoptionlistitem' + productitemNumber;
						if($('.product-variant-table').length > 0){
							$(optionList).empty().append(item);
							var option = document.getElementById(id);
							option.click();
						}
						else{
							$('.popupoptionlistitem').empty().append(item);
							$(".pdplistpopupoption:first").addClass('selected');
							addingOptionToList();
						}				
						$('.createnewlistinput').val('');
						$(".pdp-atl-popup").colorbox.resize();
					}
				}
			},
			error: function (xhr, ajaxOptions, thrownError) {
				console.log('data failure');
			}
		});
		}
		else{
			$('.pdp-emptynewlist-popup-error-text').show();
			$('.listpopupsavebtn').addClass("disabled");
			$('.createnewlistbtn').addClass("disabled");
			$('input.createnewlistinput').keyup(function(e){
				$(".pdp-emptynewlist-popup-error-text").hide();
				$(".pdp-atl-popup").colorbox.resize();
				$('.listpopupsavebtn').removeClass("disabled");
				$('.createnewlistbtn').removeClass("disabled");
			});
			$(".pdp-atl-popup").colorbox.resize();		   
			$(".pdplistpopupoption:first").addClass('selected');
		}
	});

$(document).on("change",".createnewlistinput", function(e){
	$("#pdppopupinput").val($(this).val())
})
function createNewListPDP(pdppopuplistname){
	var productCode = $("#productcode").attr('value');
		var inventryUOM = $("#inventoryUOMIDVal").val();
		var qty = $("#qty").val();
  		    if(qty == null || qty == "undefined"){
  		    	qty = 1;
  		    }
		$(".pdplistnoname").addClass("hidden");
		$.ajax({
			type: 'POST',
			url: ACC.config.encodedContextPath + "/savedList/createWishlist",
			datatype: "json",
			data: {
				productCode:productCode,
				qty : qty,
				wishListName: pdppopuplistname,
			  	inventoryUom: inventryUOM

			},
			success: function(result) {
				$(".pdplistpopupoption:first").val(pdppopuplistname);
				$(".pdplistpopupoption:first").addClass('selected');
				addingOptionToList(result.wishListCode);
			},
			error: function(xhr, ajaxOptions, thrownError) {
				console.log('data failure');
			}
		})
}
$(document).on("click",".createnewlistbtn", function(e){
	var createnewlistbtn = $(this);
	var pdppopuplistname=$("#pdppopupinput").val().trim();
	var optionList = '';
	if(pdppopuplistname !='' && pdppopuplistname != null){
	$.ajax({
		type: 'POST',
		url: ACC.config.encodedContextPath + "/savedList/createWishlistAndFetch",
		datatype: "json",
		data: {
			wishListName: pdppopuplistname
		},
		success: function(result) {
			if(result.isDuplicate==true){
				$('.pdp-newlist-popup-error-text').show();
				$('.listpopupsavebtn').addClass("disabled");
				$('.createnewlistbtn').addClass("disabled");
				$('input.createnewlistinput').keyup(function(e){
					$(".pdp-newlist-popup-error-text").hide();
					$(".pdp-atl-popup").colorbox.resize();
					$('.listpopupsavebtn').removeClass("disabled");
					$('.createnewlistbtn').removeClass("disabled");
			   });
			   $(".pdp-atl-popup").colorbox.resize(); 
			}
			else{
				$('.pdp-newlist-popup-error-text').hide();
				$(".pdp-atl-popup").colorbox.resize(); 
				$('.listpopupsavebtn').removeClass("disabled");
				$('.createnewlistbtn').removeClass("disabled");
				if(result.allWishlist.length>0){
					$('.popupsavedlistoptions').parent().removeClass('hidden');
				} 
				var item="";
				if($('.product-variant-table').length > 0){
					productitemNumber = createnewlistbtn.data('productcode');
				}
				else{
					productitemNumber = $("#productitemNumber").attr('value');
				}
				//RecommendedList flow
				if (ACC.savedlist.isRecommendedListPage) {
					let recommendedCategoryName = $(".recommendCatName").val();
					let btnName = $(".reccomendBtnName").val();
					result.allWishlist.forEach(addtolistpopup => {
						item += '<div class="recommendedlistname wish-item hidden-xs" buttonname="' + btnName + '" categoryname="' + recommendedCategoryName + '" id="' + addtolistpopup.code + '" data-value="' + addtolistpopup.code + '" onclick="ACC.savedlist.recCopyToMyListPopup(' + addtolistpopup.code + ')">' + addtolistpopup.name + '</div>'
						item += '<div class="recommendedlistmobile hidden-md hidden-lg hidden-sm"  onclick="ACC.savedlist.recCopyToMyList(' + addtolistpopup.code + ')">' + addtolistpopup.name + '</div>'
					})
				}
				else if ($('.page-order').length > 0) {
					result.allWishlist.forEach(addtolistpopup => {
						item += '<button type="button" class="list-group-item  Ordlistoption font-size-14 f-w-400 wish-item text-default m-b-10-xs  hidden-xs"  id="' + addtolistpopup.code + '" data-value="' + addtolistpopup.code + '"onclick="ACC.order.moveItemsToList(\'' + addtolistpopup.code + '\')">' + addtolistpopup.name + '</button>'
						item += '<button type="button" class="list-group-item Ordlistoptionmobile hidden-md hidden-lg hidden-sm" id="' + addtolistpopup.code + '" data-value="' + addtolistpopup.code + '" onclick="ACC.order.moveItemsToList(\'' + addtolistpopup.code + '\')">' + addtolistpopup.name + '</button>'
					});
				}
				else {
					if($('.product-variant-table').length > 0){
						result.allWishlist.forEach(addtolistpopup => {
							item += '<div class="pdplistpopupoption hidden-xs" id="' + addtolistpopup.code + productitemNumber + '" data-value="' + addtolistpopup.code + '" data-productcode="' + productitemNumber + '">' + addtolistpopup.name + '</div>'
							item += '<div class="pdplistpopupoptionmobile hidden-md hidden-lg hidden-sm"  onclick="ACC.productDetail.triggerpdplistpopupoption(\'' + addtolistpopup.code + productitemNumber + '\')">' + addtolistpopup.name + '</div>'
						});
					}
					else{
						result.allWishlist.forEach(addtolistpopup => {
							item += '<div class="pdplistpopupoption hidden-xs" id="' + addtolistpopup.code + '" data-value="' + addtolistpopup.code + '" data-productcode="' + productitemNumber + '">' + addtolistpopup.name + '</div>'
							item += '<div class="pdplistpopupoptionmobile hidden-md hidden-lg hidden-sm"  onclick="ACC.productDetail.triggerpdplistpopupoption(' + addtolistpopup.code + ')">' + addtolistpopup.name + '</div>'
						});
					}		
				}
				if(productitemNumber) productitemNumber = productitemNumber.replace(".","\\.");
				optionList =  '.popupoptionlistitem' + productitemNumber;
				if($('.product-variant-table').length > 0){
					$(optionList).empty().append(item);
				}
				else{
					$('.popupoptionlistitem').empty().append(item);
				}						
				$('.createnewlistinput').val('');
				$(".pdp-atl-popup").colorbox.resize(); 
			}
			
		},
		error: function(xhr, ajaxOptions, thrownError) {
			console.log('data failure');
		}
	

	})
}else{
	$('.pdp-emptynewlist-popup-error-text').show();
				$('.listpopupsavebtn').addClass("disabled");
				$('.createnewlistbtn').addClass("disabled");
				$('input.createnewlistinput').keyup(function(e){
					$(".pdp-emptynewlist-popup-error-text").hide();
					$(".pdp-atl-popup").colorbox.resize();
					$('.listpopupsavebtn').removeClass("disabled");
				$('.createnewlistbtn').removeClass("disabled");
			   });
			   $(".pdp-atl-popup").colorbox.resize({innerWidth: "362px"}); 
}
});

$(document).on("click", ".pdplistpopupoption", function (e){
	$('.pdplistpopupoption').removeClass('selected');
	$(this).addClass('selected');
	addingOptionToList();
});

$(document).on("click", "#pdpPromotionVariant", function (e){

    	var productCode = $(this).closest(".variant-promotion").find("#productcodevariant").val();
         var isPdpPromotion=false;
if($(this).prop("checked") == true){
isPdpPromotion=true;
}
$(this).closest(".product-variant-table__values").find("#isCouponEnabled").val(isPdpPromotion);
$(this).closest(".product-variant-table__values").find("#promoProductCode").val(productCode);


});
  	    $(document).on('click', '.addAssemblyToWishListpopup', function(event) {
  	        $("#colorbox").removeClass("add-assembly-to-list-box");
  	        var wishlistCode = $("#cboxContent #popupAddToAssembly").val();
  	        var productCodes = $(".productCodes").val();
  	      

  	        console.log(wishlistCode+" "+productCodes);
  	        $.ajax({
  	            type: 'POST',
  	            url: ACC.config.encodedContextPath + "/assembly/addAssemblyToList",
  	            datatype: "json",
  	            data: {
  	                productCodes: productCodes,
  	                wishListCode: wishlistCode
  	                
  	            },
  	            success: function(result) {
  	                
  	                
  	                ACC.colorbox.open("", {
	 					html: ACC.productDetail.popupHtmlExistingList(result.message,wishlistCode),
  	                    width: "500px",
  	                    onComplete: function(){
  	                        $('#colorbox').addClass('item-add-list-box');
  	                        $('body').css("overflow-y", "hidden");
  	                        $(document).on("click", ".successListCreation", function(){
  	                            ACC.colorbox.close();
  	                         });
  	                    },
						  onClosed: function() {
							$('#colorbox').removeClass('item-add-list-box');
							$('body').css("overflow-y","auto");
							$.cookie("quantity", null);
							$.cookie("prodCode", null);
							$.cookie("inventryUOM", null);
							$.cookie("cartEntry", null);
						}
  	                    
  	                });
  	            
  	                
  	               
  	            },
  	            error: function(xhr, ajaxOptions, thrownError) {
  	                console.log('data failure');
  	            }
  	        });
  	        
  	        
			  });
			  

		function addListAjax(wishlistCode, productCode, inventryUOM,wishListname, quantity){
			
			if(quantity == null || quantity == undefined){
				quantity=1;
			}
			if ($('.loginstatus').val() != ''){
			$.ajax({
				type: 'POST',
				url: ACC.config.encodedContextPath + "/savedList/add",
				datatype: "json",
				data: {
					productCode: productCode,
					wishListCode: wishlistCode,
					quantity:quantity,
					inventoryUOMId :inventryUOM
				},
				success: function(result) {
					ACC.colorbox.open("", {
						html:  ACC.productDetail.popupHtmlExistingList(ACC.config.listaddedMsg, wishlistCode),
						width: "500px",
						onComplete: function(){
							$('#colorbox').removeClass('add-assembly-to-list-box');
							$('#colorbox').removeClass('add-item-to-list-box');
							$('#colorbox').addClass('item-add-list-box');
							$('body').css("overflow-y", "hidden");
							if($('body').hasClass("template-pages-layout-siteOneCuratedPlpLayout")){
								digitalData.eventData={
									linktype: "product-grid",
									linkName:"add-to-list",
									onClickPageName: $(".pagename").val() 
								   }
							}else{
								digitalData.eventData={
									linktype: "add-to-list",
									linkName:wishListname,
									onClickPageName: $(".siteonepagename").val() 
								}
							}
							try{
								_satellite.track('linkClicks');
							}
							catch(err){}
							$(document).on("click", ".successListCreation", function(){
								ACC.colorbox.close();
								});
						},
						onClosed: function() {
							$('#colorbox').removeClass('item-add-list-box');
							$('body').css("overflow-y","auto");
							$.cookie("quantity", null);
							$.cookie("prodCode", null);
							$.cookie("inventryUOM", null);
							$.cookie("cartEntry", null);
						}
					});					   
				},
				error: function(xhr, ajaxOptions, thrownError) {
					console.log('data failure');
				}
			});
		  }
		}
  	    
		function getListQuantity(elem){
			if($('.product-variant-table').length > 0) {
				var qty = $(elem).parents('.product-variant-table__values').find('.pdp-variant-qty').val();
				return qty;
			}
			
			if($("body").hasClass("page-productDetails")){
				return $(".js-pdp-add-to-cart").val()
			}
			
			else if($("body").hasClass("page-accountOrdersPage")){
				return $(elem).parents(".bia-table-row").find("#bia-qty").val();
			}
			else {
				return $(elem).closest(".product-item-box").find(".js-plp-qty").val();
			}
		}
		
  	    $(document).on('click', '.addToWhishlistpopup', function(event) {
  	        var wishlistCode = $("#cboxContent .popupWishlist").val();
  	        var productCode = $("#productCode").val();
  	        var inventryUOM = $("#inventoryUOMIDVal").val();
  	        
  		    if(productCode == null || productCode == undefined){
  		    	var productcodeid = 'wishlist_productCode'+$(this).data('productcode');
  		    	productCode = $('#'+productcodeid).val();
  		    }
  		    var quantity=$("#qty").val();
  		    if(quantity == null || quantity == undefined){
  		    	quantity=1;
  		    }
  	        addListAjax(wishlistCode, productCode, inventryUOM);
  	        });
		
		$(document).on('click', '.js-wishListItem', function(event) {
			digitalData.eventData = {
				linktype: "product-grid",
				linkName: "Add to Cart",
				onClickPageName: $(".pagename").val()
			}
			var inventryUOM;
			var selectedItem = $(this).data("itemcode");
			if(selectedItem === "createNewListLinkProduct") {
				$("empty_listName").hide();
				var elemId = ".js-createNewSaveList-popup";
				var prodCode = $(this).data('productcode');
				if ($(this).data('productcode') != undefined) {
					elemId = ".js-createNewSaveList-popup" + prodCode;
				} else {
					inventryUOM = $(this).parents(".product-item-box").find("#inventoryUOMIDVal").val();
				}
				ACC.colorbox.open(ACC.config.addToNewList, {
					html: $(elemId).html(),
					width: "650px",
					onComplete: function () {
						$("#cboxContent #productCodelist").val(prodCode);
						if (inventryUOM) {
							$("#cboxContent #inventoryUOMIDVal").val(inventryUOM);
						}
						$('#colorbox').removeClass('add-assembly-to-list-box');
						$('#colorbox').removeClass('add-item-to-list-box');
						if ($("body").hasClass("page-productGrid") || $("body").hasClass("page-searchGrid") || $("body").hasClass("template-pages-layout-siteOneCuratedPlpLayout") || $("body").hasClass("template-pages-layout-siteOneCuratedPlpLayout")) {
						 	ACC.productDetail.plpProductQTY = $('#productPLPPostQty_' + prodCode).val();
						}
						else{
							var listQty = getListQuantity(this);
							$('#colorbox').append('<input type="hidden" id="qty" value="' + listQty + '" />');
						}
						$('body').css("overflow-y", "hidden");
						$('#colorbox').addClass('add-to-list-box');
					},
					onClosed: function () {
						$('#colorbox').removeClass('add-to-list-box');
						$('body').css("overflow-y", "auto");
						location.reload();
					}
				});
				ACC.productDetail.reAlignColorBoxToPage();
			} else {
				let ele = $(this).children(":first");
				ele.prop("checked", "checked");
				$(this).parent().children().removeClass('selected');
				$(this).addClass("selected");
				var wishlistCode = $(this).data('itemcode');
				var wishListname = $(this).find("wishlist-item-name").text();
				var productCode = $(this).data('productcode');
				var productCode1 = $(this).data('productcode1');
				var inventryUOM = ($(".page-productGrid, .page-searchGrid, .template-pages-layout-siteOneCuratedPlpLayout, .template-pages-category-categoryLandingPage").length > 0) ? $(this).parents(".product-item-box").find("#inventoryUOMIDVal").val() : $("#inventoryUOMIDVal").val();
				var listQty;
				if ($("body").hasClass("page-productGrid") || $("body").hasClass("page-searchGrid") || $("body").hasClass("template-pages-layout-siteOneCuratedPlpLayout") || $("body").hasClass("template-pages-layout-siteOneCuratedPlpLayout")) {
					listQty = $('#productPLPPostQty_' + productCode1).val();
				}
				else{
					listQty = getListQuantity(this);
				}
				addListAjax(wishlistCode, productCode, inventryUOM, wishListname, listQty);
				digitalData = {
					event: 'add product to list',
					item: productCode,
					listName: wishListname
				}
				try {
					_satellite.track('productAddedToList');
				} catch (e) { }
			}
		});

		$(document).on("show.bs.dropdown", ".addtolistdropdown", function() {
			$(this).find(".glyphicon-chevron-down").hide();
			$(this).find(".glyphicon-chevron-up").show();
		});
		$(document).on("hide.bs.dropdown", ".addtolistdropdown", function() {
			$(this).find(".glyphicon-chevron-down").show();
			$(this).find(".glyphicon-chevron-up").hide();
		});
  	    
  	    $(document).on('change', '#popupWishlist', function(event) {
			digitalData.eventData={
				linktype:"product-grid",
				linkName:"Add to Cart",
				onClickPageName: $(".pagename").val()
			}
			var inventryUOM;
			var listValue = $('option:selected', this).val();
			if (listValue === "createNewListLinkProduct") {
				$("empty_listName").hide();
				var listQty = getListQuantity(this);
				var elemId = ".js-createNewSaveList-popup";
				if ($(this).data('productcode') != undefined) {
					var prodCode = $(this).data('productcode');
					elemId = ".js-createNewSaveList-popup" + prodCode;
				} else {
					var prodCode = $('option:selected', this).data('productcode');
					inventryUOM = $(this).parents(".product-item-box").find("#inventoryUOMIDVal").val();
				}
				ACC.colorbox.open(ACC.config.addToNewList, {
					html: $(elemId).html(),
					width: "650px",
					onComplete: function () {
						$("#cboxContent #productCodelist").val(prodCode);
						if (inventryUOM) {
							$("#cboxContent #inventoryUOMIDVal").val(inventryUOM);
						}
						$('#colorbox').removeClass('add-assembly-to-list-box');
						$('#colorbox').removeClass('add-item-to-list-box');
						if ($("body").hasClass("page-productGrid") || $("body").hasClass("page-searchGrid") || $("body").hasClass("template-pages-layout-siteOneCuratedPlpLayout") || $("body").hasClass("template-pages-layout-siteOneCuratedPlpLayout")) {
							$('#colorbox').append('<input type="hidden" id="qty" value="' + listQty + '" />');
						}
						$('body').css("overflow-y", "hidden");
						$('#colorbox').addClass('add-to-list-box');
					},
					onClosed: function () {
						$('#colorbox').removeClass('add-to-list-box');
						$('body').css("overflow-y", "auto");
						location.reload();
					}
				});
				ACC.productDetail.reAlignColorBoxToPage();
			} else {
				var wishlistCode = ($('option:selected', this).val());
				var wishListname = ($('option:selected', this).text());
				var productCode = ($('option:selected', this).data('productcode'));
				var inventryUOM = ($(".page-productGrid, .page-searchGrid, .template-pages-layout-siteOneCuratedPlpLayout, .template-pages-category-categoryLandingPage").length > 0) ? $(this).parents(".product-item-box").find("#inventoryUOMIDVal").val() : $("#inventoryUOMIDVal").val();
				var listQty = getListQuantity(this);
				addListAjax(wishlistCode, productCode, inventryUOM, wishListname, listQty);
				digitalData = {
					event: 'add product to list',
					item: productCode,
					listName: wishListname
				}
				try {
					_satellite.track('productAddedToList');
				} catch (e) { }
			}
		});
		  
  	  $(document).on('click', '.createNewListLinkProduct', function(event) { 
	        $("empty_listName").hide();
	        var elemId = ".js-createNewSaveList-popup";
	    	if($(this).data('productcode') != undefined)
	    	{
	    		var prodCode=$(this).data('productcode');
	    		elemId = ".js-createNewSaveList-popup"+prodCode;
	    	}

	         ACC.colorbox.open(ACC.config.addToNewList, {
	               html: $(elemId).html(),
	               width: "650px",
	               onComplete: function(){
	                $('#colorbox').removeClass('add-assembly-to-list-box');
	                $('#colorbox').removeClass('add-item-to-list-box');
	                $('body').css("overflow-y", "hidden");
	                $('#colorbox').addClass('add-to-list-box');
	                },
	               onClosed: function() {
	                $('#colorbox').removeClass('add-to-list-box');
	                    $('body').css("overflow-y","auto");
	                }
	              
	           });
	        
	         ACC.productDetail.reAlignColorBoxToPage();
	    });
  	    
  	  	$(document).on("keypress", ".wishListName", function(event) {
			if (event.keyCode == 13) {
				return false;
			} else {
				return true;
			}
		});
  	    $(document).on('click', '.createWishlist', function(event) {
  	        var wishlistName = $("#cboxContent .wishListName").val();
  	        var qty;
  	       if($(".page-cartPage").length >0){
				var productCode = $("#productCode").val();
				var inventryUOM = $(".uomId_popup").val();
				var itemCode = $("#itemCode").val();
			  	productCode = itemCode
			}	

			else{
				var productCode = $("#cboxContent #productCodelist").val();
				var inventryUOM = $("#cboxContent #inventoryUOMIDVal").val();
			}
			  
  		    if(productCode == null || productCode == undefined){
  			    var productcodeid = 'createwishlist_productCode'+$(this).data('productcode');
  			    productCode = $('#'+productcodeid).val();
  		    }
			 if(ACC.global.productCutatedplpList){
				digitalData={
					event: 'create list',
				   item: productCode,
				   listName: wishlistName
			   }	
				
				digitalData.eventData={
				linktype:"product-grid",
				linkName:"Add to Cart",
				onClickPageName: $(".pagename").val()
				}
			}
			else{
  		    digitalData={
    					 	event: 'create list',
    						item: productCode,
    						listName: wishlistName
    					}	
					}			
    		try {
    				_satellite.track('listCreated');
    			}catch(e){}
  		    if ($("body").hasClass("page-productGrid") || $("body").hasClass("page-searchGrid") || $("body").hasClass("template-pages-layout-siteOneCuratedPlpLayout") || $("body").hasClass("template-pages-layout-siteOneCuratedPlpLayout")) {
				qty = ACC.productDetail.plpProductQTY;
			}
			else{
				qty = $("#qty").val();
			}
  		    if(qty == null || qty == "undefined"  || qty == '' ){
  		    	qty = 1;
  		    }
  	        if (wishlistName == "") {           
  	             $("#cboxLoadedContent #empty_listName").show();
  	        } else {
  	            $("#empty_listName").hide();
  	        $.ajax({
  	            type: 'POST',
  	            url: ACC.config.encodedContextPath + "/savedList/createWishlist",
  	            datatype: "json",
  	            data: {
  	                productCode: productCode,
  	                qty : qty,
  	                wishListName: wishlistName,
	                inventoryUom: inventryUOM
  	                
  	            },
  	            success: function(result) {
  	            if(result.isDuplicate==false){
  	                ACC.colorbox.open("", {
  	                    html: ACC.productDetail.popupHtmlCreateNewList(ACC.config.listCreatedMsg,result.wishListCode),
  	                    width: "500px",
  	                    onComplete: function(){
  	                        $('#colorbox').removeClass('add-to-list-box');
  	                        $('#colorbox').addClass('item-add-list-box');
  	                        $(document).on("click",".successListCreation", function(e){ 
  	                            ACC.colorbox.close();
  	                        });
  	                    },
  	                    onClosed: function() {
							window.location.reload(true);
  	                    }
  	                });
  	               }
				   else{
						$(".existing-listname").show();
						  $('input.wishListName').keyup(function(e){
							 $(".existing-listname").hide();
						});
					}
  	            },
  	            error: function(xhr, ajaxOptions, thrownError) {
  	                console.log('data failure');
  	            }
  	        }); }
  	    });
  	    
  	    
  	    
  	    $(document).on('click', '#createWishlistFromAssembly', function(event) {
  	        var wishlistName = $("#cboxContent #wishListName").val();
  	        var productList = $(".productLists").val();
  	        if (wishlistName == "") {           
  	             $("#cboxLoadedContent #empty_listName").show();
  	        } else {
  	            $("#empty_listName").hide();

  	        $.ajax({
  	            type: 'POST',
  	            url: ACC.config.encodedContextPath + "/savedList/createWishlist",
  	            datatype: "json",
  	            data: {
  	                productList: productList,             
  	                wishListName: wishlistName
  	            },
  	            success: function(result) {
  	               if(result.isDuplicate==false){
  	                ACC.colorbox.open("", {
						html:ACC.productDetail.popupHtmlCreateNewList(ACC.config.listCreatedMsg,result.wishListCode),
  	                    width: "500px",
  	                    onComplete: function(){
  	                        $('#colorbox').removeClass('add-to-list-box');
  	                        $('#colorbox').addClass('item-add-list-box');
  	                        $(document).on("click",".successListCreation", function(e){
  	                            ACC.colorbox.close();
  	                        });
  	                    },
  	                    onClosed: function() {
  	                        $('#colorbox').removeClass('item-add-list-box');
  	                        $('body').css("overflow-y","auto");
  	                    }
  	                    
  	                });
  	                
  	             }
					else{
						$(".existing-listname").show();
						  $('input.newlistname').keyup(function(e){
							 $(".existing-listname").hide();
						});
					}
  	            },
  	            error: function(xhr, ajaxOptions, thrownError) {
  	                console.log('data failure');
  	            }
  	        });
  	        }
  	    });
  	    
  	    
  	    $(".wishlistAddProLink").click(function(e) {
  	        e.preventDefault();
  	        var listrefrence=$(this);
  	        var inventryUOM = $("#inventoryUOMIDVal").val(); 
  	        var prodCode;
  	        var quantity;
			var itemProductCode;
  	        var uomID=$(this).attr("data-uomValue");
  	        var cartFlag =  $(".moveTolistCart").val();
  	        if (cartFlag) {
  	            $(".currentForm").val($(this).attr('id').split("_")[1]);
  	            var code  =$(this).attr("data-role");
  	            console.log(code);
  	            var arr = code.split("|");
  	            console.log(arr);
  	        
  	            prodCode = arr[0];
  	            quantity = arr[1];
				itemProductCode = arr[2];
  	            $(".currentForm").val($(this).attr('id').split("_")[1]);
  	            $.cookie("cartEntry",$(".currentForm").val());
  	        } else {
  	            prodCode = $(this).siblings('#addproCode').val() ;
  	            quantity = 1;
  	        }
  	        if ($("#isCurrentPLPUser").length != 0) {           
  	        var wishlistVal=$(".wishlist").val();    	    
  	        var createWishList=$(".createWishList").val();
  	        addToWishList(quantity, prodCode, wishlistVal, createWishList, inventryUOM,uomID, itemProductCode);
  	        }
     	        else    	           
	            {   
     	         $.cookie("quantity","1");
     	    	 $.cookie("prodCode", prodCode);
     	    	 $.cookie("inventryUOM", inventryUOM);
     	      	localStorage.setItem("moveToListpopup", $(this).parent(".wishlistAddProLink-wrapper").find(".js-moveToWhislist-popup").html());
       	    	localStorage.setItem("createListPopup", $(this).parent(".wishlistAddProLink-wrapper").find(".js-createNewSaveList-popup").html());
	            
	            }
	        

	        });
	    

  	        function addToWishList(quantity, prodCode, wishlistVal, createWishList, inventryUOM,uomID, itemProductCode) {
  	        	var cartFlag =  $(".moveTolistCart").val();
  	        	var cartEntry=$.cookie("cartEntry");
  	        if( createWishList)
  	            {
  	        	$("empty_listName").hide();
  	        	var elemId = ".js-createNewSaveList-popup";
  	        	if($(".moveTolistCart").length == 0)
      	    	{
      	    		elemId = ".js-createNewSaveList-popup"+prodCode;
      	    		
      	    	}
  	        	
  	        	var flag=true;
	        	if($(elemId) != null && $(elemId).length == 0){
	        		 flag=false;
	        	}
  	        	
  	            ACC.colorbox.open(ACC.config.addToNewList, {
  	                    html: flag ? $(elemId).html():localStorage.getItem("createListPopup"),
  	                    width: "650px",
  	                    onComplete: function(){
  	                        $('body').css("overflow-y", "hidden");
  	                        $('#colorbox').addClass('add-to-list-box');
  	                    },
  	                    onClosed: function() {
  	                        $('#colorbox').removeClass('add-to-list-box');
  	                        $('body').css("overflow-y","auto");
	                        $.cookie("quantity", null);
  	                	  $.cookie("prodCode", null);
  	                	  $.cookie("inventryUOM", null);
  	                	  $.cookie("cartEntry", null);
  	                	  localStorage.removeItem("createListPopup");
  	                    }
  	                   
  	                });
  	            
  	             ACC.productDetail.reAlignColorBoxToPage();
  	             $(".js-moveToWhislist-popup").find("#productCode").val(prodCode);
  	                $(".js-moveToWhislist-popup").find("#qty").val(quantity);
					  $(".js-moveToWhislist-popup").find("#itemCode").val(itemProductCode);
  	            }
  	        
  	        
  	        
  	        else
  	            {
  	        	var elemId = ".js-moveToWhislist-popup";
  	        	if($(".moveTolistCart").length == 0)
  	        	{
  	        /*var prodCode=$(this).siblings('#addproCode').val();	*/	
  	        		elemId = ".js-moveToWhislist-popup"+prodCode;
  	        	}
  	        	
  	        	var flag=true;
	        	if($(elemId) != null && $(elemId).length == 0){
	        		 flag=false;
	        	}
  	             ACC.colorbox.open(ACC.config.addToListCart, {
  	            	    html: flag ? $(elemId).html():localStorage.getItem("moveToListpopup"),
  	                    width: "700px",
  	                    height: "325px",
  	                    onComplete: function(){
  	                        $('body').css("overflow-y", "hidden");
  	                      if(!flag){
	                        	$(document).find("#colorbox select.popupWishlist").html($(".wishlistForm").first().find("select").html());
	                        }
  	                        $('#colorbox').addClass('add-item-to-list-box');
							$(".uomId_popup").val(uomID);
  	                    },
  	                    onClosed: function() {
  	                        $('body').css("overflow-y","auto");
  	                        $('#colorbox').removeClass('add-item-to-list-box');
  	                      $.cookie("quantity", null);
	                	  $.cookie("prodCode", null);
	                	  $.cookie("inventryUOM", null);
	                	  $.cookie("cartEntry", null);
	                	  localStorage.removeItem("moveToListpopup");
  	                    }
  	                   
  	                });     
  	             ACC.productDetail.reAlignColorBoxToPage();
  	             $(".js-moveToWhislist-popup").find("#productCode").val(prodCode);
  	                $(".js-moveToWhislist-popup").find("#qty").val(quantity);
					  $(".js-moveToWhislist-popup").find("#itemCode").val(itemProductCode);
  	             
  	            }  
  	            
  	        }




  	    $("#add_Product_to_Assembly").click(function() {
  	        
  	          var proCode=$("#savedListSearch").val();
  	          var quantity = $("#quantityId").val();              
  	          var savedListName=$("#wishListListName").val();
  	          var regex = new RegExp("^[0-9]+$");
  	          
  	          $("#base_product_error").hide();
  	          $("#uom_product_error").hide();
  	          $("#invalid_code").hide();
  	          
  	          var isEmptyProduct=(proCode === "");
  	          var isInvalidqty=(quantity === ""|| !regex.test(quantity));
  	          validateProductAndQty (isEmptyProduct,isInvalidqty);
  	        if(!isEmptyProduct && !isInvalidqty){
  	              $.ajax({
  	              type: 'POST',
  	              url: ACC.config.encodedContextPath + "/assembly/add",
  	              datatype: "json",
  	              data: {
  	                  productCode: proCode,
  	                  quantity:quantity,
  	                  wishListCode: savedListName
  	              },
  	              success: function(wishlistAddResponseData) {
  	                  $("#empty_code").hide();
  	                  $("#empty_quantity").hide();
  	                  if (wishlistAddResponseData.message == 'baseproduct') {
  	                      $("#invalid_code").hide();
  	                      $("#base_product_error").show();
  	                  }
  	                  else if(wishlistAddResponseData.message == 'uomproduct')
  	            	  {
  	            	  $("#invalid_code").hide();
  	                  $("#uom_product_error").show();
  	            	  }
  	                  else if (wishlistAddResponseData.message == null) {
  	                      $("#base_product_error").hide();
  	                      $("#uom_product_error").hide();
  	                      $("#invalid_code").show();
  	                  } else{
  	                  window.location.reload(true);
  	                  }
  	              },
  	              error: function(xhr, ajaxOptions, thrownError) {
  	                  console.log('data failure');
  	                  $("#empty_code").hide();
  	                  $("#empty_quantity").hide();
  	                  $("#invalid_code").show();
  	              }
  	          });
  	          }});

  	    $(".editAssembly").click(function() {       
  	        $(this).next(".fetchWishList").toggle();        

  	        });

  	    $(".deleteProdFromAssembly").click(function() {
  	          var prodCode=$(this).siblings('#addproductCode').val();
  	           var quantity=$("#qty").val();           
  	          var savedListName=$(this).siblings('#savedListName').val();
  	        $.ajax({
  	            type: 'POST',
  	            url: ACC.config.encodedContextPath + "/assembly/moveSavedList",
  	            datatype: "json",
  	            data: {
  	                productCode: prodCode,
  	                wishListCode: savedListName,
  	                quantity:quantity
  	            },
  	            success: function(result) {
  	              window.location.reload(true);
  	            },
  	            error: function(xhr, ajaxOptions, thrownError) {
  	                console.log('data failure');
  	            }
  	        });              

  	        });
  	    
  	    $('.moveToAssembly').on('change', function() {
  	          
  	           var moveWishList=$(this).val();
  	           var prodCode=$(this).siblings('#addproductCode').val();
  	           var quantity=$("#assembly_qty_"+prodCode).val();
  	           console.log(quantity);
  	           
  	          var savedListName=$(this).siblings('#savedListName').val();

  	           
  	         
  	           $.ajax({
  	                  type: 'POST',
  	                  url: ACC.config.encodedContextPath + "/assembly/add",
  	                  datatype: "json",
  	                  data: {
  	                      productCode: prodCode,
  	                      wishListCode: moveWishList,
  	                      quantity:quantity
  	                  },
  	                  success: function(result) {
  	                      
  	                      $.ajax({
  	                          type: 'POST',
  	                          url: ACC.config.encodedContextPath + "/assembly/moveSavedList",
  	                          datatype: "json",
  	                          data: {
  	                              productCode: prodCode,
  	                              wishListCode: savedListName,
  	                              quantity:quantity
  	                          },
  	                          success: function(result) {
  	                              window.location.reload(true);
  	                          },
  	                          error: function(xhr, ajaxOptions, thrownError) {
  	                              console.log('data failure');
  	                          }
  	                      }); 
  	                  },
  	                  error: function(xhr, ajaxOptions, thrownError) {
  	                      console.log('data failure');
  	                  }
  	              });
  	             
  	        });

  	    
  	    
  	    
  	$(".addAssemblyToList").click(function(e) {
  	    //e.preventDefault();
  	        
  	        var wishlistVal=$("#wishListId").val();
  	        console.log(wishlistVal);
  	        var productCodes = $(".productCodes").val();        
  	        console.log(productCodes);
  	        
  	        var createWishList=$(".createWishListVal").val();



  	        if( createWishList)
  	            {
  	                    
  	             ACC.colorbox.open(ACC.config.addToNewList, {
  	                    html: $(".js-createNewSaveList-popup").html(),
  	                    width: "650px",
  	                    onComplete: function(){
  	                        $('body').css("overflow-y", "hidden");
  	                        $('#colorbox').addClass('add-to-list-box');
  	                    },
  	                    onClosed: function() {
  	                        $('#colorbox').removeClass('add-to-list-box');
  	                        $('body').css("overflow-y","auto");
  	                    }
  	                   
  	                });
  	            
  	            ACC.productDetail.reAlignColorBoxToPage();
  	            
  	            }
  	        
  	        
  	        
  	        else if(wishlistVal=="")
  	            {
  	             ACC.colorbox.open("Add to List", {
  	                    html: $(".js-moveToWhislist-popup").html(),
  	                    width: "650px",
  	                    height: "325px",
  	                    onComplete: function(){
  	                        $('body').css("overflow-y", "hidden");
  	                        $('#colorbox').addClass('add-assembly-to-list-box');
  	                      $.ajax({
  	            	    	  type: 'GET',
  	            	    	  url: ACC.config.encodedContextPath + "/assembly/getAllLists",
  	            	    	  success: function(response){
  	            	    		 $(".allwishlist").empty().append(response);
  	            	    	  }
  	            	      });
  	                    },
  	                    onClosed: function() {
  	                        $('#colorbox').removeClass('add-assembly-to-list-box');
  	                        $('body').css("overflow-y","auto");
  	                    }
  	                   
  	                });     
  	            ACC.productDetail.reAlignColorBoxToPage();
  	            
  	             
  	            }
  	        else
  	            {
  	            $.ajax({
  	                type: 'POST',
  	                url: ACC.config.encodedContextPath + "/assembly/addAssemblyToList",
  	                datatype: "json",
  	                data: {
  	                    productCodes: productCodes,
  	                    wishListCode: wishlistVal
  	                    
  	                },
  	                success: function(result) {
  	                    
  	                    
  	                    ACC.colorbox.open("", {
  	                        html: "<div class='PopupBox'><h1 class='headline'>"+result.message+"</h1><div class='row marginTop40 mob-list-confo'><div class='col-md-6 col-xs-12'><input class='btn btn-primary btn-block successListCreation' type='button' value='Continue Shopping'></div><div class='col-md-6 col-xs-12'><a href='"+ACC.config.encodedContextPath+'/savedList/listDetails?code=' + wishlistVal +"' class='btn btn-block btn-default'>View List</a></div></div></div>",
  	                        width: "500px",
  	                        onComplete: function(){
  	                            $('#colorbox').addClass('item-add-list-box');
  	                            $('body').css("overflow-y", "hidden");
  	                            $(document).on("click", ".successListCreation", function(){
  	                                ACC.colorbox.close();
  	                             });
  	                        },
  	                        onClosed: function() {
  	                            $('body').css("overflow-y","auto");
  	                            $('#colorbox').removeClass('item-add-list-box');
  	                        }
  	                        
  	                    });
  	                    
  	                   
  	                },
  	                error: function(xhr, ajaxOptions, thrownError) {
  	                    console.log('data failure');
  	                }
  	            });
  	            }
  	               
  	            
  	        
  	});
  		$(document).ready(function() {
  	    $('.list-check').on('click', function() {
  	    	var input = $(this).children('input[type=checkbox]');
  	    	if ($(input).prop('checked') == true) {
  	      		$(input).parent().css('background', '#78a22f');
				$(this).closest('.saved-list-sec').css('border', '1px solid #79a22f');
  	    	} 
  	    	else {
  	      		$(input).parent().css('background', '#f1f2f2');
				$(this).closest('.saved-list-sec').css('border', '1px solid #ccc');
  	    	}
			if($(".page-detailsSavedListPage").length){ACC.productDetail.checkForTransferableEntry();}
  	  	});
		
	  	  $('.colored').on('click', function() {
	  	  var input = $(this).children('input[type=checkbox]');
	  	  if ($(input).prop('checked') == true) {
	  	  	$('.select_Listall').css('background', '#aaaaaa');
		  }
		  else {
	  	    $('.select_Listall').css('background', '#919191');
	  	  }
	  	  });
		  
		  $('.controls-mobile').on('click', function() {
			  	$('.list-filters-row').toggle();
		  		$('.list-filters-row').removeClass('hidden');
				let offTarget = $('.recomannded-filter-box');
				if(offTarget.length && offTarget.is(":visible")){
					offTarget.hide();
				}	  		
		   });
  		var quantity=$.cookie("quantity");
  		var prodCode=$.cookie("prodCode");
  		var inventryUOM=$.cookie("inventryUOM");
  		var cartEntry=$.cookie("cartEntry");
  		
  		if ($("#isCurrentPLPUser").length != 0) {
  	    var wishlistVal=$(".wishlist").val();

  	    var createWishList=$(".createWishList").val();
  	    if(quantity!=null&&prodCode!=null)
  	    	{

  	  addToWishList(quantity, prodCode, wishlistVal, createWishList, inventryUOM);

  	    	}
  	    
  	    }
		// Temporary fix for Empty Features adding in Product. This has to be removed once it is resolved in backend
		$(".js-pdp-specification").each(function(){
			if($(this).find(".pdp-specification__value").text().trim().length == 0) {
				$(this).addClass("hidden");
			} else {
				$(this).removeClass("hidden");
			}
		})
	  });
	  
		// Per 7880, alignment issues are present on PLP pages where the CSP is overlapping the ATC button
		// The code below is not the recommended approach, but we could not target via CSS
		// As browser features are not similar between the browsers.
		
		function apply7880Fix() {
			shouldApply = false; // Set default to false

			// Check if Chrome 79 or newer
			var isChrome79 = navigator.userAgent.match(/chrom(?:e|ium)\/(\d+)\./i);
			var isChrome79 = parseInt(isChrome79[1], 10);
			if (isChrome79 >= 79){ shouldApply = true; }; // Set true if Chrome 79 or newer 

			var isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
			if (isSafari){ shouldApply = true; }; // Set true if Safari 

			if (/Edge/.test(navigator.userAgent)) { shouldApply = true; }

			if(shouldApply){ // If any browser matches, apply the override
				var elems = document.getElementsByClassName("addtocart");
					var index = 0,
						length = elems.length;
					for (; index < length; index++) {
						elems[index].setAttribute("style", "height: auto !important;");
				}
			}

		}
		apply7880Fix();
  	
  },
  checkForTransferableEntry: function(){
	let addListToCartsDisable;
	let checkCounter=0;
	$('.list-check').each(function() {
		let ref = $(this);
		let target = ref.children('input[type=checkbox]');
		let listBlock = ref.closest('.saved-list-sec');
		if(target.prop("checked")){
			checkCounter++;
			if(listBlock.data("nontransferableflag")){
				addListToCartsDisable = true;
			}
		}
	});
	if(addListToCartsDisable || !checkCounter){
		ACC.savedlist.disableEnableButon($(".SavedSelectedProduct"), true);
	}
	else{
		ACC.savedlist.disableEnableButon($(".SavedSelectedProduct"), false);
	}
  },
  
  //MultipleUoM to select the first Uom OnLoad
  multipleUomItemSelector: function () {
	let firstItemRow = $(".multipleUomContents").children(":first");
	if (firstItemRow.length) {
		firstItemRow.addClass("selected-uom-item");
		firstItemRow.find('input[type="radio"').prop("checked", true);
	}
    let qty = $('#pdpAddtoCartInput').val();
    $(".multipleUomItem").attr("data-qty",qty)
	ACC.product.checkMinQuantity($('#pdpAddtoCartInput'),0);
	$(window).on('pageshow', function() {
		firstItemRow.find('input[type="radio"').prop("checked", true).trigger('change');
	});
  },
  updatePriceForUOMDropdownSelection: function(elem) {
	let productCode=elem.attr("data-code");
	let inventoryUomId= elem.attr("data-value");
	let quantity=elem.attr("data-qty") || 1;
	let inventoryUOMDesc=elem.attr("data-uom");
	let inventoryUOMmul=elem.attr("data-inventory");
	let outOfStockFlag = elem.data('outofstockflag');
	if ($(".hardscapeProd_" + productCode).length && $(".getAQuoteFlagForB2BUserPDP").val() == "true") {
		let atcButton = $(".mobile-pdp-sticky").find(".js-atc-update");
		if (outOfStockFlag) {
			atcButton.addClass("hidden");
			atcButton.nextAll(".reqAQuoteForOutOfStock").first().removeClass("hidden");
		} else {
			atcButton.removeClass("hidden");
			atcButton.nextAll(".reqAQuoteForOutOfStock").first().addClass("hidden");
		}
	}
	if (quantity > 0 && productCode != undefined && productCode != null && productCode != "") {
		$.ajax({
			type: 'GET',
			url: ACC.config.encodedContextPath + '/p/customerpriceforuom',
			data: {
				productCode: productCode,
				quantity: quantity,
				inventoryUomId: inventoryUomId
			},
			success: function (result) {
				$(".multipleuom-retailprice").html(result.totalPrice.formattedValue);
				$(".muomunitprice").html(result.unitPrice.formattedValue);
				if (inventoryUOMmul == '1') {
					$('#redesignmultipleuomdesc').html(inventoryUOMDesc + '?');
				} else {
					$('#redesignmultipleuomdesc').html(inventoryUOMDesc + 'S?');
				}
				if (result.noOfUnits == 1) {
					let text_conmuom = (ACC.config.encodedContextPath == '/es') ? 'Total de la unidad' : 'Unit Total';
					$(".muomqty").html(result.noOfUnits + ' ' + text_conmuom);
				} else {
					let text_conmuom1 = (ACC.config.encodedContextPath == '/es') ? 'Total de la unidades' : 'Units Total';
					$(".muomqty").html(result.noOfUnits + ' ' + text_conmuom1);
				}
				$('#addToCartForm').find('#inventoryUomId').val(inventoryUomId);
				$('[id="inventoryUOMIDVal"]').each(function () { $(this).val(inventoryUomId) });
			},
			error: function (xhr, ajaxOptions, thrownError) {
				console.log('data failure');
			}
		});
	}
  },
  multipleUomTotalPriceUpdater: function(){
	  	let productCode=$(".selected-uom-item").attr("data-productcode");
		let inventoryUomId=$(".selected-uom-item").attr("data-inventoryid");
		let quantity=$(".selected-uom-item").attr("data-qty");
		let inventoryUOMDesc=$(".selected-uom-item").attr("data-inventoryUOMDesc");
		let inventoryUOMmul=$(".selected-uom-item").attr("data-inventorymul1");
		let outOfStockFlag = $(".selected-uom-item").attr("data-outofstockflag");
		let stockLevel = $(".selected-uom-item").attr("data-stocklevel");
		let atcButton = $(".product-main-info").find(".js-atc-update");
	  if ((outOfStockFlag == 'true' && $(".selected-uom-item").find(".stock-section-outofstock").length > 0)
		  || (Number(quantity) > Number(stockLevel) && ($(".selected-uom-item").find(".stock-section-instock").length > 0
			  || $(".selected-uom-item").find(".stock-section-instock-nearby").length > 0))) {
		  if ($(".hardscapeProd_" + productCode).length && $(".getAQuoteFlagForB2BUserPDP").val() == "true") {
			  atcButton.addClass("hidden");
			  atcButton.parents(".pdpSubmitBtnSection").find(".reqAQuoteForOutOfStock").first().removeClass("hidden");
			  $(".product-main-info").find(".pdp-warning_info_" + productCode).find(".pdp-commonerror").text(ACC.config.changeUOMForAvailability);
		  } else {
			  $(".product-main-info").find(".pdp-warning_info_" + productCode).find(".pdp-commonerror").text(ACC.config.expectDelay);
		  }
		  $(".product-main-info").find(".pdp-warning_info_" + productCode).removeClass("hidden");
	  } else {
		if ($(".hardscapeProd_" + productCode).length && $(".getAQuoteFlagForB2BUserPDP").val() == "true") {
			atcButton.removeClass("hidden");
			atcButton.parents(".pdpSubmitBtnSection").find(".reqAQuoteForOutOfStock").first().addClass("hidden");
		}
		$(".product-main-info").find(".pdp-warning_info_" + productCode).addClass("hidden");
	  }
		if(!$(".selected-uom-item").length){
			productCode = $(".singleUom-ProductCode").val();
			inventoryUomId = "";
			quantity = $('#pdpAddtoCartInput').val();
		}
		if(quantity>0 &&  productCode!= undefined && productCode!=null && productCode!="" ){
		$.ajax({
	     	      type: 'GET',
	     	      url: ACC.config.encodedContextPath + '/p/customerpriceforuom',
	     	      data: {
					   productCode:productCode,
					   quantity:quantity,
					   inventoryUomId:inventoryUomId
				   },
				   success: function(result){
					  $(".multipleuom-retailprice").html(result.totalPrice.formattedValue);
					 $(".muomunitprice").html(result.unitPrice.formattedValue);
					 if( inventoryUOMmul == '1'){
						$('#redesignmultipleuomdesc').html(inventoryUOMDesc+'?');
					 }
					 else{
						$('#redesignmultipleuomdesc').html(inventoryUOMDesc+'S?');
					 }
					 if( result.noOfUnits == 1 ){
						let text_conmuom = (ACC.config.encodedContextPath == '/es')? 'Total de la unidad' : 'Unit Total';
						$(".muomqty").html(result.noOfUnits+' '+text_conmuom) ;
					 }
					 else{
						let text_conmuom1 = (ACC.config.encodedContextPath == '/es')? 'Total de la unidades' : 'Units Total';
						$(".muomqty").html(result.noOfUnits+' ' +text_conmuom1);
					 }	
					 $('#addToCartForm').find('#inventoryUomId').val(inventoryUomId);
					 $('[id="inventoryUOMIDVal"]').each(function(){$(this).val(inventoryUomId)});
				   },
				   error: function(xhr, ajaxOptions, thrownError) {
	  	              console.log('data failure');               
	
	  	          }
	     	    })
	     	    }
  },
  hardscapesStonePDPAlert: function(){
		if($(".page-productDetails").length && $(".hardscape-pdp-stone-alert").length){
			let target = $(".hardscape-pdp-stone-alert");
			let l1Category = (ACC.config.encodedContextPath == '/es')? 'Materiales duros & Vida al Aire Libre' : 'Hardscapes & Outdoor Living';
			let landscapeCategory = (ACC.config.encodedContextPath == '/es') ? 'Material de Jardinera' : 'Landscape Supply';
			let cosumableCategory = (ACC.config.encodedContextPath == '/es') ? 'Consumibles' : 'Consumables';
			if(target.data('level1category') == l1Category || (target.data('level1category') == landscapeCategory && target.data('level2category') == cosumableCategory)){
				let itemUOMList = [ACC.config.uomCubicYard, ACC.config.uomNetTon, ACC.config.uomNetTon2000LB];
				let itemUOMParent = $(".product-main-info .product-uomMeasure");
				let itemUOMCheck;
				let itemUOMFound;
				for (let i = 0; i < itemUOMParent.length; i++) {
					itemUOMCheck = $.trim(itemUOMParent.eq(i).val());
					if($.inArray(itemUOMCheck, itemUOMList) != -1){
						itemUOMFound = true;
						break;
					}
				}
				if(itemUOMFound && !$(".callBranchForPrice").is(":visible") && !$(".requestQuoteBtnPDP").is(":visible")){
					$(".hardscape-price-alert").removeClass("hidden");
				}
				$(".hardscape-note-alert").slideDown();
			} else {
				$(".hardscape-note-alert").slideUp();
			}
		}
	},
	landscapeNotePDPAlert: function () {
		if ($(".page-productDetails").length && $(".landscape-note-alert").length) {
			let l1Category = $(".landscape-note-alert").attr('data-level1Category');
			if (l1Category == 'Landscape Supply' || l1Category == 'Material de Jardinera') {
				let level3Category = $('#breadcrumbName3').val();
				let level4Category = $('#breadcrumbName4').val();
				if (
					( level3Category== 'Mulch' || level3Category=='Mantillo' || level3Category=='Soil' || level3Category=='Suelo' ||level3Category=='Soil Amendments' || level3Category=='Mejoras del Suelo' || level3Category=='Straw' ||level3Category=='Paja') &&
					( level4Category== 'Bulk Mulch' || level4Category=='Bagged Mulch' || level4Category== 'Bagged Soil Amendments' || level4Category== 'Bulk Soil Amendments'|| level4Category== 'Bagged Soil' || level4Category== 'Bulk Soil' ||  level4Category=='Pine Straw'||level4Category== 'Wheat Straw' || level4Category=='Synthetic Straw')
					)
				{
					$('.landscape-note-alert').removeClass('hidden')
				}
			}
		}
	},
	pdpBulletPointLoad: function () {
			if(document.getElementById('pdpBulletPointSection') != null){
				var pdpBPSimpleProduct = document.getElementById('pdpBulletPointProductType').value;
				if(pdpBPSimpleProduct == 'true'){
					var pdpBPSection = document.getElementById('pdpBulletPointSection');
					var pdpBP = pdpBPSection.getElementsByTagName('li');
					var pdpBPCalLink = document.getElementById('pdpBulletPointCalLink');
					var pdpBPLength = pdpBP.length;
					if(pdpBPLength > 0){
						var pdpBPDisplayCount = 2;
						if(pdpBPCalLink != null){
							pdpBPDisplayCount = 1;
						}
						for(count=(pdpBPLength-1); count>pdpBPDisplayCount; count--){
								pdpBP[count].remove();
						}
						if(pdpBPDisplayCount == 1 && pdpBPLength > 2){
							$('.pdpBulletPointMoreDetails').removeClass("hidden");
						}
						if(pdpBPDisplayCount == 2 && pdpBPLength > 3){
							$('.pdpBulletPointMoreDetails').removeClass("hidden");
						}
					}
					$('.pdpBulletPointLoaderSection').addClass("hide");
					$('#pdpBulletPointSection').removeClass("hidden");
					$('#pdpBulletPointCalLink').removeClass("hidden");
				}			
			}
	},
	triggerpdplistpopupoption: function(id){
			var option = document.getElementById(id);
			option.click();
	},
	triggerPDPBulletPointMoreDetails: function(){
			$('html,body').animate({
                    scrollTop: $("#pdpSimpleProductDesktopDescription").offset().top - 180 },
            'slow');
	},
	pdpAddListAjax: function(wishlistCode, productCode, inventryUOM, wishListname, quantity) {
	 if(($(".plpviewtype").val() == "card" || $(".plpviewtype").val() == "list") && (ACC.productDetail.plpCommonBtn == "true")){
			ACC.product.addSelectedProductsToList(wishlistCode);
	 }else if($(".plpviewtype").val() == "card" && ACC.productDetail.plpCommonBtn == "false" && ACC.productDetail.plpMobileAddListCode != ''){
		 	ACC.product.plpMobileAddListFunction(wishlistCode,ACC.productDetail.plpMobileAddListCode);
	 }
	 else{
		 if (quantity == null || quantity == undefined) {
			quantity = 1;
		}
		if ($('.loginstatus').val() != '') {
			let params = {
				productCode: productCode,
				wishListCode: wishlistCode,
				quantity: quantity,
				inventoryUOMId: inventryUOM,
			};
			let apiname = "/savedList/add";
			if (ACC.savedlist.isRecommendedListPage) { //for recommended List flow
				apiname = "/savedList/addSelectedToSavedWishlist";
				let buttonName = $("#" + wishlistCode).attr("buttonName");
				if (buttonName == "selectedCopyList") {
					params = {
						wishListCode: wishlistCode,
						productItemNumbers: productItemNumbers,
					};
				}
				else {
					let recommendedCategoryName = $("#" + wishlistCode).attr("categoryname");
					params = {
						wishListCode: wishlistCode,
						categoryName: recommendedCategoryName,
					};
				}
			}
			$.ajax({
				type: 'POST',
				url: ACC.config.encodedContextPath + apiname,
				datatype: "json",
				data: params,
				success: function (result) {
					ACC.colorbox.open("", {
						html: ACC.productDetail.pdppopupHtmlExistingList(ACC.config.listaddedMsg, wishlistCode),
						width: "500px",
						onComplete: function () {
							$('#colorbox').addClass('item-add-list-box');
							$('body').css("overflow-y", "hidden");
							$(document).on("click", ".successListCreation", function () {
								ACC.colorbox.close();
							});
						},
						onClosed: function () {
							$('body').css("overflow-y", "auto");
							$('#colorbox').removeClass('item-add-list-box');
						}
					})
				},
				error: function (xhr, ajaxOptions, thrownError) {
					console.log('data failure');
				}
			})
		}
	 }
	},
	varientProductAddList: function(num,elem) {
		ACC.productDetail.plpCommonBtn = "false";
		ACC.productDetail.plpMobileAddListCode = '';
		ACC.productDetail.varientProductQTY = ACC.productDetail.getVarientProductListQuantity(elem);
		$('.pdplistpopupoption').removeClass('selected');
		$(".pdplistpopup1").removeClass('hidden');
		$(".pdp-newlist-popup-error-text").hide();
		$(".pdp-emptynewlist-popup-error-text").hide();
		$('.listpopupsavebtn').removeClass("disabled");
		$('.createnewlistbtn').removeClass("disabled");
		$(".pdp-atl-popup").colorbox.resize();
		var listpopup = "#listpopup" + num ;
		if($('.loginstatus').val()!=''){
			ACC.colorbox.open("", {
				html:  $(listpopup.replace(".","\\.")).html(),
				width: "500px",
				className: "pdp-atl-popup",
				onComplete:function(){
					$(document).on("click",".listpopupclosebtn", function(e){
						ACC.colorbox.close();
					});
				}
			})
		}
	},
	getVarientProductListQuantity: function(elem){
		var qty;
		if($('.product-variant-table').length > 0) {
			if($(elem).closest('.product-variant-table__values')[0].querySelector('.pdp-variant-qty') != null){
				qty = $(elem).closest('.product-variant-table__values')[0].querySelector('.pdp-variant-qty').value;
				return qty;
			}
			else{
				qty = 1;
				return qty;
			}
		}
	},
	productHighlightsButton: function(){
		$('.productHighlightsClick').click();
	}
};

$(document).on("click", ".successListCreation", function(){
	if($('.product-variant-table').length > 0) {
		window.location.reload(true);
	}
 });

//Select the different UoM and get response 

$(document).on("click", ".multipleUomItem", function () {
	let qty = $('#pdpAddtoCartInput').val();
	$(".multipleUomItem").attr("data-qty",qty);
	$(".multipleUomItem").removeClass("selected-uom-item");
	$(this).addClass("selected-uom-item");
	let ele = $(this).children().children().children(":first");
	ele.prop("checked", "checked");
	$(".quoteUom-Measure").val($(".selected-uom-item").attr("data-inventoryuomdesc"));
	let customerPrice = $(".selected-uom-item").find(".multipleUomItemYourPrice").text().trim();
	let retailPrice = $(".selected-uom-item").find(".multipleUomItemUnitPrice").text().trim()
	$(".quoteUom-CustomerPrice").val(customerPrice ? customerPrice.replace(/[^0-9.]/g, "") : "");
	$(".quoteUom-Price").val(retailPrice ? retailPrice.replace(/[^0-9.]/g, "") : "");
	ACC.product.checkMinQuantity($('#pdpAddtoCartInput'),1);	
	ACC.productDetail.multipleUomTotalPriceUpdater();
});

//Updating quantity on changing quantity input

$(document).on("input","#pdpAddtoCartInput",function(){
	    if ($(".pdp-variant-qty").length) {
        let quantity = $(this).val();
        let productCode = $(this).attr('data-productcode');
        let inventoryUOMId = "";
		if(quantity>0){
			$.ajax({
				type: 'GET',
				url: ACC.config.encodedContextPath + '/p/customerpriceforuom',
				data: {
					productCode: productCode,
					quantity: quantity,
					inventoryUomId: inventoryUOMId
				},
				success: function (result) {
					$('#addToCartForm').find('#inventoryUomId').val(inventoryUomId);
					$('[id="inventoryUOMIDVal"]').each(function(){$(this).val(inventoryUomId)});
				},
				error: function(xhr, ajaxOptions, thrownError) {
					console.log('data failure');  
				}
			})
		}
    } else{
		let qty = $('#pdpAddtoCartInput').val();
		 $(".multipleUomItem").attr("data-qty",qty);
		 ACC.productDetail.multipleUomTotalPriceUpdater();
	}
	
})

// ajax function to update unit and total price pdp 

$( function()
{
    var targets = $( '[rel~=pdp-tooltip]' ),
        target  = false,
        newTooltip = false,
        title   = false;
 
    targets.bind( 'mouseenter', function()
    {
        target  = $( this );
        tip     = target.find(".tooltip-content").html();
        newTooltip = $( '<div id="custom-tooltip"></div>' );
 
        if( !tip || tip == '' )
            return false;
 
        target.removeAttr( 'title' );
        newTooltip
               .html( tip )
               .appendTo( 'body' );
 
        var init_tooltip = function()
        {
            if( $( window ).width() < newTooltip.outerWidth() * 1.5 )
                newTooltip.css( 'max-width', 250 );
            else
                newTooltip.css( 'max-width', 340 );
 
            var pos_left = target.offset().left + ( target.outerWidth() / 2 ) - ( newTooltip.outerWidth() / 2 ),
                pos_top  = target.offset().top - newTooltip.outerHeight() - 20;
              
            if( pos_left < 0 )
            {
                pos_left = target.offset().left + target.outerWidth() / 2 - 20;
                newTooltip.addClass( 'left' );
            }
            else
                newTooltip.removeClass( 'left' );
 
            if( pos_left + newTooltip.outerWidth() > $( window ).width() )
            {
                pos_left = target.offset().left - newTooltip.outerWidth() + target.outerWidth() / 2 + 20;
                newTooltip.addClass( 'right' );
            }
            else
                newTooltip.removeClass( 'right' );
 
            if( pos_top < 0 )
            {
                var pos_top  = target.offset().top + target.outerHeight();
                newTooltip.addClass( 'top' );
            }
            else
                newTooltip.removeClass( 'top' );
 
            newTooltip.css( { left: pos_left, top: pos_top } )
                   .fadeIn( "slow");
        };
 
        init_tooltip();
        $(newTooltip).siblings('#custom-tooltip').each(function(){
            $(this).remove();
        })
        // $( window ).resize( init_tooltip );
 
        var remove_tooltip = function()
           {   
        	setTimeout(function(){
                 if(newTooltip.hasClass("active")===false){
                    newTooltip.css( "display","none")
                  }
            },500);   
            //target.attr( 'title', tip );  
            };
 
        target.bind( 'mouseleave',remove_tooltip);
        newTooltip.bind( 'click', remove_tooltip );
    });
    
    $(document).on("mouseenter","#custom-tooltip",function(){
        $(this).fadeIn("fast").addClass("active")

    })
    $(document).on("mouseleave","#custom-tooltip",function(){
        $(this).fadeOut("fast").removeClass("active")
        if(newTooltip.hasClass("active")===false){
            $(this).css( "display","none");     
        }
    })
});
ACC.quickview = {

	_autoload: [
		"bindToUiCarouselLink",
	],
		
		
	initQuickviewLightbox:function(){
		ACC.product.enableAddToCartButton();
		ACC.product.bindToAddToCartForm();
		ACC.product.enableStorePickupButton();
	},
		
	refreshScreenReaderBuffer: function ()
	{
		// changes a value in a hidden form field in order
		// to trigger a buffer update in a screen reader
		$('#accesibility_refreshScreenReaderBufferField').attr('value', new Date().getTime());
	},
	


	bindToUiCarouselLink: function ()
	{
		var titleHeader = $('#quickViewTitle').html();
		$(".js-owl-carousel-reference .js-reference-item").colorbox({
			close:'<span class="glyphicon glyphicon-remove"></span>',
			title: titleHeader,
			maxWidth:"100%",
			height: "550px",
			onComplete: function ()
			{
				ACC.quickview.refreshScreenReaderBuffer();
				ACC.quickview.initQuickviewLightbox();
				ACC.ratingstars.bindRatingStars($(".quick-view-stars"));
				ACC.imagegallery.bindImageGallery();
			},

			onClosed: function ()
			{
				ACC.quickview.refreshScreenReaderBuffer();
			}
		});
	}
	
};
ACC.quote = {

	_autoload : [
		[ "bindAddComment", $("#js-quote-comments").length != 0 ],
		[ "bindAddEntryComment", $(".js-quote-entry-comments").length != 0],
		[ "toggleMoreComments", $("#js-quote-comments").length != 0 ],
		[ "toggleLessComments", $("#js-quote-comments").length != 0 ],
		[ "displayLessComments", $("#js-quote-comments").length != 0 ],
		[ "quoteDetailsNavigation", $(".js-quote-actions").length != 0],
		[ "bindQuoteButtons", $(".js-btn-quote").length != 0 ],
		[ "bindEditQuoteButton", $(".js-quote-edit-btn").length != 0 ],
		[ "bindSubmitConfirmation", $(".js-quote-submit-btn").length != 0],
		[ "bindCancelConfirmation", $(".js-quote-cancel-btn").length != 0],
		[ "bindName" , $("#js-quote-name").length != 0],
		[ "bindDescription" , $("#js-quote-description").length != 0],
		[ "bindExpirationTime", $("#js-quote-expiration-time").length != 0],
		[ "bindCheckoutConfirmation", $(".js-quote-checkout-btn").length != 0],
		[ "bindEditConfirmation", $(".js-quote-warning-btn").length != 0],
		[ "bindQuoteDiscount", $(".js-quote-discount-link").length != 0],
		[ "bindNewCartClick", $(".new__cart--link").length != 0]
	],

	bindEditQuoteButton: function(){
		$(".js-quote-edit-btn").on("click", function(){
			var sUrl = $(this).data("quoteEditUrl");
			window.location = sUrl;
		});
	},
	bindNewCartClick: function(){
		$(".new__cart--link").bind("click", function(event){
			$(this).unbind(event);
		});
	},
	bindAddComment : function() {
		$(document).on(
			"keypress",
			'#js-quote-comments #comment',
			function(event) {
				var key = event.keyCode;

				// If the user has pressed enter
				if (key == 13) {
					if($('#comment').val().trim() == '') {
						return false;
					}
					event.preventDefault();
					ACC.quote.quoteCommentSubmit($('#comment').val());
					$('#comment').val("");
					return false;
				} else {
					return true;
				}
			});
	},

	bindAddEntryComment: function () {
		$(document).on(
			"keypress",
			".js-quote-entry-comments",
			function (event) {
				var key = event.keyCode;

				if (key == 13) {
					event.preventDefault();
					ACC.quote.quoteEntryCommentSubmit($(this).val(), $(this).data("entry-number"));
					return false;
				} else {
					return true;
				}
			}
		);
	},

	bindQuoteButtons : function() {
		$('.js-save-quote-btn').on('click',function () {
			var url = $(this).data("saveQuoteUrl");
			$('#quoteForm').attr('action', url).submit();
		});
		$('.js-submit-quote-btn').on('click',function () {
			var url = $(this).data("submitQuoteUrl");
			$('#quoteForm').attr('action', url).submit();
		});
		$('.js-accept-quote-btn').on('click',function () {
			var url = $(this).data("acceptQuoteUrl");
			$('#quoteForm').attr('action', url).submit();
		});
	},

	quoteCommentSubmit : function(comment) {
		var quoteComments = $("#js-quote-comments");
		var addCommentUrl = quoteComments.data("quote-base-link") + "comment";
		var showAllComments = quoteComments.data("show-all-comments");

		$.ajax({
			url : addCommentUrl,
			data : {
				comment : comment
			},
			type : "post",
			success : function(response) {
				ACC.quote.onCommentSuccess(showAllComments);
			}
		});
	},

	quoteEntryCommentSubmit: function (comment, entryNumber) {
		if (!comment || !comment.length) {
			return;
		}

		var quoteComments = $("#js-quote-comments");
		var addEntryCommentUrl = quoteComments.data("quote-base-link") + "entry/comment";

		$.ajax({
			url: addEntryCommentUrl,
			data: {
				comment: comment,
				entryNumber: entryNumber
			},
			type: "post",
			success: function () {
				ACC.quote.onEntryCommentSuccess(entryNumber);
			}
		})
	},

	onCommentSuccess : function(showAllComments) {
		$("#commentListDiv").on('load',location.href + " #commentListDiv", function() {
			ACC.quote.displayComments("" + showAllComments);
		});
	},

	onEntryCommentSuccess: function (entryNumber) {
		$("#entryCommentListDiv_" + entryNumber).on('load',location.href + " #entryCommentListDiv_" + entryNumber, function () {
			ACC.quote.displayEntryComments(entryNumber);
		});

		$("#entryComment_" + entryNumber).val("");
	},

	toggleMoreComments : function() {
		$(document).on('click', '#moreCommentsAnchor', ACC.quote.displayMoreComments);
		$(document).on('click', '.js-more-entry-comments-anchor', ACC.quote.displayMoreEntryComments);
	},

	toggleLessComments : function() {
		$(document).on('click', '#lessCommentsAnchor', ACC.quote.displayLessComments);
		$(document).on('click', '.js-less-entry-comments-anchor', ACC.quote.displayLessEntryComments);
	},

	displayMoreComments : function(e) {
		e.preventDefault();
		ACC.quote.displayComments("true");
	},

	displayMoreEntryComments: function (e) {
		e.preventDefault();
		ACC.quote.displayEntryComments($(this).data("entry-number"), "true");
	},

	displayLessComments : function(e) {
		if (e != undefined) {
			e.preventDefault();
		}
		ACC.quote.displayComments("false");
	},

	displayLessEntryComments: function (e) {
		e.preventDefault();
		ACC.quote.displayEntryComments($(this).data("entry-number"), "false");
	},

	displayComments : function(showAll) {
		var quoteComments = $("#js-quote-comments");
		var currentCommentsShown = quoteComments.data("current-comments-shown");
		var comments = $('[id^="comment_"]');

		// iterate over comments. If showAll, just show, otherwise check if max comments is reached then hide
		for (var i = 0; i < comments.length; i++) {
			if (showAll === "true") {
				$(comments[i]).show();
			} else {
				if (i < currentCommentsShown) {
					$(comments[i]).show();
				} else {
					$(comments[i]).hide();
				}
			}
		}

		// toggle anchors
		if (showAll === "false") {
			$('#moreCommentsAnchor').show();
			$('#lessCommentsAnchor').hide();
			quoteComments.data("show-all-comments", false);
		} else {
			$('#moreCommentsAnchor').hide();
			$('#lessCommentsAnchor').show();
			quoteComments.data("show-all-comments", true);
		}

		return false;
	},

	displayEntryComments: function (entryNumber, showAll) {
		var quoteEntryComments = $("#entryCommentListDiv_" + entryNumber);
		var comments = quoteEntryComments.find('[id^="entryComment_' + entryNumber + '"]');

		showAll = showAll || "" + quoteEntryComments.data("show-all-entry-comments");

		// iterate over comments. If showAll, just show, otherwise check if max comments is reached then hide
		for (var i = 0; i < comments.length; i++) {
			if (showAll === "true") {
				$(comments[i]).show();
			} else {
				if (i < 4) {
					$(comments[i]).show();
				} else {
					$(comments[i]).hide();
				}
			}
		}

		// toggle anchors
		if (showAll === "false") {
			quoteEntryComments.find(".js-more-entry-comments-anchor").show();
			quoteEntryComments.find(".js-less-entry-comments-anchor").hide();
			quoteEntryComments.data("show-all-entry-comments", false);
		} else {
			quoteEntryComments.find(".js-more-entry-comments-anchor").hide();
			quoteEntryComments.find(".js-less-entry-comments-anchor").show();
			quoteEntryComments.data("show-all-entry-comments", true);
		}

		return false;
	},

	quoteDetailsNavigation: function(){
		$('.js-quote-actions').on('click', function(e){
			$(this).parent().find('nav').toggleClass('display-none');
		});
	},

	bindSubmitConfirmation : function(e) {
		ACC.quote.handleConfirmationModal({
			actionButtonSelector:".js-quote-submit-btn",
			modalWindowSelector:"#js-quote-submit-modal",
			modalTitleDataAttributeName:"submit-confirmation-modal-title",
			cancelButtonSelector:"#js-quote-submit-modal #submitNoButton"
		});

		$("#quoteSubmitForm").submit(function(event) {
			var quoteForm = $("#quoteForm");

			if (quoteForm.is("form")) {
				event.preventDefault();

				var submitUrl = $(this).prop("action");

				quoteForm.prop("action", submitUrl);
				quoteForm.submit();
			}
		});
	},

	bindCheckoutConfirmation : function(e) {
		ACC.quote.handleConfirmationModal({
			actionButtonSelector:".js-quote-checkout-btn",
			modalWindowSelector:"#js-quote-checkout-modal",
			modalTitleDataAttributeName:"submit-confirmation-modal-title",
			cancelButtonSelector:"#js-quote-checkout-modal #submitNoButton"
		});
	},

	bindCancelConfirmation: function(e) {
		ACC.quote.handleConfirmationModal({
			actionButtonSelector: ".js-quote-cancel-btn",
			modalWindowSelector: "#js-quote-cancel-modal",
			modalTitleDataAttributeName: "cancel-confirmation-modal-title",
			cancelButtonSelector: "#js-quote-cancel-modal #cancelNoButton"
		});
	},

	bindEditConfirmation: function(e) {
		ACC.quote.handleConfirmationModal({
			actionButtonSelector: ".js-quote-warning-btn",
			modalWindowSelector: "#js-quote-edit-modal",
			modalTitleDataAttributeName:"edit-confirmation-modal-title",
			cancelButtonSelector: "#js-quote-edit-modal #cancelEditNoButton",
			confirmButtonSelector: "#js-quote-edit-modal #cancelEditYesButton"
		});
	},

	handleConfirmationModal: function(options) {
		$(options.actionButtonSelector).on('click',function (e) {
			e.preventDefault();

			var modalWindow = $(options.modalWindowSelector);
			var title = modalWindow.data(options.modalTitleDataAttributeName);

			if (options.initializeCallback) {
				options.initializeCallback();
			}

			ACC.colorbox.open(title, {
				inline: true,
				href: modalWindow,
				width: "480px",
				escKey: false,
				overlayClose: false,
				onComplete: function(){
					ACC.colorbox.resize();
				}
			});
		});

		$(options.cancelButtonSelector).on('click',function (e) {
			e.preventDefault();
			ACC.colorbox.close();
		});

		$(options.confirmButtonSelector).on('click',function (e) {
			e.preventDefault();
			ACC.colorbox.close();
			var sUrl = $(options.actionButtonSelector).data("quoteEditUrl");
			window.location = sUrl;
		});
	},

	bindQuoteDiscount: function(e) {
		ACC.quote.handleDiscountModal({
			actionButtonSelector: ".js-quote-discount-link",
			modalWindowSelector: "#js-quote-discount-modal",
			modalTitleDataAttributeName: "quote-modal-title",
			modalTotalDataAttributeName: "quote-modal-total",
			modalQuoteDiscountDataAttributeName: "quote-modal-quote-discount",
			modalCurrencyDataAttributeName: "quote-modal-currency",
			cancelButtonSelector: "#js-quote-discount-modal #cancelButton",
		});
	},

	handleDiscountModal: function(options) {
		var modalWindow = $(options.modalWindowSelector);
		var total = parseFloat(modalWindow.data(options.modalTotalDataAttributeName));
		var quoteDiscount = parseFloat(modalWindow.data(options.modalQuoteDiscountDataAttributeName));
		var currency = modalWindow.data(options.modalCurrencyDataAttributeName);

		$(options.actionButtonSelector).on('click',function (e) {
			e.preventDefault();

			var title = modalWindow.data(options.modalTitleDataAttributeName);

			if (options.initializeCallback) {
				options.initializeCallback();
			}

			ACC.colorbox.open(title, {
				inline: true,
				href: modalWindow,
				width: "480px",
				onComplete: function(){
					ACC.colorbox.resize();
					var percent = (quoteDiscount / total) * 100;
					var adjustTotal = (total - quoteDiscount).toFixed(2);
					$("#js-quote-discount-by-percentage").val(percent.toFixed(2));
					$("#js-quote-discount-by-amount").val(quoteDiscount.toFixed(2));
					$("#js-quote-discount-adjust-total").val(adjustTotal);
				}
			});
		});

		$(options.cancelButtonSelector).on('click',function (e) {
			e.preventDefault();
			ACC.colorbox.close();
		});

		function enableSubmit(){
			$("#js-quote-discount-by-percentage").css('border-color', '#cccccc');
			$("#js-quote-discount-by-amount").css('border-color', '#cccccc');
			$("#js-quote-discount-adjust-total").css('border-color', '#cccccc');
			$("#submitButton").prop("disabled", false);
		}
         function resetIntial(val)
         {
        		if(isNaN(parseFloat(val))){
        			val = 0.00;
        			val=val.toFixed(2);
    			}	
        		return val;
         }
		function updateByPercentage()
		{
			var percent = parseFloat($("#js-quote-discount-by-percentage").val());
			// input validation
			if(percent > 100 || percent < 0){
				$("#js-quote-discount-by-percentage").css('border-color', 'red');
				$("#submitButton").prop("disabled", true);
			}else{
				enableSubmit();
			}
			var discountAmount = total * percent / 100;
			var discountAmount = discountAmount.toFixed(2);
			$("#js-quote-discount-by-amount").val(resetIntial(discountAmount));
			var remainTotal = total - discountAmount;
			var remainTotal = remainTotal.toFixed(2);
			$("#js-quote-discount-adjust-total").val(resetIntial(remainTotal));
			$("#js-quote-discount-rate").val(resetIntial(percent));
			$("#js-quote-discount-type").val("PERCENT");

			updateNewTotal(remainTotal);
		}

		$('#js-quote-discount-by-percentage').on('keyup', updateByPercentage);
		$('#js-quote-discount-by-percentage').on('change',updateByPercentage);
		$('#js-quote-discount-by-percentage').blur(reset);
		$('#js-quote-discount-by-percentage').keypress(holdPreviousValue);
		
		function reset()
		{
	        var per=$('#js-quote-discount-by-percentage').val();
	        var amt=$('#js-quote-discount-by-amount').val();
	        var tot=$('#js-quote-discount-adjust-total').val();
	        if(per=='')
	        	$('#js-quote-discount-by-percentage').val('0.00');
	        if(amt=='')
	        	$('#js-quote-discount-by-amount').val('0.00');
	        if(tot==''|| tot==0.00)
	        	$('#js-quote-discount-adjust-total').val(total);
		}
		
		function holdPreviousValue(event)
		{
		    var $this = $(this);
		    if ((event.which != 46 || $this.val().indexOf('.') != -1) &&
		       ((event.which < 48 || event.which > 57) &&
		       (event.which != 0 && event.which != 8))) {
		           event.preventDefault();
		    }

		    var text = $(this).val();
		    if ((event.which == 46) && (text.indexOf('.') == -1)) {
		        setTimeout(function() {
		            if ($this.val().substring($this.val().indexOf('.')).length > 3) {
		                $this.val($this.val().substring(0, $this.val().indexOf('.') + 3));
		            }
		         }, 1);
		    }

		    if ((text.indexOf('.') != -1) &&
		        (text.substring(text.indexOf('.')).length > 2) &&
		        (event.which != 0 && event.which != 8) &&
		        ($(this)[0].selectionStart >= text.length - 2)) {
		            event.preventDefault();
		    }    

		}	    

		function updateByAmount()
		{
			var discountAmount = parseFloat($("#js-quote-discount-by-amount").val());

			// input validation
			if(discountAmount > total || discountAmount < 0){
				$("#js-quote-discount-by-amount").css('border-color', 'red');
				$("#submitButton").prop("disabled", true);
			}else{
				enableSubmit();
			}

			var percent = (discountAmount / total) * 100;
			var percent = percent.toFixed(2);
			$("#js-quote-discount-by-percentage").val(resetIntial(percent));
			var remainTotal = total - discountAmount;
			var remainTotal = remainTotal.toFixed(2);
			$("#js-quote-discount-adjust-total").val(resetIntial(remainTotal));
			$("#js-quote-discount-rate").val(resetIntial(discountAmount));
			$("#js-quote-discount-type").val("ABSOLUTE");

			updateNewTotal(remainTotal);
		}
		
		$('#js-quote-discount-by-amount').on('keyup', updateByAmount);
		$('#js-quote-discount-by-amount').focusout(updateByAmount);
		$('#js-quote-discount-by-amount').keypress(holdPreviousValue);
		$('#js-quote-discount-by-amount').blur(reset);

		function updateByAdjustTotal()
		{
			var adujstTotal = parseFloat($("#js-quote-discount-adjust-total").val());

			// input validation
			if(adujstTotal > total || adujstTotal < 0){
				$("#js-quote-discount-adjust-total").css('border-color', 'red');
				$("#submitButton").prop("disabled", true);
			}else{
				enableSubmit();
			}

			var discountAmount = total - adujstTotal;
			var discountAmount = discountAmount.toFixed(2);
			$("#js-quote-discount-by-amount").val(resetIntial(discountAmount));
			var percent = (discountAmount / total) * 100;
			var percent = percent.toFixed(2);
			$("#js-quote-discount-by-percentage").val(resetIntial(percent));
			$("#js-quote-discount-rate").val(resetIntial(adujstTotal));
			$("#js-quote-discount-type").val("TARGET");

			updateNewTotal(adujstTotal);
		}
		
		$('#js-quote-discount-adjust-total').on('keyup', updateByAdjustTotal);
		$('#js-quote-discount-adjust-total').focusout(updateByAdjustTotal);
		$('#js-quote-discount-adjust-total').keypress(holdPreviousValue);
		$('#js-quote-discount-adjust-total').blur(reset);
		
		function updateNewTotal(newTotal){
			if(isNaN(parseFloat(newTotal))){
				newTotal = total;
			}
			var newTotal = parseFloat(newTotal).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,'); // format num to money
			$("#js-quote-discount-new-total").text(currency.concat(newTotal));
		}
	},

	bindName: function () {
		$("#js-quote-name").on("focusout", function () {
			ACC.quote.updateMetadata();
		});
	},

	bindDescription: function () {
		$("#js-quote-description").on("focusout", function () {
			ACC.quote.updateMetadata();
		});
	},

	updateMetadata: function () {
		var quoteForm = $("#quoteFormDiv");
		var updateMetadataUrl = quoteForm.data("metadata-url");
		var name = $("#js-quote-name").val().trim();
		var description = $("#js-quote-description").val();
		var nameWrapperElement = $("#js-quote-name-wrapper")

		if (name && name.length) {
			nameWrapperElement.removeClass("has-error");

			$.ajax({
				url: updateMetadataUrl,
				data: {
					name: name,
					description: description
				},
				type: "POST",
				success: function() {
					$(".js-modal-quote-description").text(description);
					$(".js-modal-quote-name").text(name);
				}
			});
		} else {
			if (!nameWrapperElement.hasClass("has-error")) {
				nameWrapperElement.addClass("has-error");
			}
		}
	},

	bindExpirationTime: function(e) {
		var expirationTimeWrapperElement = $("#js-quote-expiration-time");
		var dateFormatForDatePicker = expirationTimeWrapperElement.data("date-format-for-date-picker");
		var minOfferValidityPeriodDays = expirationTimeWrapperElement.data("min-offer-validity-period-days");

		var minDate = new Date();
		minDate.setDate(minDate.getDate() + minOfferValidityPeriodDays);

		$("#expirationTime").datepicker({
			dateFormat: dateFormatForDatePicker,
			constrainInput: true,
			minDate: minDate,
			onSelect: function() {
				ACC.quote.handleExpirationTimeUpdate(expirationTimeWrapperElement, dateFormatForDatePicker,
					minOfferValidityPeriodDays);
			}
		});

		$("#expirationTime").on('change',function () {
			ACC.quote.handleExpirationTimeUpdate(expirationTimeWrapperElement, dateFormatForDatePicker,
				minOfferValidityPeriodDays);
		});

		$(document).on("click", ".js-open-datepicker-quote-expiration-time", function() {
			$("#expirationTime").datepicker('show');
		});
	},

	handleExpirationTimeUpdate: function(expirationTimeWrapperElement, dateFormat, minOfferValidityPeriodDays) {
		var expirationTimeElement = $("#expirationTime");
		var expirationTime = expirationTimeElement.val();

		if (ACC.quote.validateExpirationTime(dateFormat, expirationTime, minOfferValidityPeriodDays)) {
			ACC.quote.updateExpirationTime(expirationTime.trim());
			expirationTimeWrapperElement.removeClass("has-error");
		} else {
			if (!expirationTimeWrapperElement.hasClass("has-error")) {
				expirationTimeWrapperElement.addClass("has-error");
			}
		}
	},

	validateExpirationTime: function(dateFormat, value, minOfferValidityPeriodDays) {
		try {
			if (value) {
				var selectedDate = $.datepicker.parseDate(dateFormat, value);

				var validDate = new Date();
				validDate.setHours(0,0,0,0);
				validDate.setDate(validDate.getDate() + minOfferValidityPeriodDays);

				if (selectedDate >= validDate) {
					return true;
				} else {
					return false;
				}
			} else {
				return true;
			}
		} catch (error) {
			return false;
		}
	},

	updateExpirationTime: function(expirationTime) {
		var url = $("#js-quote-expiration-time").data("expiration-time-url");
		$.ajax({
			url:  url,
			type: 'POST',
			data: {expirationTime: expirationTime},
			error: function (jqXHR) {
				var expirationTimeWrapperElement = $("#js-quote-expiration-time");
				if (!expirationTimeWrapperElement.hasClass("has-error")) {
					expirationTimeWrapperElement.addClass("has-error");
				}
			}
		});
	}
};
ACC.ratingstars = {

	_autoload: [
		["bindRatingStars", $(".js-ratingCalc").length > 0],
		["bindRatingStarsSet", $(".js-ratingCalcSet").length > 0]
	],

	bindRatingStars: function(){

		$(".js-ratingCalc").each(function(){
			var rating =  $(this).data("rating");
			$(this).find(".js-greenStars").width($(this).width() * ( parseFloat(rating.rating, 10) / rating.total ))
		})
	},
	bindRatingStarsSet: function(){
        $('.js-writeReviewStars').on({
            mouseleave: function mouseleave(){
                clearReviewState();
                var sV = (parseFloat( $(".js-ratingSetInput").val(), 10)) * 2;
                (typeof sV === "number" && !isNaN(sV) )? setReviewState(sV) : clearReviewState();
            }
        });
        var ratingIcons = $('.js-writeReviewStars .js-ratingIcon');
        var setReviewState = function(index){
            ratingIcons.slice(0, parseFloat(index,10) ).addClass('active');
        };
        var clearReviewState = function(){
            ratingIcons.removeClass('active');
        };
        ratingIcons.on({
            mouseenter: function mouseenter(){
                clearReviewState();
                setReviewState( $(this).index()+1 );
            },
            mouseleave: function mouseleave(){
                $(this).removeClass('active');
            },
            click: function click(){
                $(".js-ratingSetInput").val( ($(this).index() + 1) /2);
            }
        });

	}

};
ACC.refinements = {

	_autoload: [
		"setCityInSearchHeading",
		"bindMoreStoresToggles",
		["bindMoreLessToggles", $(".js-facet-form").length != 0],
		["init", $(".js-facet-form").length != 0],
		"filtersearch",
		["bindSearch", $(".js-facet-form").length != 0],"eventsNoResultsMsg",
		"categoryTiles",
		"refinementmorewaystofilter",
		"bindFiltersCount",
		"nearbyInstockFilterSection"
	],


	coords:{},
	storeSearchData:{},
	inStockfilter : true,

	init:function(){
		navigator.geolocation.getCurrentPosition(
			function (position){
				ACC.refinements.coords = position.coords;
			},
			function (error)
			{
				console.log("An error occurred... The error code and message are: " + error.code + "/" + error.message);
			}
		);

	},


	bindSearch:function(){

		$(document).on("submit",'#user_location_form', function(e){
			e.preventDefault()
			var q = $(".js-shop-stores-facet .js-shop-store-search-input").val();
			 if(q.length>0){
				 ACC.refinements.getInitStoreData(q);				
			 }
		})


		$(document).on("click",'#findStoresNearMeAjax', function(e){
			e.preventDefault()
			ACC.refinements.getInitStoreData(null,ACC.refinements.coords.latitude,ACC.refinements.coords.longitude);
		})


	},


	getInitStoreData: function(q,latitude,longitude){
		$(".alert").remove();
		data ={
			"q":"" ,
			"page":"0"
		}

		if(q != null){
			data.q = q;
		}
		

		if(latitude != null){
			data.latitude = latitude;
		}

		if(longitude != null){
			data.longitude = longitude;
		}

		ACC.refinements.storeSearchData = data;
		ACC.refinements.getStoreData();
	},


	getStoreData: function(){
		url= $(".js-facet-form").data("url");
		$.ajax({
			url: url,
			cache: false,
			data: ACC.refinements.storeSearchData,
			type: "get",
			success: function (response){
				window.location.reload();
			}
		});
	},
	
	bindMoreLessToggles: function (){

		$(document).on("click",".js-shop-stores-facet .js-facet-change-link",function(e){
			e.preventDefault();
			$(".js-shop-stores-facet .js-facet-container").hide();
			$(".js-shop-stores-facet .js-facet-form").show();
		})


		$(document).on("change",".js-product-facet .js-facet-checkbox",function(){
			if($(this).not(".js-facet-checkbox-stores")){
				loading.start();
				$(this).parents("form").submit();
			} else {
				if($(".js-facet-checkbox-stores".prop('checked') == true)){
					$(".nearby_store_list").find("input[type=checkbox]").each(function() {
						$(this).prop('checked', true);
					})
				} else {
					$(".nearby_store_list").find("input[type=checkbox]").each(function() {
						$(this).prop('checked', false);
					})
				}
				loading.start();
				$(this).parents("form").submit(function(e){
					e.preventDefault();
					e.stopPropagation();
					var submitted = $.post($(this).action, $(this).serialize());
				
					submitted.done(function(result) {
						$(".nearby_store_form").submit();
					});
				});
				
			}
			
		});

		//show loading on click of catagories in facet
		//[href] - would filter "show less" links which are <a>
		$('#product-facet a[href]').on('click', function() {
			if(!$(this).hasClass("hideShowMoreLink")) {
				loading.start();
			}
		});
		
		$(document).on("click",".js-product-facet .js-more-facet-values-link",function(e){
			e.preventDefault();
			$(this).parents(".js-facet").find(".js-facet-top-values").hide();
			$(this).parents(".js-facet").find(".js-facet-list-hidden").show();

			$(this).parents(".js-facet").find(".js-more-facet-values").hide();
			$(this).parents(".js-facet").find(".js-less-facet-values").show();
		})

		$(document).on("click",".js-product-facet .js-less-facet-values-link",function(e){
			e.preventDefault();
			$(this).parents(".js-facet").find(".js-facet-top-values").show();
			$(this).parents(".js-facet").find(".js-facet-list-hidden").hide();

			$(this).parents(".js-facet").find(".js-more-facet-values").show();
			$(this).parents(".js-facet").find(".js-less-facet-values").hide();
		})
	},

	setCityInSearchHeading: function()
	{
		$(document).ready(function () {
			var storeCheckbox = $('.js-facet-checkbox-stores');
			if(storeCheckbox.prop('checked')){
				$('.cityInSearchText').show();	
			} else {
				$('.cityInSearchText').hide();
			}
		});
	},

	bindMoreStoresToggles: function ()
	{
		//Curatedplp In-stock Toggle start
		var curatedplpToggle =  $("#curatedplptoggle").val();
		var curatedplpPageName =  $("#curatedplppagename").val();
		var linkCurated = location.pathname.split("/")[2];
		var curatedplpUrl = $(location). attr("href").split("/")[4];

		if(localStorage.getItem("curatedplpinstockToggle") == undefined) localStorage.setItem("curatedplpinstockToggle", true);

		if((curatedplpPageName.split(',').indexOf(curatedplpUrl) != -1) && localStorage.getItem("curatedplpinstockToggle") == 'false'){
			localStorage.setItem("curatedplpinstockToggle", true)
		}

		if(localStorage.getItem("curatedplpinstockToggle") == 'true' && (curatedplpPageName.split(',').indexOf(linkCurated) != -1)){
			if ($('.js-facet-checkbox').parent().hasClass('storesDisabled')) {
				localStorage.setItem("instockTogglestatus", false);
				$("input[name=inStock]").prop('checked', false);

			}
			else{
				localStorage.setItem("instockTogglestatus", true);
				$("input[name=inStock]").prop('checked', true);
			}
				
		}
		$(document).on("click",".applied-filter .glyphicon-remove",function(e){
			if(localStorage.getItem("instockTogglestatus") == 'true' && localStorage.getItem("curatedplpinstockToggle") == 'true'){
				$('input[name=inStock]').prop('checked', false);
				localStorage.setItem("curatedplpinstockToggle", false);
			}
		
		});
		//Curatedplp In-stock Toggle End
		
		$(document).ready(function () {
			if ($.trim($(".product__listing.product__grid").html()) =='') {
				$("#productFacets").addClass("hidden");		  				
			}
		});

		$(document).on("click",".js-shop-stores-facet .js-more-stores-facet-values",function(e){
			e.preventDefault();
			$(".js-shop-stores-facet ul.js-facet-list li.hidden").slice(0, 5).removeClass('hidden').first().find('.js-facet-checkbox').focus();
			if($(".js-shop-stores-facet ul.js-facet-list li.hidden").length==0){
				$(".js-shop-stores-facet .js-more-stores-facet-values").hide()
			}
		});

		function cleanCSV(value) {
			return (value || '').split(',').filter(Boolean).filter(function(item, index, all) {
				return (index === all.indexOf(item));
			});
		}

		function updateNearbyStoreList(){
			$(".nearby_store_list li:not(.search_nearby_enabled)").find("input").each(function(){
				thisStoreID = $(this).val();
				$('input[name=selectedNearbyStores]').val(function(index, value) {
					return this.value + ',' + thisStoreID;
				});

				$('input[name=selectedNearbyStores]').val(function(index, value) {
					return value.replace(',,', ',');
				 });
			});
			var removeFirstComma = $('input[name=selectedNearbyStores]').val().replace(/^,/, '');
			
			$('input[name=selectedNearbyStores]').val(removeFirstComma);

		}

		$(document).on("click",".search_nearby_enabled",function(e){
			$(this).find("input").each(function(){
				if($(this).prop('checked')){
					$(this).prop('checked', false);
					$(this).parent().parent().find("li").not(".search_nearby_enabled").find("input").prop('checked', false);
					$(this).parent().parent().find("li").not(".search_nearby_enabled").find(".facet__list__mark").css({'opacity': '1', 'pointer-events': 'none', 'cursor': 'not-allowed'});
					$('input[name=selectedNearbyStores]').val("");
					$('input[name=nearbyDisabled]').val('on');
				} else {
					$('input[name=nearbyDisabled]').val('');
					$(this).prop('checked', true);
					$(this).parent().parent().find("li").not(".search_nearby_enabled").find("input").prop('checked', true);
					$(this).parent().parent().find("li").not(".search_nearby_enabled").find(".facet__list__mark").css({'opacity': '1', 'pointer-events': 'auto', 'cursor': 'default'});
					updateNearbyStoreList();
				}
			});
		});

		$(document).on("click","input[name=inStock]",function(e){
			// Curatedplp In-stock toggle localStorage variable set to false
			localStorage.setItem("curatedplpinstockToggle", false);
			if($(this).prop('checked')){
				$('input[name=nearby]').prop('checked', true);
				updateNearbyStoreList();
			}
			setTimeout(function(){
				$(".storeFilterForm").submit();
			}, 500);
		});
		
		$(document).on("click","input[name=expressShipping]",function(e){
			if($(this).prop('checked')){
				$(this).prop('checked', true);		
			}
			setTimeout(function(){
				$(".storeFilterForm").submit();
			}, 500);
		});

		$(document).on("click","#nearby_apply_btn",function(e){
		setTimeout(function(){
			$(".storeFilterForm").submit();
		}, 500);
		});


		$(document).on("click",".nearby_store_list li:not(.search_nearby_enabled)",function(e){
			e.preventDefault();

			$(this).find("input").each(function(){
				thisStoreID = $(this).val();
				nearbyStoresInput = $('input[name=selectedNearbyStores]');
				if($(this).prop('checked')){
					$(this).prop('checked', false);
					nearbyStoresInput.val(function(index, value) {
						return value.replace(thisStoreID, '');
					});

					digitalData.eventData = {
						branchName: $(this).parent().data("branch-name")
					}
					try {
						_satellite.track("deselectNearbyBranch");
					} catch (e) { }
				} else {
					$(this).prop('checked', true);
					$('input[name=nearbyDisabled]').val('');
					nearbyStoresInput.val(function(index, value) {
						return this.value + ',' + thisStoreID;
					});
					if(!$(".search_nearby_enabled input").prop('checked')){
						$(".search_nearby_enabled input").prop('checked', true)
					}
					digitalData.eventData = {
						branchName: $(this).parent().data("branch-name")
					}
					try {
						_satellite.track("selectNearbyBranch");
					} catch (e) { }
				}
				nearbyStoresInput.val(cleanCSV(nearbyStoresInput.val()));
				
				if(nearbyStoresInput.val() == "" || nearbyStoresInput.val() == "#"){
					$('input[name=nearby]').prop('checked', false);
					$('input[name=nearbyDisabled]').val('on');
				}
			})	
		});


		$('.page-searchGrid form[method="get"], .page-productGrid form[method="get"]').submit(function(){
			$(this).find(':input').each(function() {
				var allInputs = $(this);
				if (!allInputs.val()) {
					allInputs.prop('disabled', true);
				}
			});
		});
		
		$('.template-pages-layout-siteOneCuratedPlpLayout form[method="get"], .template-pages-layout-siteOneCuratedPlpLayout form[method="get"]').submit(function(){
			$(this).find(':input').each(function() {
				var allInputs = $(this);
				if (!allInputs.val()) {
					allInputs.prop('disabled', true);
				}
			});
		});



		 
		
		 $(".nearby_locale").click(function(e) {
			if(!$(".js-change-branch-btn").hasClass("active")){
		    e.preventDefault(e);
			$(".nearby_more_locations").show();
			$(".nearby_locale").addClass("active");
			 return false;   
			}
			else{
				$('.nearby_more_locations').hide();
				$(".nearby_locale").removeClass("active");
			}
    	});
	},
	
	eventsNoResultsMsg:function(){
		var results = $(".eventsTotalResults").data("results");
		if(results == 0){
			$("#eventsFiltersMsg").addClass('hidden');
			$("#allEvents").addClass('hidden');
		}
	
	},
	
	filtersearch: function(){
		$('.js-facet-checkbox, .js__facet__expressShipping').change(function () {
	  	    if ($(this).is(':checked')) {
	  	    	 var spanValue = $(this).parent().find(".facet__list__text").text();
	  	    	 var spanValue2 = $(this).parent().find(".facet__list__text").text().replace(/\s+/g, "");
	  	    	 var newvalue= spanValue2.split('(');
	  	    	 var filterLabel = newvalue[0];
	  	    	 var filterlabelVal=$(this).attr("name");
	  	    	 var linkType = "";
	  	    	 if($("body").hasClass("page-productGrid")){
						var linkType= "plp-filter";
					}
	  	    	 else if($("body").hasClass("page-searchGrid")){
						var linkType= "search-filter";
					}
				 else if($('body').hasClass('template-pages-layout-siteOneCuratedPlpLayout')){
						linkType = "curated-plp filter";
				 }			 
	  	        digitalData.eventData={
						linkType:linkType,
						linkName: filterLabel,
                		onClickPageName: _AAData.pathingPageName,
	  	        		filterLabel: $(this).attr("name"),
	  					filterValue: filterLabel,
	  					filter: filterlabelVal + " | " + filterLabel						
	  			}
	  	        try {
	  			    _satellite.track("productFilter");
	  			} catch (e) {}
	  	    }
	  	});

	   	$(document.body).on('click','.namevalue',function(e){
	  		var catergoryName=$(this).text();  
		    var productFilterValue = catergoryName;
			digitalData.eventData={
					filterLabel: "Show results for",
					filterValue:productFilterValue,
					filter: "Show results for" + " | " + productFilterValue,
						}
				try {
				    _satellite.track("productFilter");
				} catch (e) {}
	  	});

		if($(".js-storeavailable-count").text()== "0"){
			$(".store-count").hide();
			$(".nearby_locale").addClass("disable-click");
		}
		if($(".js-shippingavailable-count").text()== "0"){
			$(".shipping-count").hide();
		}
	},

	categoryTiles: function (){
		let count_loop=1;	
		$(document).on("click",".category-tile-prev, .category-tile-next",function(){
		  if($("#recommendedProductBanner").length >= 1){
			let target = $("#recommendedProductBanner");
			let scrollMultiplier1 = Math.round(target.outerWidth() / target.find(".category-tile-item").outerWidth());		
			let productLen = Math.ceil((target.find('#carouselProduct').val() / scrollMultiplier1));
			
			var catTileContainer = $(this).parent(),
				tileWidth = $(this).parent().find(".category-tile-item").outerWidth(),
				scrollMultiplier = Math.round(catTileContainer.width() / tileWidth), // scroll however many tiles are displayed at current viewport width
				leftPos = $(catTileContainer).scrollLeft();
			if($(this).hasClass("category-tile-next")){
				if(count_loop<productLen){
					$(catTileContainer).animate({scrollLeft: leftPos + (tileWidth * scrollMultiplier)}, 800);
					count_loop=count_loop+1;
                }						
			} 
			else {
				$(catTileContainer).animate({scrollLeft: leftPos - (tileWidth * scrollMultiplier)}, 800);
				count_loop=count_loop-1;
			}
		  }
		  else{
			var catTileContainer = $(this).parent(),
			tileWidth = $(this).parent().find(".category-tile-item").outerWidth()-5,
			scrollMultiplier = Math.floor(catTileContainer.width() / tileWidth), // scroll however many tiles are displayed at current viewport width
			leftPos = $(catTileContainer).scrollLeft();
			if($(this).hasClass("category-tile-next")){
				$(catTileContainer).animate({scrollLeft: leftPos + (tileWidth * scrollMultiplier)}, 800);
			} else {
				$(catTileContainer).animate({scrollLeft: leftPos - (tileWidth * scrollMultiplier)}, 800);
			}
		  }
		});	
		let count_loops=1;	
		$(document).on("click",".category-tile-prevrr1, .category-tile-nextrr1",function(){
		  if($("#recommendedProductBannerrr1").length >= 1){
			let target = $("#recommendedProductBannerrr1");
			let scrollMultiplier1 = Math.round(target.outerWidth() / target.find(".category-tile-item").outerWidth());		
			let productLen = Math.ceil((target.find('#carouselProduct').val() / scrollMultiplier1));
			
			var catTileContainer = $(this).parent(),
				tileWidth = $(this).parent().find(".category-tile-item").outerWidth(),
				scrollMultiplier = Math.round(catTileContainer.width() / tileWidth), // scroll however many tiles are displayed at current viewport width
				leftPos = $(catTileContainer).scrollLeft();
			if($(this).hasClass("category-tile-nextrr1")){
				if(count_loops<productLen){
					$(catTileContainer).animate({scrollLeft: leftPos + (tileWidth * scrollMultiplier)}, 800);
					count_loops=count_loops+1;
                }						
			} 
			else {
				$(catTileContainer).animate({scrollLeft: leftPos - (tileWidth * scrollMultiplier)}, 800);
				count_loops=count_loops-1;
			}
		  }
		  else{
			var catTileContainer = $(this).parent(),
			tileWidth = $(this).parent().find(".category-tile-item").outerWidth()-5,
			scrollMultiplier = Math.floor(catTileContainer.width() / tileWidth), // scroll however many tiles are displayed at current viewport width
			leftPos = $(catTileContainer).scrollLeft();
			if($(this).hasClass("category-tile-nextrr1")){
				$(catTileContainer).animate({scrollLeft: leftPos + (tileWidth * scrollMultiplier)}, 800);
			} else {
				$(catTileContainer).animate({scrollLeft: leftPos - (tileWidth * scrollMultiplier)}, 800);
			}
		  }
		});	
		$(document).on("click",".curated-horizontal-prev, .curated-horizontal-next",function(){
			
			  var catTileContainer = $(this).parent(),
			  tileWidth = $(this).parent().find(".category-tile-item").outerWidth()-5,
			  scrollMultiplier = Math.floor(catTileContainer.width() / tileWidth), // scroll however many tiles are displayed at current viewport width
			  leftPos = $(catTileContainer).scrollLeft();
			  if($(this).hasClass("curated-horizontal-next")){
				  $(catTileContainer).animate({scrollLeft: leftPos + (tileWidth * scrollMultiplier)}, 800);
			  } else {
				  $(catTileContainer).animate({scrollLeft: leftPos - (tileWidth * scrollMultiplier)}, 800);
			  }
			
		  });		
	  

	},
	refinementmorewaystofilter: function (){
        let headerMorewaytofilters = $('.morewaytofilters').next('.facet.js-facet').length;
        if(headerMorewaytofilters == '0'  || headerMorewaytofilters == 0) {
            $('.morewaytofilters').hide();
        }
    },

	bindFiltersCount: function() {
		let selectedFiltersCount = $("#productFacets input[type='checkbox']:checked").length;
		if(selectedFiltersCount);
		$(".selFiltersCount").text(selectedFiltersCount);
	},
	nearbyInstockFilterSection: function(){
		$(document).on("click","#instockcheckbox",function(e){
		   ACC.refinements.inStockfilter = $(this).prop('checked');
		   if(ACC.refinements.inStockfilter == true && ACC.mystores.inStockFilterflag == false){
			ACC.mystores.inStockFilterflag = true;
		   }
		   else{
			if($(".pagename").val() == 'Product Details'){
				ACC.mystores.inStockFilterflag = true;
			}else{
			ACC.mystores.inStockFilterflag = false;
		   }
		}
		ACC.mystores.changeBranchPopupCall();
		  
        });
	}
	
	
};
ACC.adobelinktracking = {

	_autoload: [
		"linkClicks",
	],

linkClicks : function(){
        $(document.body).on('click','.article-learn-more-btn, a',function(e){
			let ref = $(this);
			let globalHeaderBtn = ref.data("global-linkname");
			if(!globalHeaderBtn || globalHeaderBtn == ""){
        	if(digitalData.pfm)
        	{
        	  delete digitalData.pfm;
        	  delete digitalData.pfmdetails;
        	}
            var pageName= $(".pagename").val();
            var onClickPageName= $(".siteonepagename").val();
            var aClick = $(this);
            if(aClick.is("a") && aClick.find("img").length > 0){
				if (pageName == 'Calculator Landing Page') {
                    let calciIdentifier = aClick.attr("href").split('/').slice(-1)[0];
                    if (calciIdentifier == 'stonewalls') {
                        $(this).find('img').attr("alt", 'Stone Walls Calculator')
                    }
                    else if (calciIdentifier == 'flagstone') {
                        $(this).find('img').attr("alt", 'Flagstone Calculator')
                    }
                    else if (calciIdentifier == 'roadbasefill') {
                        $(this).find('img').attr("alt", 'Road Base Calculator')
                    }
                    else if (calciIdentifier == 'barkmulch') {
                        $(this).find('img').attr("alt", 'Bark Mulch Calculator')
                    }
                    else if (calciIdentifier == 'decorativerock') {
                        $(this).find('img').attr("alt", 'Decorative Rock Calculator')
                    }
                    else if (calciIdentifier == 'topsoil') {
                        $(this).find('img').attr("alt", 'Topsoil Fill Calculator')
                    } else {
                        $(this).find('img').attr("alt", 'No Calculator')
                    }
                }
                //var linkName="img/banner";

				var Alt_text = $(this).find('img').attr("alt");
                if(Alt_text !== "") {
                    var linkName = Alt_text;
                }else{
                    var linkName = "img/banner";
                }
                
                if($(this).hasClass("recomm-analytics")){
                    digitalData.pfm = "recommendation";
                    digitalData.pfmdetails = _AAData.page.pageName;
                }
                if($(this).hasClass("recom-popup-tiles")){
                    digitalData.pfm = "recommendation";
                    digitalData.pfmdetails = "checkout: item added to cart popup";
                }
            }
            else if($(this).hasClass("recomm-analytics")){
            	if($(this).hasClass("recomm-multivar"))
            		{
            			var linkName=$(this).text().trim();
            		}
            	else
            		{
            			var linkName= "product:" + $(this).attr('title'); 
            			
            			digitalData.pfm = "recommendation";
            			digitalData.pfmdetails = _AAData.page.pageName;
            		}
				
			}
            else{
                if($(this).text())
                	
                {
                	var linkName=$(this).text().trim();
                	if(ACC.global.productCutatedplpPagination){
                		var linkName="pagination:"+$(this).text().trim();
                	}
                }
                else
                {
                    var linkName=$(this).attr('title'); 
                }
            }
            if($(this).hasClass("arrow-guest")){
            	var linkName= "guest checkout";
            }
            
			if($(this).closest("ul").hasClass("pagination")){
				 if(ACC.global.productCutatedplpPagination){
					 var linkType= "product-grid";
					 onClickPageName = pageName;
				 }else{
					 var linkType= "pagination";
				 }
				
			}
			else if($(this).hasClass("js-related-article")){
				var linkType= "related articles";
			}
			else if($(this).hasClass("js-more-article-btn")){
				var linkType= "more content"; 
			}
			else if($(this).hasClass("recomm-analytics")){
				var linkType= "recommendation"; 
			}
            else if($(this).hasClass("quickbook_btn")){
            	var linkName= "connect-to-quickbooks"; 
            	var linkType= "invoice-links";
            	onClickPageName = pageName;
            }
            else if($(this).hasClass("payonline_btn")){
            	var linkName= "pay-bill";
            	var linkType= "invoice-links";
            	onClickPageName = pageName;
            }
            else if(ACC.global.productCutatedplpLink){
                var linkName= curatedplpLinkName;
                var linkType = CutatedplpName;
                onClickPageName = pageName;
            }
			else if($(this).hasClass("mini-cart-link")){
				var linkType= "cart-icon";
				}
			else if($(this).hasClass("linktracking-breadcrumb")){
				var linkType= "breadcrumb";
				}	
			else if($(this).hasClass("linktracking-product") && $("body").hasClass("page-productGrid")){
				var linkType= "plp";
				}
			else if($(this).hasClass("linktracking-product") && $("body").hasClass("page-searchGrid")){
				var linkType= "search-results-listing-page";
				}		
			else if($(this).parents(".linktracking-header").length){
				var linkType= "header-link";
			}
			else if($(this).parents(".linktracking-footer").length){
			var linkType= "footer-link";
			}
			else if($(this).hasClass("js-cart-linktracking")){
			var linkType= "cart-page";
			}
			
			else{
				var linkType= "";
			}
			
			if($(this).hasClass("accept-delay")){
            	var linkName= "accept delay";
            }
			if($(this).hasClass("dontaccept-delay")){
            	var linkName= "decline delay";
            }
			if($(this).hasClass("article-learn-more-btn")){
				var linkType= "article-link";
            	var linkName= "learn more";
            }
            digitalData.eventData={
				linktype:linkType,
                linkName: linkName,
                onClickPageName:onClickPageName
            }
            try {
				      if($(this).closest("ul").hasClass("ui-autocomplete")===false){
      					_satellite.track("linkClicks");
      				}
				      if($(this).hasClass("dontaccept-delay")){
				    	  _satellite.track('nearbyDecline')
				      }
				      else if($(this).hasClass("accept-delay")){
				    	  _satellite.track('nearbyAcceptance')
						}
            } catch (e) {}
		}
        });

    },
	approveOrder: function(ref, linkType, linkName, pageName, comment){
			if($(ref).hasClass("disabled")) return;
			let commentText = (comment)? $("#cboxContent .comment-modal #comments").val() : "";
	
			digitalData.eventData={
				linktype: linkType,
				linkName: linkName + commentText,
				onClickPageName: pageName
			}
			_satellite.track("linkClicks");
		},
	requestQuote: function(ref, linkType, linkName, pageName) {
		let linkText = (linkName && linkName != "") ? ": " + linkName : "";
		digitalData.eventData = {
			linktype: linkType,
			linkName: 'request a quote' + linkText,
			onClickPageName: pageName
		}
		try {
			_satellite.track("linkClicks");
		} catch (e) { }
		if (linkName == "") {
			_AAData.page.pageName = "my account : lists: request a quote popup";
			_AAData.pathingChannel = "my account";
			_AAData.pathingPageName = "my account : lists: request a quote popup";
			try {
				_satellite.track('pageload');
			} catch (e) { }
		}
	},
	requestQuotePLP: function(ref, linkType, linkName, pageName, flagfullPagepath) {
		let linkText = (linkName && linkName != "") ? ": " + linkName : "";
		digitalData.eventData = {
			linktype: linkType,
			linkName: 'Request a Quote' + linkText,
			onClickPageName: (flagfullPagepath == 'true') ? $(".siteonepagename").val() : pageName
		}
		try {
			_satellite.track("linkClicks");
		} catch (e) { }
		if (linkName == "") {
			_AAData.page.pageName = pageName +": request a quote popup";
			_AAData.pathingChannel = "products";
			_AAData.pathingPageName = pageName +": request a quote popup";
			try {
				_satellite.track('pageload');
			} catch (e) { }
		}
	},
	
	quotesView: function(linkType, linkName, pageName) {
		digitalData.eventData = {
			linktype: linkType,
			linkName: linkName,
			onClickPageName: (pageName == 'pageName') ? _AAData.pathingPageName : pageName
		}
		_AAData.companyID = $("#parentUnitId").val();
		try {
			_satellite.track("linkClicks");
		} catch (e) { }
	},
	
	cartCsvUpload: function(linkName, linkType, onClickPageName, pageName, popupChannel, popupPageName) {
		if (onClickPageName && onClickPageName != "") {
			digitalData.eventData = {
				linkName: linkName,
				linktype: linkType,
				onClickPageName: onClickPageName
			}
			try {
				_satellite.track("linkClicks");
			} catch (e) { }
		}
		if (pageName && pageName != "") {
			_AAData.page.pageName = pageName;
			_AAData.pathingChannel = popupChannel;
			_AAData.pathingPageName = popupPageName;
			_AAData.popupChannel = popupChannel;
			_AAData.popupPageName = popupPageName;
			try {
				_satellite.track('popupView');
			} catch (e) { }
		}
	}
};
ACC.ga4analytics = {
	
	_autoload: [
		"bindSelectItemEvent",
		"bindSearchEvent"
	],
	
	bindSelectItemEvent: function() {
		$(document).on("click", ".product-item-box a.thumb, .product-item-box a.name, .product-item-box a.js-click-tracking, .product-item-box .atc-variant-button a", function(e){
			var parentTarget = $(this).parents(".product-item-box");
			
			ACC.ga4analytics.findAndPushSelectEventData(parentTarget);
		});
		
		$(document).on("click", ".category-tile-item .atc-variant-button a", function(e) {
			var parentTarget = $(this).parents(".category-tile-item");
			
			ACC.ga4analytics.findAndPushSelectEventData(parentTarget);
		});
	},
	findAndPushSelectEventData: function(ref) {
		var code = ref.find("#ga4-productCode").val();
		var name = ref.find("#ga4-productName").val();
		var brand_name = ref.find("#ga4-brandName").val();
		var level1_category = ref.find("#ga4-categoryLeve1").val();
		var level2_category = ref.find("#ga4-categoryLeve2").val();
		var level3_category = ref.find("#ga4-categoryLeve3").val();
		var multidimensional = ref.find("#ga4-multidimensional").val();
		
		var price = 0;
		
		if(ga4analytics.isloggedin && multidimensional == "false") {
			var priceText = ref.find(".csp-price-format").find(".check_price").text().trim().replace('$','').replaceAll(',','');
			
			if(priceText.length){
				price = parseFloat(priceText);
			}
		}
		
		ACC.ga4analytics.select_item(code,name,price,brand_name,level1_category,level2_category,level3_category);
	},
	bindSearchEvent: function() {
		$(document).on("submit", "#searchBox", function(e){
			var search_term = $('#js-site-search-input').val();
			ACC.ga4analytics.search(search_term);
		});		
	},
	checkNotEmpty: function(val) {
		if(typeof val === 'string'){
			return val.length > 0;
		}
		return val != null;
	},
	generate_item_payload: function(code,name,price,brand_name,level1_category,level2_category,level3_category) {
		var item = {};
		if(ACC.ga4analytics.checkNotEmpty(code)) {
			item.item_id = code;
		}
		if(ACC.ga4analytics.checkNotEmpty(name)) {
			item.item_name = name;
		}
		if(ACC.ga4analytics.checkNotEmpty(price)) {
			item.price = price;
		}
		if(ACC.ga4analytics.checkNotEmpty(brand_name)) {
			item.item_brand = brand_name;
		}

		if(ACC.ga4analytics.checkNotEmpty(level1_category)) {
			item.item_category= level1_category;
		}

		if(ACC.ga4analytics.checkNotEmpty(level2_category)) {
			item.item_category2 = level2_category;
		}

		if(ACC.ga4analytics.checkNotEmpty(level3_category)) {
			item.item_category3 = level3_category;
		}

		return item;
	},
	generate_cart_item_payload: function (index, entryParent) {
		var target = $(entryParent + '.retail-your-price-section .atc-price-analytics').eq(index);
		var targetVal = 0;
		try {
			targetVal = (target.length && target.text() && target.text() != "") ? target.text() : '0.0';
			targetVal = parseFloat(targetVal.replace('$','').replaceAll(',',''));
		} catch (e) {
			targetVal = 0;
		}
		return Object.assign({},
   			{
				'quantity' : parseInt(ACC.ga4analytics.valueCheck('#productQty', index,'1'))
			},
			ACC.ga4analytics.generate_item_payload(
				ACC.ga4analytics.valueCheck('#productCode', index,''),
				ACC.ga4analytics.valueCheck('#productName', index,''),
				targetVal,
				ACC.ga4analytics.valueCheck('#productBrand', index,''),
				ACC.ga4analytics.valueCheck('#productCategory', index,''),
				ACC.ga4analytics.valueCheck('#productSubCategory', index,''),
				ACC.ga4analytics.valueCheck('#productLevel3Category', index,'')
			)
		);
	},
	valueCheck: function (target,index,defaultVal) { 
		return ($(target + index).length && $(target + index).val() != "") ? $(target + index).val() : defaultVal;
	},
	login: function() {
		dataLayer.push({
			'event': 'login',
			'account_classification': ga4analytics.account_classification,
		});
	},
	search: function(searchText) {
		if(ACC.ga4analytics.checkNotEmpty(searchText)) {
			dataLayer.push({
				'event': 'search',
				'search_term': searchText,
				'visitor_status_evar': ga4analytics.visitor_status,
				'account_classification': ga4analytics.account_classification
			});
		}
	},
	view_item: function(code,name,price,brand_name,level1_category,level2_category,level3_category) {
		if(
			ACC.ga4analytics.checkNotEmpty(code) && 
			ACC.ga4analytics.checkNotEmpty(name) &&
			ACC.ga4analytics.checkNotEmpty(price)
		) {
			var item = ACC.ga4analytics.generate_item_payload(code,name,price,brand_name,level1_category,level2_category,level3_category);
			
			dataLayer.push({ ecommerce: null });
			dataLayer.push({
				'event': 'view_item',
				'visitor_status_evar': ga4analytics.visitor_status,
				'account_classification': ga4analytics.account_classification,
				'value': price,
				'ecommerce': {
					'currency': ga4analytics.currency,
					'items': [item]				
				}
			});
		}
	},
	view_item_list: function(items) {
		if((items || []).length) {
			dataLayer.push({ ecommerce: null });
			dataLayer.push({
				'event': 'view_item_list',
				'visitor_status_evar': ga4analytics.visitor_status,
				'account_classification': ga4analytics.account_classification,
				'ecommerce': {
					'currency': ga4analytics.currency,
					'items': items			
				}
			});
		}
	},
	add_to_cart: function(code,name,price,quantity,brand_name,level1_category,level2_category,level3_category) {
		if(
			ACC.ga4analytics.checkNotEmpty(code) && 
			ACC.ga4analytics.checkNotEmpty(name) &&
			ACC.ga4analytics.checkNotEmpty(price)
		) {
			var item = Object.assign({},
	   			{
					'quantity' : parseInt(quantity),
				},
				ACC.ga4analytics.generate_item_payload(code,name,price,brand_name,level1_category,level2_category,level3_category)
			);

			dataLayer.push({ ecommerce: null });
			dataLayer.push({
				'event': 'add_to_cart',
				'visitor_status_evar': ga4analytics.visitor_status,
				'account_classification': ga4analytics.account_classification,
				'value': parseFloat(price) * parseInt(quantity),
				'ecommerce': {
					'currency': ga4analytics.currency,
					'items': [item]				
				}
			});
		}
	},
	begin_checkout: function(items,total_cart_value) {
		if((items || []).length && (total_cart_value > 0)) {
			dataLayer.push({ ecommerce: null });
			dataLayer.push({
				'event': 'begin_checkout',
				'visitor_status_evar': ga4analytics.visitor_status,
				'account_classification': ga4analytics.account_classification,
				'value': total_cart_value,
				'ecommerce': {
					'currency': ga4analytics.currency,
					'items': items			
				}
			});
		}
	},
	purchase: function(items,transaction_id,total_cart_value,tax,shipping,coupon) {
		if((items || []).length && (total_cart_value > 0)) {

			dataLayer.push({ ecommerce: null });
			dataLayer.push({
				'event': 'purchase',
				'visitor_status_evar': ga4analytics.visitor_status,
				'account_classification': ga4analytics.account_classification,
				'ecommerce': {
					'currency': ga4analytics.currency,
					'transaction_id': transaction_id,
					'value': total_cart_value,
					'tax': tax,
				    'shipping': shipping,
				    'coupon': coupon,
					'items': items			
				}
			});
		}
	},
	select_item: function(code,name,price,brand_name,level1_category,level2_category,level3_category) {
		if(
			ACC.ga4analytics.checkNotEmpty(code) && 
			ACC.ga4analytics.checkNotEmpty(name) &&
			ACC.ga4analytics.checkNotEmpty(price)
		) {
			var item = ACC.ga4analytics.generate_item_payload(code,name,price,brand_name,level1_category,level2_category,level3_category);
			
			dataLayer.push({ ecommerce: null });
			dataLayer.push({
				'event': 'select_item',
				'visitor_status_evar': ga4analytics.visitor_status,
				'account_classification': ga4analytics.account_classification,
				'value': price,
				'ecommerce': {
					'currency': ga4analytics.currency,
					'items': [item]				
				}
			});
		}
	},
};
ACC.silentorderpost = {

	spinner: $("<img src='" + ACC.config.commonResourcePath + "/images/spinner.gif' />"),

	bindUseDeliveryAddress: function ()
	{
		$('#useDeliveryAddress').on('change', function ()
		{
			if ($('#useDeliveryAddress').is(":checked"))
			{
				var options = {'countryIsoCode': $('#useDeliveryAddressData').data('countryisocode'), 'useDeliveryAddress': true};
				ACC.silentorderpost.enableAddressForm();
				ACC.silentorderpost.displayCreditCardAddressForm(options, ACC.silentorderpost.useDeliveryAddressSelected);
				ACC.silentorderpost.disableAddressForm();
			}
			else
			{
				ACC.silentorderpost.clearAddressForm();
				ACC.silentorderpost.enableAddressForm();
			}
		});

		if ($('#useDeliveryAddress').is(":checked"))
		{
			var options = {'countryIsoCode': $('#useDeliveryAddressData').data('countryisocode'), 'useDeliveryAddress': true};
			ACC.silentorderpost.enableAddressForm();
			ACC.silentorderpost.displayCreditCardAddressForm(options, ACC.silentorderpost.useDeliveryAddressSelected);
			ACC.silentorderpost.disableAddressForm();
		}
	},

	bindSubmitSilentOrderPostForm: function ()
	{
		$('.submit_silentOrderPostForm').on('click',function  ()
		{
			ACC.common.blockFormAndShowProcessingMessage($(this));
			$('.billingAddressForm').filter(":hidden").remove();
			ACC.silentorderpost.enableAddressForm();
			$('#silentOrderPostForm').submit();
		});
	},

	bindCycleFocusEvent: function ()
	{
		$('#lastInTheForm').blur(function ()
		{
			$('#silentOrderPostForm [tabindex$="10"]').focus();
		})
	},

	isEmpty: function (obj)
	{
		if (typeof obj == 'undefined' || obj === null || obj === '') return true;
		return false;
	},

	disableAddressForm: function ()
	{
		$('input[id^="address\\."]').prop('disabled', true);
		$('select[id^="address\\."]').prop('disabled', true);
	},

	enableAddressForm: function ()
	{
		$('input[id^="address\\."]').prop('disabled', false);
		$('select[id^="address\\."]').prop('disabled', false);
	},

	clearAddressForm: function ()
	{
		$('input[id^="address\\."]').val("");
		$('select[id^="address\\."]').val("");
	},

	useDeliveryAddressSelected: function ()
	{
		if ($('#useDeliveryAddress').is(":checked"))
		{
			$('#address\\.country').val($('#useDeliveryAddressData').data('countryisocode'));
			ACC.silentorderpost.disableAddressForm();
		}
		else
		{
			ACC.silentorderpost.clearAddressForm();
			ACC.silentorderpost.enableAddressForm();
		}
	},
	
	

	bindCreditCardAddressForm: function ()
	{
		$('#billingCountrySelector :input').on("change", function ()
		{
			var countrySelection = $(this).val();
			var options = {
				'countryIsoCode': countrySelection,
				'useDeliveryAddress': false
			};
			ACC.silentorderpost.displayCreditCardAddressForm(options);
		})
	},

	displayCreditCardAddressForm: function (options, callback)
	{
		$.ajax({ 
			url: ACC.config.encodedContextPath + '/checkout/multi/sop/billingaddressform',
			async: true,
			data: options,
			dataType: "html",
			beforeSend: function ()
			{
				$('#billingAddressForm').html(ACC.silentorderpost.spinner);
			}
		}).done(function (data)
				{
					$("#billingAddressForm").html(data);
					if (typeof callback == 'function')
					{
						callback.call();
					}
				});
	}
}

$(document).ready(function ()
{
	with (ACC.silentorderpost)
	{
		bindUseDeliveryAddress()
		bindSubmitSilentOrderPostForm();
		bindCreditCardAddressForm();
	}

	// check the checkbox
	$("#useDeliveryAddress").click();
});
ACC.tabs = {

	_autoload: [
		["bindTabs", $(".js-tabs").length > 0],
		"hideReviewBtn",
		"determineToDisplayReviews"
	],

	bindTabs: function(){

		$e = $(".js-tabs");
		 var tabs = $e.accessibleTabs({
			tabhead:'.tabhead',
			tabbody: '.tabbody', 
			fx:'show', 
			fxspeed: 0,
			currentClass: 'active', 
			autoAnchor:true
		});


		$e.on("click",".tabhead",function(e){
			e.preventDefault();

			if($(this).hasClass("active")){
				$(this).removeClass("active");
			}else{
				$(this).parents(".js-tabs").children(".tabs-list").find("a[href="+"#"+$(this).attr("id")+"]").trigger('click');

				var offset = $(this).position().top;
				$("body,html").scrollTop(offset)
			}
			
		});
		
		$e.on("click","#tabreview",function(e){
			e.preventDefault();
			ACC.tabs.showReviewsAction("reviews");
		});
		
		$e.on("click",".all-reviews-btn",function(e){
			e.preventDefault();
			ACC.tabs.showReviewsAction("allreviews");
			ACC.tabs.hideReviewBtn(".all-reviews-btn");
			ACC.tabs.showReviewBtn(".less-reviews-btn");
		});
		
		$e.on("click",".less-reviews-btn",function(e){
			e.preventDefault();
			ACC.tabs.showReviewsAction("reviews");
			ACC.tabs.hideReviewBtn(".less-reviews-btn");
			ACC.tabs.showReviewBtn(".all-reviews-btn");
		});
		
		$(document).on("click", '.js-writeReviewTab', function(e){
			e.preventDefault();
			tabs.showAccessibleTabSelector($(this).attr("href"));
			$(".js-review-write").show();
			$('#reviewForm input[name=headline]').focus();
		});
		
		$(document).on("click",".js-review-write-toggle",function(e){
			e.preventDefault();
			if($(".js-review-write:visible").length<1){
				$(".js-review-write").show();

			}else{
				$(".js-review-write").hide();
			}		
		});

		$(document).on("click",".js-openTab",function(){
            tabs.showAccessibleTabSelector($(this).attr("href")); 
		})
	
	},
	
	showReviewsAction: function (s)
	{
		$.get($("#reviews").data(s), function (result){
			$('#reviews').html(result);
			if($(".js-ratingCalc").length > 0){
				ACC.ratingstars.bindRatingStars();
				ACC.tabs.showingAllReviews();
			}
		});
		
	},
	
	hideReviewBtn: function (btnClass){

		btnClass = (btnClass == undefined)? ".less-reviews-btn" : btnClass;
		$(btnClass).hide();
		
	},
	
	showReviewBtn: function (btnClass){
		$(btnClass).show();

	},
	
	showingAllReviews: function()
	{
		var isShowingAllReviews = $("#showingAllReviews").data("showingallreviews");
		if(isShowingAllReviews){
			ACC.tabs.hideReviewBtn(".all-reviews-btn");
		}
	},
	
	determineToDisplayReviews: function ()
	{
		if(location.hash == "#tabreview"){
			ACC.tabs.showReviewsAction('reviews');
		}
	},

};
ACC.termsandconditions = {

	bindTermsAndConditionsLink: function() {
		$(document).on("click",".termsAndConditionsLink",function(e) {
			e.preventDefault();
			$.colorbox({
				maxWidth:"100%",
				maxHeight:"80%",
				width:"870px",
				scrolling:true,
				href: $(this).attr("href"),
				close:'<span class="glyphicon glyphicon-remove"></span>',
				title:'<div class="headline"><span class="headline-text">Terms and Conditions</span></div>',
				onComplete: function() {
					ACC.common.refreshScreenReaderBuffer();
				},
				onClosed: function() {
					ACC.common.refreshScreenReaderBuffer();
				}
			});
		});
	}
}

$(function(){
	with(ACC.termsandconditions) {
		bindTermsAndConditionsLink();
	}
});
ACC.track = {
	trackAddToCart: function (productCode, quantity, cartData)
	{
		//commenting this to remove js issues in cart
		/*window.mediator.publish('trackAddToCart',{
			productCode: productCode,
			quantity: quantity,
			cartData: cartData
		});*/
	},
	trackRemoveFromCart: function(productCode, initialCartQuantity)
	{
		/*window.mediator.publish('trackRemoveFromCart',{
			productCode: productCode,
			initialCartQuantity: initialCartQuantity
		});*/
	},

	trackUpdateCart: function(productCode, initialCartQuantity, newCartQuantity)
	{
		/*window.mediator.publish('trackUpdateCart',{
			productCode: productCode,
			initialCartQuantity: initialCartQuantity,
			newCartQuantity: newCartQuantity
		});*/
	},
	

};
ACC.storefinder = {

	_autoload: [
		["init", $(".js-store-finder").length != 0],
		["bindStoreChange", $(".js-store-finder").length != 0],
		["bindSearch", $(".js-store-finder").length != 0],
		["bindSearchCurrentLocation", $(".js-store-finder").length != 0],
		"bindPagination",
		["initGoogleMap", $('#User_Agent').val()!="SiteOneEcomApp"],
		"bindToStoreFinderFooterForm",
		"removeMyStore",
		["bindStoreDetails" , $("#store_details").length != 0],
		"bindCurrentLocation",
		"bindStoreStatusForMyStores",
		"storeNumberCss",
		"clickGetDirectionsLink",
		"bindBackButton",
		"makeMyBranchClick",
		"bindSpecialtyStoreList",
		"adjustSelectBoxLocations",
		"hideSpecialtiesOption"
		
	],
	storeData:"",
	storeDataTemp:{},
	storeId:"",
	coords:{},
	storeSearchData:{},
	sourceLatitude:"",
	sourceLongitude:"",
	specialties: [],
	
	makeMyBranchClick: function()
	{
		$(document.body).on("click",".makeMyStore",function(e)
		{
			var namestore = $(this).parents(".list__entry").find(".store-city").text();
			var storedetail = namestore.split('#');
			var id = storedetail[1];
			var name = storedetail[0];
			var storeName = id + " : " + name ;
			digitalData.eventData={
						branch: storeName
						}
				console.log("digitalData" + JSON.stringify(digitalData));
				try {
				    _satellite.track("makeMyBranchClick");
				} catch (e) {}
		});
	},
	
	createListItemHtml: function (data,id,searchText,selectedMiles,isStoreSpeciality,lat,lng,j){
        var index=id+1;
		var item="";
		var cscStore = $.cookie("csc");
		var storeSpecialityNumberColorMap = { 0: "green-circle", 1: "blue-circle", 2:"gray-circle" }
		
		var searchInput = $(".js-store-finder-search-input").val();
		if(data.isPreferredStore.toString() == "false" && (jQuery.inArray(data.storeId , mystoreIdListData)==-1) && cscStore != data.storeId ){
		item+='<li class="list__entry">';
		}
		else{
			item+='<li class="list__entry list-bg">';
		}
		item+='<label for="store-filder-entry-'+id+'" class="js-select-store-label branch-card">';
		var mystoreIdListData = null;
		
		if(null != $("#myStoresIdList").val() && $("#myStoresIdList").val() != "")
		{

			mystoreIdListData = JSON.parse($("#myStoresIdList").val());
		}
		item+='<div class="row col-md-12 col-xs-12">'
		if(data.isPreferredStore.toString() == "false" && (jQuery.inArray(data.storeId , mystoreIdListData)==-1) && cscStore != data.storeId){
			item+='<div class="branch-index-img" style="background-image: url(/_ui/responsive/theme-lambda/images/index-grey.png); background-size: cover;"><span class="branch-index" style="color: #5a5b5d">'+index+'</span></div>'
		}
		else{
			item+='<div class="branch-index-img" style="background-image: url(/_ui/responsive/theme-lambda/images/index-green.png); background-size: cover;"><span class="branch-index" style="color: #fff">'+index+'</span></div>'
		}
		if(data.enableOnlineFulfillment === true || data.enableOnlineFulfillment === "true"){
			item+='</div><div class="row col-md-12 col-xs-12 branch-row"><span class="branch-row-right">';
			if(data.isPreferredStore.toString() == "false" && jQuery.inArray(data.storeId , mystoreIdListData) != -1)
			{
				item+='<form method="get" action="'+ACC.config.encodedContextPath+'/store-finder/make-my-store/' + data.storeId + '"><input type="submit" value="'+ACC.config.makeMyBranch+'" class="makeMyStore branch-margin remove-decoration bg-transparent border-none"></form>';
			}
			if(data.isPreferredStore.toString() == "false" && (jQuery.inArray(data.storeId , mystoreIdListData)==-1) && cscStore != data.storeId)
			{
				item+='<form method="get" action="'+ACC.config.encodedContextPath+'/store-finder/make-my-store/' + data.storeId + '"><input type="submit" value="'+ACC.config.makeMyBranch+'" class="makeMyStore branch-margin remove-decoration bg-transparent border-none"></form>';
			}
			item+='</div><div class="row col-md-12 col-xs-12 branch-row1"><span class="branch-row-right">';
			
			if(data.isPreferredStore.toString() == "true" || cscStore == data.storeId)
			{
				item+='<div class="my-branch">'+ACC.config.myBranch+'</div>';
			}
			else if(jQuery.inArray(data.storeId , mystoreIdListData) != -1)
			{
				item+='<div class="my-branch">'+ACC.config.savedBranch+'</div>';
			}
			if(!(data.isPreferredStore.toString() == "false" && (jQuery.inArray(data.storeId , mystoreIdListData)==-1) && cscStore != data.storeId))
			{
				item+='<a href="#" id="removeStore" data-store-id="' + data.storeId + '" data-name="' + data.name + '" data-line1="' + (isStoreSpeciality?data.address.line1:data.line1) + '" data-line2="' + (isStoreSpeciality?data.address.line2:data.line2) +
				'" data-town="' + (isStoreSpeciality?data.address.town:data.town) + '" data-region-code="' + (isStoreSpeciality?data.address.region.isocodeShort:data.regionCode) + '" data-postal-code="' + (isStoreSpeciality?data.address.postalCode:data.postalCode) + '""  class="branch-margin remove-decoration">'+ ACC.config.removeMyBranch +'</a></div>';
			}
			item+='</span></div>';
		}
		item+='<div class="row col-md-12 col-xs-12 branch-row2"><span class="branch-row-right"><span>'
		if(!isStoreSpeciality || (isStoreSpeciality && (null != data.formattedDistance && data.formattedDistance != "")))
		{
		item+='<span>'+data.formattedDistance.toLowerCase()+'</span><BR></span>';
		}
		if((isStoreSpeciality && (lat != undefined && lat != "" && lng != "" && lng != undefined)) ||  (!isStoreSpeciality && (ACC.storefinder.coords.latitude != undefined && ACC.storefinder.coords.longitude != undefined)))
		{
			item+='<span class="branch-direction"><a href="https://www.google.com/maps?hl=en&saddr='+(isStoreSpeciality? lat+' '+lng+'&daddr='+data.address.line1+' '+data.address.town+' '+ data.address.region.isocodeShort + ' '+ data.address.postalCode : ACC.storefinder.coords.latitude+' '+ACC.storefinder.coords.longitude+'&daddr='+data.line1+' '+data.line2+' '+data.town+' '+ data.regionCode + ' '+ data.postalCode) + '" target="_blank" style="text-decoration: none;">'+ACC.config.directions+'</a></span><div class="hidden-md hidden-lg visible-xs visible-sm"><br/></div>';
	    }
		
		else
		{
			item+='<span class="branch-direction"><a href="https://www.google.com/maps?hl=en&daddr='+(isStoreSpeciality?data.address.line1+' '+data.address.town+' '+ data.address.region.isocodeShort + ' '+ data.address.postalCode: data.line1+' '+data.line2+' '+data.town+' '+ data.regionCode + ' '+ data.postalCode) + '" target="_blank" style="text-decoration: none;">'+ACC.config.directions+'</a></span><div class="hidden-md hidden-lg visible-xs visible-sm"><br/></div>';
		}
		item+='</span></div>';
		item+='<span class="entry__info">';
		
		if(searchInput == null || searchInput == '' || searchInput== undefined)
		{
			if(data.isPreferredStore.toString() == "false" && (jQuery.inArray(data.storeId , mystoreIdListData)==-1) && cscStore != data.storeId)
			{
				if(!isStoreSpeciality)	{
					if(null != data.title && data.title != "")
				        item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId + (isStoreSpeciality?'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> ':'/"> ')+data.name+ '</span></span> <span class="branch-card-entry-name"> '+data.title+' </span></a>'+'<div class="hidden-md hidden-lg hidden-sm cl"></div>';
					else
						item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId + (isStoreSpeciality?'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> ':'/"> ')+data.name+ '</span></span></a>'+'';
				}
				else{
					if(null != data.title && data.title != "")
				        item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId + (isStoreSpeciality?'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> ':'/"> ')+data.name+ '</span></span> </a>'+'<div class="hidden-md hidden-lg hidden-sm cl"></div>';
					else
						item+='<span class="entry__city">  <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId + (isStoreSpeciality?'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> ':'/"> ')+data.name+ '</span></span></a>'+'';
				}
			}
			else
			{
				data.showGreenIcon = true;
				if(!isStoreSpeciality)	{
					if(null != data.title && data.title != "")
					     item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId +(isStoreSpeciality?'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> ': '/"> ')+data.name+ ' </span></span> <span class="branch-card-entry-name"> '+data.title+' </span></a>'+'';
					else
						item+='<span class="entry__city"> <span class="number-circle green-circle">'+index+'</span> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId +(isStoreSpeciality?'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> ': '/"> ')+data.name+ ' </span></span></a>'+'';
				}
			else{
				if(null != data.title && data.title != "")
					     item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId +(isStoreSpeciality?'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> ': '/"> ')+data.name+ ' </span></span></a>'+'';
					else
						item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId +(isStoreSpeciality?'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> ': '/"> ')+data.name+ ' </span></span></a>'+'';
			
				
				}
			}
		}
		else
		{
		  if(!isStoreSpeciality)	{
			if(data.isPreferredStore.toString() == "false" && (jQuery.inArray(data.storeId , mystoreIdListData)==-1) && cscStore != data.storeId)
			{
					if(null != data.title && data.title != "")
				        item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'"href="'+ACC.config.encodedContextPath+'/store/' + data.storeId +'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> '+data.name+ '</span></span> <span class="branch-card-entry-name"> '+data.title+' </span></a>'+'<div class="hidden-md hidden-lg hidden-sm cl"></div>';
					else
						item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId +'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> '+data.name+ '</span></span></a>'+'';
	
			}
			else
			{
					data.showGreenIcon = true;
					if(null != data.title && data.title != "")
					     item+='<span class="entry__city"> <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId +'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> '+data.name+ ' </span></span> <span class="branch-card-entry-name"> '+data.title+' </span></a>'+'';
					else
						item+='<span class="entry__city">  <span class="store-city"><a class="store-name" title="'+data.name+'" href="'+ACC.config.encodedContextPath+'/store/' + data.storeId +'/?searchtext='+searchText+'&miles='+selectedMiles+ '"> '+data.name+ ' </span></span></a>'+'';
			}
		  }
			
		}
		
		if(data.enableOnlineFulfillment === false || data.enableOnlineFulfillment === "false"){
			item+='<div class="row col-md-12 col-xs-12 m-b-10 m-t-10"><span class="inBranchShoppingOnly">'+ACC.config.branchShopping+'</span></div>';
		}
		item+='<span class="col-md-12 col-xs-12 entry__address small-text p-l-0">'+(isStoreSpeciality?data.address.line1:data.line1+' '+data.line2)+'</span>';
		item+='<span class="entry__city small-text">'+(isStoreSpeciality?data.address.town+ ',  ' + data.address.region.isocodeShort + '  ' +data.address.postalCode:data.town+ ',  ' + data.regionCode+ '  ' + data.postalCode) + '</span>';
		item+='<span class="entry__phone small-text"><a class="tel-phone remove-decoration" href="tel:'+(isStoreSpeciality?data.address.phone+'"> '+data.address.phone:data.phone+'"> '+data.phone)+'</a></span></br>';
		item+='<span class="'+element+' ">'+(isStoreSpeciality?data.storeStatus:status)+'</span>';
		var element = "entry__status-"+data.storeId;
		item+='<span class="'+element+' small-text" data-lat="'+(isStoreSpeciality? data.geoPoint.latitude +'" data-long="'+ data.geoPoint.longitude: data.latitude +'" data-long="'+ data.longitude) +'"></span>';
		item+='</span>';
		if(null!=data.nurseryOfferURL && data.nurseryOfferURL !="") {
			item += '<span class="view-offer-btn"><a href=' + data.nurseryOfferURL + ' target="t" onClick="" class="btn-primary btn">View Local Offers</a></span>';
		}
		if(data.storeSpecialityDetails != null){
			item+= '<div class="row col-md-12 col-xs-12 branch-row3">'
			item+= '<div onClick="ACC.storefinder.expandSpeciality(expandspeciality'+index+', expandicon'+index+', expandname'+index+', hideicon'+index+', hidename'+index+')"><img id="expandicon'+index+'" class="branch-card-expand-icon" alt="" src="/_ui/responsive/theme-lambda/images/plus-icon.svg"/><img id="hideicon'+index+'" class="branch-card-expand-icon hidden" alt="" src="/_ui/responsive/theme-lambda/images/hide-icon.svg"/></div><div id="expandname'+index+'" class="hidden-xs branch-card-expand-name">'+ACC.config.showBranchSpecialties+'</div><div id="hidename'+index+'" class="hidden-xs branch-card-expand-name hidden">'+ACC.config.hideSpecialties+'</div>';
			item+= '<div class="col-md-12 col-xs-12 branch-row4">';
			data.storeSpecialityDetails.forEach(speciality => {
				item+=  '<div><img class="branch-card-img" alt=""' +speciality.name+ '" src="' +speciality.icon+ '"/></div>';
			});
			item+= '</div></div>'
			item+= '<div class="row col-md-12 col-xs-12 expand-container hidden" id="expandspeciality'+index+'">'
			data.storeSpecialityDetails.forEach(speciality => {
				item+=  '<div class="col-md-3 col-xs-6 branch-container-item"><img class="branch-container-img" alt=""' +speciality.name+ '" src="' +speciality.icon+ '"/><span>' +speciality.name+ '</span></div>';
			});
			item+= '</div>'
		}
		item+='</label>';
		item+='</li>';
		return item;

	},

	removeMyStore: function ()
	{
		$(document).on("click","#removeStore",function(e)
		{
			e.preventDefault();
			$.cookie("csc", null, { path: '/' });
			window.location.href = ACC.config.encodedContextPath + "/store-finder/remove-my-store/" + $(this).data("storeId");
		})
	},
	
	expandSpeciality: function (expandspeciality, expandicon, expandname, hideicon, hidename)
	{
		
		if($(expandspeciality).is(":hidden")){
			$(expandspeciality).removeClass("hidden");
			$(hideicon).removeClass("hidden");
			$(hidename).removeClass("hidden");
			$(expandicon).addClass("hidden");
			$(expandname).addClass("hidden");
		}
		else{
			$(expandspeciality).addClass("hidden");
			$(hideicon).addClass("hidden");
			$(hidename).addClass("hidden");
			$(expandicon).removeClass("hidden");
			$(expandname).removeClass("hidden");
		}
	},

	refreshNavigation: function (){
		
		var listitems = "";
		data = ACC.storefinder.storeData
		var searchText = ACC.storefinder.storeSearchData.q;
		var selectedMiles = ACC.storefinder.storeSearchData.miles;
		var msg;
		  if(ACC.storefinder.storeSearchData.q != '') {
			  
				if(data.total == 1)
					{
					  	if(ACC.storefinder.storeSearchData.q == ACC.storefinder.storeData.data[0].storeId || ACC.storefinder.storeSearchData.q.toLowerCase() == ACC.storefinder.storeData.data[0].regionCode.toLowerCase() || ACC.storefinder.storeSearchData.q.toLowerCase() == ACC.storefinder.storeData.data[0].regionName.toLowerCase())
						 {
					  		msg = data.total+" " +  ACC.config.branchFound;
						 }
					  	else
					  	{
					  		msg = data.total+" " +   ACC.config.branchWithin+" " + ACC.storefinder.storeSearchData.miles+" " + ACC.config.milesOf+" " + ACC.storefinder.storeSearchData.q;
					  	}
					}
				else{
					
					if(ACC.storefinder.storeSearchData.q.toLowerCase() == ACC.storefinder.storeData.data[0].regionCode.toLowerCase() || ACC.storefinder.storeSearchData.q.toLowerCase() == ACC.storefinder.storeData.data[0].regionName.toLowerCase())
						{
						msg = data.total+" " + ACC.config.branchesFound;
						}
					else
						{
						msg = data.total+" " +   ACC.config.branchesWithin+" " + ACC.storefinder.storeSearchData.miles+" " + ACC.config.milesOf+" " + ACC.storefinder.storeSearchData.q;
						}
					
				}

			} else {
			
				if(data.total == 1)
				{
					msg = data.total+" " +  ACC.config.branchWithin+" " + ACC.storefinder.storeSearchData.miles+" " + ACC.config.miles;
				}
			else{
				msg = data.total+" " +  ACC.config.branchesWithin+" " + ACC.storefinder.storeSearchData.miles+" " + ACC.config.miles;
			    }

			}
		//$("#storeResultsMsg").html(msg);
		$(".no-Store").show();
		if(data){
			for(i = 0;i < data["data"].length;i++){
				listitems += ACC.storefinder.createListItemHtml(data["data"][i],i,searchText,selectedMiles)
			}

			$(".js-store-finder-navigation-list").html(listitems);

			// select the first store
			var firstInput= $(".js-store-finder-input")[0];
			$(firstInput).trigger('click');
			if(document.getElementById('branchlist').childElementCount > 1){
			  $('.specialties-option').removeClass("hidden");
			  $('.specialties-dropdown').removeClass("hidden");
			  $('.specialties-option').removeClass('showing').slideUp();
			}
			else{
			  $('.specialties-option').addClass("hidden");
			  $('.specialties-dropdown').addClass("hidden");
			  $('.specialties-option').removeClass('showing').slideUp();
			}
		}

	},

	bindPagination:function ()
	{

		$(document).on("click",".js-store-finder-details-back",function(e){
			e.preventDefault();

			$(".js-store-finder").removeClass("show-store");
		})

		$(document).on("click",".js-store-finder-pager-prev",function(e){
			e.preventDefault();
			var page = ACC.storefinder.storeSearchData.page;
			ACC.storefinder.getStoreData(page-1)
			checkStatus(page-1);
		})

		$(document).on("click",".js-store-finder-pager-next",function(e){
			e.preventDefault();
			var page = ACC.storefinder.storeSearchData.page;
			ACC.storefinder.getStoreData(page+1,true)
			checkStatus(page+1);
		})

		function checkStatus(page){
			if(page==0){
				$(".js-store-finder-pager-prev").attr("disabled","disabled")
			}else{
				$(".js-store-finder-pager-prev").removeAttr("disabled")
			}

			if(page == Math.floor(ACC.storefinder.storeData.total/10)){
				$(".js-store-finder-pager-next").attr("disabled","disabled")
			}else{
				$(".js-store-finder-pager-next").removeAttr("disabled")
			}
		}
	},

	bindCurrentLocation:function()
	{

		$(document).on("click","#getDirection",function(e)
		{
			if (navigator.geolocation)
			{
		          navigator.geolocation.getCurrentPosition(function(position)
		          {
		            var pos = {
		              lat: position.coords.latitude,
		              lng: position.coords.longitude
		            };
		            ACC.storefinder.sourceLatitude=pos.lat;
		            ACC.storefinder.sourceLongitude=pos.lng;

		            window.sourceLatitude=pos.lat;
		            window.sourceLongitude=pos.lng;

		            console.log('currentLocation');
			})

			}
			e.preventDefault();
			var desturl=$(this).attr("data-url");
			if("" != ACC.storefinder.sourceLatitude && "" !=  ACC.storefinder.sourceLongitude)
				var url="https://www.google.com/maps?hl=en&saddr="+sourceLatitude+","+sourceLongitude+"&daddr="+desturl;
			else
				var url="https://www.google.com/maps?hl=en"+"&daddr="+desturl;
			window.open(url,'_blank');
		});
	},

	bindStoreChange:function()
	{
		$(document).on("change",".js-store-finder-input",function(e){
			e.preventDefault();
			storeData=ACC.storefinder.storeData["data"];

			var storeId=$(this).data("id");

			var $ele = $(".js-store-finder-details");

			$.each(storeData[storeId],function(key,value){
				if(key=="image"){
					if(value!=""){
						$ele.find(".js-store-image").html('<img src="'+value+'" alt="" />');
					}else{
						$ele.find(".js-store-image").html('');
					}
				}else if(key=="productcode"){
					$ele.find(".js-store-productcode").val(value);
				}
				else if(key=="openings"){
					if(value!=""){
						var $oele = $ele.find(".js-store-"+key);
						var openings = "";
						$.each(value,function(key2,value2){
							openings += "<dt>"+key2+"</dt>";
							openings += "<dd>"+value2+"</dd>";
						});

						$oele.html(openings);

					}else{
						$ele.find(".js-store-"+key).html('');
					}

				}
				else if(key=="specialOpenings"){}
				else if(key=="features"){
					var features="";
					$.each(value,function(key2,value2){
						features += "<li>"+value2+"</li>";
					});

					$ele.find(".js-store-"+key).html(features);

				}
				else{
					if(value!=""){
						$ele.find(".js-store-"+key).html(value);
					}else{
						$ele.find(".js-store-"+key).html('');
					}
				}

			})


			ACC.storefinder.storeId = storeData[storeId];
			//ACC.storefinder.initGoogleMap();

		})

		// $(document).on("click",".js-select-store-label",function(e){
		// 	$(".js-store-finder").addClass("show-store")
		// })

		$(document).on("click",".js-back-to-storelist",function(e){
			$(".js-store-finder").removeClass("show-store")
		})

	},


	bindStoreDetails:function()
	{
		var latitude=$("#lat").attr("value");
		var longitude=$("#lng").attr("value");
		var storeId=$("#storeId").attr("value");
		var storeNotes = '';//$("#storeNotes").val();

		if(storeNotes == '')
		{
			if(latitude != undefined && longitude != undefined && storeId != '')
			{
				ACC.mystores.storeStatusApiCall(latitude, longitude, storeNotes, storeId,"#result");
			}
		}
		else if(storeNotes != '')
		{
			$('#result').html(storeNotes);
		}
		else
		{
			$('#result').html('Currently Unavailable');
		}
	},


	initGoogleMap:function(){
		if($('.js-toggle-sm-navigation').is(':visible')) {
			$('.js-store-finder-details').insertBefore('.store__finder--navigation');
		}

		if($(".js-store-finder-map").length > 0 || $("#googleMap").length > 0){
			ACC.global.addGoogleMapsApi("ACC.storefinder.loadGoogleMap");
		}
	},



	loadGoogleMap: function(isStoreSpeciality,response){
		var hardscapeStoreSpecialitites = [];
		var startIndex = 0;
		if(!isStoreSpeciality){
			if($("#googleMap").length > 0){
				ACC.storefinder.storeDetailMap();
			}
		}
		if((isStoreSpeciality && $("#hardscapegoogleMap").length > 0) || (!isStoreSpeciality && ACC.storefinder.storeData["data"])) {
			var locations = [];
			if(!isStoreSpeciality)	{
				$.each(ACC.storefinder.storeData["data"], function(key, value){
					locations.push([value.name, value.latitude, value.longitude, key,value.line1,value.line2,value.phone,value.town,value.regionCode,value.postalCode,value.PreferredStore,value.storeId]);
				});
			} else {
				var count=0;
				$.each(response, function(index, element){
					$.each(element, function( key, value ) {
					count++;
					locations.push([value.name, value.geoPoint.latitude, value.geoPoint.longitude, key,value.address.line1,value.address.line2,value.address.phone,value.address.town,value.address.region.isocodeShort,value.address.postalCode,value.isPreferredStore,value.storeId]);
					});
					hardscapeStoreSpecialitites.push([index,count]);
					if(count==0)
						startIndex = startIndex + 1;
						
				});
				
			}

			if($(".js-store-finder-map").length > 0)
			{
				$(".js-store-finder-map").attr("id","store-finder-map");
				
				var centerPoint = new google.maps.LatLng(isStoreSpeciality?(response[hardscapeStoreSpecialitites[startIndex][0]][0].geoPoint.latitude,response[hardscapeStoreSpecialitites[startIndex][0]][0].geoPoint.longitude):(ACC.storefinder.storeData["data"][0].latitude, ACC.storefinder.storeData["data"][0].longitude));

				var mapOptions = {
					zoom: 13,
					zoomControl: true,
					panControl: true,
					streetViewControl: false,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					center: centerPoint
				}

				var map = new google.maps.Map(document.getElementById("store-finder-map"), mapOptions);
				var latlngbounds = new google.maps.LatLngBounds();

				 var marker, i;
				for (i = 1; i <= locations.length; i++) {
					/*var storeLoc = locations[i-1][1],locations[i-1][2];*/
						var iconObj = {
						        position: new google.maps.LatLng(locations[i-1][1],locations[i-1][2]),
						        map: map,
						        label: {text: String(i), color: '#ffffff', fontWeight: 'bold'},
						        icon: {
									scaledSize: new google.maps.Size(50, 50), // scaled size
								    origin: new google.maps.Point(0,0), // origin
								}
						      };
						var indexX, indexY;
						if(isStoreSpeciality && $(".page-plantsonmoveLander").length == 0)
						{
							if(i<= hardscapeStoreSpecialitites[0][1]) {
								indexX = hardscapeStoreSpecialitites[0][0];
								indexY = i;
							}
							if(i> hardscapeStoreSpecialitites[0][1] && i<= hardscapeStoreSpecialitites[1][1]) {
								indexX = hardscapeStoreSpecialitites[1][0];
								indexY = i - hardscapeStoreSpecialitites[0][1];
							}
							if(i> hardscapeStoreSpecialitites[1][1] && i<= hardscapeStoreSpecialitites[2][1]) {
								indexX = hardscapeStoreSpecialitites[2][0];
								indexY = i - hardscapeStoreSpecialitites[1][1];
							}
						}
						
						if((isStoreSpeciality && $(".page-plantsonmoveLander").length == 0 && (response[indexX][indexY-1].isPreferredStore || (response[indexX][indexY-1].storeId == $.cookie("gls") || response[indexX][indexY-1].storeId == $.cookie("csc")))) || (!isStoreSpeciality && ACC.storefinder.storeData["data"][i-1].showGreenIcon)) {
							iconObj.icon.url = "/_ui/responsive/theme-lambda/images/location-star-green.png";
							anchor: new google.maps.Point(0, 0) // anchor
						} else {
							if(isStoreSpeciality && $(".page-plantsonmoveLander").length == 0)
							{
								if(i<= hardscapeStoreSpecialitites[0][1])
									iconObj.icon.url = "/_ui/responsive/theme-lambda/images/pinpoint-green.png";
								if(i> hardscapeStoreSpecialitites[0][1] && i<= hardscapeStoreSpecialitites[1][1])
									iconObj.icon.url = "/_ui/responsive/theme-lambda/images/pinpoint-blue.png";
								if(i> hardscapeStoreSpecialitites[1][1] && i<= hardscapeStoreSpecialitites[2][1])
									iconObj.icon.url = "/_ui/responsive/theme-lambda/images/pinpoint-gray.png";
							}
							 
							else
							{
								iconObj.icon.url = "/_ui/responsive/theme-lambda/images/pinpoint-gray.png";
							}
						}
				      marker = new google.maps.Marker(iconObj);

				      //For desktop on hover of markers
				      google.maps.event.addListener(marker, 'mouseover', (function(marker, i) {
				        return function() {
				        	if(!locations[i-1][5] || locations[i-1][5] == null )
				        	{
				        	   infowindow.setContent('<div style="overflow: hidden;"><a href=' + ACC.config.encodedContextPath + "/store/"+locations[i-1][11] + ' style="font-weight:bold">' + locations[i-1][0] + '</a><br/>' +  locations[i-1][4] +'<br/>'  +' '+  locations[i-1][7]+', ' +  locations[i-1][8]+' ' +  locations[i-1][9]+'<br/><a class="tel-phone" href="tel:' +locations[i-1][6]+'">'+locations[i-1][6]+'</a><br/>'+ ACC.config.getDirectionFrom +' </br><input id="getdirections" type="text"><br/><a href="https://www.google.com/maps?hl=en&daddr=' + locations[i-1][4] + ' ' + locations[i-1][5] + ' ' + locations[i-1][7] + ' ' + locations[i-1][8] + ' ' + locations[i-1][9] +'"   class="blue getDirectionsLink" style="font-weight:bold">'+ACC.config.getDirection+'</a></div>');
				        	}
				        	else
				        	{
				        		infowindow.setContent('<div style="overflow: hidden;"><a href=' + ACC.config.encodedContextPath + "/store/"+locations[i-1][11] + ' style="font-weight:bold">' + locations[i-1][0] + '</a><br/>' +  locations[i-1][4] +'<br/>'  + locations[i-1][5] +'<br/>' +  locations[i-1][7]+', ' +  locations[i-1][8]+' ' +  locations[i-1][9]+'<br/><a class="tel-phone" href="tel:' +locations[i-1][6]+'">'+locations[i-1][6]+'</a><br/>'+ ACC.config.getDirectionFrom +'  </br><input id="getdirections" type="text"><br/><a href="https://www.google.com/maps?hl=en&daddr=' + locations[i-1][4] + ' ' + locations[i-1][5] + ' ' + locations[i-1][7] + ' ' + locations[i-1][8] + ' ' + locations[i-1][9] +'"   class="blue getDirectionsLink" style="font-weight:bold">'+ACC.config.getDirection+'</a></div>');
				        	}
				        	infowindow.open(map, marker);
				        }
				      })(marker, i));

				      //for mobile on click of markers
				      google.maps.event.addListener(marker, 'mousedown', (function(marker, i) {
				        return function() {
				        	if(!locations[i-1][5])
				        	{
				        	   infowindow.setContent('<div style="overflow: hidden;"><a href=' + ACC.config.encodedContextPath + "/store/"+locations[i-1][11] + ' style="font-weight:bold">' + locations[i-1][0] + '</a><br/>' +  locations[i-1][4] +'<br/>'  +' '+  locations[i-1][7]+', ' +  locations[i-1][8]+' ' +  locations[i-1][9]+'<br/><a class="tel-phone" href="tel:' +locations[i-1][6]+'">'+locations[i-1][6]+'</a><br/>'+ ACC.config.getDirectionFrom +' </br><input id="getdirections" type="text"><br/><a href="https://www.google.com/maps?hl=en&daddr=' + locations[i-1][4] + ' ' + locations[i-1][5] + ' ' + locations[i-1][7] + ' ' + locations[i-1][8] + ' ' + locations[i-1][9] +'"   class="blue getDirectionsLink" style="font-weight:bold">'+ACC.config.getDirection+'</a></div>');
				        	}
				        	else
				        	{
				        		infowindow.setContent('<div style="overflow: hidden;"><a href=' + ACC.config.encodedContextPath + "/store/"+locations[i-1][11] + ' style="font-weight:bold">' + locations[i-1][0] + '</a><br/>' +  locations[i-1][4] +'<br/>'  + locations[i-1][5] +'<br/>' +  locations[i-1][7]+', ' +  locations[i-1][8]+' ' +  locations[i-1][9]+'<br/><a class="tel-phone" href="tel:' +locations[i-1][6]+'">'+locations[i-1][6]+'</a><br/>'+ ACC.config.getDirectionFrom +' </br><input id="getdirections" type="text"><br/><a href="https://www.google.com/maps?hl=en&daddr=' + locations[i-1][4] + ' ' + locations[i-1][5] + ' ' + locations[i-1][7] + ' ' + locations[i-1][8] + ' ' + locations[i-1][9] +'"   class="blue getDirectionsLink" style="font-weight:bold">'+ACC.config.getDirection+'</a></div>');
				        	}
				        	infowindow.open(map, marker);
				        }
				      })(marker, i));

				      latlngbounds.extend(marker.position);
				      var bounds = new google.maps.LatLngBounds();
						map.setCenter(latlngbounds.getCenter());
						if(locations.length > 1) {
							map.fitBounds(latlngbounds);
						}
				    }
				var infowindow = new google.maps.InfoWindow({
						content: (isStoreSpeciality?(response[hardscapeStoreSpecialitites[startIndex][0]][0].name + response[hardscapeStoreSpecialitites[startIndex][0]][0].address.line1 + response[hardscapeStoreSpecialitites[startIndex][0]][0].address.line2 + response[hardscapeStoreSpecialitites[startIndex][0]][0].address.phone):(ACC.storefinder.storeData["data"][0].name + ACC.storefinder.storeData["data"][0].line1 + ACC.storefinder.storeData["data"][0].line2 + ACC.storefinder.storeData["data"][0].phone)),
						disableAutoPan: true
				});
				google.maps.event.addListener(marker, 'click', function (){
					infowindow.open(map, marker);
				});
			}
		}

		if(!isStoreSpeciality){
		$('span[class^=entry__status]').each(function()
		{
			var storeId = $(this).attr('class').split(' ')[0].split('-')[1]
			var element = ".entry__status-"+storeId;
			var status = ACC.mystores.storeStatusApiCall($(this).data('lat'), $(this).data('long'), null, storeId, element);
			if(status != null && status != undefined)
			{
				$(element).html();
				$(element).html(status);
			}
		});
		}

	},
	
	clickGetDirectionsLink : function() {
		$(document).on("click", '.getDirectionsLink', function(e){
			e.preventDefault();
			var ref = this.href + "&saddr=" + $('#getdirections').val();
			window.open(ref,'_blank');
		});
	},
	
	validateSearchTerm : function(input){
		$(".alert").remove();
		var regexForDigits = /^[\d-]+$/;
		var lengthOfInput = $(".js-store-finder-search-input").val().length;
		var regexValidateZeros = new RegExp("^[0]+$");
		var invalidZipCodeMessage = ACC.config.invalidDetail;
			
		//Check for Valid Branch Number and ZipCode
		if(regexForDigits.test(input) && lengthOfInput < 3){
			if(regexValidateZeros.test(input)){
			$("#storeResultsMsg").html('');
			$(".js-store-finder").hide();
			$("#storeFinder").before('<div class="js-storefinder-alert alert alert-danger alert-dismissable" ><button class="close" type="button" data-dismiss="alert" aria-hidden="true"></button>' + invalidZipCodeMessage + '</div>');
			return false;
			}
		}else if(regexForDigits.test(input) && lengthOfInput >= 3){
			var regex1 = new RegExp("^([0-9]{5})(-)([0-9]{4})$");
			var regex2 = new RegExp("^([0-9]{5})$");
			var regex3 = new RegExp("^([0-9]{3})$");
			var regex4 = new RegExp("^([0-9]{4})$");
			if(regexValidateZeros.test(input) || (!regex1.test(input) && !regex2.test(input) && !regex3.test(input) && !regex4.test(input)))
			{
				$("#storeResultsMsg").html('');
				$(".js-store-finder").hide();
				$("#storeFinder").before('<div class="js-storefinder-alert alert alert-danger alert-dismissable" ><button class="close" type="button" data-dismiss="alert" aria-hidden="true"></button>' + invalidZipCodeMessage + '</div>');
				return false;
			}
		}else{
			//Check for Valid State Or City
			if(/^[a-zA-Z0-9-,'\s]*$/.test(input) == false || lengthOfInput < 2) {
				$("#storeResultsMsg").html('');
				$(".js-store-finder").hide();
				$("#storeFinder").before('<div class="js-storefinder-alert alert alert-danger alert-dismissable" ><button class="close" type="button" data-dismiss="alert" aria-hidden="true"></button>' + invalidZipCodeMessage + '</div>');
				return false;
			}
		}
		return true;
	},
	
	bindSearch:function(){
			  $('.specialties-option').addClass("hidden");
			   $('.specialties-dropdown').addClass("hidden");
			  $('.specialties-option').removeClass('showing').slideUp();
		$(document).on('click','#store-finder-button', function(e){
			e.preventDefault()
		    $(".clear-specialties, .specialties-name").remove();
       	    $('.choose-specialty').prop("checked", false);
            ACC.storefinder.specialties = [];
			var q = $(".js-store-finder-search-input").val();
			var miles = ACC.storefinder.getMiles();
			if(q.length>0)
			{
				if(ACC.storefinder.validateSearchTerm(q))
				{
					$(".alert").remove();
					ACC.storefinder.getInitStoreData(q,null,null,miles, ACC.storefinder.specialties);
				}
			}else{
				$(".alert").remove();
				if($(".js-storefinder-alert").length<1){
					$("#storeResultsMsg").html('');
					var emptySearchMessage =  ACC.config.invalidDetail;
					$(".js-store-finder").hide();
					$("#storeFinder").before('<div class="js-storefinder-alert alert alert-danger alert-dismissable" ><button class="close" type="button" data-dismiss="alert" aria-hidden="true"></button>' + emptySearchMessage + '</div>');
				}
			}
			try {
				_AAData.storeLocatorMethod ="Search-Text";
				_AAData.storeLocatorTerm=q;
				_AAData.eventType="search-location";
				_satellite.track("dtm-event-search");
			}catch(e){}
		})
		
	},

	bindSearchCurrentLocation:function(){
		$(document).on('click','#findStoresNearMe',function(e){
		$(".clear-specialties, .specialties-name").remove();
       	$('.choose-specialty').prop("checked", false);
        ACC.storefinder.specialties = [];
        document.getElementById("storelocator-query").value = null
		$(".js-store-finder").hide();
			var miles = ACC.storefinder.getMiles();
			$(".alert").remove();
			ACC.storefinder.getInitStoreData(null,ACC.storefinder.coords.latitude,ACC.storefinder.coords.longitude,miles,ACC.storefinder.specialties);
			ACC.storefinder.loadGoogleMap();
			try {
				 
				var p=$("#analyticsstore").val();
				 _AAData.storeLocatorMethod = "Current Location";
				_AAData.storeLocatorTerm="";
				_AAData.eventType="search-location";
				_satellite.track("dtm-event-search");
			}catch(e){}
	})
	},

	bindToStoreFinderFooterForm: function () {
        var storeFinderFooterForm = $('.store_finder_form_footer');
        storeFinderFooterForm.ajaxForm({
        	beforeSubmit:ACC.product.showRequest,
        	success: ACC.storefinder.displayStoreFinderPopup
         });
        setTimeout(function(){
        	$ajaxCallEvent  = true;
        	//$(document).find(".saved-store").parents("li").addClass("list-bg");
         }, 2000);

        $(document.body).on("click",".removeMyStore",function()
				{
					$.colorbox({
						html: "<div class='PopupBox'><b>The branch will be deleted<br/><br/> " + $(this).data('town') + ", " + $(this).data('regionCode') + "</b> #" + $(this).attr("Id") +
							"<br/><b>" + $(this).data('name') + "</b><br/><br/>" + $(this).data('line1') + " " + $(this).data('line2') + "<br/>" +
							$(this).data('town') + ", " + $(this).data('regionCode') + " " + $(this).data('postalCode') +
							"<br/><br/></div><div class='confrimbtnBox'><div class='col-xs-12 col-sm-6 col-sm-push-6'><a href='"+ ACC.config.encodedContextPath + "/store-finder/remove-my-store/" + $(this).attr("Id") + "'" +
							"'><button type='button' id='delete' class='btn btn-ConfirmMessage btn-primary btn-block'>"+ACC.config.removeBranch+"</button></a></div><div class='col-xs-12 col-sm-6 col-sm-pull-6'><button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >"+ACC.config.cancelBranch+"</button></div></div>",
						maxWidth:"100%",
						width:"auto",
						maxHeight:"100%",
						overflow:"auto",
						opacity:0.7,
						className:"addNotFound",
						title:false,
						close:'<span class="glyphicon glyphicon-remove"></span>',
						onComplete: function(){
						}
					});
				});
        //$(document).find(".saved-store").parents("li").addClass("list-bg");
     },

     displayStoreFinderPopup: function (response, statusText, xhr, formElement) {
     	$ajaxCallEvent=true;
         /*$('#addToCartLayer').remove();
         if (typeof ACC.minicart.updateMiniCartDisplay == 'function') {
             ACC.minicart.updateMiniCartDisplay();
         }*/
         var titleHeader = "Find a branch";
         var data = JSON.parse(response);
         var listitems = "";
         if(data){
 			for(i = 0;i < data["data"].length;i++){
 				listitems += ACC.storefinder.createListItemHtml(data["data"][i],i,data.q,data.miles)
 			}

 			//$(".js-store-finder-navigation-list").html(listitems);


 		}
         ACC.colorbox.open(titleHeader, {
             html: listitems,
             width: "460px"
         });


     },


    getStoreData: function(page,seemore){
       // $("#noStoreResultsMsg").css("display","none");
        $(".js-store-finder").hide();
        $("#storeResultsMsg").html('');
        $(".store-spinner").show();
        ACC.storefinder.storeSearchData.page = page;
        loading.start();
        url = "/store-finder";
        $.ajax({
            url: url,
            cache: false,
            data: ACC.storefinder.storeSearchData,
            type: "get",
            success: function (response){
            	loading.stop();
                $(".store-spinner").hide();
                if(response.indexOf('<html') == -1){
                    $("#storeResultsMsg").html('');
                    $("#noStoreResultsMsg").html('');
                    $(".js-store-finder").show();
                    $(".js-store-finder-pager-next").show();
                    $('#findStoresNearMe').show();
                    $("#store-heading").show();
                    $("#searchAgain").hide();
                    $('.breadcrumb').hide();
                    $(".text-or").removeClass("hidden");
                    ACC.storefinder.storeDataTemp = ACC.storefinder.storeData;

                    ACC.storefinder.storeData = JSON.parse(response);
                    if(ACC.storefinder.storeDataTemp != "") {
                        var isExists = false;
                        $.each(ACC.storefinder.storeDataTemp.data, function( key, value ) {
                                if(value.name == ACC.storefinder.storeData.data[0].name) {
                                    isExists = true;
                                }
                            }
                        );
                        if(!isExists && seemore) {
                            $.merge(ACC.storefinder.storeDataTemp.data, ACC.storefinder.storeData.data);
                            ACC.storefinder.storeData.data = ACC.storefinder.storeDataTemp.data;
                        }
                    }
                    ACC.storefinder.refreshNavigation();
					/*if(ACC.storefinder.storeData.total - ACC.storefinder.storeData.data.length <= 10){
					 $(".js-store-finder-pager-next").hide();
					 $("#showAllStores").show();
					 }*/
                    if(ACC.storefinder.storeData.total == ACC.storefinder.storeData.data.length) {
                        $(".js-store-finder-pager-next").hide();
                    }
                    ACC.storefinder.loadGoogleMap();

                } else {
                    $("#noStoreResultsMsg").show();
                    $("#storeResultsMsg").html('');
                    $("#searchAgain").show();
                    if(ACC.storefinder.storeSearchData.q != '') {
                        $("#noStoreResultsMsg").html("<div class='headline2'> "+ACC.config.noLocationsFound+" </div><div class='col-md-6 col-sm-12 col-xs-12 noStoreResults'><p></p> "+ACC.config.noBranchFound+" " + ACC.storefinder.storeSearchData.miles +" "+ ACC.config.milesOf +" " + ACC.storefinder.storeSearchData.q +"."+ACC.config.noBranchFound1+" "
                            + " <span class='bold-text'><a class='tel-phone' href='tel:(800)748-3663'> 1-800-748-3663</a> (1-800-SITEONE)</span>.</div><br/>");
                        $(".text-or").addClass("hidden");
                        $(".no-Store").hide();
                    } else {
                        $("#noStoreResultsMsg").html("<div class='headline2'> "+ACC.config.noLocationsFound+" </div><div class='col-md-6 col-sm-12 col-xs-12' style='padding-left:0px'><p></p> "+ACC.config.noBranchFound +" " + ACC.storefinder.storeSearchData.miles +" "+ ACC.config.milesOf +"."+ACC.config.noBranchFound1+" "
                            + " <span class='bold-text'><a class='tel-phone' href='tel:(800)748-3663'>800-748-3663</a> (800-SITE-ONE)</span>.</div><br/>");
                        $(".text-or").addClass("hidden");
                        $(".no-Store").hide();
                    }

                    $(".js-store-finder").hide();
                    $("#storeResultsMsg").html('');
                    $('#printOption').hide();
                    $('.breadcrumb').show();

                }
            }
        }).always(function(){
        	loading.stop();
        });
    },

	getInitStoreData: function(q,latitude,longitude,miles,specialties){
		var tempstoreSpecialities;
		data ={
			"q":"" ,
			"miles":"",
			"page":0
		}
		if(miles != null){
			data.miles = miles;
		}
		if(q != null){
			data.q = q;
		}

		if(latitude != null){
			data.latitude = latitude;
		}

		if(longitude != null){
			data.longitude = longitude;
		}
		
		if(specialties.length != 0){
			var i =0;
        	specialties.forEach(function(item)
            	{ if(i == 0){
							tempstoreSpecialities = item;
							i++;
					}
				   else{
                  			tempstoreSpecialities =  tempstoreSpecialities + "," + item;
                    }
            	});
           data.storeSpecialities = tempstoreSpecialities;
		}

		ACC.storefinder.storeSearchData = data;
		ACC.storefinder.getStoreData(data.page,false);
		$(".js-store-finder-pager-prev").attr("disabled","disabled")
		$(".js-store-finder-pager-next").removeAttr("disabled")
	},

	storeDetailMap:function(){

		var sdlatitude=$("#storedetailMap").attr("data-myLatitude");
		var sdlongitude=$("#storedetailMap").attr("data-mylongitude");
			var mapProp= {
				zoom: 13,
				zoomControl: true,
				panControl: true,
				streetViewControl: false,
				mapTypeId: google.maps.MapTypeId.ROADMAP,
				center: new google.maps.LatLng(sdlatitude,sdlongitude),
			};
			var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);
			var latlngbounds = new google.maps.LatLngBounds();
			 var marker, i;
			 	var name=$("#storedetailMap").attr("data-name");
			 	var line1=$("#storedetailMap").attr("data-line1");
			 	var line2=$("#storedetailMap").attr("data-line2");
			 	var town=$("#storedetailMap").attr("data-town");
			 	var phone=$("#storedetailMap").attr("data-phone");
			 	var regioncode=$("#storedetailMap").attr("data-regioncode");
			 	var postalcode=$("#storedetailMap").attr("data-postalcode");

				      marker = new google.maps.Marker({
				        position: new google.maps.LatLng(sdlatitude,sdlongitude),
				        map: map,
				        icon : "/_ui/responsive/theme-lambda/images/StoreLocator_Star_Green.png"
				      });

				      google.maps.event.addListener(marker, 'click', (function(marker, i) {
				        return function() {
				        	if(!line2)
				        		{
				                     infowindow.setContent('<div style="overflow: hidden;"><a href="" style="font-weight:bold">' + name + '</a><br/>' +  line1 +'<br/>'  +' '+  town +', ' +  regioncode+' ' +  postalcode+'<br/><a class="tel-phone" href="tel:' +phone+'">'+phone+'</a><br/>Get Directions From: </br><input id="getdirections" type="text"><br/><a href="https://www.google.com/maps?hl=en&daddr=' + line1 + ' ' + line2 + ' ' + town + ' ' + regioncode + ' ' + postalcode +'"   class="blue getDirectionsLink" style="font-weight:bold">Get Directions</a></div>');
				        		}
				        	else
				        		{
				        		     infowindow.setContent('<div style="overflow: hidden;"><a href="" style="font-weight:bold">' + name + '</a><br/>' +  line1 +'<br/>'  + line2 +'<br/>' +  town +', ' +  regioncode+' ' +  postalcode+'<br/><a class="tel-phone" href="tel:' +phone+'">'+phone+'</a><br/>'+ ACC.config.getDirectionFrom +' </br><input id="getdirections" type="text"><br/><a href="https://www.google.com/maps?hl=en&daddr=' + line1 + ' ' + line2 + ' ' + town + ' ' + regioncode + ' ' + postalcode +'"   class="blue getDirectionsLink" style="font-weight:bold">Get Directions</a></div>');
				        		}
				          infowindow.open(map, marker);
				        }
				      })(marker, i));

				      google.maps.event.addListener(marker, 'mouseover', (function(marker, i) {
					        return function() {
					        	if(!line2)
					        	  {
					                infowindow.setContent('<div style="overflow: hidden;"><a href="" style="font-weight:bold">' + name + '</a><br/>' +  line1 +'<br/>'  +' '+  town +', ' +  regioncode+' ' +  postalcode+'<br/><a class="tel-phone" href="tel:' +phone+'">'+phone+'</a><br/>'+ ACC.config.getDirectionFrom +' </br><input id="getdirections" type="text"><br/><a href="https://www.google.com/maps?hl=en&daddr=' + line1 + ' ' + line2 + ' ' + town + ' ' + regioncode + ' ' + postalcode +'"   class="blue getDirectionsLink" style="font-weight:bold">'+ACC.config.getDirection+'</a></div>');
					        	  }
					        	else
					        		{
					        		infowindow.setContent('<div style="overflow: hidden;"><a href="" style="font-weight:bold">' + name + '</a><br/>' +  line1 +'<br/>'  + line2 +'<br/>' +  town +', ' +  regioncode+' ' +  postalcode+'<br/><a class="tel-phone" href="tel:' +phone+'">'+phone+'</a><br/>Get Directions From: </br><input id="getdirections" type="text"><br/><a href="https://www.google.com/maps?hl=en&daddr=' + line1 + ' ' + line2 + ' ' + town + ' ' + regioncode + ' ' + postalcode +'"   class="blue getDirectionsLink" style="font-weight:bold">'+ACC.config.getDirection+'</a></div>');
					        		}
					          infowindow.open(map, marker);
					        }
					      })(marker, i));

				      latlngbounds.extend(marker.position);
				      var bounds = new google.maps.LatLngBounds();
						map.setCenter(latlngbounds.getCenter());
				        //map.fitBounds(latlngbounds);
				    	var infowindow = new google.maps.InfoWindow({
							//content: ACC.storefinder.storeData["data"][0].name + ACC.storefinder.storeData["data"][0].line1 + ACC.storefinder.storeData["data"][0].line2 + ACC.storefinder.storeData["data"][0].phone,
							disableAutoPan: true
						});
						google.maps.event.addListener(marker, 'click', function (){
							infowindow.open(map, marker);
						});
	},


	bindStoreStatusForMyStores: function ()
	{
		if(document.getElementById('listSize') != null)
		{
			var size = document.getElementById('listSize').value;
			for(i = 0 ; i < size ; i++)
			{
				var latitude = document.getElementById('storeLat' + i).value;
				var longitude = document.getElementById('storeLong' + i).value;
				var storeId = document.getElementById('storeIdForStatus' + i).value;
				ACC.mystores.storeStatusApiCall(latitude, longitude,null, storeId, "#status" + i);
			}
		}
	},
	
	init:function(){
		ACC.storefinder.specialties = [];
	    $("#findStoresNearMe").addClass("hidden");
		
		$.urlParam = function(queryparam){
		    var results = new RegExp('[\?&]' + queryparam + '=([^&#]*)').exec(window.location.href);
		    if (results==null){
		       return null;
		    }
		    else
		    {
		       return decodeURI(results[1]);
		    }
		}
		
		if(navigator.geolocation){
			navigator.geolocation.getCurrentPosition(
				function (position)
				{
					ACC.storefinder.coords = position.coords;
					console.log(ACC.storefinder.coords);
					$("#findStoresNearMe").removeClass("hidden");

					var miles = ACC.storefinder.getMiles();
					//var searchParams = new URLSearchParams(window.location.search);
					var searchText = $.urlParam('searchtext'); 
					var selectedMiles = $.urlParam('distance'); 
					
					if(searchText == '' || searchText == null || searchText == undefined)
					{
						if(window.location.href.indexOf('/store-finder/footer?query=&miles=100') != -1 || (window.location.href.indexOf('/store-finder') != -1 && window.location.href.indexOf('footer') == -1))
						{
							ACC.storefinder.getInitStoreData(null,ACC.storefinder.coords.latitude,ACC.storefinder.coords.longitude,miles,ACC.storefinder.specialties);
						}
					}
					else
					{
						$(".js-store-finder-search-input").val(searchText);
						$('#storelocatormiles-query option[value='+selectedMiles+']').attr('selected','selected');
						$('#storelocatormiles-query-mobile option[value='+selectedMiles+']').attr('selected','selected');
						ACC.storefinder.getInitStoreData(searchText,null,null,selectedMiles,ACC.storefinder.specialties);
					}
				},
				function (error)
				{
					console.log("An error occurred... The error code and message are: " + error.code + "/" + error.message);
				}
				
			);
		}
		if($("#query")) {
			var q = $("#query").val();
			$("#query").val('');
			$(".js-store-finder-search-input").val(q);
			if(q.length>0){
				if(ACC.storefinder.validateSearchTerm(q))
				{
					ACC.storefinder.getInitStoreData(q,null,null,100,ACC.storefinder.specialties);
				}
			}
		}
	},
	
	storeNumberCss: function ()
	{
		 $(document).ready(function(){			  
		     $("span.store_details_name.headline").html(function(_, html){
		        return html.replace(/(\#\w+)/g, '<span class="store-number-class">$1</span>');   
		     });		 
		 });
	},
	
	bindBackButton: function ()
	{
		var showBackButton = true;
		if((window.location.href.indexOf('/store-finder') != -1) && (document.referrer.indexOf('/p') != -1) || (document.referrer.indexOf('/my-account/my-stores') != -1 && window.location.href.indexOf('/store-finder') != -1))
		{
			sessionStorage.setItem("prevReferrer",document.referrer);
		}
		
		if((sessionStorage.getItem('prevReferrer').indexOf('/p') == -1 && window.location.href.indexOf('/p') != -1) || (sessionStorage.getItem('prevReferrer').indexOf('/my-account/my-stores') != -1 && window.location.href.indexOf('/my-account/my-stores') != -1))
		{
			showBackButton = false;
		}
		
		if($('.alert-dismissable')[0] != undefined)
		{
			if(($('.alert-dismissable')[0].innerText).indexOf("Your default branch has been updated.") != -1 || ($('.alert-dismissable')[0].innerText).indexOf("Branch removed successfully.") != -1)
			{
				if(showBackButton == true && sessionStorage.getItem('prevReferrer') != null && sessionStorage.getItem('prevReferrer') != "" && sessionStorage.getItem('prevReferrer') != undefined)
				{
					var back =" <a href=" + sessionStorage.getItem('prevReferrer') + ">Click here</a> to go back.";
					$('.alert-dismissable').html($('.alert-dismissable').html() + back);
				}
			}
		}
		
		if((sessionStorage.getItem('prevReferrer').indexOf('/p') != -1 && window.location.href.indexOf('/p') != -1) || (sessionStorage.getItem('prevReferrer').indexOf('/my-account/my-stores') != -1 && window.location.href.indexOf('/my-account/my-stores') != -1))
		{
			sessionStorage.removeItem('prevReferrer');
		}
	},
	getCategoryStoreList:function(specialityStoreData,lat,lng){
		var listitems = "";
		loading.start();
		var page = $(".pagename").val().toLowerCase();
		$.ajax({
		   url: ACC.config.encodedContextPath + "/"+page+"/state?state="+specialityStoreData+"",
		           method: 'POST',
		           datatype: "json",
		           success: function(response){
		        	   loading.stop();
		                    var data=response;
		               if(data){
		            	  ACC.storefinder.loadGoogleMap(true,response);
		       	var i=0,j=0;
				$.each(data, function(index, element){
					$.each(element, function( key, value ) {
		          listitems += ACC.storefinder.createListItemHtml(value,i,specialityStoreData,100,true,lat,lng,j);
				  i++;	
				});
				j++;
				});
		        $(".js-store-finder-navigation-list").html(listitems);
		        $(".store__finderSpecialty").css("display", "block");
		        $(".green-background").css("display", "none");
		        $(".grey_bg").css("display", "none");
		        $(".pageSectionA").css("display", "none");
		        $(".map-store-containerSpecialty").css("display", "block");
		        $(".content").css("display", "none");
		        $(".select-location-btn").css("display", "none");
		        $(".content-area").css("display", "none");
		        $(".pom-data").css("display", "none");
		        // select the first store
		        
		        var firstInput= $(".js-store-finder-input")[0];
		        $(firstInput).trigger('click');
		           }
		           }
		});
		
	},
	bindSpecialtyStoreList: function(){
		$('.whereToBuy a').click(function(){
		   $('#selected').text($(this).text());
		 });

		$(".map-store-containerSpecialty").css("display", "none");
		$(document).on('click', '#stateData', function(){
		var hardscapeStoreData = $(this).text();
		if($('#User_Agent').val()=="SiteOneEcomApp"){
			var page = $(".pagename").val().toLowerCase();
			window.location.href = ACC.config.encodedContextPath + "/"+page+"/state?state="+hardscapeStoreData+"";
		}
		$(".state_title").html(hardscapeStoreData);
		$(".locationtitle").css("display", "block");
		$(".pom-headline").css("display", "block");
		$(".pom-banner").css("display", "block");
		var lat;
		var lng;
		if (navigator.geolocation)				
		{
	          navigator.geolocation.getCurrentPosition(function(position)			         
	          {			          
	        	  lat = position.coords.latitude;			        	  
	              lng = position.coords.longitude;			
	              ACC.storefinder.getCategoryStoreList(hardscapeStoreData,lat, lng);
	          })
	          ACC.storefinder.getCategoryStoreList(hardscapeStoreData,lat, lng);  
		}
		else{
		ACC.storefinder.getCategoryStoreList(hardscapeStoreData,lat, lng);
		}
		
		if (window.history && window.history.pushState) {
			var page = $(".pagename").val().toLowerCase();
		    window.history.pushState('forward', null, './'+page);

		    $(window).on('popstate', function() {
		     window.location.href=ACC.config.encodedContextPath +"/"+page;
		    });

		  }
		
		
		});
			if($(".page-plantsonmoveLander").length > 0){
				$(".pom-data").find(".banner-container").nextAll(".select-location-btn").addClass("second-select-btn");
				$(".map-store-containerSpecialty").eq(1).remove();
				$(".locationtitle").eq(1).remove();
				$(".column70").parent(".main-container").addClass("content-area");
				$(".store__finder--details").eq(1).remove();
			}
		},

		adjustSelectBoxLocations: function() {

			if($(".page-plantsonmoveLander").length > 0 && $('.smallsubhead').length > 0){
				var selectHTML = $('.smallsubhead').parents('.main-container').find('.select-location-btn').hide().html();
				$('.smallsubhead').after(selectHTML).parent().addClass('text-center');
				$('.banner-container .column80').attr('style', 'width: 100% !important;').after('<div class="column20">' + selectHTML + '</div>');
			}
		},
		bannerStoreFinder: function(num) {
			console.log("data-speciality",num);
			let targetLength = $("[data-speciality]").length;
			for(let i=0; i< targetLength; i++){
				let target = $("[data-speciality='"+ (i+1) +"']");
				if(i < num-1){
					target.addClass("hidden");
				}
				else{
					target.removeClass("hidden");
				}
			}
		},
		showSpecialtiesOption: function () {	
        	if(!($('.specialties-option').hasClass('hidden'))){
				if ($('.specialties-option').hasClass('showing')) {
           	 		$('.specialties-option').removeClass('showing').slideUp();
        		}
       	   		else {
             		  $('.specialties-option').addClass('showing').slideDown();
           		}
			}
    	},
      createFilters: function () {
			let target = $('.specialties-option');	
			target.removeClass('showing').slideUp();
        	let specialtiesHTML = "";
        	ACC.storefinder.specialties = [];
        	$('.choose-specialty').each(function () {
           	 	let target = $(this);
            	let selectedoption = target.parents(".specialty-name").find("img").attr("title");
            	let specialtyIcon = target.parents(".specialty-name").find("img").attr("src");
            	let filter = target.prop("name");
            	if (target.is(":checked")) {
               	 	specialtiesHTML += '<div class="col-md-3 col-xs-6 marginBottom10 specialties-name"><span class="selected-specialties"> <img src=' + specialtyIcon + '><span class="font-size-14 font-small-xs">' + selectedoption + '</span><button class="btn bg-white pull-right" onclick="ACC.storefinder.removeFilter(this,\'' + filter + '\')" ><span class="delete-specialty"></span></button></span></div>';
                	ACC.storefinder.specialties.push(filter);
            	}
        	});
        	if (specialtiesHTML != "") {
           		 specialtiesHTML = '<button class="hidden-sm hidden-md hidden-lg col-xs-4 btn bg-white clear-specialties" onclick="ACC.storefinder.clearFilters()">' + ACC.config.clearAll + '</button>' + specialtiesHTML + '<button class="col-md-1 hidden-xs visible-sm visible-md visible-lg bg-white clear-specialties" onclick="ACC.storefinder.clearFilters()">' + ACC.config.clearAll + '</button>';
           		 $(".specialties").html(specialtiesHTML).removeClass("hidden");
        	}
       	ACC.storefinder.specialtiesFilter();	
    },
    removeFilter: function (e, id) {	
        let target = $(e);
        target.parents(".specialties-name").remove();
        $("#" + id).prop("checked", false);
        if (!$(".specialties-name").length) {
            $(".clear-specialties").remove();
        }
        ACC.storefinder.specialties.splice(ACC.storefinder.specialties.indexOf(id), 1);
        ACC.storefinder.specialtiesFilter();	
    },
     clearFilters: function () {	
        $(".clear-specialties, .specialties-name").remove();
        $('.choose-specialty').prop("checked", false);
        ACC.storefinder.specialties = [];
        ACC.storefinder.specialtiesFilter();
    },
    specialtiesFilter: function () {
			var q = $(".js-store-finder-search-input").val();
			var miles = ACC.storefinder.getMiles();
			if(q.length>0)
			{
				ACC.storefinder.getInitStoreData(q,null,null,miles,ACC.storefinder.specialties);
			
			}
			else{
					ACC.storefinder.getInitStoreData(null,ACC.storefinder.coords.latitude,ACC.storefinder.coords.longitude,miles,ACC.storefinder.specialties);
			}
	},
	hideSpecialtiesOption: function(){
		$(document).click(function(){
			if($('.page-storefinderPage').length && !($('.specialties-option').hasClass('hidden'))){
				if ($('.specialties-option').hasClass('showing')) {
           	 		$('.specialties-option').removeClass('showing').slideUp();
        		}
			}
		});
		$('.store-finder-specialties-dropdown').click(function(e){
			e.stopPropagation();
		});
		$(document.body).on("click",'.Icon-StoreSpeciality',function(e)
        {
                    $(".Icon-StoreSpeciality-border").removeClass("Icon-StoreSpeciality-border");
                    $(this).find("img").addClass("Icon-StoreSpeciality-border");
        });
	},
	getMiles:function(){
		if($("#storelocatormiles-query").val() != "100"){
			return $("#storelocatormiles-query").val();
		}
		else{
			return $("#storelocatormiles-query-mobile").val();
		}
	},
	nearbyStoreGeoLocation:function(addressline,town,isocode,postalcode){
		var latitude =  null;
		var longitude = null;
		ACC.mystores.bindGeoLocatedStore();
		if (navigator.geolocation)
		{
		          navigator.geolocation.getCurrentPosition(function(position)
		          {
					latitude = position.coords.latitude;
					longitude = position.coords.longitude;
					window.open('https://www.google.com/maps?hl=en&saddr='+latitude+' '+longitude+'&daddr='+addressline+' '+town+' '+isocode+' '+postalcode, '_blank');
			     })
		}
		setTimeout(function(){
			if(latitude == null && longitude == null){
				window.open('https://www.google.com/maps?hl=en&daddr='+addressline+' '+town+' '+isocode+' '+postalcode, '_blank');
			}
		},700);
	},
};
ACC.futurelink = {
	
	_autoload: [
			"bindFutureStockLink"
		],

	bindFutureStockLink: function() {
		$(document).on("click",".futureStockLink", function(e) {
			e.preventDefault();
			var url = $(this).attr("href");
			var title = $(this).attr("title");

			ACC.colorbox.open(title,{
				href: url,
				maxWidth:"100%",
				width:"320px",
				height:"320px",
				initialWidth :"320px"
			});
		})
	}
};
ACC.productorderform = {

    _autoload: [
        "headerActions",
        "coreTableActions",
        "addToCartOrderGridForm"
    ],

    $addToCartOrderForm: $("#AddToCartOrderForm"),
    $addToCartBtn: $('#addToCartBtn'),
    $omsErrorMessageContainer: $("#globalMessages"),
    $emptySkuQuantityInputs: $(".sku-quantity[value]"),
    $nonEmptySkuQuantityInputs: $(".sku-quantity[value]"),
    $totalGridValues: $("[data-grid-total-id]"),

    // Templates
    $futureTooltipTemplate: $("#future-stock-template"),
    $futureTooltipErrorTemplate: $("#future-tooltip-error-template"),
    $omsErrorMessageTemplate: $("#oms-error-message-template"),
    $variantSummaryTemplate: $("#variant-summary"),
    selectedVariantData: 'selected-variant',
    selectedVariants: [],
    quantityTotal: 0,
    scrollTopPos: 0,

    headerActions: function () {
        ACC.productorderform.bindProductDetailToggle($(".product-details-toggle"));
    },

    coreTableActions: function () {
        ACC.productorderform.coreTableScrollActions(ACC.productorderform.$addToCartOrderForm);
        ACC.productorderform.bindUpdateFutureStockButton(".update_future_stock_button");
        ACC.productorderform.bindHideFutureStockInfo(".hide_future_stock_info");
        ACC.productorderform.bindVariantSelect($(".variant-select-btn"),'AddToCartOrderForm');
        ACC.productorderform.cancelVariantModal(".closeVariantModal");
        ACC.productorderform.checkLimitExceed(".sku-quantity");
        var skuQuantityClass = '.sku-quantity';
        var skuVariantQuantityClass = '#cboxContent .sku-quantity';

        var quantityBefore = 0;
        var quantityAfter = 0;


        ACC.productorderform.$addToCartOrderForm.on('click', skuQuantityClass, function (event) {
            $(this).select();
        });

        ACC.productorderform.$addToCartOrderForm.on('focusin', skuQuantityClass, function (event) {
            quantityBefore = (this.value).trim();

            //reset
            $(this).parents('tr').next('.variant-summary').remove();
            if($(this).parents('table').data(ACC.productorderform.selectedVariantData)){
                ACC.productorderform.selectedVariants = $(this).parents('table').data(ACC.productorderform.selectedVariantData);
            } else {
                ACC.productorderform.selectedVariants = [];
            }

            if (quantityBefore == "") {
                quantityBefore = 0;
                this.value = 0;
            }
        });

        $(skuQuantityClass).on('blur keypress', function (event) {
            var code = event.keyCode || event.which || event.charCode;

            if (code != 13 && code != undefined) {
                return;
            }

            var indexPattern = "[0-9]+";
            var currentIndex = parseInt($(this).attr("id").match(indexPattern));
            var totalPrice = 0;
            var _this = this;
            var currentPrice = $("input[id='productPrice[" + currentIndex + "]']").val();
            this.value = ACC.productorderform.filterSkuEntry(this.value);
            var $currentTotalItems = $('.js-total-items-count');
            var currentTotalItemsValue = $currentTotalItems.html();
            var currentTotalPrice = $('.js-total-price-value').val();
            var $gridGroup = $(this).parents('.orderForm_grid_group');

            if (isNaN((this.value).trim())) {
                this.value = 0;
            }

            quantityAfter = (this.value).trim();
            if (quantityAfter == "") {
                quantityAfter = 0;
                this.value = 0;
            }

            //If order forms advanced search enabled
            if(ACC.orderform) {
                if(sessionStorage.totalItems !== undefined && sessionStorage.totalPriceVal !== undefined) {
                    currentTotalItemsValue = sessionStorage.totalItems;
                    currentTotalPrice = sessionStorage.totalPriceVal;
                }

                if (quantityBefore == 0) {
                    $currentTotalItems.html(parseInt(currentTotalItemsValue) + parseInt(quantityAfter));
                    totalPrice = parseFloat(currentTotalPrice) + parseFloat(currentPrice) * parseInt(quantityAfter);
                } else {
                    $currentTotalItems.html(parseInt(currentTotalItemsValue) + (parseInt(quantityAfter) - parseInt(quantityBefore)));
                    totalPrice = parseFloat(currentTotalPrice) + parseFloat(currentPrice) * (parseInt(quantityAfter) - parseInt(quantityBefore));
                }

                sessionStorage.totalPrice = ACC.productorderform.formatTotalsCurrency(totalPrice);
                sessionStorage.totalItems = $currentTotalItems.html() ;
                sessionStorage.totalPriceVal = totalPrice;

                ACC.orderform.addToSkuQtyInput(_this);

            } else if($gridGroup && $gridGroup.length >0) {
                var $closestQuantityValue = $gridGroup.find('#quantityValue');
                var $closestAvgPriceValue = $gridGroup.find('#avgPriceValue');
                var $closestSubtotalValue = $gridGroup.find('#subtotalValue');
                var currentQuantityValue = $closestQuantityValue.val();
                var currentSubtotalValue = $closestSubtotalValue.val();

                if (quantityBefore == 0) {
                    $closestQuantityValue.val(parseInt(currentQuantityValue) + parseInt(quantityAfter));
                    $closestSubtotalValue.val(parseFloat(currentSubtotalValue) + parseFloat(currentPrice) * parseInt(quantityAfter));

                    $currentTotalItems.html(parseInt(currentTotalItemsValue) + parseInt(quantityAfter));
                    totalPrice = parseFloat(currentTotalPrice) + parseFloat(currentPrice) * parseInt(quantityAfter);
                } else {
                    $closestQuantityValue.val(parseInt(currentQuantityValue) + (parseInt(quantityAfter) - parseInt(quantityBefore)));
                    $closestSubtotalValue.val(parseFloat(currentSubtotalValue) + parseFloat(currentPrice) * (parseInt(quantityAfter) - parseInt(quantityBefore)));

                    $currentTotalItems.html(parseInt(currentTotalItemsValue) + (parseInt(quantityAfter) - parseInt(quantityBefore)));
                    totalPrice = parseFloat(currentTotalPrice) + parseFloat(currentPrice) * (parseInt(quantityAfter) - parseInt(quantityBefore));
                }

                ACC.productorderform.enableBeforeUnloadEvent(quantityAfter,$currentTotalItems.text());

                // if there are no items to add, disable addToCartBtn, otherwise, enable it
                if ($currentTotalItems.length != 0 && $currentTotalItems.text() == 0) {
                    ACC.productorderform.$addToCartBtn.attr('disabled', 'disabled');
                    $(window).off('beforeunload', ACC.productorderform.beforeUnloadHandler);
                } else {
                    ACC.productorderform.$addToCartBtn.removeAttr('disabled');
                }

                if (parseInt($closestQuantityValue.val()) > 0) {
                    $closestAvgPriceValue.val(parseFloat($closestSubtotalValue.val()) / parseInt($closestQuantityValue.val()));
                } else {
                    $closestAvgPriceValue.val(0);
                }
            }

            if($gridGroup && $gridGroup.length >0)
            {
                var gridLevelTotalPrice = "";
                var $gridTotalValue = $gridGroup.find("[data-grid-total-id=" + 'total_value_' + currentIndex + "]");

                if (quantityAfter > 0) {
                    gridLevelTotalPrice =ACC.productorderform.formatTotalsCurrency(parseFloat(currentPrice) * parseInt(quantityAfter));
                }
                $gridTotalValue.html(gridLevelTotalPrice);
                ACC.productorderform.updateSelectedVariantGridTotal(this,quantityBefore,false,false);
            }

            $('.js-total-price').html(ACC.productorderform.formatTotalsCurrency(totalPrice));
            $('.js-total-price-value').val(totalPrice);
        });

        // MOBILE
        $('body').on('focusin', skuVariantQuantityClass, function () {
            quantityBefore = (this.value).trim();

            var currentVariantId = $(this).data('variant-id');
            var currentBaseInput = $("#AddToCartOrderForm, #cartOrderGridForm").find("[data-variant-id='" + currentVariantId + "']");
            currentBaseInput.trigger('focusin');

            currentBaseInput.parents('table').find('.variant-summary').remove();
            if(currentBaseInput.parents('table').data(ACC.productorderform.selectedVariantData)){
                ACC.productorderform.selectedVariants = currentBaseInput.parents('table').data(ACC.productorderform.selectedVariantData);
            } else {
                ACC.productorderform.selectedVariants = [];
            }

            if (quantityBefore == "") {
                quantityBefore = 0;
                this.value = 0;
            }
        });

        $('body').on('blur', skuVariantQuantityClass, function () {
            var priceSibling = $(this).siblings('.price');
            var totalSibling = $(this).siblings('.data-grid-total');
            var currentVariantId = $(this).data('variant-id');
            var currentBaseInput = $("#AddToCartOrderForm, #cartOrderGridForm").find("[data-variant-id='" + currentVariantId + "']");
            this.value = ACC.productorderform.filterSkuEntry(this.value);

            // no text allowed || no negative number allowed || no empty string
            if (isNaN((this.value).trim()) || this.value < 0 || this.value == "") {
                this.value = 0;
            }

            // set current value also to hidden input field (baseTable), because its the base of all further interaction
            currentBaseInput.val(this.value);
            currentBaseInput.trigger('blur');
            ACC.productorderform.updateVariantTotal(priceSibling, this.value, totalSibling);

            // if there are no items to add, disable addToCartBtn, otherwise, enable it
            if (this.value > 0 && this.value != quantityBefore) {
                currentBaseInput.parents('table').addClass('selected');
                currentBaseInput.trigger('change');
            } else {
                if (ACC.productorderform.selectedVariants.length === 0) {
                    currentBaseInput.parents('table').removeClass('selected');
                }
            }
        });
    },

    // MOBILE
    updateSelectedVariantGridTotal: function(_this,quantityBefore,isFillQty,resetSummary){
        var priceSibling = $(_this).siblings('.price');
        var propSibling = $(_this).siblings('.variant-prop');
        var currentSkuId = $(_this).next('.td_stock').data('sku-id');
        var currentBaseTotal = $(_this).siblings('.data-grid-total');

        if(isFillQty) {
            ACC.productorderform.selectedVariants = [];
        }

         if (_this.value != quantityBefore) {
            var newVariant = true;
            ACC.productorderform.selectedVariants.forEach(function(item, index) {
                if(item.id === currentSkuId){
                    newVariant = false;
                    if(_this.value === '0' || _this.value === 0){
                        ACC.productorderform.selectedVariants.splice(index, 1);
                    } else {
                        ACC.productorderform.selectedVariants[index].quantity = _this.value;
                        ACC.productorderform.selectedVariants[index].total = ACC.productorderform.updateVariantTotal(priceSibling, _this.value, currentBaseTotal);
                    }
                }
            });

            if(newVariant && _this.value > 0){
                // update variantData
                ACC.productorderform.selectedVariants.push({
                    id: currentSkuId,
                    size: propSibling.data('variant-prop'),
                    quantity: _this.value,
                    total: ACC.productorderform.updateVariantTotal(priceSibling, _this.value,  currentBaseTotal)
                });
            }
        }

        if(resetSummary){
            $(_this).parents('table').find('.variant-summary').remove();
        }

        ACC.productorderform.showSelectedVariant($(_this).parents('table'));

        if (_this.value > 0 && _this.value != quantityBefore) {
            $(_this).parents('table').addClass('selected');
        } else {
            if (ACC.productorderform.selectedVariants.length === 0) {
                $(_this).parents('table').removeClass('selected').find('.variant-summary').remove();
            }
        }

    },

    updateVariantTotal: function (priceSibling, quantity, totalElement) {
        var variantTotal = parseFloat(priceSibling.data('variant-price')) * parseInt(quantity);
        // set total in modal and baseVariant
        totalElement.html(ACC.productorderform.formatTotalsCurrency(variantTotal));

        return ACC.productorderform.formatTotalsCurrency(variantTotal);
    },

    bindUpdateFutureStockButton: function (updateFutureStockButton) {
        $('body').on('click', updateFutureStockButton,function (event) {
            event.preventDefault();

            var $gridContainer = $(this).parents('.orderForm_grid_group').find(".product-grid-container");
            var $skus = jQuery.map($gridContainer.find("input[type='hidden'].sku"), function (o) {
                return o.value
            });
            var skusId = $(this).data('skusId');
            var futureStockUrl = $(this).data('skusFutureStockUrl');
            var postData = {skus: $skus, productCode: skusId};
            var hideFutureStockInfo =  $(this).parent().find(".hide_future_stock_info");
            var showFutureStockLink = $(this);

            $.ajax({
                url: ACC.config.encodedContextPath + futureStockUrl,
                type: 'POST',
                data: postData,
                traditional: true,
                dataType: 'json',
                success: function (data) {
                    ACC.productorderform.updateFuture($gridContainer, $skus, data, skusId, showFutureStockLink , hideFutureStockInfo);
                },
                error: function (xht, textStatus, ex) {
                    alert("Failed to get delivery modes. Error details [" + xht + ", " + textStatus + ", " + ex + "]");
                }
            });
        });
    },

    bindHideFutureStockInfo: function (hideFutureStockInfoLink) {
        $('body').on('click', hideFutureStockInfoLink, function (event) {
            event.preventDefault();
            var gridContainer = $(this).parent().parent().find(".product-grid-container");
            var updateFutureStockInfo =  $(this).parent().find(".update_future_stock_button");
            updateFutureStockInfo.show();
            $(this).hide();
            var cell = gridContainer.find("[data-sku-id]");
            cell.children(".future_stock, .out-of-stock").remove();
        });
    },

    updateFuture: function (gridContainer, skus, freshData, callerId, showFutureStockInfoLink ,hideFutureStockInfo) {
        // clear prior error messages
        ACC.productorderform.$omsErrorMessageContainer.find("div").remove();

        function isEmpty(obj) {
            return (Object.keys(obj).length <= 0);
        }

        if (freshData !== null && typeof freshData['basket.page.viewFuture.unavailable'] !== 'undefined') {
            // future stock service is not available
            $.tmpl(ACC.productorderform.$omsErrorMessageTemplate, {
                errorMessage: freshData['basket.page.viewFuture.unavailable']
            }).appendTo(ACC.productorderform.$omsErrorMessageContainer);
        }
        else {
            if(!isEmpty(freshData)) {
                showFutureStockInfoLink.hide();
                hideFutureStockInfo.css( "display", "block");
                $.each(skus, function (index, skuId) {
                    var stocks = freshData[skuId];

                    var cell = gridContainer.find("[data-sku-id='" + skuId + "']");
                    var isCurrentlyInStock = cell[0].attributes['class'].nodeValue.indexOf("in-stock") != -1;
                    var futureStockPresent = typeof stocks !== 'undefined' && stocks !== null && stocks[0] !== null && typeof stocks[0] !== 'undefined';

                    cell.children(".future_stock, .out-of-stock").remove(); // remove previous tool tips

                    if (futureStockPresent) {
                        // we have stock for this product
                        if (!isCurrentlyInStock) {
                            cell.addClass("future-stock");
                        }

                        // render template and append to cell
                        $.tmpl(ACC.productorderform.$futureTooltipTemplate, {
                            formattedDate: stocks[0].formattedDate,
                            availabilities: stocks
                        }).appendTo(cell);

                    } else {
                        // no future stock for this product
                        if (!isCurrentlyInStock) {
                            cell[0].attributes['class'].nodeValue = "td_stock out-of-stock";
                        }
                    }
                });
            }

        }
    },

    toJSON: function (gridForm, skipZeroQuantity) {
        var skus = gridForm.find("input.sku").map(function (index, element) {
                return element.value
            }),
            skuQuantities = gridForm.find("input.sku-quantity").map(function (index, element) {
                return parseInt(element.value)
            }),
            skusAsJSON = [];

        for (var i = 0; i < skus.length; i++) {
            if (!(skipZeroQuantity && skuQuantities[i] === 0)) {
                skusAsJSON.push({"product": {"code": skus[i]}, "quantity": skuQuantities[i]});
            }
        }

        return JSON.stringify({"cartEntries": skusAsJSON});
    },

    formatTotalsCurrency: function (amount) {
        return Currency.formatMoney(Number(amount).toFixed(2), Currency.money_format[ACC.common.currentCurrency]);
    },

    cleanValues: function () {
        if ($(".orderForm_grid_group").length !== 0) {
            var formattedTotal = ACC.productorderform.formatTotalsCurrency('0.00');

            $('.js-total-price').html(formattedTotal);
            $('#quantity, .js-total-items-count').html(0);
            $('#quantityValue, #avgPriceValue, #subtotalValue, .js-total-price-value').val(0);
            ACC.productorderform.$emptySkuQuantityInputs.val(0);
            ACC.productorderform.$totalGridValues.html("");
        }
    },

    calculateGrid: function () {
        ACC.productorderform.$nonEmptySkuQuantityInputs.trigger('focusout');
    },

    bindProductDetailToggle: function (productDetailToggle) {
        productDetailToggle.on("click", function (event) {
            event.preventDefault();

            $(this).parents('.product-details').toggleClass('open');
        });
    },

    showSelectedVariant: function (currentVariant) {
        // render template and append to table
        $.tmpl(ACC.productorderform.$variantSummaryTemplate, {
            variants: ACC.productorderform.selectedVariants
        }).appendTo(currentVariant);
        // save selectedVariantData
        $('.variant-summary .variant-property').html($('.variant-detail').data('variant-property'));
        currentVariant.data(ACC.productorderform.selectedVariantData, ACC.productorderform.selectedVariants);
        currentVariant.removeClass('currentVariant');
    },

    bindVariantSelect: function (variantSelectBtn,parentId) {
        variantSelectBtn.on("click", function (event) {
            event.preventDefault();
            var currentVariant = $(this).parents('table');

            // reset
            if(currentVariant.data(ACC.productorderform.selectedVariantData)){
                ACC.productorderform.selectedVariants = currentVariant.data(ACC.productorderform.selectedVariantData);
            } else {
                ACC.productorderform.selectedVariants = [];
            }

            var titleHeader = variantSelectBtn.html();
            var tableWrap = $('#'+parentId).clone().empty().attr('id', parentId+'Variant');

            currentVariant.addClass('currentVariant');
            var popupContent = $(this).parents('.orderForm_grid_group').clone();
            currentVariant.removeClass('currentVariant');
            $(popupContent).find('.currentVariant').siblings().remove();
            tableWrap.html(popupContent);
            tableWrap.find('.hidden-xs').removeClass('hidden-xs');
            tableWrap.find('.hide').removeClass('hide');
            scrollTopPos = $('body').scrollTop();
            $('body').scrollTop(0);

            ACC.colorbox.open(titleHeader, {
                html: tableWrap,
                width:"100%",
                reposition: false,
                className: 'variantSelectMobile',
                onCleanup : function() {
                    if(ACC.productorderform.$addToCartOrderForm.find('.selected').length > 0) {
                        ACC.productorderform.$addToCartBtn.removeAttr('disabled');
                    } else {
                        ACC.productorderform.$addToCartBtn.attr('disabled', 'disabled');
                    }
                    $('body').scrollTop(scrollTopPos);
                }
            });
        });
    },

    cancelVariantModal: function (closeVariantModal) {
        $('body').on('click', closeVariantModal, function (event) {
            event.preventDefault();
            ACC.colorbox.close();
        });
    },
    checkLimitExceed: function (closeVariantModal1) {
        $('body').on('keyup blur', closeVariantModal1, function (event) {  	
        	 var input=Number($(this).val());
             var stock_amt=Number($(this).attr('data-instock'));     
             if(input>stock_amt)
             	$(this).val(stock_amt);
        });
    },

    resetSelectedVariant: function () {
        // Reset all the selectedVariant data
        ACC.productorderform.selectedVariants = [];
        $('.product-grid-container table').removeData(ACC.productorderform.selectedVariantData)
            .removeClass('selected')
            .removeClass('currentVariant');
    },

    addToCartOrderGridForm: function addToCartOrderGridForm() {
        // Prevent accidentally submitting the form by hitting the Enter key.
        $("#AddToCartOrderForm").keypress(
            function(event){
                if (event.which == '13') {
                event.preventDefault();
            }
        });

        ACC.productorderform.$addToCartBtn.on('click',function  () {
            ACC.productorderform.$addToCartBtn.attr('disabled', 'disabled');

            $.ajax({
                url: ACC.config.encodedContextPath +  ACC.productorderform.$addToCartOrderForm.attr("action"),
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                data: ACC.productorderform.toJSON( ACC.productorderform.$addToCartOrderForm, true),
                async: false,
                success: function (response) {
                    $(window).off('beforeunload', ACC.productorderform.beforeUnloadHandler);
                    ACC.product.displayAddToCartPopup(response);
                    ACC.productorderform.cleanValues();
                    ACC.productorderform.resetSelectedVariant();
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // log the error to the console
                    console.log("The following error occured: " + textStatus, errorThrown);
                }
            });
        });
    },

    beforeUnloadHandler: function() {
        return  ACC.productorderform.$addToCartOrderForm.attr('data-grid-confirm-message');
    },

    enableBeforeUnloadEvent: function(quantityAfter,currentTotalItems) {
        if(!ACC.orderform)
        {
            if(quantityAfter > 0 &&  currentTotalItems > 0)
            {
                $(window).off('beforeunload', ACC.productorderform.beforeUnloadHandler)
                    .on('beforeunload', ACC.productorderform.beforeUnloadHandler);
            }
        }
    },

    filterSkuEntry: function(quantityInput){
        var filteredQty = 0;
        if (/\D/g.test(quantityInput)) {
            // Filter non-digits from input value.
            filteredQty = quantityInput.replace(/\D/g, '');
        }
        else
        {
            filteredQty = quantityInput;
        }
        return filteredQty;
    },

    // Order form scroll
    coreTableScrollActions: function ($scrollContent) {
        if ($scrollContent.hasClass('visible')) {
            ACC.productorderform.orderGridScroll($scrollContent);
            var scrollRight = $scrollContent.parent().find('.order-form-scroll.right'),
                scrollLeft = $scrollContent.parent().find('.order-form-scroll.left'),
                scrollUp = $scrollContent.parent().find('.order-form-scroll.up'),
                scrollDown = $scrollContent.parent().find('.order-form-scroll.down');
            var widthReference = $scrollContent.find('.widthReference').outerWidth(),
                heightReference = $scrollContent.find('.product-grid-container table').eq(0).height() /2;// devided by 2 otherwise no nice behaviour
            var maxWidth = 0,
                maxHeight = 0;
            var widthDiff = 0,
                heightDiff = 0;

            $scrollContent.find('.product-grid-container table').each(function(){
                if($(this).outerWidth() > maxWidth){
                    maxWidth = $(this).outerWidth();
                }
            });
            $scrollContent.find('.orderForm_grid_group').each(function(){
                maxHeight += $(this).height();
            });

            widthDiff = maxWidth - $scrollContent.outerWidth();//scroll-offset
            heightDiff = maxHeight - $scrollContent.height() + 14;//scroll-offset

            $scrollContent.on('scroll', function (){
                if($(this).scrollLeft() > 0) {
                    scrollLeft.show();
                } else {
                    scrollLeft.hide();
                }

                if($(this).scrollLeft() >= widthDiff) {
                    scrollRight.hide();
                } else {
                    scrollRight.show();
                }

                if($(this).scrollTop() > 0) {
                    scrollUp.show();
                } else {
                    scrollUp.hide();
                }

                if($(this).scrollTop() >= heightDiff) {
                    scrollDown.hide();
                } else {
                    scrollDown.show();
                }

                $scrollContent.find('.update-future-stock').css('margin-right', -$(this).scrollLeft());
            });

            $scrollContent.parent().find('.order-form-scroll').on('click',function  () {
                var pos = { left: $scrollContent.scrollLeft(),
                    top: $scrollContent.scrollTop() };

                if($(this).hasClass('right')) {
                    $scrollContent.scrollLeft(pos.left + widthReference);
                }
                else if($(this).hasClass('left')) {
                    $scrollContent.scrollLeft(pos.left - widthReference);
                }
                else if($(this).hasClass('up')) {
                    $scrollContent.scrollTop(pos.top - heightReference);
                }
                else {
                    $scrollContent.scrollTop(pos.top + heightReference);
                }
            });
        }
    },

    orderGridScroll: function (scrollContent) {
        var showRight = false;
        var calcHeight = 0;
        var maxWidth = $(scrollContent).find('.orderForm_grid_group').innerWidth();
        var maxHeight = $(scrollContent).innerHeight() - 18;

        $(scrollContent).find('.product-grid-container table').each(function () {
            if ($(this).width() > maxWidth) {
                showRight = true;
            }
            calcHeight += $(this).height();
        });

        if (showRight) {
            $(scrollContent).parent().find('.order-form-scroll.right').show();
        }

        if (calcHeight > maxHeight) {
            $(scrollContent).parent().find('.order-form-scroll.down').show();
        }
    },

    calculateVariantTotal:function(_this,quantityToAdd){
        var $gridGroup = _this.parents('.orderForm_grid_group');
        var indexPattern = "[0-9]+";
        var currentIndex = parseInt(_this.attr("id").match(indexPattern));
        var currentPrice = $("input[id='productPrice[" + currentIndex + "]']").val();
        var $gridTotalValue = $gridGroup.find("[data-grid-total-id=" + 'total_value_' + currentIndex + "]");
        if(quantityToAdd > 0)
            $gridTotalValue.html(ACC.productorderform.formatTotalsCurrency(parseFloat(currentPrice) * parseInt(quantityToAdd)));
    }
};
ACC.savedcarts = {

    _autoload: [
        ["bindRestoreSavedCartClick", $(".js-restore-saved-cart").length != 0],
        ["bindDeleteSavedCartLink", $('.js-delete-saved-cart').length != 0],
        ["bindDeleteConfirmLink", $('.js-savedcart_delete_confirm').length != 0],
        ["bindSaveCartForm", $(".js-save-cart-link").length != 0 || $(".js-update-saved-cart").length != 0],
        ["bindUpdateUploadingSavedCarts", $(".js-uploading-saved-carts-update").length != 0]
    ],
    
    $savedCartRestoreBtn: {},
    $currentCartName: {},

    bindRestoreSavedCartClick: function () {
        $(".js-restore-saved-cart").on('click',function  (event) {
                    
            event.preventDefault();
            var popupTitle = $(this).data('restore-popup-title');
            var cartId = $(this).data('savedcart-id');
            var url = ACC.config.encodedContextPath +'/my-account/saved-carts/'+cartId+'/restore';

            $.get(url).done(function (data) {
                ACC.colorbox.open(popupTitle, {
                    html: data,
                    width: 500,
                    onComplete: function () {
                        ACC.common.refreshScreenReaderBuffer();
                        ACC.savedcarts.bindRestoreModalHandlers();
                        ACC.savedcarts.bindPostRestoreSavedCartLink();
                    },
                    onClosed: function () {
                        ACC.common.refreshScreenReaderBuffer();
                    }
                });
            });
        });
    },

    bindRestoreModalHandlers: function () {

        ACC.savedcarts.$savedCartRestoreBtn= $('.js-save-cart-restore-btn');
        ACC.savedcarts.$currentCartName= $('.js-current-cart-name');

        $(".js-prevent-save-active-cart").on('change', function (event) {
            if($(this).prop('checked') === true){
                ACC.savedcarts.$currentCartName.attr('disabled', 'disabled');
                ACC.savedcarts.$savedCartRestoreBtn.removeAttr('disabled');
            } else {
                ACC.savedcarts.$currentCartName.removeAttr('disabled');
                var inputVal = ACC.savedcarts.$currentCartName.val();
                if (inputVal == "" && inputVal.length === 0) {
                    ACC.savedcarts.$savedCartRestoreBtn.attr('disabled', 'disabled');
                }
            }
        });

        ACC.savedcarts.$currentCartName.on('focus', function (event) {
            $('.js-restore-current-cart-form').removeClass('has-error');
            $('.js-restore-error-container').html('');
        });

        ACC.savedcarts.$currentCartName.on('blur', function (event) {
            if (this.value == "" && this.value.length === 0) {
                ACC.savedcarts.$savedCartRestoreBtn.attr('disabled', 'disabled');
            } else {
                ACC.savedcarts.$savedCartRestoreBtn.removeAttr('disabled');
            }
        });
    },

    bindPostRestoreSavedCartLink: function () {
        var keepRestoredCart = true;
        var preventSaveActiveCart = false;

        $(document).on("click", '.js-keep-restored-cart', function (event) {
            keepRestoredCart = $(this).prop('checked');
        });

        $(document).on("click", '.js-prevent-save-active-cart', function (event) {
            preventSaveActiveCart = $(this).prop('checked');
        });

        $(document).on("click", '.js-save-cart-restore-btn', function (event) {
        	
            event.preventDefault();
            var cartName = $('#activeCartName').val();
            var url = $(this).data('restore-url');
            var postData = {preventSaveActiveCart: preventSaveActiveCart, keepRestoredCart: keepRestoredCart, cartName: cartName};
            $.post(url, postData).done(function (result, data, status) {
                if (result == "200") {
                    var url = ACC.config.encodedContextPath + "/cart"
                    window.location.replace(url);
                } else {
                    var errorMsg = status.responseText.slice(1, -1);
                    $('.js-restore-current-cart-form').addClass('has-error');
                    $('.js-restore-error-container').html(errorMsg);
                    $('.js-savedcart_restore_confirm_modal').colorbox.resize();
                }
            });
        });

        $(document).on("click", '.js-cancel-restore-btn', function (event) {
            ACC.colorbox.close();
        });
    },

    bindDeleteSavedCartLink: function () {
        $(document).on("click", '.js-delete-saved-cart', function (event) {
            event.preventDefault();
            var cartId = $(this).data('savedcart-id');
            var popupTitle = $(this).data('delete-popup-title');

            ACC.colorbox.open(popupTitle, {
                inline: true,
                className: "js-savedcart_delete_confirm_modal",
                href: "#popup_confirm_savedcart_delete_" + cartId,
                width: '500px',
                onComplete: function () {
                    $(this).colorbox.resize();
                }
            });
        });
    },

    bindDeleteConfirmLink: function () {
        $(document).on("click", '.js-savedcart_delete_confirm', function (event) {
            event.preventDefault();
            var cartId = $(this).data('savedcart-id');
            var url = ACC.config.encodedContextPath + '/my-account/saved-carts/' + cartId + '/delete';
            $.ajax({
                url: url,
                type: 'DELETE',
                success: function (response) {
                    ACC.colorbox.close();
                    var url = ACC.config.encodedContextPath + "/my-account/saved-carts"
                    window.location.replace(url);
                }
            });
        });

        $(document).on("click", '.js-savedcart_delete_confirm_cancel', function (event) {
            ACC.colorbox.close();
        });
    },
    
    bindSaveCartForm: function ()
	{
    	ACC.savedcarts.charactersLeftInit();
		var form = $('#saveCartForm');
		var saveCart = false;
        var showSaveCartFormCallback = function () {
        var title = $('#saveCart').data("saveCartTitle");
          
            ACC.colorbox.open(title, {
                href: "#saveCart",
                inline: true,
                width: "620px",
                onOpen: function () {
                    if ($('#saveCartName').val()) {
                        ACC.savedcarts.disableSaveCartButton(false);
                    }
                },
                onComplete: function () {
                    $(this).colorbox.resize();
                    saveCart = false;
                },
                onClosed: function () {

                    if (saveCart) {
                        form.submit();
                    }
                    document.getElementById("saveCartForm").reset();
                    ACC.savedcarts.disableSaveCartButton(true);
                    ACC.savedcarts.charactersLeftInit();
                }
            });
        };

        $(document).on("click",".js-save-cart-link, .js-update-saved-cart",function(e){
            e.preventDefault();
            ACC.common.checkAuthenticationStatusBeforeAction(showSaveCartFormCallback);
		});
		
		$(document).on("click",'#saveCart #cancelSaveCartButton', function (e) {
			e.preventDefault();
			$.colorbox.close();
		});
		
		$('#saveCartName').on('keyup',function () {		
			// enable the save cart button
	 		$('#saveCart #saveCartButton').prop('disabled', this.value.trim() == "" ? true : false);  	
			// limit the text length 
            var maxchars = 255;
			var value=$('#localized_val').attr('value');
			var tlength = $(this).val().length;
			remain = maxchars - parseInt(tlength);
        	$('#remain').text(value+' : '+remain);
		});
		
         $('#saveCartDescription').on('keyup',function () {
			var maxchars = 255;
			var value=$('#localized_val').attr('value');
			var tlength = $(this).val().length;
			remain = maxchars - parseInt(tlength);
        	$('#remainTextArea').text(value+' : '+remain);
		});
		
		$(document).on("click",'#saveCart #saveCartButton', function (e) {
			e.preventDefault();
			saveCart = true;
			$.colorbox.close();
		});
	},
	
	charactersLeftInit: function() {
	    $('#remain').text($('#localized_val').attr('value')+' : 255');
     	$('#remainTextArea').text($('#localized_val').attr('value')+' : 255');
	},
	
	disableSaveCartButton: function(value) {
		$('#saveCart #saveCartButton').prop('disabled', value);
	},
	

	bindUpdateUploadingSavedCarts : function() {
		var cartIdRowMapping = $(".js-uploading-saved-carts-update").data("idRowMapping");
		var refresh = $(".js-uploading-saved-carts-update").data("refreshCart");
		if (cartIdRowMapping && refresh) {
			var interval = $(".js-uploading-saved-carts-update").data("refreshInterval");
			var arrCartIdAndRow = cartIdRowMapping.split(',');
			var mapCartRow = new Object();
			var cartCodes = [];
			for (i = 0; i < arrCartIdAndRow.length; i++) {
				var arrValue = arrCartIdAndRow[i].split(":");
				if (arrValue != "") {
					mapCartRow[arrValue[0]] = arrValue[1];
					cartCodes.push(arrValue[0]);
				}
			}

			if (cartCodes.length > 0) {
				setTimeout(function() {ACC.savedcarts.refreshWorker(cartCodes, mapCartRow, interval)}, interval);
			}	
		}
	},
	

	refreshWorker : function(cartCodes, mapCartRow, interval) {
		$.ajax({
			dataType : "json",
			url : ACC.config.encodedContextPath	+ '/my-account/saved-carts/uploadingCarts',
			data : {
				cartCodes : cartCodes
			},
			type : "GET",
			traditional : true,
			success : function(data) {
				if (data != undefined) {
					var hidden = "hidden";
					var rowId = "#row-";
					for (i = 0; i < data.length; i++) {
						var cart = data[i];

						var index = $.inArray(cart.code, cartCodes);
						if (index > -1) {
							cartCodes.splice(index, 1)
						}	
						var rowIdIndex = mapCartRow[cart.code]; 
						if (rowIdIndex != undefined) {
							var rowSelector = rowId + rowIdIndex;
							$(rowSelector + " .js-saved-cart-name").removeClass("not-active");
							$(rowSelector + " .js-saved-cart-date").removeClass("hidden");
							$(rowSelector + " .js-file-importing").remove();
							$(rowSelector + " .js-saved-cart-description").text(cart.description);
							var numberOfItems = cart.entries.length;
							$(rowSelector + " .js-saved-cart-number-of-items").text(numberOfItems);
							$(rowSelector + " .js-saved-cart-total").text(cart.totalPrice.formattedValue);
							if (numberOfItems > 0) {
								$(rowSelector + " .js-restore-saved-cart").removeClass(hidden);
							}
							$(rowSelector + " .js-delete-saved-cart").removeClass(hidden);
						}
					}
				};
				
				if (cartCodes.length > 0) {
					setTimeout(function() {ACC.savedcarts.refreshWorker(cartCodes, mapCartRow, interval)}, interval);
				}
			}
		})
	}
}
ACC.pendo = {
  _autoload: ["initializePendo"],

  initializePendo() {
    console.log("Pendo Initialized...");
  },
  _safeGetElementValue(id) {
    const element = document.getElementById(id);
    if (element) {
        return element.value;
    }
    return "";
  },
  _safeGetTrimmedValue(selector) {
    const element = $(selector);
    return $.trim(element.val() || element.text() || "");
  },
  captureEvent(eventType, payload = {}) {
    try {
      // --- Capture User Agent (Browser data) ---
      var uaData =
        navigator.userAgentData &&
        navigator.userAgentData.brands &&
        navigator.userAgentData.brands[0];
      var userAgent = uaData
        ? uaData.brand + "," + uaData.version
        : navigator.userAgent || "";

      // --- Get Email id (plain text) ----
      var accountId;
      if (eventType === "3XGUEST") {
        accountId = ACC.pendo._safeGetTrimmedValue("#emaildata");
      } else {
        accountId = ACC.pendo._safeGetTrimmedValue("#emailaddres");
      }

      // --- Event Payload to BE ------
      var data = {
        type: "track",
        event: eventType,
        timestamp: Date.now(),
        ip: "00.000.000.00",
        userAgent,
        url: window.location.href || "https://www.siteone.com/",
        title: document.title || "siteone - Home",
        emailId: accountId,
        phone: ACC.pendo._safeGetTrimmedValue("#phonedata"),
        kountSessionId:ACC.pendo._safeGetElementValue("kountSessionIdLink"),
        orderNumber: ACC.pendo._safeGetElementValue("orderNumberLink"),
        orderAmount: ACC.pendo._safeGetElementValue("orderAmountLink"),
        listCode: "",
        quoteNumber: "",
      };

      if (
        eventType === "REQUESTQUOTEFAIL" ||
        eventType === "APPROVEQUOTEFAIL"
      ) {
        data = { ...data, ...payload };
      }

      // --- Prepare Pendo Data based on event types ---
      var pendoData;
      if (eventType === "3XGUEST") {
        pendoData = $.extend({}, payload, {
          emailId: accountId,
          phone: ACC.pendo._safeGetTrimmedValue("#phonedata"),
        });
      } else if (eventType === "3XLINK2PAY" || eventType === "LINK2PAYFAIL") {
        pendoData = $.extend({}, payload, {
          kountSessionId:ACC.pendo._safeGetElementValue("kountSessionIdLink"),
          orderNumber: ACC.pendo._safeGetElementValue("orderNumberLink"),
          orderAmount: ACC.pendo._safeGetElementValue("orderAmountLink"),
        });
      } else {
        pendoData = $.extend({}, payload, {
          emailId: accountId,
        });
      }

      // --- Async log to server ---
      $.ajax({
        type: "POST",
        url: `${ACC.config.encodedContextPath}/getPendoEvent`,
        data: data,
        success: (result) => {
          console.log("Pendo event logged from server response:", result);
          // --- Track with Pendo  ---
          if (
            typeof pendo !== "undefined" &&
            typeof pendo.track === "function"
          ) {
            pendo.track(eventType, pendoData);
            console.log("Pendo Trak Triggerd...");
          } else {
            console.warn("Pendo SDK not available.");
          }
        },
        error: (xhr, status, error) => {
          console.error("Pendo log failed:", status, error);
        },
      });
    } catch (err) {
      console.error("Error in captureEvent:", err);
    }
  },
};
ACC.multidgrid = {

	populateAndShowGridOverlay: function(element, event)
	{
		event.preventDefault();

		var itemIndex = $(element).data("index");
		var gridEntries = $('#grid' + itemIndex);

		var strSubEntries = gridEntries.data("sub-entries");
		var productName = gridEntries.data("product-name");
		var arrSubEntries= strSubEntries.split(',');
		var firstVariantCode = arrSubEntries[0].split(':')[0];

		var targetUrl = gridEntries.data("target-url") + '?productCode=' + firstVariantCode;

		ACC.colorbox.open(productName,{
			href: ACC.config.encodedContextPath +  targetUrl,
			className: 'read-only-grid',
			close:'<span class="glyphicon glyphicon-remove"></span>',
			width: window.innerWidth > parseInt(cboxOptions.maxWidth) ? cboxOptions.maxWidth : cboxOptions.width,
			height: window.innerHeight > parseInt(cboxOptions.maxHeight) ? cboxOptions.maxHeight : cboxOptions.height,
			onComplete: function() {

				$('body').addClass('offcanvas');
				var oH = $('#cboxLoadedContent').height();
				$('#cboxLoadedContent').height((oH - $('#cboxTitle').height()) +'px');

			},

			onClosed: function() {
				$('body').removeClass('offcanvas');
			}

		});
	},
	
	populateAndShowGrid: function(element, event, readOnly)
	{
		var itemIndex = $(element).data("index");
		grid = $("#ajaxGrid" + itemIndex);
		var gridEntries = $('#grid' + itemIndex);
		
		$(element).toggleClass('open');
		
		if (!grid.is(":hidden")) {
        	grid.slideUp();
        	return;
        }

		if(grid.html() != "") {
			grid.slideToggle("slow");
			return;
		}

		var strSubEntries = gridEntries.data("sub-entries");
		var arrSubEntries= strSubEntries.split(',');
		var firstVariantCode = arrSubEntries[0].split(':')[0];

		var targetUrl = gridEntries.data("target-url");

		var method = "GET";
		$.ajax({
			url: ACC.config.encodedContextPath + targetUrl,
			cache: false,
			data: {productCode: firstVariantCode},
			type: method,
			success: function(data)
			{
				grid.html(data);
				grid.slideDown("slow");
			},
			error: function(xht, textStatus, ex)
			{
				alert("Failed to get variant matrix. Error details [" + xht + ", " + textStatus + ", " + ex + "]");
			}

		});
	}
};
var ACC = ACC || {}; // make sure ACC is available
var liClone;

if ($("#quickOrder").length > 0) {
    ACC.quickorder = {
        _autoload: [
            "bindClearQuickOrderRow",
            "bindAddSkuInputRow",
            "bindResetFormBtn",
            "bindAddToCartClick",
            "addMoreRow",
			"checkQuantity"
        ],

        $quickOrderContainer: $('.js-quick-order-container'),
        $quickOrderMinRows: Number($('.js-quick-order-container').data('quickOrderMinRows')),
        $quickOrderMaxRows: Number($('.js-quick-order-container').data('quickOrderMaxRows')),
        $productExistsInFormMsg: $('.js-quick-order-container').data('productExistsInFormMsg'),
        $productNotPurchaseble: $('.js-quick-order-container').data('productNotPurchaseble'),
        $quickOrderLeavePageMsg: $('#quickOrder').data('gridConfirmMessage'),
        $hiddenSkuInput: 'input.js-hidden-sku-field',
        $hiddenSkuNameInput: 'input.js-hidden-skuname-field',
        $hiddenProductCategoryInput: 'input.js-hidden-productcategory-field',
        $hiddenProductSubCategoryInput: 'input.js-hidden-productsubcategory-field',
        $hiddeninventoryUOMIDInput: 'input.js-hidden-inventoryUOMID-field',
        $addToCartBtn: $('#js-add-to-cart-quick-order-btn-top, #js-add-to-cart-quick-order-btn-bottom'),
        $resetFormBtn: $('#js-reset-quick-order-form-btn-top, #js-reset-quick-order-form-btn-bottom'),
        $productInfoContainer: '.js-product-info',
        $skuInputField: '.js-sku-input-field',
        $qtyInputField: '.js-quick-order-qty',
        $jsLiContainer: 'li.js-li-container',
        $removeQuickOrderRowBtn: '.js-remove-quick-order-row',
        $skuValidationContainer: '.js-sku-validation-container',
        $qtyValidationContainer: '.js-qty-validation-container',
        $productItemTotal: '.js-quick-order-item-total',
        $classHasError: 'has-error',
        $productText: '.productText',
        productDatalist: {},

        bindResetFormBtn: function () {
            ACC.quickorder.$resetFormBtn.on("click", ACC.quickorder.clearForm);
            
        },

        bindAddToCartClick: function () {
            ACC.quickorder.$addToCartBtn.on("click", ACC.quickorder.addToCart);
        },

        bindAddSkuInputRow: function () {
            $(ACC.quickorder.$skuInputField).on("focusin", ACC.quickorder.addInputRow).on("focusout keydown", ACC.quickorder.handleFocusOutOnSkuInput);
        },

        bindClearQuickOrderRow: function () {
            $(ACC.quickorder.$removeQuickOrderRowBtn).on("mousedown", ACC.quickorder.clearQuickOrderRow);
        },

        addToCart: function () {
            $('#quickOrderQtyError').html("");
            loading.start();

            $.ajax({
                url: ACC.quickorder.$quickOrderContainer.data('quickOrderAddToCartUrl'),
                type: 'POST',
                dataType: 'json',
                contentType: 'application/json',
                data: ACC.quickorder.getJSONDataForAddToCart(),
                success: function (response) { 
                	var products = [];
                	$(ACC.quickorder.$qtyInputField).each(function() {
                	    var qty = Number($(this).val());
                	    if (qty > 0) {
                	        var sku = (ACC.quickorder.findElementInCurrentParentLi(this, ACC.quickorder.$hiddenSkuInput).val()).trim();
                	        var skuName = (ACC.quickorder.findElementInCurrentParentLi(this, ACC.quickorder.$hiddenSkuNameInput).val()).trim();
                	        var productCategory = (ACC.quickorder.findElementInCurrentParentLi(this, ACC.quickorder.$hiddenProductCategoryInput).val()).trim();
                	        var productSubCategory = (ACC.quickorder.findElementInCurrentParentLi(this, ACC.quickorder.$hiddenProductSubCategoryInput).val()).trim();
                	        products.push({
                	            productInfo: {
                	                "productID": sku,
                	                "productName": skuName,
                	                "productCategory": productCategory,
                	                "productSubCategory": productSubCategory,
                	                "addToCartLocation": "quick-order"
                	            }
                	        });
                	    }
                	});
                	
                	var cartItems = $(".mini-cart-link").data("miniCartItemsText");
         	        var miniCartRefreshUrl = $(".mini-cart-link").data("miniCartRefreshUrl");
         	        $.ajax({
         	            url: miniCartRefreshUrl,
         	            cache: false,
         	            type: 'GET',
         	            success: function(jsonData){
         	            	if ($('#isAnonymous').val() == "false"){
         	       			var currentCartId= $("#currentCartId").val();
         	            	}
         	          	  else{
         	          		var currentCartId= $("#anonymousCartId").val();
         	          	  }
         	            	 if($(".nav-cart .js-mini-cart-count .nav-items-total:visible").text().trim() === "0"){ 
         	            		digitalData.cart = {
         	            				cartId: currentCartId,
         	            				event :  "scOpen, scAdd",
         	                			
         	                	};
         	            	}
         	            	else
         	            	{
         	            		digitalData.cart = {
         	            				cartId: currentCartId,
         	            				event :  "scAdd",
         	                			
         	                	};	
         	            	}
         	            	 try {
         	                	    _satellite.track("Add Cart");
         	                	} catch (e) {} 
         	               }
         	           
         	        });
                	
         	        digitalData.product = products;                	
                	
         	        ACC.quickorder.handleAddToCartSuccess(response);

                    var productsForRDT = $.map(products, function(product) {
                        return {
                            id: product.productInfo.productID,
                            name: product.productInfo.productName,
                            category: product.productInfo.productCategory
                        }
                    });
                    rdt("track", "AddToCart", {
                        currency: "USD",
                        itemCount: products.length,
                        value: '',
                        products: productsForRDT
                    });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // log the error to the console
                    console.log("The following error occurred: " + textStatus, errorThrown);
                }
            }).always(function(){
                loading.stop();
            });
        },

        handleAddToCartSuccess: function (response) {
            if ($(response.quickOrderErrorData).length > 0) {
                ACC.quickorder.disableBeforeUnloadEvent();
            }
            var lookup = {};
            response.quickOrderErrorData.forEach(function (el) {
                lookup[el.sku] = el.errorMsg;
            });

            $(ACC.quickorder.$qtyInputField).each(function () {
                var parentLi = ACC.quickorder.getCurrentParentLi(this);
                var sku = ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuInputField).val();
                var errorMsg = lookup[sku];
				if (errorMsg) {
                    ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text(errorMsg);
                }
                else {
                    	//ACC.quickorder.findElement(parentLi, ACC.quickorder.$removeQuickOrderRowBtn).trigger("mousedown");
                    	ACC.quickorder.findElement(parentLi, ACC.quickorder.$productInfoContainer).remove();
                        ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text('');
                        ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuInputField).val('');
                        ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenSkuInput).val('');
                        //ACC.quickorder.findElement(parentLi, ACC.quickorder.$removeQuickOrderRowBtn).remove();
                        $(parentLi).find(ACC.quickorder.$removeQuickOrderRowBtn).addClass('hidden');
                        $('.price-unavailable-msg').addClass('hidden');
                        ACC.quickorder.enableDisableAddToCartBtn();
                        ACC.quickorder.handleBeforeUnloadEvent();
                        
                        var quickOrderMinRows = ACC.quickorder.$quickOrderMinRows;
                        if ($('.js-ul-container li.js-li-container').length > quickOrderMinRows) {
                            parentLi.remove();
                            ACC.quickorder.bindClearQuickOrderRow();
                        }
                    
                }
            });

            ACC.quickorder.handleBeforeUnloadEvent();
            $(window).scrollTop(0);
            ACC.product.displayAddToCartPopup(response);
        },

        getJSONDataForAddToCart: function () {
            var skusAsJSON = [];
            $(ACC.quickorder.$qtyInputField).each(function () {
                var qty = Number($(this).val());
                if (qty > 0) {
                    var sku = (ACC.quickorder.findElementInCurrentParentLi(this, ACC.quickorder.$hiddenSkuInput).val()).trim();
                    var inventoryUOMID = (ACC.quickorder.findElementInCurrentParentLi(this, ACC.quickorder.$hiddeninventoryUOMIDInput).val()).trim();
                    
                    skusAsJSON.push({"product": {"code": sku}, "quantity": qty, "uomId":inventoryUOMID});
                }
            });
            return JSON.stringify({"cartEntries": skusAsJSON});
        },

        handleFocusOutOnSkuInput: function (event) {

            var key = event.charCode ? event.charCode : event.keyCode ? event.keyCode : 0;
            if (key == 13) {
                $(event.target).focusout();
            }
            if (event.type == "focusout")
            {
                if($(event.target).val()!='') 
                {
                    loading.start();
                }
                var parentLi = ACC.quickorder.getCurrentParentLi(event.target);
                var productCode = (event.target.value).trim();
                if(productCode != null && productCode != undefined && productCode != '') 
                {
                    if(ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenSkuInput).val() == '') 
                    {
                        ACC.quickorder.handleGetProduct(event);
                        ACC.quickorder.handleBeforeUnloadEvent();
                    } else {
                        loading.stop();
                    }
                }
                else
                {
                    ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text('');
                }

            }
        },

        handleFocusOutOnQtyInput: function (event) {
            $('#quickOrderQtyError').html("");
            var key = event.charCode ? event.charCode : event.keyCode ? event.keyCode : 0;
            if (key == 13) {    
                event.preventDefault();
                var parentLi = ACC.quickorder.getCurrentParentLi(event.target);             
                parentLi.next().find(ACC.quickorder.$skuInputField).focus();
                $(event.target).focusout();
            }
            if (event.type == "focusout") {
                ACC.quickorder.validateAndUpdateItemTotal(event);
                ACC.quickorder.enableDisableAddToCartBtn();
            }
        },

        clearForm: function () {
            $(document).ready(function(){
                window.location.reload();
                $(this).scrollTop(0);
            });
        },

        validateAndUpdateItemTotal: function (event) {
            var parentLi = ACC.quickorder.getCurrentParentLi(event.target);
            var qtyValue = (ACC.productorderform.filterSkuEntry($(event.target).val())).trim();
            if (isNaN(qtyValue) || qtyValue == "") 
            {
                if(ACC.quickorder.$classHasError == "has-error")
                {
                    $("#quickOrderQtyError").html("<div class='bg-danger' style='margin:10px 0px;'><div class='panel-body'><font color='red'>"+ACC.config.productDetail+"</font></div></div> ");
                }
                qtyValue = 0;
                $(event.target).removeClass(ACC.quickorder.$classHasError);
                ACC.quickorder.findElement(parentLi, ACC.quickorder.$qtyValidationContainer).text('');
                $(event.target).val(0);
            }
            else 
            {
                qtyValue = Number(qtyValue);
                $(event.target).val(qtyValue);
                /*var maxQty = (ACC.quickorder.findElement(parentLi, ACC.quickorder.$qtyInputField).data('maxProductQty')).trim();*/
                var maxQty = "";
                var stockLevelStatus = (ACC.quickorder.findElement(parentLi, ACC.quickorder.$qtyInputField).data('stockLevelStatus')).trim();
                maxQty = ($.isEmptyObject(maxQty)) ? "FORCE_IN_STOCK" : Number(maxQty);
                if (!isNaN(maxQty) && qtyValue > maxQty) 
                {
                    $(event.target).addClass(ACC.quickorder.$classHasError);
                    var qtyValidationContainer = ACC.quickorder.findElement(parentLi, ACC.quickorder.$qtyValidationContainer);
                    qtyValidationContainer.text(qtyValidationContainer.data('maxProductQtyMsg'));
                    qtyValue = maxQty;
                    $(event.target).val(maxQty);
                }
                else 
                {
                    $(event.target).removeClass(ACC.quickorder.$classHasError);
                    ACC.quickorder.findElement(parentLi, ACC.quickorder.$qtyValidationContainer).text('');
                }
            }

            if (qtyValue > 0) {
                 var formatter = new Intl.NumberFormat('en-US', {
                  style: 'currency',
                  currency: 'USD',
                  minimumFractionDigits: 2,
                 });
                 
                var price = (ACC.quickorder.findElement(parentLi, '.js-product-price').data('productPrice')).split('$')[1].replace(",", "");
                var itemPrice = parseFloat(price);
                ACC.quickorder.findElement(parentLi, ACC.quickorder.$productItemTotal)
                    .html(formatter.format(itemPrice * qtyValue));
                    
            }
            else {
                ACC.quickorder.findElement(parentLi, ACC.quickorder.$productItemTotal).text('');
            }
        },

        clearQuickOrderRow: function () {
            var quickOrderMinRows = ACC.quickorder.$quickOrderMinRows;
            var parentLi = ACC.quickorder.getCurrentParentLi(this);
            if ($('.js-ul-container li.js-li-container').length > quickOrderMinRows) {
                parentLi.remove();
                ACC.quickorder.bindClearQuickOrderRow();
            }
            else {
                ACC.quickorder.findElement(parentLi, ACC.quickorder.$productInfoContainer).remove();
                ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text('');
                ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuInputField).val('');
                ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenSkuInput).val('');
            }
            $(parentLi).find(ACC.quickorder.$removeQuickOrderRowBtn).addClass('hidden');
            $('.price-unavailable-msg').addClass('hidden');
            $(parentLi).find(ACC.quickorder.$productText).removeClass('productText');
            ACC.quickorder.enableDisableAddToCartBtn();
            ACC.quickorder.handleBeforeUnloadEvent();
        },

        addInputRow: function (event) {

            if ($('.js-quick-order-container li.js-li-container:last-child').find(ACC.quickorder.$skuInputField).is($(event.target)) &&
                $(ACC.quickorder.$jsLiContainer).length < ACC.quickorder.$quickOrderMaxRows) {
                
            	liClone = $('.js-quick-order-container li.js-li-container').first().clone();
                $(liClone).find(ACC.quickorder.$removeQuickOrderRowBtn).addClass('hidden');
                ACC.quickorder.findElement(liClone, ACC.quickorder.$productInfoContainer).remove();
                ACC.quickorder.findElement(liClone, ACC.quickorder.$skuValidationContainer).text('');
                ACC.quickorder.findElement(liClone, ACC.quickorder.$hiddenSkuInput).val('');
                var currentSkuInputField = ACC.quickorder.findElement(liClone, ACC.quickorder.$skuInputField);
                currentSkuInputField.val('');
                currentSkuInputField.focusin(ACC.quickorder.addInputRow).focusout(ACC.quickorder.handleFocusOutOnSkuInput).keydown(ACC.quickorder.handleFocusOutOnSkuInput);
                ACC.quickorder.findElement(liClone, ACC.quickorder.$removeQuickOrderRowBtn).click(ACC.quickorder.clearQuickOrderRow);
              
                $(".item__list--item:last-child").click(function() {
                	
                	$('.js-ul-container').append(liClone);

                });
               
                
               
            }
        },

        handleGetProduct: function (event) {
            var parentLi = ACC.quickorder.getCurrentParentLi(event.target);
            var productCode = (event.target.value).trim();
            $(event.target).val(productCode);
            if (!ACC.quickorder.isCurrentSkuSameAsPrevious(parentLi, productCode)) {
                if (productCode.length > 0) {
                    ACC.quickorder.findElement(parentLi, ACC.quickorder.$productInfoContainer).remove();

                   /* if (ACC.quickorder.isDuplicateSku(event.target, productCode)) 
                    {
                        ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text(ACC.quickorder.$productExistsInFormMsg);
                    }
                    else 
                    {*/
                        ACC.quickorder.getAndDisplayProductInfo(event, parentLi, productCode);
                   // }
                    //ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenSkuInput).val(productCode);
                }
                else 
                {
                    $(event.target).removeClass(ACC.quickorder.$classHasError);
                    ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text('');
                    ACC.quickorder.findElement(parentLi, ACC.quickorder.$productInfoContainer).remove();
                }
            }
        },

        isCurrentSkuSameAsPrevious: function (parentLi, productCode) {
            return ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenSkuInput).val() == productCode;
        },

        isDuplicateSku: function (currentInput, productCode) {
            var exists = false;
            $(ACC.quickorder.$hiddenSkuInput).each(function () {
                if ($(this).val() == productCode && !$(this).is($(currentInput))) {
                    exists = true;
                    return false
                }
            });
            return exists;
        },
        
        

        getAndDisplayProductInfo: function (event, parentLi, productCode) {
            if(!$(event.target).prop("disabled")){
            var url = ACC.config.encodedContextPath + '/quickOrder/productInfo?code=' + encodeURIComponent(productCode);
            $.getJSON(url, function (result) 
            {
                loading.stop();
                $(event.target).prop("disabled",false);
                if (result.errorMsg != null && result.errorMsg.length > 0) 
                {
                    $(event.target).addClass(ACC.quickorder.$classHasError);
                    ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text(result.errorMsg);
                }
                else
                {                   
                    var currentHiddenInputSku = ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenSkuInput);
                    if(result.productDataList.length == 1)
                    {
						if (ACC.quickorder.isDuplicateSku(currentHiddenInputSku, result.productDataList[0].code)) 
                        {
                            ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text(ACC.quickorder.$productExistsInFormMsg);
                        } else {
							ACC.quickorder.populateProductData(event,parentLi,result.productDataList[0]);
                            
                        }
                    }
                    else
                    {
                        ACC.quickorder.productDatalist = result.productDataList;
                        var productList = ACC.quickorder.productDatalist;
                        var popupContent = "<div class='PopupBox'>";
                        for(var i =0;i<productList.length;i++)
                        {
                            popupContent = popupContent + "<a class='popupProduct' data-code='" + i + "' data-index='" + $('.js-li-container').index(parentLi) + "' href='#'>" + (productList[i].itemNumber) + "<a/><br/>";
                        }
                        popupContent = popupContent + "</div>";
                        var title = "Select the Product";
                         ACC.colorbox.open(title, {
                                 html: popupContent,
                                 maxWidth:"100%",
                                 width:"600px",
                                 initialWidth :"380px"
                                 });
                        
                        
                    }
                }
                    ACC.quickorder.enableDisableAddToCartBtn();
            });
            }else{
                loading.stop();
                ACC.quickorder.enableDisableAddToCartBtn();
                return false;
            }
        },

        populateProductData: function (event, parentLi, productData) 
        {
	        if(null != productData.salePrice && productData.salePrice !=undefined)
            {
            var formatter = new Intl.NumberFormat('en-US', {
                  style: 'currency',
                  currency: 'USD',
                  minimumFractionDigits: 2,
             });
            productData.salePrice=formatter.format(productData.salePrice);
            }
            
            if(null != productData.storeStockAvailabilityMsg && productData.storeStockAvailabilityMsg != undefined)
            {
                 var status = productData.storeStockAvailabilityMsg;
            }

           if(productData.inStockImage==true){
        	   if(productData.isStockInNearbyBranch==true)
        	   {
        		   status = '<img src="/_ui/responsive/theme-lambda/images/nearby-icon.svg" alt=""/>' + '<p>' + status + '</p>';
        	   }
        	   else
        	   {
        		   status = '<img src="/_ui/responsive/theme-lambda/images/in-stock-icon.svg" alt=""/>' + '<p>' + status + '</p>';
        	   }
                
            } else if(productData.notInStockImage==true){
                status = '<img src="/_ui/responsive/theme-lambda/images/back-order-icon.svg" alt=""/>' + '<p>' + status + '</p>';
            } else if(productData.outOfStockImage==true){
                status = '<img src="/_ui/responsive/theme-lambda/images/non-stock-icon.svg" alt=""/>' +  '<p>' + status + '</p>';
            }
            $(event.target).removeClass(ACC.quickorder.$classHasError);
            $(event.target).addClass('productText');
            ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text('');
            $('#quickOrderRowTemplate').tmpl(productData).insertAfter(ACC.quickorder.findElement(parentLi, '.js-sku-container'));
            
            if(null != status && status != undefined)
            {
                var element = '.item__stock_'+productData.code;
                $(element).html(status);
            }
            
            var qtyInputField = ACC.quickorder.findElement(parentLi, ACC.quickorder.$qtyInputField);
            qtyInputField.focusout(ACC.quickorder.handleFocusOutOnQtyInput).keydown(ACC.quickorder.handleFocusOutOnQtyInput);
            var stockLevelStatus = productData.stock.stockLevelStatus.code;
            if (!productData.isSellable) 
            {
                qtyInputField.val(0);
                qtyInputField.prop('disabled', true);
                $('#quickorderminusqtybtn_'+productData.code).prop('disabled', true);
                $('#quickorderplusqtybtn_'+productData.code).prop('disabled', true);
            }
            else 
            {
                qtyInputField.focus().select();
            }
            ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenSkuInput).val(productData.code);
            ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenProductCategoryInput).val(productData.level1Category);
            ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenProductSubCategoryInput).val(productData.level2Category); 
            ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddeninventoryUOMIDInput).val(productData.sellableUoms[0].inventoryUOMID);
            ACC.quickorder.enableDisableAddToCartBtn();
            $(parentLi).find(ACC.quickorder.$removeQuickOrderRowBtn).removeClass('hidden');
            
        },
        
        handleBeforeUnloadEvent: function () {
            if (ACC.quickorder.isAnySkuPresent()) {
                ACC.quickorder.disableBeforeUnloadEvent();
                ACC.quickorder.enableBeforeUnloadEvent();
            }
            else {
                ACC.quickorder.disableBeforeUnloadEvent();
            }
        },

        disableBeforeUnloadEvent: function () {
            $(window).off('beforeunload', ACC.quickorder.beforeUnloadHandler);
        },

        enableBeforeUnloadEvent: function () {
            $(window).on('beforeunload', ACC.quickorder.beforeUnloadHandler);
        },

        beforeUnloadHandler: function () {
            return ACC.quickorder.$quickOrderLeavePageMsg;
        },

        enableDisableAddToCartBtn: function () {
	        var addToCartButtonEnabled = ACC.quickorder.shouldAddToCartBeEnabled();
            var isOrderingAccount =$('#isOrderingAccount').val();
            
            if(isOrderingAccount == 'false'){
                ACC.quickorder.$addToCartBtn.attr('disabled', 'disabled');
                $('#TopOrderingAccountMsg').show();
                $('#BottomOrderingAccountMsg').show();
            }
            
            // if there are no items to add, disable addToCartBtn, otherwise, enable it
            if (addToCartButtonEnabled) {
                ACC.quickorder.$addToCartBtn.removeAttr('disabled');
            } else {
                ACC.quickorder.$addToCartBtn.attr('disabled', 'disabled');
            }
        },
        
        shouldAddToCartBeEnabled: function () {
            var sum = 0;
            var enable = true;
            var totalItems = 0;
            var isQtyExceeded=false


            $(ACC.quickorder.$qtyInputField).each(function () {
                var qty = Number($(this).val());
                if (qty > 0)
                {
                    totalItems = totalItems + 1;
                }
            });
            
            $(ACC.quickorder.$qtyInputField).each(function () {
                var qty = Number($(this).val());
				if (($(this).data('stock-level-status') === "outOfStock") && totalItems==0){
					enable=false;
				}
                if (qty > 0)
                {
                var str = this.value.trim();
                // .trim() may need a shim
                if (str) 
                {   // don't send blank values to `parseInt`
                    sum += parseInt(str, 10);
                        if (str == 0) {
                        var result=totalItems-1;
                        if(result==0)
                        {
                            ACC.quickorder.$addToCartBtn.html(ACC.config.quickAdd+" "+ACC.config.quickCart);
                        }
                        else if(result>0)
                        {
                            ACC.quickorder.$addToCartBtn.html(ACC.config.quickAdd+" "+ result +" "+ACC.config.quickCart);
                        }
                        else
                        {
                            ACC.quickorder.$addToCartBtn.html(ACC.config.quickAdd+" "+ totalItems +" "+ACC.config.quickCart);
                        }
                     
                    }
                    
                    ACC.quickorder.$addToCartBtn.html(ACC.config.quickAdd+" "+"["+ totalItems +"]"+" "+ACC.config.quickCart);  

                    }
                    if ($(this).data('is-nursery') === "Nursery") {
                        if ($(this).val().trim() > $(this).data("max-product-qty")) {
                            isQtyExceeded = true;
                                                   }
                    }
                    if (sum === 0 || isQtyExceeded) {
                        enable = false;
                       
                    }
                }
            });
            
            if(!enable && totalItems == 0)
            {
                ACC.quickorder.$addToCartBtn.html(ACC.config.quickAdd+" "+ACC.config.quickCart);
            } else if(totalItems == 0){
				enable = false;
				ACC.quickorder.$addToCartBtn.html(ACC.config.quickAdd+" "+ACC.config.quickCart);
			}

            
            return enable;
        },

        isAnySkuPresent: function () {
            var present = false;
            $(ACC.quickorder.$skuInputField).each(function () {
                var str = (this.value).trim();  // .trim() may need a shim
                if (str) {
                    present = true;
                    return false;
                }
            });
            return present;
        },

        getCurrentParentLi: function (currentElement) {
            return $(currentElement).closest(ACC.quickorder.$jsLiContainer);
        },

        findElement: function (currentElement, toFind) {
            return $(currentElement).find(toFind);
        },
		checkQuantity:function(){
            function validateQuantityQuickOrder(elem){
	            $(elem).closest(".cart-mb-border").find(".qorder-qty-alert").addClass("hide");
			    $(elem).removeClass("text-red border-red");
			    if ($(elem).data('is-nursery')==="Nursery") {	
				if ($(elem).val().trim() > $(elem).data("max-product-qty")) {
                    $(elem).closest(".cart-mb-border").find(".qorder-qty-alert").removeClass("hide");
				$(elem).addClass("text-red border-red");
				 ACC.quickorder.$addToCartBtn.attr('disabled', 'disabled');
					}
				else{
					ACC.quickorder.enableDisableAddToCartBtn();
				}
			}
            }
			$(document).on("input",ACC.quickorder.$qtyInputField,function() {
                validateQuantityQuickOrder(this);
        })
        $(document).on("updated-qty", function (e) {
            var element=$(e.target).siblings('.js-quick-order-qty');
            validateQuantityQuickOrder(element);
        })
		},
		        
        addMoreRow: function ()
        {
            $(document).on("click","#link",function() 
            {  
                 var min=$('.js-quick-order-container li.js-li-container').first();
                 var minRows = ACC.quickorder.$quickOrderMinRows;
                 var rowCount = $(ACC.quickorder.$skuInputField).length;
                  
                 if(rowCount < 25) {
                	 
                	 if(rowCount > 20) {
                		 minRows = 25 - rowCount;
                	 }
                     for (var min = 0; min < minRows ; min++) 
                     {
                     var liClone = $('.js-quick-order-container li.js-li-container').first().clone();
                     $(liClone).find(ACC.quickorder.$removeQuickOrderRowBtn).addClass('hidden');
                     ACC.quickorder.findElement(liClone, ACC.quickorder.$productInfoContainer).remove();
                     ACC.quickorder.findElement(liClone, ACC.quickorder.$skuValidationContainer).text('');
                     ACC.quickorder.findElement(liClone, ACC.quickorder.$hiddenSkuInput).val('');
                     var currentSkuInputField = ACC.quickorder.findElement(liClone, ACC.quickorder.$skuInputField);
                     currentSkuInputField.val('');
                     currentSkuInputField.focusin(ACC.quickorder.addInputRow).focusout(ACC.quickorder.handleFocusOutOnSkuInput).keydown(ACC.quickorder.handleFocusOutOnSkuInput);
                     ACC.quickorder.findElement(liClone, ACC.quickorder.$removeQuickOrderRowBtn).click(ACC.quickorder.clearQuickOrderRow);
                     $('.js-ul-container').append(liClone);
                 }
                 }
                 
            });
            
            $(document).on("click",".popupProduct",function() 
                    { 
                        var productCodeIndex = $(this).data("code");
                        var index = $(this).data("index");
                        var parentLi = $('.js-li-container')[index];
                        var event = jQuery.Event("focusout");
                        var target = $('.js-sku-input-field')[index];
                        event.target = target;
                        var product = ACC.quickorder.productDatalist[productCodeIndex];
                        var liClone = $('.js-quick-order-container li.js-li-container').first().clone();
                        var currentSkuInputField = ACC.quickorder.findElement(liClone, ACC.quickorder.$skuInputField);
                        ACC.colorbox.close();
                        if (ACC.quickorder.isDuplicateSku(event.target, product.code)) {
                            ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text(ACC.quickorder.$productExistsInFormMsg);
                        } else {
                            ACC.quickorder.findElement(parentLi, ACC.quickorder.$hiddenSkuInput).val(product.code);
                            if(product.purchasable==true)
                            {
                                ACC.quickorder.populateProductData(event,parentLi,product);
                            }else
                            {
                                 ACC.quickorder.findElement(parentLi, ACC.quickorder.$skuValidationContainer).text("Product cannot be purchased. Please enter another SKU");
                            }
                        }
                        
                    });
        },

        findElementInCurrentParentLi: function (currentElement, toFind) {
            return $(currentElement).closest(ACC.quickorder.$jsLiContainer).find(toFind);
        }
    };
    
    $(document).on("keydown", '.js-quick-order-qty', function (e) {

        if (($(this).val() != " " && ((e.which >= 48 && e.which <= 57 ) || (e.which >= 96 && e.which <= 105 ))  ) || e.which == 8 || e.which == 46 || e.which == 37 || e.which == 39 || e.which == 9) {
        }
 
        else {
            e.preventDefault();
        }
    })
    
    
    $(document).on("click", '.js-update-entry-quantity-list-btn', function (e) {

        var $target=$(e.target);
        var qty=$(this).siblings('.js-quick-order-qty').val();
        if(qty && !isNaN(qty) ){
            qty=Number(qty);
        }else{
            qty=0;
        }
        if($target.hasClass("plusQty")){
            if(qty<9999){
            	$(this).siblings('.js-quick-order-qty').val(qty+1);
            }
        }else{
            if(qty>0){
            	$(this).siblings('.js-quick-order-qty').val(qty-1);
            }
        }
        $(this).siblings('.js-quick-order-qty').blur();
        $(this).siblings('.js-quick-order-qty').focus();
        $(this).trigger('updated-qty');
        return false;
    })
}
 
ACC.csvimport = {
    TEXT_CSV_CONTENT_TYPE: 'text/csv',
    APP_EXCEL_CONTENT_TYPE: 'application/vnd.ms-excel',

    _autoload: [
        ["changeFileUploadAppearance", $(".js-file-upload").length != 0],
        ["bindImportCSVActions", $(".js-import-csv").length != 0],
        "bindAutoLoadError",
	    "showHideListOption"
    ],

    changeFileUploadAppearance: function() {
        $('.js-file-upload__input').on('change',function () {
            var files = (this.files);
            var fileNames = "";

            for (var i = 0; i < files.length; i++) {
                fileNames += (files[i].name) + '<br/>';

            }

            $('.js-file-upload__file-name').unbind('mouseenter mouseleave');

            if (files.length > 1) {
                $('.js-file-upload__file-name').html(files.length + " files");
                $('.js-file-upload__file-name').hover(

                    function mouseIn() {
                        $(this).html(fileNames.toLowerCase());
                    }, function mouseOut() {

                        $(this).html(files.length + " files");
                    }
                );
            } else {
                $('.js-file-upload__file-name').html(fileNames.toLowerCase());
            }

            if($('.js-file-upload').parents('#cboxLoadedContent').length > 0){
                ACC.colorbox.resize();
            }
        })
    },

    bindImportCSVActions: function() {
        $('#chooseFileButton').on('click', function (event) {
            ACC.csvimport.clearGlobalAlerts();
        });

        $('#importButton').on('click', function (event) {
            event.preventDefault();
            ACC.csvimport.clearGlobalAlerts();

            if (!($('.js-file-upload__input').val().trim().length > 0)) {
                ACC.csvimport.displayGlobalAlert({type: 'error', messageId: 'import-csv-no-file-chosen-error-message'});
                return;
            }

            var selectedFile = document.getElementById('csvFile').files[0];
            if (!ACC.csvimport.isSelectedFileValid(selectedFile)) {
                return;
            }

            var form = document.getElementById('importCSVSavedCartForm');
            var formData = new window.FormData(form);
            formData.append("csvFile", selectedFile);

            ACC.csvimport.displayGlobalAlert({type: 'warning', messageId: 'import-csv-upload-message'});
            ACC.csvimport.enableDisableActionButtons(false);

            $.ajax({
                url: form.action,
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                success: function() {
                    ACC.csvimport.displayGlobalAlert({type: 'info', message: ''});
                   
                    $('#import-csv-alerts .alert-info').append($('#import-csv-success-message').html());
                    ACC.csvimport.clearChosenFile();
                },
                error: function(jqXHR) {
                    if (jqXHR.status == 400) {
                        if (jqXHR.responseJSON) {
                            ACC.csvimport.displayGlobalAlert({type: 'error', message: jqXHR.responseJSON});
                            return;
                        }
                    }

                    ACC.csvimport.displayGlobalAlert({type: 'error', messageId: 'import-csv-generic-error-message'});
                },
                complete: function() {
                    ACC.csvimport.enableDisableActionButtons(true);
                }
            });
        });
    },
    bindAutoLoadError:function(){
    	
      var searchParam = $("#csvList").val();
var listCode=$("#uploadListCode").val();
  var href= ACC.config.encodedContextPath + '/savedList/downloadErrorCSVFile/'+($("#csvList").val()).trim();
    	var fileMsg=$.cookie("uploadFail");
    	 //Empty case
    	if (fileMsg=='uploadEmpty'){
        	ACC.colorbox.open("", {
                html: '<div class="PopupBox col-md-12 col-xs-12"><div class="row">'+ACC.config.csvfileEmpty+'</div><div class="row"><button class="btn btn-primary marginTop20 closethispopup">Select File to Upload</button></div></div>',
                width: "500px",     
                title:'<div class="headline"> '+ACC.config.csvfailedUploadTitle+'</div>',
                close:'<span class="glyphicon glyphicon-remove"></span>',
				className:"upload-list-msg",
                onComplete:function(){ 
                	$(document).on("click",".closethispopup", function(e){
                        ACC.colorbox.close();
               $.cookie("uploadFail", null, { path: '/' });
                    });
                	$('input[id="uploadList"]').prop('checked', true);
            		$('input[id="addProducts"]').prop('checked', false);
            		$('.adding-products').hide(); 
        	    	$('.uploadList-sec').show();
        	    	
        	    	
                },
	        	onClosed: function() {
					$.cookie("uploadFail", null, { path: '/' });
				}
            });


        }
    	 //Max Products Exceeded
    	if (fileMsg=='uploadExceeded'){
        	ACC.colorbox.open("", {
                html: '<div class="PopupBox col-md-12 col-xs-12"><div class="row">'+ACC.config.csvfileLimitExceeds+'</div><div class="row"><button class="btn btn-primary marginTop20 closethispopup">Select File to Upload</button></div></div>',
                width: "500px",     
                title:'<div class="headline"> '+ACC.config.csvfailedUploadTitle+'</div>',
                close:'<span class="glyphicon glyphicon-remove"></span>',
				className:"upload-list-msg",
                onComplete:function(){ 
                	$(document).on("click",".closethispopup", function(e){
                        ACC.colorbox.close();
               $.cookie("uploadFail", null, { path: '/' });
                    });
                	$('input[id="uploadList"]').prop('checked', true);
            		$('input[id="addProducts"]').prop('checked', false);
            		$('.adding-products').hide(); 
        	    	$('.uploadList-sec').show();
        	    	
        	    	
                },
	        	onClosed: function() {
					$.cookie("uploadFail", null, { path: '/' });
				}
            });


        }
        
        //Error

		if (fileMsg=='uploadError' || (fileMsg=='uploadSuccess' && searchParam!='')){
		ACC.colorbox.open("", {
		html: '<div class="PopupBox col-md-12 col-xs-12"><div class="row">'+ACC.config.csverrorMsg+'</div><div class="row"><button class="btn btn-default marginTop20 closethispopup"><a href="'+href+'">'+ACC.config.csverrorBtn+'</a></button></div></div>',
		width: "500px",
		title:'<div class="headline">'+ACC.config.csverrorTitle+'</div>',
		close:'<span class="glyphicon glyphicon-remove"></span>',
		className:"upload-list-msg",
		onComplete:function(){
		$(document).on("click",".closethispopup", function(e){
		ACC.colorbox.close();
		$.cookie("uploadFail", null, { path: '/' });
		
		});
		},
		onClosed: function() {
		//window.location.reload();
		$.cookie("uploadFail", null, { path: '/' });
		}
		   });
        }
        // Successful 
        if (fileMsg=='uploadSuccess' && searchParam==''){
        	
        	
        	ACC.colorbox.open("", {
                html: '<div class="PopupBox col-md-12 col-xs-12"><div class="row"><a href="'+ACC.config.encodedContextPath+'/savedList/listDetails?code='+listCode+'" class="btn btn-primary closethispopup">'+ACC.config.viewlistBtn+'</a></div></div>',
                width: "500px",     
                title:'<div class="headline">Your file upload was successful</div>',
                close:'<span class="glyphicon glyphicon-remove"></span>',
				className:"upload-list-msg",
                onComplete:function(){ 
                	
                	digitalData.eventData={

                			listUploadPage: 'Create List Page'

                			} 
                			try {
                			_satellite.track("uploadListCompletion");
                			} catch (e) {}
                			
                			
                	$(document).on("click",".closethispopup", function(e){
                        ACC.colorbox.close();
						$.cookie("uploadFail", null, { path: '/' });
                    });

                },
	        	onClosed: function() {
					//window.location.reload();
					$.cookie("uploadFail", null, { path: '/' });
				}
            });
        }
        $(document).bind('cbox_closed', function(){
    		$(".uploaderror").val('');
    		$(".uploadsuccess").val('');
    		$('input[id="uploadList"]').prop('checked', true);
    		$('input[id="addProducts"]').prop('checked', false);
    		$('.adding-products').hide(); 
	    	$('.uploadList-sec').show();
	    	$.cookie("uploadFail", null, { path: '/' });
    	});
         
    },
    
    showHideListOption: function(){
    	//$('input[id="addProducts"]').prop('checked', true);
    	$('input[type="radio"]').click(function() {
    	       if($(this).attr('id') == 'uploadList') {
    	            $('.adding-products').hide(); 
    	            $('.uploadList-sec').show();
    	            $('input[id="addProducts"]').prop('checked', false);
    	       }

    	       else {
    	    	   $('.adding-products').show();
    	    	   $('.uploadList-sec').hide();
    	    	   $('input[id="uploadList"]').prop('checked', false);
    	    	   
    	       }
    	   });
    	 
    	
    },
    
    
    isSelectedFileValid: function(selectedFile) {
        if (window.File && window.Blob) {
            if (selectedFile) {
                if (!(selectedFile.type == ACC.csvimport.TEXT_CSV_CONTENT_TYPE ||
                    selectedFile.type == ACC.csvimport.APP_EXCEL_CONTENT_TYPE)) {
                    ACC.csvimport.displayGlobalAlert({type: 'error', messageId: 'import-csv-file-csv-required'});
                    return false;
                }

                var fileName = selectedFile.name;
                if (!fileName || !(/\.csv$/i).test(fileName)) {
                    ACC.csvimport.displayGlobalAlert({type: 'error', messageId: 'import-csv-file-csv-required'});
                    return false;
                }
            }

            var fileMaxSize = $('.js-file-upload__input').data('file-max-size');
            if (!isNaN(fileMaxSize) && selectedFile) {
                if (selectedFile.size > parseFloat(fileMaxSize)) {
                    ACC.csvimport.displayGlobalAlert({type: 'error', messageId: 'import-csv-file-max-size-exceeded-error-message'});
                    return false;
                }
            }
        }

        return true;
    },

    displayGlobalAlert: function(options) {
        ACC.csvimport.clearGlobalAlerts();
        var alertTemplateSelector;

        switch (options.type) {
            case 'error':
                alertTemplateSelector = '#global-alert-danger-template';
                break;
            case 'warning':
                alertTemplateSelector = '#global-alert-warning-template';
                break;
            default:
                alertTemplateSelector = '#global-alert-info-template';
        }

        if (typeof options.message != 'undefined') {
            $('#import-csv-alerts').append($(alertTemplateSelector).tmpl({message: options.message}));
        }

        if (typeof options.messageId != 'undefined')
        {
            
        	ACC.colorbox.open("", {
                html: '<div class="PopupBox col-md-12 col-xs-12"><div class="row">'+ACC.config.csvfileSizeExceeds+'</div><div class="row"><button class="btn btn-primary marginTop20 closethispopup">Select File to Upload</button></div></div>',
                width: "500px",     
                title:'<div class="headline"> '+ACC.config.csvfailedUploadTitle+'</div>',
                close:'<span class="glyphicon glyphicon-remove"></span>',
				className:"upload-list-msg",
                onComplete:function(){ 
                	$(document).on("click",".closethispopup", function(e){
                        ACC.colorbox.close();
               $.cookie("uploadFail", null, { path: '/' });
                    });
                	$('input[id="uploadList"]').prop('checked', true);
            		$('input[id="addProducts"]').prop('checked', false);
            		$('.adding-products').hide(); 
        	    	$('.uploadList-sec').show();
                },
	        	onClosed: function() {
					$.cookie("uploadFail", null, { path: '/' });
				}
            });
        	
        	
        }
    },

    clearGlobalAlerts: function() {
        $('#import-csv-alerts').empty();
    },

    clearChosenFile: function() {
        document.getElementById('csvFile').value = '';
        $('.js-file-upload__file-name').text('');
    },

    enableDisableActionButtons: function(enable) {
        $('#chooseFileButton').attr('disabled', !enable);
        $('#importButton').prop('disabled', !enable);
    }
    
}
//################################################################
//#### Autoload
//################################################################
// 
// ACC.sample={
// 	_autoload: [
// 		"samplefunction",
// 		["somefunction", "some expression to test"]
// 		["somefunction","some expression to test","elsefunction"]
// 	],

// 	samplefunction:function(){
// 		//... do some suff here, executed every time ...
// 	},

// 	somefunction:function(){
// 		//... do some suff here. if expression match ...
// 	},

// 	elsefunction:function(){
// 		//... do some suff here. if expression NOT match ...
// 	}

// }

//  // sample expression: $(".js-storefinder-map").length != 0


function _autoload(){
	$.each(ACC,function(section,obj){
		if($.isArray(obj._autoload)){
			$.each(obj._autoload,function(key,value){
				if($.isArray(value)){
					if(value[1]){
						ACC[section][value[0]]();
					}else{
						if(value[2]){
							ACC[section][value[2]]()
						}
					}
				}else{
					try{
					ACC[section][value]();
					}catch(e){
						
					}
				}
			})
		}
	})
}

$(function(){
	_autoload();
});
ACC.accountdashboard = {

	_autoload: [
		["bindAccountDashboardEvents", $('.page-accountDashboardPage').length],
	    "bindShipToListApiCall",
	    "bindUserCreate",
        "billingAccountOverlay",
	    "shipToListApiCall",
	    "bindPartnerProgram",
	    "emailSignUp",
	    "bindInvoiceEmail",
	    "bindOrderDetailsEmail",
	    "buildEditUserPage",
	    "bindShipToeOverlay",
	    "bindShipToeOverlayOpen",
	    "bindShipToSearchOverlay",
	    "bindShipToValueOverlay",
	    "bindShipToAccountOverview",
	    "showTeamRole",
	    "requestaccountFormCutomerType",
	    "resetDropdown",
	    "shiptoPopupManageUsers",
	    "shiptoPopupEwalletpage",
	    "bindDeleteEwalletPopup",
	    "bindDeleteMessageEwalletPopup",
	    "bindEditEwalletPop",
	    "bindAddEwalletPopup",
	    "bindBoardCard",
	    "bindEditSubmitEwallet",
	    "bindNickNameCards",
	    "ewalletLoadContent",
	    "bindManageEwalletPopUp",
	    "bindSelectAccess",
	    "bindManageEwalletPopUpConfirm",
	    "bindGrantRevokeEnabled",
    	"bindEditEnabled",
	   "bindAnayticDataOrderApproval",
	   "bindSelfServeForm",
	   "showShiptoMsg",
	   "showPartnersPoint"
	],
	bindAccountDashboardEvents: function(){
		ACC.accountdashboard.getQuotesData('open');	//Get Quotes
		ACC.accountdashboard.getRecommendedData('BuyAgainPage', 'buyagain', true); //Get recommended roduct
	},
	setPageShipTos: 0,
	showShipTos: function (e) {
		ACC.global.wHeight = $(window)[0].innerHeight;
		var searchParam = $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim();
		var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/' + ($("#unitUid").val()).trim() + '?searchParam=' + searchParam;
		var currentSelect = $(".ship-TosSelect");
		$(window).scrollTop(0);
		$.ajax({
			url: shipToPopupURL,
			method: "GET",
			success: function (searchPageData) {
				if (searchPageData != "") {
					$(".js-document-shipto-box").html(searchPageData);
					if (searchParam == "") {
						ACC.accountdashboard.shipToSlide('', '.js-document-shipto-box', 0, 500);
					}
					else {
						$("#search-ship-to-popup").val(searchParam);
					}
					let target = $(".js-shipto-main-data");
					let mUid = target.find(".ship-to-uid").val();
					let optionValues = localStorage.getItem(mUid).split("|")[0].split(":");
					let isMainUid = $.trim($(".js-shipto-main-check").text()).split("-").length == 1 ? true : false;
					if ($(".addresspopup .page-shipToPage").length) { 
						$(".js-shipto-primary, .js-shipto-current").addClass("hidden");
						$(".js-shipto-primary + .shipto-box").addClass("hidden");
					}
					else if (isMainUid || optionValues[0].split("-").length != 1) {
						$(".js-shipto-primary").removeClass("hidden");
						$(".js-shipto-current").addClass("hidden");
					}
					else {
						$(".js-shipto-primary").addClass("hidden");
						$(".js-shipto-current").removeClass("hidden");
					}
					target.attr("href", target.attr("href") + mUid);
					target.find(".ship-to-name").val(optionValues[1]);
					target.find(".ship-to-display-id").val(optionValues[2]);
					target.find(".js-shipto-main-name").html(optionValues[1]);
					target.find(".js-shipto-main-uid").html(optionValues[2]);
					$(".js-document-shipto-scroll").height(ACC.global.wHeight - ($("#search-ship-to-popup").offset().top + 118));
					$("#search-ship-to-popup").on('keyup', function (e) {
						if (e.keyCode == 13) {
							$("#shipToSearchBoxButton").trigger("click");
						}
					});
				}
				else {
					ACC.myquotes.quotePopupError();
					// onComplete
					$('#cboxWrapper #cboxClose').on('click', function () {
						$(currentSelect).val(previous);
					});
					checkShipToPopUp();
					$(document).on('click keyup', '#search-ship-to-popup', function () {
						checkShipToPopUp();
					});
					// onClosed
					if ($('#shipToSelected, #shipto-selected').length) {
						window.location.reload();
					}
				}
			},
			error: function (e) {
				ACC.myquotes.quotePopupError();
			}
		});
	},
	getMoreShipTos: function (e) {
		ACC.accountdashboard.setPageShipTos++;
		var searchParam = $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim();
		var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-shipto-popup-more/' + ($("#unitUid").val()).trim() + '?searchParam=' + searchParam + "&page=" + ACC.accountdashboard.setPageShipTos;
		$.ajax({
			url: shipToPopupURL,
			type: "get",
			success: function (data) {
				let shipToHtml = "";
				for (let i = 0; i < data.length; i++) {
					let shitpNum = data[i].displayId;
					let shitpName = data[i].name;
					let shitpUid = data[i].uid;
					shipToHtml += '<a class="p-a-15 bg-light-grey flex-center m-b-10 shipto-box ship-to-link" href="' + ACC.config.encodedContextPath + '/my-account/ship-to/' + shitpUid + '"><div class="bg-white border-grayish m-r-10 ship-to-link-circle"></div><input type="hidden" value="' + shitpNum + '" class="ship-to-name"><input type="hidden" value="' + shitpNum + '" class="ship-to-display-id"><input type="hidden" value="' + shitpUid + '" class="ship-to-uid"><div class=""><p class="m-b-0 f-s-16 text-gray-1">' + shitpName + '</p><p class="m-b-0 f-s-12 text-dark-gray">' + shitpNum + '</p></div></a>';
				}
				$(shipToHtml).insertBefore(e);
				if (!data.length || data.length < 10) {
					$(e).remove();
				}
			},
			error: function (e) {
				ACC.myquotes.quotePopupError();
			}
		});
	},
	shipToSlide: function (e, ref, leftRef, time) {
		ACC.global.wHeight = $(window)[0].innerHeight;
		let target = $(ref);
		let leftCal = typeof (leftRef) == 'number' ? leftRef : $(leftRef).offset().left;
		if ($(".addresspopup .page-shipToPage").length) {
			$('[name="parentB2BUnit"]').prop("selectedIndex", 0);
			ACC.colorbox.close();
		}
		else if (target.hasClass("showing-menu")) {
			$('.shipto-overlay').fadeOut();
			target.removeClass("showing-menu").animate({ left: -target.outerWidth() - 20 }, time);
			$("#search-ship-to-popup").val('');
		}
		else {
			if (ACC.global.wWidth > 1024 && $('.global-popup-box').is(":visible")) {
				$('.global-popup-box').hide();
				$(".js-document-global-btn.active").removeClass("active");
			}
			if ($('.language-dropdown').is(":visible")) {
				$('.language-value').trigger("click");
			}
			$(".L1CatLinks").removeClass("active");
			target.addClass("showing-menu").animate({ left: leftCal }, time);
			$('.shipto-overlay').fadeIn();
		}
	},
	bindShipToValueOverlay: function() { 
		$(document).on('click', '.page-shipToPage .ship-to-link', function () { // global header
			let ref = $(this);
			let unitId = ref.children(".ship-to-uid").val();
			let name = ref.children(".ship-to-name").val();
			if ($(".addresspopup .page-shipToPage").length) {
				let indexFound;
				$(".ship-TosSelect option").each(function (e) {
					if ($(this).val() == unitId) {
						$(".ship-TosSelect").prop("selectedIndex", e);
						indexFound = e;
					}
				});
				if (!indexFound) {
					$(".ship-TosSelect option").eq(0).remove();
					$(".ship-TosSelect").prepend('<option value="' + unitId + '">' + name + '</option>');
					$(".ship-TosSelect").prop("selectedIndex", 0);
				}
				ACC.colorbox.close();
				return false;
			}
			else {
				ACC.global.updateShipToCall(unitId);
				return false;
			}
		});
		$(document).on('click','#cboxContent .ship-to-link', function(){
			if(!$(".page-organizationManagement").length){
			 var unitId= $(this).siblings("#ship-toId").val()+"_US"; 
			 var name= $(this).parents(".shipTo-border").children(".zeropadding").eq(1).find("a").text();
			if($(".addresspopup").length > 0){
				if ($(".ship-TosSelect option").eq(0).val() == (unitId)
						|| $(".ship-TosSelect option").eq(1)
								.val() == (unitId)
						|| $(".ship-TosSelect option").eq(2)
								.val() == (unitId)
						|| $(".ship-TosSelect option").eq(3)
								.val() == (unitId)
					    || $(".ship-TosSelect option").eq(4)
				                .val() == (unitId)
						) {
						}else{
							$(".ship-TosSelect option").eq(3).val(unitId).text(name);
						}
				 		$(".ship-TosSelect").val(unitId);
				 		ACC.colorbox.close();
				 		return false;
					}
			else if(!$(".account-overview-search").length){
				//Do Nothing
			}
			else if(!$(".accountpopup").length){	
				ACC.global.updateShipToCall(unitId);
				return false;
			}	
			}     
		});
		$(document).on('change', '.ship-TosSelect', function () {
		 
	        previous = $(this).value;
	    }).on('change',function(e){
				var currentSelect = $(".ship-TosSelect");
				var searchParam = $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim()
				var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+$("#unitUid").val().trim()+'?searchParam='+searchParam;
				if($(".ship-TosSelect").val() === 'shipToopenPopup'){
					 $.ajax({
				            url: shipToPopupURL,
				            method: "GET",		
				            success: function(searchPageData) {
				                ACC.colorbox.open(ACC.config.selectShipTo, {
				                    html: searchPageData,
				                    width: '800px',
				                    className:"shipto-popup-mb addresspopup",
				                    onComplete: function(e) {
				        				$('#cboxWrapper #cboxClose').on('click',function(){
				        					$(currentSelect).val(previous);
				        				});
										$(".js-shipto-primary, .js-shipto-current").addClass("hidden");
										$(".js-shipto-primary + .shipto-box").addClass("hidden");
				        				retrieveShipToSortbySessionValue();
				        				checkShipToPopUp();
				                    	$(document).on('click keyup', '#search-ship-to-popup', function(){
				                    		checkShipToPopUp();
				                    	});
				                    },
				                    onClosed: function() {
				                    	if($('#shipToSelected,#shipto-selected').length)
										{
										window.location.reload();
										}
				                    }
				                });
				            }
				        });
				}
				
				$(document).on("click", "#cboxWrapper .account-orderhistory-pagination a",function(e){
					var page='';
					previous = $(this).value;
								e.preventDefault();	
								if($(this).attr('rel') == "prev"){
									page = $(this).parents("ul").find("li.active").text().split("(")[0]-2
									}
									else if($(this).attr('rel') == "next"){
									    page = $(this).parents("ul").find("li.active").text().split("(")[0]
									}
									else{
									page= $(this).text().trim()-1;
									}
								var data = {
										searchParam : $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim(),
										viewtype : 'All',
										page : page,
										sort : $("#sortShipTo").val()
									}
								var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+($("#unitUid").val()).trim();
								var currentSelect = $(".ship-TosSelect");
								var poupClass = $("#cboxOverlay").prop("class");
									$.ajax({
										url : shipToPopupURL,
										method : "GET",
										data : data,
										success : function(searchPageData) {
											ACC.colorbox.open(ACC.config.selectShipTo, {
												html : searchPageData,
												width : '800px',
												className : poupClass,
												onComplete:function(){
							        				$('#cboxWrapper #cboxClose').on('click',function(){
							        					$(currentSelect).val(previous);
							        				});
							        				retrieveShipToSortbySessionValue();
							        				checkShipToPopUp();
												},
												onClosed: function() {
													if($('#shipToSelected,#shipto-selected').length)
													{
													window.location.reload();
													}
							                    }
											});
										}
									});
								
						});
				
			 
			$(document).on("change", "#cboxWrapper #search-ship-to-popup",function(e) {
						 removeShipToSortbySessionValue();
					 	 var key = e.which;
					 	 previous = $(this).value;
					    
								var data = {
										searchParam : $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim(),
									}
								var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+($("#unitUid").val()).trim();
								var currentSelect = $(".ship-TosSelect");
								var poupClass = $("#cboxOverlay").prop("class");
									$.ajax({
										url : shipToPopupURL,
										method : "GET",
										data : data,
										success : function(searchPageData) {
											ACC.colorbox.open(ACC.config.selectShipTo, {
												html : searchPageData,
												width : '800px',
												className : poupClass,
												onComplete:function(){
							        				$('#cboxWrapper #cboxClose').on('click',function(){
							        					$(currentSelect).val(previous);
							        				});
							        				
							        				checkShipToPopUp();
						                    		
												},
												onClosed: function() {
													if($('#shipToSelected,#shipto-selected').length)
													{
													window.location.reload();
													}
							                    }
											});
										}
									});
								
						});	
				
				
				
				
				
				
						$(document).on("change", "#cboxWrapper .page-shipToPage #sortOptions1", function(e) {
							var sortItem = $("#cboxWrapper #sortOptions1").val();

							var data = {
								searchParam : $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim(),
								viewtype : 'All',
								sort : sortItem
							}
							var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+($("#unitUid").val()).trim();
							var poupClass = $("#cboxOverlay").prop("class");
							var currentSelect = $(".ship-TosSelect");
							$.ajax({
								url : shipToPopupURL,
								method : "GET",
								data : data,
								success : function(searchPageData) {
									ACC.colorbox.open(ACC.config.selectShipTo, {
										html : searchPageData,
										width : '800px',
										className : $("#cboxOverlay").prop("class"),
										onComplete:function(){
											$('#cboxWrapper #cboxClose').on('click',function(){
					        					$(currentSelect).val(previous);
					        				});
											retrieveShipToSortbySessionValue();
					        				checkShipToPopUp();
					                    
										},
										onClosed: function() {
											if($('#shipToSelected,#shipto-selected').length)
												{
												window.location.reload();
												}
					                    }
									});
								}
							});

						});
			});
		 
		$(document).bind('cbox_complete', function(){
		if ($('.input-group-shipTo').length > 0){
					_AAData.popupPageName= ACC.config.shiptopopuppathingPageName;
					_AAData.popupChannel= ACC.config.myaccountpathingChannel;
		 	try {
			    	 _satellite.track('popupView');
	        } catch (e) {} 
		}
		
		if ($('.login-error').val() == "true" && $("#colorbox").hasClass("unlock-account") != true){
			_AAData.popupPageName= ACC.config.loginerrorPageName;
			_AAData.popupChannel= ACC.config.myaccountpathingChannel;
			try {
			    	 _satellite.track('popupView');
	       } catch (e) {} 
		}
		
		});
	 		
	},
	
	
	
	bindShipToeOverlay: function() {
		$(document).on('click','#cboxWrapper #sortOptions1',function(){
			var sortType1 = $("#cboxWrapper #sortOptions1").val();
		  sessionStorage.setItem('selectedDropdownValueSession',sortType1);
		});
		$(document).on("keyup", "#cboxWrapper #search-ship-to-popup",function(e) {
			 
		 	var key = e.which;
		    if(key == 13) {
		    	$("#cboxWrapper #searchBoxButton").trigger('click');		    }
					
			});	
	
	},
	
	bindShipToSearchOverlay: function() {
		
		$(document).ready(function () {
			checkShipToPage();
		});
		$('#search-ship-to').on('click keyup', function () {
			checkShipToPage();
		});
		
		$(".shipToSearch").on('click',function () {	
					var shiptoSearch = $("#search-ship-to").val() == undefined ? "" : $("#search-ship-to").val().trim()
			        var shipToSearchURL = ACC.config.encodedContextPath + '/my-account/all-ship-to/'+($("#unitUid").val()).trim()+'?searchParam='+shiptoSearch;
			        var shiptosearchForm = $('#shiptosearchForm');
			        shiptosearchForm.submit();
			    });
			},
	
	bindShipToeOverlayOpen : function() {
		$(document).on("click", "#cboxWrapper .account-orderhistory-pagination  a",function(e){
			var page='';
				// var page=[];
				e.preventDefault();	
				/*var pagiantion= $(this).parents("li").siblings("#current_span").val();
				page = pagiantion.split("=");*/
				
				if($(this).attr('rel') == "prev"){
				page = $(this).parents("ul").find("li.active").text().split("(")[0]-2
				}
				else if($(this).attr('rel') == "next"){
				    page = $(this).parents("ul").find("li.active").text().split("(")[0]
				}
				else{
				page= $(this).text().trim()-1;
				}
				var data = {
						searchParam : $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim(),
						viewtype : 'All',
						page : page,
						sort : $("#sortShipTo").val()
					}
					var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+($("#unitUid").val()).trim();
				var poupClass = $("#cboxOverlay").prop("class");
				var currentSelect = $(".ship-TosSelect");
					$.ajax({
						url : shipToPopupURL,
						method : "GET",
						data : data,
						success : function(searchPageData) {
							ACC.colorbox.open(ACC.config.selectShipTo, {
								html : searchPageData,
								width : '800px',
								className : $("#cboxOverlay").prop("class"),
								 onComplete: function(e) {
									 $('#cboxWrapper #cboxClose').on('click',function(){
				        					$(currentSelect).val(previous);
									 });
									 retrieveShipToSortbySessionValue();
									 checkShipToPopUp();
				                    },
				                    onClosed: function() {
				                    	if($('#shipToSelected,#shipto-selected').length)
										{
										window.location.reload();
										}
				                    }
							});
						}
					});
				
		});
		$(document).on("change", "#cboxWrapper .page-shipToPage #sortOptions1", function(e) {
			var sortItem = $("#cboxWrapper #sortOptions1").val();

			var data = {
				searchParam : $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim(),
				viewtype : 'All',
				sort : sortItem
			}
			var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+($("#unitUid").val()).trim();
			var poupClass = $("#cboxOverlay").prop("class");
			var currentSelect = $(".ship-TosSelect");
			$.ajax({
				url : shipToPopupURL,
				method : "GET",
				data : data,
				success : function(searchPageData) {
					ACC.colorbox.open(ACC.config.selectShipTo, {
						html : searchPageData,
						width : '800px',
						className : $("#cboxOverlay").prop("class"),
						 onComplete: function(e) {
							 $('#cboxWrapper #cboxClose').on('click',function(){
		        					$(currentSelect).val(previous);
		        				});
							 retrieveShipToSortbySessionValue();
							 checkShipToPopUp();
		                    },
		                    onClosed: function() {
		                    	if($('#shipToSelected,#shipto-selected').length)
								{
								window.location.reload();
								}
		                    }
					});
				}
			});

		});
	},
    mobMenuSlide: function (e, ref, btn, time) {
		ACC.global.wWidth = $(window).width();
		ACC.global.wHeight = $(window)[0].innerHeight;
		let target = $(ref);
		if (target.hasClass("showing-menu")) {
			target.removeClass("showing-menu").animate({ left: -target.outerWidth() - 20 }, time);
			$(btn).removeClass("active");
			$(".after-overlay").fadeOut();
		}
		else {
			$(window).scrollTop(0);
			let topHatHeight = $(".header-top-hat").outerHeight();
            $(".global-menu-section").css({ height: ACC.global.wHeight - topHatHeight, top: topHatHeight });
			$(".m2CategoryDashboard").css({ left: '100%' });
			if ($('.language-dropdown').is(":visible")) {
				$('.language-value').trigger("click");
			}
			target.addClass("showing-menu").animate({ left: 0 }, time);
			$(btn).addClass("active");
			$(".after-overlay").fadeIn();
		}
	},
	categories: function (e, targetNum, targetParent) {
		let target = $(e);
		$(targetParent).empty();
		if(target.hasClass("active")){
			$(targetParent).fadeOut();
			target.removeClass("active");
		}
		else{
			$(".m1Links").removeClass("active");
			let targetHTML = "";
			let targetText = target.text();
			targetHTML += '<li class="categoriesBack hidden"><button class="transition-3s btn btn-block bold text-align-left" onclick="$(\'' + targetParent + '\').animate({ left: \'100%\' });" alt="' + targetText + '">' + targetText + '</button></li>';
			target.addClass("active");
			$('[aria-labelledby="btnGroupAccount_' + targetNum + '"] li').each(function () {
				if(targetNum === 5 && $(this).hasClass('shipToPopup')){
                    targetHTML += '<li class="m3Categories shipToPopup" data-global-linkname="ship-to" onclick="ACC.accountdashboard.showShipTos(this)">' + $(this).html() + '</li>';
                }
				else{
					targetHTML += '<li class="m3Categories">' + $(this).html() + '</li>';
				}
			});
			$(targetParent).append(targetHTML);
			$(".m3Categories a").addClass('btn btn-block text-align-left m2Links text-default f-w-500 f-s-18 b-b-grey transition-3s');
			$(targetParent).fadeIn();
		}
	},
	showListData: function (response) {
		let itemName = ["savedlist", "recommended"];
		let monthNames = [
		    "January", "February", "March",
		    "April", "May", "June", "July",
		    "August", "September", "October",
		    "November", "December"
		  ];
		for (let i = 0; i < itemName.length; i++) {
			let ref = i == 0 ? response.savedLists : response.recommendedLists;
			let refHTML = "";
			for (let j = 0; j < ref.length; j++) {
				let refPath = i == 0 ? "" : ref[j].categoryName.replace("&", "%26");
				refPath = ACC.config.encodedContextPath + (i == 0 ? '/savedList/listDetails?code=' + ref[j].code : '/savedList/recommendedListDetails?categoryName=' + refPath);
				let refName = i == 0 ? ref[j].name : ref[j].categoryName;
				let refDate = new Date(ref[j].modifiedTime ? ref[j].modifiedTime : '');
				refHTML += '<a href="' + refPath + '" class="article-link b-l-0 b-r-0 b-t-0 f-s-14-sm-px f-s-14-xs-px f-s-18 l-h-18 list-group-item m-b-0 min-orderqty-errmsg p-l-0-sm p-l-0-xs p-r-0-sm p-r-0-xs p-x-20 p-y-5-xs p-y-5-sm p-y-25 transition-3s">' + refName + '<span class="col-md-3 col-xs-12 f-s-14 p-l-5 f-s-12-xs-px p-l-0-xs p-r-0-xs text-gray-xs text-gray-sm f-s-12-sm-px p-l-0-sm p-r-0-sm pull-right">' + monthNames[refDate.getMonth()] + ' ' + refDate.getDate() + ', ' + refDate.getFullYear() + '</span></a>';
				if(j == 2){
					break;
				}
			}
			$(".list-dashboard-item-" + itemName[i]).append(refHTML);
			if ($(".list-dashboard-item-" + itemName[i] + " .list-group-item").length) {
				$(".dashboard-" + itemName[i] + "-empty").addClass("hidden");
				$(".dashboard-" + itemName[i] + "-filled").removeClass("hidden");
			}
			else {
				$(".dashboard-" + itemName[i] + "-filled").addClass("hidden");
				$(".dashboard-" + itemName[i] + "-empty").removeClass("hidden");
			}
		}
		ACC.global.elemHeightEqual('.js-dashboard-widget', 1024);
	},
	getRecommendedData: function (type, target, onload) {
        let targetParent = $("#dash-tab-" + target);
        if (!targetParent.find('.dashboard-carousel-' + target).length) {
			if(!onload){
				loading.start();
			}
            $.ajax({
                type: "GET",
                url: ACC.config.encodedContextPath + "/recommendedProducts",
                data: { placementPage: type },
                success: function (data) {
                    //let data = (target ==  'buyagain') ? rec.buyagain : (target ==  'recently') ? rec.recently : rec.recommended;
					//console.log(data);
                    if (data.recommendedProductsLayer && data.recommendedProductsLayer != "") {
                        targetParent.html(data.recommendedProductsLayer);
                        $(".dashboard-widget-recommended").removeClass("hidden");
                        $('.dashboard-carousel-' + target).owlCarousel({
                            loop: true,
                            margin: 20,
                            items: 7,
							itemsDesktop : [1199, 5],
							itemsDesktopSmall : [979, 4],
							itemsTablet : [768, 3],
							itemsMobile : [479, 2],
                            slideSpeed : 200,
							paginationSpeed : 800,
							rewindSpeed : 1000,
							autoPlayTime: 10000,
							autoPlay: 7000,
                            stopOnHover: true,
                            navigation: true,
                            navigationText: ["", ""],
                            scrollPerPage: true,
                            pagination: true,
                            paginationNumbers: false
                        });
                        ACC.product.enableAddToCartButton();
                        ACC.product.bindToAddToCartForm();
                        ACC.accountdashboard.checkCSP();
						loading.stop();
                    }
					else{
						loading.stop();
					}
                },
                error: function (a, b, e) {
					loading.stop();
                    //console.log(a);
                    //ACC.myquotes.quotePopupError();
                }
            });
        }
    },
	checkCSP: function () {
		$('.productcspCode').each(function () {
			var productCode = $(this).val();
			var isStockAvailable = ($(".isStockAvailablecsp" + productCode).val() == 'true');
			var isLicensed = ($(".isLicensed" + productCode).val() == 'true');
			var isMyStoreProduct = ($(".isMyStoreProduct" + productCode).val() == "true");
			var isRegulateditem = ($(".isRegulateditemcsp" + productCode).val() == "true");
			var isOrderingAccount = ($(".isOrderingAccount" + productCode).val() == "true");
			var csp = $(".csp" + productCode).val();
			var isRup = ($("#isRup" + productCode).val() == 'true');
			var isProductSellable = ($("#isProductSellable" + productCode).val() == 'true');
			let inventoryCheck = ($(".inventoryCheck_" + productCode).val() == "true");
			let isEligibleForBackorder = ($(".isEligibleForBackorder_" + productCode).val() == "true");
			//console.log(csp, isOrderingAccount, isMyStoreProduct, 'isRegulateditem', isProductSellable, 'isRup', isLicensed, isRup, isRegulateditem, inventoryCheck, isEligibleForBackorder);
			if (csp > 0 && isOrderingAccount && isMyStoreProduct && ((isRegulateditem && isProductSellable && ((isRup && isLicensed) || !isRup)) || !isRegulateditem) && !(inventoryCheck && isEligibleForBackorder)) {
				var eleId = "listPageAddToCart_" + productCode;
				$('[id=' + eleId + ']').each(function () {
				$(this).attr("disabled", false);
				});
				var eleId1 = "orderOnlineATC_" + productCode;
				$('[id=' + eleId1 + ']').each(function () {
				$(this).attr("disabled", false);
				});
				//console.log(eleId, eleId1);
			}
		});
	},
	getQuotesData: function (type) {
		if ($(".list-dashboard-item-" + type).length){
			if(!$(".list-dashboard-item-" + type + " .list-group-item").length) {
				$.ajax({
					url: ACC.config.encodedContextPath + "/my-account/shipping-Quotes",
					type: "GET",
					dataType: 'json',
					data:
					{
						customerNumber: $(".current-customer-number").text(),
						skipCount: 0,
						toggle: type,
						fromAD: true
					},
					beforeSend: function(){
						$(".dashboard-" + type + "-filled").addClass("hidden");
						$(".dashboard-" + type + "-empty").addClass("hidden");
						$(".dashboard-" + type + "-loader").removeClass("hidden");
					},
					success: function (response) {
						$(".dashboard-" + type + "-loader").addClass("hidden");
						
						if (response && typeof (response) == "object") {
							ACC.accountdashboard.showQuotesData(response, type);
						}
						else {
							$(".dashboard-" + type + "-filled").addClass("hidden");
							$(".dashboard-" + type + "-empty").removeClass("hidden");
							ACC.global.elemHeightEqual('.js-dashboard-widget', 1024);
						}
					},
					error: function (error) {
						$(".dashboard-" + type + "-filled").addClass("hidden");
						$(".dashboard-" + type + "-empty").removeClass("hidden");
						$(".dashboard-" + type + "-loader").addClass("hidden");
						ACC.global.elemHeightEqual('.js-dashboard-widget', 1024);
					}
				});
			}
			else{
				$(".dashboard-" + type + "-empty").addClass("hidden");
				$(".dashboard-" + type + "-filled").removeClass("hidden");
				ACC.global.elemHeightEqual('.js-dashboard-widget', 1024);
			}
		}
		else{
			ACC.global.elemHeightEqual('.js-dashboard-widget', 1024);
		}
	},
	showQuotesData: function (response, type) {
		let monthNames = [
			"January", "February", "March",
			"April", "May", "June", "July",
			"August", "September", "October",
			"November", "December"
		];
		let refHTML = "";
		let count = 0;
		for (let j = 0; j < response.length; j++) {
			if(response[j].quoteId && response[j].quoteId != ""){
				let refPath = ACC.config.encodedContextPath + '/my-account/my-quotes/' + response[j].quoteId;
				let refDate = new Date(type == 'expired' ? response[j].expirationDate : response[j].dateSubmitted);
				refHTML += '<a href="' + refPath + '" class="article-link b-l-0 b-r-0 b-t-0 f-s-14-sm-px f-s-14-xs-px f-s-18 flex-center l-h-18 list-group-item m-b-0 min-orderqty-errmsg p-l-0-sm p-l-0-xs p-r-0-sm p-r-0-xs p-x-20 p-y-15 p-y-5-sm p-y-5-xs transition-3s"><span class="col-md-8 padding0"><span class="f-s-16 l-h-20 text-gray text-muted">#' + response[j].quoteId + '</span><br><span class="text-default">' + response[j].jobName + '</span></span><span class="col-md-4 col-xs-12 f-s-12-sm-px f-s-12-xs-px f-s-14 p-r-0 p-l-0-sm p-l-0-xs pull-right text-gray-sm text-gray-xs">' + monthNames[refDate.getMonth()] + ' ' + refDate.getDate() + ', ' + refDate.getFullYear() + '</span></a>';
				count++;
			}
			if (count == 4) {
				break;
			}
		}
		$(".list-dashboard-item-" + type).html(refHTML);
		if ($(".list-dashboard-item-" + type + " .list-group-item").length) {
			$(".dashboard-" + type + "-empty").addClass("hidden");
			$(".dashboard-" + type + "-filled").removeClass("hidden");
		}
		else {
			$(".dashboard-" + type + "-filled").addClass("hidden");
			$(".dashboard-" + type + "-empty").removeClass("hidden");
		}
		ACC.global.elemHeightEqual('.js-dashboard-widget', 1024);
	},
	dashboardListCreateForm: function () {
		let status = true;
		let target = $(".dashboard-create-list-input");
		let targetVal = $.trim(target.val());
		target.val(targetVal);
		$(".dashboard-create-list-error").css("display", "none").empty();
		if (!targetVal || targetVal == "") {
			status = false;
			$(".dashboard-create-list-error").html("Enter a list Name");
		}
		else {
			$.ajax({
				type: 'GET',
				url: ACC.config.encodedContextPath + "/savedList/listExists?wishListName=" + targetVal,
				datatype: "json",
				async: false,
				success: function (result) {
					if (result) {
						status = false;
						$(".dashboard-create-list-error").html("List name already exisits");
					}
				},
				error: function () {
					status = false;
				}
			});
		}
		if (status) {
			$("#siteoneSavedListCreateForm").submit();
		}
		else{
			$(".dashboard-create-list-error").css("display", "block");
		}
	},
	billingAccountOverlay: function () 
    {		
    		var pageId = $("#pageId").val();
    		var isOrderingAccount =  null;
    		
    		if($("#isOrderingAccount").val())
    		{
    			isOrderingAccount =  $("#isOrderingAccount").val();
    		}
    		
    		var sessionShipToId = null;
    		if($("#sessionShipToId").val())
    		{
    			sessionShipToId = $("#sessionShipToId").val();
    		}
    		
    		if(pageId == 'cartPage' && isOrderingAccount == 'false')
    		{
    			if(null != $("#listOfShipTos").val() || $("#listOfShipTos").val() != "")
		    	{
			    	var listOfShipTo = JSON.parse($("#listOfShipTos").val());
			    	       
			    	var selectBox = "<select id='shipToSelectionOptions' class='shipToSelectionInPopup' style='width:100%'>";
		               
			    	$.each(listOfShipTo,function(index, shipTo) 
		    		{ 	
			    		if(shipTo.isOrderingAccount)
			    		{
				    		if(shipTo.name !== null && shipTo.name !== '')
				    		{
				    			selectBox = selectBox + '<option value="' + shipTo.uid + '" selected>' +  shipTo.name + ' : ' + shipTo.displayId + '</option>';
				    		}
				    		else
				    		{
				    			selectBox = selectBox + '<option value="' + shipTo.uid + '">' + shipTo.displayId + '</option>';
				    		}
			    		}
		    		});
		    	    selectBox = selectBox + "</select>";
		    	}
    	
    			$.colorbox({
	    			html: "<div class='Billing-pop-up'><div class='ship-to-header'><span  style='color:black;font-size: 22px;font-family: Geogrotesque-Medium;'>"+ACC.config.orderingAccountSelect+"</span></div><div class='PopupBox popup'><span  style='font-size: 12pt;'><p>"+ACC.config.sorryMsg 
	    				+ACC.config.orderingAccountError+"</p></span><br><label for='shipToSelectionOptions' style='color:inherit;'>"+ACC.config.selectedAccount+"</label></div>"+selectBox+"<br>"
	    				+"<br><button type='button' class='Billing-pop-up-button btn-block btn btn-primary' id='changeShipTo'>"+ACC.config.updateShipTo+"</button></div>",
	    			maxWidth:"100%",
	    			width:"auto",
	    			maxHeight:"100%",
					overflow:"auto",
					opacity:0.7,
					className:"addNotFound",
					title:false,
					close:'<span class="glyphicon glyphicon-remove"></span>',
					onComplete: function()
					{
						$("#cboxTitle").css("display","none");
						$("#cboxLoadedContent").attr('style','margin-top:40px !important');
						$("body").css("overflow-y", "hidden");
					},
					onClosed: function() {
	    				$("body").css("overflow-y", "auto");
	    			}
    			   
    			});
    		}
        
    	
        $(document).on("click","#changeShipTo", function () 
        {
        	var unitId=$('.shipToSelectionInPopup').find(":selected")[0].value;
        	ACC.global.updateShipToCall(unitId);
        });
    
    },
    bindShipToListApiCall: function ()
    {
		var uid=$("#parentUnitId").val();
		
		if(null != uid && uid != "")
		{
			if(localStorage.getItem(uid))
			{
				ACC.accountdashboard.bindShiptoDropdown(localStorage.getItem(uid));
			}
			else
			{
				$.ajax({
			        type: 'GET',
			        url: ACC.config.encodedContextPath + '/my-account/listofshipto',
			        cache: false,
			        dataType: "json",
			        data: {"uid":uid},
			        success: function(shipTos)
			        {
			        	if(shipTos.length > 0)
		        		{
			        		var localStorageValue = "";
				        	
				        	$.each(shipTos, function( index, shipTo ) 
		        	    	{
		        	    		var id = shipTo.uid;
		        	    		var optionValue = shipTo.uid + ":" + shipTo.name + ":" + shipTo.displayId;
		        	    		if("" != localStorageValue)
		        				{
		        	    			localStorageValue = localStorageValue + '|' + optionValue;
		        				}
		        	    		else
		        	    		{
		        	    			localStorageValue = optionValue;
		        	    		}
		        	    	});  
		        			localStorage.setItem(uid, localStorageValue);
				        	
				        	ACC.accountdashboard.bindShiptoDropdown(localStorageValue);
		        		}
			        	
			        	else
			        	{
			        		$('#shipToSelected').attr('disabled', 'disabled');
			        	}
			        }
			        
			    });
			}
			if($('#shipToSelected').length) {
				$('#shipToSelected').editableSelect();
				$(".shipto-dropdwon .es-visible").append("<hr/>");
				$(".shipto-dropdwon .es-visible").last().find("hr").remove();
			
				$('#shipToSelected').on('select.editable-select', function(e, el){
					if ($("#shipToSelected").val()=="Search More Ship-To's" || $("#shipToSelected").val()=="Buscar ms envos"){
						removeShipToSortbySessionValue();
						var currentSelect = this;
						previous = $(this).value;
						var searchParam = $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim()
						var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+($("#unitUid").val()).trim()+'?searchParam='+searchParam;
						$.ajax({
							url: shipToPopupURL,
							method: "GET", 
							success: function(searchPageData) {
								if(searchPageData != ""){
									$(".js-document-shipto-box").html(searchPageData);
									ACC.accountdashboard.shipToSlide(e, '.js-document-shipto-box', 0, 500);
									$(".js-document-shipto-scroll").height(ACC.global.wHeight - ($("#search-ship-to-popup").offset().top + 118));
								}
								else{
									ACC.myquotes.quotePopupError();
									// onComplete
									$('#cboxWrapper #cboxClose').on('click', function () {
										$(currentSelect).val(previous);
									});
									checkShipToPopUp();
									$(document).on('click keyup', '#search-ship-to-popup', function () {
										checkShipToPopUp();
									});
									// onClosed
									if ($('#shipToSelected, #shipto-selected').length) {
										window.location.reload();
									}
								}
							},
							error: function (e) {
								ACC.myquotes.quotePopupError();
							}
						});
					}
					else{
						
					window.location.href= ACC.config.encodedContextPath +"/my-account/ship-to/"+ $(el).data('value');
					$('#shipToSelected').off();
					}
				});
			}
			
		}
		
		$(".logout").on('click', function () 
		{
			var jusername=$.cookie("j_username");
			if(jusername != "" && jusername != null) {
				$.cookie('jusername', null,{path:'/'});
			}
			var userfirstname=$.cookie("newfirstname");
			if(userfirstname != "" && userfirstname != null) {
				$.cookie('newfirstname', null,{path:'/'});
			}
			localStorage.clear();
			sessionStorage.clear();
			window.location.href= ACC.config.encodedContextPath +"/logout";
		});
		
    },

    bindShipToAccountOverview: function ()
    {
		var uid=$("#parentUnitId").val();
		
		if(null != uid && uid != "")
		{
			if(localStorage.getItem(uid))
			{
				ACC.accountdashboard.bindShiptoDropdown(localStorage.getItem(uid));
			}
			else
			{
				$.ajax({
			        type: 'GET',
			        url: ACC.config.encodedContextPath + '/my-account/listofshipto',
			        cache: false,
			        dataType: "json",
			        data: {"uid":uid},
			        success: function(shipTos)
			        {
			        	if(shipTos.length > 0)
		        		{
			        		var localStorageValue = "";
				        	
				        	$.each(shipTos, function( index, shipTo ) 
		        	    	{
		        	    		var id = shipTo.uid;
		        	    		var optionValue = shipTo.uid + ":" + shipTo.name + ":" + shipTo.displayId;
		        	    		if("" != localStorageValue)
		        				{
		        	    			localStorageValue = localStorageValue + '|' + optionValue;
		        				}
		        	    		else
		        	    		{
		        	    			localStorageValue = optionValue;
		        	    		}
		        	    	});  
		        			localStorage.setItem(uid, localStorageValue);
				        	
				        	ACC.accountdashboard.bindShiptoDropdown(localStorageValue);
		        		}
			        	
			        	else
			        	{
			        		$('#shipto-selected').attr('disabled', 'disabled');
			        	}
			        }
			        
			    });
			}
			if($('#shipto-selected').length) {
				$('#shipto-selected').editableSelect();
				$(".shipto-dropdwon .es-visible").append("<hr/>");
				$(".shipto-dropdwon .es-visible").last().find("hr").remove();
			
				$('#shipto-selected').on('select.editable-select', function(e, el){
					if ($("#shipto-selected").val()=="Search More Ship-To's" || $("#shipto-selected").val()=="Buscar ms envos"){
						var currentSelect = this;
						 previous = $(this).value;
						 var searchParam = $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim()
						var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+($("#unitUid").val()).trim()+'?searchParam='+searchParam;
						$.ajax({
						            url: shipToPopupURL,
						            method: "GET", 
						            success: function(searchPageData) {
						                ACC.colorbox.open('Search or Select a Ship-To', {
						                    html: searchPageData,
						                    width: '800px',
						                    className:"shipto-popup-mb accountpopup",
						                    onComplete: function(e) {
						                    	
						                    	$(document).on('click','#cboxContent .ship-to-link', function(){ 
						               			 
						               			 var unitId= $(this).siblings("#ship-toId").val()+"_US"; 
						               			 //var name= $(this).parents(".shipTo-border").children(".zeropadding").eq(1).find("a").text();
						               			 var shipToUrl = ACC.config.encodedContextPath + "/my-account/account-overview?accountId="+unitId;
						               			 $("a.ship-to-link").prop("href",shipToUrl);
						                    	});
						                    	
						                    	checkShipToPopUp();
						                    	$(document).on('click keyup', '#search-ship-to-popup', function(){
						                    		checkShipToPopUp();
						                    	});
						                    },
						                    onClosed: function() {	
												                   	
											}
						                });
						            }
						        });
						
						
						
						     }
					else{
						
						window.location.href= ACC.config.encodedContextPath +"/my-account/account-overview?accountId="+ $(el).data('value');
						$('#shipto-selected').off();
						 
					}
					
				});
			}
			
		}
		
		$(".logout").on('click', function () 
		{
			var jusername=$.cookie("j_username");
			if(jusername != "" && jusername != null) {
				$.cookie('jusername', null);
			}
			var userfirstname=$.cookie("newfirstname");
			if(userfirstname != "" && userfirstname != null) {
				$.cookie('newfirstname', null);
			}
			localStorage.clear();
			sessionStorage.clear();
			window.location.href= ACC.config.encodedContextPath +"/logout";
		});
		
    },
    
    
    
    shipToListApiCall: function ()
    {
 	   	if($('#shipto-selected').length) {
 			$('#shipto-selected').editableSelect();
 			$(".shipto-dropdwon .es-visible").append("<hr/>");
			$(".shipto-dropdwon .es-visible").last().find("hr").remove();
 		
 			$('#shipto-selected').on('select.editable-select', function(e, el){
 				if ($("#shipto-selected").val()=="Search More Ship-To's" || $("#shipto-selected").val()=="Buscar ms envos"){
					var currentSelect = this;
					 previous = $(this).value;
					 var searchParam = $("#search-ship-to-popup").val() == undefined ? "" : $("#search-ship-to-popup").val().trim()
					var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup/'+($("#unitUid").val()).trim()+'?searchParam='+searchParam;
					$.ajax({
					            url: shipToPopupURL,
					            method: "GET", 
					            success: function(searchPageData) {
					                ACC.colorbox.open('Search or Select a Ship-To', {
					                    html: searchPageData,
					                    width: '800px',
					                    className:"shipto-popup-mb accountpopup",
					                    onComplete: function(e) {
					                    	
					                    	$(document).on('click','#cboxContent .ship-to-link', function(){ 
					               			 
					               			 var unitId= $(this).siblings("#ship-toId").val()+"_US"; 
					               			 //var name= $(this).parents(".shipTo-border").children(".zeropadding").eq(1).find("a").text();
					               			 var shipToUrl = ACC.config.encodedContextPath + "/my-account/account-overview?accountId="+unitId;
					               			 $("a.ship-to-link").prop("href",shipToUrl);
					                    	});
					                    	 retrieveShipToSortbySessionValue();
					                    	checkShipToPopUp();
					                    },
					                    onClosed: function() {	
											                   	
										}
					                });
					            }
					        });
															
					     }
				else{

 				window.location.href= ACC.config.encodedContextPath +"/my-account/getshiptoinfo/"+ $(el).data('value');
 				$('#shipto-selected').off();
 				}
 			});
 		}
     },
    
	bindShiptoDropdown: function (localStorageValue)
    { 
		var isLinkAvailable=false;
		var optionValues = localStorageValue.split("|");
		$.each(optionValues, function(index, val) 
    	{   
			if(index >=300){
				isLinkAvailable=true;
				return false;
				
			}
    		var optionValue = val.split(":");
    		$('#shipToSelected, #shipto-selected').append("<option data-value='"+ optionValue[0] +"' value='" + optionValue[2] + "-" + optionValue[1] + "'>"+ optionValue[2] + "-" + optionValue[1] +"</option>"); 
    	}); 
		  
		
		if (isLinkAvailable===true) {
			$('#shipToSelected, #shipto-selected').append("<option value='SearchMoreShipToLink' style='color: #50a0c5;text-decoration: underline;'>"+ACC.config.searchMore+"</option>"); 
			}
    },

	  
    bindPartnerProgram : function() {
		$(document).on("click", "#partnerProgramLink", function(e) {
			e.preventDefault();
			var partnerMessage=$(this).data("partner-message");
			var ppurlStatus=$(this).data("ppurl");
			var urlToOpen = ACC.config.encodedContextPath +"/my-account/partner-program";
				if(ppurlStatus){
					window.open(urlToOpen, '_blank');
				}
				else{
					$.colorbox({
					html:  "<div class='PopupBox col-md-12 col-xs-12'><div>"+partnerMessage+"<br/><span class='hidden-xs'><br/></span><div class='row'><div class='col-md-4 col-xs-4'><button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >OK</button></div></div></div></div>",
					width:"550px",                                         	
					maxHeight:"100%",
					overflow:"auto",
					opacity:0.7,
					className: "PartnerProgram",
					title: false,
					closeButton: false,
					onComplete: function() {
						_AAData.popupPageName= ACC.config.redeempointsPageName;
						_AAData.popupChannel= ACC.config.myaccountpathingChannel; 
						try {
									_satellite.track('popupView');
						} catch (e) {}
						}
					});
				}
		});
	},
	
    
    emailSignUp: function()
    {
        /**
        * Suppressing the emailsignup popup functionality.
        $(document).on("click", ".notNow", function()
		{
			$.cookie("emailSignUp", "done", { expires: 90 });
			ACC.colorbox.close();
		});
    	
    	var showPopup = false;
    	
    	if($.cookie("emailSignUp") == null)
    	{
    		showPopup = true;
    	}
    	
    	if($("#hasSignedUp").val() != "" && $("#hasSignedUp").val() == 'true')
    	{
    		showPopup = false;
    	}
    	
    	if($("#pageId").val() =='siteonehomepage' && showPopup)
    	{
    		ACC.accountdashboard.signUpPopup();
    	}
    	*/
    	
    	$(document).on("blur", "#emailId", function()
		{
    		if(ACC.formvalidation.validateEmailPattern($("#emailId").val()))
		    {
				 ACC.formvalidation.removeErrorClassForRegForm('#emailId', '#emailError', '#emailId\\.errors', ERRORMSG.invalid.email);
			}
			else
			{
				 ACC.formvalidation.addErrorClassForRegForm('#emailId', '#emailError', '#emailId\\.errors', ERRORMSG.invalid.email);
			}
	        
	    });
    	
    	$(document).on("click", "#agree", function()
    	{
    		if($("#agree").prop("checked") == false)
    		{
    			$("#agreeError").html("<div class='bg-danger '><div class='panel-body'><font color='red'>"+ACC.config.pleaseCheckBox+"</font></div></div>");
    		}
    		else
    		{
    			$("#agreeError").html("");
    		}
    		
    	});
    	
    	$(document).on("click", "#signUp", function (e) 
		{
    		var status = true;
    		
    		/*if($("#emailId").val() == "" || $("#emailId").val() == null)
    		{
    			//$(".emailError").html("<div class='bg-danger' style='margin:10px 0px;'><div class='panel-body'><font color='red'>Please enter email address.</font></div></div> ");
        		ACC.formvalidation.addErrorClassForRegForm('#emailId', '#emailError', '#emailId\\.errors', ERRORMSG.global.email);
    			status = false;
    		}*/
    		if(ACC.formvalidation.validateEmailPattern($("#emailId").val()))
    		{
    			ACC.formvalidation.removeErrorClassForRegForm('#emailId', '#emailError', '#emailId\\.errors', ERRORMSG.invalid.email);
    		}
			else
			{
				 status = false;
				 ACC.formvalidation.addErrorClassForRegForm('#emailId', '#emailError', '#emailId\\.errors', ERRORMSG.invalid.email);
			}
    		
    		if(ACC.formvalidation.validatezipcode(e, $("#zipcode").val()))
    		{
    			//$("#errorZipcode").html("<font color='red'>Postal Code for US must be numeric and with length 5 or 10 with a ' - ' after 5 digits.</font>");
    			ACC.formvalidation.removeErrorClassForRegForm('#zipcode', '#errorZipcode', '#zipcode\\.errors',ACC.config.dashboardValidZip);
    		}
    		else
    		{
    			status = false;
    			ACC.formvalidation.addErrorClassForRegForm('#zipcode', '#errorZipcode', '#zipcode\\.errors', ACC.config.dashboardValidZip);
    			
    		}
    		
    		if($("#agree").prop("checked") == false)
    		{
    			$("#agreeError").html(" <font color='red'>"+ACC.config.pleaseCheckBox+"</font> ");
    			status = false;
    		}
    		else
    		{
    			$("#agreeError").html("");
    		}
    		
    		var briteverify= document.getElementById('briteVerifyEnable').value;
    		
    		if(status)
    		{
    			if(briteverify == "true")
        		{
    				 url = ACC.config.encodedContextPath +'/request-account/briteVerifyValidate?email='+$('#emailId').val();

                    $.ajax({
         				url: url,
         				type: "get",
         				timeout: 5000,
         				success: function (response)
         				{
         					if(response !="invalid")
         					{
         					   ACC.briteverify.emailSubscription($("#emailId").val());
         					}
         				    else
         				    {
         				    	$("#emailError").html("<div class='bg-danger' style='margin:10px 0px;'><div class='panel-body'><font color='red'>>"+ACC.config.dashboardValidEmail+"</font></div></div>");
         				    }
         				},
         				
         				error: function(response, textstatus, message) 
    					{
    					  if(textstatus == "timeout" || textstatus == "error") 
    					  {
    						 $("#emailError").html("<div class='bg-danger' style='margin:10px 0px;'><font color='red'><div class='panel-body'>"+ACC.config.unableDashboardValidate+"</div></font></div>");
    					    } 
    					}
    				});
    				
        		}
        		else
        		{
        		    ACC.briteverify.emailSubscription($("#emailId").val());
        		}
    		}
		});
    	
    	$(document).on("focusin", "#emailId",function(e)
		{
			$(".emailError").empty();
		});
    	
    },
    
    
    bindInvoiceEmail: function()
    {
    	$(document).on("click", "#invoiceEmail", function()
		{
    		window.scrollTo(0,0);
    		ACC.accountdashboard.invoicePopup();
		});
    	
    	$(document).on("click", "#invoiceEmailSubmit", function()
		{
    		$("#emailError").html("");
		    if($("#emailIdInvoice").val() == "" || $("#emailIdInvoice").val()  == null)
		    {
			   status = false;
			   $("#emailError").html("<div class='bg-danger' style='margin:10px 0px;'><div class='panel-body'><font color='red'>"+ACC.config.emailAddressError+"</font></div></div>");
		    }
		    else
		    {
			   ACC.briteverify.checkToEmails($("#emailIdInvoice").val());
		    }
		});
    	
    },
    
    bindOrderDetailsEmail: function()
    {
    	$(document).on("click", "#orderEmail", function()
		{
    		ACC.accountdashboard.orderDetailsPopup();
		});
    	
    	$(document).on("click", "#orderEmailSubmit", function()
		{
    		$("#emailError").html("");
    		if($("#emailIdOrder").val() == "" || $("#emailIdOrder").val() == null)
    		{
    			status = false;
    			$("#emailError").html("<div class='bg-danger' style='margin:10px 0px;'><div class='panel-body'><font color='red'>"+ACC.config.emailAddressError+"</font></div></div>");
    		}
    		else
    		{
       		   ACC.briteverify.checkToEmails($("#emailIdOrder").val());
    		}
		});
    	
    },
    
    buildEditUserPage: function() {
    	$( document ).ready(function() {
    		var userPermissionCount = $(".userPermissionText").length;
    		
    		for(i=0;i<userPermissionCount-1;i++) {
    			$(".userPermissionText")[i].append(",");
    		}
    	});
    },
    
    
    sendOrderDetailEmail: function(email,orderCode,invoiceCode,uid)
	{
		loading.start();
		var data = {
					email : email ,
					invoiceCode : invoiceCode,
					uid : uid ,
				}
		$.ajax({
		     	type: "GET",
		     	url: ACC.config.encodedContextPath +"/sendorderdetails/"+orderCode,
		     	cache: false,
		     	data : data,
		     	dataType: "json",
		     	success: function (response) 
		     	{
		     		$("#colorbox").removeClass("order-details-email-pop-up");
		     		ACC.global.successPopup();	
		        }
		     	
			}).always(function() {
				loading.stop();
			});
					
	},
	
	
	sendInvoiceEmail: function(email,invoiceNumber,accountNumber)
	{
		loading.start();
		var data = {
					email : email ,
					uid : accountNumber ,
				}
		$.ajax({
         	type: "GET",
         	url: ACC.config.encodedContextPath + "/invoiceDetailsEmail/"+invoiceNumber,
         	cache: false,
         	data : data,
         	dataType: "json",
         	success: function (response) 
         	{
         		$("#colorbox").removeClass("email-invoice-popup");
         		ACC.global.successPopup();	
             }
			}).always(function(){
				loading.stop();
			});
	},
	
    
    signUpPopup: function()
	{
		var html = ["<div class='PopupBox col-md-12'>",
		            "<div class='row'>",
		            "<div class='email-signup-heading'>Email Signup</div>",
						"<p>"+ACC.config.promotionsMsg+"</p>", 

						"<div id = 'emailError'></div>",
						"<div id='errorZipcode'></div>" +
						"<div id='agreeError'></div><br/>",
						"<label for='emailId'>Email address </label><br>",
						"<input type='text' class='form-control' id='emailId'> <br>",
						"<label for='zipcode'>ZIP code </label><br><input type='text' id='zipcode' class='form-control'><br/><div>",
						"<p></p><label class='email-pop-label'>I am a:</label> <p class='cl'></p><div class='row'>",
						"<div class='label-columns'>",
							"<label class='label-highlight' style='color:#5a5b5d;display:block'>",
								"<div class='colored-radio'>",
									"<input type='radio' name='role' value='Contractor' checked>",
								"</div>&nbsp;"+ACC.config.landscapeProfessional+"",
							"</label>",
						"</div>",
						"<div class='visible-xs visible-sm hidden-md hidden-lg'>",
						"<div class='cl'>",
						"</div>",
						"<br/>",
						"</div>",
						"<div class='label-columns'> ",
							"<label class='label-highlight' style='color:#5a5b5d;display:block'>",
								"<div class='colored-radio'>",
									"<input type='radio' name='role' value='Homeowner'>",
								"</div>&nbsp;Homeowner",
							"</label> ",
						"</div></div>",
						"<div class='cl'></div>",
						"<div class='email-signup-text'>",
						"<div class='row'>",
						"<div class='colored col-md-12'>",
							"<input type='checkbox' name='agree' id='agree'> <span class='small-font'><label for='agree'>"+ACC.config.emailCommunication+"</span></label>",
						"</div>",
						"<div class='cl hidden-xs hidden-sm'>",
						"</div>",
						"</div>",
						"</div>",
						"<div class='row'>",
						"<div class='col-md-12 col-sm-12'>",
						"<div class='row'>",
						"<div class='cl'>",
						"</div>",
						"<div class='col-md-4 col-sm-6 col-xs-12'>",
						"<input id='signUp' class='btn btn-primary btn-block' type='button' value='"+ACC.config.signUp+"'>",
						"</div>",
						"<div class='col-md-3 col-sm-3  col-xs-12  text-center' style='line-height:12pt;'>",
						"<br/><a href class='notNow'><u>Not now</u></a>",
						"</div>",
						"</div>",
						"</div>",
						"<div class='cl'>",
						"</div>",
						"</div>",
					"</div>"].join("");
		
			ACC.colorbox.open("<div class='hidden-md hidden-lg hidden-sm mobile-header'>Email Signup</div>", {
				html: html,
				width:"630px",
				maxHeight:"100%",
				overflow:"auto",
				opacity:0.7,
				className:"email-signup",
				onClosed: function() {
					$.cookie("emailSignUp", "done", { expires: 90 });
				}
			})
	},
	
	signUpSuccessPopup: function()
	{
			$.colorbox({
			html:  "<div class='PopupBox-inner col-md-12 col-xs-12'><div class='row'><p class='email-signup-headingSec'>"+ACC.config.thankYou+"</p><p><br/>"+ACC.config.emailConfirmationMsg+"</p><br/><span class='hidden-xs'><br/></span><div class='row'><div class='col-md-6 col-xs-12'><button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >Close</button></div></div></div></div>",
			width:"475px",
			maxHeight:"100%",
			overflow:"auto",
			opacity:0.7,
			className:"email-signup-popup",
			title:"<div class='hidden-md hidden-lg hidden-sm mobile-headerpart'>Email Signup</div>",
			close:'<span class="glyphicon glyphicon-remove"></span>',
			onComplete: function(){
				$("#colorbox").removeClass("email-signup");
				window.scrollTo(0,0);
			},
			onClosed: function(){
				$("#colorbox").removeClass("email-signup-popup");
			}
		});
	},
	
	signUpFailurePopup: function(msg)
	{
			$.colorbox({
				html: "<div class='PopupBox col-md-12 col-xs-12'><div class='hidden-xs cl'><br/></div><div class='row'><p>"+msg+"</p><br/><span class='hidden-xs'><br/></span><div class='row'><div class='col-md-6 col-xs-12'><button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >Close</button></div></div></div></div>",
				width:"460px",
				maxHeight:"100%",
				overflow:"auto",
				opacity:0.7,
				className:"email-signup-popup",
				title:"<div class='hidden-md hidden-lg hidden-sm mobile-headerpart'>Email Signup</div><h1 class='email-signup-headingpart headline'>Sorry !</h1>",
				close:'<span class="glyphicon glyphicon-remove"></span>',
				onComplete: function(){
				}
			});
	},
	
	invoicePopup: function()
	{
			$.colorbox({
			html: "<div class='PopupBox'><h1 class='headline2 invoice-headline'>"+ACC.config.shareViaEmail+"</h1><div class='margin20 share-invoice-email-description'>"+ACC.config.tellOthers+"</div><label for='emailIdInvoice' style='font-size:14px; color:inherit;'>"+ACC.config.emailTo+"</label><textarea class='col-md-12 col-sm-12 col-xs-12 form-control' rows='6' cols='10'  type='textarea' placeholder='"+ACC.config.emailToPlaceHolder+"' id='emailIdInvoice'></textarea><br><div id='emailError' style='margin:30px 0px'></div><br><input class='btn btn-primary margin20' type='button' value='"+ACC.config.contactUsEmail+"'  id='invoiceEmailSubmit'></div>",
			maxWidth:"650px",
			width:"430px",
			top:"0",
			maxHeight:"100%",
			overflow:"auto",
			opacity:0.7,
			className:"addNotFound",
			title: "<h4 class='hidden-md hidden-lg share-invoice-email-title headline'><span class='headline-text'>"+ACC.config.shareByEmail+"</span></h4>",
			close:'<span class="glyphicon glyphicon-remove" id="close"></span>',
			onComplete: function(){
				$("#colorbox").addClass("email-invoice-popup");
				$("body").css("overflow-y", "hidden");
			},
			onClosed: function(){
				$("#colorbox").removeClass("email-invoice-popup");
				$("body").css("overflow-y", "auto");
			}
		});
	},
	
	orderDetailsPopup: function()
	{
			$.colorbox({
			html: "<div class='PopupBox'>" +
						"<h3 class='headline3 order-title' style='margin-top:-10px;'>"+ACC.config.shareOrderDetailViaEmail+"</h3>" +
						"<div class='margin20  share-order-details-email-description'>"+ACC.config.dashboardTellOthers+"</div>"+
						"<label for='emailIdOrder' style='color:inherit;'>"+ACC.config.emailTo+"</label>" +
						"<div class='order-email-input'>" +
						"<textarea rows='5' cols='38' placeholder='"+ACC.config.enterEmail+"' id='emailIdOrder'></textarea>" +
						"</div>" +
						"<div id = 'emailError'></div> <br>" +
						"<div class='order-email-submit col-xs-5 col-md-4'><input  class='btn btn-primary btn-block' type='button' value='"+ACC.config.contactUsEmail+"' id='orderEmailSubmit'></div>" +
					"</div>",
			maxWidth:"auto",
			width:"450px",
			height:"auto",
			top:"0",
			maxHeight:"100%",
			overflow:"auto",
			opacity:0.7,
			title:"<h3 class='order-details-email-title-mobile hidden-md hidden-lg'>"+ACC.config.shareViaEmail+"</h3>",
			className:"addNotFound",
			close:'<span class="glyphicon glyphicon-remove" id="close"></span>',
			onOpen: function() {
                 $('#colorbox').addClass('order-details-email-pop-up');
               },
			onComplete: function(){
				$("#colorbox").addClass("order-details-email-pop-up");
				$("body").css("overflow-y", "hidden");
			},
			onClosed: function(){
				$("#colorbox").removeClass("order-details-email-pop-up");
				$("body").css("overflow-y", "auto");
			}
		});
	},
	
	
	
	showTeamRole: function(){
		$(document).ready(function () {

		    if ($('#Roled_b2bcustomergroup').is(':checked')) {
		        $('.team-role').show();
		    } else {
		        $('.team-role').hide();
		    }

		    
		});
		
		$("#Role_b2bcustomergroup,#Roled_b2bcustomergroup").click(function () {
			$(".team-role").show("slow");
		});
		
		$("#Role_b2badmingroup, #Roled_b2badmingroup").click(function () {
			$(".team-role").hide('slow');
		});

		$('input:radio[name="roles"]').change(function () {
				if ($("#Role_b2badmingroup, #Roled_b2badmingroup").is(':checked')) {
					$(".team-role").hide('slow');
					$('.role-box input:checkbox[name="invoicePermissions"]').prop('checked', true);
					$('.role-box input:checkbox[name="accountOverviewForParent"]').prop('checked', true);
					$('.role-box input:checkbox[name="accountOverviewForShipTos"]').prop('checked', true);
					$('.role-box input:checkbox[name="placeOrder"]').prop('checked', true);
					$('.role-box input:checkbox[name="payBillOnline"]').prop('checked', true);
				} else {
					$('.role-box input:checkbox').prop('checked', false);
					$(".team-role").show("slow");
				}
		});
			
		$("div.team-role").each(function () {
	        var $this = $(this);
	        $this.html($this.html().replace(/&nbsp;/g, ''));
	    });
		
	},
	
	requestaccountFormCutomerType: function(){
		if($(".page-requestaccount").length){
			ACC.global.numberInputEvents("#contrEmpCount", 1, 99999, 1);
		}
		$(document).ready(function() {
			$(window).scrollTop(0);
			if($("input:radio[id='typeOfCustomer1']").is(":checked")) {
		    		 $('.homeownerSec, .verification-icon-fill,.confirmation-icon-fill').hide();
		    		 $('.contratorSec,.business-icon,.verification-icon,.confirmation-icon').show();
		    	 }
		        
			 $('#typeOfCustomer1').click(function () {
			        $('.firstName').attr('disabled',true);
					$('.lastName').attr('disabled',true);
					$('.emailaddress').attr('disabled',true);
					$('#firstName').attr('disabled',false);
					$('#lastName').attr('disabled',false);
					$('#emailaddress').attr('disabled',false);
			        $('.homeownerSec').hide();
			        $('.contratorSec').show();
			        $('.banner-icon-wrapper, .btn-footr').removeClass("hidden");
					$('.RTA_wrapper,.businessDetails').show();
					$('#accountSelect').hide();
					$('.next_goback_wrapper').show();
					$('#realtime_submit').addClass('requestAccountFormSubmit');
					$('.companyphone').attr('disabled',false);
					$('#phoneNumber').attr('disabled',true);
					if(ACC.config.encodedContextPath == '/es'){
						$('#languagePreference2').click();
						$("#languagePreference2").parent().addClass("spanishPage-radio-circle");
					}else{
						$('#languagePreference1').click();
					}
			    });	   

		      $('#typeOfCustomer2').click(function () {
		    	    if($(".page-contactUs").length || $(".page-contactUs-ca").length){
		    		  $('#firstName').attr('disabled',false);
		    		  $('#lastName').attr('disabled',false);
		    	    }else{
		    	      $('#firstName').attr('disabled',true);
			    	  $('#lastName').attr('disabled',true);
		    	    }
					$('#emailaddress').attr('disabled',true);
					$('.firstName').attr('disabled',false);
					$('.lastName').attr('disabled',false);
					$('.emailaddress').attr('disabled',false);
			        $('.contratorSec').hide();
			        $('.homeownerSec').show();
			        $('.banner-icon-wrapper, .btn-footr').removeClass("hidden");
			    	$("#contrYearsInBusiness").val("");
			    	$("#contrEmpCount").val("");
			    	$("#contrPrimaryBusiness").val("");
			    	$("#contrPrimaryBusinessL1").val(ACC.config.select);
			    	$("#companyName").val("");
			    	//$('.banner-icon-wrapper-homeowner').show();
					$('.RTA_wrapper,.retailDetails').show();
					$('#accountSelect').hide();
					$('.next_goback_wrapper').show();
					$('#realtime_submit').addClass('requestAccountFormSubmit');
					$('.companyphone').attr('disabled',true);
					$('#phoneNumber').attr('disabled',false);
					if(ACC.config.encodedContextPath == '/es'){
						$('#homelanguagePreference2').click();
					}else{
						$('#homelanguagePreference1').click();
					}
		    	
		    });
		    $('.gb-footer-btn').click(function () {
				$(window).scrollTop(0);
				$('.RTA_wrapper,.businessDetails,.retailDetails').hide();
				$('#accountSelect').show();
				$('.next_goback_wrapper').hide();
				$('#realtime_submit').removeClass('requestAccountFormSubmit');
				if($("input:radio[id='typeOfCustomer1']").is(":checked") && !$(".verification-container-step2").hasClass('hidden')) {
					$('.RTA_wrapper,.businessDetails').show();
					$('.verification-container, .verification-container-step2').addClass("hidden");
					$('#accountSelect,.businessDetails,.retailDetails').hide();
					$('.next_goback_wrapper').show();
				}
				window.location.reload(true);
			});	
		});
	},
	
	resetDropdown:function(){

		if (performance.navigation.type == 2) {
		
			var cmspageid = $("#cmspageuid").val();
			if (cmspageid == 'my-company'){
				sessionStorage.setItem('selecteduserSession','All');
				window.location.href= ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/'+($("#unitUid").val()).trim() +'?shiptounit=All&viewtype=All&searchParam=&filterAdmin=false';
			}else if(cmspageid == 'orders'){
				sessionStorage.setItem('selectedOrderSession','All');
				window.location.href = ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateFrom='+($("#dateFrom").val()).trim()+'&dateTo='+($("#dateTo").val()).trim()+'&pagesize=25&sort=byDate';
			}else if(cmspageid == 'invoicelistingpage'){
				sessionStorage.setItem('selectedInvoiceSession','All');
				window.location.href = ACC.config.encodedContextPath + '/my-account/invoices/'+($("#unitUid").val()).trim()+'?invoiceShiptos=All&viewtype=All&searchParam=&dateFrom='+ ($("#dateFrom").val()).trim()+'&dateTo='+($("#dateTo").val()).trim()+'&pagesize=25&sort=byDate';
			}
			else if (cmspageid == 'ewalletdetailspage'){
				sessionStorage.setItem('selectedewalletSession','All');
				window.location.href= ACC.config.encodedContextPath + '/my-account/ewallet/'+($("#unitUid").val()).trim() +'?shiptounit=All&viewtype=All&searchParam=';
			}
		}
	},
	
	shiptoPopupManageUsers: function(){
		$(document).on('click','#cboxContent #ShipToUsers_popup', function(){ 

			 var unitId= $(this).siblings("#ship-toId").val()+"_US"; 
			 var name= $(this).parents(".shipTo-border").children(".zeropadding").eq(1).find("a").text();
			if($(".invoice-shiptopopup").length > 0){
				if ($(".ship-TosUser option").eq(0).val() == (unitId)
						|| $(".ship-TosUser option").eq(1)
								.val() == (unitId)
						|| $(".ship-TosUser option").eq(2)
								.val() == (unitId)
						|| $(".ship-TosUser option").eq(3)
								.val() == (unitId)
					    || $(".ship-TosUser option").eq(4)
				                .val() == (unitId)
						) {
						}else{
							$(".ship-TosUser option").eq(3).val(unitId).text(name);
						}
				 		$(".ship-TosUser").val(unitId);
				 		ACC.colorbox.close();


				 		return false;
					}

		});
		$('.ship-TosUser').on('click',function(){
			if($(".ship-TosUser").val() == "shipToopenPopupNew"){
				$(this).val('');
			}
		});

		$(document).on('change', 'body.page-my-company .ship-TosUser', function () {	

			var selecteduser = $(this).val();

				sessionStorage.setItem('selecteduserSession',selecteduser);
				 //previous = $(this).val();	

		/* }).on('change',function(e){*/

				var currentSelect = $(".ship-TosUser");


				var $form = $("#sortForm1");
				if (!ACC.paginationsort.downUpPressed)
				{
					var searchParam = $("#manager-user-voice").val();
					var viewpagination =$("#pageSizeManagerUser1").val();
					var shiptounit = $("#shipToSelected_user").val();
					var adminCheck = $('#admin_User').val();
					$form.find("input#search-shipto").val(searchParam);
					$form.find("input#shipToSelected_user").val(shiptounit);
					$form.find("input#search-ordernew").val(searchParam);
					$form.find("input#ViewPaginationManager").val(viewpagination);
					$form.find("input#admin_User").val(adminCheck);

				//if($(".ship-TosInvoice").val() != "shipToopenPopupNew"){

				//}												
				}


				if("shipToopenPopupNew" != $(".ship-TosUser").val()){
					if (!ACC.paginationsort.downUpPressed){
						$form.submit();
					}
					ACC.paginationsort.downUpPressed = false;
				}else if($(".ship-TosUser").val() == "shipToopenPopupNew"){
					var adminFilter = $('#admin_User').val();
					removeShipToSortbySessionValue();
					var shipToPopupURL = ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/all-ship-to-popup/'+($("#unitUid").val()).trim() +'?searchParam=&filterAdmin='+adminFilter;  
					$.ajax({
				            url: shipToPopupURL,

				            method: "GET",		
				            success: function(searchPageData) {
				                ACC.colorbox.open('Search or Select a Ship-To', {
				                    html: searchPageData,
				                    width: '800px',
				                    className:"shipto-popup-mb invoice-shiptopopup",
				                    overlayClose: false,
				                    onComplete: function(e) {
				                    	sessionStorage.removeItem("selecteduserSession");
				                    	$(".ship-TosUser").val('shipToopenPopupNew');
				        				
				        				checkShipToPopUpUser();
				                    	$(document).on('click keyup', '#search-ship-to-popup-user', function(){
				                    		checkShipToPopUpUser();
				                    	});
				                    },
				                    onClosed: function() {
				                    	sessionStorage.setItem("selecteduserSession","All");
			        					location.reload(true);
			        					window.location.href= ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/'+($("#unitUid").val()).trim() +'?shiptounit=All&viewtype=All&searchParam=&pagesize=10&sort=byName&filterAdmin='+adminFilter;
			        				
				                    }
				                });
				            }
				        });
				}
		 });

		 $(document).on('change','body.page-my-company .sortSelect.js-page-sort', function () {	

				var $form = $("#sortForm1");
				if (!ACC.paginationsort.downUpPressed)
			{
					var searchParam = $("#manager-user-voice").val();
					var viewpagination =$("#pageSizeManagerUser1").val();
					var shiptounit = $("#shipToSelected_user").val();
					var adminCheck = $('#admin_User').val();
					$form.find("input#search-shipto").val(searchParam);
					$form.find("input#shipToSelected_user").val(shiptounit);
					$form.find("input#search-ordernew").val(searchParam);
					$form.find("input#ViewPaginationManager").val(viewpagination);
					$form.find("input#admin_User").val(adminCheck);

			//if($(".ship-TosInvoice").val() != "shipToopenPopupNew"){

			//}												


					ACC.paginationsort.downUpPressed = false;

		}
		});

		/*$(document).on('click','.responsive-table-cell a',function(){				
			sessionStorage.removeItem('selectedInvoiceSession');
		});*/



				$(document).on("click", "#cboxWrapper .account-orderhistory-pagination-user a",function(e){

					var page='';
					previous = $(this).value;
								e.preventDefault();	
								if($(this).attr('rel') == "prev"){
									page = $(this).parents("ul").find("li.active").text().split("(")[0]-2
									}
									else if($(this).attr('rel') == "next"){
									    page = $(this).parents("ul").find("li.active").text().split("(")[0]
									}
									else{
									page= $(this).text().trim()-1;
									}
								var adminFilter = $('#admin_User').val();
								var data = {
										searchParam : $("#search-ship-to-popup-user").val() == undefined ? "" : $("#search-ship-to-popup-user").val().trim(),
										viewtype : 'All',
										page : page,
										filterAdmin : adminFilter,

									}
								var shipToPopupURL =ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/all-ship-to-popup/'+($("#unitUid").val()).trim();  
								var currentSelect = $(".ship-TosUser");
								var poupClass = $("#cboxOverlay").prop("class");
									$.ajax({
										url : shipToPopupURL,
										method : "GET",
										data : data,
										success : function(searchPageData) {
											ACC.colorbox.open('Search or Select a Ship-To', {
												html : searchPageData,
												width : '800px',
												className : poupClass,
												overlayClose : false,
												onComplete:function(){
													$(".ship-TosUser").val('shipToopenPopupNew');
							        				
							        				retrieveShipToSortbySessionValue();
							        				checkShipToPopUpUser();
												},
												onClosed: function() {

													sessionStorage.setItem("selecteduserSession","All");
						        					location.reload(true);
						        					window.location.href= ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/'+($("#unitUid").val()).trim() +'?shiptounit=All&viewtype=All&searchParam=&pagesize=10&sort=byName&filterAdmin='+adminFilter;
						        				
							                    }
											});
										}
									});

						});


			$(document).on("blur", "#cboxWrapper #search-ship-to-popup-user",function(e) {
						 removeShipToSortbySessionValue();
						 var key = e.which;
					 	 previous = $(this).value;
					 	 var adminFilter = $('#admin_User').val();
								var data = {
										searchParam : $("#search-ship-to-popup-user").val() == undefined ? "" : $("#search-ship-to-popup-user").val().trim(),
										filterAdmin : adminFilter

									}
								var shipToPopupURL =ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/all-ship-to-popup/'+($("#unitUid").val()).trim()+'searchParam=';
								var currentSelect = $(".ship-TosUser");
								var poupClass = $("#cboxOverlay").prop("class");
									$.ajax({
										url : shipToPopupURL,
										method : "GET",
										data : data,
										success : function(searchPageData) {
											ACC.colorbox.open('Search or Select a Ship-To', {
												html : searchPageData,
												width : '800px',
												className : poupClass,
												overlayClose : false,
												onComplete:function(){
												 	$(".ship-TosUser").val('shipToopenPopupNew');
							        				
							        				checkShipToPopUpUser();
						                    		
												},
												onClosed: function() {

													sessionStorage.setItem("selecteduserSession","All");
						        					location.reload(true);
						        					window.location.href= ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/'+($("#unitUid").val()).trim() +'?shiptounit=All&viewtype=All&searchParam=&pagesize=10&sort=byName&filterAdmin='+adminFilter;
						        				

							                    }
											});
										}
									});

						});	






						$(document).on("change", "#cboxWrapper .shipToUserPagePopup #sortOptions1", function(e) {
							var sortItem = $("#cboxWrapper #sortOptions1").val();
                        ;
                        var adminFilter = $('#admin_User').val();
							var data = {
								searchParam : $("#search-ship-to-popup-user").val() == undefined ? "" : $("#search-ship-to-popup-user").val().trim(),
								viewtype : 'All',
								sort : sortItem,
								filterAdmin : adminFilter,
							}
							var shipToPopupURL =ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/all-ship-to-popup/'+($("#unitUid").val()).trim() ;
							var poupClass = $("#cboxOverlay").prop("class");
							var currentSelect = $(".ship-TosUser");
							$.ajax({
								url : shipToPopupURL,
								method : "GET",
								data : data,
								success : function(searchPageData) {
									ACC.colorbox.open('Search or Select a Ship-To', {
										html : searchPageData,
										width : '800px',
										className : $("#cboxOverlay").prop("class"),
										overlayClose : false,
										onComplete:function(){
										 	$(".ship-TosUser").val('shipToopenPopupNew');
					        				
					        				retrieveShipToSortbySessionValue();
					        				checkShipToPopUpUser();
										},
										onClosed: function() {

											sessionStorage.setItem("selecteduserSession","All");
				        					location.reload(true);
				        					window.location.href= ACC.config.encodedContextPath + '/my-company/organization-management/manage-users/'+($("#unitUid").val()).trim() +'?shiptounit=All&viewtype=All&searchParam=&pagesize=10&sort=byName&filterAdmin='+adminFilter;
				        				
					                    }
									});
								}
							});

						});




	},
	shiptoPopupEwalletpage: function(){
		$(document).on('click','#cboxContent #ShipToeWallet_popup', function(){ 

			 var unitId= $(this).siblings("#ship-toId").val()+"_US"; 
			 var name= $(this).parents(".shipTo-border").children(".zeropadding").eq(1).find("a").text();
			if($(".invoice-shiptopopup").length > 0){
				if ($(".ship-ToseWallet option").eq(0).val() == (unitId)
						|| $(".ship-ToseWallet option").eq(1)
								.val() == (unitId)
						|| $(".ship-ToseWallet option").eq(2)
								.val() == (unitId)
						|| $(".ship-ToseWallet option").eq(3)
								.val() == (unitId)
					    || $(".ship-ToseWallet option").eq(4)
				                .val() == (unitId)
						) {
						}else{
							$(".ship-ToseWallet option").eq(3).val(unitId).text(name);
						}
				 		$(".ship-ToseWallet").val(unitId);
				 		ACC.colorbox.close();


				 		return false;
					}

		});
		$('.ship-ToseWallet').on('click',function(){
			if($(".ship-ToseWallet").val() == "shipToopenPopupNew"){
				$(this).val('');
			}
		});
		$(document).on('change', 'body.page-ewalletdetailspage .ship-ToseWallet', function () {	

			var selectedewallet = $(this).val();

				sessionStorage.setItem('selectedewalletSession',selectedewallet);
				

				var currentSelect = $(".ship-ToseWallet");


				var $form = $("#sortForm1");
				if (!ACC.paginationsort.downUpPressed)
				{
					var searchParam = $("#ewallet-page-card").val();
					var viewpagination =$("#pageSizeeWallet1").val();
					var shiptounit = $("#shipToSelected_eWallet").val();
					$form.find("input#search-shipto").val(searchParam);
					$form.find("input#shipToSelected_eWallet").val(shiptounit);
					$form.find("input#search-ordernew").val(searchParam);
					$form.find("input#ViewPaginationeWallet").val(viewpagination);
					

															
				}


				if("shipToopenPopupNew" != $(".ship-ToseWallet").val()){
					if (!ACC.paginationsort.downUpPressed){
						$form.submit();
					}
					ACC.paginationsort.downUpPressed = false;
				}else if($(".ship-ToseWallet").val() == "shipToopenPopupNew"){
						removeShipToSortbySessionValue();
						var searchParam = $("#search-ship-to-popup-ewallet").val() == undefined ? "" : $("#search-ship-to-popup-ewallet").val().trim()
					var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-eWallet-popup/'+($("#unitUid").val()).trim() +'?searchParam='+searchParam; 
					$.ajax({
				            url: shipToPopupURL,

				            method: "GET",		
				            success: function(searchPageData) {
				                ACC.colorbox.open('Search or Select a Ship-To', {
				                    html: searchPageData,
				                    width: '800px',
				                    className:"shipto-popup-mb invoice-shiptopopup",
				                    overlayClose: false,
				                    onComplete: function(e) {
				                    	sessionStorage.removeItem("selectedewalletSession");
				                    	$(".ship-ToseWallet").val('shipToopenPopupNew');
				                    	checkShipToPopUpEwallet();
				                    			$(document).on('click keyup', '#search-ship-to-popup-ewallet', function(){
						                    		checkShipToPopUpEwallet();
						                    	});
				        				
				                    },
				                    onClosed: function() {
				                    	sessionStorage.setItem('selectedewalletSession','All');
				        					location.reload(true);
				        					window.location.href= ACC.config.encodedContextPath + '/my-account/ewallet/'+($("#unitUid").val()).trim()+'?shiptounit=All&viewtype=All&searchParam=&pagesize=10&sort=byName';
				                    }
				                });
				            }
				        });
				}
		 });
		$(document).on('change','body.page-ewalletdetailspage .sortSelect.js-page-sort', function () {	

			var $form = $("#sortForm1");
			if (!ACC.paginationsort.downUpPressed)
		{
				var searchParam = $("#ewallet-page-card").val();
				var viewpagination =$("#pageSizeeWallet1").val();
				var shiptounit = $("#shipToSelected_eWallet").val();
				$form.find("input#search-shipto").val(searchParam);
				$form.find("input#shipToSelected_eWallet").val(shiptounit);
				$form.find("input#search-ordernew").val(searchParam);
				$form.find("input#ViewPaginationeWallet").val(viewpagination);

													


				ACC.paginationsort.downUpPressed = false;

	}
	});
		$(document).on("click", "#cboxWrapper .account-orderhistory-pagination-ewallet a",function(e){

			var page='';
			previous = $(this).value;
						e.preventDefault();	
						if($(this).attr('rel') == "prev"){
							page = $(this).parents("ul").find("li.active").text().split("(")[0]-2
							}
							else if($(this).attr('rel') == "next"){
							    page = $(this).parents("ul").find("li.active").text().split("(")[0]
							}
							else{
							page= $(this).text().trim()-1;
							}
						var data = {
								searchParam : $("#search-ship-to-popup-ewallet").val() == undefined ? "" : $("#search-ship-to-popup-ewallet").val().trim(),
								viewtype : 'All',
								page : page,


							}

						
							
						 if($(".ship-ToseWallet").val() == "shipToopenPopupNew"){
						var shipToPopupURL =ACC.config.encodedContextPath + '/my-account/all-ship-to-eWallet-popup/'+($("#unitUid").val()).trim() ;
						var currentSelect = $(".ship-ToseWallet");
						var poupClass = $("#cboxOverlay").prop("class");
							$.ajax({
								url : shipToPopupURL,
								method : "GET",
								data : data,
								success : function(searchPageData) {
									ACC.colorbox.open('Search or Select a Ship-To', {
										html : searchPageData,
										width : '800px',
										className:"shipto-popup-mb invoice-shiptopopup",
										overlayClose : false,
										onComplete:function(){
											$(".ship-ToseWallet").val('shipToopenPopupNew');
											retrieveShipToSortbySessionValue();
					        				checkShipToPopUpEwallet();

										},
										onClosed: function() {
										
										sessionStorage.setItem('selectedewalletSession','All');
				        					location.reload(true);
				        					window.location.href= ACC.config.encodedContextPath + '/my-account/ewallet/'+($("#unitUid").val()).trim()+'?shiptounit=All&viewtype=All&searchParam=&pagesize=10&sort=byName';					              
										      }
									});
								}
							});
						}
				});
		
		$(document).on("blur", "#cboxWrapper #search-ship-to-popup-ewallet",function(e) {
						 removeShipToSortbySessionValue();
		 	var key = e.which;
		 	 previous = $(this).value;

					var data = {
							searchParam : $("#search-ship-to-popup-ewallet").val() == undefined ? "" : $("#search-ship-to-popup-ewallet").val().trim()

						}
					var shipToPopupURL =ACC.config.encodedContextPath + '/my-account/all-ship-to-eWallet-popup/'+($("#unitUid").val()).trim() ;
					var currentSelect = $(".ship-ToseWallet");
					var poupClass = $("#cboxOverlay").prop("class");
						$.ajax({
							url : shipToPopupURL,
							method : "GET",
							data : data,
							success : function(searchPageData) {
								ACC.colorbox.open('Search or Select a Ship-To', {
									html : searchPageData,
									width : '800px',
									className : poupClass,
												overlayClose : false,
									onComplete:function(){
									 	$(".ship-ToseWallet").val('shipToopenPopupNew');
				        				
									 	checkShipToPopUpEwallet();


									},
									onClosed: function() {

									sessionStorage.setItem('selectedewalletSession','All');
				        					location.reload(true);
										
				        					window.location.href= ACC.config.encodedContextPath + '/my-account/ewallet/'+($("#unitUid").val()).trim()+'?shiptounit=All&viewtype=All&searchParam=&pagesize=10&sort=byName';


				                    }
								});
							}
						});

			});	

		$(document).on("change", "#cboxWrapper .shipToUserPagePopup #sortOptions1", function(e) {
			var sortItem = $("#cboxWrapper #sortOptions1").val();
        ;
			var data = {
				searchParam : $("#search-ship-to-popup-ewallet").val() == undefined ? "" : $("#search-ship-to-popup-ewallet").val().trim(),
				viewtype : 'All',
				sort : sortItem,

			}
			var shipToPopupURL =ACC.config.encodedContextPath + '/my-account/all-ship-to-eWallet-popup/'+($("#unitUid").val()).trim() ;
			
			$.ajax({
				url : shipToPopupURL,
				method : "GET",
				data : data,
				success : function(searchPageData) {
					ACC.colorbox.open('Search or Select a Ship-To', {
						html : searchPageData,
						width : '800px',
						overlayClose : false,
						className : $("#cboxOverlay").prop("class"),
						onComplete:function(){
						 	$(".ship-ToseWallet").val('shipToopenPopupNew');
	        			

					        				retrieveShipToSortbySessionValue();
					        				checkShipToPopUpEwallet();
										},
										onClosed: function() {

											sessionStorage.setItem('selectedewalletSession','All');
				        					location.reload(true);
										
				        					window.location.href= ACC.config.encodedContextPath + '/my-account/ewallet/'+($("#unitUid").val()).trim()+'?shiptounit=All&viewtype=All&searchParam=&pagesize=10&sort=byName';

	                    }
					});
				}
			});

		});

		
	},
	bindDeleteEwalletPopup: function()
	  {
		  $(document).on("click", "#ewallet-delete-card", function()	{
			  _satellite.track('deletecard');
			  $(this).addClass("edit-delete");
			  var vaultToken = $('#cboxLoadedContent #editVaultToken').val();
			  window.scrollTo(0,0);
	  		ACC.colorbox.open("", {
	  			    html: $("#ewallet-delete").html(),
	                width: '480px',
	               height:'auto',
	                title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.eWalletDelete+"</span></h4>",
	                close:'<span class="glyphicon glyphicon-remove"></span>',
	                onComplete: function() {
	                	_AAData.popupPageName= ACC.config.deletecardPageName;
	                	_AAData.popupChannel= ACC.config.myaccountpathingChannel;
        			 	try {
        				    	 _satellite.track('popupView');
        		        } catch (e) {}
	            		$("body").css("overflow-y", "hidden");
	            		$("#cboxLoadedContent #editVaultToken").val($(".edit-delete").closest(".responsive-table-ewallet").find("#vaultToken").val());
	            		$('#cboxWrapper #cboxClose, #cboxWrapper #cancel').on('click',function(){
							window.location.reload();
        				});
	            	},
	            	onClosed: function() {
	            		$('body').css("overflow-y","auto");
	            		
	            		window.location.reload();
	            		
	            		
	            	}	
	  		  });
			});
			
		  
			

	  },
	  bindDeleteMessageEwalletPopup: function()
	  {
		
		  $(document).on("click",  "#cboxLoadedContent #delete_confirmation_ewallet", function(e)
	    	        {
			 
			  
			  var vaultToken = $('#cboxLoadedContent #editVaultToken').val();
			 
	    	  e.preventDefault();
	    	    $.ajax({
	    	            url : ACC.config.encodedContextPath + "/my-account/delete-card",
	    	            method:"POST",
	    	            data: {"vaultToken":vaultToken},
	    	            success : function(response)
	    	            {
	    	            	if(response != null && response == "SUCCESS" ){
	    	            		_satellite.track('cardDeleted');
	    	            		 window.scrollTo(0,0);
	    	            		ACC.colorbox.open("", {
	    	    	  			    html: $("#ewallet-delete-succes").html(),
	    	    	                width: '550px',
	    	    	                top: 'auto',
	    	    	                title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.eWalletDeleteMessage+".</span></h4>",
	    	    	                close:'<span class="glyphicon glyphicon-remove"></span>',
	    	    	                onComplete: function() {
	    	    	                	_AAData.popupPageName=ACC.config.carddeletedPageName;
	    	    	                	_AAData.popupChannel= ACC.config.myaccountpathingChannel;
	                    			 	try {
	                    				    	 _satellite.track('popupView');
	                    		        } catch (e) {}
	    	    	                	$('#colorbox').addClass('Pop-up-carts-delete');
	    	    	                	$('#cboxLoadedContent .close_window').click(function(){
    	          	            			window.location.reload();
    	          	                		
    	          	                		});
	    	    	            		$("body").css("overflow-y", "hidden");
	    	    	            		
	    	    	            	},
	    	            		onClosed: function() {
	    	    	          	  	window.location.reload();
	    	    	          	  	}
	    	            		});
	    	            		
	    	            	}
	    	            	else{
	    	            		
	    	          	  		ACC.colorbox.open("", {
	    	          	  			    html: $("#ewallet-delete-failure").html(),
	    	          	                width: '480px',
	    	          	              height:'auto',
	    	          	                title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.eWalletTechnicalError+"</span></h4>",
	    	          	                close:'<span class="glyphicon glyphicon-remove"></span>',
	    	          	              onComplete: function() {
		    	    	                	$('#colorbox').addClass('Pop-up-delete');
		    	    	                	$('#cboxLoadedContent .close_window').click(function(){
	    	          	            			window.location.reload();
	    	          	                		
	    	          	                		});
		    	    	            		$("body").css("overflow-y", "hidden");
		    	    	            		
		    	    	            	},
	    	          	            	
	    	          	  	onClosed: function() {
	    	          	  	$('#colorbox').removeClass('Pop-up-delete');
	    	          	  	window.location.reload();
	    	          	  	}
	    	          	  	
	    	          	  		  });	    	            	    	            	
	    	            }
	    	            }
	    	        });
	    	            
	    	        });
		  

	  },
	  bindBoardCard:function(){
	      $(document).on("click", "#ewallet-add-credit-card", function(e)
	    	        {
	    	  e.preventDefault();
	    	  loading.start();
	    	    $.ajax({
	    	            url : ACC.config.encodedContextPath + "/my-account/getBoardCardTransportKey",
	    	            method:"GET",
	    	            success : function(transportKey)
	    	            {
	    	            	_satellite.track('addNewcard');
	    	            	if(transportKey !=null){
	    	            		loading.stop();
	    	            var redirecturl = 'https://transport.merchantware.net/v4/TransportMobile.aspx?transportKey='+transportKey;
	    	            window.scrollTo(0,0);
	    	            ACC.colorbox.open("", {
	    	    			html: $("#iframe_Popup").html(),
	    	    			width: '550px',
	    	    		
	    	    			title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.eWalletAdd+"</span></h4>",
	    	    			close:'<span class="glyphicon glyphicon-remove"></span>',
	    	    			onComplete: function() {
	    	    				_AAData.popupPageName= ACC.config.addnewcardPageName;
	    	    				_AAData.popupChannel= ACC.config.myaccountpathingChannel;
                			 	try {
                				    	 _satellite.track('popupView');
                		        } catch (e) {}
	    	    			$('#colorbox').addClass('Pop-up-carts');
	    	    			$('#cboxLoadedContent').addClass('pop-up-contain');
	    	    			$('#cboxWrapper').addClass('pop-up-contain-value');
	    	    			
	    	    			$("body").css("overflow-y", "hidden");
	    	    			 $('#cboxContent #cboxClose').click(function(){
	    	    				  window.location.reload();
	    	    				  });
	    	    		
	    	    			},
	    	    			onClosed: function() {
	    	    			$('body').css("overflow-y","auto");
	    	    			$('#cboxLoadedContent').removeClass('pop-up-contain');
	    	    			$('#cboxWrapper').removeClass('pop-up-contain-value');
	    	    			$('#colorbox').removeClass('Pop-up-carts');
	    	    			window.location.reload();
	    	    		
	    	    			}
	    	    		});
	    	            $("#cboxLoadedContent ").find('.Pop-up-myIframe').attr('src', redirecturl );
	    	           
	    	            }
	    	            }
	    	        });
	    	            
	    	        });
	  },
	 
		
bindEditEwalletPop: function(){
		  
		  $(document).on("click", "#ewallet-edit-card", function() {
			  _satellite.track('editcard');
		  $(this).addClass("edit-cards");
		  
		  ACC.colorbox.open("", {
		  html: $("#ewallet-edit").html(),
		  width: '480px',
		  title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.EditCard+"</span></h4>",
		  close:'<span class="glyphicon glyphicon-remove"></span>',
		  onComplete: function() {
			  _AAData.popupPageName= ACC.config.editcardPageName;
			  _AAData.popupChannel= ACC.config.myaccountpathingChannel;
			 	try {
				    	 _satellite.track('popupView');
		        } catch (e) {}
			  $('#colorbox').addClass('Pop-up-edit-card-title');
		  $('#cboxLoadedContent').addClass('Pop-up-edit-card');
		  $('#cboxContent').addClass('Pop-up-edit-box');
		  $("#cboxLoadedContent .expirydate").hide();
		  $("#cboxLoadedContent .expirydatesame").hide();
		  $("#cboxLoadedContent .error_updated").hide();
		  
		  $("#cboxLoadedContent .expiry_year_size").hide();
		  $("#cboxLoadedContent #ewallet-edit-page-card").val($(".edit-cards").closest(".responsive-table-ewallet").find("#ewalletNickName").val());
		  $("#cboxLoadedContent #ewallet-card-expiration").val($(".edit-cards").closest(".responsive-table-ewallet").find("#ewalletExpe").val());
		  $("#cboxLoadedContent #editVaultToken").val($(".edit-cards").closest(".responsive-table-ewallet").find("#vaultToken").val());
		  
		  $("body").css("overflow-y", "hidden");
		  $('#cboxContent #cboxClose').click(function(){
		  window.location.reload();
		  });
		  
		  $("#cboxLoadedContent #ewallet-card-expiration").keyup(function(e){
			  if (e.keyCode != 8){
              if ($(this).val().length == 2){
                      $(this).val($(this).val() + "-");
              }
			  }   
             
         });
		  
		  $('#cboxLoadedContent #ewallet-card-expiration').keypress(function (e) {
			    var regex = new RegExp("^[0-9-]+$");
			    var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);
			    if (regex.test(str)) {
			        return true;
			    }

			    e.preventDefault();
			    return false;
			});

		
		  
		  },
		  onClosed: function() {
		  $('body').css("overflow-y","auto");
		  window.location.reload();
		  $('#cboxLoadedContent').removeClass('Pop-up-edit-card');
		  $(this).removeClass("edit-cards");
		  }
		  });
		  });
	  },
	  
	  
	  bindEditSubmitEwallet: function()
	  {
		 
		  $(document).on("click",  "#cboxLoadedContent #edit_confirmation_ewallet", function(e){
			  var nickname = $('#cboxLoadedContent #ewallet-edit-page-card').val();
			  var vaultToken = $('#cboxLoadedContent #editVaultToken').val();
			  var expiryDate = $('#cboxLoadedContent #ewallet-card-expiration').val();
			  var expDate = expiryDate.split("-");
			  var expMonth = expDate[0];
			  var expYear = expDate[1];
			   if(expMonth <1  ||expMonth > 12){
			  $("#cboxLoadedContent .expiry_year_size").show();
			  $("#cboxLoadedContent .expirydate").hide();
			  $("#cboxLoadedContent .expirydatesame").hide();
			  $("#cboxLoadedContent .error_updated").hide();
			  $("#cboxLoadedContent .expiry_empty").hide();
			 
			  $('#cboxLoadedContent #ewallet-card-expiration').addClass('error-message-ewallet');
			  }else if(expYear.length > 2){
			  $("#cboxLoadedContent .expiry_year_size").show();
			  $("#cboxLoadedContent .expirydate").hide();
			  $("#cboxLoadedContent .expirydatesame").hide();
			  $("#cboxLoadedContent .error_updated").hide();
			  $("#cboxLoadedContent .expiry_empty").hide();
			
			  $('#cboxLoadedContent #ewallet-card-expiration').addClass('error-message-ewallet');
			  }
			  else{
			  loading.start();
			  e.preventDefault();
	    	    $.ajax({
	    	            url : ACC.config.encodedContextPath + "/my-account/editEwallet",
	    	            method:"POST",
	    	            data: {"vaultToken":vaultToken, "nickName":nickname,"expDate": expiryDate},
	    	            success : function(response)
	    	            {
	    	            	
	    	            	loading.stop();
	    	            	if(response != null && response == "SUCCESS"){
		    	            	_satellite.track('cardEdited');
	    	            		
	    	            		ACC.colorbox.open("", {
	     	    	  			    html: $("#ewallet-edit-success").html(),
	    	    	                width: '550px',
	    	    	               
	    	    	                title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.EditCardMessage+".</span></h4>",
	    	    	                close:'<span class="glyphicon glyphicon-remove"></span>',
	    	    	                onComplete: function() {
	    	    	                	_AAData.popupPageName= ACC.config.cardeditedPageName;
	    	    	                	_AAData.popupChannel= ACC.config.myaccountpathingChannel;
	                    			 	try {
	                    				    	 _satellite.track('popupView');
	                    		        } catch (e) {}
	    	    	                	 $('#cboxContent #cboxClose').click(function(){
	    	    	           			  window.location.reload();
	    	    	           			  });
	    	    	            		$("body").css("overflow-y", "hidden");
	    	    	            		
	    	    	            	},
	    	    	            	 onClosed: function() {
	    	    	            		 window.location.reload();
	    	    	            		 $('body').css("overflow-y","auto");
	    	    	            	 }
	    	    	            	
	    	            		});
	    	            		
	    	            	}else if(response != null && response == "EXPFAILURE"){
	    	            		
	    	           		  $("#cboxLoadedContent .error_updated").hide();
	    	           		  $("#cboxLoadedContent .expiry_empty").hide();
	    	           		  $("#cboxLoadedContent .expiry_year_size").hide();
	    	            		$("#cboxLoadedContent .expirydate").show();
	    	            		 $("#cboxLoadedContent .expirydatesame").hide();
	    	   				  $('#cboxLoadedContent #ewallet-card-expiration').addClass('error-message-ewallet');
	    	            	}else if(response != null &&( response == "SAME")){
	    	            		
		    	           		  $("#cboxLoadedContent .error_updated").hide();
		    	           		  $("#cboxLoadedContent .expiry_empty").hide();
		    	           		  $("#cboxLoadedContent .expiry_year_size").hide();
		    	            		$("#cboxLoadedContent .expirydate").hide();
		    	            		$("#cboxLoadedContent .expirydatesame").show();
		    	   				  $('#cboxLoadedContent #ewallet-card-expiration').addClass('error-message-ewallet');
		    	            	}else{
	    	            		
	    	           		  $("#cboxLoadedContent .error_updated").show();
	    	           		  $("#cboxLoadedContent .expiry_empty").hide();
	    	           		  $("#cboxLoadedContent .expiry_year_size").hide();
	    	            		$("#cboxLoadedContent .expirydate").hide();
	    	            		 $("#cboxLoadedContent .expirydatesame").hide();
	    	            	}
	    	            	
	    	            }
	    	   
	    	        });
			  }
	    	            
	    	        });
		  
	  },
	  bindNickNameCards:function(){
		  $(document).on("blur", "#cboxLoadedContent #card_holder_nickname", function(e)
	    	        { 
	    	  var nickName=$("#cboxLoadedContent #card_holder_nickname").val(); 
	      	  e.preventDefault();
	    	    $.ajax({
	    	            url : ACC.config.encodedContextPath +'/checkout/multi/siteone-payment/setSaveCardInSession?nickName='+nickName+'&saveCard=true',
	    	            method:"POST",
	    	            success : function()
	    	            {
	    	            	
	    	            }
	    	   
	    	        });
		      
	    	        });
	  },

	  bindEditEnabled:function(){
		  $(document).on("keyup", "#cboxLoadedContent #ewallet-card-expiration", function(e){
			  if($(this).val().length > 4){
		            $('#cboxLoadedContent #edit_confirmation_ewallet').attr('disabled', false);
		        }
		        else
		        {
		            $('#cboxLoadedContent #edit_confirmation_ewallet').attr('disabled', true);        
		        }
			    
			});
		  
		 
	    	        },

	    	        bindManageEwalletPopUp: function(){

	    	  		  $(document).on("click", "#ewallet-assgin", function() {
	    	  			  var assignRevokePopupURL = ACC.config.encodedContextPath + '/my-account/manageEwallet';
	    	  			  $(this).addClass("manage-cards");
	    	  			  var vaultToken = $(".manage-cards").closest(".responsive-table-ewallet").find("#vaultToken").val();
	    	  			  var unitId =  $('#unitIdVal').val();
	    	  			loading.start();
	    	  			  $.ajax({
	    	    	            url : assignRevokePopupURL,
	    	    	            method:"GET",
	    	    	            data: {"vaultToken":vaultToken,"unitId":unitId},
	    	  	            success : function(response)
	    	  	            {
	    	  	            	_satellite.track('assigneWalletPopup')
	    	  		  window.scrollTo(0,0);
	    	  		loading.stop();
	    	  		  ACC.colorbox.open("", {
	    	  		  html: response,
	    	  		  width: '480px',
	    	  		  height:'auto',
	    	  		  title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.manageCard+"</span></h4>",
	    	  		  close:'<span class="glyphicon glyphicon-remove"></span>',
	    	  		  onComplete: function() {
	    	  			_AAData.popupPageName= ACC.config.managecardpathingPageName;
	    	  			_AAData.popupChannel= ACC.config.myaccountpathingChannel;
        			 	try {
        				    	 _satellite.track('popupView');
        		        } catch (e) {}
	    	  		bindGrantRevokedData();
	    	  		  $("#cboxLoadedContent .grantAccessData").hide();
	    	  			$("#cboxLoadedContent .revokeAccessData").hide();
	    	  			  $('#cboxLoadedContent input:radio[name="radio-group"]').change(function() {
	    	  			        if ($(this).val() == 'Assign') {
	    	  			        	$('#cboxLoadedContent  .grant_revoke_box').prop('checked', false);
	    	  			        	bindGrantRevokeEnabledPagination();
	    	  			        	$('#cboxLoadedContent  #grantAccess').prop('checked', true);
	    	  			        	bindPaginationGrant();
	    	  		                
	    	  			        } else if($(this).val() == 'Revoke') {
	    	  			        	$("#cboxLoadedContent .grantAccessData").hide();
	    	  						$("#cboxLoadedContent .revokeAccessData").show();
	    	  						bindRevokeEnabledPagination();
	    	  						 $('#cboxLoadedContent  #grant_box').prop('checked', false);
	    	  						 bindPagination();
	    	  			        }
	    	  			    });
	    	  			  $("body").css("overflow-y", "hidden");
	    	  		  $('#cboxContent #cboxClose').click(function(){
	    	  		  window.location.reload();

	    	  		  });
	    	  		  },
	    	  		  onClosed: function() {
	    	  		  $('body').css("overflow-y","auto");
	    	  		  window.location.reload();
	    	  		  $('#cboxLoadedContent').removeClass('Pop-up-edit-card');
	    	  		  $(this).removeClass("manage-cards");
	    	  		  }
	    	  		  });
	    	  	            }
	    	  			  });
	    	  			  });
	    	  	  },
	  
	  bindGrantRevokeEnabled:function(){
		  $(document).on("click", "#cboxLoadedContent #grant_box", function(e){
			  $("#cboxLoadedContent #grant_confirmation_ewallet").attr("disabled", !$("#grant_box:checked").length);
			    
			});
		  
		  $(document).on("click", "#cboxLoadedContent .grant_revoke_box", function(e){
			  $("#cboxLoadedContent #grant_confirmation_ewallet").attr("disabled", !$(".grant_revoke_box:checked").length);
			    
			});
		  
	    	        },
	  
	  bindManageEwalletPopUpConfirm: function(){
	  $(document).on("click", "#cboxLoadedContent #grant_confirmation_ewallet", function(e){
		  var vaultToken = $('#cboxLoadedContent #editVaultToken').val();
		  var nickname = [];
		  $.each($("input[name='grant']:checked"), function(){
	    	  nickname.push($(this).val());
	      });
	     var listOfCustIds=  nickname.join(",");
	     var grant_revoke = [];
		  $.each($('#cboxLoadedContent input:radio[name="radio-group"]:checked'), function(){
			  grant_revoke.push($(this).val());
	      });
	     var ot=  grant_revoke.join(", ");
		
		  var vaultToken = $('#cboxLoadedContent #editVaultToken').val();
		  
		  e.preventDefault();
		  loading.start();
		  $.ajax({
		  url :ACC.config.encodedContextPath +  "/my-account/assign-revoke-ewallet",
		  method:"POST",
		  data: {"listOfCustIds":listOfCustIds,"vaultToken":vaultToken,"operationType": ot},
		  success : function(response)
		  {
		  loading.stop();
		  if(response != null && response == "SUCCESS"){
			  
			  
			  ACC.colorbox.open("", {
			    html: $("#ewallet-revoke-grant-success").html(),
                width: '550px',
               
                title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.ewalletAccessPrivilege+".</span></h4>",
                close:'<span class="glyphicon glyphicon-remove"></span>',
                onComplete: function() {
                	_AAData.popupPageName= ACC.config.privilegeupdatedpathingPageName;
			  		_AAData.popupChannel= ACC.config.myaccountpathingChannel;
    			 	try {
    				    	 _satellite.track('popupView');
    		        } catch (e) {}
                	 $('#cboxContent #cboxClose').click(function(){
           			  window.location.reload();
           			  });
            		$("body").css("overflow-y", "hidden");
            		
            	},
            	 onClosed: function() {
            		 window.location.reload();
            		 $('body').css("overflow-y","auto");
            	 }
            	
    		});
		  }
		  else if(response != null && response == "FAILURE")
			  ACC.colorbox.open("", {
				    html: $("#ewallet-revoke-grant-failure").html(),
	                width: '550px',
	               
	                title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.ewalletAccessFailure+".</span></h4>",
	                close:'<span class="glyphicon glyphicon-remove"></span>',
	                onComplete: function() {
	                	 $('#cboxContent #cboxClose').click(function(){
	           			  window.location.reload();
	           			  });
	            		$("body").css("overflow-y", "hidden");
	            		
	            	},
	            	 onClosed: function() {
	            		 window.location.reload();
	            		 $('body').css("overflow-y","auto");
	            	 }
	            	
	    		});
			  
			  }

		  });
		  });
	},
    specialties: [],	// available specialtis filters
    lastZipCode: 0,	//last zipcode searched
    lastMiles: 100,	//last miles searched
    homeBranchSelection: function () {	// showing Branch slection Page
		let zipCode = $("#zipcode").val();
        $("#branch-finder-zip").val(zipCode);
        $('.RTA_wrapper, #realtime_submit, .gb-footer-btn, .retailDetails, .businessDetails, .business-fill-icon, .branch-icon').addClass('hidden');
        $('.branchDetails, .branch-wrapper, .branch-selection-back, .branch-selection-next, .business-success-icon, .branch-fill-icon').removeClass('hidden');
        ACC.accountdashboard.updateStores("");
        ACC.accountdashboard.lastZipCode = zipCode;
    },
	showSpecialtiesOption: function () {	//Toggle specialties dropdown
        let target = $('.specialties-option');
        if (target.hasClass('showing')) {
            target.removeClass('showing').slideUp();
        }
        else {
            target.addClass('showing').slideDown();
        }
    },
    updateStores: function (e) {	//checking new branches
        var zipcode = $("#branch-finder-zip").val();
        var miles = $("#branch-finder-miles").val();
        if (ACC.formvalidation.validatezipcode(e, zipcode) && zipcode.length >= 5)	//zipcode !error
        {
            $(".branch-not-found, .specialties").addClass("hidden");
            $(".specialties-option").removeClass('showing').slideUp();
            $(".branch-result-zipcode").html(zipcode);
            $(".branch-result-miles").html(miles);
			ACC.formvalidation.removeErrorClassForRegForm('#branch-finder-zip', '#errorInZipcode', '#branch-finder-zip\\.errors', ACC.config.dashboardValidZip);
            if (ACC.accountdashboard.lastZipCode != zipcode || Number(miles) > ACC.accountdashboard.lastMiles) {	//getting new branches
                ACC.accountdashboard.lastZipCode = zipcode;
                ACC.accountdashboard.lastMiles = Number(miles);
                loading.start();
                $(".branch-card").remove();
                ACC.accountdashboard.getStoreData(zipcode, miles);
            }
            else if (ACC.accountdashboard.lastZipCode == zipcode && $(".branch-card").length) {	//applying filters
                ACC.accountdashboard.createFilters();
            }
			else{
				$(".branch-result-found, .branch-result-not-found, .branch-show-more, .branch-selected-text").addClass("hidden");
                $(".branch-not-found").removeClass("hidden");
				$("#storeid").val("");
				loading.stop();
			}
        }
        else {	//zipcode error
            ACC.formvalidation.addErrorClassForRegForm('#branch-finder-zip', '#errorInZipcode', '#branch-finder-zip\\.errors', ACC.config.dashboardValidZip);
        }
    },
    getStoreData: function (zipcode, miles) {	//geting new Store Data
        $.ajax({
            url: ACC.config.encodedContextPath + "/request-account/getStoreData", // "/store-finder",
            cache: false,
            data: { "zipcode": zipcode, "miles": miles },
            type: "get",
            success: function (response) {
                let data = response;
                let dataLength = data.length;
                let branchHTML = "";
                let specialtiesName = [ACC.config.agronomics, ACC.config.delivery, ACC.config.hardscape, ACC.config.irrigation, ACC.config.pestmanagement, ACC.config.nursery, ACC.config.outdoor];
                let specialtiesTags = ['Agronomics', 'Delivery', 'Hardscapes', 'Irrigation', 'Pesticide', 'Nursery', 'Lighting'];
                if (dataLength) {	//found some stores
                    for (let i = 0; i < dataLength; i++) {
                        let specialtyHTML = "";
                        let specialtyArray = [];
						let distance=(data[i].formattedDistance)? data[i].formattedDistance.split(" ")[0] : 0;
                        if (data[i].storeSpecialityDetails) {
                            for (let j = 0; j < specialtiesTags.length; j++) {	//tagging specialites
                                let specialtyText = specialtiesName[j];
                                let specialtyTag = specialtiesTags[j];
                                let l = -1;
                                for (let k = 0; k < data[i].storeSpecialityDetails.length; k++) {
                                    if (data[i].storeSpecialityDetails[k].code.indexOf(specialtyTag) != -1) {
                                        l = k;
                                        break;
                                    }
                                }
                                if (l != -1) {
                                    specialtyArray.push(specialtyTag);
                                    specialtyHTML += '<div class="col-md-4 col-xs-6 padding0 p-r-15 bold-text f-s-12 flex-center specialty"><img class="m-r-15" alt="' + specialtyText + '" title="' + specialtyText + '" src="/_ui/responsive/theme-lambda/images/branchspecialty_' + specialtyTag + '.png"/><span>' + specialtyText + '</span></div>';
                                }
                            }
                        }
                        branchHTML += '<div class="row margin0 marginBottom10 padding-20 text-default transition-3s branch-card hidden" data-filter="' + specialtyArray.join("~") + '" data-storeid="' + data[i].storeId + '" data-branch="' + data[i].name + '" data-distance="' + distance + '" onclick="ACC.accountdashboard.makeMyBranch(\'' + data[i].storeId + '\')"><div class="branch-selected-icon"><img alt="branch selected" title="branch selected" src="/_ui/responsive/theme-lambda/images/branchselected.png"/></div><div class="col-md-7 col-xs-12 padding0 m-b-15 font-size-14"><p class="bold-text f-s-18 m-b-5">' + data[i].name + '</p><p class="bold-text m-b-5">' + data[i].title + '</p><p class=" m-b-0">' + data[i].address.line1 + ((data[i].address.line2)? ', ' + data[i].address.line2 :  '') + '</p><p class="m-b-0">' + data[i].address.town + ' ' + data[i].address.region.isocodeShort + ' ' + data[i].address.postalCode + '</p><p class=" m-b-0">' + data[i].address.phone + '</p></div><div class="col-md-5 col-xs-12 p-r-0 text-right branch-info-extra"><div class="row"><div class="col-md-12 col-xs-6 p-l-0"><button class="btn bold-text font-size-14 selected-branch-txt">' + ACC.config.selectedHomeBranch + '</button><button data-idx="" class="btn bg-white bold-text  font-size-14 make-branch-link">' + ACC.config.makeMyHomeBranch + '</button></div><div class="col-md-12 col-xs-6 text-right branch-miles">' + data[i].formattedDistance + '</div></div></div><div class="cl"></div>' + specialtyHTML + '</div>';
                    }
                    $(".branch-wrapper .branch-results").append(branchHTML);
                    ACC.accountdashboard.createFilters();	//checking filters
                }
                else {	//no store found
                    $(".branch-result-found, .branch-result-not-found, .branch-show-more, .branch-selected-text").addClass("hidden");
                    $(".branch-not-found").removeClass("hidden");
					$("#storeid").val("");
                }
				window.scrollTo({ top: $(".branchDetails").offset().top, left: 0, behavior: 'smooth' });
                loading.stop();
            }
        }).always(function () { loading.stop(); });
    },
    createFilters: function () {	// creating filter button and clear button
        let specialtiesHTML = "";
        ACC.accountdashboard.specialties = [];
        $('.choose-specialty').each(function () {
            let target = $(this);
            let selectedoption = target.parents(".specialty-name").find("img").attr("title");
            let specialtyIcon = target.parents(".specialty-name").find("img").attr("src");
            let filter = target.prop("id");
            if (target.is(":checked")) {
                specialtiesHTML += '<div class="col-md-4 col-xs-6 marginBottom10 specialties-name"><span class="selected-specialties"> <img src=' + specialtyIcon + '><span class="font-size-14 font-small-xs">' + selectedoption + '</span><button class="btn bg-white pull-right" onclick="ACC.accountdashboard.removeFilter(this,\'' + filter + '\')" ><span class="delete-specialty"></span></button></span></div>';
                ACC.accountdashboard.specialties.push(filter);
            }
        });
        if (specialtiesHTML != "") {
            specialtiesHTML = '<button class="hidden-sm hidden-md hidden-lg col-xs-4 btn bg-white clear-specialties" onclick="ACC.accountdashboard.clearFilters()">' + ACC.config.clearAll + '</button>' + specialtiesHTML + '<button class="col-md-2 hidden-xs btn bg-white clear-specialties" onclick="ACC.accountdashboard.clearFilters()">' + ACC.config.clearAll + '</button>';
            $(".specialties").html(specialtiesHTML).removeClass("hidden");
        }
        ACC.accountdashboard.displayBranches();	// getting filterred Branches
    },
    removeFilter: function (e, id) {	// removing Branch filter button
        let target = $(e);
        target.parents(".specialties-name").remove();
        $("#" + id).prop("checked", false);
        if (!$(".specialties-name").length) {
            $(".clear-specialties").remove();
        }
        ACC.accountdashboard.specialties.splice(ACC.accountdashboard.specialties.indexOf(id), 1);
        ACC.accountdashboard.displayBranches();	// getting filterred Branches
    },
    clearFilters: function () {	// clearing all Branch filters
        $(".clear-specialties, .specialties-name").remove();
        $('.choose-specialty').prop("checked", false);
        ACC.accountdashboard.specialties = [];
        ACC.accountdashboard.displayBranches();	// getting all Branches
    },
    displayBranches: function () {	// showing filtered Branches
        let dataLength = 0;
		let specialtiesLength = ACC.accountdashboard.specialties.length;
		let filtrMiles = $("#branch-finder-miles").val();
		let branchResultFound;
        $(".branch-card, .branch-result-found, .branch-result-not-found, .branch-show-more, .branch-selected-text").addClass("hidden");
        $(".branch-card").each(function (index) {
            let target = $(this);
			let distance = Number(target.data("distance"));
			target.removeClass("branch-result-matched");
            if (specialtiesLength) {	// filter selected for Branches
				let filter = target.data("filter").split("~");
				let matchFound = true;
                for (let i = 0; i < specialtiesLength; i++) {	//checking && condition for specialties
                    if (filter.indexOf(ACC.accountdashboard.specialties[i]) == -1) {
                        matchFound = false;
                        break;
                    }
                }
                if (matchFound && distance <= filtrMiles) {	//Match Found
                    ACC.accountdashboard.selectingBranch(dataLength, target);	// selecting Home Branch
                    dataLength++;
                }
            }
            else if(distance <= filtrMiles) {	// no filter selected for Branches
                ACC.accountdashboard.selectingBranch(dataLength, target);
                dataLength++;
            }
        });
        if (!dataLength) {	// no filtered Branches found
            for (let i = 0; i < $(".branch-card").length; i++) {
				let target = $(".branch-card").eq(i);
				let distance = Number(target.data("distance"));
				if(distance <= filtrMiles) {	// no filter selected for Branches
					ACC.accountdashboard.selectingBranch(dataLength, target);	// selecting Home Branch
					dataLength++;
					branchResultFound = true;
				}
            }
        }
		$(".branch-result-found, .branch-result-not-found, .branch-not-found").addClass("hidden");
		if (!dataLength) {	// showing no Branch
			$(".specialties").html("");
			$(".branch-show-more, .branch-selected-text").addClass("hidden");
			$(".branch-not-found").removeClass("hidden");
			$("#storeid").val("");
        }
		else if(branchResultFound){	// showing within selected miles Branches
			$(".branch-result-not-found").removeClass("hidden");
		}
        else {	// showing all the Branches
            $(".branch-result-found").removeClass("hidden");
        }
		loading.stop();
    },
    selectingBranch: function (dataLength, target) {	// selecting Home Branch
        if (dataLength < 5) {
            if (dataLength == 0) {
                ACC.accountdashboard.makeMyBranch(target.data("storeid"));
            }
            target.removeClass("hidden");
        }
        else {
            $(".branch-show-more").removeClass("hidden");
        }
		target.addClass("branch-result-matched");
        $(".branch-result-number").html(dataLength + 1);
    },
    makeMyBranch: function (branch) {	// setting new Home Branch
		let target = $("[data-storeid='" + branch + "']");
		$(".branch-result-branch").html(target.data("branch"));
		$(".branch-selected-text").removeClass("hidden");
        $(".branch-selected").removeClass("branch-selected");
        target.addClass("branch-selected");
		$("#storeid").val(branch);
    },
    showMoreBranches: function (e) {	// show more Branch button
        $(".branch-result-matched").removeClass("hidden");
        $(e).addClass("hidden");
    },
    nextCreateCustomer: function (e) {	// procedding to confirmation page
		$(e).removeAttr("onclick");
		loading.start();
        $('.branchDetails, .branch-wrapper, .branch-selection-back, .branch-selection-next, .branch-selected-text, .branch-fill-icon, .confirmation-icon').addClass('hidden');
		$('.branch-success-icon, .confirmation-fill-icon').removeClass('hidden');
		if ($("input:radio[id='typeOfCustomer1']").is(":checked")) {
			$('.verification-container, .verification-container-step1').removeClass('hidden');
		}
		if ($("input:radio[id='typeOfCustomer2']").is(":checked")) {
			$("input[name='enrollInPartnersProgram']").prop('checked', false);
		}
		$.ajax({
			url: ACC.config.encodedContextPath + "/request-account/createCustomer",
			method: "POST",
			data: $('#siteOneRequestAccountForm').serialize(),
			success: function (response) {
				$('.RTA_wrapper, .businessDetails, .retailDetails, .next_goback_wrapper').hide();
				$('#realtime_submit').removeClass('requestAccountFormSubmit');
				if (response == "SUCCESS") {
					if ($("input:radio[id='typeOfCustomer1']").is(":checked")) {    //contract success
						$('.verification-container-step1').addClass("hidden");
						$('.verification-container-step2').removeClass('hidden');
						setTimeout(function () {
							$('#multiNavigateHomePage2, .shop_siteone_wrap, .verification-container-step5').removeClass("hidden");
							$('#multiNavigateHomePage1, .verification-container').addClass("hidden");
						}, 7000);
					}
					else {	// homeowner success - active acc
						$('#multiNavigateHomePage2, .shop_siteone_wrap, .verification-container-step5').removeClass("hidden");
						$('#multiNavigateHomePage1').addClass("hidden");
					}
					ACC.formvalidation.analyticsDataSet(true);
				}
				else {	// Failure - homeowner and contractor
					$('.verification-container-step1').addClass("hidden");
					$('.verification-container, .verification-container-step3, .shop_siteone_wrap').removeClass("hidden");
					ACC.formvalidation.analyticsDataSet(false);
				}
				loading.stop();
			},
			error: function () {	// Error - homeowner and contractor
				$('.RTA_wrapper, .businessDetails, .retailDetails, .next_goback_wrapper').hide();
				$('.verification-container-step1').addClass("hidden");
				$('.verification-container, .verification-container-step3, .shop_siteone_wrap').removeClass("hidden");
				$('#realtime_submit').removeClass('requestAccountFormSubmit');
				ACC.formvalidation.analyticsDataSet(false);
				loading.stop();
			}
		});
    },
    backCreateCustomer: function () {
        $('.branchDetails, .branch-wrapper, .branch-selection-back, .branch-selection-next, .branch-selected-text').addClass('hidden');
        $('.RTA_wrapper, #realtime_submit, .gb-footer-btn, .retailDetails, .businessDetails').removeClass('hidden');
        $('.business-success-icon, .branch-fill-icon').addClass('hidden');
        $('.business-fill-icon, .branch-icon').removeClass('hidden');
		$("#storeid").val("");
		$("#branch-finder-miles").prop("selectedIndex",0);
		$(".choose-specialty").prop("checked", false);
    },

	bindAnayticDataOrderApproval:function(){
		try {
			if($(".page-order-approval-details").length > 0){
				_AAData.orderNumber=$(".orderapproval-number").text();
				_AAData.orderAmount=$(".orderapproval-amount").text().replace("$", "");
				_AAData.orderStatus=$(".orderapproval-status").text();
			}
		}catch(e){}
	},
	selfServeStatus: true,
    bindSelfServeForm: function () {
        let pageVal = $(".pagename").val();
        if (pageVal == "Account Request Online") {
            let pageName = "my account : validation";
            let pathingChannel = "my account";
            ACC.accountdashboard.selfServePageAnalytics(pageName, pathingChannel, pageName);
        }
        $(".selfServe-formsubmit").on("click", function (e) {
            e.preventDefault();
            loading.start();
            document.getElementById('recaptchaValidator').value = grecaptcha.getResponse();
            ACC.briteverify.reCaptcha(grecaptcha.getResponse());
            ACC.accountdashboard.selfServeStatus = true;
            let emailText = $("#selfServeEmail").val();
            let isEmailValid = ACC.formvalidation.validateEmailPattern(emailText);
            if (ACC.formvalidation.validateAccountNumber(e) == false) //account number check
            {
                ACC.accountdashboard.selfServeStatus = false;
            }
            if (isEmailValid) //email id check
            {
                ACC.formvalidation.removeErrorClassForRegForm('#selfServeEmail', '#errorEmailAddress', '#selfServeEmail\\.errors', ERRORMSG.invalid.email);
            }
            else {
                ACC.accountdashboard.selfServeStatus = false;
                ACC.formvalidation.addErrorClassForRegForm('#selfServeEmail', '#errorEmailAddress', '#selfServeEmail\\.errors', ERRORMSG.invalid.email);
            }
            $('*[id*=error]:visible').each(function () {
                if ($(this).html() != '') {
                    ACC.accountdashboard.selfServeStatus = false;
                }
            });
            if (ACC.accountdashboard.selfServeStatus) {
                ACC.accountdashboard.selfServeEventAnalytics('', 'Continue', 'my account : validation', 'linkClicks');
                ACC.formvalidation.validateEmailWithBriteVerifyOnBlur('#selfServeEmail', '#errorEmailAddress', '#selfServeEmail\\.errors', ERRORMSG.global.email, emailText, '#siteOneRequestOnlineAccessForm');
            }
            else {
                loading.stop();
            }
        });
    },
    selfServeFormSubmit: function (isEmailValid, input, error, errorText, msg, textstatus) {
        if (!isEmailValid) {	//BriteVerify email respose check
            ACC.briteverify.vaildateEmailFields(input, error, errorText, msg, textstatus);
            loading.stop();
        }
        else {
            $.ajax({
                url: ACC.config.encodedContextPath + "/request-account/onlineAccessResponse",
                method: "POST",
                data: $('#siteOneRequestOnlineAccessForm').serialize(),
                success: function (response) {
                    if (response) {
                        isEmailValid = (response == "SUCCESS") ? 1 : (response == "accountNumberNotExists") ? 2 : (response == "isEmailExist") ? 3 : 2;
                        $(".selfServe-form").addClass("hidden");
                        if (isEmailValid == 1 && ACC.global.wWidth < 774) {
                            $(".selfServe-home").removeClass("hidden");
                            $(".selfServe-siteone").addClass("hidden");
                        }
                        $(".selfServe-response-" + isEmailValid).removeClass("hidden");
                        let pageName = (isEmailValid == 1) ? "my account : validation success" : (isEmailValid == 2) ? "my account : error: no or invalid email" : (isEmailValid == 3) ? "my account : error : existing account w/online access" : "my account : error: no or invalid email";
                        let pathingChannel = "my account";
                        let trackId = "pageload";
                        ACC.accountdashboard.selfServePageAnalytics(pageName, pathingChannel, pageName, trackId);
                    }
                    loading.stop();
                },
                error: function () {	// Error
                    ACC.accountdashboard.selfServeEventAnalytics('', 'Something went wrong', 'my account : validation', 'linkClicks');
                    ACC.accountdashboard.error500Popup("Something went wrong!", "An unexpected error has occurred", "Retry", { pageName: "my account : validation - something went wrong", pathingChannel: "my account", pathingPageName: "my account : validation - something went wrong", trackId: "pageload" }, { linktype: "", linkName: "Retry", onClickPageName: "my account : validation - something went wrong", trackId: "linkClicks" }, { pageName: "my account : validation", pathingChannel: "my account", pathingPageName: "my account : validation", trackId: "pageload" });
                    loading.stop();
                }
            });
        }
    },
    backSelfServe: function () {
        loading.start();
        $(".selfServe-form").removeClass("hidden");
        $(".selfServe-response-1, .selfServe-response-2, .selfServe-response-3").addClass("hidden");
        grecaptcha.reset();
        loading.stop();
        ACC.accountdashboard.selfServePageAnalytics("my account : validation", "my account", "my account : validation", "pageload");
    },
    accountNumberHelp: function () {
        $.colorbox({
            html: "<img width='100%' src='/_ui/responsive/theme-lambda/images/tool-tip-image.png' />",
            maxWidth: "100%",
            width: "1226px",
            height: (ACC.global.wWidth < 774) ? "285px" : "745px",
            maxHeight: "100%",
            overflow: "auto",
            title: false,
            className: "accountNumberHelp",
            close: '<span class="icon-close"></span>'
        });
    },
    error500Popup: function (heading, text, btn, pageAnalytics, eventAnalytics, pageAnalytics2) {
        $.colorbox({
            html: '<div class="row"><div class="col-md-12 text-center"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 126 126" fill="#ccc" ><path d="M63,0a63,63,0,1,0,63,63A63,63,0,0,0,63,0Zm0,119.35A56.35,56.35,0,1,1,119.35,63,56.35,56.35,0,0,1,63,119.35Z"/><path d="M59.91,76.87,57.06,47.8V34.37H68.94V47.8L66.13,76.87ZM57.53,91.63v-11h11v11Z"/></svg><h3 class="bold">' + heading + '</h3><p>' + text + '</p><button class="btn btn-primary btn-block" onclick=\'ACC.colorbox.close();' + (pageAnalytics ? 'ACC.accountdashboard.selfServePageAnalytics("' + pageAnalytics.pageName + '", "' + pageAnalytics.pathingChannel + '", "' + pageAnalytics.pathingPageName + '", "' + pageAnalytics.trackId + '"); ' : '') + (eventAnalytics ? 'ACC.accountdashboard.selfServeEventAnalytics("' + eventAnalytics.linktype + '", "' + eventAnalytics.linkName + '", "' + eventAnalytics.onClickPageName + '", "' + eventAnalytics.trackId + '"); ' : '') + (pageAnalytics2 ? 'ACC.accountdashboard.selfServePageAnalytics("' + pageAnalytics2.pageName + '", "' + pageAnalytics2.pathingChannel + '", "' + pageAnalytics2.pathingPageName + '", "' + pageAnalytics2.trackId + '");' : '') + '\'>' + btn + '</button></div></div>',
            width: "340px",
            height: "235px",
            title: false,
            className: "accountNumberHelp",
            close: '<span class="icon-close"></span>'
        });
    },
    selfServeEventAnalytics: function (linktype, linkName, onClickPageName, trackId) {
        digitalData.eventData = {
            linktype: linktype,
            linkName: linkName,
            onClickPageName: onClickPageName
        }
        if (trackId) {
            try {
                _satellite.track(trackId);
            } catch (e) { }
        }
    },
    selfServePageAnalytics: function (pageName, pathingChannel, pathingPageName, trackId) {
        _AAData.page.pageName = pageName;
        _AAData.pathingChannel = pathingChannel;
        _AAData.pathingPageName = pathingPageName;
        if (trackId) {
            try {
                _satellite.track(trackId);
            } catch (e) { }
        }
    },
    openApprovalPOUpdateContainer: function(){
    	var poValue = $('.js-po-value').attr('data-value');
    	var mode = poValue.length ? 'saveDelete': 'save';
    	if(mode=="save"){
    		$(".js-po-container").addClass("col-md-6").removeClass("col-md-4");
    		$(".po-info").addClass("hidden");
    		$(".po-update-container").removeClass("hidden");
    		$(".js-po-cancel").removeClass("hidden");
    		$(".js-po-delete").addClass("hidden");
    		$(".po-input").val(poValue);
    	}
    	
    	if(mode=="saveDelete"){
    		$(".js-po-container").addClass("col-md-6").removeClass("col-md-4");
    		$(".po-info").addClass("hidden");
    		$(".po-update-container").removeClass("hidden");
    		$(".js-po-cancel").addClass("hidden");
    		$(".js-po-delete").removeClass("hidden");
    		$(".po-input").val(poValue);
    	}
    },
    validationMessagePOUpdate: function(mode, msg) {
    	if(mode == "show"){
    		$(".po-input").css({
				'border-color': "#EF8701",
				'background-color': "#FEF3E5"
			});
    		$(".js-po-err-msg").removeClass("hidden").text(msg);
    	}
    	
    	if(mode == "hide"){
    		$(".po-input").removeAttr("style");
    		$(".js-po-err-msg").addClass("hidden");
    	}
    },
    onchangePOUpdate: function(){
    	var poNumberRequired = $("#poNumberRequired").val();
    	var po = $('.po-input').val();
    	
    	if(poNumberRequired == "true" && po.length <1){
    		ACC.accountdashboard.validationMessagePOUpdate("show", $(".js-po-err-msg-1").text());
    	}else{
    		ACC.accountdashboard.validationMessagePOUpdate("hide");
    	}
    },
    cancelApprovalPOUpdate: function() {
    	$(".js-po-container").addClass("col-md-4").removeClass("col-md-5");
    	$(".po-info").removeClass("hidden");
    	$(".po-update-container").addClass("hidden");
    },
    saveApprovalPOUpdate: function(){
    	var poNumberRequired = $("#poNumberRequired").val();
    	var po = $('.po-input').val();
    	
    	if(poNumberRequired == "true" && po.length <1){
    		ACC.accountdashboard.validationMessagePOUpdate("show");
    		return;
    	}else{
    		ACC.accountdashboard.validationMessagePOUpdate("hide");
    	}
    	
    	var data = {
			orderNumber: $('.orderapproval-number').text(),
			PO: po,
			status: "update"
    	};
    	ACC.accountdashboard.ajaxPOUpdate(data, function(res){
    		if(res == true){
	    		ACC.accountdashboard.cancelApprovalPOUpdate();
	    		$('.js-po-value').text(po.length ? po : 'NA');
	    		$('.js-po-value').attr('data-value', po.length ? po : '');
	    		ACC.accountdashboard.validationMessagePOUpdate("hide");
    		}else {
    			ACC.accountdashboard.validationMessagePOUpdate("show", $(".js-po-err-msg-1").text());
    		}
    	})
    },
    deleteApprovalPOUpdate: function(){
    	var poNumberRequired = $("#poNumberRequired").val();
    	var po = $('.po-input').val();
    	
    	if(poNumberRequired == "true"){
    		ACC.accountdashboard.validationMessagePOUpdate("show", $(".js-po-err-msg-2").text());
    		return;
    	}else {
    		ACC.accountdashboard.validationMessagePOUpdate("hide");
    	}
    	
    	var data = {
			orderNumber: $('.orderapproval-number').text(),
			PO: po,
			status: "delete"
    	};
    	ACC.accountdashboard.ajaxPOUpdate(data, function(res){
    		if (res == true){
	    		ACC.accountdashboard.cancelApprovalPOUpdate();
	    		$('.js-po-value').text('NA');
	    		$('.js-po-value').attr('data-value','');
	    		ACC.accountdashboard.validationMessagePOUpdate("hide");
    		}else {
    			ACC.accountdashboard.validationMessagePOUpdate("show");
    		}
    	})
    },
    ajaxPOUpdate: function(data, successcb, errorcb) {
    	$.ajax({
            url: ACC.config.encodedContextPath + "/my-account/order/updatePO",
            method: "POST",
            data: data,
            success: function (response) {
                successcb(response);
            },
            error: function () {
            	errorcb();
            }
        });
    },
	showShiptoMsg: function() {
		if ($(".js-show-shipto-msg").data('has-child-units') === true) {
			$(".js-show-shipto-msg").removeClass("hidden");
		}
		else {
			$(".js-show-shipto-msg").addClass("hidden");
		}
	},
	showPartnersPoint: function() {
		
	    var duration = 2000,
	    easing = 'swing';
		$('.show-partnerscontent').click(
		    function(){
				var el = $(this).closest(".dashboard-card");
				var toggleMinHeight = el.attr('data-minheight');
				var toggleMaxHeight = el.attr('data-maxheight');
		        var curH = el.height();
		        var contnt = el.find(".content-container");
					
		        if (el.is(':animated')){
		            return false;
		        }
		        else if (curH <= toggleMaxHeight && curH >= 300) {
		            el.animate(
		                {
		                    'height' : toggleMinHeight
		                }, duration, easing,function(){
							$(this).find(".eyeopen").removeClass("hidden");
							$(this).find(".eyeclose").addClass("hidden");
						});
		                contnt.slideUp(duration);
		        }
		        else if (curH <= toggleMinHeight){
					contnt.removeClass("hidden");
		            el.animate(
		                {
		                    'height' : toggleMaxHeight
		                }, duration, easing,function(){
							$(this).find(".eyeclose").removeClass("hidden");
							$(this).find(".eyeopen").addClass("hidden");
						});
		                contnt.slideDown();
		        }
		    });
		
	},
	moveToHome: function() {
		sessionStorage.setItem('updateAccount', 'true');
		window.location.href = ACC.config.encodedContextPath;
	},
	orderPrintHeaderHeight: function(){
		let defaultHeightClass = 150; //"print-min-h-165-imp";
		var msgText = $.trim($(".order-height-adjust-grey").eq(3).children("p").html());
		let minHeight = 75;
		while(msgText.length > minHeight){
			minHeight += 30;
			defaultHeightClass += 30;
		}
		defaultHeightClass = (defaultHeightClass < 165) ? 165 : defaultHeightClass;
		$(".order-height-adjust-grey").addClass("print-min-h-" + defaultHeightClass + "-imp");
	}
};
function bindPaginationGrant(){
$(document).on("click", "#cboxWrapper .account-orderhistory-pagination-ewallet a",function(e){
		
		if($('#cboxLoadedContent input:radio[name="radio-group"]:checked').val() == "Assign")
      {
		var page='';
		previous = $(this).value;
		
		if($(this).attr('rel') == "prev"){
		page = $(this).parents("ul").find("li.active").text().split("(")[0]-2
		}
		else if($(this).attr('rel') == "next"){
		page = $(this).parents("ul").find("li.active").text().split("(")[0]
		}
		else{
		page= $(this).text().trim()-1;
		}
		var grant_revoke = [];
		$.each($('#cboxLoadedContent input:radio[name="radio-group"]:checked'), function(){
		grant_revoke.push($(this).val());
		});
		var ot= grant_revoke.join(", ");
		
		$(this).addClass("manage-cards");
		  var vaultToken = $(".manage-cards").closest(".responsive-table-ewallet").find("#vaultToken").val();
		  var unitId =  $('#unitIdVal').val();
		var data = {

		page : page,
		vaultToken:vaultToken,
		unitId:unitId,
		action:ot
		}
		var poupClass = $("#cboxOverlay").prop("class");
			var assignRevokePopupURL = ACC.config.encodedContextPath + '/my-account/assignRevoke-users';
		
		  $.ajax({
	            url : assignRevokePopupURL,
	            method:"GET",
	            Class:poupClass,
	            overlayClose : false,
	            data: data,
            success : function(response)
            {
            	 window.scrollTo(0,0);
  	  		  ACC.colorbox.open("", {
  	  		  html: response,
  	  		overlayClose : false,
  	  		  width: '480px',
  	  		  height:'auto',
  	  		  title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.manageCard+"</span></h4>",
  	  		  close:'<span class="glyphicon glyphicon-remove"></span>',
  	  		  onComplete: function() {
  	  		
  	  		 $('#cboxLoadedContent  #grant_box').prop('checked', true);
  	  		  bindGrantRevokedData();
  	  		  $("#cboxLoadedContent .grantAccessData").hide();
  	  			$("#cboxLoadedContent .revokeAccessData").hide();
  	  			$('#cboxLoadedContent  #grantAccess').prop('checked', true);
  	  			bindGrantRevokePagination();
  	  			$("#cboxLoadedContent .grantAccessData").show();
  	  			$('#cboxLoadedContent  #grant_box').prop('checked', false);
  	  			$("body").css("overflow-y", "hidden");
  	  		  $('#cboxContent #cboxClose').click(function(){
  	  		  window.location.reload();

  	  		  });
  	  		  },
  	  		  onClosed: function() {
  	  		  $('body').css("overflow-y","auto");
  	  		  window.location.reload();
  	  		  $('#cboxLoadedContent').removeClass('Pop-up-edit-card');
  	  		  $(this).removeClass("manage-cards");
  	  		  }
  	  		  });
            }
		  });
	}
	
		})
		}
function bindPagination(){
$(document).on("click", "#cboxWrapper .account-orderhistory-pagination-ewallet a",function(e){
	if($('#cboxLoadedContent input:radio[name="radio-group"]:checked').val() == "Revoke")
      {
		var page='';
		previous = $(this).value;
		
		if($(this).attr('rel') == "prev"){
		page = $(this).parents("ul").find("li.active").text().split("(")[0]-2
		}
		else if($(this).attr('rel') == "next"){
		page = $(this).parents("ul").find("li.active").text().split("(")[0]
		}
		else{
		page= $(this).text().trim()-1;
		}
		var grant_revoke = [];
		$.each($('#cboxLoadedContent input:radio[name="radio-group"]:checked'), function(){
		grant_revoke.push($(this).val());
		});
		var ot= grant_revoke.join(", ");
		
		$(this).addClass("manage-cards");
		  var vaultToken = $(".manage-cards").closest(".responsive-table-ewallet").find("#vaultToken").val();
		  var unitId =  $('#unitIdVal').val();
		var data = {

		page : page,
		vaultToken:vaultToken,
		unitId:unitId,
		action:ot
		}
		
		var poupClass = $("#cboxOverlay").prop("class");
			var assignRevokePopupURL = ACC.config.encodedContextPath + '/my-account/assignRevoke-users';
		
		  $.ajax({
	            url : assignRevokePopupURL,
	            method:"GET",
	            Class:poupClass,
	            overlayClose : false,
	            data: data,
            success : function(response)
            {
            	 window.scrollTo(0,0);
  	  		  ACC.colorbox.open("", {
  	  		  html: response,
  	  		overlayClose : false,
  	  		  width: '480px',
  	  		  height:'auto',
  	  		  title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.manageCard+"</span></h4>",
  	  		  close:'<span class="glyphicon glyphicon-remove"></span>',
  	  		  onComplete: function() {
  	  		   $('#cboxLoadedContent  #grant_box').prop('checked', true);
  	  		   bindGrantRevokedData();
  	  		  $("#cboxLoadedContent .grantAccessData").hide();
  	  		  $('#cboxLoadedContent  #revokeAccess').prop('checked', true);
  	  		  $("#cboxLoadedContent .revokeAccessData").show();
  	  		  $('#cboxLoadedContent  #grant_box').prop('checked', false);
  	  		bindGrantRevokePagination();
  	  		$("body").css("overflow-y", "hidden");
  	  		  $('#cboxContent #cboxClose').click(function(){
  	  		  window.location.reload();
  	  		  });
  	  		  },
  	  		  onClosed: function() {
  	  		  $('body').css("overflow-y","auto");
  	  		  window.location.reload();
  	  		  $('#cboxLoadedContent').removeClass('Pop-up-edit-card');
  	  		  $(this).removeClass("manage-cards");
  	  		  }
  	  		  });
            }
		  });
		  
		}
		})
		}
function bindGrantRevokePagination(){
$('#cboxLoadedContent input:radio[name="radio-group"]').change(function() {
        if ($(this).val() == 'Assign') {
        	$("#cboxLoadedContent .grantAccessData").show();
        	bindGrantRevokeEnabledPagination();
        	$('#cboxLoadedContent  #grantAccess').prop('checked', true);
        	bindPaginationGrant();
              
              $("#cboxLoadedContent .revokeAccessData").hide();
              $('#cboxLoadedContent  .grant_revoke_box').prop('checked', false);
        } else {
        	$("#cboxLoadedContent .grantAccessData").hide();
        	$('#cboxLoadedContent  #revokeAccess').prop('checked', true);
        	bindRevokeEnabledPagination();
			$("#cboxLoadedContent .revokeAccessData").show();
			 $('#cboxLoadedContent  #grant_box').prop('checked', false);
			 bindPagination();
			
        }
    });
}
function bindGrantRevokedData(){
$('#cboxLoadedContent').addClass('Pop-up-edit-card');
  $('#cboxContent').addClass('Pop-up-edit-box');

  $("#cboxLoadedContent #ewallet-manage-card-number").text($(".manage-cards").closest(".responsive-table-ewallet").find("#lastdigitalcard").val());
  $("#cboxLoadedContent #ewallet-manage-card-nick-name").text($(".manage-cards").closest(".responsive-table-ewallet").find("#ewalletNickName").val());
  $("#cboxLoadedContent #ewallet-manage-card-date").text($(".manage-cards").closest(".responsive-table-ewallet").find("#ewalletExpe").val());
  $("#cboxLoadedContent #ewallet-manage-card-name").text($(".manage-cards").closest(".responsive-table-ewallet").find("#ewalletName").val());
  $("#cboxLoadedContent #ewallet-manage-card-type").text($(".manage-cards").closest(".responsive-table-ewallet").find("#ewalletCardType").val());
  $("#cboxLoadedContent #editVaultToken").val($(".manage-cards").closest(".responsive-table-ewallet").find("#vaultToken").val());
}
function bindGrantRevokeEnabledPagination(){
  	var assignRevokePopupURL = ACC.config.encodedContextPath + '/my-account/assignRevoke-users';
		  $(this).addClass("manage-cards");
		  var vaultToken = $(".manage-cards").closest(".responsive-table-ewallet").find("#vaultToken").val();
		  var unitId =  $('#unitIdVal').val();
		var grant_revoke = [];
		$.each($('#cboxLoadedContent input:radio[name="radio-group"]:checked'), function(){
		grant_revoke.push($(this).val());
		});
		var ot= grant_revoke.join(", ");
		
		var data = {
		vaultToken:vaultToken,
		unitId:unitId,
		action:ot

		}
		 $.ajax({
            url : assignRevokePopupURL,
            method:"GET",
            data: data,
          success : function(response)
          {
          	 window.scrollTo(0,0);
	  		  ACC.colorbox.open("", {
	  		  html: response,
	  		  width: '480px',
	  		  height:'auto',
	  		overlayClose : false,
	  		  title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.manageCard+"</span></h4>",
	  		  close:'<span class="glyphicon glyphicon-remove"></span>',
	  		  onComplete: function() {
	  		bindGrantRevokedData();
	  		  $("#cboxLoadedContent .grantAccessData").hide();
	  			$("#cboxLoadedContent .revokeAccessData").hide();
	  			$('#cboxLoadedContent  #grantAccess').prop('checked', true);
	  			$("#cboxLoadedContent .grantAccessData").show();
	  			$('#cboxLoadedContent  #grant_box').prop('checked', false);
	  			bindGrantRevokePagination();
	  		$("body").css("overflow-y", "hidden");
	  		  $('#cboxContent #cboxClose').click(function(){
	  		  window.location.reload();

	  		  });
	  		  },
	  		  onClosed: function() {
	  		  $('body').css("overflow-y","auto");
	  		  window.location.reload();
	  		  $('#cboxLoadedContent').removeClass('Pop-up-edit-card');
	  		  $(this).removeClass("manage-cards");
	  		  }
	  		  });
          }
		  });
}

function bindRevokeEnabledPagination(){
  	var assignRevokePopupURL = ACC.config.encodedContextPath + '/my-account/assignRevoke-users';
		  $(this).addClass("manage-cards");
		  var vaultToken = $(".manage-cards").closest(".responsive-table-ewallet").find("#vaultToken").val();
		  var unitId =  $('#unitIdVal').val();
		var grant_revoke = [];
		$.each($('#cboxLoadedContent input:radio[name="radio-group"]:checked'), function(){
		grant_revoke.push($(this).val());
		});
		var ot= grant_revoke.join(", ");
		
		var data = {
		vaultToken:vaultToken,
		unitId:unitId,
		action:ot

		}
		  $.ajax({
            url : assignRevokePopupURL,
            method:"GET",
            data: data,
          success : function(response)
          {
          	 window.scrollTo(0,0);
	  		  ACC.colorbox.open("", {
	  		  html: response,
	  		  width: '480px',
	  		  height:'auto',
	  		overlayClose : false,
	  		  title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.manageCard+"</span></h4>",
	  		  close:'<span class="glyphicon glyphicon-remove"></span>',
	  		  onComplete: function() {
	  		
	  		 $('#cboxLoadedContent  #grant_box').prop('checked', true);
	  		bindGrantRevokedData();
	  		  $("#cboxLoadedContent .grantAccessData").hide();
	  			$('#cboxLoadedContent  #revokeAccess').prop('checked', true);
	  			$('#cboxLoadedContent  #grant_box').prop('checked', false);
	  			bindGrantRevokePagination();
	  			$("body").css("overflow-y", "hidden");
	  		  $('#cboxContent #cboxClose').click(function(){
	  		  window.location.reload();

	  		  });
	  		  },
	  		  onClosed: function() {
	  		  $('body').css("overflow-y","auto");
	  		  window.location.reload();
	  		  $('#cboxLoadedContent').removeClass('Pop-up-edit-card');
	  		  $(this).removeClass("manage-cards");
	  		  }
	  		  });
          }
		  });
}


function checkShipToPage(){
	var searchShipToVal = $('#search-ship-to').val();
	disableShipToSearch(searchShipToVal);
}

function checkShipToPopUp(){
	var searchShipToPopupVal = $('#search-ship-to-popup').val();
	disableShipToSearch(searchShipToPopupVal);
}

function checkShipToPopUpUser(){
	var searchShipToPopupUserVal = $('#search-ship-to-popup-user').val();
	disableShipToSearch(searchShipToPopupUserVal);
}

function checkShipToPopUpEwallet(){
	var searchShipToPopupEwallet = $('#search-ship-to-popup-ewallet').val();
	disableShipToSearch(searchShipToPopupEwallet);
}

function disableShipToSearch(searchShipToVal){
	if (typeof searchShipToVal !== 'undefined') {
		if (searchShipToVal.size == 0 || searchShipToVal == '') {
			$('button[id="shipToSearchBoxButton"]').attr('disabled', 'disabled');
		}
		else {
			$('button[id="shipToSearchBoxButton"]').removeAttr("disabled");
		}
	}
}

$(document).ready(function (){
	
	var emailPromoSubscribe = $("#emailSubscribe").val();
	
	if(emailPromoSubscribe=='Yes')
		{
		$("#emailOptIn").attr('checked', true);
		}
	else
		{
		$("#emailOptIn").attr('checked', false);
		}
});

$("#emailOptIn").bind("change",function(){
	var type='POST'
	var url;
    if($(this).is(":checked"))
        url= ACC.config.encodedContextPath +"/my-account/updateEmailSubscribe?emailSubscribe=Yes";
    else
    	url= ACC.config.encodedContextPath +"/my-account/updateEmailSubscribe?emailSubscribe=No";
    
    
    $.ajax({
        type: type,
        /*contentType : 'application/json; charset=utf-8',*/ //use Default contentType
        dataType : 'json',
       
      
        url:url ,
        //data: JSON.stringify(search),
       // Note it is important without stringifying
        success :function(result) {
        // do what ever you want with data
        
        if (result)
        	{
        	 //console.log("Success");
        	}
        }
        });
});


$(document).ready(function() {
	$( "#requsetTooltip" ).tooltip({ content: '<img width="500px" height="500px" src="/_ui/responsive/theme-lambda/images/tool-tip-image.png" />' })
	});


$('.role-box').on('click',function  () {
	var role_code=$(this).find("#role_code").val();
	$(this).find('#Role_'+role_code).siblings(".colored-radio").find("#Roled_"+role_code).prop('checked', true);
	   /*$(this).find('#Roled_'+role_code).siblings(".colored-radio").find("#Role_"+role_code).prop('checked', true);*/
	   //$(this).find("#Roled_b2badmingroup").siblings(".colored-radio").find("#Role_b2badmingroup").prop('checked', true);
	if ($("#Role_b2badmingroup, #Roled_b2badmingroup").is(':checked')) {
		$(".team-role").hide('slow');
	} else {
		$(".team-role").show("slow");
	}
	   
	});

$( document ).ready(function() {
 	var emailTopicPreference=[];
 	var list = $("#promo").val();
 
 	if(list=='Yes')
 		{
 		$("#subscribeEmail").attr('checked', true);
 		}
 	else
 	{
 		$("#unSubscribeEmail").attr('checked', true);
 	}
 	
 	var orderVal = $("#promo1").val();
 	if (orderVal =='Yes') {
 		$("#emailOrderOption").attr('checked', true);
 	} 
 	
 	$("#unSubscribeEmail").on('click',function () {
 		$(".ads_Checkbox").each(function() {
 			$(this).attr('checked', false);
 		});
 	});

$(".ads_Checkbox").on('click',function () {	
	$("#unSubscribeEmail").attr('checked', false);
	});
 	
 	emailTopicPreference = $('#preference').val();
 	
 	if (emailTopicPreference != undefined) {
 	
 	var emailPref=emailTopicPreference.split(','); 		
 	
 		for ( var i = 0, l = emailPref.length; i < l; i++ ) {
 		$(".ads_Checkbox").each(function() {
 			var idvalue=$(this).val();
 			var emailval=emailPref[i].replace('[','').replace(']','').replace('"','').replace('"','');
 			
 			if(idvalue== emailval)
 				{
 				$(this).attr('checked', true);
 				}
 			
 	});
 			
 	
 		
 	}
 	}
 	
 	$("input[name='subsEmail']").on('click',function (){
 		if (list == 'New') {
 			list = $("input[name='subsEmail']:checked").val();
 		}
 		$(".emailsubscribe").hide();
 	});
 	
 	
 	
 	$("#savePref").on('click',function (){
 		var unsubs = $("#unSubscribeEmail:checked").val();
 		var subs = $("#subscribeEmail:checked").val();
 		
 		if (unsubs == undefined && subs == undefined) {
 			$(".emailsubscribe").show();
 		} else {
 		
 	    
 	    var emailPromo;
 	    var emailTopicPreference="";
 	    var orderOption =  $("#emailOrderOption:checked").val() 
 	 
 	    if (orderOption=='on'){
 	    	orderOption='Yes';
 	    } else{
 	    	orderOption='No';
 	    }
 	  
 	    	emailPromo = $("input[name='subsEmail']:checked").val();
 	    	
 	 
 	    
     $('.ads_Checkbox:checked').each(function(){       
     	
 	        var values = $(this).val();
 	   
        if( typeof values !='undefined' && values !="" ){
         emailTopicPreference += values+"|";	
 	        
 	       }
 	    });
     
 	    	
 	    	
 	    var search = {}
 		search["emailType"] = emailPromo;
 		search["emailTopicPreference"] = emailTopicPreference;
 	     var type="POST";
 	  var url= ACC.config.encodedContextPath +"/my-account/updatePrefernce";
 	   //console.log(url);
 	    $.ajax({
 	        type: type,
 	        dataType : 'json',
         data: "emailType=" + emailPromo + "&emailTopicPreference=" + encodeURIComponent(emailTopicPreference)+"&emailPromo="+orderOption,
 	        url:url ,
 	        success :function(result)
 	        {
 	            if (result)
 	        	{
             	//console.log("msg");
             	$('#success').html('<div class="margin40"><br/><span class="icon-success" style="margin-left:20px;"></span><p class="black-title col-md-5 col-xs-7" style="margin-top: 15px;"><b>'+ACC.config.success+'</b><br/>'+ACC.config.updatedPreferences+'</p><p class="cl"></p></div>');
 	        	  ewt.trackFormSubmit({name:'pref_center_form_submit',type:'email_preference',form:$('')});
         	}
         }
         });
 		}
 	});
 	
 	$(".printOrderDetails").on('click',function  (e) {
 		e.preventDefault();
		ACC.accountdashboard.orderPrintHeaderHeight();
 		window.print();
 	});
	
 	$(function () { // wait for page to load.
 	    var primaryBusinessL2Dropdown = $("#contrPrimaryBusiness"),
 	        primaryBusinessL1Dropdown = $('<select id="contrPrimaryBusinessL1"></select>') // create a PrimaryBusinessL1 dropdown
 	    
 	    // parse the nested dropdown
 	   primaryBusinessL2Dropdown.children().each(function () {
 	        var group = $(this),
 	            primaryBusinessL1Name = group.attr('label'),
 	            primaryBusinessL1code = group.attr('value'),
 	            option;
 	        
 	        // create an option for the PrimaryBusinessL1
 	        option = $('<option></option>').val(primaryBusinessL1code).text(primaryBusinessL1Name);
 	        
 	        // store the associated PrimaryBusinessL2 options
 	        option.data('contrPrimaryBusiness', group.children());
 	        
 	       // add the PrimaryBusinessL1 to the dropdown
 	       primaryBusinessL1Dropdown.append(option);
 	    });
 	    
 	    // add the PrimaryBusinessL1 dropdown to the page
		$(".business-dropdown .business-dropdown-primary").append(primaryBusinessL1Dropdown);
 	    
 	    // this function updates the PrimaryBusinessL2 dropdown based on the selected PrimaryBusinessL1
 	    function updatePrimaryBusinessL2() {
 	    	//alert("caleed");
 	        var primaryBusinessL1 = primaryBusinessL1Dropdown.find(':selected');
 	        primaryBusinessL2Dropdown.empty().append(primaryBusinessL1.data('contrPrimaryBusiness'));
 	        $('#contrPrimaryBusiness option[value="Select"]').prop("selected",true).change();
 	    }
 	    
 	    // call the function to set the initial cities
 	   updatePrimaryBusinessL2();
 	    
 	    // and add the change handler
 	  primaryBusinessL1Dropdown.on('change', updatePrimaryBusinessL2);
 	});
 	
 }); 


function retrieveShipToSortbySessionValue() {
	if(sessionStorage.getItem("selectedDropdownValueSession")){
		$("#cboxWrapper .sortSelectSpan").val(sessionStorage.getItem("selectedDropdownValueSession"));
	}
}

function removeShipToSortbySessionValue() {
	sessionStorage.removeItem("selectedDropdownValueSession");
}

$( document ).ready(function() {
	
	var succesAddEwallet=$("#add-ewallet-success").val();
	var errorAddEwallet=$("#add-ewallet-failure").val();
	var unitId = $('#unitIdVal').val();
	if(succesAddEwallet != null && succesAddEwallet != ""){
		_satellite.track('newCardAdded');
		 ACC.colorbox.open("", {
			   html: $(".add-success-card-ewallet").html(),
	       width: '480px',
	       height:'auto',
	       title: "<h4 class='payment-pop-up-title headline'><span class='headline-text'>"+ACC.config.eWalletAddMessage+"</span></h4>",
	       close:'<span class="glyphicon glyphicon-remove"></span>',
	       onComplete: function() {
	    	   	_AAData.popupPageName= ACC.config.newcardaddedPageName;
	    	   	_AAData.popupChannel= ACC.config.myaccountpathingChannel;
			 	try {
				    	 _satellite.track('popupView');
		        } catch (e) {}
	    	   $('#cboxContent #cboxClose').click(function(){
        			  window.location.reload();
        			  });
	    		$("body").css("overflow-y", "hidden");
	    		
	    	 
	    	},
	    	onClosed: function() {
	    		$('body').css("overflow-y","auto");
	    		window.location.href =ACC.config.encodedContextPath +"/my-account/ewallet/" +unitId;
	    	 
	    		}
			  });
	}

	if(errorAddEwallet != null && errorAddEwallet != ""){
		   ACC.colorbox.open("", {
			   html: $(".add-eroor-card-ewallet").html(),
	       width: '480px',
	       height:'auto',
	       
	       close:'<span class="glyphicon glyphicon-remove"></span>',
	       onComplete: function() {
	    	   $('#cboxContent #cboxClose').click(function(){
        			  window.location.reload();
        			  });
	    		$("body").css("overflow-y", "hidden");
	    		
	    	 
	    	},
	    	onClosed: function() {
	    		$('body').css("overflow-y","auto");
	    		window.location.href =ACC.config.encodedContextPath +"/my-account/ewallet/" +unitId;
	    	 
	    		}
			  });
	}
	
	
	
	});
function ewalletLoadContent(e) {
	var unitId = $('#unitIdVal').val();
	
	var oIframe = $("#cboxLoadedContent ").find("#myIframe")[0];
	
	 var oDoc = oIframe.contentWindow || oIframe.contentDocument;
	
	if (oDoc.document) {
		
	$('#colorbox').css('display', 'none');
	
	

	} 
	 loading.start();
	 window.location.href =ACC.config.encodedContextPath +"/my-account/ewallet/" +unitId; 
	}

	
ACC.unlockuser = {

	_autoload: [
		"bindLink"
	],

	bindLink: function(){
		$(document).on("click",".js-unlock-user",function(e){
			e.preventDefault();

			ACC.colorbox.open(
				"",
				{
					href: ACC.config.encodedContextPath + $(this).data("link"),
					width:"680px",
					fixed: true,
					top: 80,
					className:"unlock-account",
					onOpen: function()
					{
						$('#validEmail').remove();
					},
					onComplete: function(){
						_AAData.popupPageName= ACC.config.unlockuserPageName;
						_AAData.popupChannel= ACC.config.myaccountpathingChannel;
					 	try {
						    	 _satellite.track('popupView');
				        } catch (e) {} 
						ACC.unlockuser.bindSuccess();
					}
				}
			);
		});
		
	},

   bindSuccess: function(){
	   $('form#siteOneUnlockUserForm').ajaxForm({
			success: function(data)
			{
						$(".unlock-user").replaceWith(data);
						ACC.unlockuser.bindSuccess();
						if ($(data).closest('#unlockUserResponseSection').length){
							//$("#cboxTitle .headline-text").html("<b>We've sent you an email</b>");
							_AAData.popupPageName= ACC.config.unlockuserinstructionPageName;
							_AAData.popupChannel= ACC.config.myaccountpathingChannel;
						 	try {
							    	 _satellite.track('popupView');
					        } catch (e) {}
						}
						
						ACC.colorbox.resize();
					//}
				//}
			}
		});
   }

};
ACC.sdssearch = {
	_autoload: [
		"showSearchResultsWithLazyLoading",
        "showProductDescription",
        "sdsFormSubmit",
        "sdsinputkeypress",
        ["SDSLabelSearch", $('#sds-search-button').length!= 0]
	],
	
	
	SDSLabelSearch: function(){
			var SDSsearchKeyword = $("#sds-search-input").val();
			var SDSNoOfSearchResults = $("#sdsSearchCount").val();
			if (SDSsearchKeyword !='')
				{
				
				if(SDSNoOfSearchResults  == '0') {
						SDSNoOfSearchResults= "Zero"
					}
				else{
					SDSNoOfSearchResults= SDSNoOfSearchResults
				    }
				digitalData.eventData={
						SDSsearchKeyword: SDSsearchKeyword,
						SDSNoOfSearchResults:SDSNoOfSearchResults
							}
					try {
					    _satellite.track("SDSLabelSearch");
					} catch (e) {}	
				}
				

	},
	
	
	sdsinputkeypress : function () {
		// $(document).ready(function() {
			$(document).on("keyup","#sds-search-input",function() {
				var inp_len = $('#sds-search-input').val().length;
				if(inp_len == 0) {
					$('#sds-search-button').addClass('button-grey');
				}
				else {
					$('#sds-search-button').removeClass('button-grey');
				}
			})
		// })
	},
	
	sdsFormSubmit : function ()
	{
		$(document).on("keypress","#sds-search-input",function(e) {
			if(e.keyCode ==13) {
				if($('#sds-search-input').val() != '' &&  $('#sds-search-input').val() != undefined &&  ( $('#sds-search-input').val().trim() ) != '') {
					 var searchTerm = $("#sds-search-input").val();
				     var q = searchTerm + ":relevance:soIsSDSAvailable:true";
				     $("#q").val(q);
				     $('#sdsSearchForm').attr('action', ACC.config.encodedContextPath+"/sdssearch").submit();
				} else {
					$('#sdsSearchResults').html('<br><b>'+ACC.config.sdsEmptySearch+'</b>');
					$('#productDescription').addClass('hidden');
					
				}
				
				return false;
			}
			else {
				return true;
			}
			 
		});
		
		$(document).on("click","#sds-search-button",function()
				{	
					if($('#sds-search-input').val() != '' &&  $('#sds-search-input').val() != undefined &&  ( $('#sds-search-input').val().trim() ) != '') {
						 var searchTerm = $("#sds-search-input").val();
					     var q = searchTerm + ":relevance:soIsSDSAvailable:true";
					     $("#q").val(q);
					     $('#sdsSearchForm').attr('action', ACC.config.encodedContextPath+"/sdssearch").submit();
					} else {
						$('#sdsSearchResults').html('<br><b>'+ACC.config.sdsEmptySearch+'</b>');
						$('#productDescription').addClass('hidden');
						
					}
				});
	},
	showSearchResultsWithLazyLoading : function ()
    {	
		//var searchParams = new URLSearchParams(window.location.search); //?anything=123
		var searchText=$('#sds-search-input').val();
		var page = 0;
		var loading = false;//to prevent duplicate
		
		var winTop = $(window).scrollTop();
		var docHeight = $(document).height();
		var winHeight = $(window)[0].innerHeight;
		/*//scroll to PAGE's bottom
		if  ((winTop / (docHeight - winHeight)) > 0.95) {       
		    if(!loading){
		        loading = true;
		        loadNewContent();//call function to load content when scroll reachs PAGE bottom                
		    }       
		}*/
		
		
	   $("#sdsSearchResults").on('scroll', function (){
		    	
		 if($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {
			 
			 if(!loading){
					loading = true;
					/*alert("Botton Reached");*/
					loadNewContent();//call function to load content when scroll reachs DIV bottom    
						
		        	}   
				  }
		    });
	   
	   $(document).ready(function ()
		{
			if($('#sds-search-input').length) {
				var inp_len = $('#sds-search-input').val().length;
				if(inp_len == 0) {
					$('#sds-search-button').addClass('button-grey');
				}
				else {
					$('#sds-search-button').removeClass('button-grey');
				}
				if($('#sdsSearchResults').html() && $('#sdsSearchResults').html().indexOf('productLongDesc') == -1 && window.location.href.indexOf('/results') == -1) {
					$('#sdsSearchResults').html('<br><b>'+ACC.config.sdsSearchNoResult+'</b><br><p class="sds_noDataFnd"><br><b>'+ACC.config.sdsSearchCantFind+'</b></p><p><a href="'+ACC.config.encodedContextPath+'/contactus" style="color: #50a0c5;text-decoration: underline;">'+ACC.config.contactUs+' &rarr;</a></p>');
					$('#sds-search-button').removeClass('button-grey');
				}
			}
		});
		
	 
	   	
		function loadNewContent(){
			page++;
			/*alert("searchText="+searchText+"page="+page);*/
			var query = searchText + ":relevance:soIsSDSAvailable:true";
		    $.ajax({
		        type:'GET',
		        url: ACC.config.encodedContextPath + '/sdssearch', 

		        cache: false,
		        data: {"query":query,"page" : page,"text":searchText
		        },
		        success:function(searchPageDataResults){
		        	
		            if(searchPageDataResults.results != ""){
		            	
		                loading = false;
		                
		                $.each(searchPageDataResults.results , function( index, searchPageData ) 
			        	    	{
			        	    		var searchResultCode = searchPageData.itemNumber;
			        	    		var searchResultDescription = searchPageData.productShortDesc;
			        	    		
			        	    		var searchResultSDS = searchPageData.sds;
			        	    		var searchResultLabel = searchPageData.label;
			        	    		var productCode = searchPageData.code;
			        	    		index = (page > 1) ? (index + (page-1)*24) : index;
			        	    		content = "<table class='table product-compare'><tbody><tr class=''><td><div id='productLongDesc' class='productLongTitleLazyList proClass2' data-code='"+searchResultCode+"' data-description='"+escapeXml(searchResultDescription)+"' data-sds='"+searchResultSDS+"' data-label='"+searchResultLabel+"' data-index='"+index+"'data-codeforurl='"+productCode+"'>"+escapeXml(searchResultDescription)+"</div>";
			        	    		content += "<div class='productLongTitleLazyList proClass2' data-code='"+searchResultCode+"' data-description='"+escapeXml(searchResultDescription)+"' data-sds='"+searchResultSDS+"' data-label='"+searchResultLabel+"' data-index='"+index+"' data-codeforurl='"+productCode+"'>"+searchResultCode+"</div></td></tr></tbody></table>";
			        	    		content += "<div id='productDescriptionMobileLazyList"+index+"' class='hidden proClassDesc col-md-7 margin20 hidden-md hidden-lg'>";
			        	    		content += "<div class='panel panel-default'><table class='table product-compare-info'>"
												+"<tr><td colspan='2'><b>Product Information</b></td></tr>"
												+"<tr class='bg-lightGrey'><td>Item description</td><td><span class='description' class='content-product-title'></span></td></tr>"
												+"<tr><td>Item number</td><td><span class='productCode'></span></td></tr>"
												+"<tr><td><b>Product SDS</b></td></tr>"
												+"<tr class='bg-lightGrey'><td>SDS</td><td><div class='sdsList' style='text-decoration:underline;'></div><span class='noSds' class='collapse'> No SDS data is available</span></td></tr>"
												+"<tr><td><b>Product Labels</b></td><td>&nbsp;</td></tr>"
												+"<tr class='bg-lightGrey'><td>Label</td><td><div class='labelList' style='text-decoration:underline;'></div><span class='noLabel' class='collapse'>No label data is currently available</span></td></tr>"
												+"<tr><td colspan='2'><a class='itemInfoLink' href=''>See full product information</a></td></tr>"
												+"</table>"
												+"</div></div>";
			        	    		
			                        $('#searchResultList').append(content);
			        	   });  
		            }
		        }
		    });
		}
		function escapeXml(unsafe) {
			if(unsafe != null) {
				return unsafe.replace(/&/g, '&amp;')
	             .replace(/</g, '&lt;')
	             .replace(/>/g, '&gt;')
	             .replace(/"/g, '&quot;')
	             .replace(/'/g, '&apos;');
			}
			return null; 
		}
		
    },
    showProductDescription: function ()
    {
    	$('.productLongTitle').on('click', function()
    	//$(document).on("click",".productLongTitle",function()
    			{	
		    		for(var i=0; i<$('#sdsSearchResults').children('table').length;i++ ) {
						$('#productDescriptionMobile'+i).addClass("hidden");
					}
		    		for(var i=0; i<$('#searchResultList').children('table').length;i++ ) {
						$('#productDescriptionMobileLazyList'+i).addClass("hidden");
					}
    				$(this).closest("#sdsSearchResults").find("table tr").removeClass("activeGrey");
    				$(this).closest("#searchResultList").find("table tr").removeClass("activeGrey");
    				
    				var oldTr = $(this).closest('[data-index]').data('index');
    				$('#productDescriptionMobile'+oldTr).removeClass("hidden");
    				$(this).closest("tr").addClass("activeGrey");
    				$('#productDescription').removeClass("hidden");    				
    				$('.productCode').empty();
    				$('.productCode').html($(this).data('code'));
    				$('.description').empty();
    				$('.noSds').hide();
    				$('.noLabel').hide();
    				$('.sdsList').empty();
    				$('.labelList').empty();
    				$('.description').html("<a href='" + ACC.config.encodedContextPath + "/p/" + $(this).data('codeforurl') + "'> " + $(this).data('description') + "</a>");
    				var productSDSJSON = '#mySDSList' + $(this).data('index');
    				if($(productSDSJSON).val() != ''){

    					var productSDSList = JSON.parse($(productSDSJSON).val());
    					var sdsElement = '';
    					$.each(productSDSList,function(index, sds) 
		        	    	{	
        	    				sdsElement= sdsElement + "<li><a href='"+sds.split('||')[1]+"' target='_blank'><span class='icon-pdf-invoice'></span>"+ ACC.config.sdsSearchPageSDS +"</a></li>";
		        	    	});
    					$('.sdsList').html(sdsElement);
    				}
    				else{
    					$('.noSds').show();
    				}
    				var productLabelJSON = '#myLabelList' + $(this).data('index');
    				if($(productLabelJSON).val() != ''){

    					var productLabelList = JSON.parse($(productLabelJSON).val());
    					var labelElement = '';
    					$.each(productLabelList,function(index, label) 
		        	    	{	
    							labelElement= labelElement + "<li><a href='"+label.split('||')[1]+"' target='_blank'><span class='icon-pdf-invoice'></span>"+ ACC.config.sdsSearchPageLabel +"</a></li>";
		        	    	});
    					$('.labelList').html(labelElement);
    				}
    				else
					{
						$('.noLabel').show();
					}
    				$('.itemInfoLink').attr("href",  ACC.config.encodedContextPath+"/p/" + $(this).data('codeforurl'));
    				
    			})
    			$(document).on("click",".productLongTitleLazyList",function()
    			{	
    				for(var i=0; i<$('#sdsSearchResults').children('table').length;i++ ) {
						$('#productDescriptionMobile'+i).addClass("hidden");
					}
		    		for(var i=0; i<$('#searchResultList').children('table').length;i++ ) {
						$('#productDescriptionMobileLazyList'+i).addClass("hidden");
					}
    				$(this).closest("#searchResultList").find("table tr").removeClass("activeGrey");
    				$(this).closest("#sdsSearchResults").find("table tr").removeClass("activeGrey");
    				
    				var oldTr = $(this).closest('[data-index]').data('index');
    				$('#productDescriptionMobileLazyList'+oldTr).removeClass("hidden");
    				$(this).closest("tr").addClass("activeGrey");
    				$('#productDescription').removeClass("hidden");    			
    				$('.productCode').empty();
    				$('.productCode').html($(this).data('code'));
    				$('.description').empty();
    				$('.noSds').hide();
    				$('.noLabel').hide();
    				$('.sdsList').empty();
    				$('.labelList').empty();
    				$('.description').html("<a href='" + ACC.config.encodedContextPath + "/p/" + $(this).data('codeforurl') + "'> " + $(this).data('description') + "</a>");
    				
    				var productSDSLazyList = $(this).data('sds');
    				if(productSDSLazyList != '' && productSDSLazyList != null){
    					var productSDSJSONLazyList = productSDSLazyList.split(',');
    					var sdsElement = '';
    					$.each(productSDSJSONLazyList,function(index, sds) 
		        	    	{	
        	    				sdsElement= sdsElement + "<li><a href='"+sds.split('||')[1]+"' target='_blank'>" + sds.split('||')[0] +"</a></li>";
		        	    	});
    					$('.sdsList').html(sdsElement);
    				}
    				else{
    					$('.noSds').show();
    				}
    				
    				var productLabelLazyList = $(this).data('label');
    				if(productLabelLazyList != '' && productLabelLazyList != null){
    					var productLabelJSONLazyList = productLabelLazyList.split(',');
    					var labelElement = '';
    					$.each(productLabelJSONLazyList,function(index, label) 
		        	    	{	
    						labelElement= labelElement + "<li><a href='"+label.split('||')[1]+"' target='_blank'>" + label.split('||')[0] +"</a></li>";
		        	    	});
    					$('.labelList').html(labelElement);
    				}
    				else{
    					$('.noLabel').show();
    				}
    				$('.itemInfoLink').attr("href", ACC.config.encodedContextPath + "/p/" + $(this).data('codeforurl'));
    			})
    }

}

ACC.mystores = {

	_autoload: [
		"removeMyStore",
		"bindConfirmButton",
        "bindHeaderStoreOverlay",
        ["bindGeoLocatedStore", $('#User_Agent').val()!="SiteOneEcomApp"],
		    "productToggle",
        "makeMyBranchClick",
        "defaultBranch",
        "bindfooterSearchStore",
		"bindNearbyOverlayPDP",
		"bindNearbyOverlayPLP",
		"bindNearbyOverlayData",
		"bindNearbyOverlayCartEntry",
		"nearbyBranchPopupCall",
       	["bindpopupStoreOverlay", $('#User_Agent').val()!="SiteOneEcomApp"]
	],
	selectPLPProduct:"",
	selectBaseCode:"",
	isPLPPage:"false",
	inStockFilterflag: true ,
	
	bindfooterSearchStore:function(){
		 $(document.body).on('click','.js-footer-search-store',function(e){
			try {
				_AAData.storeLocatorTerm= $(".footer-store-value").val();
				_AAData.storeLocatorMethod ="Search-Text";
				_AAData.eventType="search-location";
				_satellite.track("dtm-event-search");
			}catch(e){}
		}) 
	},
 callBackGeo:function(element){
	 $(element).html(ACC.config.divClass);
		$('.headerLabel').css('display','none');
		$('.line1').css('display','none');
		$('.town').css('display','none');
		

		$(document).ready(function() {
			if ($(".page-savedListPage,.page-assemblyPage,.page-cartPage,.page-quickOrderPage,.page-productDetails,.page-productGrid, .template-pages-category-categoryLandingPage, .page-searchGrid").length > 0){
				
				$(".main-container").click(function(event){
					event.preventDefault();
					ACC.mystores.failedGeoPopUp();
				   });
			     }
			});
		
		
		$(document).ready(function() {
				var showPopup = false;
				if($.cookie("gls") == null)
				{
					showPopup = true;
				}
				
				if(($.cookie("gls") != null))
				{
					showPopup = false;
				}
				
				if(showPopup)
				{
					if ($(".page-savedListPage,.page-assemblyPage,.page-cartPage,.page-quickOrderPage,.page-productDetails,.page-productGrid, .template-pages-category-categoryLandingPage, .page-searchGrid").length > 0){
						ACC.mystores.failedGeoPopUp();
					}
				}
		});
	 
 },
	failedGeoPopUp:function(){
		$.ajax({
		    success: function(response){
		    $("#colorbox").addClass("failedgeoLocation-box");
		    	ACC.colorbox.open("", {
					html: $("#failedgeolocationOverlay").html(),
					maxWidth:"100%",
					width:"650",
					escKey: false,
		 		    overlayClose: false,
		 			onComplete: function(e) {
		 				$("#cboxClose").click(function(){
		 					window.location = "/"; 
		 				 });
		 				
		 				},
					})
				  }
			   })
	},
	
	
	defaultBranch: function(branch)
	{
		$(document.body).on("click",".makeMyBranch",function(e)
		{
			var namestore = $(".store_details_name.headline").text();
		
			
			ACC.mystores.makeMyBranchClick(namestore);
			
		});
		$(document.body).on("click",".makeMyBranchDefault",function(e)
				{
			
					var namestore = $("#defaultbranch").val();
					//$(this).find("input#defaultbranch").val(namestore);
					ACC.mystores.makeMyBranchClick(namestore);
					
				});
		
	},
	
	makeMyBranchClick: function(namestore){
		var storedetail = namestore.split('#');
		var id = storedetail[1];
		var name = storedetail[0];
		var storeName = id + " : " + name ;
		
		digitalData.eventData={
				branch: storeName
				}
				  console.log("digitalData" + JSON.stringify(digitalData));
					try {
						 _satellite.track("makeMyBranchClick");
							} catch (e) {} 
						
	},
	
	removeMyStore: function()
	{
		$(document.body).on("click",".removeStore",function(e)
		{
			e.preventDefault();

			var html = ["<div class='PopupBox'>",
							"<h3>", $(this).data('name'), "</h3>", 
							"<h4>", $(this).data('title'), "</h4>",
							$(this).data('line1'), " ", 
							$(this).data('line2'), "<br/>",
							$(this).data('town'), ", ", $(this).data('regionCode'), " ", $(this).data('postalCode'),
							"<br/><br/>",
						"</div>",
						"<div class='confrimbtnBox'>",
							"<div class='col-xs-12 col-sm-6'>",
								"<a href='"+ ACC.config.encodedContextPath +"/my-account/remove-my-store/", $(this).attr("Id"), "'>",
									"<button type='button' id='delete' class='btn btn-ConfirmMessage btn-primary btn-block remBranch'>"+ACC.config.remove+"</button>",
								"</a>",
							"</div>",
							"<div class='col-xs-12 col-sm-6'>",
								"<button type='button' id='cancel' class='btn btn-default btn-block closeColorBox' >"+ACC.config.cancel+"</button>",
							"</div>",
						"</div>"].join('');

				ACC.colorbox.open(ACC.config.deleteBranch, {
					html: html,
					width:"500px",
					onOpen: function() {
						$('#colorbox').addClass('remove-branch-overlay');
					}
				});
		});
	},
	
	
	
	bindConfirmButton: function () 
	{
		if($("#sessionStore").val()==$.cookie("gls"))
		{
			$('.geolocatedLabel').css('display', 'block');
		}
		
		var show = false;
		
		if($('#isPreferredStore').val() == "false" && null == $.cookie("csc"))
		{
			show = true;
		}

		if(show)
		{
			$('.confirmStoreButton').css('display', 'block');
		}
	},
	changebranchPopupFn: function() {
		ACC.mystores.isPLPPage = "false";
		$(window).scrollTop(0);
		var currentStoreName= $("#sessionStoreName").val();
		var currentLine1 = $("#sessionStoreLine1").val();
		var currentLine2 = $("#sessionStoreLine2").val();
		var currentRegion = $("#sessionStoreRegion").val();
		var currentPostal = $("#sessionStorePostal").val();
		var currentPhone = $("#sessionStorePhone").val();
		var currentTown= $("#sessionStoreTown").val();
		var currentStoreId = $("#sessionStore").val();
		var popup = $(".changebranch_popup").clone();
		if (currentStoreId) {
			popup.find("#sessionStore").val(currentStoreId);
		}
		popup.find("#analyticsstore").val(currentStoreName);
		popup.find(".branch_item_name, .storeDisplayName_popup .m-b-5").text(currentStoreName);
		popup.find(".line1").text(currentLine1);
		popup.find(".line2").text(currentLine2);
		popup.find(".town").text(currentTown);
		popup.find(".region").text(currentRegion);
		popup.find(".postalCode").text(currentPostal);
		popup.find(".tel-phone").attr("href", "tel:" + currentPhone).text(currentPhone);
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function (position) {
				$('.branchGeoLocation').removeClass("hidden");
			}
			);
		}
		$("#colorbox").addClass("myBranch-box");
		ACC.colorbox.open("", {
			html: popup.html(),
			width: ACC.global.wWidth >= 1024 ? '389px' : '100%',
			height: '100vh',
			top: 0,
			open: true,
			left: "-400px",
			className: "changebranch_border",
			onComplete: function () {
				$(".changebranch_border").hide();
				$(".changebranch_border #cboxLoadedContent").addClass("scroll-bar-5");
				ACC.mystores.changeBranchPopupCall();
				$("#cboxContent select#milesSelector").change(function () {
					ACC.mystores.changeBranchPopupCall();
				});
				_AAData.popupPageName = ACC.config.storepopupPageName;
				_AAData.popupChannel = ACC.config.storepopuppathingChannel;
				try {
					_satellite.track('popupView');
				} catch (e) { }
			},
			onClosed: function () {
				$('.changebranch_border').animate({ 'left': '0px' }, 'slow');
				$("#colorbox").removeClass("myBranch-box");
			}
		})
	},
	
	changeBranchPopupCall: function() {
		$('.nearby_container').show();
		$('.searched_container').hide();
		if(($('.product-grid-row').is(':visible') || $('.product-search-row').is(':visible')) && (ACC.mystores.isPLPPage == "true")){
			var baseCode = ACC.mystores.selectBaseCode;
			var url = $('#checkbranch-imgurl-' + baseCode).val();
			var name = $('#checkbranch-productname-' + baseCode).val();
			var itemnumber = $('#checkbranch-itemnumber-' + baseCode).val();
			var item = "";
			$('.branchSearch').addClass("hidden");
			$('.nearby_container').addClass("nearby_container_top");
			$('.yourshopping').addClass("hidden");
			$('.yourshopping_plp').removeClass("hidden");
			item += '<div class="col-xs-12 checkstore">Check Other Stores</div><div class="col-xs-12 m-b-15"><div class="col-xs-4"><img class="product_info_img" src="'+url+'" alt="'+name+'" title=""></div><div class="col-xs-8 productname"><span class="productcode">'+itemnumber+'</span><br>'+name+'</div></div>';
			$('.yourshopping_plp_productinfo').html(item);
		}
		else{
			$('.branchSearch').removeClass("hidden");
			$('.nearby_container').removeClass("nearby_container_top");
			$('.yourshopping_plp').addClass("hidden");
			$('.yourshopping').removeClass("hidden");
		}
		$(".branchSearchBox").on('keyup', function (e) {
			if (e.key === 'Enter' || e.keyCode === 13) {
				ACC.mystores.storeSearch();
			}
		});
		var isAnonymous = document.getElementById('isAnonymous').value;
		if (isAnonymous == 'false') {
			$.cookie("csc", null, { path: '/' });
		}
		var pageName = $(".pagename").val();
		if(pageName == 'Product Grid' || pageName == 'Product Details' || pageName == 'Search Results'||$('.template-pages-layout-siteOneCuratedPlpLayout').is(':visible')){
			var getMiles = 100;
		}
		else{
			var getMiles = $("#cboxContent select#milesSelector").val();
		}
		if(ACC.mystores.inStockFilterflag == false && pageName != 'Product Details'){
			ACC.refinements.inStockfilter = $('#instockcheckbox').prop('checked',false);
			$("input[type='checkbox'][id='instockcheckbox']").removeAttr('checked');
		}
		else{
			$("input[type='checkbox'][id='instockcheckbox']").attr("checked", true);
		}
		var getlatitude_val = $('.latitude_val').val();
		var getlongitude_val = $('.longitude_val').val();
		var nearby_listitems = "", saved_listitems = "";
		var getproduct_code = '';
		var inStockfiltermiles = false;
		var isNursery =false;
		if(($('#breadcrumbName1').val() == "Nursery" || $('#breadcrumbName1').val() =="Vivero" ) && ((($(".pagename").val() == 'Product Grid' && $('input[name="isNurseryBuyingGroupBranch"]').val() == 'true')) || ($(".pagename").val() == 'Product Details' && $(".isNurseryBuyingGroupBranchpdp").val() == 'true'))){
			isNursery=true;
		}
		varobjData = {};
		if ($("body").hasClass("page-productDetails") && !$(".branchpopup_click").hasClass("pdpvarianttopLink")) {
			if ($('.pdpredesign-container-variant').is(':visible')) {
				getproduct_code = $('.selectedVariantCode').siblings('.variantProductCodeUpdate').val();
			}
			else {
				getproduct_code = $('.trackProductCode').val();
			}
			objData = { "miles": getMiles, "latitude": getlatitude_val, "longitude": getlongitude_val, "productCode": getproduct_code,"isNurseryCategory":isNursery };
			}
			else{
				if(($('.product-grid-row').is(':visible') || $('.product-search-row').is(':visible')) && (ACC.mystores.isPLPPage == "true")){
					getproduct_code = ACC.mystores.selectPLPProduct;
					objData = {"miles":getMiles,"latitude":getlatitude_val,"longitude":getlongitude_val,"productCode": getproduct_code,"isNurseryCategory":isNursery};
				}else{
					objData = {"miles":getMiles,"latitude":getlatitude_val,"longitude":getlongitude_val,"isNurseryCategory":isNursery};
				}
		}
		if(getproduct_code){
			$('.milesSelectorSection').hide();
			$('.inStockfilterSection').show();	
			inStockfiltermiles = false;	
		}
		else{
			$('.inStockfilterSection').hide();
			$('.milesSelectorSection').show();
			inStockfiltermiles = true;	
		}
		$('.nearby_arrow, .saved_arrow').hide();
		
		$.ajax({
			url: ACC.config.encodedContextPath + '/store-finder/stores',
			method: "GET",
			datatype: "json",
			data: objData,
			success: function (data) {
				if (data) {
					var responseData = JSON.parse(data);
					let nearbyarrow_count = 0;
					if (responseData) {
						if (responseData['nearBy']) {
							
							if(ACC.refinements.inStockfilter && (inStockfiltermiles == false) && (ACC.mystores.inStockFilterflag != false)){
								for (i = 0; i < responseData.nearBy.data.length; i++) {
									stockData = responseData.nearBy.data[i].stockDetail.toLowerCase();
									if (stockData == "instock"){
									nearby_listitems += ACC.mystores.createbranchtemHtml(responseData.nearBy.data[i],nearbyarrow_count, 'nearby');
									nearbyarrow_count = nearbyarrow_count + 1;
									}
								}
									if (nearbyarrow_count > 5) $('.nearby_arrow').show();
							}
							else{
								if (responseData.nearBy.data.length > 5) $('.nearby_arrow').show();
								for (i = 0; i < responseData.nearBy.data.length; i++) {
									nearby_listitems += ACC.mystores.createbranchtemHtml(responseData.nearBy.data[i], i, 'nearby');
								}
							}
							$('.nearby_branches').html(nearby_listitems);
							if(nearby_listitems){
								ACC.refinements.inStockfilter = $('#instockcheckbox').prop('checked',false);
							}
						}
						else {
							$('.nearby_branches_list').remove();
						}
						if (responseData['savedBranches']) {
							$('.saved_container').show();
							if (responseData.savedBranches.data.length > 3) $('.saved_arrow').show();
							for (i = 0; i < responseData.savedBranches.data.length; i++) {
								saved_listitems += ACC.mystores.createbranchtemHtml(responseData.savedBranches.data[i], i, 'saved');
							}
							if (responseData.savedBranches.data.length == 0) {
								var login_user = '<div class="col-sm-12 savebranch_empty text-left">' + ACC.config.nosavedbranches + '</div>';
								$('.saved_branches').html(login_user);
								$('.saved_arrow').hide();
							}
							else {
								$('.saved_branches').html(saved_listitems);
							}
						}
						$('.nearby_more_items, .saved_more_items').hide();
						
						
						$('.nearby_arrow').click(function () {
							$('.nearby_more_items').show();
							$('.nearby_arrow').hide();
						});
						$('.saved_arrow').click(function () {
							$('.saved_more_items').show();
							$('.saved_arrow').hide();
						});
					}
					$('.changebranch_border').animate({ 'left': '0px' }, 'slow').show();
				}
				else {
					console.log('No nearby branches for this selected miles');
				}
			},
			error: function (data) {
				$('.changebranch_border').animate({ 'left': '0px' }, 'slow').show();
			}
		});
	},
	createbranchtemHtml: function(data, id, branchName) {
    var index = id + 1;
    var item = "";
    if (data) {
        var getMiles = '';
        if (data.formattedDistance) {
            getMiles = data.formattedDistance.split(' ')[0];
        }

        if (branchName === 'nearby') {
            item += `<div class="row bg-light-grey border-radius-5 p-t-10 margin0 m-b-10 branch_item nearby_branches_list ${id < 5 ? '' : 'nearby_more_items'}">`;
        } else {
            item += `<div class="row bg-light-grey border-radius-5 p-t-10 margin0 m-b-10 branch_item ${id < 3 ? '' : 'saved_more_items'}">`;
        }

        item += `<div class="col-md-12 f-s-20 f-w-600 font-Geogrotesque p-r-45 text-default branch_item_name">${data.name}</div>`;

        
        if (data.enableOnlineFulfillment === false || data.enableOnlineFulfillment === "false") {
            item += `<div class="col-md-12 inBranchOnly-label">
                        ${ACC.config.branchShopping}
                     </div>`;
        }

       if ($("body").hasClass("page-productDetails") && !$(".branchpopup_click").hasClass("pdpvarianttopLink") || (($('.product-grid-row').is(':visible') || $('.product-search-row').is(':visible')) && (ACC.mystores.isPLPPage == "true")))    
         {
            let stockDetail = (data.stockDetail || '').toLowerCase();
            let stockRef = $('#cboxContent .header_' + stockDetail + '_status');
            if (stockRef && stockRef.html()) {
                item += `<div class="col-xs-12 p-y-5 font-size-14 flex-center ${stockRef.attr("class")}">${stockRef.html()}</div>`;
            }
        }

        if (getMiles) {
            item += `<div class="col-md-12 f-w-400 font-size-14 text-blue text-gray-1">
                        <a class="underline-text" href="${ACC.config.encodedContextPath}/store-finder">
                            ${getMiles} ${ACC.config.storeFinderPopupDistanceUnit}
                        </a>
                     </div>`;
        }

        item += `<div class="col-md-12 m-t-10 font-size-14 branch_item_address">
                    <span class="line1">${data.line1 || ''}</span>&nbsp;<span class="line2">${data.line2 || ''}</span>
                    <p class="address_area">
                        <span class="town">${data.town || ''}</span>,
                        <span class="region">${data.regionCode || ''}</span>&nbsp;
                        <span class="postalCode">${data.postalCode || ''}</span>
                    </p>
                 </div>
                 <div class="col-md-12 m-b-10 f-w-400 font-size-14 text-blue text-gray-1 margin-ph">
                    <a class="underline-text" href="tel:${data.phone || ''}">${data.phone || ''}</a>
                 </div>`;

        if (data.storeSpecialityDetails && data.storeSpecialityDetails.length > 0) {
            item += `<div class="col-xs-12"><div class="row margin0">`;
            data.storeSpecialityDetails.forEach(speciality => {
                item += `<div class="col-xs-6 f-s-12 flex-center p-l-5 p-r-5 padding0 store-speciality-details">
                            <img class="m-r-5 speciality-icon" alt="${speciality.name}" src="${speciality.icon}"/>
                            <span>${speciality.name}</span>
                         </div>`;
            });
            item += `</div></div>`;
        }

        item += `<div class="col-xs-12 m-y-15">
                    <div class="row margin0 p-l-5">
                        <div class="col-xs-5 padding0">
                            <a class="btn btn-default btn-small btn-block storeDetails_branches"
                               href="${ACC.config.encodedContextPath}/store/${data.storeId}">
                               ${ACC.config.branchDetails}
                            </a>
                        </div>`;

        if (data.enableOnlineFulfillment === true || data.enableOnlineFulfillment === "true") {
            item += `<div class="col-xs-7 p-r-0">
                        <form method="get" action="${ACC.config.encodedContextPath}/store-finder/make-my-store/${data.storeId}">
                            <input type="submit" value="${ACC.config.makeMyBranch}" 
                                   class="btn btn-primary btn-small btn-block abtn">
                        </form>
                     </div>`;
        }
        item += `</div></div></div>`;
    }

    return item;
},
	storeSearch: function(type) {
		var storeId = $("#cboxContent #query").val();
		var getMiles = '100';
		var getlatitude_val = $('.latitude_val').val();
		var getlongitude_val = $('.longitude_val').val();
		var getproduct_code = '';
		var objData = {};
		if (storeId != '' || type == 'location') {
			if(type == 'location' && navigator.geolocation){
				navigator.geolocation.getCurrentPosition(
					function (position)
					{
						ACC.storefinder.coords = position.coords;
						getlatitude_val = ACC.storefinder.coords.latitude;
						getlongitude_val = ACC.storefinder.coords.longitude;
					},
					function (error)
					{
						console.log("An error occurred... The error code and message are: " + error.code + "/" + error.message);
					}
				);
			}
			if ($("body").hasClass("page-productDetails") && !$(".branchpopup_click").hasClass("pdpvarianttopLink")) {
				if ($('.pdpredesign-container-variant').is(':visible')) {
					getproduct_code = $('.selectedVariantCode').siblings('.variantProductCodeUpdate').val();
				}
				else {
					getproduct_code = $('.trackProductCode').val();
				}
				objData = { "miles": getMiles, "latitude": getlatitude_val, "longitude": getlongitude_val, "productCode": getproduct_code };
			}
			else {
				if(($('.product-grid-row').is(':visible') || $('.product-search-row').is(':visible')) && (ACC.mystores.isPLPPage == "true")){
					getproduct_code = ACC.mystores.selectPLPProduct;
					objData = {"miles":getMiles,"latitude":getlatitude_val,"longitude":getlongitude_val,"storeId":storeId,"productCode": getproduct_code};
				}else{
					objData = {"miles":getMiles,"latitude":getlatitude_val,"longitude":getlongitude_val,"storeId":storeId}; 
				}
			}
			if(type != 'location'){
				objData.storeId = storeId;
			}
			else{
				objData.page = 0;
				objData.q = '';
			}
			$.ajax({
				url: ACC.config.encodedContextPath + '/store-finder/stores',
				method: "GET",
				datatype: "json",
				data: objData,
				success: function (data) {
					var responseData = JSON.parse(data);
					if (responseData.searchedStore.data != undefined) {
						$('.searched_branch').html(ACC.mystores.createbranchCard(responseData.searchedStore.data[0], storeId));
						$('.searched_container').show();
						$('.nearby_container').hide();
					}
					else {
						window.location.href = ACC.config.encodedContextPath + '/store-finder/footer?query=' + storeId + '&miles=100'
					}
				},
				error: function (data) {
					storeFinderRedirect.click();
				}
			});
		}
	},
	createbranchCard: function(data, storeId) {
    var item = "";
    if (data) {
        var getMiles = '';
        if (data.formattedDistance) getMiles = data.formattedDistance.split(' ')[0];

        item += '<div class="row bg-light-grey border-radius-5 p-t-10 margin0 m-b-10 branch_item">';
        item += '<div class="col-md-12 f-s-20 f-w-600 font-Geogrotesque p-r-45 text-default branch_item_name">' + data.name + '</div>';

        if (data.enableOnlineFulfillment === false || data.enableOnlineFulfillment === "false") {
            item += `<div class="col-md-12 inBranchOnly-label">
                        ${ACC.config.branchShopping}
                     </div>`;
        }
        if ($("body").hasClass("page-productDetails") && !$(".branchpopup_click").hasClass("pdpvarianttopLink") || (($('.product-grid-row').is(':visible') || $('.product-search-row').is(':visible')) && (ACC.mystores.isPLPPage == "true"))) 
		{
            let stockDetail = (data.stockDetail || '').toLowerCase();
            let stockRef = $('#cboxContent .header_' + stockDetail + '_status');
            if (stockRef && stockRef.html()) {
                item += '<div class="col-xs-12 p-y-5 font-size-14 flex-center ' + stockRef.attr("class") + '">' + stockRef.html() + '</div>';
            }
        }
        if (getMiles) {
            item += '<div class="col-md-12 f-w-400 font-size-14 text-blue text-gray-1">' +
                    '<a class="underline-text" href="' + ACC.config.encodedContextPath + '/store-finder">' +
                    getMiles + ' ' + ACC.config.storeFinderPopupDistanceUnit +
                    '</a></div>';
        }
        item += '<div class="col-md-12 m-t-10 font-size-14 branch_item_address">' +
                    '<span class="line1">' + (data.line1 || '') + '</span>&nbsp;<span class="line2">' + (data.line2 || '') + '</span>' +
                    '<p class="address_area">' +
                        '<span class="town">' + (data.town || '') + '</span>,' +
                        '<span class="region">' + (data.regionCode || '') + '</span>&nbsp;' +
                        '<span class="postalCode">' + (data.postalCode || '') + '</span>' +
                    '</p>' +
                 '</div>' +
                 '<div class="col-md-12 m-b-10 f-w-400 font-size-14 text-blue text-gray-1 margin-ph">' +
                    '<a class="underline-text" href="tel:' + (data.phone || '') + '">' + (data.phone || '') + '</a>' +
                 '</div>';
        if (data.storeSpecialityDetails && data.storeSpecialityDetails.length > 0) {
            item += '<div class="col-xs-12"><div class="row margin0">';
            data.storeSpecialityDetails.forEach(speciality => {
                item += '<div class="col-xs-6 f-s-12 flex-center p-l-5 p-r-5 padding0 store-speciality-details">' +
                            '<img class="m-r-5 speciality-icon" alt="' + speciality.name + '" src="' + speciality.icon + '"/>' +
                            '<span>' + speciality.name + '</span>' +
                        '</div>';
            });
            item += '</div></div>';
        }
        item += '<div class="col-xs-12 m-y-15"><div class="row margin0 p-l-5">' +
                    '<div class="col-xs-5 padding0">' +
                        '<a class="btn btn-default btn-small btn-block storeDetails_branches" href="' + ACC.config.encodedContextPath + '/store/' + storeId + '">' +
                            ACC.config.branchDetails +
                        '</a>' +
                    '</div>';
        if (data.enableOnlineFulfillment === true || data.enableOnlineFulfillment === "true") {
            item += '<div class="col-xs-7 p-r-0">' +
                        '<form method="get" action="' + ACC.config.encodedContextPath + '/store-finder/make-my-store/' + storeId + '">' +
                            '<input type="submit" value="' + ACC.config.makeMyBranch + '" class="btn btn-primary btn-small btn-block abtn">' +
                        '</form>' +
                    '</div>';
        }

        item += '</div></div></div>'; 
    }

    return item;
},
	changebranchPLPPopupFn: function(productCode, baseCode,inStockFilter){
		ACC.mystores.selectPLPProduct = productCode;
		ACC.mystores.selectBaseCode = baseCode;
		ACC.mystores.isPLPPage = "true";
		if($(".pagename").val() == 'Product Details'){
			ACC.mystores.inStockFilterflag = true;
		}
		else{
			ACC.mystores.inStockFilterflag = inStockFilter;
		}
		$(window).scrollTop(0);
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function (position) {
				$('.branchGeoLocation').removeClass("hidden");
			}
			);
		}
		$("#colorbox").addClass("myBranch-box");
		ACC.colorbox.open("", {
			html: $(".changebranch_popup").html(),
			width: ACC.global.wWidth >= 1024 ? '389px' : '100%',
			height: '100vh',
			top: 0,
			open: true,
			left: "-400px",
			className: "changebranch_border",
			onComplete: function () {
				$(".changebranch_border").hide();
				$(".changebranch_border #cboxLoadedContent").addClass("scroll-bar-5");
				ACC.mystores.changeBranchPopupCall();
				$("#cboxContent select#milesSelector").change(function () {
					ACC.mystores.changeBranchPopupCall();
				});
				_AAData.popupPageName = ACC.config.storepopupPageName;
				_AAData.popupChannel = ACC.config.storepopuppathingChannel;
				try {
					_satellite.track('popupView');
				} catch (e) { }
			},
			onClosed: function () {
				$('.changebranch_border').animate({ 'left': '0px' }, 'slow');
				$("#colorbox").removeClass("myBranch-box");
			}
		})
	},
	bindHeaderStoreOverlay: function ()
	{
		$('.Icon-StoreSpeciality div').each(function () { if ($(this).text().trim() == 0) { $(this).parent().hide(); } });
		if($('body').hasClass('page-storefinderPage')){
			$(".branchpopup_click").addClass('noCursor');
		}
		$(".changebranchpopup-mobile").on('click',function ()
 		{		
			if($("body").hasClass("page-productDetails") && $('.pdpredesign-container-variant').is(':visible')){
					$(".branchpopup_click").addClass('pdpvarianttopLink');
			}
			ACC.mystores.changebranchPopupFn();	
		});
		$(".branchpopup_click").on('click',function ()
 		{		
			
			if($("body").hasClass("page-productDetails") && $('.pdpredesign-container-variant').is(':visible')){
				$(".branchpopup_click").addClass('pdpvarianttopLink');
			}
			if(!$('body').hasClass('page-storefinderPage')){
				ACC.mystores.changebranchPopupFn();	
			}	
		});
	},
	
	bindpopupStoreOverlay: function ()
	{
		$(document).on("submit",'#siteOneStorePopupForm', function(e){
			e.preventDefault()
		var q = $("#cboxContent .js-geo-finder-search-input ").val();
		var miles = $("#cboxContent #geostorelocatormiles-query ").val();
		var cscStore = $.cookie("csc");
		if(q.length>0)
		{
			if(ACC.mystores.validateSearchTerm(q))
			{
				$.ajax({
					url: ACC.config.encodedContextPath + '/store-finder/GeoPOS' ,
					method : "POST",
					data:{"miles":miles,"q":q },
					success: function (response) 
					{
						if(null != response && response !="")
							{
							var html="";
							html+="<div id='popupstoreOverlay'><div id='storeOverlay' class='storeDetails-overlay col-sm-12'><div class='row'><div class='store-display-wrapper col-xs-12 col-sm-6 col-md-6'><span class='storeDisplayName'><a href='"+ ACC.config.encodedContextPath +"/store/"+ response.storeId +"' class='black-title'><input type='hidden' id='analyticsstore' value="+response.name+"/><div class='title'>"+response.name+"</div><div class='title'>"+response.title+"</div></a></span><BR><span class='line1'>"+response.address.line1+"</span>&nbsp;"
							 if(response.address.line2 != null)
								 {
							      html+="<span class='line2'>"+response.address.line2+"";
								 }
							  
							  html+="</span><BR><span class='town'>"+response.address.town+"</span><span class='region'>"+response.address.region.isocodeShort+"</span>&nbsp;<span class='postalCode'>"+response.address.postalCode+"</span><BR><span class='phone'><a class='tel-phone' href='tel:"+response.address.phone+"'>"+response.address.phone+"</a></span><BR><br><span class='storeDirection'><a id='getDirection' href='' data-url='"+response.address.line1+","+response.address.line2+","+response.address.town+","+response.address.region.isocodeShort+","+response.address.postalCode+"'>Directions &#8594;</a></span></div><div class='store-hours-overlay col-xs-12 col-sm-6 col-md-6'><span class='hidden-sm hidden-md hidden-lg'><br/></span><div class='title'>Branch Hours</div><span class='storeStatus'>"+response.storeStatus+"</span><div class='store-timings'>";
							if(response.openingHours.weekDayOpeningList != null)
								{
							  for( i = 0; i < response.openingHours.weekDayOpeningList.length; i++){

								var weekDayOpening = response.openingHours.weekDayOpeningList[i];
								html+="<span class='day'>"+weekDayOpening.weekDay+"";
								if(!weekDayOpening.closed){
									if(weekDayOpening.openingTime != null)
								       {
								        var openingTime=weekDayOpening.openingTime.formattedHour;
								       }
									 if(weekDayOpening.closingTime != null)
									   {
									    var closingTime= weekDayOpening.closingTime.formattedHour;
									   }
									
									html+="<span class='closetime'>"+openingTime+" - "+closingTime+"</span>";
								}
								else{
									html+="<span class='closetime'>"+ACC.config.closed+"</span>"
								}
								
								}
								}
							  html+=" </span></div></div></div><div class='cl'></div><span class='geolocatedLabel col-md-12'>"+ACC.config.closestBranch+"</span>";
						      html+="<div class='col-sm-12 store-locator-actions'>";
									 if(!response.isPreferredStore)
										 {
										 if(null == cscStore || (null != cscStore && cscStore.value != response.storeId))
											 {
											html+="<span class='confirmStoreButton'><form method='get' action='"+ ACC.config.encodedContextPath +"/store-finder/make-my-store/"+response.storeId+"' class='confirmStoreId'><input type='submit' value='"+ACC.config.confirmBranch+"' class='makeMyStore branch-margin remove-decoration bg-transparent border-none'></form></span>";
											 }
										 }
							  html+="<a href='"+ACC.config.encodedContextPath +"/store-finder' class='changeStoreLink'>"+ACC.config.changeBranch+"</a></div>";
							
					 			$.colorbox({
					 				html: html,
					 				maxWidth:"100%",
					 				width:"650",
									title:false,
									close:'<span class="glyphicon glyphicon-remove"></span>',
									escKey: false,
						 		    overlayClose: false,
						 			onComplete: function(e) {
						 				$(".glyphicon-remove").click(function(){
						 					window.location = "/"; 
						 				 });
						 				
						 				},
								});
							}
						else
							{
							$("#cboxContent #noGeoStoreResultsMsg").show();
		                    $("#cboxContent #geostoreResultsMsg").html('');
		                    $("#cboxContent #geocopyContent").hide();
		                    $("#cboxContent #geo-store-heading").hide();
		                    $("#cboxContent #geoSearchAgain").show();
		                    if(q != '') {
		                        $("#cboxContent #noGeoStoreResultsMsg").html(" <div class='headline2'> "+ACC.config.noLocationsFound+" </div><div class='col-md-12 col-sm-12 col-xs-12 noStoreResults'><p></p> " + ACC.config.noBranchFound + "&nbsp;" + miles +" miles of " + q + ".&nbsp;"+ ACC.config.noBranchFound1
		                            + " <span class='bold-text'><a class='tel-phone' href='tel:(1-800)748-3663'>1-800-748-3663</a> (1-800-SITE-ONE)</span>.</div><br/>");
		                    } else {
		                        $("#cboxContent #noGeoStoreResultsMsg").html(" <div class='headline2'> "+ACC.config.noLocationsFound+" </div><div class='col-md-12 col-sm-12 col-xs-12' style='padding-left:0px'><p></p> "+ACC.config.noBranchFound + miles +" miles of " + q +ACC.config.noBranchFound1
		                            + " <span class='bold-text'><a class='tel-phone' href='tel:(1-800)748-3663'>1-800-748-3663</a> (1-800-SITE-ONE)</span>.</div><br/>");
		                    }

		                    $(".js-store-finder").hide();
		                    $("#cboxContent #geostoreResultsMsg").html('');

							}
					}
					});
			}
		}else{
			$(".alert").remove();
			if($(".js-storefinder-alert").length<1){
				$("#cboxContent #geostoreResultsMsg").html('');
				var emptySearchMessage = ACC.config.invalidDetail
				$(".js-store-finder").hide();
				$("#cboxContent #storeFinder_search").before('<div class="js-storefinder-alert alert alert-danger alert-dismissable" ><button class="close" type="button" data-dismiss="alert" aria-hidden="true"></button>' + emptySearchMessage + '</div>');
			}
		}
		 
		})
	},
	
	validateSearchTerm : function(input){
		$(".alert").remove();
		var regexForDigits = /^[\d-]+$/;
		var lengthOfInput =  $("#cboxContent .js-geo-finder-search-input ").val().length;
		var regexValidateZeros = new RegExp("^[0]+$");
		var invalidZipCodeMessage =ACC.config.invalidDetail
			
		//Check for Valid Branch Number and ZipCode
		if(regexForDigits.test(input) && lengthOfInput < 3){
			if(regexValidateZeros.test(input)){
			$("#cboxContent #geostoreResultsMsg").html('');
			$(".js-store-finder").hide();
			$("#cboxContent #storeFinder_search").before('<div class="js-storefinder-alert alert alert-danger alert-dismissable" ><button class="close" type="button" data-dismiss="alert" aria-hidden="true"></button>' + invalidZipCodeMessage + '</div>');
			return false;
			}
		}else if(regexForDigits.test(input) && lengthOfInput >= 3){
			var regex1 = new RegExp("^([0-9]{5})(-)([0-9]{4})$");
			var regex2 = new RegExp("^([0-9]{5})$");
			var regex3 = new RegExp("^([0-9]{3})$");
			if(regexValidateZeros.test(input) || (!regex1.test(input) && !regex2.test(input) && !regex3.test(input)))
			{
				$("#cboxContent #geostoreResultsMsg").html('');
				$(".js-store-finder").hide();
				$("#cboxContent #storeFinder_search").before('<div class="js-storefinder-alert alert alert-danger alert-dismissable" ><button class="close" type="button" data-dismiss="alert" aria-hidden="true"></button>' + invalidZipCodeMessage + '</div>');
				return false;
			}
		}else{
			//Check for Valid State Or City
			if(/^[a-zA-Z0-9-,'\s]*$/.test(input) == false || lengthOfInput < 2) {
				$("#cboxContent #geostoreResultsMsg").html('');
				$(".js-store-finder").hide();
				$("#cboxContent #storeFinder_search").before('<div class="js-storefinder-alert alert alert-danger alert-dismissable" ><button class="close" type="button" data-dismiss="alert" aria-hidden="true"></button>' + invalidZipCodeMessage + '</div>');
				return false;
			}
		}
		return true;
	},
	
	bindGeoLocatedStore: function ()
	{
		var geoSuccess = function(position) {
		if(null == $.cookie("gls") || $.cookie("allowBlockAccess") == "blocked" || $.cookie("allowBlockAccess") == "none")
		{				
			$.cookie("allowBlockAccess","allowed", { path: '/' });
				$.ajax({
					url: ACC.config.encodedContextPath + '/store-finder/neareststore' ,
					method : "POST",
					data:{"latitude":position.coords.latitude,"longitude":position.coords.longitude,"userLocationConsent":true},
					success: function (data) 
					{	
						if(data && data != ""){
						$(".js-store-address").removeClass("hidden");
						$(".js-select-location").addClass("hidden");
						$.cookie("gls", data.storeId, { path: '/' });
						if(data.address.town === 'undefined'){
							data.address.town = null;
						};
						ACC.mystores.setStoreDetails(data);
					if(window.location.href.indexOf("/p/")!=-1 || window.location.href.indexOf("/search/")!=-1)
						{
						window.location.reload();
						}
						}
					},
					error: function (data)
					{
						console.log(data);
					}
				  });
		}
	  };
	  
	  var geoError = function(error) {
		if (null == $.cookie("gls")	|| $.cookie("allowBlockAccess") == "allowed") {
				$.cookie("allowBlockAccess", "blocked", { path: '/' });
				ACC.mystores.accessDenied("userBlocked");
			}
		};

	  navigator.geolocation.getCurrentPosition(geoSuccess, geoError);	  
},

	accessDenied: function(whenBlocked)
	{
		var url = $("#ipGeolocationUrl").val();
	      var key = $("#ipGeolocationKey").val();
		if (url && url != "" && key && key != "") {
		  var request = new XMLHttpRequest();
		  request.open('GET', url+"?key="+key);
		  request.setRequestHeader('Accept', 'application/json');
		  request.onreadystatechange = function () {
		  if (this.readyState === 4) {
		       var dataObject = JSON.parse(this.responseText);
		       if(dataObject.status === 'success'){
					
		       $.ajax({				 					
		 			url: ACC.config.encodedContextPath + '/store-finder/neareststore' ,
					method : "POST",
					data:{"latitude":dataObject.lat,"longitude":dataObject.lon,"userLocationConsent":false},
					success: function (data) 
					{	$(".js-store-address").removeClass("hidden");
						$(".js-select-location").addClass("hidden");
						if(data.address.town === 'undefined'){
							data.address.town = null;
						};
						ACC.mystores.setStoreDetails(data);
					},
					error: function (data)
					{
						console.log(data);
					}
		     	 });
				}
				else{
					
					if($("body").hasClass("page-storefinderPage")|| $("body").hasClass("page-siteonestoredetailsPage")){
						return false;
					}
					else{
					if(whenBlocked!=="blockedOnLoad" && $("#isHeadSessionName").val()==="true"){
					// Geolocation block storefinder popup
					$("#colorbox").addClass("geo-location-blocked-overlay");
						ACC.colorbox.open("", {
							html: `<div>
							 		<h3 class='header-signinoverlay'>${ACC.config.overlayBlockHeading}</h3>
									<div>${ACC.config.overlayBlockBody}</div>
									<div class='marginTop20'><a href="${ACC.config.encodedContextPath}/store-finder" class='btn btn-primary'>${ACC.config.overlayBlockNav}</a></div>
					 				</div>`,
							width: "600px",
							closeButton: false,
							escKey: false,
							overlayClose: false,

						});
				}
				}
			}
		      }
		    };
		    request.send();
		}
	},

	setStoreDetails: function(data)
{
    var sessionStore = document.getElementById('sessionStore');
    if (data && data != "" && sessionStore && sessionStore != "")
    {
        _AAData.storeLocatorTerm = data.storeId;										
        var displayData = "<a href='"+  ACC.config.encodedContextPath +"/store/"+ data.storeId +"'><div class='title'>"+ data.address.town +",&nbsp;" + data.address.region.isocodeShort +"&nbsp;#"+ data.storeId +"</div></a></span>";
        
        sessionStore.value = data.storeId;
        $("#sessionStore").val(data.storeId);

        $(".storeDisplayName").html(displayData);
        $(".line1").html(data.address.line1);
        $(".line2").html(data.address.line2);
        $(".town").html(data.name);
        $(".region").html(data.address.region.isocodeShort);
        $(".postalCode").html(data.address.postalCode);
        $(".phone").html("<a class='tel-phone' href='tel:"+data.address.phone+"'>"+data.address.phone+"</a>");

        ACC.mystores.storeStatusApiCall(data.geoPoint.latitude, data.geoPoint.longitude, data.storeNotes, data.storeId, ".storeStatus");

        var direction ="<a id='getDirection' href='' data-url='" 
            + data.address.line1 + "," 
            + data.address.line2 + "," 
            + data.address.town + "," 
            + data.address.region.isocodeShort + "," 
            + data.address.postalCode + "'>"+ACC.config.directions+"</a>";
        $(".storeDirection").html(direction);

		$("#sessionStore").val(data.storeId);
        $("#sessionStoreName").val(data.name);
        $("#sessionStoreLine1").val(data.address.line1);
        $("#sessionStoreLine2").val(data.address.line2);
        $("#sessionStoreTown").val(data.address.town);
        $("#sessionStoreRegion").val(data.address.region.isocodeShort);
        $("#sessionStorePostal").val(data.address.postalCode);
        $("#sessionStorePhone").val(data.address.phone);

        if(null != data.openingHours.weekDayOpeningList)
        {
            $.each($('span[class^="weekDay"]'), function( index, value ) 
            {
                if(index < data.openingHours.weekDayOpeningList.length)
                {
                    var weekdayId=".weekDay"+index;
                    $(weekdayId).html(data.openingHours.weekDayOpeningList[index].weekDay);
                }
            });
                    
            $.each($('span[class^="storeTime"]'), function( index, value ) 
            {
                var weekDaysTiming=".storeTime"+index;
                if(index < data.openingHours.weekDayOpeningList.length)
                {
                    if (!data.openingHours.weekDayOpeningList[index].closed) 
                    {
                        var timing = data.openingHours.weekDayOpeningList[index].openingTime.formattedHour + "-" + data.openingHours.weekDayOpeningList[index].closingTime.formattedHour;
                        $(weekDaysTiming).html(timing) ;
                    }
                    else 
                    {
                        $(weekDaysTiming).html(ACC.config.directions);
                    }
                }
            });
        }
        
        $(".confirmStoreId").attr("action",ACC.config.encodedContextPath + "/store-finder/make-my-store/"+data.storeId);
        
        if($("#sessionStore").val()==$.cookie("gls"))
        {
            $('.geolocatedLabel').css('display', 'block');
        }
        if($("#sessionStore").val() != $.cookie("csc"))
        {
            $.cookie("csc", null, { path: '/' });
            $('.confirmStoreButton').css('display', 'block');
        }
    }
},
	productToggle: function ()
	{
		  $('.tabheading').on('click', function(e) {
			  $(".tabheading").removeClass("seletedTab");
			  $(this).addClass("seletedTab");
		     
		      e.preventDefault();
		    });
	
	},

	updateStoreStatus: function () 
	{
		sessionStorage.removeItem(document.getElementById('sessionStore').value);
	},
	
	checkStoreStatus: function (status) 
	{
		if(status.includes("Closed")||status.includes("Closing")
		||status.includes("Open")||status.includes("Opening")){
			return true;
		}else{
			return false;
		}
	},

	storeStatusApiCall: function (latitude , longitude, storeNotes, storeId, element)
	{
		if(null != storeNotes && storeNotes != "")
		{
			$(element).html(storeNotes);
			return null;
		}
		else
		{
			var status = sessionStorage.getItem(storeId);
			if(sessionStorage.getItem(storeId)){
				if(sessionStorage.getItem("lang")!=ACC.config.encodedContextPath){
					status = "";
				}else{
					if(ACC.config.encodedContextPath == "/es" && ACC.mystores.checkStoreStatus(status)){
						status = "";
					}else if(ACC.config.encodedContextPath == "/en" && !ACC.mystores.checkStoreStatus(status)){
						status = "";
					}
				}
			}

			if(sessionStorage.getItem(storeId) && status != "")
			{
				$(element).html(sessionStorage.getItem(storeId));
				return sessionStorage.getItem(storeId);
			}
			else
			{
				var storeDetailsUrl=ACC.config.encodedContextPath + "/store/storeDetails/"+storeId;
				$.ajax({
					url: storeDetailsUrl,
					cache: false,
					type: "get",
					async:false,
					success: function (response)
					{
						if(response.length==0)
						{
							$(element).html(ACC.config.unavailable);
							return ACC.config.unavailable;
						}
						else
						{
							$(element).html(response);
							sessionStorage.setItem(storeId, response);
							sessionStorage.setItem("lang",ACC.config.encodedContextPath);
							return response;
						}
					},
					error: function()
					{
						 $(element).html(ACC.config.unavailable);
						 return ACC.config.unavailable;
					}
				});
			}
		}
	},
	
	
	bindNearbyOverlayPDP : function(){
		$(document).on("click", "#js-nearby-pdp-overlay", function(e){
			e.preventDefault();
			var productCode= $('.trackProductCode').val();
			var productName=$(".pdp-productname").text().trim();
			var imagePath= $(".image-inner-wrapper img").attr('src');
			var uomId=$("#inventoryUOMIDVal").val();
			$.ajax({
			        type: 'GET',
			        url: ACC.config.encodedContextPath + "/p/showNearbyOverlay/?code="+productCode,
					datatype: "json",
					async:false,			
					success: function(result) {				  
						ACC.mystores.bindNearbyOverlayData(result,productName,imagePath,uomId,productCode,"","","","","");
						if(!result){
							ACC.mystores.bindNearByNullData();
							
						}
					}
			});
		});
		
		$(document).on("click", ".js-nearby-pdp-variant-overlay", function(e){
			e.preventDefault();
			let ref = $(this);
			var productCode= ref.attr("data-variant");
			var productName=$(".variantproduct-name").val();
			var imagePath= $(".image-inner-wrapper img").attr('src');
			var uomId=" ";
			var pdpItemnumber=$(".pdp-itemnumber").val();
			var uomName= ref.parents(".product-variant-table__values").find(".product-variant-table__data:eq(1) .uom-name").val();
			var uomValue= ref.parents(".product-variant-table__values").find(".product-variant-table__data:eq(1) .uom-parameter").val();
			$.ajax({
		        type: 'GET',
		        url: ACC.config.encodedContextPath + "/p/showNearbyOverlay/?code="+productCode,
				datatype: "json",
				async:false,			
				success: function(result) {				  
					ACC.mystores.bindNearbyOverlayData(result,productName,imagePath,uomId,productCode,pdpItemnumber,uomName,uomValue,"","");
					if(!result){
						ACC.mystores.bindNearByNullData();
					}
				}
			});
		});
		
	},
	
	bindNearbyOverlayPLP : function(){
		
		$(document).on("click", "#js-nearby-plp-overlay", function(e){
			e.preventDefault();
			var productCode =$(this).data("value");
			var productName=$(this).parents(".product-item-box").find("a.name").text();
			var imagePath= $(this).parents(".product-item-box").find("a.thumb img").attr('src');
			var uomId=$(this).parents(".product-item-box").find("#inventoryUOMIDVal").val();
			
			$.ajax({
			        type: 'GET',
			        url: ACC.config.encodedContextPath + "/c/showNearbyOverlay/?code="+productCode,
					datatype: "json",
					async:false,			
					success: function(result) {				  
						ACC.mystores.bindNearbyOverlayData(result,productName,imagePath,uomId,productCode,"","","","","");
						if(!result){
							ACC.mystores.bindNearByNullData();
							
						}
					}
			});
		});
	
	},
	
	bindNearByNullData:function(){
							ACC.colorbox.open("", {
		                         html:$("#nearbyOverlayNodata").html(),
		                         width: "800px",
								 className:"nearby-overlay",
		                         close:'<span class="glyphicon glyphicon-remove"></span>',
			                         onComplete:function(){
											if(imagePath) $(".product-info img").attr('src', imagePath);
											$(".product-title").html(productName);
				     					},
 								onClosed: function() {
		    							window.location.reload();
		    						},
		                     });
		
		
	},
	bindNearbyOverlayCartEntry : function(){

		$(document).on("click", "#js-nearby-cartentry-overlay", function(e){
			e.preventDefault();
			var entryNumber = $(this).find('input[name=entryNumber]').val();
			var productCode = $(this).data("prodcode");
			var productName= $(this).data("prodname");
			var imagePath= $("#js-nearby-cartentry-overlay").parents('.cart-items-left-pane').find('.cart-img img').attr('src');
			var uomId= $(this).find('input[name=inventoryUOMID]').val();
			var productCategory =  $(this).data("category");
			var productSubCategory = $(this).data("subcategory");
			$.ajax({
			        type: 'GET',
			        url: ACC.config.encodedContextPath + "/cart/showNearbyOverlay/?code="+productCode,
					datatype: "json",
					async:false,			
					success: function(result) {				  
						ACC.mystores.bindNearbyOverlayData(result,productName,imagePath,uomId,productCode,"","","",productCategory,productSubCategory);
						if(!result){
							ACC.mystores.bindNearByNullData();

						}
					}
			});
		});

	},
	
	bindAnalyticProductdata :function(productCode,productName,productCategory,productSubCategory,productQty,productStockStatus,productBackOrder){
		
		if ($('.loginstatus').val() != ''){
			var cartId= $("#cartID").val();
		}
		else{
			var cartId= $("#anonymousCartId").val();
		}
		
		if ($('.page-productDetails, .page-productGrid').length > 0) {
			var productCode= $('.trackProductCode').val();
			var productName=$(".nearby-overlay .product-title").text().trim();
			var productCategory=$('#breadcrumbName1').val();
			var productSubCategory=$('#breadcrumbName2').val();
		}
			
			var product = [];
			cartLocation(_AAData.eventType);
			function cartLocation(addToCartLocation){
        		product.push({
        	       productInfo: {
        	                "productID": productCode,
							"productName":productName,
							"productCategory":productCategory,
							"productSubCategory":productSubCategory,
							"productQty":productQty,
							"productPrice":"",
							"productStockStatus":productStockStatus,
							"productBackOrder":productBackOrder,
        	                "addToCartLocation": "nearby-overlay",       	                     	           
        	            }
        	   });
        	  digitalData.eventData = {
								 "linktype":"",
        	        			 "linkName" : "Add to Cart",
        	        			 "onClickPageName" : addToCartLocation
        	      		 }
        	  if($(".nav-cart .js-mini-cart-count .nav-items-total:visible").text().trim() === "0" )
	        	{ 
	        		digitalData.cart = {
	        				cartId: cartId,	
	        				event :  "scOpen, scAdd"
	            	};
	        	}
        	  else
	        	{
	        		digitalData.cart = {
	        				cartId:  cartId,	
	            			event :  "scAdd"
	           	    };	
	            }
        	 digitalData.product = product;
        	 try {
            	    _satellite.track("Add Cart");
            	} catch (e) {}
            }
		
		
		
	},
	
	
	bindNearbyOverlayData: function(result,productName,imagePath,uomId,productCode,pdpItemnumber,uomName,uomValue,productCategory,productSubCategory){
					var nearbyStore = "<div class='scroll-bar scroll nearby-data'><table class='table'>";
					var tr="";
					
					var productInfo=$("<div class='col-md-12 padding0 product-info'><div class='flex-center'><div class='col-md-1 col-sm-2 col-xs-3 padding0'><img class='img-responsive' src=''></div><div class='col-md-4 col-sm-4 col-xs-8'><span class='product-title'></span></div><div class='cl'></div><div class='col-md-3 col-xs-6 col-sm-6 pdp-itemnumber-code'><span></span><p></p></div><div class='col-md-3 pdp-uom-details col-xs-6 col-sm-6'><span></span><p></p></div></div></div><div class='cl'></div>");
					  if(screen.width>=1024){
							for (var data of result) {
		                        tr += "<td width='11%'><div class='hidden backorderCheck'>"+ data.isEligibleForBackorder+"</div><div class='plp-qty-container flex-center'><div class='qtyHeading'>"+ACC.config.nearbyQtyText+"</div><input type='text' maxlength='5' value='1' class='form-control nearby-qty-box'/></div><div class='qty-empty-error' style='display:none;'>"+ACC.config.nearbyqtyErrorMsg+"</div></td><td colspan='2' width='45%'> <span class='storeid'>" + data.stockAvailablityMessage + "</span></td><td align='right' width='20%'><span class='miles-text'>" + data.distanceFromHomebranch + " "+ACC.config.milesAway+"</span></td><td width='24%'><button class='btn btn-primary btn-block addtocart-nearbyoverlay'>"+ACC.config.nearbyAtc+"</button></td></tr>";
		                    }
 						}
					else{
						
						for (var data of result) {
		                        tr += "<td><div class='hidden backorderCheck'>"+ data.isEligibleForBackorder+"</div><span class='storeid'>" + data.stockAvailablityMessage + "</span><div class='plp-qty-container flex-center'><div class='qtyHeading'>"+ACC.config.nearbyQtyText+"</div><input type='text' maxlength='5' value='1' class='form-control nearby-qty-box'/></div><div class='qty-empty-error' style='display:none;'>"+ACC.config.nearbyqtyErrorMsg+"</div></td><td><span class='miles-text'>" + data.distanceFromHomebranch + " "+ACC.config.milesAway+"</span><div class='cl'></div><div class='btn-div'><button class='btn btn-primary btn-block addtocart-nearbyoverlay'>"+ACC.config.nearbyAtc+"</button></div></td></tr>";
		                    }
					}
					nearbyStore += tr +"</table></div><div class='col-md-8 col-md-offset-2 addedToCartSection marginTop35 hidden' ><div class='col-md-6'><a href='' class='btn btn-primary btn-block js-mini-cart-close-button btn-popup-overlay-width'>"+ACC.config.continueShopping+"</a></div><div class='col-md-6'><a href='"+ ACC.config.encodedContextPath +"/cart' class='btn btn-default btn-block add-to-cart-button btn-popup-overlay-width'> "+ACC.config.nearbyGoTocart+"</a></div></div>";
							ACC.colorbox.open("", {
		                         html:$("#nearbyOverlay").html(nearbyStore),
		                         width: "900px",
								 top: "5%",
								 className:"nearby-overlay",
		                         close:'<span class="glyphicon glyphicon-remove"></span>',
			                         onComplete:function(){
											$(productInfo).insertBefore(".nearby-data");
											$(".product-info img").attr('src', imagePath);
											$(".product-title").html(productName);
											
											
											if($(".pdp-itemnumber").length>0){
												$(".pdp-itemnumber-code span").html(ACC.config.nearbyItemText);
												$(".pdp-uom-details span").html(uomName);
												$(".pdp-uom-details").css("border-left","solid 1px #ccc");
												$(".pdp-itemnumber-code").css("border-left","solid 1px #ccc");
											}
											
											if(pdpItemnumber){
												$(".pdp-itemnumber-code p").html(pdpItemnumber);
											}
											else {
												$(".pdp-itemnumber-code").remove();
											}
											if(uomValue){
												$(".pdp-uom-details p").html(uomValue);
											}
											else {
												$(".pdp-uom-details").remove();
											}
											
											$(document).on("click", ".addtocart-nearbyoverlay", function(){
												var productStockStatus=$(this).parents('tr').find('.storeid').text();
												var elm = $(this);
												var productQty= $(this).parents('tr').find('.nearby-qty-box').val();
												var backorderCheck=$(this).parents('tr').find('.backorderCheck').text();
												if(backorderCheck=="true"){
													var productBackOrder=productQty;
												}
												else{
													var productBackOrder="";
												}
												ACC.mystores.bindAnalyticProductdata(productCode,productName,productCategory,productSubCategory,productQty,productStockStatus,productBackOrder);
												var storeId= $(this).parents('tr').find('.storeid').text().split('#')[1];
												storeId = storeId.replace(/[^0-9]/g, '');
												var qtyCheck =$(this).parents('tr').find(".nearby-qty-box").val();
												 if(qtyCheck == "" || qtyCheck == null){
													$(this).parents('tr').find(".qty-empty-error").show();
												
													}
											else{
												$(this).parents('tr').find(".qty-empty-error").hide();
													$.ajax({
													        type: 'GET',
													        url: ACC.config.encodedContextPath + "/cart/addFromOverlay/?code="+productCode+"&quantity="+productQty+"&storeId="+storeId+"&inventoryUOMId="+uomId,
															datatype: "json",
															async:false,
															success: function(result) {
																if(result || result == "true")
																{				  
																	$(".addedToCartSection").removeClass("hidden");
														 			elm.parents('tr').addClass('disable-row');
														 			elm.text(ACC.config.nearbyAtcAdded);
																}
															}
													});
												}
											});
											
											$('.nearby-qty-box').keyup(function () { 
											    this.value = this.value.replace(/[^0-9\.]/g,'');
												if (this.value.substring(0, 1) == "0") {
											        this.value = this.value.replace(/^0+/g, '1');
											      }
											});
											$('.nearby-qty-box').keypress(function(e){ 
											   if (this.value.length == 0 && e.which == 48 ){
											      return false;
											   }
											});
											$('body').css("overflow-y", "hidden");
											if(ACC.mixedcartcheckout.iOS() && screen.width < 1024){
												$(window).scrollTop($("#colorbox").offset().top - 20);
											}
			                         },
 								onClosed: function() {
		    							window.location.reload();
										$('body').css("overflow-y", "auto");
		    						},
		                     });
		
	},
	
};


$(document).ready(function() {
	$(".failed-geolocationPopup").click(function(){
		ACC.mystores.failedGeoPopUp();
    });
 });
 
$(document).ready(function() {
	$("#GoeStoreOverLay").click(function(){
    $.ajax({
     
     success: function(response){
 		 ACC.colorbox.open("", {
 			html: $("#branch-detail").html(),
 			maxWidth:"100%",
 			width:"650",
 			onComplete: function(e) {
	 				$(document).ready(function(){
	 		 			$("#colorbox").addClass("myBranch-box");
	 		 			ACC.colorbox.open("", {
	 		 				html: $("#popupstoreOverlay").html(),
	 		 				maxWidth:"100%",
	 		 				width:"650",
	 		 				onClosed: function() {
	 		 					$("#colorbox").removeClass("myBranch-box");
	 		 				}
	 		 			})
	 		 		
	 				});
 				},
 		 	})
     	  }
       })
    });
 });
 
 

$(document).ready(function() 
{
	var isAnonymous = document.getElementById('isAnonymous').value;
	if($.cookie("csc") && (window.location.href.lastIndexOf('/login')) == (window.location.href.length - '/login'.length) != 1 && isAnonymous==false ) 
	{
		$.ajax({
			url: ACC.config.encodedContextPath + "/make-my-store/" + $.cookie("csc"),
			cache: false,
			data: ACC.storefinder.storeSearchData,
			type: "get",
			success: function (response){
				$.removeCookie("csc");
			}
		});
	}
});

$(document).ready(function() 
{	
	if($.cookie("allowBlockAccess") != "allowed" && $.cookie("allowBlockAccess") != "blocked" && $.cookie("allowBlockAccess") != "none" )
	{
		$.cookie("allowBlockAccess","none", { path: '/' });
		ACC.mystores.accessDenied("blockedOnLoad");
	}
});
ACC.passwordrules = {

	_autoload: [
		"passwordValidation",
	],
	
	passwordValidation: function()
	{
		
		$("#siteoneChangePasswordForm #newPassword,#siteOneUpdatePwdForm #password,#siteOneSetPwdForm #password").on('keyup',function (){
			
			var password = $("#siteoneChangePasswordForm #newPassword,#siteOneUpdatePwdForm #password,#siteOneSetPwdForm #password").val();
			var uppercase = /[A-Z]/g;
			var lowercase = /[a-z]/g;
			var numbers = /[ 0-9]/g;
			var symbols = /[_$!@./#%&+-]/g;
			
			
			if(password.length>=8){
				$("#atleast8Char").removeClass("tick-mark-color icon-check-red  icon-check-gray");
				$("#atleast8Char").removeClass("error-mark-color").addClass("tick-mark-color  icon-check-green1");
			}else{
				$("#atleast8Char").removeClass("tick-mark-color icon-check-green1 icon-check-gray");
				$("#atleast8Char").removeClass("tick-mark-color").addClass("error-mark-color  icon-check-red");
			}
			
			if(password.match(uppercase)){
				$("#uppercase").removeClass("error-mark-color icon-check-red  icon-check-gray");
				$("#uppercase").removeClass("error-mark-color").addClass("tick-mark-color  icon-check-green1");
			}else{
				$("#uppercase").removeClass("tick-mark-color").removeClass("icon-check-green1 icon-check-gray");
				$("#uppercase").removeClass("tick-mark-color").addClass("error-mark-color  icon-check-red");
			}
			
			if(password.match(lowercase)){
				$("#lowercase").removeClass("error-mark-color icon-check-red  icon-check-gray");
				$("#lowercase").removeClass("error-mark-color").addClass("tick-mark-color  icon-check-green1");
			}else{
				$("#lowercase").removeClass("tick-mark-color icon-check-red  icon-check-gray");
				$("#lowercase").removeClass("tick-mark-color").addClass("error-mark-color  icon-check-red");
			}
			
			if(password.match(numbers)){
				$("#numeric").removeClass("error-mark-color").removeClass("icon-check-red  icon-check-gray");
				$("#numeric").removeClass("error-mark-color").addClass("tick-mark-color  icon-check-green1");
			}else{
				$("#numeric").removeClass("tick-mark-color").removeClass("icon-check-green1 icon-check-gray");
				$("#numeric").removeClass("tick-mark-color").addClass("error-mark-color  icon-check-red");
			}
			
			if(password.match(symbols)){
				$("#symbol").removeClass("error-mark-color").removeClass("icon-check-red  icon-check-gray");
				$("#symbol").removeClass("error-mark-color").addClass("tick-mark-color  icon-check-green1");
			}else{
				$("#symbol").removeClass("tick-mark-color").removeClass("icon-check-green1 icon-check-gray");
				$("#symbol").removeClass("tick-mark-color").addClass("error-mark-color  icon-check-red");
			}
		
		    
		});
		
	}

};
ACC.promotions = {
	_autoload: [
		"appliedProductpromotions",
        "bindPromotionBanner"
	],
	
	appliedProductpromotions : function ()
	{
		$('input[id^="productPromotion"]').each(function(i, e) {
			ACC.promotions.calculatePromotionPrice($(this), null);
		});
		
	},
	
	calculatePromotionPrice : function(item, productCode) 
	{
		var index;
		if (item.selector) {
			if(productCode != null) {
				index = item.selector.split("productPromotion")[1];
			} else {
				index = item[0].id.split("productPromotion")[1];
			}
		}
		
		var csp = $('#customerSpecificPriceValue'+index).val();
		var price;
		
		if($(item).data('price')) {
			price = $(item).data('price');
			/*if(productCode != null) {
				$('#basePrice' + index).html("<span class='black-title'><b>"+($(item).data('price'))+"</b></span>");
				$('#salePrice' + index).html('');
			}*/
		}
		
		if(csp != "" && csp != undefined) 
		 {
			price = csp;
		 }
		
		var promotion = $(item).val() ? $(item).val().split('||')[0] : '';
		var discount = $(item).val() ? $(item).val().split('||')[1] : '';
		var description =$(item).val() ? $(item).val().split('||')[2] : '';
		var discountPrice;
		var finalPrice;
		var basePriceHtml = $('#basePrice' + index).html();
		if(price) {
			if(promotion == "y_order_entry_fixed_discount")
			{
			  finalPrice=(price-discount).toFixed(2);
			  ACC.promotions.strikePrice(finalPrice, basePriceHtml, index, productCode,description);
			}
			if(promotion == "y_order_entry_fixed_price")
			{
				finalPrice=(discount/1).toFixed(2);
				ACC.promotions.strikePrice(finalPrice, basePriceHtml, index, productCode,description);
			}
			if(promotion == "y_order_entry_percentage_discount")
			{
				finalPrice=(price - (price*(discount/100))).toFixed(2);
				ACC.promotions.strikePrice(finalPrice, basePriceHtml, index, productCode,description);
			}
			if(promotion =="y_partner_order_entry_percentage_discount")
			{
				$('#description' + index).html('<span class="promo">'+ description +'</span>');
			}
			if(promotion =="y_partner_order_entry_fixed_price")
			{
				$('#description' + index).html('<span class="promo">'+ description +'</span>');
			}
			if(promotion =="y_target_bundle_price")
			{
				$('#description' + index).html('<span class="promo">'+ description +'</span>');
			}
			
		}
		
	},
	
	strikePrice : function(finalPrice, basePriceHtml, index, productCode,description)
	{
		 var formatter = new Intl.NumberFormat('en-US', {
          	  style: 'currency',
          	  currency: 'USD',
          	  minimumFractionDigits: 2,
       	 });
		if(!finalPrice.includes('-')){
		  if(productCode == null) {
			$('#salePrice' + index).html(formatter.format(finalPrice));
			basePriceHtml = "<span><del>" + basePriceHtml + "</del></span>";
			$('#basePrice' + index).html(basePriceHtml);
			description="<br><br><span class='promo'>"+ description +"</span>";
			$('#description' + index).html(description);
		} else {
			var cspPriceHtml = $('#customerSpecificPrice' + productCode).html();
			$('#cspSalePrice' + index).html(formatter.format(finalPrice));
			cspPriceHtml = "<span><del><b>" + cspPriceHtml + "</b></del></span>";
			$('#customerSpecificPrice' + productCode).html(cspPriceHtml);
			description="<br><br><span class='promo'>"+ description +"</span>";
			$('#description' + index).html(description);
		     }
		}
	},
	
	bindPromotionBanner : function ()
	{
		if($('.promotionName').length > 0) {
			var url;
			var bannerUrl = $('.promotionName').first().data("url");
			var notes = $('.promotionName').first().data("notes");
    		var code = $('.promotionName').first().data("promoCode");
    		var promoTitle = $('.promotionName').first().data("promoTitle");
    		var endDate =$('.promotionName').first().data("endDate");
    		var currentDate = $('.promotionName').first().data("currentDate");
    		var description = $('.promotionName').first().data("description");
    		var buttonLabel = $('.promotionName').first().data("buttonlabel");

    		var listOfCoupons = JSON.parse($(".listOfCoupons").first().val());
    		$.each(listOfCoupons,function(index,coupon){
    			if((coupon.type.indexOf("ItemType(AbstractCoupon)"))>0){
    				var couponCode = coupon.value;
    				imageHtml = '<div class="promo-banner-heading" style="width:100%;">&nbsp;&nbsp;'+ promoTitle +' </div><div class="promo-banner-heading2">Vivamus eleifend auctor odio integer</div><a href="#" data-end="' + endDate + '" data-description="' + description +  '" data-current="' + currentDate + '" data-coupon="' + couponCode + '" data-promo-notes="' + notes + '" data-promo-url="' + bannerUrl + '" " data-promo-title="' + promoTitle + '" id="buyToday"><button class="btn btn-primary promo-detail-btn">'+buttonLabel+'</button></a><img src="' + bannerUrl + '" width="500" height="300"/>';
    				return false;
    			} else {
    				imageHtml = '<div class="promo-banner-heading">&nbsp;&nbsp;'+ promoTitle +'</div><div class="promo-banner-heading2">Vivamus eleifend auctor odio integer</div><a href="' +  ACC.config.encodedContextPath + '/search/?q=%3Arelevance%3AsoallPromotions%3A' + code + '"><button class="btn btn-primary promo-detail-btn">'+buttonLabel+'</button></a><img src="' + bannerUrl + '" width="500" height="300"/>';
    			}
    		});
    		$('.promotionBanner').first().html(imageHtml);
    		$('#notes').html(notes);
		}
		$('.promotionName').on('click',function ()
    	{
    		var bannerUrl = $(this).data("url");
    		var notes = $(this).data("notes");
    		var code = $(this).data("promoCode");
    		var promoTitle = $(this).data("promoTitle");
    		var endDate = $(this).data("end");
    		var currentDate = $(this).data("current");
    		var description = $(this).data("description");
    		var buttonLabel = $(this).data("buttonlabel");
    		$('#notes').html(notes);
    		var imageHtml;
    		var listOfCouponsField = $(this).nextAll('input').first().val();

    		var listOfCoupons = JSON.parse(listOfCouponsField);
    		$.each(listOfCoupons,function(index,coupon){
    			if((coupon.type.indexOf("ItemType(AbstractCoupon)"))>0){
    				var couponCode = coupon.value;
    				imageHtml = '<div class="promo-banner-heading">&nbsp;&nbsp;'+ promoTitle +'</div><div class="promo-banner-heading2">Vivamus eleifend auctor odio integer</div><a href="#" data-coupon="' + couponCode + '" data-description="' + description +'" data-promo-notes="' + notes + '" data-promo-url="' + bannerUrl + '" data-promo-title="' + promoTitle + '" data-end="' + endDate + '" data-current="' + currentDate + '"  id="buyToday"><button class="btn btn-primary promo-detail-btn">'+buttonLabel+'</button></a><img src="' + bannerUrl + '" width="500" height="300"/>';
    				return false;
    			} else {
    				imageHtml = '<div class="promo-banner-heading">&nbsp;&nbsp;'+ promoTitle +'</div><div class="promo-banner-heading2">Vivamus eleifend auctor odio integer</div><a href="' +  ACC.config.encodedContextPath + '/search/?q=%3Arelevance%3AsoallPromotions%3A' + code + '"><button class="btn btn-primary promo-detail-btn">'+buttonLabel+'</button></a><img src="' + bannerUrl + '" width="500" height="300"/>';
    			}
    		});
    		$('.promotionBanner').first().html(imageHtml);
    		
    	});
		
		$('.mobilePromotionName').on('click',function (e)
		    	{
					e.preventDefault();
					var hasCoupon;
			        var code = $(this).data("mobilePromoCode");
			        var notes = $(this).data("mobileNotes");
					var url = $(this).data("mobileUrl");
					var title = $(this).data("mobilePromoTitle");
					var description = $(this).data("mobileDescription");
					var listOfCouponsField = $(this).nextAll('input').first().val();

		    		var listOfCoupons = JSON.parse(listOfCouponsField);

		    		$.each(listOfCoupons,function(index,coupon){
		    			if((coupon.type.indexOf("ItemType(AbstractCoupon)"))>0){
		    				var couponCode = coupon.value;
				    		/*if(currentDate > endDate)
				    			{
				    			$('#expiryMessage').text("This offer has expired. View current promotions");
				    			
				    			}*/
							var imageHtml;
							/*if(currentDate < endDate){*/
							$("#availableCouponCode").text(couponCode);
							$("#availableCouponTitle").text(title);
							$("#availableCouponNotes").text(notes);
							$("#availableCouponDescription").text(description);
							$("#promoComponent").addClass('hidden'); 
							$("#couponPage").removeClass('hidden');
							$(".promoPage").addClass('hidden');
							$(".tab-content").addClass('hidden');
							$("#notes").addClass('hidden');
							$(".promotionLine").addClass('hidden');
							$('#promoDetails').addClass('hidden');
							$("#promoPdfComponent").addClass('hidden');
							imageHtml='<img src="' + url + '" width="500" height="150"/><br/>'; 
							$('.couponPromotionBanner').html(imageHtml);
							hasCoupon = true;
							return false;
							/*}*/
		    			}
		    			else {
		    				hasCoupon = false;
		    			}
		    				
		    		});
					if(!hasCoupon) {
						window.location.href =  ACC.config.encodedContextPath +"/search/?q=%3Arelevance%3AsoallPromotions%3A" + code;
					}
		    	});
				
		$(document).on('click', '#buyToday', function ()
    	{
			
			var couponCode = $(this).data("coupon");
			var notes = $(this).data("promoNotes");
			var url = $(this).data("promoUrl");
			var title = $(this).data("promoTitle");
			var endDate = $(this).data("end");
			var description = $(this).data("description");
    		var currentDate = $(this).data("current");
    		/*if(currentDate > endDate)
    			{
    			$('#expiryMessage').text("This offer has expired. View current promotions");
    			
    			}*/
			var imageHtml;
			/*if(currentDate < endDate){*/
			$("#availableCouponCode").text(couponCode);
			$("#availableCouponTitle").text(title);
			$("#availableCouponNotes").text(notes);
			$("#availableCouponDescription").text(description);
			$("#promoComponent").addClass('hidden'); 
			$("#couponPage").removeClass('hidden');
			$(".promoPage").addClass('hidden');
			$(".tab-content").addClass('hidden');
			$(".promotionLine").addClass('hidden');
			$("#notes").addClass('hidden');
			$('#promoDetails').addClass('hidden');
			$("#promoPdfComponent").addClass('hidden');
			imageHtml='<img src="' + url + '" width="500" height="150"/><br/>'; 
			$('.couponPromotionBanner').html(imageHtml);
			$(".breadcrumbChange").html("<b>Monthly Specials</b>");
			/*}*/
    	});
		
		if($('.categoryName').length > 0) 
		{
			var uid = $('.categoryName').first().data("uid");
			var promoDiv = '#promotionTitle' +  uid;
			var promoHtml = $(promoDiv).html();
    		$('#promoDetails').html(promoHtml);
		}
		
		$('.categoryName').on('click',function ()
    	{
			var uid = $(this).data("uid");
			var promoDiv = '#promotionTitle' +  uid;
			var promoHtml = $(promoDiv).html();
    		$('#promoDetails').html(promoHtml);
    	});
		
		$(document).on('click', '#categoryLink', function ()
		{
			var promoCategory = $(this).data("promoCategory");
			var promoCategoryCode = $(this).data("promoCategoryCode");
			var promoCategoryDescription = $(this).data("promoCategoryDescription");
			var categoryPromoTitle = $(this).data("categoryPromoTitle");
			var url = $(this).data("categoryUrl");
			var notes=$(this).data("categoryNotes");
			var categoryEndDate = $(this).data("categoryEndDate");
			var categoryCurrentDate = $(this).data("categoryCurrentDate");
			
			/*if(categoryCurrentDate > categoryEndDate)
			{
			$('.expiryMessage').html("This offer has expired. View current promotions");
			
			}*/
			/*if(categoryCurrentDate < categoryEndDate){*/

			var listOfCategoryCoupons = JSON.parse($("#listOfCategoryCoupons").val());
			$.each(listOfCategoryCoupons,function(index,coupon){
			if((coupon.type.indexOf("ItemType(AbstractCoupon)"))>0){
					var couponCode = coupon.value;
						$("#promoComponent").addClass('hidden'); 
						$("#couponPage").removeClass('hidden');
						$(".promoPage").addClass('hidden');
						$('#promoDetails').addClass('hidden');
						$("#notes").addClass('hidden');
						$(".promotionLine").addClass('hidden');
     					$(".tab-content").addClass('hidden');
						$("#promoPdfComponent").addClass('hidden');
						$(".breadcrumbChange").html("<b>Monthly Specials</b>");
						/*$("#shopDeal").attr("href", "/search/?q=%3Arelevance%3AallCategories%3A" + promoCategory + "%3AsoallPromotions%3A" + promoCategoryCode);*/
						}
			$("#availableCouponCode").text(couponCode);
			$("#availableCouponTitle").text(categoryPromoTitle);
			$("#availableCouponDescription").text(promoCategoryDescription);
			imageHtml='<img src="' + url + '" width="500" height="150"/><br/>'; 
			$('.couponPromotionBanner').html(imageHtml);
			$("#availableCouponNotes").text(notes);			
		});
		/*}*/
		});	
		 $(document).on('click', '#noCategoryLink', function ()
			{
			 var promoCategoryCode = $(this).data("promoNoCategoryCode");
			 var categoryPromoTitle = $(this).data("noCategoryPromoTitle");
			 var notes=$(this).data("noCategoryNotes");
			 var promoCategoryDescription = $(this).data("noPromoCategoryDescription");
			 var url = $(this).data("promoNoCategoryUrl");
			 /*if(currentDate > endDate)
 			{
 			$('.expiryMessage').html("This offer has expired. View current promotions");
 			
 			}*/

			 var listOfCategoryCoupons = JSON.parse($("#listOfCategoryCoupons").val());
			$.each(listOfCategoryCoupons,function(index,coupon){
			   if((coupon.type.indexOf("ItemType(AbstractCoupon)"))>0){
					var couponCode = coupon.value;
					$("#promoComponent").addClass('hidden'); 
					$("#couponPage").removeClass('hidden');
					$(".promoPage").addClass('hidden');
					$('#promoDetails').addClass('hidden');
					$("#notes").addClass('hidden');
					$(".tab-content").addClass('hidden');
					$(".promotionLine").addClass('hidden');
					$("#promoPdfComponent").addClass('hidden');
					$("#availableCouponCode").text(couponCode);
					$(".breadcrumbChange").html("<b>Monthly Specials</b>");
					/*$("#shopDeal").attr("href", "/search/?q=%3Arelevance%3AsoallPromotions%3A" + promoCategoryCode);*/
					
					
				}
			   $("#availableCouponTitle").text(categoryPromoTitle);
			   imageHtml='<img src="' + url + '" width="500" height="150"/><br/>'; 
			    $('.couponPromotionBanner').html(imageHtml);
			    $("#availableCouponNotes").text(notes);	
			    $("#availableCouponDescription").text(promoCategoryDescription);
			    
			  
									
			});	
									
		});
      
		
	}

}
ACC.savedlist = {
		
		_autoload: [
			"bindPageLoadFunctions",
		            "bindAddProductToList",
		            "bindShareSavedList",
		            "bindShareUsers",
		            "bindProductComment",
		            "bindCreateForm",
		            "bindEditForm",
		            "bindSelectedProduct",
		            "bindEnableList",
		            "bindEntireList",
		            "bindPagination",
		            "printListPage",
		            "movedEntireList",
					"checkMinQuantityList",
		            "checkingAddListToCart",
		            "setQtyIdDataVal",
		            "bindSaveListBeforeunload",
		            "onLoadRecommendedListSort",
	],
	isFilterPopupSelectAll: false,
	recommendedListDateArray: [],
	isRecommendedListPage: false,
	onLoadRecommendedListSort: function () {
		if ($(".page-savedListPage").length || $(".page-recommendedListPage").length) {
			$(".recommended-table").each(function (index) {
				let target = $(this);
				//Mon Jan 22 23:34:19 IST 2024
				let listDateString = target.attr("data-date").split(" ");
				let listDate = new Date(listDateString[1] + ' ' + listDateString[2] + ' ' + listDateString[5]);
				let listMilliSeconds = listDate.getTime();
				ACC.savedlist.recommendedListDateArray.push(listMilliSeconds + '--' + index);
				target.attr("data-time", listMilliSeconds + '--' + index);
				target.attr("data-order", index);
			});
			ACC.savedlist.recommendedListDateArray.sort();
			ACC.savedlist.getSortedDate();
		}
	},
	getSortedDate: function () {
			ACC.savedlist.recommendedListDateArray.reverse();
			//console.log(ACC.savedlist.recommendedListDateArray)
			$(".recommended-table").each(function (index) {
				let target = $(this);
				let targetIndex = $.inArray(target.data("time"), ACC.savedlist.recommendedListDateArray)
				target.css({"order":targetIndex})
			});
	},
  tabChange: function (tabvalue) {
	$(".recommendedlist-tab").removeClass("active-list-tab");
	$(".tab-list-data").addClass('hidden');
	$(".tab-" + tabvalue).addClass("active-list-tab");
	$('.tab-data-' + tabvalue).removeClass('hidden');
},
recommendedCopyList: function (categoryName, itemCount, btnName, ref) {
	let target = $(ref);
	if(!target.hasClass("disabled") && $('.loginstatus').val() != '') {
		$(".recCategory").html(' <input type="hidden" value="' + categoryName + '" class="recommendCatName" /> <input type="hidden" value="' + btnName + '" class="reccomendBtnName" /> ');
		if (btnName == "selectedCopyList") {
			itemNum = $(".list-item-counter").html();
			$("#recommendedlistcount").html(itemNum);
		}
		else {
			$("#recommendedlistcount").html(itemCount);
		}
		ACC.colorbox.open("", {
			html: $("#recommendedlistpopup").html(),
			width: "615px",
			className: "pdp-atl-popup",
			onComplete: function () {
				$(".recommendedlistname").attr("categoryname", categoryName);
				$(".recommendedlistname").attr("buttonName", "");
				if (btnName == "selectedCopyList") {
					$(".recommendedlistname").attr("buttonName", btnName);
				}
				$(document).on("click", ".listpopupclosebtn", function (e) {
					ACC.colorbox.close();
				});
			},
		});
		$('.list-filters-row').fadeOut();
	}
},
recCopyToMyListPopup: function (wishListCode) {
	let recommendedCategoryName = $("#" + wishListCode).attr("categoryname");
	let buttonName = $("#" + wishListCode).attr("buttonName");
	//console.log(recommendedCategoryName);
	let params;
	if (buttonName == "selectedCopyList") {
		params = {
			wishListCode: wishListCode,
			productItemNumbers: productItemNumbers
		}
	} else {
		params = {
			wishListCode: wishListCode,
			categoryName: recommendedCategoryName
		};
	}
	$.ajax({
		type: "POST",
		url:
			ACC.config.encodedContextPath + "/savedList/addSelectedToSavedWishlist",
		dataType: "json",
		data: params,
		success: function (result) {
			//console.log(result);
			ACC.colorbox.open("", {
				html: ACC.productDetail.pdppopupHtmlExistingList(
					ACC.config.listaddedMsg,
					wishListCode
				),
				width: "500px",
				onComplete: function () {
					$("#colorbox").addClass("item-add-list-box");
					$("body").css("overflow-y", "hidden");
					$(document).on("click", ".successListCreation", function () {
						ACC.colorbox.close();
					});
				},
				onClosed: function () {
					$("body").css("overflow-y", "auto");
					$("#colorbox").removeClass("item-add-list-box");
				},
			});
		},
		error: function (xhr, ajaxOptions, thrownError) {
			//console.log("data failure");
			ACC.myquotes.quotePopupError();
		},
	});
},
$productCodeField: '.productID_assemblyList',
$assemblyproductcode: '.product-codedetail',
listPageCartLink: '',
bindPageLoadFunctions: function() {
	if ($(".page-savedListPage").length || $(".page-recommendedListPage").length || $(".page-detailsSavedListPage").length) {
		setTimeout(function () {
			$('[data-toggle="popover"]').each(function () {
				let target = $(this);
				if (target.hasClass("addListToCarts_filter") && target.attr("disabled") == "disabled") {
					target.popover({ placement: 'top', trigger: 'hover', container: 'body' });
					target.on('shown.bs.popover', function () {
						$(".popover").addClass("bg-danger");
					});
					ACC.savedlist.listPageCartLink = target.attr("href");
					target.attr("href","#");
				}
				else if (!target.hasClass("addListToCarts_filter")) {
					target.popover({ placement: 'top', trigger: 'hover', container: 'body' });
				}
			});
		}, 1000);
		$(".list-filter-search").on("focusout", function () {
			let target = $(this);
			if (target.val() == "") {
				$(".from-input-label").fadeIn();
			}
			else {
				$(".from-input-label").fadeOut();
			}
		});
	}
	//Applicable for recommended list flow
	if ($(".page-recommendedListPage").length || $(".page-savedListPage").length || $(".page-detailsRecommendedListPage").length) {
		ACC.savedlist.isRecommendedListPage = true;
		$(".js-update-entry-quantity-input").each(function(index){
			ACC.recommendedlist.listDetailTotalCalculate(this, true);
		});
	}
	if ($(".page-recommendedListPage").length || $(".page-savedListPage").length) { //both Landing page
		$(".rec-list-link").each(function () {
			let target = $(this).attr("href");
			$(this).attr("href", target.replace("&", "%26"));
		});
	}
	if($(".page-detailsRecommendedListPage").length || $(".page-detailsSavedListPage").length){ //both details page
		//
	}
	if ($(".page-detailsSavedListPage").length) {
		if (window.innerWidth < 768) {
			if(ACC.config.encodedContextPath == '/es'){
				$("#add_Product_to_wishList").val("Agregar artculo a la lista");
			}else{
				$("#add_Product_to_wishList").val("Add Item to List");
			}
		} else {
			if(ACC.config.encodedContextPath == '/es'){
				$("#add_Product_to_wishList").val("Agregar");
			}
			else{
				$("#add_Product_to_wishList").val("Add");
			}
		}
		$("#savedListSearch").on('keyup', function(e){if(e && e.keyCode == 13){ $(".saved_add_to_cart_btn").trigger('click');}});
		if ($(".saved-list-singleProduct").length) {
			$(".empty-listfilter-hide").removeClass("hidden");
			ACC.savedlist.updateListFilter(true);
			$(".list-filter-search").trigger("focusout");
		}
		else if(!$("#filter-Brand-1").length && $(".list-page-counter").text() != 0){
			$(".empty-listfilter-show").removeClass("hidden");
		}
		$("#add_Product_to_wishList").click(function () {
			var proCode = $("#savedListSearch").val().replace(/\s/g, '');
			var quantity = $("#quantityId").val();
			var regex = new RegExp("^[0-9]+$");
			$(".list-add-product-error").hide();
			var isEmptyProduct = (proCode === "");
			var isInvalidqty = (quantity === "" || !regex.test(quantity));
			var savedListName = $("#wishListListName").val();
			if (isEmptyProduct ) {
				$("#empty_code, .list-add-product-error-box").show();
			}
			else if (isInvalidqty) {
				$("#empty_quantity, .list-add-product-error-box").show();
			}
			else {
				$.ajax({
					type: 'POST',
					url: ACC.config.encodedContextPath + "/savedList/add",
					datatype: "json",
					data: {
						productCode: proCode,
						quantity: quantity,
						wishListCode: savedListName
					},
					success: function (wishlistAddResponseData) {
						digitalData = {
							event: 'add product to list',
							item: proCode,
							listName: $('.list-headline').text()
						}
						try {
							_satellite.track('productAddedToList');
						} catch (e) { }
						if (wishlistAddResponseData.message == 'Product not found') {
							$("#empty_code, .list-add-product-error-box").show();
						}
						else if (wishlistAddResponseData.message == 'baseproduct') {
							$("#base_product_error, .list-add-product-error-box").show();
						}
						else if (wishlistAddResponseData.message == 'uomproduct') {
							$("#uom_product_error, .list-add-product-error-box").show();
						}
						else if (wishlistAddResponseData.message == ACC.config.pdpnouommsg) {
							$("#uom_hidden_error, .list-add-product-error-box").show();
						}
						else if (wishlistAddResponseData.message == null) {
							$("#invalid_code, .list-add-product-error-box").show();
						} else {
							loading.start();
							window.location.reload(true);
						}
					},
					error: function (xhr, ajaxOptions, thrownError) {
						$("#invalid_code, .list-add-product-error-box").show();
					}
				});
			}
		});
		$(".deleteProFromList").click(function () {
			var prodCode = $(this).siblings('#addproductCode').val();
			var quantity = $("#qty").val();
			var savedListName = $(this).siblings('#savedListName').val();
			var productsku = $(this).siblings('#product_code').val();
			var price = $(this).closest(".qty-list-flex").find(".js-customer-price").val() || 0;
			var qty = $(this).closest(".qty-list-flex").find(".qtyId").val() || 0;
			loading.start();
			$.ajax({
				type: 'POST',
				url: ACC.config.encodedContextPath + "/savedList/moveSavedList",
				datatype: "json",
				data: {
					productCode: prodCode,
					wishListCode: savedListName,
					quantity: quantity
				},
				success: function (result) {
					loading.stop();
					var productPrice = Number(price).toFixed(2) * Number(qty);
					var cumulativeTotPrice = Number($('.cumulative-tot-price').find('strong').text().replaceAll(/[$,]/g, '') || 0);
					cumulativeTotPrice -= (productPrice).toFixed(2);
					$('.cumulative-tot-price').find('strong').text("$" + ACC.savedlist.formatNumberComma(cumulativeTotPrice.toFixed(2)));
					let leftItemCount = Number($(".list-page-counter").html() - 1);
					$(".list-page-counter").html(leftItemCount);
					let leftCheckedItemCount = Number($(".list-item-counter").html() - 1);
					$(".list-item-counter").html(leftCheckedItemCount);
					if (leftCheckedItemCount === 0) {
						$(".list-item-counter-text").addClass("hidden");
					}
					if (leftItemCount === 0) {
						window.location.reload();
					}
					if ($(".saved-list-singleProduct").length > 1) {
						$(".sl_singleProduct_" + productsku).slideUp("slow", function () {
							$(this).remove();
							ACC.savedlist.checkingAddListToCart();
						});
					} else {
						$(".list-filters-row, .controls-mob, .product__list").slideUp("slow", function () {
							$(".remove-noproduct").removeClass("hidden");
						});
					}
				},
				error: function (xhr, ajaxOptions, thrownError) {
					loading.stop();
					//console.log('data failure');
				}
			});
		});
	}
},
	listQtyUpdate: function(e, from){
		let ref = $(e);
		let refVal = Number(ref.val());
		let refMax = Number(ref.data("available-qty"));
		let refParent = ref.parents(".saved-list-sec");
		let refSelect = refParent.find(".js-uom-selector:visible");
		let refMultilier = 1;
		if(refVal && refMax && refMax > 0 && refVal > 0){
			if(refSelect.length){ /* Multiple uom and atleast UOM visible */
				refMultilier = refSelect.find(":selected").data("inventorymultiplier");
			}
			else if(!refSelect.length) { /* single uom if other than each */
				refMultilier = ref.data("inventorymultiplier");
			}
			else { /*  Multiple uom but only 1 UOM visible  */
				refMultilier = 1;
			}
			if(refMultilier && refMultilier > 0){
				if(refVal*refMultilier > refMax){
					refParent.find(".list-warning-section").show();
				}
				else{
					refParent.find(".list-warning-section").hide();
				}
				if(refMultilier > refMax){
					refParent.find(".list-outofstock-section").show();
					refParent.find(".list-instock-section").hide();
				}
				else{
					refParent.find(".list-outofstock-section").hide();
					refParent.find(".list-instock-section").show();
				}
				refParent.find(".list-instock-section span").html(Math.floor(refMax/refMultilier));
			}
		}
		//console.log(from, refVal , refMax, refMultilier);
	},	
    bindAddProductToList:function()
	{
    	var productcode=[];
    	$("#add_Product_to_savedList").on('click', function (){
    		loading.start();
    		$(this).addClass('disabled');
    		var btnstatus=$(this);
    	var productCodes=$("#savedListSearch").val().replace(/\s/g, '');
    	var quantity = $("#quantityId").val();
    	var regex = new RegExp("^[0-9]+$");
    	var isMyStoreProduct=false;
    	var list_products=$("#save_list_product_"+productCodes).val();
    	var list_product_number = $("#save_list_product_number"+productCodes.toUpperCase()).val();
    	if(productCodes!=undefined)
    		{
    	productCodes=productCodes.replace(/\s/g, '');
    		}
    	if(list_products!=undefined)
    		{
    	list_products = list_products.replace(/\s/g, '');
    		}
    	if (list_product_number !=undefined ) {
    		list_product_number = list_product_number.replace(/\s/g, '');
    		list_product_number = list_product_number.toUpperCase();
    	}
    	var imageUrl=null;
    	
    	var url= ACC.config.encodedContextPath +"/savedList/displayProduct?productCodes="+productCodes;
    	var str = productCodes.toUpperCase();
    	
    	var productExist = list_product_number == str;
    	
    	var type="POST";
    		$.ajax({
    			url:url,
    			type:type,
    			beforeSend:function(xhr)
    			{
    				$("#base_product_error").hide();
    				$("#uom_product_error").hide();
    				$("#uom_hidden_error").hide();
    				$("#invalid_code").hide(); 		
    				if(list_products==productCodes || productExist)
    				{
    					$("#invalid_code_empty").hide();    					
    					$("#empty_quantity").hide();    					
    					$("#duplicate_code").show();
    					xhr.abort();
    					btnstatus.removeClass('disabled');
    					loading.stop();
    				}
    				var isEmptyProduct=(productCodes === "");
    		  	    var isInvalidqty=(quantity === ""|| !regex.test(quantity));
    		  	    if(isEmptyProduct){
    	      	    	$("#invalid_code_empty").show()
    	      	    	xhr.abort();
						btnstatus.removeClass('disabled');
						loading.stop();
    	      	    }
    	      	    else{
    	      	    	$("#invalid_code_empty").hide();
    	      	    }
    	      	    
    	      	    if(isInvalidqty){
    	      		  $("#empty_quantity").show();
    	      		xhr.abort();
					btnstatus.removeClass('disabled');
					loading.stop();
    	    	    }
    	    	    else{
    	    	    	$("#empty_quantity").hide();
    	    	    }
    		  	    
    		  	    
    		  	     
    				
    				
    				
    			

    			}, 
    			success:function(productData)
    			{
    				if(productData!==''&&productData!==null)
    					{
    					
    					 var productID = $("#savedListSearch").val();
    					 digitalData.eventData={
    							 productID: productID
    							}
    					 try {
    							_satellite.track("productAddToAssembly");
    						}catch(e){}
    						
    					$("#invalid_code_empty").hide();
    					$("#invalid_code").hide(); 		
    					$("#empty_quantity").hide();
    					$("#duplicate_code").hide();
    					//productcode+=productCodes+"|"+quantity+",";
    					
    					if (productData.variantType == 'GenericVariantProduct' && productData.variantCount != 1) {
    						$("#base_product_error").show();
    					
    					}
    					else if(productData.sellableUomsCount == 0 && (productData.singleUom) && productData.hideUom)
    					{
    						$("#uom_hidden_error").show();
    					}
    					else {
    					
    					$("#product_list").val(	$("#product_list").val()+(productData.code+"|"+quantity+","));
    					
    					
    					if(productData.name!=null)
    						{
    						name=productData.name;
    						}
    					if(productData.code!=null)
						{
						sku=productData.code;
						}
    					if(productData.itemNumber!=null)
    						{
    						code=productData.itemNumber;
    						}
    					if(productData.images!=null)
    						{
    						image=productData.images[0]
    						if(image!=undefined)
    							{
    						imageUrl=image.url
    							}
    						else
    							{
    							imageUrl= ACC.config.encodedContextPath +"/_ui/responsive/theme-lambda/images/missing_product_EN_300x300.jpg";
    							}
    						}
    					else
    						{
    						imageUrl= ACC.config.encodedContextPath +"/_ui/responsive/theme-lambda/images/missing_product_EN_300x300.jpg";
    						}

    				var msgfinal = productData.storeStockAvailabilityMsg;

					if(productData.inStockImage==true){
						msgfinal = '<img class="inventory-message-icon" src="/_ui/responsive/common/images/S1-in-stock-checkmark.svg"" alt=""/>' + msgfinal;
					} else if(productData.notInStockImage==true){
						msgfinal = '<img class="inventory-message-icon" src="/_ui/responsive/common/images/S1-nearby-location.svg"" alt=""/>' + msgfinal;
					} else if(productData.outOfStockImage==true){
						msgfinal = '<img class="inventory-message-icon" src="/_ui/responsive/common/images/S1-out-of-stock-Xg.svg"" alt=""/>' + msgfinal;
					} else if(productData.isEligibleForBackorder==true){
						msgfinal = '<img class="inventory-message-icon" src="/_ui/responsive/common/images/S1-nearby-location.svg"" alt=""/>' + msgfinal;
					} 
   				$("#saved_list_item").append("<div class='saved-list-data' id='product"+productData.code+"'><input type='hidden' class='product-codedetail' id='save_list_product_"+productData.code+"' value='"+productData.code+"'><input type='hidden' id='save_list_product_number"+productData.itemNumber+"' value='"+productData.itemNumber+"'><div class='margin20'><div class='row'><div class='col-md-4 col-sm-4 col-xs-4'><img src="+imageUrl+" alt='"+name+"'  title='"+name+"' style='width:100%;margin-bottom: 10px;'/></div><div class='col-md-4 col-sm-4 col-xs-8'><b><a href=" + ACC.config.encodedContextPath + productData.url+" class='green-title'>"+name+"</a></b><br/><span class='hidden-xs'><br/><br/><br/><br/></span><span class='visible-lg'><br/><br/></span>"+msgfinal+"<br/>"+code+"</div><div class='visible-xs col-xs-12 hidden-sm- hidden-md hidden-lg'><hr></div><div class='col-md-3 col-sm-4 col-xs-12 create-list-remove-button'><input type='button' data-code='"+sku+"'class='btn btn-default btn-block savedlist_remove_product' value='Remove'/></div></div><div class='cl'></div></div></div>");
    				$("#savedListSearch").val().replace(/\s/g, '');
    				$("#quantityId").val("1");
    				$("#invalid_code").hide();
    				$("#invalid_code_empty").hide();
    				$("#listheader").html("Add more products:");
    				$("#assemblyheader").html("Add more products:");
    				$(document).on('click', '.savedlist_remove_product', function(event) { 
    					$("#invalid_code_empty").hide();
    					$("#invalid_code").hide(); 		
    					$("#empty_quantity").hide();
    					$("#duplicate_code").hide();
    			/*	$(".savedlist_remove_product").on('click', function (){*/
    					var products=$("#product_list").val().split(",");
       					var product=$(this).attr("data-code");
       					var j=-1;
       					for(var i=0;i<products.length;i++){
       						if(product== products[i].split("|")[0]){
       							j=i;
       							break;
       						}
       						
       					}
       					/*products.forEach(function(e){
       						
       						var status=e.includes(product);
       						if(!status) {
       							pro =
       							
       							
       						}
       						i++;
       						
       					});*/
       					if(j!= -1){
       					products.splice(j,1);
       					}
    					$("#product_list").val(products);
    					//$(this).parent("div").parent("div").remove();
    					$("#product"+product).remove();
    					$(this).find("#saved_list_item").hide();
    					if($(".saved-list-data").length == 0){
    						$("#listheader").html("");
    					}
    					$("#assemblyheader").html(ACC.config.assemblyHeader);
       					
    				});
    				} }
    				else
    					{
    									
        					$("#duplicate_code").hide();
        					$("#empty_quantity").hide();
    						$("#invalid_code_empty").hide();
    						$("#base_product_error").hide();
    						$("#uom_product_error").hide();
    						$("#uom_hidden_error").hide();
    					$("#invalid_code").show();
    						
    					}
    				btnstatus.removeClass('disabled');
    				loading.stop();
    				
    			},
    		error: function(xhr,status,error)
			{
    			btnstatus.removeClass('disabled');
    			loading.stop();
			}
    		
		
	});
    	
	});
	},
	
	bindShareSavedList:function()
	{
		$("#share_Saved_List").on('click', function (){
			$(".overlayBackground").fadeIn();
			$("#siteoneShareSavedListForm").fadeIn();
			if ($('.page-detailsSavedListPage').length > 0){
				       _AAData.popupPageName= ACC.config.sharelistpathingPageName;
				       _AAData.popupChannel= ACC.config.myaccountpathingChannel;
			 	try {
				    	 _satellite.track('popupView');
		        } catch (e) {} 
			}
			if ($('.page-detailsAssemblyPage').length > 0){
				_AAData.popupPageName= ACC.config.shareassemblypathingPageName;
				_AAData.popupChannel= ACC.config.myaccountpathingChannel;
			 	try {
				    	 _satellite.track('popupView');
		        } catch (e) {} 
			}
		});
		
		$("#siteoneShareSavedListForm .cancelBtn").on('click', function (){
			$("#siteoneShareSavedListForm").fadeOut();
			$(".overlayBackground").fadeOut();
			$('body').css('overflow-y', 'auto'); 
			
	    	_AAData.popupPageName= "";
	    	_AAData.popupChannel= "";
		 	 
		});
		
		$(".shareListDetailBtn").on('click', function (){		
			var jsonData = {
					"code" : $("#code").val(),
					"listname" : $("#listname").val(),
					"users" : $("#users").val(),
					"note" : $("#note").val(),
					"isViewEdit": JSON.parse($("input[name='allow-label']:checked").val())
			}
			$.ajax({
		        type: 'POST',
		        url: ACC.config.encodedContextPath + "/savedList/shareList",
		        contentType : 'application/json; charset=utf-8',
		        datatype: "json",
		        data: JSON.stringify(jsonData),
		        success: function(result) {
	    			digitalData.eventData={
	   					 shareMedium:"Share",
	   					}
		   			 try {
		   					_satellite.track("shareList");
	   				}catch(e){}	
		            ACC.colorbox.open("", {
		                html: ACC.config.shareList,
		                width: "650px",
		                height:"224px",
		                onComplete: function(){
		                	_AAData.popupPageName= ACC.config.sharelistsuccesspathingPageName;
			    			_AAData.popupChannel= ACC.config.myaccountpathingChannel;
						 	try {
							    	 _satellite.track('popupView');
					        } catch (e) {} 
		                	$("#siteoneShareSavedListForm").fadeOut();
		        			$(".overlayBackground").fadeOut();
		        			$('body').css("overflow-y","hidden");
		        			$('#colorbox').addClass('list_item_added');
		    			},
		                onClosed: function() {
		    				$('body').css("overflow-y","auto");
		    				$('#colorbox').removeClass('list_item_added');
		    				window.location.reload();
		    			}
		            });
		        
		        	
		           
		        },
		        error: function(xhr, ajaxOptions, thrownError) {
		            //console.log('data failure');
		        }
		    });
			
		});
		
		
		$(".shareAssemblyDetailBtn").on('click', function (){		
			$.ajax({
		        type: 'POST',
		        url: ACC.config.encodedContextPath + "/assembly/shareList",
		        datatype: "json",
		        data: 
		        	 $("#siteoneShareSavedListForm").serialize()
		        ,
		        success: function(result) {
		            ACC.colorbox.open("", {
		                html:  ACC.config.shareAssembly,
		                width: "650px",
		                className:"sharedassembly-successmsg",
		                onComplete: function(){
		                	 _AAData.popupPageName= ACC.config.shareassemblysuccesspathingPageName;
		 	            	_AAData.popupChannel= ACC.config.myaccountpathingChannel;
		 				 	try {
		 					    	 _satellite.track('popupView');
		 			        } catch (e) {} 
		                	$("#siteoneShareSavedListForm").fadeOut();
		        			$(".overlayBackground").fadeOut();
		        			$('body').css('overflow-y', 'auto'); 
		    			},
		                onClosed: function() {
		    				$('body').css("overflow-y","auto");
		    				window.location.reload();
		    			}
		            });
		        
		        	
		           
		        },
		        error: function(xhr, ajaxOptions, thrownError) {
		            //console.log('data failure');
		        }
		    });
			
		});
	},
	
	bindProductComment:function()
	{
		$(".saved_list_comment").on('click',function (e){
			var productCodeData=$(this).attr("data-productCode");
			var arrdata = productCodeData.split("|");
			var productCode = arrdata[0];
			//console.log(arrdata[1]);
			var commentData = arrdata[1];
			$(".overlayBackground").fadeIn();
			$("#commentOverlay_"+productCode).fadeIn();
			$(".list-comment").val(commentData);
			 var text_max = 200;
				$(".list-comment").each(function( index ) {
						
					if($(this).length!=0)
				 	{
						 var text_length = $(this).val().length;
						 var data_remaining = text_max - text_length;
				 	}
				 		if(text_length!=0)
				 	{
				 		$('.text-remaining').html(ACC.config.remaining +' '+data_remaining + '' + ACC.config.characters);
				 		if(data_remaining==0)
				 		{
				 			$('.text-remaining').css("color","red");
				 		}
				 		else
				 			{
				 			$('.text-remaining').css("color","#999");
				 			}
				 	}
				 else
				 	{
					 $('.text-remaining').css("color","#999");
					 $(".text-remaining").html(ACC.config.remaining +''+text_max+ '' + ACC.config.characters);
				 	}
						});

		});
		
		
	},
	
	bindCreateForm:function()
	{
			$(document).on('change', "#csvFile", function(e){
				e.preventDefault();
	    		var status = true;
	    		
	    		if($("#name").val() == "" || $("#name").val() == null)
	    		{
	    			status = false;
	    			
	    			var selectedFile = document.getElementById('csvFile').files[0];
		            if (ACC.csvimport.isSelectedFileValid(selectedFile)) {
		            	document.getElementById('csvFile').value = '';
		            }
	    			ACC.formvalidation.addErrorClassForRegForm('#name', '#nameError', '#name\\.errors', 'Enter a list name.<div class="cl"></div><br/><br/>');
	
	    		}
	    		else
	    			{
	    			$("#nameError").empty();
	    			}
	
						var selectedFile = document.getElementById('csvFile').files[0];
			            if (!ACC.csvimport.isSelectedFileValid(selectedFile)) {
			            	$("#globalMessages").hide();
			                return;
			            }
			            if(status)
						{
					    document.getElementById("siteoneSavedListCreateForm").submit();
						}
			});
		$(document).on('input blur', "#name:visible", function (e) {
			var listPage = $('#nameError').hasClass('create-list-error');
			if (listPage) {
				ACC.formvalidation.vaildateFields('#name', '#nameError', '#name\\.errors', ACC.config.listHeader);
			}
			var assemblyPage = $('#nameError').hasClass('create-assembly-error');
			if (assemblyPage) {
				ACC.formvalidation.vaildateFields('#name', '#nameError', '#name\\.errors', ACC.config.assemblyHeader);
			}
		});
		
		$('#message').on('input blur',function () {
	       
			$('#message').css("background-color","#fff");
			$('#message').css("border-color","#ccc");
	    });
		 
		$(document).on("click", "#createList", function (e) {
			e.preventDefault();
			var status = true;
			let globalHeaderBtn = $(e.target).data("global-linkname");
			if ($("#name").val() == "" || $("#name").val() == null) {
				status = false;
				ACC.formvalidation.addErrorClassForRegForm('#name', '#nameError', '#name\\.errors', ACC.config.savedEnter);
			}
			else {
				$.ajax({
					type: 'GET',
					url: ACC.config.encodedContextPath + "/savedList/listExists?wishListName=" + $(".listName").val().trim(),
					datatype: "json",
					async: false,
					success: function (result) {
						$("#listglobalMessages").css("display", "none");
						if (!result) {
							//console.log(result);
							status = true;
							if (!globalHeaderBtn || globalHeaderBtn == "") {
								digitalData = {
									event: 'create list',
									item: $('#product_list').val().trim().split(" "),
									listName: $(".listName").val().trim()
								}
								try {
									_satellite.track('listCreated')
								}
								catch (e) { }
							}
						}
						else {
							$("#listglobalMessages").css("display", "block");
							status = false;
						}
					},
					error: function (err) {
						status = false;
					}
				});
				$("#nameError").empty();
				if ($(".pagename").val() == 'Saved List Page') {
					$(".listname").val("");
				}
			}
			if (status) {
				if (!globalHeaderBtn || globalHeaderBtn == "") {
					$("#siteoneSavedListCreateForm").submit();
				} else {
					$("#siteoneSavedListHeaderCreateForm").submit();
				}
			}
		});
		$(document).on("click", "#createAssembly", function (e)
		    	{
			       $(document).on('input blur', "#name", function(e)
				  	   {
				  	      ACC.formvalidation.vaildateFields('#name', '#nameError', '#name\\.errors', ACC.config.assemblyHeader);
				  	   });
		    		e.preventDefault();
		    		var status = true;
		    		if($("#name").val() == "" || $("#name").val() == null)
		    		{
		    			status = false;
		    			$("#nameError").html("<div class='panel-body name-error-msg margin20'>"+ACC.config.assemblyHeader+"</div>");
		    		}
		    		else
		    			{
		    			$("#nameError").empty();
		    			}
		    		if(status)
					{
		    			
		    			var products = [];
			        	$(ACC.savedlist.$assemblyproductcode).each(function() {
			        		var productIDAssembly = $(this).val();
			        	    var totalcode = Number($(this).val());
			        	    if (totalcode > 0) {
			        	        products.push({
			        	            productInfo: {
			        	                "productID": productIDAssembly,
			        	            }
			        	        });
			        	  }
			           });
			        	
			        	_AAData.productAddedtoAssembly= products;
			        	
			        	var isDuplicate;
			        	$.ajax({
		    		        type: 'POST',
		    		        url: ACC.config.encodedContextPath + "/assembly/checkDuplicate",
		    		        datatype: "json",
		    		        data: 
		    		        	 $("#siteoneAssemblyCreateForm").serialize()
		    		        ,
		    		        success: function(isDuplicate) {
		    		        	$("#siteoneAssemblyCreateForm").submit();
		    		        	if(isDuplicate=='false') {
		    		        		try {
		    							_satellite.track("assemblyCreated");
		    						}catch(e){}
		    		        	}
		    		           
		    		        },
		    		        error: function(xhr, ajaxOptions, thrownError) {
		    		        	//console.log('data failure');
		    		        }
		    		    });
			        	
			        	
					}
		    		
		    	});
		
		
	},
	
	bindEditForm:function()
	{
		$(document).on("click", ".modifyList", function (e)
		    	{
		    		e.preventDefault();
		    		var status = true;
		    		if($("#name").val() == "" || $("#name").val() == null)
		    		{
		    			status = false;
		    			$("#nameError").html("<div class='panel-body name-error-msg margin20'>"+ACC.config.listHeader+"</div>");
		    		}
		    		else
		    			{
		    			$("#nameError").empty();
		    			}
		    		if(status)
					{
						$("#siteOneEditSavedListForm").submit();
					}
		    		
		    	});
		$(document).on("click", ".modifyAssembly", function (e)
		    	{
		    		e.preventDefault();
		    		var status = true;
		    		if($("#name").val() == "" || $("#name").val() == null)
		    		{
		    			status = false;
		    			$("#nameError").html("<div class='panel-body name-error-msg margin20'>"+ACC.config.assemblyHeader+"</div>");
		    		}
		    		else
		    			{
		    			$("#nameError").empty();
		    			}
		    		if(status)
					{
						$("#siteOneEditSavedListForm").submit();
					}
		    		
		    	});
	},
	
	productCheckboxAllClicked: 0,
	bindSelectedProduct:function()
	{
		$(document).on("click", ".select_product_checkbox_all", function(e){
			ACC.savedlist.productCheckboxAllClicked = 1;
			productItemNumbers = "";
			productCodes = "";
			if($('.select_product_checkbox_all').prop("checked")) {
				$('.saved-list-sec:visible input:checkbox').not(this).prop("checked",false).trigger("click");
			} else {
				$('.saved-list-sec:visible input:checkbox').not(this).prop("checked",true).trigger("click");
			}
			ACC.savedlist.productCheckboxAllClicked = 0;
		});
		
		$(document).on("click", ".selectedProductRetainOfPagination", function(e){
			e.preventDefault();
			//console.log("I am working", xList);
			var pagenumberUrl = $(this).parent().find('#current_span').val();
			var pageurlparameter = $(this).parent().find('#url-parameters').val();
			var ViewPaginationListnumber = $('#ViewPaginationSavedListDetail').val();
			var url = pagenumberUrl + pageurlparameter + "&pagesize="+ ViewPaginationListnumber;

			window.location.href = url;
			});
		
		$(document).on("click", ".saved-list-previous-link, .saved-list-next-link", function(e){
			e.preventDefault();
			var href = $(this).attr('href');
			var url = new URL(href);

			window.location.href = url;
		});
		
		$(document).on("click", ".select_product_button_all", function(e){
			$('.select_product_checkbox_all').trigger("click");
		});
		$(document).on("click", ".select_product_checkbox", function (e) {
			var target = $(this);
			var id = target.attr('data-role');
			var productCode = $('#prodCode' + id).val();
			var qty = $("#prodQty_" + productCode).val();
			var uomId = target.parents(".saved-list-sec").find("#inventoryUomId").val();
			var productItemNumber = $('#prodItemNumber' + id).val();
			var qtyItem = document.getElementById("prodQtyItem_" + productItemNumber).value;
			var selectedProdList = productCode + "~" + productItemNumber + "~" + qty + "~" + uomId;
			let itemTotalCount = $(".saved-list-sec:visible .select_product_checkbox").length;
			let targetParent = target.parents(".saved-list-sec");
			let targetCheck = targetParent.find(".list-delete-style");
			if (!target.prop("checked")) {
				var x = productItemNumber + "|" + qtyItem + "|" + uomId;
				productItemNumbers = productItemNumbers.replace(x, "");
				var deselect = selectedProdList;
				xList = xList.filter(function (item) {
					return item !== deselect;
				});
				var x = productCode + "|" + qty + "|" + uomId;
				productCodes = productCodes.replace(x, "");
				if (!ACC.savedlist.productCheckboxAllClicked) {
					$(".select_product_checkbox_all").prop("checked", false);
				}
				if($(".page-detailsSavedListPage").length && ACC.global.wWidth < 1024){
					targetCheck.find("path").attr("fill", "#78a22f");
				}
			}
			else {
				productItemNumbers = productItemNumbers.concat(productItemNumber + "|" + qtyItem + "|" + uomId);
				productItemNumbers = productItemNumbers.concat(" ");
				if (!xList.includes(selectedProdList)) {
					xList.push(selectedProdList);
				}
				productCodes = productCodes.concat(productCode + "|" + qty + "|" + uomId);
				productCodes = productCodes.concat(" ");
				if($(".page-detailsSavedListPage").length && ACC.global.wWidth < 1024){
					targetCheck.find("path").attr("fill", "#fff");
				}
			}
			//console.log(productItemNumbers, ' | ', "xList:-:" , xList , ' | ',productCodes);
			if (!ACC.savedlist.productCheckboxAllClicked || (ACC.savedlist.productCheckboxAllClicked && itemTotalCount == ACC.savedlist.productCheckboxAllClicked)) {
				ACC.savedlist.listItemCheckStatus();
			}
			if(ACC.savedlist.productCheckboxAllClicked){
				ACC.savedlist.productCheckboxAllClicked++;
			}
			ACC.savedlist.checkingAddListToCart(e);
		});
		
		$(document).on("click", ".SavedSelectedProduct", function(e){
			if(!$(e.target).hasClass("disabled")){
				var products = [];
				products.push({
							productInfo: {
								"productID": productCodes,
								"addToCartLocation": _AAData.eventType,
							}
				});
				digitalData.eventData = {
									"linktype" : "",
									"linkName" : "Add to Cart",
									"onClickPageName" : _AAData.eventType
							}
				if($(".nav-cart .js-mini-cart-count .nav-items-total:visible").text().trim() === "0" )
					{ 
						digitalData.cart = {
								cartId:  $("#currentCartId").val(),	
								event :  "scOpen, scAdd",
						};
					}

				else
					{
						digitalData.cart = {
								cartId:  $("#currentCartId").val(),
								event :  "scAdd",
						};	
					}

				digitalData.product = products;
				digitalData.listName = $('.list-headline').text();
				try {
						_satellite.track('Add Cart');
					} catch (e) {}
					
				var wishListCode = $("#listCodeQtyChange").val(); 
				var pcodes = "";
				$.each(xList, function(index, value){
					var prodcutDetail=value.split('~');
					if(prodcutDetail.length>1){
						var uom=prodcutDetail[3];
						if(uom==='undefined'){
							uom='';
						}
						pcodes=pcodes+prodcutDetail[0]+"|"+prodcutDetail[2]+"|"+uom+" ";
					}		
				});
				pcodes = (pcodes || '').trim();
				loading.start();
				$.ajax({
					type: 'POST',
					url: ACC.config.encodedContextPath+"/savedList/addSelectedItemsToCart",
					dataType: "json",
					data: {
						wishListCode: wishListCode,
						productCodes: pcodes,
					},
					success: function(result) {
						if(result){
							ACC.savedlist.savedListSessionStorage("remove");
							window.location.href = ACC.config.encodedContextPath +"/cart";
						}else {
							var selectedProducts = $.grep(xList, function(x){
								return (x || '').length;
							});
							
							ACC.savedlist.savedListSessionStorage("set", selectedProducts.join(" "));
							window.location.href = ACC.config.encodedContextPath +"/savedList/listDetails?code="+wishListCode;
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
						loading.stop();
						//console.log('data failure');
					}
				});
			}
	  	});
		
		 $(document).on("click", ".remove_selected_filter", function(e){
			if(!$(e.target).hasClass("disabled")){
				e.preventDefault();
				var currentWishlist= $("#listCodeQtyChange").val();
				$.ajax({
					type: 'POST',
					url: ACC.config.encodedContextPath+"/savedList/RemoveSelectedFromSavedList",
					dataType: "json",
					data: {
					wishListCode: currentWishlist,
					productItemNumbers: productItemNumbers
					},
					success: function(result) {
							digitalData={
    					 			event: 'delete product from list',
    							    item: productCodes,
    								listName: $('.list-headline').text()
    						    }
							try{
									_satellite.track('deleteProductFromList');
						       }  
							catch(e){} 
							window.location.href = ACC.config.encodedContextPath +"/savedList/listDetails?code="+currentWishlist;
							$(".delete_entireList_msg").show();
					},
					error: function(xhr, ajaxOptions, thrownError) {
						//console.log('data failure');
							}
						});
				return false;
			}
		});
		
	
	
	/* Dropdown list click function*/
	 
	 $(document).on("click", ".listname", function(e){ 
			e.preventDefault();
			var currentWishlist= $("#listCodeQtyChange").val();
			var listcodeqtyChangeval= $(this).attr("id");
			var productID = $(".saveList").val().trim().split(" ");
    		digitalData={
    					 	event: 'add product to list',
    						item: productID,
    						listName: $(this)[0].outerText     
    					}				
    		try {
    					_satellite.track('productAddedToList');
    			}catch(e){}
			$.ajax({
	             type: 'POST',
	             url: ACC.config.encodedContextPath+"/savedList/addSelectedToSavedWishlist",
	             dataType: "json",
	             data: {
	           	  wishListCode: listcodeqtyChangeval,
	           	  productItemNumbers: productItemNumbers,
	           	  currentWishlist: currentWishlist
	             },
	             success: function(result){
		              ACC.colorbox.open("", {
	 	                    html: ACC.productDetail.popupHtmlExistingList(ACC.config.listaddedMsg,listcodeqtyChangeval),
	 	                    width: "500px",
	 	                    onComplete: function(){
	 	                        $('#colorbox').removeClass('add-to-list-box');
	 	                        $('#colorbox').addClass('item-add-list-box');
	 	                        $(document).on("click",".successListCreation", function(e){
	 	                            ACC.colorbox.close();
	 	                        });
	 	                      
	 	                    },
	 	                    onClosed: function() {
	 	                        $('#colorbox').removeClass('item-add-list-box');
	 	                        $('body').css("overflow-y","auto");
	 	                       window.location.href = ACC.config.encodedContextPath +"/savedList/listDetails?code="+currentWishlist;
	 	                    } 
	 	                });   
	             },
	             
	             error: function(xhr, ajaxOptions, thrownError) {
	                //console.log('data failure');
	             }
	         });
        return false;
	 });  

	/* Create new list function*/

	 $(document).on('click', '#createWishlistforentireList', function(event) {
 	        var wishListName = $("#newWishListName").val();
 	        var currentWishlist= $("#listCodeQtyChange").val();
 	        var tmpproductCodes = (productCodes || "").trim().replace(/ +/g, ' ');
	        
 	        if (wishListName == "") {           
 	             $("#empty_listName").show();
 	            $('.entirelist-name-alreadyexits-error').hide();
 	        } else {
 	            $("#empty_listName").hide();
 	        $.ajax({
 	            type: 'POST',
 	            url: ACC.config.encodedContextPath + "/savedList/addSelectedToNewWishlist",
 	            dataType: "json",
 	            data: {
 	            	wishListName:wishListName,
 	            	productCodes: tmpproductCodes,
 	            	currentWishlist: currentWishlist
 	            },
 	            success: function(result) {
 	                var productID = $(".saveList").val().trim().split(" ");
    				digitalData={
    					 			event: 'create list',
    								item: productID,
    								listName: wishListName   
    							}
					try{
						_satellite.track('listCreated')
					   }
					catch(e){}
 	            	$('.entirelist-name-alreadyexits-error').hide();
 	            	if (result != "Listname exists"){
	 	                ACC.colorbox.open("", {
	 	                    html:ACC.productDetail.popupHtmlCreateNewList(ACC.config.listCreatedMsg,result),
	 	                    width: "500px",
	 	                    onComplete: function(){
	 	                        $('#colorbox').removeClass('add-to-list-box');
	 	                        $('#colorbox').addClass('item-add-list-box');
	 	                        $(document).on("click",".successListCreation", function(e){
	 	                            ACC.colorbox.close();
	 	                        });
	 	                    },
	 	                    onClosed: function() {
	 	                        $('#colorbox').removeClass('item-add-list-box');
	 	                        $('body').css("overflow-y","auto");
	 	                       window.location.href = ACC.config.encodedContextPath +"/savedList/listDetails?code="+currentWishlist;
	 	                    } 
	 	                });
 	            	}
	            	else{
	            		$('.entirelist-name-alreadyexits-error').show();
	            		 $("#empty_listName").hide();
	            	}
 	            },
 	            error: function(xhr, ajaxOptions, thrownError) {
 	                //console.log('data failure');
 	            }
 	        });
 	        return false;
 	        }
 	    });
/*create a new list in Item Level*/
	    $(document).on('click', '#createWishlistforentireList_il', function(event) {
	    	
	        var wishListName = $(this).parent().parent().parent().find('#newWishListName_il').val()
	        var currentWishlist= $("#listCodeQtyChange").val();
	        var createitemlevel_prodCode=$(this).siblings('#createitemlevel-productcode').val();
	        var createitemlevel_qty=$(this).siblings('#createitemlevel-qty').val();
	        var createitemlevel_productCodes=createitemlevel_prodCode+"|"+createitemlevel_qty+"|";
	        //console.log("createitemlevel-productCodes:",createitemlevel_productCodes);
	         
	        if (wishListName == "") {           
	        	$(this).parent().parent().parent().parent().find('#empty_listName_il').show();
	        	$('.listName-alreadyexits-error').hide();
	        } 
	        else {
	        	$(this).parent().parent().parent().parent().find('#empty_listName_il').hide();
	        }
	        $.ajax({
	            type: 'POST',
	            url: ACC.config.encodedContextPath + "/savedList/addSingleProductToNewWishlist",
	            dataType: "json",
	            data: {
	            	wishListName:wishListName,
	            	productCodes:createitemlevel_productCodes,
	            	currentWishlist: currentWishlist,
	            },

	            success: function(result) {
	            	if (result != "Listname exists"){
	            		$('.listName-alreadyexits-error').hide();
 	                ACC.colorbox.open("", {
 	                    html:ACC.productDetail.popupHtmlCreateNewList(ACC.config.listCreatedMsg,result),
 	                    width: "500px",
 	                    onComplete: function(){
 	                        $('#colorbox').removeClass('add-to-list-box');
 	                        $('#colorbox').addClass('item-add-list-box');
 	                        $(document).on("click",".successListCreation", function(e){
 	                            ACC.colorbox.close();
 	                        });
 	                    },
 	                    onClosed: function() {
 	                        $('#colorbox').removeClass('item-add-list-box');
 	                        $('body').css("overflow-y","auto");
 	                       window.location.href = ACC.config.encodedContextPath +"/savedList/listDetails?code="+currentWishlist;
 	                    }
 	                });
	            	}
	            	else{
	            		$('.listName-alreadyexits-error').show();
	            		$('#empty_listName_il').hide();
	            	}
	            	digitalData={
    					 			event: 'create list',
    								item: createitemlevel_prodCode,
    								listName:wishListName
    							}
					try{
									_satellite.track('listCreated')
						}
					catch(e){}
	            },
	            error: function(xhr, ajaxOptions, thrownError) {
	                //console.log('data failure');
	            }
	        });
	        return false;      
	   });
	},
	disableEnableButon: function(ref, disable){
		if(disable){
			ref.addClass("disabled").attr("disabled","disabled");
		}
		else{
			ref.removeClass("disabled").removeAttr("disabled","disabled");
		}
	},
	bindEnableList:function()
	{
		let addListToCartsDisable;
		$(".saved-list-sec").each(function(){
			let target = $(this);
			if(target.data("nontransferableflag") && target.find("#showAddtoCart").length){
				ACC.savedlist.disableEnableButon(target.find("#showAddtoCart"), true);
				addListToCartsDisable = true;
			}
		});
		if(addListToCartsDisable){
			$(".addListToCarts_filter").attr("disabled", "disabled");
		}

		if($("#notSellable").length>0 || $(".js-enable-btn").is(':disabled')>0 )
			{
			$(".addlistCartlink").addClass("disabled");
			$(".addlistCartlink2").addClass("disabled");
			$(".addAssemblyToCartLink").addClass("disabled");
			$(".addAssemblyListToCartLink").addClass("disabled");
			}
		else
			{
			$(".addlistCartlink").removeClass("disabled");
			$(".addlistCartlink2").removeClass("disabled");
			$(".addAssemblyToCartLink").addClass("disabled");
			$(".addAssemblyListToCartLink").removeClass("disabled");
			}
	},
	
	bindEntireList:function()
	{

		$(".quantityInputSection .qtyChanged").on("change", function(e){
			var qty=$(this).val();
			var productId=$(this).attr("data-role").split("_")[1];	
			var productList =$(".saveList").val().trim().split(" ");
			
			for(var i=0; i< productList.length; i++){
				var product= productList[i].split("|")[0];
				if(product == productId){
					productList[i]=productId+"|"+qty;
					break;
				}
			}
			$(".saveList").val(productList.join(" "));
			$(".productList").val(productList.join(" "));
			$(".productCodes").val(productList.join(" "));
		});
		
		$(document.body).on('click','.addAssemblyListToCartLink',function(event){
			event.preventDefault();
			var assemblyCount = $(".js-assembly-qty").val();
			$(this).attr("href",$(this).attr("href")+$("#listCodeQtyChange").val()+'&assemblyCount='+assemblyCount);
			var products = [];
			cartLocation(_AAData.eventType);
			function cartLocation(addToCartLocation){
        	$(ACC.savedlist.$productCodeField).each(function() {
        		var productID = $(this).val();
        	    var qty = Number($(this).val());
        	    if (qty > 0) {
        	        products.push({
        	            productInfo: {
        	                "productID": productID,
        	                "addToCartLocation": addToCartLocation
        	            }
        	        });

	        	  if($(".nav-cart .js-mini-cart-count .nav-items-total:visible").text().trim() === "0" )
	        	  { 
	        		  digitalData.cart = {
		        		event :  "scOpen, scAdd",
	        		  };
	        	  }	 
	        	  else
	        	  {
	        		  digitalData.cart = {
	        			event :  "scAdd",
	        		  };	
	        	  }
        	    }
           });

           digitalData.product = products;

           try {
        		 _satellite.track("Add Cart");
        	 } catch (e) {}
		   }    
           window.location.href = $(this).attr('href');         
		});
		
		$(document).on("click","#deleteList", function(e){
    					 	digitalData={
    					 				   event: "delete list",
    									   listName: $(this).parent().parent().parent().find('.list-name')[0].innerText
    									}
    						try {
    									_satellite.track("listDeleted");
    							}catch(e){}
	 	 });
		


		
		$(document.body).on('click','.addListToCarts_filter',function(event){
			event.preventDefault();
			if ($(this).attr("disabled") != "disabled") {
			var assemblyCount = $(".js-assembly-qty").val();
			$(this).attr("href",$(this).attr("href")+$("#listCodeQtyChange").val());
			var products = [];
			cartLocation(_AAData.eventType);
			function cartLocation(addToCartLocation){
        		products.push({
        	       productInfo: {
        	                "productID": productCodes,
        	                "addToCartLocation": addToCartLocation,       	                     	           
        	            }
        	   });
        	  digitalData.eventData = {
        	        			 "linktype" : "",
        	        			 "linkName" : "Add to Cart",
        	        			 "onClickPageName" : addToCartLocation
        	      		 }
        	  if($(".nav-cart .js-mini-cart-count .nav-items-total:visible").text().trim() === "0" )
	        	{ 
	        		digitalData.cart = {
	        				cartId:  $("#currentCartId").val(),	
	        				event :  "scOpen, scAdd"
	            	};
	        	}
        	  else
	        	{
	        		digitalData.cart = {
	        				cartId:  $("#currentCartId").val(),	
	            			event :  "scAdd"
	           	    };	
	            }
        	 digitalData.product = products;
        	 digitalData.listName = $('.list-headline').text();
        	 try {
            	    _satellite.track("addListToCart");
            	} catch (e) {}
            }
            window.location.href = $(this).attr('href');
			}
		});
		
		$(document.body).on('click','.clearQuantitieslink',function(event){
			event.preventDefault();
			var url= ACC.config.encodedContextPath +"/savedList/clearQuantities?wishListCode="+$("#listCodeQtyChange").val();
			window.location.href = url;
		});
		
	},
	
	bindPagination:function(){
		
		var viewpagination =$("#pageSizeSavedListDetail1").val();
	
		$.each($(".savedlistdetails-pagination .pagination li a"), function(i, aTag){
			$(aTag).prop('href',$(aTag).prop('href')+"&pagesize="+viewpagination);
		});
	
	},
	
		printListPage:function() {
			$(document.body).on('click','.print-list',function(e){
				e.preventDefault();
				 digitalData.eventData={
						 shareMedium:"Print",
						}
				 try {
						_satellite.track("printList");
					}catch(e){}
		 		$(".showPrint").css("display","block");
		 		let now = new Date().toString().split(" ");
		 		document.getElementById("printedTime").innerHTML = now[1] + " " + now[2] + ", " + now[3];
		 		window.print();
			});
	 	},
	
	 	movedEntireList:function(){
	 			$(".moveEntireSaveList_list").on('click',function (){
					if(!$('.moveselected_list_filter').hasClass("disabled")){
						if(screen.width<=700){
							$('.movedselectedtolist').removeClass('hidden');
							$("#cboxWrapper").css('overflow','initial');
							$("#cboxLoadedContent").css('margin-top','0px !important');
							ACC.colorbox.open("", {
								html: $(".movedselectedtolist").show(),
								width: "1200px",
								escKey: false,
								className:"list-mobileOption",
								overlayClose: false,
								onComplete: function(e) {
								   $(document).on("click",".icon-close", function(e){
									   window.location.reload(true);
								   });
								},
						   });
						}
						else{
							var state = $(this).data('state');
							var element = $(this).closest(".dropdown-entirelist").find(".movedselectedtolist");
							//console.log('State',state,'element',element);
							ACC.product.showMoreAndLess(this,state, element,"", "", 0);
							switch (state) {
								case "expand": {
								$('.moveselected_list_filter').css("background-color","#F1F2F2");
									break;
								}
								case "collapse": {
								$('.listName-alreadyexits-error').hide();
									$('#empty_listName_il').hide();
									$('.entirelist-name-alreadyexits-error').hide();
									$("#empty_listName").hide();
									$('.moveselected_list_filter').css("background-color","#FFFFFF");
									break;
								}
								case undefined: break;
							}
						}
					}
		        });
				$(document).on("click", function(e){
					let target = $(e.target);
					if(!target.hasClass("dropdown-movetolist") && !target.parents(".dropdown-movetolist").length){
						$('[onclick="ACC.savedlist.showMoveToListPopup(this,\'collapse\')"]').trigger("click");
					}
				});
			},
			showMoveToListPopup: function(ref, state) {
				let target = $(ref);
				let movetoListWrapper = target.next('.movetoList-wrapper');
				if (screen.width <= 700) {
				  $("#cboxWrapper").css('overflow', 'initial');
				  $("#cboxLoadedContent").css('margin-top', '0px !important');
				  ACC.colorbox.open("", {
					html: movetoListWrapper.show(),
					width: "1200px",
					escKey: false,
					className: "list-mobileOption",
					overlayClose: false,
					onComplete: function (e) {
					  $(document).on("click", ".icon-close", function (e) {
						window.location.reload(true);
					  });
					}
				  });
				}
				else {
				  //ACC.product.showMoreAndLess(ref, state, movetoListWrapper, "", "", 0);
				  if (state == "expand") {
					$('[onclick="ACC.savedlist.showMoveToListPopup(this,\'collapse\')"]').trigger("click");
					target.attr("onclick", "ACC.savedlist.showMoveToListPopup(this,'collapse')");
					target.find(".movetolist-angle").css({ transform: "rotate(180deg)" });
					movetoListWrapper.slideDown('hidden');
				  }
				  else {
					target.attr("onclick", "ACC.savedlist.showMoveToListPopup(this,'expand')");
					target.find(".movetolist-angle").css({ transform: "rotate(0deg)" });
					movetoListWrapper.slideUp('hidden');
				  }
				  $('.listName-alreadyexits-error').hide();
				  $('#empty_listName_il').hide();
				  $('.entirelist-name-alreadyexits-error').hide();
				  $("#empty_listName").hide();
				}
			},
	checkingAddListToCart: function(){
		if($(".page-detailsSavedListPage").length){	//checking Saved List Page
			let disabled = false;
			let ref = $(".add_to_cart_form");
			for(let i=0; i<ref.length; i++){
				if(ref.eq(i).find("#productSelect").children("button").is(":disabled")){
					disabled = true;
					break;
				}
				// Check if Request Quote button exists (by class)
				if (ref.find(".requestQuoteBtnPDP").length > 0) {
					disabled = true;
					break;
				}
			}
			let target = $(".addListToCart_filter_sec");
			if(disabled){
				target.addClass("addlisttocart-disabled");
				target.children(".addListToCarts_filter").attr("disabled", "disabled");
				target.children(".addListToCarts_filter").popover({ placement: 'top', trigger: 'hover', container: 'body' });
					target.children(".addListToCarts_filter").on('shown.bs.popover', function () {
						$(".popover").addClass("bg-danger");
					});
			}
			else{
				target.removeClass("addlisttocart-disabled");
				target.children(".addListToCarts_filter").removeAttr("disabled");
				target.children(".addListToCarts_filter").popover('destroy');
				if(ACC.savedlist.listPageCartLink && ACC.savedlist.listPageCartLink != ''){
					target.children(".addListToCarts_filter").attr("href", ACC.savedlist.listPageCartLink);
				}
			}
		}
	},
	setQtyIdDataVal: function (){
		$(".qtyId").each(function(e){
    		$(this).attr("data-val", $(this).val());
    	});
	},
	formatNumberComma: function(n) {
		return (Number(n) || 0).toLocaleString('en',{minimumFractionDigits: 2, maximumFractionDigits:2});
	},
	updatePrice: function($target, qtyEle) {
		var targetParent = $target.parents(".saved-list-sec");
		targetParent.find('#update_qty_list').text("Quantity Updated").fadeIn().fadeOut(1000);
    	var price = targetParent.find(".js-customer-price").val() || 0;
    	var quantity = targetParent.find(".qtyId").val();
    	var totalPrice = (Number(price).toFixed(2) * quantity).toFixed(2);
    	var totalPriceStr = targetParent.find(".tot-amt-list").html("$"+ ACC.savedlist.formatNumberComma(totalPrice));
    	var cumulativeTotPrice = Number($('.cumulative-tot-price').find("strong").text().replaceAll(/[$,]/g, '') || 0);
    	var prevquantity = Number(qtyEle.attr('data-val') || 0);
    	if(quantity > prevquantity){
    		var diffquantity = quantity - prevquantity;
    		var priceInc =  diffquantity * price;
    		cumulativeTotPrice += priceInc;
    	}else if(quantity < prevquantity){
    		var diffquantity = prevquantity - quantity;
    		var priceDec = diffquantity * price;
    		cumulativeTotPrice -= priceDec;
    	}
    	qtyEle.attr('data-val', quantity);
    	targetParent.find("#quantity").val(quantity);
    	var id = targetParent.find('.select_product_checkbox').attr('data-role');
    	var productCode = $('#prodCode'+id).val();
		$("#prodQty_"+productCode).val(quantity);
    	var productItemNumber = $('#prodItemNumber'+id).val();
		document.getElementById("prodQtyItem_" + productItemNumber).value = quantity;
    	$('.cumulative-tot-price, .cumulative-tot-price-print').find("strong").text("$" + ACC.savedlist.formatNumberComma(cumulativeTotPrice.toFixed(2)));
	},
	toggleErrorState: function (refParent, getInput, hasError) {
		var getStatus = getInput.siblings('.outofstockStatus').val();
		refParent.find('.intervalQtyError_list').toggleClass("hidden", !hasError);
		refParent.find(".list-item-qty").toggleClass("border-red", hasError);
		if (!getStatus) {
			refParent.find('#productSelect button').attr("disabled", hasError ? "disabled" : null);
		}
		getInput.toggleClass("qtyBoxError", hasError);
	},
	checkMinQuantityPageload: true,
	checkMinQuantityList: function (element, curstatus) {
		var intervalQTYRestrict = true;
		if (ACC.savedlist.checkMinQuantityPageload && ($(".intervalQtyInfo_list").length || $(".minOrderQtyInfo_list").length)) {
			var leng = $('.product__list .saved-list-singleProduct').length;
			for (var i = 0; i < leng; i++) {
				var refParent = $('.product__list .saved-list-singleProduct').eq(i);
				var getInput = refParent.find('.quantity_updated');
				var refIntervalQtyInfo = refParent.find('.intervalQtyInfo_list');
				var refMinOrderQtyInfo = refParent.find('.minOrderQtyInfo_list');
				if (refIntervalQtyInfo.length || refMinOrderQtyInfo.length) {
					if (refParent.find('.js-uom-selector').eq(0).length > 0) {
						if (Number(refParent.find('.js-uom-selector').eq(0).find(":selected").data("inventorymultiplier")) != 1) {
							intervalQTYRestrict = false;
							refIntervalQtyInfo.addClass("hidden");
							refMinOrderQtyInfo.addClass("hidden");
							ACC.savedlist.toggleErrorState(refParent, getInput, false);
						} else {
							if (getInput.data('min-qty') && getInput.data('min-qty') != "0" && getInput.data('min-qty') != "1" && getInput.data('min-qty') != '') {
								refIntervalQtyInfo.removeClass("hidden");
							}
							if (getInput.data('min-orderqty') && getInput.data('min-orderqty') != "0" && getInput.data('min-orderqty') != "1"
								&& getInput.data('min-orderqty') != '') {
								refMinOrderQtyInfo.removeClass("hidden");
							}
						}
					}
					if (intervalQTYRestrict) {
						if (refIntervalQtyInfo.is(':visible')) {
							var validateQtyInterval = (Number(getInput.val().trim()) % getInput.data('min-qty')) == 0 && getInput.val().trim() != '';
							ACC.savedlist.toggleErrorState(refParent, getInput, !validateQtyInterval);
						}
						if (refMinOrderQtyInfo.is(':visible')) {
							var minOrderQty = getInput.data('min-orderqty');
							if (minOrderQty && minOrderQty != "0" && minOrderQty != "1" && minOrderQty != '') {
								var validateMinOrderQty = Number(getInput.val().trim()) >= getInput.data('min-orderqty') && getInput.val().trim() != '';
								ACC.savedlist.toggleErrorState(refParent, getInput, !validateMinOrderQty);
							}
						}
					}
					intervalQTYRestrict = true;
				}
				ACC.savedlist.listQtyUpdate(getInput, "checkMinQuantityList if");
			}
		}
		else if (ACC.savedlist.checkMinQuantityPageload){
			var leng = $('.product__list .saved-list-singleProduct').length;
			for (var i = 0; i < leng; i++) {
				var refParent = $('.product__list .saved-list-singleProduct').eq(i);
				var getInput = refParent.find('.quantity_updated');
				ACC.savedlist.listQtyUpdate(getInput, "checkMinQuantityList else");
			}
		}
		ACC.savedlist.checkMinQuantityPageload = false;
		var getE = element;
		intervalQTYRestrict = true;
		if (curstatus) {
			getE = element.siblings(".js-update-entry-quantity-input");
		} else {
			getE = element;
		}
		var targetParent = getE.parents(".saved-list-sec");
		if (targetParent.find('.js-uom-selector').eq(0).length > 0) {
			if (Number(targetParent.find('.js-uom-selector').eq(0).find(":selected").data("inventorymultiplier")) != 1) {
				intervalQTYRestrict = false;
			}
		}
		if (intervalQTYRestrict) {
			if (getE.data('min-qty') && getE.data('min-qty') != "0" && getE.data('min-qty') != "1" && getE.data('min-qty') != '') {
				var validateQtyInterval = (Number(getE.val().trim()) % getE.data('min-qty')) == 0 && getE.val().trim() != '';
				ACC.savedlist.toggleErrorState(targetParent, getE, !validateQtyInterval);
			}
			if (getE.data('min-orderqty') && getE.data('min-orderqty') != "0" && getE.data('min-orderqty') != "1"
				&& getE.data('min-orderqty') != '') {
				var validateMinOrderQty = Number(getE.val().trim()) >= getE.data('min-orderqty') && getE.val().trim() != '';
				ACC.savedlist.toggleErrorState(targetParent, getE, !validateMinOrderQty);
			}
		}
		ACC.savedlist.listQtyUpdate(getE, "checkMinQuantityList all");
		ACC.savedlist.checkingAddListToCart();
	},
	  bindSaveListBeforeunload: function(){
		  if($('body').hasClass('page-detailsSavedListPage')){
			  $(window).bind("beforeunload", function(){
					var selectedProducts = $.grep(xList, function(x){
						return (x || '').length;
					});
					
					ACC.savedlist.savedListSessionStorage("set", selectedProducts.join(" "));
			  });
		  }
	  },
	  savedListSessionStorage: function(mode, data){
		  var sessionKey = "savedList_selectedProduct";
		  if(mode == "set"){
			  return sessionStorage.setItem(sessionKey, data);
		  }
		  
		  if(mode == "get"){
			  return sessionStorage.getItem(sessionKey);
		  }
		  
		  if(mode == "remove"){
			  return sessionStorage.removeItem(sessionKey);
		  }
	  },
	  deSelectAllList: function(ref){
		let target = $(ref);
		if(!target.hasClass("disabled")){
			if($('.select_product_checkbox_all').prop("checked")){
				$('.select_product_checkbox_all').trigger("click");
			}
			else{
				$(".saved-list-sec:visible .select_product_checkbox").each(function (index) {
					let ref = $(this);
					if (ref.prop("checked")) {
						ref.trigger("click");
					}
				});
			}
			$('.list-filters-row').toggle();
		}
	  },
	  selectAllList: function(ref){
		if(!$('.select_product_checkbox_all').prop("checked")){
			$('.select_product_checkbox_all').trigger("click");
		}
		else{
			$(".saved-list-sec:visible .select_product_checkbox").each(function (index) {
				let ref = $(this);
				if (!ref.prop("checked")) {
					ref.trigger("click");
				}
			});
		}
		$('.list-filters-row').toggle();
	  },
	  listItemCheckStatus: function(alreadySelected) {
		let enableATCFlag = true;
		let isAllChecked = true;
		let itemCounter = 0;
		$(".saved-list-sec:visible .select_product_checkbox").each(function (index) {
			let ref = $(this);
			let refParent = ref.parents(".saved-list-sec");
			if (alreadySelected && $.inArray(refParent.find(".productSelectionCode").val(), alreadySelected) != -1) { //onload pre select check
				ref.prop("checked", true);
				ref.parent().css('background', '#78a22f');
				refParent.css('border', '1px solid #79a22f');
			}
			if (ref.prop("checked")) {
				itemCounter++;
				if (refParent.find("#notSellable").length || refParent.find("#hideCSP").length || refParent.data("nontransferableflag") || refParent.data("outofstockimage")) {
					enableATCFlag = false;
				}
			}
			else {
				isAllChecked = false;
			}
		});
	
		if (itemCounter) {
			if (enableATCFlag) {
				$(".SavedSelectedProduct").removeClass("disabled");
				$(".SavedSelectedProduct2").removeClass("disabled");
				$(".list_addlisttocart_wrapper").removeClass("disabled");
			}
			else {
				$(".SavedSelectedProduct").addClass("disabled");
				$(".SavedSelectedProduct2").addClass("disabled");
				$(".list_addlisttocart_wrapper").addClass("disabled");
			}
			$(".remove_selected_filter").removeClass("disabled");
			$(".moveselected_list_filter").removeClass("disabled");
			$(".de_selected_filter").removeClass("disabled");
			$(".list-item-counter-text").removeClass("text-white hidden");
			$(".list-item-counter").html(itemCounter);
			$(".list-item-counter-s").html(itemCounter > 1 ? 's' : '');
			if (ACC.savedlist.isRecommendedListPage) {
				$(".recomDetailSelectedCopyListBtn").removeClass("hidden");
				$(".recomDetailCopyListBtn").addClass("hidden");
			}
		}
		else {
			$(".list-item-counter-text").addClass($(".page-detailsSavedListPage").length && ACC.global.wWidth < 1024 ? "text-white": "hidden");
			$(".SavedSelectedProduct").addClass("disabled");
			$(".SavedSelectedProduct2").addClass("disabled");
			$(".remove_selected_filter").addClass("disabled");
			$(".moveselected_list_filter").addClass("disabled");
			$(".list_addlisttocart_wrapper").addClass("disabled");
			$(".de_selected_filter").addClass("disabled");
			if (ACC.savedlist.isRecommendedListPage) {
				$(".recomDetailSelectedCopyListBtn").addClass("hidden");
				$(".recomDetailCopyListBtn").removeClass("hidden");
			}
		}
		if (isAllChecked) {
			$(".select_product_checkbox_all").prop("checked", true);
		}
		$(".movedselectedtolist").addClass("hidden");
		$('.moveselected_list_filter').css("background-color", "#FFFFFF");
	},
	//PLP changes for Request Quote Button Start.
	
	productsList: [],
	quoteParent: false,
	quoteCode: false,
	requestQuotePopupplp: function (e,parentClass, skuCode) {
		let productDescription= $(e).data("productDescription");
		ACC.savedlist.quoteParent = $(e).parents("." + parentClass);
		ACC.savedlist.quoteCode = skuCode;
		ACC.savedlist.productsList = [];
		ACC.colorbox.open("", {
			html: $(".request-quote-popupPLPPDP").html(),
			width: "903px",
			height: 'auto',
			className: "request-quote-overlay",
			onComplete: function (e) {
				$('.request-quote-overlay .items-scroll').css('height', 'auto');
				$('.request-quote-overlay .quote-jobstartdate').addClass('quote-jobstartdate-new');
				$('.request-quote-overlay .save-continue-btn').css('visibility', 'hidden');
				if(!$('.product-variant-table__values').is(':visible')){
					$('.request-quote-overlay .request-list-title').html(productDescription);
				}else{
					$('.request-quote-overlay .request-list-title').html($('.variantproduct-name').val());
				}		
				$.colorbox.resize();
				$('.quote-jobstartdate-new').datepicker({ minDate: 0,  dateFormat: 'yy-mm-dd' });
				ACC.savedlist.getNearByStores();
			}
		});
	},
	requestQuoteOverlaySaveplp: function(e) {
		var is_valid = true;
		if ($('.request-quote-overlay .quote-jobname').val().trim() == "") {
			$('.request-quote-overlay .quote-jobname').parent().addClass('has-error');
			is_valid = false;
		}
		if ($('.request-quote-overlay .quote-jobstartdate').val().trim() == "") {
			$('.request-quote-overlay .quote-jobstartdate').parent().addClass('has-error');
			is_valid = false;
		}
		if (is_valid) {
			let formParent = $('.request-quote-overlay');
			ACC.savedlist.productsList = [];
			let branch = formParent.find(".quote-branch").find(":selected").html();
			let targetQty = $('.request-quote-overlay').find(".input-prod-qty").val();
			let targetPri, targetUom, targetCod, targetNum, targetDec;
			if (targetQty == '') {
				targetQty = 1;
			}
			if(!$('.product-variant-table__values').is(':visible')){
				targetNum = ACC.savedlist.quoteParent.find('#requestQuoteButtonItemnumber').val();
				targetDec = ACC.savedlist.quoteParent.find('#requestQuoteButtonDesc').val();
				if ($(".pdpRedesignuom-sticky .custom-dropdown-label").length) {
					if($(".multipleUomTable").length) {
						targetPri = ACC.savedlist.quoteParent.find('.quoteUom-CustomerPrice').val() == '' ? ACC.savedlist.quoteParent.find('.quoteUom-Price').val() : ACC.savedlist.quoteParent.find('.quoteUom-CustomerPrice').val();
						targetPri = Number(targetPri).toFixed(2);
						targetUom = ACC.savedlist.quoteParent.find('.quoteUom-Measure').val();
						targetCod = ACC.savedlist.quoteCode ? ACC.savedlist.quoteCode : ACC.savedlist.quoteParent.find('.quoteUom-code').val();
					} else {
						let target = $(".pdpRedesignuom-sticky .custom-dropdown-label").eq(0);
						let quoteMeasure = target.text().split('/');
						targetPri = quoteMeasure[0].split('$')[1];
						targetUom = quoteMeasure[1].split('[')[0];
						targetCod = target.data("code");
					}
				} else if (ACC.savedlist.quoteParent.find(".csp-price-format").length) {
					let quoteMeasure = ACC.savedlist.quoteParent.find(".csp-price-format");
					targetPri = quoteMeasure.find(".check_price").eq(0).text().split('$')[1];
					let uom = quoteMeasure.find(".check_price").eq(1).text();
					targetUom = uom.includes("/") ? uom.split('/')[1] : uom;
					if (ACC.savedlist.quoteParent.find(".card-variant-item").length) {
						let visibleCardVariantIem = ACC.savedlist.quoteParent.find(".card-variant-item:visible");
						targetPri = visibleCardVariantIem.find(".csp-price-format").find(".check_price").eq(0).text().split('$')[1];
						let cardVariantPriceUOM = visibleCardVariantIem.find(".csp-price-format").find(".check_price").eq(1).text();
						targetUom = cardVariantPriceUOM.includes("/") ? cardVariantPriceUOM.split('/')[1] : cardVariantPriceUOM;
					}
					targetCod = ACC.savedlist.quoteCode;
				} else {
					targetPri = ACC.savedlist.quoteParent.find('.quoteUom-CustomerPrice').val() == '' ? ACC.savedlist.quoteParent.find('.quoteUom-Price').val() : ACC.savedlist.quoteParent.find('.quoteUom-CustomerPrice').val();
					targetPri = Number(targetPri).toFixed(2);
					targetUom = ACC.savedlist.quoteParent.find('.quoteUom-Measure').val();
					targetCod = ACC.savedlist.quoteCode ? ACC.savedlist.quoteCode : ACC.savedlist.quoteParent.find('.quoteUom-code').val();
				}
			} else {				
					targetPri = ACC.savedlist.quoteParent.find('.trackCSP').val() == '' ? ACC.savedlist.quoteParent.find('.trackRetailPrice').val() : ACC.savedlist.quoteParent.find('.trackCSP').val();
					targetPri = Number(targetPri).toFixed(2);
					targetUom = ACC.savedlist.quoteParent.find('.quoteUomMeasure').val();
		     		targetCod = ACC.savedlist.quoteParent.find('.trackProductCode').val();
					targetNum = $('.pdp-itemnumber').val();
					targetDec = $('.variantproduct-name').val();
			}			
			targetNum = !targetNum ? '' : targetNum;
			targetDec = !targetDec ? '' : targetDec;
			targetQty = !targetQty ? '1' : targetQty;
			targetPri = !targetPri || targetPri =='false' || targetPri == 'NaN' ? '0.00' :  $.trim(targetPri.replaceAll(',',''));
			targetUom = !targetUom || targetUom =='false' ? 'Each' : $.trim(targetUom);
			targetCod = !targetCod ? '' : targetCod;
			let testRow = targetNum + "^" + targetDec + "^" + targetQty + "^" + targetPri + "^" + targetUom + '^' + targetCod;
			ACC.savedlist.productsList.push(testRow);
			ACC.savedlist.productsList = ACC.savedlist.productsList.join("|");
			formParent.find(".requested-quote-num").html(targetQty);
			formParent.find(".requested-quote-branch").html(branch);
			formParent.find(".request-quote-step2").removeClass('hidden');
			formParent.find(".request-quote-step1").addClass('hidden');
			$.colorbox.resize();
		}
	},
	requestQuoteOverlayFormSubmitplp: function(e) {
		if(!$(e).hasClass("disabled")){
			$(e).addClass("disabled");
			let formParent = $('.request-quote-overlay');
			let jobName = formParent.find(".quote-jobname").val();
			let jobStartDate = formParent.find(".quote-jobstartdate").val();
			let branch = formParent.find(".quote-branch").val();
			let jobDescription = formParent.find(".quote-jobdescription").val();
			let PagenamePLP = $(".pagename").val();
			let notes = $.trim(formParent.find(".quote-notes").val().replace(/\n/g," ").replaceAll("|","-"));
			let quoteData = { jobName: jobName, jobStartDate: jobStartDate, branch: branch, jobDescription: jobDescription, notes: notes, selectedProductList: ACC.savedlist.productsList,productsList:''};
			$.ajax({
				url: ACC.config.encodedContextPath + '/my-account/requestQuote',
				method: "POST",
				datatype: "json",
				data: quoteData,
				success: function (data) {
					if(data.toLowerCase() == "success"){
						ACC.colorbox.close();
					}
					else{
						ACC.savedlist.quotePopupError(1000, 'close');
						ACC.pendo.captureEvent("REQUESTQUOTEFAIL", {'listCode':listCode});
					}
				},
				error: function () {
					ACC.savedlist.quotePopupError(1000, 'close');
					ACC.pendo.captureEvent("REQUESTQUOTEFAIL", {'listCode':listCode});
				}
			});
			ACC.adobelinktracking.requestQuotePLP(e,'','Save and Continue: Submit',PagenamePLP+': request a quote popup: submit','');
		
			}
	},
	//PLP changes for Request Quote Button End.

	requestQuoteListNum: "",
	requestQuoteListLength: 0,
	productsList: [],
	requestQuotePopup: function(e, listId, num) {
		let listTitle = $(e).data("listtitle");
		ACC.savedlist.requestQuoteListNum = listId;
		ACC.savedlist.requestQuoteListLength = Number(num);
		ACC.savedlist.productsList = [];
		ACC.colorbox.open("", {
			html: $(".request-quote-popup").html(),
			width: "903px",
			height: 'auto',
			className: "request-quote-overlay",
			onComplete: function (e) {
				$('.request-quote-overlay .items-scroll').css('height', 'auto');
				$('.request-quote-overlay .quote-jobstartdate').addClass('quote-jobstartdate-new');
				$('.request-quote-overlay .save-continue-btn').css('visibility', 'hidden');
				$('.request-quote-overlay .request-list-title').html(listTitle);
				$('.quote-jobstartdate-new').datepicker({ minDate: 0,  dateFormat: 'yy-mm-dd' });
				ACC.savedlist.getNearByStores();
				$(".request-quote-overlay .js-script-input-event-bind").each(function(){
					$(this).on({ "keydown": ACC.global.scriptInputKeyDown, "keyup": ACC.global.scriptInputKeyUp, "paste": ACC.global.scriptInputPaste, "blur": ACC.global.scriptInputBlur });
				});
			}
		});
	},
	generateLabelSheetPopup: function () {
		let checkItemStatus = $("span.list-item-counter-text").hasClass("hidden");
		if (checkItemStatus) {
			$("#generateLabelSheetcount").html(
				"[" + $(".list-page-counter").html() + "]"
			);
		} else {
			$("#generateLabelSheetcount").html(
				"[" + $(".list-item-counter").html() + "]"
			);
		};
		ACC.colorbox.open("", {
		html: $(".generate-label-popup").html(),
		width: "803px",
		
		className: "generate-label-overlay",
			onComplete: function (e) {
				$(document).on("click", ".close-generatelabel-btn", function (e) {
					e.preventDefault();
					ACC.colorbox.close();
				});
			},
		});
  	},
	generatelabelImageandText: function (el) {
		var value = el.value; 
		var visibleIds = ['previewTexts' + value, 'labelPreview' + value];
		if (value === '10') {
			visibleIds.push('extraInfo10');
		}
		$('.generate-preview-text, .label-preview-container').each(function () {
			var $element = $(this);
			var elementId = $element.attr('id');
			if (visibleIds.includes(elementId)) {
				$element.addClass('visible');
			} else {
				$element.removeClass('visible');
			}
		});
	},
	getGenerateLabels: function() {
		let checkItemStatus = $("span.list-item-counter-text").hasClass("hidden");
		$(".generatelabel-btn").attr('disabled', true);
		let checkedItems = [];
		$("input[name='selectedItems']:checked").each(function () {
			checkedItems.push($(this).val());
		});
		
		var href= ACC.config.encodedContextPath + "/savedList/getListQrPdf";
		let selectedItems = checkedItems.length === 0 ? '""' : checkedItems.join(",");
		let  label = $("input[name='label']:checked").val();
		
		if (checkItemStatus) {
			let wishListCode = $("#wishListListName").val().toString();
			href=href+'?selectedItems='+ selectedItems +'&label='+label+'&wishListCode='+wishListCode;
		} else {
			var checkedProductIds = [];
			$(".select_product_checkbox:checked").each(function () {
				checkedProductIds.push($(this).data("listcod"));
			});
			let productCode = checkedProductIds.join(",");
			href=href+'?selectedItems='+ selectedItems +'&label='+label+'&productCode='+productCode;
		}
		var $download = $("<a>")
        .attr("href", href);
		$download[0].click();
		ACC.colorbox.close();
	},
	getNearByStores: function() {
		$.ajax({
			url: ACC.config.encodedContextPath + '/store-finder/stores',
			method: "GET",
			datatype: "json",
			data: { "miles": 100, "latitude": $('.latitude_val').val(), "longitude": $('.longitude_val').val() },
			success: function (data) {
				var responseData = JSON.parse(data);
				if (responseData) {
					let target = $(".request-quote-overlay .quote-branch");
					if (responseData['nearBy']) {
						target.html('<option value="' + target.data("defaultstoreid") + '">' + target.data("defaultstorename") + '</option>');
						for (let i = 0; i < responseData['nearBy']['data'].length; i++) {
							target.append('<option value="' + responseData['nearBy']['data'][i].storeId + '">' + responseData['nearBy']['data'][i].town + " #" + responseData['nearBy']['data'][i].storeId + '</option>');
							if (i == 7) {
								break;
							}
						}
						target.prop('selectedIndex', 0);
						$('.request-quote-overlay .save-continue-btn').css('visibility', 'visible');
					}
					else {
						target.html('<option value="' + target.data("defaultstoreid") + '">' + target.data("defaultstorename") + '</option>');
						target.prop("disabled", "disabled");
						target.css({ background: "#fff", opacity: 1 });
						target.addClass('text-default');
						$('.request-quote-overlay .save-continue-btn').css('visibility', 'visible');
					}
				}
				else {
					ACC.savedlist.quotePopupError(1000, 'close');
				}
			},
			error: function () {
				ACC.savedlist.quotePopupError(1000, 'close');
			}
		});
	},
	requestQuoteInputDesc: function(e) {
		let target = $(e);
		if (target.val().length) {
			target.parents('.input-container').find('.add-row-product').removeClass('disabled');
		}
		else {
			target.parents('.input-container').find('.add-row-product').addClass('disabled');
		}
	},
	listAddRowProduct: function(e) {
		let target = $(e);
		let targetParent = target.parents(".input-container");
		let inputDesc = targetParent.find(".input-prod-des").val();
		let inputQty = targetParent.find(".input-prod-qty").val();
		if (target.hasClass("btn-gray")) {
			targetParent.slideUp(function () {
				$(this).remove();
			});
		}
		else if (!target.hasClass("btn-gray") && !inputDesc == "") {
			target.addClass("btn-gray").removeClass("btn-default").html("<i class='glyphicon glyphicon-ok'></i>");
			targetParent.find(".input-prod-qty").val(inputQty == "" ? 1 : inputQty);
			let refHTML = '<div class="row form-group m-b-5 items-container input-container"><div class="col-md-5 col-xs-11 p-r-0"><input type="text" name="productDescription" onkeyup="ACC.savedlist.requestQuoteInputDesc(this)" class="form-control input-prod-des js-script-input-event-bind" maxlength="900" placeholder="Product Description" /></div><div class="col-md-4 col-xs-5 ipt-itemno"><input type="text" name="itemNumber" class="form-control b-t-0-xs b-r-0-xs input-prod-num js-script-input-event-bind" maxlength="25" placeholder="Item #" /></div><div class="col-md-1 col-xs-3 padding0"><input type="text" name="qty" class="form-control b-t-0-xs input-prod-qty js-script-input-event-bind" onkeyup="if(/\D/g.test(this.value)) this.value=this.value.replace(/\D/g,\'\')" placeholder="Qty" /></div><div class="col-md-2 col-xs-3 pad-lft-10 p-l-0-xs p-r-0-xs"><div class="btn btn-default btn-block bold-text add-row-product disabled" onclick="ACC.savedlist.listAddRowProduct(this)">Add</div></div></div>';
			$(refHTML).insertAfter(targetParent);
			$(".request-quote-overlay .js-script-input-event-bind").each(function(){
				$(this).on({ "keydown": ACC.global.scriptInputKeyDown, "keyup": ACC.global.scriptInputKeyUp, "paste": ACC.global.scriptInputPaste, "blur": ACC.global.scriptInputBlur });
			});
			$('.request-quote-overlay .items-scroll').scrollTop($('.request-quote-overlay .items-scroll').height());
			setTimeout(function () {
				target.html('<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M7.76107 6.19202L10.8882 3.06488C11.0725 2.88055 11.176 2.63057 11.176 2.36992C11.176 2.10926 11.0725 1.85928 10.8882 1.67495L10.1929 0.979594C10.0085 0.795302 9.75855 0.691772 9.49789 0.691772C9.23724 0.691772 8.98726 0.795302 8.80293 0.979594L5.67579 4.10674L2.54864 0.979594C2.36432 0.795302 2.11433 0.691772 1.85368 0.691772C1.59303 0.691772 1.34305 0.795302 1.15872 0.979594L0.463359 1.67495C0.279068 1.85928 0.175537 2.10926 0.175537 2.36992C0.175537 2.63057 0.279068 2.88055 0.463359 3.06488L3.5905 6.19202L0.463359 9.31917C0.279068 9.5035 0.175537 9.75348 0.175537 10.0141C0.175537 10.2748 0.279068 10.5248 0.463359 10.7091L1.15872 11.4045C1.34305 11.5887 1.59303 11.6923 1.85368 11.6923C2.11433 11.6923 2.36432 11.5887 2.54864 11.4045L5.67579 8.27731L8.80293 11.4045C8.98726 11.5887 9.23724 11.6923 9.49789 11.6923C9.75855 11.6923 10.0085 11.5887 10.1929 11.4045L10.8882 10.7091C11.0725 10.5248 11.176 10.2748 11.176 10.0141C11.176 9.75348 11.0725 9.5035 10.8882 9.31917L7.76107 6.19202Z" fill="#78A22F"/></svg>');
			}, 2000);
		}
	},
	requestInputReset: function(e) {
		let target = $(e);
		if (target.val() != "") {
			target.parent('.has-error').removeClass('has-error');
		}
	},
	//Products added via input form
	inputFormProductList:[],
	requestQuoteOverlaySave: function(e) {
		var is_valid = true;
		if ($('.request-quote-overlay .quote-jobname').val().trim() == "") {
			$('.request-quote-overlay .quote-jobname').parent().addClass('has-error');
			is_valid = false;
		}
		if ($('.request-quote-overlay .quote-jobstartdate').val().trim() == "") {
			$('.request-quote-overlay .quote-jobstartdate').parent().addClass('has-error');
			is_valid = false;
		}
		if (is_valid) {
			let formParent = $('.request-quote-overlay');
			ACC.savedlist.productsList = [];
			ACC.savedlist.inputFormProductList = [];
			let listItems = $(".select_product_checkbox:checked");
			let listLength;
			let branch = formParent.find(".quote-branch").find(":selected").html();
			formParent.find(".input-container").each(function () {
				let target = $(this);
				let targetNum = target.find(".input-prod-num").val().trim().substring(0, 25);
				let targetDec = target.find(".input-prod-des").val();
				let targetQty = target.find(".input-prod-qty").val();
				let testRow = targetNum + "^" + targetDec + "^" + targetQty;
				if (targetDec != "") {
					ACC.savedlist.inputFormProductList.push(testRow);
				}
			});
			ACC.savedlist.inputFormProductList = ACC.savedlist.inputFormProductList.join('|')
			listLength = ACC.savedlist.requestQuoteListLength + ACC.savedlist.productsList.length;
			if (listItems.length) {
				listCode = "";
				listItems.each(function () {
					let target = $(this);
					let targetParent = target.parents(".saved-list-sec").find(".print-row-price");
					let targetCod = target.data("listcod");
					let targetNum = target.data("listnum");
					let targetDec = target.data("listdes");
					let targetQty = target.data("listqty");
					let targetPri = Number(targetParent.data("customerprice") != '' ?targetParent.data("customerprice"):0).toFixed(2);
					let targetUom = targetParent.data("uom");
					let testRow = targetNum + "^" + targetDec + "^" + targetQty + "^" + targetPri + '^' + targetUom + '^' + targetCod;
					ACC.savedlist.productsList.push(testRow);
				});
				listLength = ACC.savedlist.productsList.length;
			}
			ACC.savedlist.productsList = ACC.savedlist.productsList.join("|");
			formParent.find(".requested-quote-num").html(listLength);
			formParent.find(".requested-quote-branch").html(branch);
			formParent.find(".request-quote-step2").removeClass('hidden');
			formParent.find(".request-quote-step1").addClass('hidden');
			$.colorbox.resize();
		}
	},
	requestQuoteOverlayFormSubmit: function(e) {
		if(!$(e).hasClass("disabled")){
			$(e).addClass("disabled");
			let formParent = $('.request-quote-overlay');
			let jobName = formParent.find(".quote-jobname").val().trim().substring(0, 100);
			let jobStartDate = formParent.find(".quote-jobstartdate").val();
			let branch = formParent.find(".quote-branch").val();
			let jobDescription = formParent.find(".quote-jobdescription").val();
			let notes = $.trim(formParent.find(".quote-notes").val().replace(/\n/g," ").replaceAll("|","-"));
			let comment = $.trim(formParent.find(".quote-comment").val().replace(/\n/g," ").replaceAll("|","-"));
			let listCode = ($(".select_product_checkbox:checked").length) ? "" : ACC.savedlist.requestQuoteListNum;
			let quoteData = { jobName: jobName, jobStartDate: jobStartDate, branch: branch, jobDescription: jobDescription, notes: notes, comments: comment, productsList: ACC.savedlist.inputFormProductList , listCode: listCode, selectedProductList:ACC.savedlist.productsList};
			$.ajax({
				url: ACC.config.encodedContextPath + '/my-account/requestQuote',
				method: "POST",
				datatype: "json",
				data: quoteData,
				success: function (data) {
					if(data.toLowerCase() == "success"){
						ACC.colorbox.close();
					}
					else{
						ACC.savedlist.quotePopupError(1000, 'close');
						ACC.pendo.captureEvent("REQUESTQUOTEFAIL",{'listCode':listCode });
					}
				},
				error: function () {
					ACC.savedlist.quotePopupError(1000, 'close');
					ACC.pendo.captureEvent("REQUESTQUOTEFAIL",{'listCode':listCode });
				}
			});
			ACC.adobelinktracking.requestQuote(e,'','submit','my account : lists: request a quote popup');
		}
	},
	quotePopupError: function (num, close) {
		if(close){ACC.colorbox.close();}
		setTimeout(function () { 
			ACC.colorbox.open("", {
				html: "<div class='row'><div class='col-md-12 marginTopBVottom30'><p class='f-s-28 f-s-20-xs-px text-red font-Geogrotesque'>"+ ACC.config.requestQuotetext+ "</p><p class='f-s-28 f-s-20-xs-px text-default font-Geogrotesque m-t-35'>"+ACC.config.requestQuoteerrormesg+"</p></div></div>",
				width: "600px",
				className: "requestQuotePopupError text-center"
			});
		}, num);
	},
	listDelete: function(e, code) {
		let listName = $(e).data("listtitle");
		ACC.colorbox.open("", {
			html: '<div class="row text-center m-t-15"><div class="col-md-12 text-default text-center font-Geogrotesque f-s-28 f-s-18-xs-px m-b-15">' + ACC.config.listDeleteMsg + '<br>"' + listName + '?"</div><div class="col-md-3 col-md-offset-3 col-xs-6 col-xs-offset-0"><button class="btn btn-default btn-block" onclick="ACC.colorbox.close()">' + ACC.config.listCancel + '</button></div><div class="col-md-3 col-xs-6"><a class="btn btn-primary btn-block delete-list" href="' + ACC.config.encodedContextPath + '/savedList/deleteList?code=' + code + '">' + ACC.config.listDelete + '</a></div></div>',
			width: "600px",
			className: "requestQuotePopupError text-center"
		});
	},
	listShare: function(e, code) {
		let listName = $(e).data("listtitle");
		let target = $("#siteoneShareSavedListForm");
		target.find("#code").val(code);
		target.find("#listname").val(listName);
		target.find(".share-list-name").html(listName);
		$(".overlayBackground").fadeIn();
		if(ACC.global.wWidth < 1200){
			$(window).scrollTop(0);
		}
		$("#siteoneShareSavedListForm").fadeIn();
		if ($('.page-detailsSavedListPage').length > 0) {
			_AAData.popupPageName = ACC.config.sharelistpathingPageName;
			_AAData.popupChannel = ACC.config.myaccountpathingChannel;
			try {
				_satellite.track('popupView');
			} catch (e) { }
		}
	},
	filterCategory: ['agronomic', 'irrigation', 'landscape', 'lighting', 'nursery', 'tools', 'hardscapes'],
	filterPopupSelect: function (pEvent, type, group) {
		let ref = $(pEvent);
		let refStatus = ref.prop("checked");
		let target = $('[id^="filter-' + group + '-"]');
		if (type == "all" && !ACC.savedlist.isFilterPopupSelectAll) { //select All clicked
			for (let i = 0; i < target.length; i++) {
				if (target.eq(i).prop("checked") != refStatus) {
					target.eq(i).prop("checked", refStatus);
				}
			}
		}
		else if ($('[id^="filter-' + group + '-"]:checked').length == $('[id^="filter-' + group + '-"]').length) { //if all items checked
			ACC.savedlist.isFilterPopupSelectAll = true;
			$('#filter-' + group).prop("checked", true);
			ACC.savedlist.isFilterPopupSelectAll = false;
		}
		else if (!$('[id^="filter-' + group + '-"]:checked').length || (!refStatus && $('#filter-' + group).prop("checked"))) { //if all items unchekced
			ACC.savedlist.isFilterPopupSelectAll = true;
			$('#filter-' + group).prop("checked", false);
			ACC.savedlist.isFilterPopupSelectAll = false;
		}
	},
	listFilterUpdated: false,
	listFilterOptions: [],
	updateListFilter: function (pageload) { //checking for filter updates
		ACC.savedlist.listFilterUpdated = false;
		let newFilters = {
			search: "",
			brand: [],
			availability: "",
			agronomic: [],
			irrigation: [],
			landscape: [],
			lighting: [],
			nursery: [],
			tools: [],
			hardscapes: []
		};
		$("[data-listfilter]").each(function (e) {
			let target = $(this);
			let currentVal = target.prop("type") == 'text' ? target.val().toLowerCase() : target.prop("checked");
			if (pageload) {
				ACC.savedlist.listFilterOptions.push(currentVal);
			}
			if (currentVal === true || (target.prop("type") == 'text' && currentVal != "")) {
				let checkType = target.attr("id").split("-")[1].toLowerCase();
				if (e == 0) {
					newFilters.search = currentVal;
				}
				else if (target.prop("type") == 'radio') {
					newFilters.availability = currentVal;
				}
				else if (checkType == 'brand') {
					newFilters.brand.push(e);
				}
				else if (checkType == 'sh13') {
					newFilters.agronomic.push(e);
				}
				else if (checkType == 'sh14') {
					newFilters.irrigation.push(e);
				}
				else if (checkType == 'sh12') {
					newFilters.landscape.push(e);
				}
				else if (checkType == 'sh11') {
					newFilters.lighting.push(e);
				}
				else if (checkType == 'sh16') {
					newFilters.nursery.push(e);
				}
				else if (checkType == 'sh17') {
					newFilters.tools.push(e);
				}
				else if (checkType == 'sh15') {
					newFilters.hardscapes.push(e);
				}
			}
			if (target.data("status") != currentVal) {
				ACC.savedlist.listFilterUpdated = true;
				//console.log(e, target.data("status"));
			}
			target.data("status", currentVal);
			//console.log(e, target.data("status"), currentVal, target.data('listfilter'));
		});
		ACC.savedlist.applyListFilter(newFilters, pageload);
	},
	applyListFilter: function (newFilters, pageload) {
		let pageLoadRequired;
		if (!pageload && ACC.savedlist.listFilterUpdated) { //Expecting a pageLoad ith new filters
			pageLoadRequired = true;
			let daatString = "";
			let finalUrl = "";
			ACC.myquotes.filterPopup('hide', 500, '.list-filter-popup');
			loading.start();
			daatString += ACC.savedlist.dataStringFilter(newFilters.agronomic, 'agronomic');
			daatString += ACC.savedlist.dataStringFilter(newFilters.hardscapes, 'hardscapes');
			daatString += ACC.savedlist.dataStringFilter(newFilters.irrigation, 'irrigation');
			daatString += ACC.savedlist.dataStringFilter(newFilters.landscape, 'landscape');
			daatString += ACC.savedlist.dataStringFilter(newFilters.lighting, 'lighting');
			daatString += ACC.savedlist.dataStringFilter(newFilters.nursery, 'nursery');
			daatString += ACC.savedlist.dataStringFilter(newFilters.tools, 'tools');
			daatString += ACC.savedlist.dataStringFilter(newFilters.brand, 'brand');
			if (daatString == "" && newFilters.search == "") {
				finalUrl = ACC.config.encodedContextPath + "/savedList/listDetails?code=" + $("#savedListCode").val();
			}
			else {
				finalUrl = ACC.config.encodedContextPath + "/savedList/listDetails?q="+ newFilters.search +"%3Adate-asc" + daatString + "&searchtype=product&text=&viewtype=All&nearby=&inStock=&sort=&Filter+by+Category=on#";
			}
			//console.log("Expecting a pageLoad", newFilters, finalUrl);
			window.location = finalUrl;
		}
		if (!pageLoadRequired) {
			if (ACC.savedlist.listFilterUpdated) { //Creating the tags
				loading.start();
				ACC.savedlist.checkFilterTag('listfilter', '.list-filter-popup', '.filter-tags', pageload);
				//console.log("Updating Filter Tags", newFilters);
			}
			else {
				ACC.myquotes.filterPopup('hide', 500, '.list-filter-popup');
				//console.log("No Update", newFilters);
			}
		}
	},
	resetListFilter: function (target) {
		if($("#filter-Brand-1").length){
			$("[data-" + target + "]").each(function (e) {
				let target = $(this);
				if (target.prop('type') == "text" && target.val() != "") {
					target.val("");
				}
				else if (target.prop("checked")) {
					target.prop("checked", false);
				}
			});
			$(".from-input-label").fadeIn();
			ACC.savedlist.updateListFilter();
		}
		else{
			loading.start();
			window.location = ACC.config.encodedContextPath + "/savedList/listDetails?code=" + $("#savedListCode").val();
		}
	},
	dataStringFilter: function (targetArray, dataKey) {
		let daatString = "";
		if (targetArray.length) {
			for (let i = 0; i < targetArray.length; i++) {
				daatString += (dataKey == 'brand') ? '%3AsoproductBrandNameFacet%3A' : '%3Asocategory%3A';
				daatString += $("[data-listfilter]").eq(targetArray[i]).data('name').replaceAll(' ', '%2B');
			}
		}
		return daatString;
	},
	checkFilterTag: function (targetElem, popup, targetClass, pageload) { //Create parent in JSP with targetClass
		let targetParent = $(targetClass);
		targetParent.empty();
		$("[data-" + targetElem + "]").each(function (e) {
			let target = $(this);
			let targetInput = target.is('input');
			let currentVal = (targetInput) ? target.val().toLowerCase() : target.prop("checked");
			let targetCategory = target.attr("id");
			if (e == 0 && currentVal != "") {
				ACC.savedlist.createFilterTag("input", currentVal, '', e, targetElem, popup, targetClass);
			}
			else if (target.prop("checked")) {
				ACC.savedlist.createFilterTag("checkbox", target.data(targetElem), targetCategory, e, targetElem, popup, targetClass);
			}
		});
		if ($(".filter-tag").length) {
			ACC.savedlist.createFilterTag("button", 'Clear All Filters', '', '', targetElem, popup, targetClass);
			targetParent.slideDown();
			loading.stop();
		}
		ACC.myquotes.filterPopup('hide', 500, popup);
	},
	clearFilterTag: function (type, id, index, targetElem, popup) {
		if (type == 'input') {
			$("[data-" + targetElem + "]").eq(index).val('');
		} else {
			let category = id.split("-");
			$("[data-" + targetElem + "]").eq(index).prop('checked', false);
			if (!category[2]) {
				$('[id^="filter-' + category[1] + '-"]').prop('checked', false);
			}
			else if (category[2]) {
				$('[id="filter-' + category[1] + '"]').prop('checked', false);
			}
		}
		ACC.savedlist.updateListFilter();
	},
	createFilterTag: function (type, text, id, index, targetElem, popup, targetClass) {
		let targetParent = $(targetClass);
		let targetText = type == 'input' ? 'Text: "' + text + '"' : text;
		if (type == 'input' || type == 'checkbox') {
			targetParent.append("<div class='text-default font-size-14 p-r-15 add-border-radius bg-light-gray border-light-grey transition-3s filter-tag'><span class='bold display-ib p-b-5 p-l-15 p-t-5 pad-rgt-10 transition-3s pointer' onclick=\"ACC.savedlist.clearFilterTag('" + type + "','" + id + "','" + index + "','" + targetElem + "','" + popup + "')\">x</span><span>" + targetText + "</span></div>");
		} else {
			targetParent.append('<button class="text-white font-size-14 transition-3s clearAllTagBtn" onclick="ACC.savedlist.resetListFilter(\'listfilter\', \'.list-filter-popup\')">' + text + '</button>')
		}
	},
	listUomSelecion: function(e) {
		let target = $(e);
		let targetParent = target.parents('.saved-list-sec');
		let productCode = targetParent.find(".productcode").val();
		let oldUomValue = targetParent.find("#inventoryUomId").val();
		let oldUomUnit = targetParent.find(".uomvalue").val();
		let selectedUomValue = target.find(":selected").data("inventory");
		let selectedUomUnit = target.find(":selected").data("uomdecs");
		let wishListCode = $("#wishListListName").val();
		let targetATCBtn = targetParent.find("#addToCartForm").find("button");
        let btnFound;
        if(targetParent.find("#addToCartForm").length && targetATCBtn.length){
            for (let i = 0; i < targetATCBtn.length; i++) {
                if(targetATCBtn.eq(i).is(":visible") && !targetATCBtn.eq(i).prop("disabled")){
                    targetATCBtn = targetATCBtn.eq(i);
                    btnFound = true;
                    break;
                }
            }
        }
		if (selectedUomUnit != oldUomUnit) {
			target.prop("disabled", true);
			if(btnFound){targetATCBtn.prop("disabled", true);}
			$.ajax({
				url: ACC.config.encodedContextPath + '/savedList/updateUOMforEntries',
				cache: false,
				type: "GET",
				dataType: 'json',
				contentType: 'application/json',
				data:
				{
					"wishListCode": wishListCode,
					"productCode": productCode,
					"inventoryUomId": selectedUomValue
				},
				success: function (data) {
					target.prop("disabled", false);
					if(btnFound){targetATCBtn.prop("disabled", false);}
					if (data) {
						let newYPrice = (data.customerPrice)?data.customerPrice.formattedValue:data.price.formattedValue;
						let newRPrice = data.price.formattedValue;
						let newTPrice = data.totalPrice.formattedValue;
						let newListTotal = ACC.savedlist.formatNumberComma(data.listTotalPrice);
						let newMultiplier = data.orderQuantityInterval;
						//your price/retail price/item level total/list total/ATC UOM/Adobe Data/MOB UI 
						//'Add List To Cart' Update
						let productList = $(".saveList").val().trim().split(" ");
						for (var i = 0; i < productList.length; i++) {
							if (productList[i].split("|")[0] == productCode) {
								productList[i] = productCode + "|" + productList[i].split("|")[1] + "|" + selectedUomValue;
								break;
							}
						}
						$(".saveList").val(productList.join(" "));
						// ./ 
						//Prie Section update
						let priceTarget = $('[data-uomid="' + oldUomValue + '"]');
						priceTarget.attr({ 'data-uomid': selectedUomValue, 'data-uomdesc': selectedUomUnit, 'data-uom': selectedUomUnit, 'data-inventorymultiplier': newMultiplier });
						priceTarget.find(".slp-yourprice-style").html(newYPrice + ' / ' + selectedUomUnit);
						priceTarget.find(".slp-retailprice-style del").html(newRPrice + ' / ' + selectedUomUnit);
						priceTarget.find(".js-customer-price").val(data.customerPrice?data.customerPrice.value:data.price.value);
						// ./ 
						targetParent.find(".uomvalue").val(selectedUomUnit);
						targetParent.find("#inventoryUomId").val(selectedUomValue);	//Add To Cart Update
						targetParent.find(".inventryuom").val(selectedUomValue);	//Item select checkbox
						targetParent.find(".tot-amt-list").html(newTPrice);	//Item Total Update
						$(".cumulative-tot-price").find("strong").html('$' + newListTotal);	//List Total update
						ACC.savedlist.checkMinQuantityList(targetParent.parent().find(".quantity_updated"), false);
					}
					else {
						ACC.myquotes.quotePopupError();
					}
				},
				error: function () {
					ACC.myquotes.quotePopupError();
					target.prop("disabled", false);
					if(btnFound){targetATCBtn.prop("disabled", false);}
				}
			});
		}
	},
	quantityHandler: function(type, ref, page) {
		let target = $(ref);
		let targetVal = Number(target.val());
		var max_qty = [];
		for (let i = 0; i < target.prop("maxlength"); i++) {
			max_qty.push("9");
		};
		max_qty = max_qty.join("");
		var targetParent = target.parents(".saved-list-sec");
		var orderQtyInterval = targetParent.find(".orderQtyInterval").val();
		let targetUOM = targetParent.find('.js-uom-selector').eq(0);
		if (targetParent.find('.intervalQtyInfo_list').length && orderQtyInterval && orderQtyInterval != "" && (!targetUOM.length || (targetUOM.length && Number(targetUOM.find(":selected").data("inventorymultiplier")) == 1))) {
			if (type == 'plus') {
				if (targetVal < max_qty) {
					var currentMultiple = Math.floor(targetVal / orderQtyInterval);
					var nextMultiple = currentMultiple + 1;
					targetVal = Math.max(orderQtyInterval, nextMultiple * orderQtyInterval);
					target.val(targetVal);
				}
			} else {
				if (targetVal > 1) {
					var isMultiple = targetVal % orderQtyInterval === 0;
					var previousMultiple = isMultiple ? targetVal - orderQtyInterval : targetVal - (targetVal % orderQtyInterval);
					targetVal = Math.max(orderQtyInterval, Math.max(orderQtyInterval, previousMultiple));
					target.val(targetVal);
				}
			}
		}
		else {
			let newVal = type == 'plus' && targetVal < max_qty ? 1 : type == 'minus' && targetVal >= 2 ? -1 : 0;
			if (newVal && !target.prop("disabled")) {
				targetVal += newVal;
				target.val(targetVal);
			}
		}
		if (page) {
			ACC.recommendedlist.listDetailTotalCalculate(ref);
		}
		ACC.savedlist.listQtyUpdate(ref, "quantityHandler");
	}
};
$(function () {
    $(".comment-overlay").on('click', function() {
        $('.commentOverlay').hide();
        $('.overlayBackground').hide();
        $('#siteoneShareSavedListForm').hide();
        $('body').css('overflow-y', 'auto'); 
        
    	_AAData.popupPageName= "";
    	_AAData.popupChannel= "";
    });
});

$(document).ready(function(){
	$(".disableOption").on('click',function (e){
		$(".disableOption").css({"pointer-events": "none", "cursor": "default"});
		e.preventDefault();
	})
	$(document).on("change", ".qtyId", function(e){
		var data=$(this).attr("data-role");
		var qtyId="#"+data;
		var idval=$(this).parents().find(".saved-list-sec").find(qtyId);
		$(idval).val($(this).val());
		//console.log($(idval).val());
  	});
	

	$(document).on("keyup", ".quantity_updated", function(e) {
		
		var $target=$(e.target);
	    var max_qty=99999;
	    var quantity=$(this).val();
	    $(this).closest("div.box-effect").find("input[type=checkbox]").prop('checked', true);
	    if(quantity<=max_qty && quantity!=0) {
	        var listCode = $("#listCodeQtyChange").val();
	        var productCode = $(this).siblings("#productCodeQtyChange").val();
	        $(this).parent().parent().parent().next(".quantityInputSection").find("input#quantity").val(quantity);
	        $.ajax({
	            type: 'POST',
	            url: ACC.config.encodedContextPath + "/savedList/updateProductQuantity",
	            datatype: "json",
	            data: {
	                productCode: productCode,
	                wishListCode: listCode,
	                quantity:quantity
	            },
	            success: function(result) {					
					ACC.savedlist.checkMinQuantityList($target,false);					
					ACC.savedlist.updatePrice($target, $target);					            	
	            },
	            error: function(xhr, ajaxOptions, thrownError) {
               		 //console.log('data failure');
	            }
	        });
	    }
		else{
			ACC.savedlist.checkMinQuantityList($target,false);
		}
	});

	$('.js-update-entry-quantity-list-btn').on("click", ACC.global.throttleFunction(function (e) {
		var quantity_updated = false;
		var max_qty = 9999;
		var $target = $(e.target);
		var targetParent = $target.parents(".saved-list-sec");
		var targetInput = targetParent.find(".qtyId");
		var qty = targetInput.val();
		var intervalQtySection = targetParent.find('.intervalQtyInfo_list');
		var orderQtyInterval = targetParent.find(".orderQtyInterval").val();
		var listCode = targetParent.find("#listCodeQtyChange").val();
		var productCode = targetParent.find("#productCodeQtyChange").val();
		$target.closest("div.box-effect").find("input[type=checkbox]").prop('checked', true);
		if (qty && !isNaN(qty)) {
			qty = Number(qty);
		} else {
			qty = 0;
		}
		if (orderQtyInterval && orderQtyInterval != "" && intervalQtySection.is(':visible')) {
			if ($target.hasClass("plusQty")) {
				if (qty < max_qty) {
					var currentMultiple = Math.floor(qty / orderQtyInterval);
					var nextMultiple = currentMultiple + 1;
					qty = Math.max(orderQtyInterval, nextMultiple * orderQtyInterval);
					targetInput.val(qty);
				}
			} else {
				if (qty > 1) {
					var isMultiple = qty % orderQtyInterval === 0;
					var previousMultiple = isMultiple ? qty - orderQtyInterval : qty - (qty % orderQtyInterval);
					qty = Math.max(orderQtyInterval, Math.max(orderQtyInterval, previousMultiple));
					targetInput.val(qty);
				}
			}
			quantity_updated = true;
			ACC.savedlist.checkMinQuantityList($target, true);
		} else {
			if ($target.hasClass("plusQty")) {
				if (qty < max_qty) {
					targetInput.val(1 + qty);
					quantity_updated = true;
					ACC.savedlist.checkMinQuantityList($target, true);
				}
			} else {
				if (qty > 1) {
					targetInput.val(qty - 1);
					quantity_updated = true;
					ACC.savedlist.checkMinQuantityList($target, true);
				}
			}
		}
		ACC.savedlist.listQtyUpdate(targetInput, "js-update-entry-quantity-list-btn");
		targetInput = targetParent.find(".qtyId");
		targetInput.focus();
		if (quantity_updated == true) {
			qty = targetInput.val();
			targetParent.find(".quantityInputSection").find("input#quantity").val(qty);
			$.ajax({
				type: 'POST',
				url: ACC.config.encodedContextPath + "/savedList/updateProductQuantity",
				datatype: "json",
				data: {
					productCode: productCode,
					wishListCode: listCode,
					quantity: qty
				},
	            success: function(result) {
					ACC.savedlist.updatePrice($target, targetInput);
				},
	            error: function(xhr, ajaxOptions, thrownError) {
					//console.log('data failure');
				}
			});
			$target.trigger("qtyUpdated");
			return false;
		}
	}, 450));

	 var text_max = 200;
	    $(".list-comment").on('keyup',function () {
	        var text_length = $(this).val().length;
	        var data_remaining = text_max - text_length;
	        if(data_remaining==0)
	    	{
	    	 $('.text-remaining').css("color","red");
	    	}
	    else
	    	{
	    		$('.text-remaining').css("color","#999");
	    	}
	        $(".text-remaining").html(ACC.config.remaining +' '+data_remaining + ' '+ ACC.config.characters);
	    });

	 var text_max = 200;
	 if($('.share-comment').length!=0)
 	{
		 var text_length = $('.share-comment').val().length;
		 var text_remaining = text_max - text_length;
 	}
	 if(text_length!=0)
 	{
 		$('.text-area-disclaimer').html(ACC.config.remaining +' '+text_remaining + ' '+ ACC.config.characters);
 		if(text_remaining==0)
 		{
 			$('.text-area-disclaimer').css("color","red");
 		}
 	}
 else
 	{
	 $(".text-area-disclaimer").html(ACC.config.remaining +' '+text_max+ ''+ ACC.config.characters);
 	}
	    

	    $(".share-comment").on('keyup',function () {
	        var text_length = $(".share-comment").val().length;
	        var data_remaining = text_max - text_length;
	        if(data_remaining==0)
	    	{
	    	 $('.text-area-disclaimer').css("color","red");
	    	}
	    else
	    	{
	    		$('.text-area-disclaimer').css("color","#999");
	    	}

	        $(".text-area-disclaimer").html(ACC.config.remaining +' '+data_remaining + ' Characters');
	    });
	    
	    var assemblyCount = $(".js-assembly-qty").val();
	    if(assemblyCount==null || assemblyCount==""){
	    	$(".js-assembly-qty").val("1");
		}
		if ($(".pagename").val() == 'Saved List Page') {
			$('.savedListName').on('input', function () {
				$('.headerListName').val($(".savedListName").val())
			})
			$('.headerListName').on('input', function () {
				$('.savedListName').val($(".headerListName").val())
			})
		}
});

$(document).on("keydown", ".qtyId", function(e){
	if (!((e.which == 8) || (e.which >= 35 && e.which <= 57) || (e.which >= 96 && e.which <= 105))) {
		e.preventDefault();
		return false;
	}
});

$(".js-assembly-qty").keypress(function (e) {
	var regex = new RegExp("^[0-9-]+$");
	var str = String.fromCharCode(!e.charCode ? e.which : e.charCode);   
	var ignoredKeys = [8,0];
        if (ignoredKeys.indexOf(e.which) >=0 || regex.test(str)) {   
	       return true;
	    }       	    
	    e.preventDefault();
	    return false;
});


$(document).on("click", ".fstSelected , .fstChoiceItem", function(e){
	if($(".fstResultItem").length == $(".fstChoiceItem").length){
		$(".fstResults").hide();
	}
	else{
		$(".fstResults").show();
		}
});

$(".inputTextBox").keyup(function(){
	var users = $(".inputTextBox").val();
	
	var elem=$(this)
	if ($(".inputTextBox").val().length >= 2){
		$("#listValues").addClass('listValuesActive');
		//$(".inputTextBox").val('');
	
	var a = [];
		//console.log()
	 $.ajax({
	        url : ACC.config.encodedContextPath + "/savedList/getShareListUsers?searchTerm="+users,
	        method : "GET",
	        success :function(response)
	        {
       		 $("#listValues").empty();
       		$(".listValuesActive").css("cssText", "display: inline !important;");
       		 if(response.length!=0){
       			  	$.each(response,function(index,repo){
	        		//console.log(repo);
	        		$("#listValues").append(`<li data-id='${repo.text}' data-value='${repo.value}'class='fstResultItem'>${repo.text}</li>`);
		        });
       		 }
	                
       		 else{
       				$("#listValues").append(`<li> No results </li>`);
       			 }
	        	
	       }
	 });
	}
});

var dataValuesShow = []
var dataValueArray = [];
$(document).on("click", ".removeuser",function(e){
	let name=$(this).attr("data-name");
    let email = $(this).attr("data-email");
	
	 $(this).closest(".selecteduserList").remove();
	 dataValueArray.splice($.inArray(email, dataValueArray), 1);
	 dataValuesShow.splice($.inArray(name, dataValuesShow), 1);
	 $("#users").val(dataValueArray);
	 if(dataValueArray.length == 0){
	  $(".shareAssemblyDetailBtn, .shareListDetailBtn").prop("disabled",true);
	 }
});
$(document).on("click", ".inputTextBox",function(e){

	$('#listValues li').remove();
	$(".inputTextBox").val('');
	$(".inputTextBox").removeClass("border-red")
	$(".js-share-email-error").addClass("hidden");
});
$(document).on("click", "#listValues li",function(e){
	let dataName=$(this).attr("data-id");
    let dataValue = $(this).attr("data-value");
    if(dataName!=undefined && dataValue!=undefined){
		$(".shareAssemblyDetailBtn, .shareListDetailBtn").prop("disabled",false);
		$(".inputTextBox").removeClass("border-red");
		$(".js-share-email-error").addClass("hidden");
	if(jQuery.inArray(dataName, dataValuesShow) == -1) {
		dataValuesShow.push(dataName);
		dataValueArray.push(dataValue);
		//console.log(dataValuesShow)
	    $("#users").val(dataValueArray);
		$(".textBox").prepend(`<div class="selecteduserList fstChoiceItem" data-name="${dataName}" data-email="${dataValue}">${dataName}</div>`);
		$(".selecteduserList").addClass("removeuser");
		$('#fstResultItem').fadeOut();
		
		 $('#listValues li:contains('+dataName+')').remove();
		

		var select = $("#listValues li").val();
	    if(select>=0){
	    	$(".listValuesActive").css("cssText", "display: inline !important;");
	    }else{
	    	$(".listValuesActive").css("cssText", "display: none !important;");
	    }
	}
	}
	else{
		 if(dataValueArray.length == 0){
	 		$(".shareAssemblyDetailBtn, .shareListDetailBtn").prop("disabled",true);
		 }
		$(".js-share-email-error").removeClass("hidden");
		$(".inputTextBox").addClass("border-red");

	}
});
var xList = [];
var productCodes="";
var productItemNumbers="";
$(document).ready(function(e){
	
	/*for list page add to cart non-stock item message error*/ 
	if ($('.saved-list-sec').length){
		$('.dropdown-movetolist').parent().find('#notSellable').siblings('span').closest('div').addClass("page-details-notSellable");
		
		if($('#orderingAccountMsg').css('display') == 'none'){
			$('.alert_msg').parents().find('#addToCartForm').css("margin-bottom","0px");
		}
		if($('#notSellable')){
			$('.alert_msg').parents().find('#addToCartForm').css("margin-bottom","-6px !important");
		}
		if( $('#sellableUoms') && $('#orderingAccountMsg').css('display') == 'none' && $('#notSellable') != true){
			$('.alert_msg').parents().find('#addToCartForm').css("padding-bottom","15px");
		}
		if($('#isSellable').val() == false && $('.index-listproduct').val() == '0'){
			$('#isSellable').parent('#addToCartForm').css("margin-bottom","15px !important");
		}
	}
	
	
	$('#showImage').on('change', function() {
		if($("#showImage").val()==="listWithNoImages")
		{
			$(".assembly-list-image-wrapper").hide();
			$(".listproduct-info").addClass("detailSec");
		}
		else
		{
			$(".assembly-list-image-wrapper").show();
			$(".listproduct-info").removeClass("detailSec");
		}
	})
	
	$("#quantityId").keyup(function(e){ 
		if(this.value.substring(0,1) == "0")
	    {
	       this.value = this.value.replace(/^0+/g, '1');       	     
	    }          
	});
	
	if ($('.product__list').length){
		var fixmeTop = $('.product__list').offset().top; 
		let target = $('.js-sticky-listpage');
		$(window).scroll(function() 
		{
				 if ($(this).scrollTop() > fixmeTop && $(this).scrollTop()+100 < $(".linktracking-footer").offset().top)
				 {
					target.addClass("sticky_header stickyheader-listpage-mobile-option");
					target.children(".container-lg").addClass((ACC.global.wWidth>1440)?"p-l-15 p-r-15 stickyheader-listpage-border":"stickyheader-listpage-border");
				  $('.list_addlisttocart_wrapper').addClass("list_addlisttocart_wrapper-scrollbar");
				 }
				 else
				 {
					target.removeClass("sticky_header stickyheader-listpage-mobile-option");
					target.children(".container-lg").removeClass("stickyheader-listpage-border p-l-15 p-r-15");
				  $('.list_addlisttocart_wrapper').removeClass("list_addlisttocart_wrapper-scrollbar");
				 }
		});
		}
	var selectedproductcode =  $('.selectedProducts').val();
	var selectedproductSessionVal = ACC.savedlist.savedListSessionStorage("get");
	if(selectedproductSessionVal && selectedproductSessionVal !=''){
		selectedproductcode = selectedproductSessionVal;
	}
	ACC.savedlist.savedListSessionStorage("remove");
	if(selectedproductcode != null && selectedproductcode != 'undefined'){
		if(selectedproductcode.length){
			xList=selectedproductcode.split(' ');
		}
	}
	var pcList=[];
	$.each(xList, function(index, value){
		var prodcutDetail=value.split('~');
		pcList.push(prodcutDetail[0]);
		if(prodcutDetail.length>1){
			var uom=prodcutDetail[3];
			if(uom==='undefined'){
				uom='';
			}
			productCodes=productCodes+prodcutDetail[0]+"|"+prodcutDetail[2]+"|"+uom+" ";
			productItemNumbers=productItemNumbers+prodcutDetail[1]+"|"+prodcutDetail[2]+"|"+uom+" ";
		}		
	});	
	ACC.savedlist.listItemCheckStatus(pcList);

$(document).on("change","#pageSizeSavedListDetail1",function() 
		{    
		var code = $("#code").val();
		var viewpagination =$("#pageSizeSavedListDetail1").val();
		$('#changePageSizeFormSavedListDetail1').find("input#ViewPaginationList").val(viewpagination);
		$('#changePageSizeFormSavedListDetail1').find("input#code").val(code);
		var sproduct="";
		for(var i =0; i< xList.length; i++){
			 sproduct = sproduct + xList[i]+" ";
			}
		$('#changePageSizeFormSavedListDetail1').find("input#selectedProducts").val(sproduct);
	$('#changePageSizeFormSavedListDetail1').submit();
		})

		$(document).on("change","#pageSizeSavedListDetail2",function() 
		{    
			var code = $("#code").val();
			var viewpagination =$("#pageSizeSavedListDetail2").val();
			$('#changePageSizeFormSavedListDetail2').find("input#ViewPaginationList").val(viewpagination);
			$('#changePageSizeFormSavedListDetail1').find("input#code").val(code);
			var sproduct="";
			for(var i =0; i< xList.length; i++){
				 sproduct = sproduct + xList[i]+" ";
				}
			$('#changePageSizeFormSavedListDetail1').find("input#selectedProducts").val(sproduct);
			$('#changePageSizeFormSavedListDetail2').submit();
			})
});



ACC.recommendedlist = {
	_autoload: [
		"bindPageLoadFunctions"
	],
	$productCodeField: '.productID_assemblyList',
	$assemblyproductcode: '.product-codedetail',
	bindPageLoadFunctions: function () {
		if ($(".page-savedListPage").length || $(".page-recommendedListPage").length || $(".page-detailsSavedListPage").length) {
			setTimeout(function () {
				$('[data-toggle="popover"]').each(function () {
					let target = $(this);
					if (target.hasClass("addListToCarts_filter") && target.attr("disabled") == "disabled") {
						target.popover({ placement: 'top', trigger: 'hover', container: 'body' });
						target.on('shown.bs.popover', function () {
							$(".popover").addClass("bg-danger");
						});
					}
					else if (!target.hasClass("addListToCarts_filter")) {
						target.popover({ placement: 'top', trigger: 'hover', container: 'body' });
					}
				});
			}, 1000);
		}
        if ($(".page-detailsRecommendedListPage").length) {
            ACC.recommendedlist.createFilter();
        }
	},
	recListUomSelecion: function(e) {
		let target = $(e);
		let targetParent = target.parents('.saved-list-sec');
		let productCode = targetParent.find(".productcode").val();
		let oldUomValue = targetParent.find("#inventoryUomId").val();
		let oldUomUnit = targetParent.find(".uomvalue").val();
		let selectedUomValue = target.find(":selected").data("inventory");
		let selectedUomUnit = target.find(":selected").data("uomdecs");
        let targetATCBtn = targetParent.find("#addToCartForm").find("button");
        let btnFound;
        if(targetParent.find("#addToCartForm").length && targetATCBtn.length){
            for (let i = 0; i < targetATCBtn.length; i++) {
                if(targetATCBtn.eq(i).is(":visible") && !targetATCBtn.eq(i).prop("disabled")){
                    targetATCBtn = targetATCBtn.eq(i);
                    btnFound = true;
                    break;
                }
            }
        }
		if (selectedUomUnit != oldUomUnit) {
			target.prop("disabled", true);
            if(btnFound){targetATCBtn.prop("disabled", true);}
			$.ajax({
				url: ACC.config.encodedContextPath + '/savedList/updateUOMforRecommendedListEntries',
				cache: false,
				type: "GET",
				dataType: 'json',
				contentType: 'application/json',
				data:
				{
					"productCode": productCode,
					"inventoryUomId": selectedUomValue
				},
				success: function (data) {
					target.prop("disabled", false);
                    if(btnFound){targetATCBtn.prop("disabled", false);}
					if (data && data.customerPrice) {
						let newYPrice = data.customerPrice.formattedValue;
						let newMultiplier = data.orderQuantityInterval? data.orderQuantityInterval : 1;
						//'Add List To Cart' Update
						if($(".saveList").length){
							let productList = $(".saveList").val().trim().split(" ");
							for (var i = 0; i < productList.length; i++) {
								if (productList[i].split("|")[0] == productCode) {
									productList[i] = productCode + "|" + productList[i].split("|")[1] + "|" + selectedUomValue;
									break;
								}
							}
							$(".saveList").val(productList.join(" "));
						}

						//Prie Section update
						let priceTarget = $('[data-uomid="' + oldUomValue + '"]');
						priceTarget.attr({ 'data-uomid': selectedUomValue, 'data-uomdesc': selectedUomUnit, 'data-uom': selectedUomUnit, 'data-inventorymultiplier': newMultiplier, 'data-customerprice': data.customerPrice.value }).data({ customerprice: data.customerPrice.value });
						priceTarget.find(".slp-yourprice-style").html(newYPrice + ' / ' + selectedUomUnit);
						priceTarget.find(".js-customer-price").val(data.customerPrice.value);
						// ./ 
						targetParent.find(".uomvalue").val(selectedUomUnit);
						targetParent.find("#inventoryUomId").val(selectedUomValue);	//Add To Cart Update
						targetParent.find(".inventryuom").val(selectedUomValue);	//Item select checkbox
						targetParent.find(".js-update-entry-quantity-input").trigger("keyup");
                        ACC.savedlist.listQtyUpdate(targetParent.find(".js-update-entry-quantity-input"), "recListUomSelecion");
						//ACC.savedlist.checkMinQuantityList(targetParent.parent().find(".quantity_updated"), false);
					}
					else {
						ACC.myquotes.quotePopupError();
					}
				},
				error: function () {
					ACC.myquotes.quotePopupError();
					target.prop("disabled", false);
                    if(btnFound){targetATCBtn.prop("disabled", false);}
				}
			});
		}
	},
	listDetailTotalCalculate: function(ref, onload) {
		let target = $(ref);
		let targetParent = target.parents(".saved-list-sec"), targetMinVal;
		let targetVal = target.val();
		let targetUOM = targetParent.find('.js-uom-selector').eq(0);
		if(onload && (targetParent.find('.intervalQtyInfo_list').length || targetParent.find('.minOrderQtyInfo_list').length) && (!targetUOM.length || (targetUOM.length && Number(targetUOM.find(":selected").data("inventorymultiplier")) == 1))){
			targetMinVal = target.data('min-qty') != "" ? Number(target.data('min-qty')) : 1;
			if (targetMinVal && targetMinVal > 1) {
				target.val(targetMinVal);
			}
			targetMinVal = target.data('min-orderqty') != "" ? Number(target.data('min-orderqty')) : 1;
			if (targetMinVal && targetMinVal > 1) {
				target.val(targetMinVal);
			}
		}
		else if(targetVal == "" || isNaN(targetVal) || !targetVal || Number(targetVal) == 0){
			target.val(1);
		}
		target.removeClass("text-white");
		targetVal = target.val();
		let price;
		targetParent.find(".js-qty-selector-input, .ValueId, .productqtyItem").val(targetVal);
		if (targetParent.find(".slp-yourprice-style").length) {
			price = targetParent.find(".print-row-price");
			price = price.data("customerprice") ? price.data("customerprice") : price.data("price");
			targetParent.find(".tot-amt-list").html(ACC.estimate.formatter.format(price * targetVal));
		}
		else {
			targetParent.find(".tot-amt-list").html("-");
		}
		ACC.recommendedlist.checkMinQuantityList(target);
	},
	checkMinQuantityList: function (ref) { //min-qty && min-orderqty
		let targetParent = ref.parents(".saved-list-sec");
		let target = targetParent.find(".js-update-entry-quantity-input");
		let targetVal = target.val() != "" ? Number(target.val().trim()) : 1;
		let targetUOM = targetParent.find('.js-uom-selector').eq(0);
		let targetMinVal;
		let targetErrorElem = targetParent.find('.intervalQtyInfo_list').length ? targetParent.find('.intervalQtyInfo_list') : targetParent.find('.minOrderQtyInfo_list');
		if (targetErrorElem.length && (!targetUOM.length || (targetUOM.length && Number(targetUOM.find(":selected").data("inventorymultiplier")) == 1))) {
			targetMinVal = target.data('min-qty') != "" ? Number(target.data('min-qty')) : 0;
			if (targetMinVal && targetMinVal > 1) {
				ACC.savedlist.toggleErrorState(targetParent, target, !(targetVal % targetMinVal == 0));
			}
			targetMinVal = target.data('min-orderqty') != "" ? Number(target.data('min-orderqty')) : 0;
			if (targetMinVal && targetMinVal > 1) {
				ACC.savedlist.toggleErrorState(targetParent, target, !(targetVal >= targetMinVal));
			}
			targetErrorElem.removeClass("hidden");
		}
		else{
			ACC.savedlist.toggleErrorState(targetParent, target, false);
			targetErrorElem.addClass("hidden");
		}
        ACC.savedlist.listQtyUpdate(ref, "checkMinQuantityList rec");
	},
    filterCheckBoxes: ["brand", "category"],
    optionText: [],
    optionCount: [],
    optionChecked: [],
    optionHandeling: [],
    oneBrandChecked: false,
    oneCategoryChecked: false,
    filterCheckFlag: false,
    createFilter: function () {
        for (let i = 0; i < ACC.recommendedlist.filterCheckBoxes.length; i++) {
            ACC.recommendedlist.optionText.push([]);
            ACC.recommendedlist.optionCount.push([]);
            ACC.recommendedlist.optionChecked.push([]);
            ACC.recommendedlist.optionHandeling.push([]);
        }
        $(".saved-list-sec").each(function (e) {
            let ref = $(this);
            let brandBlank;
            for (let i = 0; i < ACC.recommendedlist.filterCheckBoxes.length; i++) {
                let filterType = ACC.recommendedlist.filterCheckBoxes[i];
                let filterText = ref.data('r' + filterType);
                let arrayIndex = $.inArray(filterText, ACC.recommendedlist.optionText[i]);
                let arrayRefLength;
                if (arrayIndex == -1) {
                    ACC.recommendedlist.optionText[i].push(filterText);
                    ACC.recommendedlist.optionCount[i].push(1);
                    ACC.recommendedlist.optionChecked[i].push(false);
                    ACC.recommendedlist.optionHandeling[i].push([]);
                    arrayRefLength = ACC.recommendedlist.optionText[i].length;
                    let target = $("#r-" + filterType);
                    target.find('.list-group').append('<label class="font-size-14 flex-center pointer transition-3s list-group-item" data-label' + filterType + '="' + filterText + '" for="selected-' + filterType + arrayRefLength + '"><span class="colored-primary hidden-print p-r-10"><input aria-label="Checkbox" id="selected-' + filterType + arrayRefLength + '" class="text-align-center list-group-item-check" onclick="ACC.recommendedlist.filterOptionsCheck(this, ' + arrayRefLength + ' , \'' + filterType + '\' , \'' + filterText + '\')" type="checkbox" value="' + filterText + '" data-role="' + arrayRefLength + '" data-' + filterType + '="' + filterText + '"></span>' + filterText + '<span class="list-group-item-badge" data-rdefault="1" data-rcount="1">(1)</span></label>');
                    if (filterText == "" || filterText == "No Brand") {
                        brandBlank = filterType;
                    }
                }
                else {
                    arrayRefLength = ACC.recommendedlist.optionCount[i][arrayIndex];
                    arrayRefLength++;
                    ACC.recommendedlist.optionCount[i][arrayIndex] = arrayRefLength;
                    let target = $('[data-label' + filterType + '="' + filterText + '"]');
                    target.find('.list-group-item-badge').html("(" + arrayRefLength + ")").data({ "rdefault": arrayRefLength, "rcount": arrayRefLength });
                }
            }
            if(brandBlank){
                $("#r-" + brandBlank + " .list-group").addClass("flex flex-dir-column");
                $('[data-label' + brandBlank + '="No Brand"]').css({order: 100});
            }
        });
        ACC.recommendedlist.filterTotalCount(true);
    },
    filterTotalCount: function (clickStatus) {
        for (let i = 0; i < ACC.recommendedlist.filterCheckBoxes.length; i++) {
            let target = $('[for="selected-' + ACC.recommendedlist.filterCheckBoxes[i] + '0"]');
            let isParentVisible = $("#r-" + ACC.recommendedlist.filterCheckBoxes[i]).hasClass("active");
            let arrayRefLength = 0;
            if (clickStatus) {
                for (let j = 0; j < ACC.recommendedlist.optionText[i].length; j++) {
                    arrayRefLength += $('[data-label' + ACC.recommendedlist.filterCheckBoxes[i] + '="' + ACC.recommendedlist.optionText[i][j] + '"]').find(".list-group-item-badge").data('rdefault');
                }
                target.find('.list-group-item-badge').html("(" + arrayRefLength + ")").data({ "rdefault": arrayRefLength, "rcount": arrayRefLength });
            }
            else if (!isParentVisible || (isParentVisible && $.inArray(true, ACC.recommendedlist.optionChecked[i]) == -1)) {
                for (let j = 0; j < ACC.recommendedlist.optionCount[i].length; j++) {
                    arrayRefLength += ACC.recommendedlist.optionCount[i][j];
                }
                target.find('.list-group-item-badge').html("(" + arrayRefLength + ")").data({ "rdefault": arrayRefLength, "rcount": arrayRefLength });
            }
        }
    },
    filterSelectAllCheck: function (e, num, type, text) { //filter Select All clicked
        if (!ACC.recommendedlist.filterCheckFlag) {
            loading.start();
            let target = $(e);
            let targetChecked = target.prop("checked");
            ACC.recommendedlist.filterCheckFlag = true;
            $('[data-' + type + ']').each(function (e) {
                let ref = $(this);
                if (!$('[data-label' + type + ']').eq(e).hasClass("hidden") && ref.prop("checked") != targetChecked) {
                    ref.prop("checked", targetChecked);
                }
            });
            ACC.recommendedlist.filterItemShowChecking('all');
            ACC.recommendedlist.filterCheckFlag = false;
        }
    },
    filterOptionsCheck: function (e, num, type, text) { //filter Options clicked
        if (!ACC.recommendedlist.filterCheckFlag) {
            loading.start();
            ACC.recommendedlist.filterCheckFlag = true;
            ACC.recommendedlist.filterItemShowChecking('single');
            ACC.recommendedlist.filterCheckFlag = false;
        }
    },
    filterItemShowChecking: function (clicked) {
        ACC.recommendedlist.oneBrandChecked = false;
        ACC.recommendedlist.oneCategoryChecked = false;
        for (let i = 0; i < ACC.recommendedlist.filterCheckBoxes.length; i++) {
            let tempData = [];
            let ref = $('[data-' + ACC.recommendedlist.filterCheckBoxes[i] + ']');
            let refLength = ref.length;
            for (let j = 0; j < refLength; j++) {
                let target = ref.eq(j);
                let targetVal = target.data(ACC.recommendedlist.filterCheckBoxes[i]); //brand or category text
                let targetIndex = $.inArray(targetVal, ACC.recommendedlist.optionText[i]);
                ACC.recommendedlist.optionHandeling[i][targetIndex] = [];
                if (target.prop("checked")) {
                    tempData.push(targetVal);
                    ACC.recommendedlist.optionChecked[i][targetIndex] = true;
                    ACC.recommendedlist.oneBrandChecked = (i == 0) ? true : ACC.recommendedlist.oneBrandChecked;
                    ACC.recommendedlist.oneCategoryChecked = (i == 1) ? true : ACC.recommendedlist.oneCategoryChecked;
                }
                else {
                    ACC.recommendedlist.optionChecked[i][targetIndex] = false;
                }
            }
        }
        if (ACC.recommendedlist.oneBrandChecked || ACC.recommendedlist.oneCategoryChecked) {
            let lastParent;
            $(".saved-list-sec").each(function (e) {
                let ref = $(this);
                let refBrand = ref.data('r' + ACC.recommendedlist.filterCheckBoxes[0]);
                let refCategory = ref.data('r' + ACC.recommendedlist.filterCheckBoxes[1]);
                let brandFlag = !ACC.recommendedlist.oneBrandChecked ? 1 : false; //if no brand selected
                let categoryFlag = !ACC.recommendedlist.oneCategoryChecked ? 1 : false; //if no category selected
                let brandIndex = $.inArray(refBrand, ACC.recommendedlist.optionText[0]);
                let categoryIndex = $.inArray(refCategory, ACC.recommendedlist.optionText[1]);
                if (ACC.recommendedlist.oneBrandChecked && ACC.recommendedlist.optionChecked[0][brandIndex]) {
                    brandFlag = 2;
                    lastParent = !lastParent ? ref : lastParent;
                }
                if (ACC.recommendedlist.oneCategoryChecked && ACC.recommendedlist.optionChecked[1][categoryIndex]) {
                    categoryFlag = 2;
                    lastParent = !lastParent ? ref : lastParent;
                }
                if (brandFlag && categoryFlag) { //shoing items
                    ref.removeClass("hidden");
                }
                else {
                    let refCheck = ref.find(".select_product_checkbox");
                    if (refCheck.prop("checked")) {
                        refCheck.trigger("click");
                    }
                    ref.addClass("hidden"); //hiding items
                }
                if (brandFlag == 2 && !ref.hasClass("hidden") && $.inArray(refCategory, ACC.recommendedlist.optionHandeling[0][brandIndex]) == -1) { //!ref.hasClass("hidden") need to check
                    ACC.recommendedlist.optionHandeling[0][brandIndex].push(refCategory);
                }
                if (categoryFlag == 2 && !ref.hasClass("hidden") && $.inArray(refBrand, ACC.recommendedlist.optionHandeling[1][categoryIndex]) == -1) {
                    ACC.recommendedlist.optionHandeling[1][categoryIndex].push(refBrand);
                }
            });
            ACC.recommendedlist.filterOptionShow();
        }
        else {	//showing all filter option and Items
            $(".saved-list-sec").removeClass("hidden");
            $('.list-group-item').each(function (e) {
                let target = $(this);
                if(!target.hasClass("list-group-item-hidden")){
                    target.removeClass("hidden");
                }
            });
        }
        ACC.recommendedlist.filterCountUpdate(!ACC.recommendedlist.oneBrandChecked && !ACC.recommendedlist.oneCategoryChecked); //updating filter count and total count
        if (clicked != "all") {
            ACC.recommendedlist.isfilterAllOptionCheck(clicked); //checking for Selection ALL selction
        }
    },
    filterOptionShow: function () {
        for (let i = 0; i < ACC.recommendedlist.filterCheckBoxes.length; i++) {
            let refIndex = (i == 0) ? 1 : 0;
            let refText = ACC.recommendedlist.filterCheckBoxes[refIndex];
            let isParentVisible = $("#r-" + refText).hasClass("active");
            if (!isParentVisible || (isParentVisible && $.inArray(true, ACC.recommendedlist.optionChecked[refIndex]) == -1)) {
                let ref = $('[data-label' + refText + ']');
                if (i == 0 && !ACC.recommendedlist.oneBrandChecked) {
                    ref.removeClass("hidden");
                }
                else if (i == 1 && !ACC.recommendedlist.oneCategoryChecked) {
                    ref.removeClass("hidden");
                }
                else {
                    ref.removeClass("hidden");
                    ref.data("hidden", true);
                    for (let j = 0; j < ACC.recommendedlist.optionHandeling[i].length; j++) {
                        for (let k = 0; k < ACC.recommendedlist.optionHandeling[i][j].length; k++) {
                            $('[data-label' + refText + '="' + ACC.recommendedlist.optionHandeling[i][j][k] + '"]').data("hidden", false);
                        }
                    }
                    ref.each(function (e) {
                        let target = $(this);
                        if (target.data("hidden")) {
                            target.addClass("hidden");
                            if (target.find(".list-group-item-check").prop("checked")) {
                                target.find(".list-group-item-check").prop("checked", false);
                            }
                        }
                    });
                }
            }
        }
    },
    isfilterAllOptionCheck: function () {
        for (let i = 0; i < ACC.recommendedlist.filterCheckBoxes.length; i++) {
            let type = ACC.recommendedlist.filterCheckBoxes[i];
            let target = $("#selected-" + type + "0");
            if ($("[data-label" + type + "]").length - $("[data-label" + type + "].hidden").length == $("[data-" + type + "]:checked").length) {
                if (!target.prop("checked")) {
                    target.prop("checked", true);
                }
            }
            else if (target.prop("checked")) {
                target.prop("checked", false);
            }
        }
    },
    filterCountUpdate: function (clickStatus) {
        for (let i = 0; i < ACC.recommendedlist.filterCheckBoxes.length; i++) {
            let parentCheckedCount=0;
            ACC.recommendedlist.optionCount[i] = [];
            let isParentVisible = $("#r-" + ACC.recommendedlist.filterCheckBoxes[i]).hasClass("active");
            for (let j = 0; j < ACC.recommendedlist.optionText[i].length; j++) {
                ACC.recommendedlist.optionCount[i][j] = 0;
            }
            if (clickStatus) {
                for (let j = 0; j < ACC.recommendedlist.optionText[i].length; j++) {
                    let target = $('[data-label' + ACC.recommendedlist.filterCheckBoxes[i] + '="' + ACC.recommendedlist.optionText[i][j] + '"]');
                    let typeCount = target.find(".list-group-item-badge").data('rdefault');
                    target.find('.list-group-item-badge').html("(" + typeCount + ")").data({ "rcount": typeCount });
                }
            }
            else if (!isParentVisible || (isParentVisible && $.inArray(true, ACC.recommendedlist.optionChecked[i]) == -1)) {
                $(".saved-list-sec:visible").each(function (e) {
                    let ref = $(this);
                    let refType = ref.data('r' + ACC.recommendedlist.filterCheckBoxes[i]);
                    let refIndex = $.inArray(refType, ACC.recommendedlist.optionText[i]);
                    let typeCount;
                    let refCheckbox = ref.find(".select_product_checkbox");
                    if(refCheckbox.prop("checked")){
                        parentCheckedCount++;
                    }
                    typeCount = ACC.recommendedlist.optionCount[i][refIndex];
                    typeCount++;
                    ACC.recommendedlist.optionCount[i][refIndex] = typeCount;
                });
                for (let j = 0; j < ACC.recommendedlist.optionText[i].length; j++) {
                    let target = $('[data-label' + ACC.recommendedlist.filterCheckBoxes[i] + '="' + ACC.recommendedlist.optionText[i][j] + '"]');
                    if (!target.hasClass("hidden") && ACC.recommendedlist.optionCount[i][j] == 0) {
                        ACC.recommendedlist.optionCount[i][j] = target.find(".list-group-item-badge").data('rdefault');
                    }
                    let typeCount = ACC.recommendedlist.optionCount[i][j];
                    target.find('.list-group-item-badge').html("(" + typeCount + ")").data({ "rcount": typeCount });
                }
            }
            if($(".saved-list-sec:visible").length == parentCheckedCount && !$(".select_product_checkbox_all").prop("checked")){
                $(".select_product_checkbox_all").prop("checked", true);
            }
            else if($(".saved-list-sec:visible").length != parentCheckedCount && $(".select_product_checkbox_all").prop("checked")) {
                $(".select_product_checkbox_all").prop("checked", false);
            }
        }
        ACC.recommendedlist.filterTotalCount(clickStatus);
        ACC.recommendedlist.createFilterTags();
    },
    createFilterTags: function () {
        let targetParent = $('.filter-tags');
        targetParent.empty();
        let finalHTML = "";
        for (let i = 0; i < ACC.recommendedlist.filterCheckBoxes.length; i++) {
            let targetElem = ACC.recommendedlist.filterCheckBoxes[i];
            $("[data-" + targetElem + "]").each(function (e) {
                let target = $(this);
                let targetVal = target.data(targetElem);
                if (target.prop("checked")) {
                    finalHTML += ACC.recommendedlist.returnFilterTag(e, "checkbox", targetVal, targetElem);
                }
            });
        }
        if (finalHTML != "") {
            finalHTML += ACC.recommendedlist.returnFilterTag(0, "button", 'Clear All Filters');
            targetParent.append(finalHTML);
        }
        loading.stop();
    },
    returnFilterTag: function (index, type, text, targetElem) {
        let targetText = type == 'input' ? 'Text: "' + text + '"' : text;
        if (type == 'input' || type == 'checkbox') {
            return "<div class='text-default font-size-14 p-r-15 add-border-radius bg-light-gray border-light-grey transition-3s filter-tag'><span class='bold display-ib p-b-5 p-l-15 p-t-5 pad-rgt-10 transition-3s pointer' onclick=\"ACC.recommendedlist.clearFilterTag('" + index + "','" + type + "','" + targetElem + "','" + targetText + "')\">x</span><span>" + targetText + "</span></div>";
        } else {
            return '<button class="text-white font-size-14 transition-3s clearAllTagBtn" onclick="ACC.recommendedlist.resetListFilter()">' + targetText + '</button>';
        }
    },
    clearFilterTag: function (index, type, targetElem) {
        if (type == 'input') {
            $("[data-" + targetElem + "]").eq(index).val('');
        } else {
            $("[data-" + targetElem + "]").eq(index).trigger('click');
        }
    },
    resetListFilter: function () {
        for (let i = 0; i < ACC.recommendedlist.optionChecked.length; i++) {
            for (let j = 0; j < ACC.recommendedlist.optionChecked[i].length; j++) {
                if (ACC.recommendedlist.optionChecked[i][j]) {
                    $("[data-" + ACC.recommendedlist.filterCheckBoxes[i] + "]").eq(j).trigger('click');
                }
            }
        }
    }
}
ACC.estimate = {
    _autoload: [
        "generateEstimatePage"
    ],
    generateEstimatePage: function () {
        if ($(".estimate-page").length) {
            _AAData.pathingChannel = "my account";
            _AAData.pathingPageName = "my account: savedList: generateEstimate:";
            let nowTime = new Date().toString().split(" ");
            $(".estimate-date").val(nowTime[1] + " " + nowTime[2] + ", " + nowTime[3]);
            ACC.estimate.calculateEstimateTotal();
            $(".estimate-table-input").on("change", ACC.estimate.calculateEstimateTotal);
            $(".estimate-table-input").on("keyup", ACC.estimate.calculateEstimateTotal);
            document.addEventListener('visibilitychange', function (event) { //re setting popup position
                if (!document.hidden && $(".estimate-successmsg").length && $(".estimate-successmsg").css("display") != "none") {
                    ACC.estimate.estimatePDFPopup();
                }
            });
            $(window).on("resize", function () {
                if ($(".estimate-successmsg").length && $(".estimate-successmsg").css("display") != "none") {
                    ACC.estimate.estimatePDFPopup();
                }
            });
            $("#uploadImage").ajaxForm({
                beforeSubmit: function() {loading.start();},
                success: function() {
                    $(".contractor-logo").eq(0).attr('src', $(".contractor-logo").eq(1).attr('src'));
                    $(".delete-logo-btn, .contractor-logo-btn").show();
                    $(".upload-logo-btn").hide();
                    ACC.estimate.popupEffect("hide","drop",".logo-popup");
                    loading.stop();
                }
            });
        }
    },
    formatter: new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }),
    pdfTextArray: function (num) {
        return $("[data-translation='" + num + "']").text();
    },
    estimatePDFPopup: function () {
        ACC.colorbox.open("", {
            html: $(".estimate-modal").html(),
            width: "550px",
            className: "estimate-successmsg"
        });
    },
    removeEstimateRow: function (target) {
        let ref = $(target);
        ref.parents(".estimate-table").slideUp(function () {
            $(this).remove();
            $(".custom-category").addClass("hidden");
            ACC.estimate.calculateEstimateTableRow();
        });
    },
    addEstimateRow: function (target) {
        let ref = $(target);
        let defaultText = $(".custom-category .custom-category-value").eq(0).val();
        let tableRow = $(".estimate-table");
        let rowNum = (tableRow.eq(tableRow.length - 1).hasClass('bg-offwhite') ? 'bg-white' : 'bg-offwhite');
        let newRow = '<div class="row margin0 br-3 text-center flex-center justify-center estimate-table ' + rowNum + '" style="display:none;"><div class="col-md-1 estimate-table-row-num"></div><div class="col-md-3 padding0"><input type="text" class="form-control estimate-product" placeholder="' + ACC.estimate.pdfTextArray(0) + '"></div><div class="col-md-2"><button onclick="ACC.estimate.customCategoryView(this, \'' + defaultText + '\')" type="button" class="movetoList-text custom-category-text transition-3s" data-categorypopup="hide"><span class="category-text">' + defaultText + '</span><span class="badge transition-3s"><svg xmlns="http://www.w3.org/2000/svg" width="8" height="5.167" viewBox="0 0 8 5.167"><path d="M3.527,157.74l-3.4-3.4a.6.6,0,0,1,0-.848l.565-.565a.6.6,0,0,1,.848,0l2.411,2.411,2.411-2.411a.6.6,0,0,1,.848,0l.565.565a.6.6,0,0,1,0,.848l-3.4,3.4A.6.6,0,0,1,3.527,157.74Z" transform="translate(0.05 -152.75)" fill="#50a0c5"></path></svg></span></button></div><div class="col-md-1 padding0"><input type="text" class="form-control text-center estimate-sku" placeholder="' + ACC.estimate.pdfTextArray(1) + '"></div><div class="col-md-1 padding0 after-price"><input type="number" min="0" max="9999999999" class="form-control estimate-table-input estimate-price" placeholder="' + ACC.estimate.pdfTextArray(2) + '"></div><div class="col-md-1 padding0"><input type="number" min="1" max="9999999999" class="form-control text-center estimate-table-input estimate-quantity" placeholder="' + ACC.estimate.pdfTextArray(3) + '"></div><div class="col-md-1 padding0 after-prcentage"><input type="number" min="0" max="9999999999" class="form-control text-right estimate-table-input estimate-markup" placeholder="' + ACC.estimate.pdfTextArray(4) + '"></div><div class="col-md-1 padding0"><input type="text" class="form-control text-right estimate-table-input estimate-table-total"></div><div class="col-md-1 padding0"><button class="btn btn-red" onclick="ACC.estimate.removeEstimateRow(this)"><strong>x</strong></button></div></div>';
        $(newRow).insertBefore(ref);
        $(".estimate-table").eq(tableRow.length).slideDown();
        $(".estimate-table-input").on("change", ACC.estimate.calculateEstimateTotal);
        $(".estimate-table-input").on("keyup", ACC.estimate.calculateEstimateTotal);
        ACC.estimate.calculateEstimateTableRow();
    },
    estimatePDF: async function (type) {
        var jsPDF = window.jspdf.jsPDF;
        if (jsPDF && jsPDF.version) {
            $('#dversion').text('Version ' + jsPDF.version);
        }
        var doc = new jsPDF({ putOnlyUsedFonts: true, orientation: "portrait" });
        
        var logoSrc= $(".contractor-logo").eq(0).attr("src");
        
        var haveLogo = logoSrc != "";
        if(haveLogo){
        	var imageWidthHeight = await ACC.estimate.calculateImageWidthHeight(logoSrc);
        	
        	doc.addImage(logoSrc, 'JPEG', 10, 6, imageWidthHeight.width, imageWidthHeight.height)
        }
        var y=10;
        var ca = 24;
        if(haveLogo){
        	var logoHeight = imageWidthHeight.height;
        	y = y+ 9 + logoHeight;
        	ca = ca + 5 + logoHeight;
        }
        var textForWidth;
        doc.setFontSize(18);
        doc.text($(".estimate-title").text(), 10, y); // left line 1 10
        doc.setFontSize(12);
        doc.setTextColor(150);
        textForWidth = ACC.estimate.pdfTextArray(5);
        doc.text(textForWidth, 126 - doc.getTextWidth(textForWidth), 10);
        textForWidth = ACC.estimate.pdfTextArray(6).toUpperCase();
        doc.text(textForWidth, 126 - doc.getTextWidth(textForWidth), 16);
        textForWidth = ACC.estimate.pdfTextArray(7);
        doc.text(textForWidth, 126 - doc.getTextWidth(textForWidth), ca); // 24
        textForWidth = ACC.estimate.pdfTextArray(8);
        ca+=6;
        doc.text(textForWidth, 126 - doc.getTextWidth(textForWidth), ca); //30
        doc.setTextColor(0);
        doc.setFont("helvetica", "bold");
        y +=10;
        doc.text($(".company-name").text(), 10, y); // left line 2 24
        ca-=6
        doc.text($(".customer-name").val(), 130, ca); // 24
        doc.setFont("helvetica", "normal");
        doc.text($(".estimate-date").val(), 130, 10);
        textForWidth = $(".estimate-number").val();
        let fileName = "estimate" + textForWidth + ".pdf";
        doc.text(textForWidth, 130, 16);
        y +=6;
        doc.text($(".company-address").eq(0).text(), 10, y);  // left line 3 30
        y +=6;
        doc.text($(".company-address").eq(1).text(), 10, y);  // left line 4 36
        y +=6;
        doc.text($(".company-phone").text(), 10, y);  // left line 5 42
        y +=6;
        doc.text($(".company-email").text(), 10, y);  // left line 6 48
        
        let posY = 35;
        let nextAddress = [];
        let address = $.trim($(".customer-address-line1").val()); //chekking address lines
        let addressLine = (doc.getTextWidth(address) > 72) ? address.substr(0, 36) : address;
        ca+=6;
        doc.text(addressLine, 130, ca); // 30
        address = $.trim(address.substr(36));
        if(address != ""){
			nextAddress.push(address+",");
		};
        address = $.trim($(".customer-address-line2").val());
		if(address != ""){
			nextAddress.push(address+",");
		};
		address = $.trim($(".customer-city").val());
		if(address != ""){
			nextAddress.push(address);
		};
        address = $.trim($(".customer-state option:selected").text());
		if(address != ACC.estimate.pdfTextArray(15)){
			nextAddress.push(address);
		};
        address = $.trim($(".customer-zip").val());
		if(address != ""){
			nextAddress.push(address);
		};
        address = nextAddress.join(" ");
        addressLine = (doc.getTextWidth(address) > 72) ? address.substr(0, 36) : address;
        ca +=5;
        doc.text(addressLine, 130, ca); // 35
        nextAddress = [];
        address = $.trim(address.substr(36));
        if(address != ""){
			posY += 5;
			ca +=5;
			doc.text(address, 130, ca);
		};
        
		ca +=5;
        doc.text($(".customer-phone").val(), 130, ca);
        ca +=5;
        doc.text($(".customer-email").val(), 130, ca);
        doc.setFillColor(153, 153, 153);
        var line1Y=55;
        if(haveLogo){
        	line1Y=y+7;
        }
        doc.line(10, line1Y, 200, line1Y, "F"); // 55
        doc.setFillColor(65, 66, 68);
        line1Y+=5;
        doc.roundedRect(10, line1Y, 190, 10, 1, 1, "F"); // 60
        doc.setTextColor(255, 255, 255);
        line1Y+=7;
        doc.text(ACC.estimate.pdfTextArray(9), 13, line1Y);
        doc.text(ACC.estimate.pdfTextArray(11), 187, line1Y);
        posY = 82;
        if(haveLogo){
        	posY=line1Y+15;
        }
        let categoryArray = [];
        var catTotal;
        var catTemp;
        if (type == "category_details") {
            doc.text(ACC.estimate.pdfTextArray(10), 135, line1Y);
            doc.setTextColor(0, 0, 0);
            for (let i = 0; i < $(".estimate-table").length; i++) {
                let ref = $(".estimate-table").eq(i);
                let cat = ref.find(".category-text").text();
                if ($.inArray(cat, categoryArray) == -1) {
                    doc.setTextColor(0);
                    doc.setFont("helvetica", "bold");
                    categoryArray.push(cat);
                    if (i != 0) {
                        doc.setFontSize(10);
                        doc.text(catTemp + " " + ACC.estimate.pdfTextArray(14), 14, posY);
                        catTotal = ACC.estimate.formatter.format(catTotal);
                        doc.text(catTotal, 196 - doc.getTextWidth(catTotal), posY);
                        posY += 12;
                    }
                    catTemp = cat;
                    catTotal = 0;
                    if (posY > 265) { doc.addPage(); posY = 10; }
                    doc.setFontSize(11);
                    doc.text(cat, 10, posY);
                    posY += 5;
                    doc.setFillColor(0, 0, 0);
                    doc.line(10, posY, 200, posY, "F");
                    doc.setFont("helvetica", "normal");
                    posY += 6;
                    for (let j = 0; j < $(".estimate-table").length; j++) {
                        let target = $(".estimate-table").eq(j);
                        let targetCat = target.find(".category-text").text();
                        let sku = target.find(".estimate-sku").val();
                        let product = target.find(".estimate-product").val();
                        let qty = target.find(".estimate-quantity").val();
                        let total = target.find(".estimate-table-total").val().replace("$","");
                        qty = (qty < 1) ? "1" : qty;
                        if (cat == targetCat) {
                            if (posY == 21 || posY > 270) {
                                if (posY > 270) { doc.addPage(); posY = 10; }
                                doc.setFillColor(65, 66, 68);
                                doc.roundedRect(10, posY, 190, 10, 1, 1, "F");
                                posY += 6;
                                doc.setFontSize(12);
                                doc.setTextColor(255, 255, 255);
                                doc.text(ACC.estimate.pdfTextArray(9), 13, posY);
                                doc.text(ACC.estimate.pdfTextArray(10), 135, posY);
                                doc.text(ACC.estimate.pdfTextArray(11), 187, posY);
                                posY += 15;
                            }
                            catTotal += Number(total);
                            doc.setFontSize(10);
                            doc.setTextColor(150);
                            doc.text(sku, 14, posY);
                            posY += 5;
                            doc.setTextColor(0);
                            product = (doc.getTextWidth(product) > 110) ? product.substr(0, 66) + "..." : product;
                            doc.text(product, 14, posY);
                            doc.text(qty, 135, posY - 3);
                            doc.text(ACC.estimate.formatter.format(total), 196 - doc.getTextWidth(total), posY - 3);
                            posY += 5;
                            doc.setFillColor(153, 153, 153);
                            doc.line(10, posY, 200, posY, "F");
                            posY += 6;
                        }
                    }
                }
            }
            doc.setTextColor(0);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(10);
            doc.text(catTemp + " " + ACC.estimate.pdfTextArray(14), 14, posY);
            catTotal = ACC.estimate.formatter.format(catTotal);
            doc.text(catTotal, 196 - doc.getTextWidth(catTotal), posY);
            posY += 12;
        }
        else if (type == "category_only") {
            doc.setTextColor(0, 0, 0);
            for (let i = 0; i < $(".estimate-table").length; i++) {
                let ref = $(".estimate-table").eq(i);
                let cat = ref.find(".category-text").text();
                if ($.inArray(cat, categoryArray) == -1) {
                    categoryArray.push(cat);
                    catTotal = 0;
                    if (posY > 260) {
                        doc.addPage();
                        posY = 10;
                        doc.setFillColor(65, 66, 68);
                        doc.roundedRect(10, posY, 190, 10, 1, 1, "F");
                        posY += 6;
                        doc.setFontSize(12);
                        doc.setTextColor(255, 255, 255);
                        doc.text(ACC.estimate.pdfTextArray(9), 13, posY);
                        doc.text(ACC.estimate.pdfTextArray(11), 187, posY);
                        posY += 15;
                    }
                    for (let j = 0; j < $(".estimate-table").length; j++) {
                        let target = $(".estimate-table").eq(j);
                        let targetCat = target.find(".category-text").text();
                        let total = target.find(".estimate-table-total").val().replace("$","");
                        if (cat == targetCat) {
                            catTotal += Number(total);
                        }
                    }
                    doc.setTextColor(0);
                    doc.setFont("helvetica", "bold");
                    doc.setFontSize(10);
                    doc.text(cat, 14, posY);
                    catTotal = ACC.estimate.formatter.format(catTotal);
                    doc.text(catTotal, 196 - doc.getTextWidth(catTotal), posY);
                    posY += 5;
                    doc.setFillColor(153, 153, 153);
                    doc.line(10, posY, 200, posY, "F");
                    posY += 6;
                }
            }
            posY += 6;
        }
        else if (type == "details_only") {
            doc.text(ACC.estimate.pdfTextArray(10), 135, line1Y);
            doc.setTextColor(0, 0, 0);
            for (let i = 0; i < $(".estimate-table").length; i++) {
                if (posY > 270) {
                    doc.addPage();
                    posY = 10;
                    doc.setFillColor(65, 66, 68);
                    doc.roundedRect(10, posY, 190, 10, 1, 1, "F");
                    posY += 6;
                    doc.setFontSize(12);
                    doc.setTextColor(255, 255, 255);
                    doc.text(ACC.estimate.pdfTextArray(9), 13, posY);
                    doc.text(ACC.estimate.pdfTextArray(10), 135, posY);
                    doc.text(ACC.estimate.pdfTextArray(11), 187, posY);
                    posY += 11;
                }
                let target = $(".estimate-table").eq(i);
                let sku = target.find(".estimate-sku").val();
                let product = target.find(".estimate-product").val();
                let qty = target.find(".estimate-quantity").val();
                let total = target.find(".estimate-table-total").val().replace("$","");
                qty = (qty < 1) ? "1" : qty;
                doc.setFontSize(10);
                doc.setTextColor(150);
                doc.text(sku, 12, posY);
                posY += 5;
                doc.setTextColor(0);
                product = (doc.getTextWidth(product) > 120) ? product.substr(0, 70) + "..." : product;
                doc.text(product, 12, posY);
                doc.text(qty, 135, posY - 3);
                doc.text(ACC.estimate.formatter.format(total), 196 - doc.getTextWidth(total), posY - 3);
                posY += 5;
                doc.setFillColor(153, 153, 153);
                doc.line(10, posY, 200, posY, "F");
                posY += 8;
            }
        } // ./table row loop
        if (posY > 280) { doc.addPage(); posY = 10; }
        doc.setTextColor(150);
        doc.text(ACC.estimate.pdfTextArray(12), 10, posY);
        textForWidth = ACC.estimate.pdfTextArray(13);
        doc.text(textForWidth, 198 - doc.getTextWidth(textForWidth), posY);
        posY += 10;
        doc.setFontSize(18);
        doc.setTextColor(0);
        textForWidth = $(".estimate-total").eq(0).text();
        doc.text(textForWidth, 198 - doc.getTextWidth(textForWidth), posY);
        doc.setTextColor(0);
        doc.setFont("helvetica", "normal");
        doc.setFontSize(10);
        let addMessage = $(".add-message").val().split("\n");
        for (let i = 0; i < addMessage.length; i++) {
            for (let j = 0; j < 7000; j += 80) {
                let messageLine = $.trim(addMessage[i].substring(j, j + 80));
                if (messageLine != "") {
                    if (posY > 280) { doc.addPage(); posY = 10; }
                    doc.text(messageLine, 10, posY);
                    posY += 5;
                }
                else {
                    break;
                }
            }
        }
        doc.save(fileName);
        setTimeout(function () {
            ACC.estimate.estimatePDFPopup()
        }, 1000);
    },
    calculateEstimateTableRow: function () {
        $(".estimate-table").each(function (index) {
            var ref = $(this);
            ref.children(".estimate-table-row-num").html('<strong>' + (index + 1) + '</strong>');
        });
        ACC.estimate.calculateEstimateTotal();
    },
    calculateEstimateTotal: function () {
        let pageTotal = 0;
        $(".estimate-table").each(function () {
            let ref = $(this);
            let p = Number(ref.find(".estimate-table-input").eq(0).val());
            let q = Number(ref.find(".estimate-table-input").eq(1).val());
            let m = Number(ref.find(".estimate-table-input").eq(2).val());
            p = (isNaN(p) || p == "" || p < 0) ? 0 : p;
            q = (isNaN(q) || q == "" || q <= 0) ? 1 : q;
            m = (isNaN(m) || m == "" || m < 0) ? 0 : m;
            let t = p * q + p * q * m / 100;
            ref.find(".estimate-table-input").eq(1).val(q)
            ref.find(".estimate-table-input").eq(3).val("$" + t.toFixed(2));
            pageTotal += t;
        });
        $(".estimate-total").html(ACC.estimate.formatter.format(pageTotal));
    },
    customCategoryView: function (e, val) { //opening the custom category popup
        let ref = $(e);
        let page = $(".estimate-page");
        let target = $(".custom-category");
        ACC.estimate.popupEffect("hide","drop",".logo-popup");
        ACC.estimate.popupEffect("hide","fold",".estimate-popup");
        ACC.estimate.customCategoryList(val); //creating category lists
        if (ref.attr("data-categorypopup") == "hide") {
            page.find("[data-categorypopup='show']").attr("data-categorypopup", "hide").removeAttr("style").children(".badge").removeAttr("style");
            ref.attr("data-categorypopup", "show").css({ backgroundColor: "#f1f2f2" }).children(".badge").css("transform", "rotate(180deg)");
            ACC.estimate.customCategoryMode("view");
            target.removeClass("hidden").css({ left: ref.offset().left - page.offset().left, top: ref.offset().top - page.offset().top + 42 }).slideDown();
        }
        else {
            ref.attr("data-categorypopup", "hide").removeAttr("style").children(".badge").removeAttr("style");
            target.slideUp(function () {
                $(this).addClass("hidden")
            });
        }
    },
    customCategoryList: function (val) { //creating category lists
        let target = $(".custom-category");
        var lists = "";
        target.find(".custom-category-value").each(function () {
            let ref = $(this);
            let refVal = ref.attr("data-val");
            ref.val(refVal);
            lists += '<button onclick="ACC.estimate.customCategorySet(\'' + refVal + '\')" class="list-group-item ' + ((refVal == val) ? 'active' : '') + '">' + refVal + '</button>';
        });
        target.find(".list-group").html(lists);
    },
    customCategoryMode: function (type) { //changing the mode of the popup
        let offType = (type == "edit") ? "view" : "edit";
        let target = $(".custom-category");
        target.find(".custom-category-value").data("removeme", false).parent(".mode-edit").removeAttr("style");
        target.find(".mode-" + type).removeClass("hidden");
        target.find(".mode-" + offType).addClass("hidden");
    },
    customCategorySet: function (val) { //setting the new category
        $(".custom-category .list-group .list-group-item").each(function () {
            let target = $(this);
            let page = $(".estimate-page").find("[data-categorypopup='show']");
            if (target.html() == val) {
                target.addClass("active");
                page.removeAttr("style").children(".badge").removeAttr("style");
                page.attr({ onclick: "ACC.estimate.customCategoryView(this, '" + val + "')", "data-categorypopup": "hide" }).children(".category-text").html(val);
                $(".custom-category").slideUp(function () {
                    $(this).addClass("hidden")
                });
            }
            else {
                target.removeClass("active");
            }
        });
    },
    customCategoryAdd: function () { //adding a new category
        let ref = $(".custom-category");
        let val = $.trim(ref.find(".custom-category-add").val());
        ref.find(".custom-category-add").val("");
        if (val != "") {
            let foundMatch;
            $(".custom-category .list-group .list-group-item").each(function () {
                let target = $(this);
                if (target.html().toLowerCase() == val.toLowerCase()) {
                    foundMatch = true;
                    target.animate({ color: '#ff0000', backgroundColor: "#f2dcdc" }, 1000).effect('shake', 500, function () {
                        $(this).removeAttr("style");
                    });
                }
            });
            if (!foundMatch) {
                ref.find(".list-group").append('<button onclick="ACC.estimate.customCategorySet(\'' + val + '\')" class="list-group-item">' + val + '</button>');
                ref.find(".scroll-bar").append('<div class="input-group m-b-5 mode-edit hidden"><input type="text" class="form-control custom-category-value" data-val="' + val + '" value="' + val + '"><span class="input-group-btn br-3"><button class="btn btn-red bold-text" onclick="ACC.estimate.customCategoryRemove(this, \'' + val + '\')" type="button">x</button></span></div>');
            }
        }
    },
    customCategoryRemove: function (e) { //adding element to remove list
        $(e).parents(".mode-edit").effect('drop', 500, function () {
            $(this).children(".custom-category-value").data("removeme", true);
        });
    },
    customCategoryUpdate: function () { //updating custom category lists
        let defaultval;
        $(".custom-category .custom-category-value").each(function (index) {
            let target = $(this);
            let oldValue = target.attr("data-val");
            let newText;
            defaultval = (index == 0) ? target.val() : defaultval;
            if (target.data("removeme")) { //removing element
                target.parent(".input-group").remove();
                newText = defaultval;
            }
            else if (target.attr("data-val") != target.val()) { //upaiting text
                newText = target.val();
                target.attr("data-val", newText);
            }
            if (newText) {
                $(".estimate-page").find(".custom-category-text").each(function () {
                    let ref = $(this);
                    let refChild = ref.children(".category-text");
                    if (oldValue == refChild.html()) {
                        refChild.html(newText);
                        ref.attr({ onclick: "ACC.estimate.customCategoryView(this, '" + newText + "')" })
                    }
                });
            }
        });
        ACC.estimate.customCategoryList(""); //creating category lists
        ACC.estimate.customCategoryMode("view"); //changing to view mode
    },
    editCustomerDetails: function () {
        $("#cname").val($(".company-name").text());
        $("#Caddress").val($("#Caddress").attr("data-default"));
        $("#apartment").val($("#apartment").attr("data-default"));
        $("#estimateCity").val($("#estimateCity").attr("data-default"));
        var arg = $("#estimateState").attr("data-default");
        $("#estimateState > option").each(function () {
            if ($(this).text() == arg) {
                $(this).parent('select').val($(this).val());
            }
        });
        $("#estimateZipcode").val($("#estimateZipcode").attr("data-default"));
        $("#estimatePhone").val($(".company-phone").text());
        $("#estimateEmail").val($(".company-email").text());
        ACC.estimate.popupEffect("show","fade",".estimate-popup");
    },
    updateCustomerDetails: function () {
        $(".company-name").text($("#cname").val());
        $(".company-address").eq(0).html($("#Caddress").val() + ", " + $("#apartment").val());
        $(".company-address").eq(1).html($("#estimateCity").val() + ", " + $("#estimateState").find(":selected").text() + "&nbsp;" + $("#estimateZipcode").val());
        $("#Caddress").attr("data-default", $("#Caddress").val());
        $("#apartment").attr("data-default", $("#apartment").val());
        $("#estimateCity").attr("data-default", $("#estimateCity").val());
        $("#estimateState").attr("data-default", $("#estimateState").find(":selected").text());
        $("#estimateZipcode").attr("data-default", $("#estimateZipcode").val());
        $(".company-phone").text($("#estimatePhone").val());
        $(".company-email").text($("#estimateEmail").val());
        ACC.estimate.popupEffect("hide","fold",".estimate-popup");
    },
    bindEstimateGenerationOptions: function (ref) { // change text on click on estimate generation options
    	var value = $(ref).val();
        $(".estimate-generate-option-txt").addClass("hidden");
        $("#" + value + "_txt").removeClass("hidden");
        $('[onclick^="ACC.estimate.estimatePDF"]').attr("onclick", "ACC.estimate.estimatePDF('" + value + "')");
    },
    popupEffect: function (mode, type, ref) {
		let target = $(ref);
		if(mode == "show"){
			if($('.showing-popup').length){
				$('.showing-popup').removeClass("showing-popup").effect('fold', 500);
			}
			target.addClass("showing-popup").show(type, 500);
		}
		else if(target.hasClass("showing-popup")){
        	target.removeClass("showing-popup").effect(type, 500);
		}
    },
    uploadLogo: function () { //uploading contractor logo
		let target = $(".logo-popup");
		let imgFileData = new FormData();
		let imgFile = $("#uploadedImage")[0].files[0];
		imgFileData.append('file', imgFile);
		target.find(".upload-logo-btn").removeClass("upload-logo-error");
		target.find(".estimate-size-error").addClass("hidden");
		target.find(".estimate-type-error").addClass("hidden");
		if(imgFile.type != 'image/png' && imgFile.type != 'image/jpg' && imgFile.type != 'image/jpeg' && imgFile.type != 'image/gif'){
			target.find(".estimate-type-error").removeClass("hidden");
			target.find(".upload-logo-btn").addClass("upload-logo-error");
			target.find("#uploadedImage").prop("value", "");
			return;
		}
		var reader = new FileReader();
		reader.readAsDataURL(imgFile);
        reader.onload = function (e) {
			var image = new Image(); //Set the Base64 string return from FileReader as source.
            image.src = e.target.result; //Validate the File Height and Width.
            image.onload = function () {
                if (this.width > 1200 || this.height > 400) {
                    target.find(".estimate-size-error").removeClass("hidden");
					target.find(".upload-logo-btn").addClass("upload-logo-error");
					target.find("#uploadedImage").prop("value", "");
                    return false;
                }
                else{
           			$(".contractor-logo").eq(1).attr({src: image.src ,"data-type": imgFile.type});
					ACC.estimate.logoPopupMode('upload');
				}
            };
        }
    },
    saveLogo: function (type) { //saving/deleting contractor logo
		let hideClasses = ".delete-logo-btn, .contractor-logo-btn";
    	let showClasses = ".upload-logo-btn";
		if(type == "delete"){
	    	let imageName = $(".contractor-logo").eq(1).attr("src");
	    	imageName = (imageName && imageName != "")? imageName.slice(imageName.lastIndexOf("/")+1) : "";
			$.ajax({
				url: ACC.config.encodedContextPath + '/savedList/deleteImage',
				type: 'post',
				success: function(response){
					if(response){
						$(".contractor-logo").attr('src', "");
						$(hideClasses).hide();
						$(showClasses).show();
					}
				},
				error: function(response){
					if(response){
						$(".contractor-logo").attr('src', "");
						$(hideClasses).hide();
						$(showClasses).show();
					}
				}
			});
            ACC.estimate.popupEffect("hide","drop",".logo-popup");
		}
    },
    logoPopupMode: function (hide) {
        let target = $(".logo-popup");
        let show = (hide == 'upload')? 'delete' : 'upload';
        let type = (hide == 'upload')? 'logo' : '';
        target.find("." + hide + "-logo-btn, .estimate-logo-" + show).hide();
        target.find("." + show + "-logo-btn, .estimate-logo-" + hide).show();
        if(type != "logo"){
        	target.find("#uploadedImage").prop("value", "");
		}
    },
    editLogo: function () { //edit the LOGO
        ACC.estimate.logoPopupMode('upload');
        ACC.estimate.popupEffect("show","slide",".logo-popup");
    },
    calculateImageWidthHeight: function(src, maxWidth=60, maxHeight=20) {
    	return new Promise((resolve, reject) => {
    	
    		function loadImageAndCal(src) {
	    		var image = new Image();
	    		
	    		image.onload = function () {
	    			var imageRation = ACC.estimate.calculateAspectRatioFit(this.width, this.height, maxWidth, maxHeight);
	    			
	    			resolve({
	    				width: imageRation.width, 
	    				height: imageRation.height
	    			});
	    		};
	    		image.src = src;
	    	} 
	    	
	    	if(src.startsWith("data:image/")){
	    		loadImageAndCal(src)
	    	} else {
	    		fetch(src)
	    		  .then(response => response.blob())
	    		  .then(blob => {
	    			  var reader = new FileReader();
	    			  reader.onload = function (e) {
	    				  loadImageAndCal(e.target.result);
	    			  }
	    			  reader.readAsDataURL(blob);
				  })
	    		
	    	}
    	})
    },
    calculateAspectRatioFit: function(srcWidth, srcHeight, maxWidth, maxHeight) {
        var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);

        return { width: srcWidth*ratio, height: srcHeight*ratio };
    }
};
ACC.myquotes = {
    _autoload: [
        "myquotesPage"
    ],
    qNumber: [],
    qJobName: [],
    qSubmittedDate: [],
    qExpirationDate: [],
    qStatus: [],
    qAccount: [],
    qUnitId: [],
    qUnitName: [],
    qTotalPrice: [],
    qAccountQuotes: [],
    defaultPage: 25,
    pageShowing: 0,
    resultFound: 0,
    totalPage: 0,
    filterView: false,
    unitID: '',
    unitName: '',
    myquotesPage: function () {
        if ($(".page-my-quotes").length) {
            let unitID = $("#unitUid");
            let unitName = $(".shipto-header");
            ACC.myquotes.unitID = unitID.length && unitID.val() != '' ? $.trim(unitID.val()).split("_")[0] : 9999999999;
            ACC.myquotes.unitName = unitName.length && unitName.attr("title") != '' ? $.trim(unitName.attr("title")) : '';
            $('.quotes-show').prepend('<div class="quoteShowLabel hidden" ><label class="f-s-18" for="shipto_account_0">' + ACC.myquotes.unitName + '</label><span class="radio-button-circle" ><input type="radio" id="shipto_account_0" class="quote-account-radio" name="quoteShipToAccount" value="' + ACC.myquotes.unitID + '" data-accname="' + ACC.myquotes.unitName + '" checked="checked" /></span></div>');
            ACC.myquotes.qAccount.push(ACC.myquotes.unitID);
            ACC.myquotes.getShipToQuotes(true);
            $(".from-input input").on("focusout", function () {
                let target = $(this);
                if (target.val() == "") {
                    $(".from-input-label").fadeIn();
                }
                else {
                    $(".from-input-label").fadeOut();
                }
            });
            for (let j = 0; j < ACC.myquotes.qStatus.length; j++) {
                $('[data-quotefilter]').eq(2).append('<option value="' + ACC.myquotes.qStatus[j] + '">' + ACC.myquotes.qStatus[j] + '</option>')
            }
            ACC.myquotes.quotesPageView('my account: quotes', 'my account', 'my account: quotes');
            $(".quotes-pill-toggle-input").on('keyup', function (e) {
                if (e.keyCode == 13) {
                    ACC.myquotes.quoteSearch('.quotes-pill-toggle-input','.quotes-pill-toggle','all');
                }
            });
        }
        if ($(".page-quote-detail").length) {
            if(!$(".quote-table-entry").length){
                $(".quote-stickey-header").remove();
            }
            let quoteExDateElem = $(".quote-expiration-date");
            let quoteExDate = quoteExDateElem.html().split('/');
            let quoteExDateVal = ACC.myquotes.isDateExpired(quoteExDate[2], quoteExDate[0], quoteExDate[1]);
            if (ACC.global.wWidth < 720) {
                for (let j = 0; j < 1; j++) {
                    let target1 = $(".quote-height-adjust").eq(j);
                    let target2 = $(".quote-height-adjust").eq(j + 1);
                    if (target1.height() > target2.height()) {
                        target2.height(target1.height());
                    }
                    else if (target2.height() > target1.height()) {
                        target1.height(target2.height());
                    }
                }
                $(".quote-table-entry").find('[data-opacity]').each(function () {
                    let ref = $(this);
                    if (ref.data("opacity") == 'no') {
                        ref.addClass("hidden");
                    }
                });
            }
            else {
                let maxHeightAdjust = 0;
                for (let j = 0; j < 6; j++) {
                    let target = $(".quote-height-adjust").eq(j);
                    maxHeightAdjust = (maxHeightAdjust < target.height()) ? target.height() : maxHeightAdjust;
                }
                $(".quote-height-adjust").height(maxHeightAdjust);
                $(".quote-table-entry").find('[data-opacity]').each(function () {
                    let ref = $(this);
                    if (ref.data("opacity") == 'no') {
                        ref.css("opacity", "0");
                    }
                });
            }
            if (quoteExDateVal) {
                quoteExDateElem.css("color", "#E40101");
                $(".quote-expiration-date-show").removeClass("hidden");
                $(".quote-expiration-date-hide").remove();
                $(".col-md-selecion").removeClass("col-md-11pe col-xs-11 pad-xs-lft-10 col-md-selecion");
            }
            ACC.myquotes.stickeyHeaderTop = $(".quote-stickey-header").length ? $(".quote-stickey-header").offset().top : 0;
            ACC.myquotes.detilsToatlShow();
            $(".quotedetails-page").css("opacity", 1);
            ACC.myquotes.quotesPageView('my account: quotes: quote detail: ' + $(".quote-details-data").data("quotenumber"), 'my account', 'my account: quotes: quote detail: ' + $(".quote-details-data").data("quotenumber"));
        }
        if ($(".page-my-quotes").length || $(".page-quote-detail").length) {
            $(window).on("scroll", function () {
                let scrollTop = $(this).scrollTop();
                if (scrollTop > 700) {
                    $(".btn-page-scroll").attr("style", "display: block !important;");
                }
                else {
                    $(".btn-page-scroll").attr("style", "display: none !important;");
                }
                if ($(".page-quote-detail").length && ACC.global.wWidth > 700) {
                    ACC.myquotes.stickeyHeader(this);
                }
                if (ACC.global.wWidth < 1200) { //xs and SM
                    ACC.myquotes.pillToggleSticky(scrollTop);
                }
            });
            $('[data-toggle="popover"]').popover({ placement: 'top', trigger: 'hover', container: 'body' });
        }
    },
    pillSelected: 'open',
    pillToggle: function (ref, className, type) {
        let target = $(ref);
        ACC.myquotes.quoteSearchMode = false;
        if (!target.hasClass("active")) {
            $(className).removeClass("active");
            target.addClass("active");
            $(".quotes-pill-toggle-all").addClass("disabled").prop("disabled", true);
            $(".quote-filter-popup-button").removeClass("disabled active hidden").prop("disabled", false);
            $(".quotes-pill-toggle-input").val(""); //no search mode
            $(".from-input-label").show();
            ACC.myquotes.pillSelected = type;
            ACC.myquotes.showAjaxPage = 1;
            $(".quote-selected-account").each(function(){
                if($(this).prop("checked")){
                    $(this).prop("checked", false);
                }
            });
            $(".quote-selected-account-count").html($(".quote-selected-account-count").data("stext"));
            ACC.myquotes.getShipToQuotes(false, true);
        }
    },
    quoteSearchMode: false,
    quoteSearch: function (ref, className, type) {
        let target = $(ref);
        if (target.val() && target.val() != "") {
            if(!ACC.myquotes.quoteSearchMode){
                ACC.myquotes.quoteSearchMode = true;
                $(className).removeClass("active");
                target.removeClass("border-red");
                $(".quotes-pill-toggle-all").removeClass("disabled").prop("disabled", false).addClass("active");
                $(".quote-filter-popup-button").addClass("hidden disabled").prop("disabled", true);
                ACC.myquotes.pillSelected = type;
                ACC.myquotes.showAjaxPage = 1;
                ACC.myquotes.getShipToQuotes(false, true);
            }
            else{
                ACC.myquotes.showAjaxPage = 1;
                ACC.myquotes.updateQuoteFilter(true);
            }
        }
        else {
            target.addClass("border-red");
        }
    },
    getShipToAccounts: function () {
        $.ajax({
            url: ACC.config.encodedContextPath + "/my-account/shiptoQuote",
            type: "get",
            success: function (a) {
                let qAccountData = a.itemDetails; //a.accounts;
                let quotesFound = 0;
                if (qAccountData && qAccountData.length) {
                    for (let j = 1; j <= qAccountData.length; j++) {
                        let customerNumber = qAccountData[j - 1].customerNumber ? $.trim(qAccountData[j - 1].customerNumber) : '';
                        let customerName = qAccountData[j - 1].customerName ? $.trim(qAccountData[j - 1].customerName) : '';
                        if (qAccountData[j - 1].quoteCount != 0 && $.inArray(customerNumber, ACC.myquotes.qAccount) == -1) {
                            ACC.myquotes.qAccount.push(customerNumber);
                            $('.quotes-show').append('<div class="quoteShowLabel"><label class="f-s-18" for="shipto_account_' + j + '">' + customerName + ' #' + customerNumber + ' (' + qAccountData[j - 1].quoteCount + ') </label><span class="radio-button-circle"><input type="radio" id="shipto_account_' + j + '" class="quote-account-radio" data-accname="' + customerName + '" name="quoteShipToAccount" value="' + customerNumber + '" /></span></div>');
                            quotesFound++;
                        }
                    }
                    if (quotesFound) {
                        $(".quotes-shipto-btn").removeClass("hidden");
                    }
                    else {
                        $(".quotes-shipto-btn").addClass("hidden");
                    }
                }
                else {
                    //ACC.myquotes.quotePopupError();
                }
            },
            error: function () {
                ACC.myquotes.quotePopupError();
            }
        });
    },
    getShipToQuotes: function (onload, pageClick) {
        if (!pageClick) {
            ACC.myquotes.showAjaxPage = 1;
            $('.quotes-pill-toggle').removeClass("active");
            $('.quotes-pill-toggle-open').addClass("active");
            ACC.myquotes.pillSelected = 'Open';
        }
        loading.start();
        ACC.myquotes.quotesAjaxValue = (ACC.myquotes.showAjaxPage - 1) * ACC.myquotes.perPageAjaxQuotes;
        let target = $("input[name=quoteShipToAccount]:checked");
        let accountNumber = target.val();
        $(".quote-table").remove();
        target.data("fatch", false); //always restting as we need fresh data
        var shipToBtnText = '<span class="text-green bold">Select Ship-To</span>';
        if (!target.data("fatch")) {
            if (!$("#shipto_account_0").prop('checked')) {
                if (ACC.global.wWidth > 1200) {
                    shipToBtnText = '<span class="text-green bold">Ship-To: </span><span class="text-dark-gray">' + accountNumber + ' ' + target.data('accname') + '</span>';
                }
                else {
                    $(".quotes-shipto-info").html('<span class="bold">Ship-To: </span><span>' + accountNumber + ' ' + target.data('accname') + '</span><hr>');
                }
            }
            else {
                $(".quotes-shipto-info").html("");
            }
            $('.quotes-shipto-btn').html(shipToBtnText);
            $.ajax({
                url: ACC.config.encodedContextPath + "/my-account/shipping-Quotes",
                type: "get",
                data: { customerNumber: accountNumber, skipCount: ACC.myquotes.quotesAjaxValue, toggle: ACC.myquotes.pillSelected },
                success: function (qAccountData) {
                    ACC.myquotes.createQuotesLineItems(qAccountData);
                },
                error: function () {
                    ACC.myquotes.updateQuoteFilter(true);
                }
            });
        }
        else {
            ACC.myquotes.updateQuoteFilter(true);
        }
    },
    createQuotesLineItems: function (qAccountData) {
        ACC.myquotes.totalAjaxQuotes = 0;
        //let qAccountData = ACC.myquotes.pillSelected == 'open' || ACC.myquotes.pillSelected == 'Open' ? rawData.open : ACC.myquotes.pillSelected == 'full' ? rawData.full : ACC.myquotes.pillSelected == 'all' ? rawData.all : rawData.expired;
        let qAccountDataHTML = "";
        if (qAccountData) {
            ACC.myquotes.qUnitId = [];
            ACC.myquotes.qUnitName = [];
            ACC.myquotes.qAccountQuotes = [];
            for (let j = 0; j < qAccountData.length; j++) {
                if (j < qAccountData.length - 1) {
                    let quoteId = qAccountData[j].quoteId;
                    let quoteNum = qAccountData[j].quoteNumber;
                    let quoteJob = qAccountData[j].jobName;
                    let quoteAccount = qAccountData[j].accountName ? $.trim(qAccountData[j].accountName) : '';
                    let quoteSubDate = qAccountData[j].lastModfDate;
                    let quoteExpDate = qAccountData[j].expirationDate;
                    let quotePrice = qAccountData[j].totalPrice.value;
                    let quoteNote = qAccountData[j].notes ? 1 : 0;
                    let quoteNoteText = qAccountData[j].notes;
                    let quoteApprove = qAccountData[j].isQuoteApproved ? 1 : 0;
                    let isFullQuoteApprove = qAccountData[j].isFullQuoteApproved ? 1 : 0;
                    let customerNumber = qAccountData[j].accountNumber ? $.trim(qAccountData[j].accountNumber) : '';
                    let viewLink = "this,'" + quoteId + "','" + quoteNum + "','" + quotePrice + "'";
                    let adobeLink = "'','View Quote','my account: quotes'";
                    qAccountDataHTML += '<div class="row margin0 p-l-15 p-r-15 p-y-20 no-padding-xs flex-center justify-center flex-wrap-xs add-border-radius text-default f-s-15 font-14-xs quote-table bg-white" data-quote="' + quoteNum + '" data-account="' + customerNumber + '" data-totalp="' + quotePrice + '" style="display: none;"><div class="col-md-3 col-md-11pe col-xs-12 b-b-grey-xs"><div class="row"><div class="col-md-12 col-xs-6 p-15-xs p-b-0-xs"><p class="m-b-0 bold text-gray text-uppercase f-s-10 hidden-md hidden-lg">Quote Number</p><button class="btn btn-link p-l-0 p-t-0-xs transition-3s bold-text text-green quoteNum" onclick="ACC.myquotes.detilsView(' + viewLink + ');ACC.adobelinktracking.quotesView(' + adobeLink + ');">' + quoteNum + '</button></div><div class="col-xs-6 p-15-xs p-b-0-xs b-l-grey-xs hidden-md hidden-lg"><p class="margin0 pad-xs-lft-15 bold text-gray text-uppercase f-s-10 hidden-md hidden-lg">Approved</p><button class="btn btn-link transition-3s no-margin-xs p-t-5-xs p-b-0-xs" data-toggle="popover" data-content="' + (isFullQuoteApprove ? 'All Items Approved' : 'Select Items Approved') + '" style="opacity:' + quoteApprove + '"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="19" viewBox="0 0 18 18" fill="none" class=""><circle cx="9" cy="9" r="9" fill="#78A22F"></circle><path d="M7.39097 12.7555L4.60526 9.90546C4.43383 9.73403 4.43383 9.45545 4.60526 9.28403L5.21597 8.6626C5.37668 8.49117 5.64454 8.49117 5.81597 8.6626L7.69097 10.5805L11.7088 6.47688C11.8695 6.30546 12.1374 6.30546 12.3088 6.47688L12.9195 7.09831C13.091 7.26974 13.091 7.54831 12.9195 7.71974L7.99097 12.7555C7.83026 12.9269 7.5624 12.9269 7.39097 12.7555Z" fill="white"></path></svg></button></div></div></div><div class="col-md-2 col-xs-12 p-15-xs text-capitalize b-b-grey-xs"><p class="m-b-0 bold text-gray text-uppercase f-s-10 hidden-md hidden-lg">Job Name</p><span class="no-margin-xs quoteJob">' + quoteJob + '</span></div><div class="col-md-2 col-xs-12 p-15-xs b-b-grey-xs"><p class="m-b-0 bold text-gray text-uppercase f-s-10 hidden-md hidden-lg">Account Name</p><span class="no-margin-xs quoteAccount">' + quoteAccount + '</span></div><div class="col-md-3 col-md-13pe col-xs-12 b-b-grey-xs"><div class="row"><div class="col-md-12 col-xs-6 p-15-xs"><p class="m-b-0 bold text-gray text-uppercase f-s-10 hidden-md hidden-lg">Last Modified</p><span class="no-margin-xs quote-submitted-date">' + quoteSubDate + '</span></div><div class="col-xs-6 p-15-xs b-l-grey-xs hidden-md hidden-lg"><p class="m-b-0 bold text-gray text-uppercase f-s-10 hidden-md hidden-lg">Expiration Date</p><p class="no-margin-xs quote-expiration-date">' + quoteExpDate + '</p></div></div></div><div class="col-md-3 col-md-13pe hidden-xs hidden-sm quote-expiration-date">' + quoteExpDate + '</div><div class="col-md-1 col-md-10pe col-xs-12 padding0 pad-xs-lft-15 pad-xs-rgt-15"><div class="row"><div class="col-md-12 col-xs-6 p-15-xs"><p class="m-b-0 bold text-gray text-uppercase f-s-10 hidden-md hidden-lg">Total</p><span class="no-margin-xs f-w-b-xs quotePrice">$' + ACC.savedlist.formatNumberComma(quotePrice) + '</span></div><div class="col-xs-6 p-15-xs hidden-md hidden-lg"><button class="btn btn-primary btn-block no-margin-xs transition-3s" onclick="ACC.myquotes.detilsView(' + viewLink + ');ACC.adobelinktracking.quotesView(' + adobeLink + ');">View</button></div></div></div><div class="col-md-1 col-md-10pe text-center hidden-xs hidden-sm"><button class="btn btn-link transition-3s approve-btn ' + (quoteApprove ? '' : 'hidden') + '" data-toggle="popover" data-content="' + (isFullQuoteApprove ? 'All Items Approved' : 'Select Items Approved') + '" style="opacity:' + quoteApprove + '"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="19" viewBox="0 0 18 18" fill="none" class=""><circle cx="9" cy="9" r="9" fill="#78A22F"></circle><path d="M7.39097 12.7555L4.60526 9.90546C4.43383 9.73403 4.43383 9.45545 4.60526 9.28403L5.21597 8.6626C5.37668 8.49117 5.64454 8.49117 5.81597 8.6626L7.69097 10.5805L11.7088 6.47688C11.8695 6.30546 12.1374 6.30546 12.3088 6.47688L12.9195 7.09831C13.091 7.26974 13.091 7.54831 12.9195 7.71974L7.99097 12.7555C7.83026 12.9269 7.5624 12.9269 7.39097 12.7555Z" fill="white"></path></svg></button></div><div class="col-md-1 col-md-9pe p-l-0 hidden-xs hidden-sm"><button class="btn btn-primary btn-block transition-3s" onclick="ACC.myquotes.detilsView(' + viewLink + ');ACC.adobelinktracking.quotesView(' + adobeLink + ');">View</button></div></div>';
                    let unitIndex = $.inArray(customerNumber, ACC.myquotes.qUnitId);
                    if (customerNumber != "" && unitIndex == -1) {
                        ACC.myquotes.qUnitId.push(customerNumber);
                        ACC.myquotes.qUnitName.push(quoteAccount);
                        ACC.myquotes.qAccountQuotes.push(1);
                    }
                    else if (customerNumber != "") {
                        ACC.myquotes.qAccountQuotes[unitIndex] = ACC.myquotes.qAccountQuotes[unitIndex] + 1;
                    }
                    ACC.myquotes.totalAjaxQuotes++;
                }
                else {
                    ACC.myquotes.perPageAjaxQuotes = qAccountData[j].pageSize;
                }
            }
            $(qAccountDataHTML).insertBefore('.quote-no-filter-results');
            if (onload) {
                $("input[name=quoteShipToAccount]").eq(0).prop("checked", true);
            }
            ACC.myquotes.quotesFilterAccount(); //creating quotes account filter
            ACC.myquotes.arangeQuoteResults();
            $('[data-toggle="popover"]').popover({ placement: 'top', trigger: 'hover', container: 'body' });
            ACC.myquotes.updateQuoteFilter(true);
        }
        else {
            ACC.myquotes.quotePopupError();
        }
    },
    quotesFilterAccount: function () {
        let refHTML = "";
        let foundFilter = 0;
        let target = $(".quote-filter-popup");
        let textmaxNum = Math.round(((ACC.global.wWidth > 1024 ? target.width() : ACC.global.wWidth) - 80) / 7.2);
        for (let i = 0; i < ACC.myquotes.qUnitId.length; i++) {
            let hiddenClass = " hidden";
            if (ACC.myquotes.qUnitId[i].indexOf("-") != -1) {
                hiddenClass = "";
                foundFilter++;
            }
            let accText = ACC.myquotes.qUnitName[i].length > textmaxNum ? ACC.myquotes.qUnitName[i].slice(0, textmaxNum - 2) + "..." : ACC.myquotes.qUnitName[i];
            refHTML += '<label class="flex-center font-size-14 p-y-5 p-l-20 p-r-30 l-h-18 pointer text-align-left text-dark-gray transition-3s list-group-item' + hiddenClass + '" for="selected-account-' + i + '"><span class="colored-primary hidden-print p-r-5"><input onchange="ACC.myquotes.quotesFilterAccountClick()" aria-label="Checkbox" id="selected-account-' + i + '" class="text-align-center list-group-item-check quote-selected-account" type="checkbox" value="' + ACC.myquotes.qUnitName[i] + '" data-role="' + i + '" data-account="' + ACC.myquotes.qUnitName[i] + '" data-unit="' + ACC.myquotes.qUnitId[i] + '"></span>' + accText + '<span class="text-gray list-group-item-badge" data-rdefault="' + i + '" data-rcount="' + ACC.myquotes.qAccountQuotes[i] + '">' + ACC.myquotes.qAccountQuotes[i] + '</span></label>';
        }
        if (ACC.global.wWidth <= 1024) {
            let headerHeight = $(".global-header-sticky").height();
            $(".quote-filter-popup-box").css({ top: headerHeight, height: ACC.global.wHeight - headerHeight });
            $(".quote-filter-popup-accounts").height(ACC.global.wHeight - headerHeight - 160);
        }
        $(".quote-filter-popup-accounts").html(refHTML);
        if (foundFilter) {
            target.css({ opacity: 1 });
        }
        else {
            target.css({ opacity: 0 });
        }
    },
    quotesFilterAccountClick: function () {
        let checkNumber = 0;
        $(".quote-selected-account").each(function () {
            if ($(this).prop("checked")) {
                checkNumber++;
            }
        });
        if (checkNumber) {
            $(".quote-selected-account-count").html(checkNumber);
        }
        else {
            $(".quote-selected-account-count").html($(".quote-selected-account-count").data("stext"));
        }
    },
    toggleOffElems: function (e, eElem, className, offTarget) {
        let target = $(eElem);
        let ref = (e) ? $(e) : target;
        if (target.is(":visible")) {
            $(eElem + '-overlay').hide();
            target.hide();
            $(eElem + '-button').removeClass(className);;
            ref.removeClass(className);
        }
        else {
            if (offTarget) {
                $(offTarget + '.active').removeClass("active");
            }
            $(eElem + '-overlay').show();
            target.show();
            ref.addClass(className);
        }
    },
    arangeQuoteResults: function () {
        ACC.myquotes.qNumber = [];
        ACC.myquotes.qJobName = [];
        ACC.myquotes.qSubmittedDate = [];
        ACC.myquotes.qExpirationDate = [];
        ACC.myquotes.qStatus = [];
        ACC.myquotes.qTotalPrice = [];
        $(".quote-table").each(function (e) {
            let target = $(this);
            let quoteNum = target.find(".quoteNum");
            let quoteJob = target.find(".quoteJob");
            let quoteStatus = target.find(".quoteStatus");
            let totalPrice = Number(target.attr("data-totalP"));
            let num = $.trim(quoteNum.text());
            let numOld = num;
            let job = $.trim(quoteJob.text()) + '--' + num;
            let status = $.trim(quoteStatus.text());
            let quoteDateElem = target.find(".quote-submitted-date");
            let quoteDate = quoteDateElem.html().split('/');
            let quoteDateVal = ACC.myquotes.isDateExpired(quoteDate[2], quoteDate[0], quoteDate[1], true);
            let sDate = quoteDateVal[1] + '--' + num;
            let quoteExDateElem = target.find(".quote-expiration-date");
            let quoteExDate = quoteExDateElem.eq(0).html().split('/');
            let quoteExDateVal = ACC.myquotes.isDateExpired(quoteExDate[2], quoteExDate[0], quoteExDate[1], true);
            let eDate = quoteExDateVal[1] + '--' + num;
            let dDate = quoteDateVal[2];
            num += '--' + totalPrice;
            totalPrice += numOld * .000000001;
            target.attr({ "data-quote": num, "data-job": job, "data-date": sDate, "data-edate": eDate, "data-day": dDate, "data-status": status, "data-price": totalPrice });
            ACC.myquotes.qNumber.push(num);
            ACC.myquotes.qJobName.push(job);
            ACC.myquotes.qSubmittedDate.push(sDate);
            ACC.myquotes.qExpirationDate.push(eDate);
            ACC.myquotes.qTotalPrice.push(totalPrice);
            if (quoteExDateVal[0]) {
                quoteExDateElem.html('<button onclick="ACC.myquotes.updateExpiredQuote(this,'+ numOld +',\''+ target.find(".quotePrice").text() +'\')" data-toggle="popover" data-content="Request an updated quote." class="border-none p-y-5 border-radius-3-imp quote-update-expired-btn"><span class="f-s-15 f-w-700" style="color: #E40101;">'+ quoteExDate.join('/') +'</span></button>');
            }
        });
        $(".quote-update-expired-btn").popover({ placement: 'top', trigger: 'hover', container: 'body' });
        ACC.myquotes.qNumber.sort();
        ACC.myquotes.qJobName.sort();
        ACC.myquotes.qSubmittedDate.sort().reverse();
        ACC.myquotes.qExpirationDate.sort().reverse();
        ACC.myquotes.qTotalPrice.sort(function (a, b) { return b - a });
    },
    generateRandomNum: function (min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
    },
    generateRandomStatus: function (text) {
        return text[ACC.myquotes.generateRandomNum(1, text.length) - 1];
    },
    isDateExpired: function (year, month, date, time) {
        let today = new Date();
        var date = new Date(year, (month - 1), date, 23, 59, 0, 0);
        let isDateExpired = (today > date) ? true : false;
        let days = Math.floor((today.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));
        return (time) ? [isDateExpired, date.getTime(), days] : isDateExpired;
    },
    updateExpiredQuote: function (event, quote, quotePrice) {
        let ref = $(event);
        //console.log(ref, quote, quotePrice);
        quote = !quote ? $(".quote-number").text() : quote;
        quotePrice = !quotePrice ? $(".quotePrice").text() : quotePrice;
        ACC.colorbox.open("", {
            html: $(".quote-update-expired").html(),
            width: ACC.global.wWidth < 1024 ? 412 : 725,
            className: "quotes-popup-expired text-center",
            onComplete: function () {
                $(".quote-update-expired-number").html(quote);
                $("#cboxLoadedContent").append('<span class="hidden quotePrice">'+ quotePrice +'</span>');
                //console.log('<span class="quotePrice">'+ quotePrice +'</span>');
            }
        });
    },
    sendExpiredQuote: function () {
        let quoteNumber = $(".quotes-popup-expired .quote-update-expired-number").text();
        let customerNumber = $("input[name=quoteShipToAccount]:checked").val();
        let notes = $(".quotes-popup-expired .quote-update-expired-input").val();
        let quoteTotal = $(".quotes-popup-expired .quotePrice").text();
        $('.quotes-popup-expired [onclick="ACC.myquotes.sendExpiredQuote()"]').removeAttr("onclick");
        //console.log(quoteNumber, customerNumber, notes, quoteTotal);
        if(quoteNumber && quoteNumber != ""){
            customerNumber = customerNumber && customerNumber != "" ? customerNumber : "";
            notes = notes && notes != "" ? notes : "";
            quoteTotal = quoteTotal && quoteTotal != "" ? quoteTotal : "$0.00";
            $.ajax({
                url: ACC.config.encodedContextPath + "/my-account/updateExpiredQuote",
                type: "post",
                data: { quoteNumber: quoteNumber, customerNumber: customerNumber, notes: notes, quoteTotal: quoteTotal},
                success: function (resp) {
                    if(resp == 'Success' || resp == 'success'){
                        ACC.colorbox.close();
                    }
                    else{
                        ACC.myquotes.quotePopupError();
                    }
                },
                error: function () {
                    ACC.myquotes.quotePopupError();
                }
            });
        }
        else{
            ACC.myquotes.quotePopupError();
        }
    },
    filterPopup: function (mode, pos, ref, bodyScroll, showFor) { // filter popup show/hide
        let target = $(ref);
        pos = pos.toString().indexOf("-") != -1 ? pos : -pos;
        let popupRight = ($('.page-detailsSavedListPage').length || $('.page-invoicelistingpage').length) ? 15 : 0;
        if (mode == "show") {
            if ($('.showing-popup').length) {
                $('.showing-popup').removeClass("showing-popup").animate({ right: pos }, 333);
            }
            else if (bodyScroll) {
                $('body, html').css({ overflow: "hidden" });
            }
            $('.quote-popup-section').addClass("hidden");
            $('.' + showFor).removeClass("hidden");
            target.addClass("showing-popup").animate({ right: popupRight }, 333);
        }
        else if (target.hasClass("showing-popup")) {
            target.removeClass("showing-popup").animate({ right: pos }, 333);
            if (bodyScroll) {
                $('body, html').css({ overflow: "hidden" });
            }
        }
    },
    updateQuoteFilter: function (pageload, sort, all) { //checking for filter updates
        if (pageload == undefined) {
            ACC.myquotes.filterView = true;
            $(".reverse-sorting").removeClass("reverse-sorting");
        }
        let newFilters = {
            search: "",
            time: "",
            status: "",
            account: [],
            sort: "",
            view: ""
        };
        let filterChanged = false;
        $(".quote-selected-account").each(function (e) {
            let ref = $(this);
            if (ref.prop("checked")) {
                newFilters.account.push(ref.data("unit"));
            }
        });
        $("[data-quotefilter]").each(function (e) {
            let target = $(this);
            let defaultVal = target.data('quotefilter');
            let targetInput = target.is('input');
            let currentVal = (targetInput) ? $.trim(target.val().toLowerCase()) : target.find(":selected").val();
            if (currentVal != "") {
                filterChanged = true;
                loading.start();
                if (e == 0) {
                    newFilters.time = (!ACC.myquotes.filterView && all) ? all : currentVal;
                }
                else if (e == 1) {
                    newFilters.status = currentVal.toLowerCase();
                }
                else if (e == 2) {
                    //newFilters.account = '';
                }
                else if (e == 3) {
                    newFilters.sort = (sort) ? sort : currentVal.toLowerCase();
                }
                else if (e == 5) {
                    newFilters.search = currentVal.toLowerCase();
                }
                else {
                    currentVal = ACC.myquotes.perPageAjaxQuotes; //depends on the AJAX response
                    newFilters.view = currentVal;
                    ACC.myquotes.defaultPage = currentVal
                }
                target.data("quotefilter", currentVal);
            }
        });
        if (filterChanged) { //filter updated
            ACC.myquotes.applyQuoteFilter(newFilters, pageload);
        }
        loading.stop();
    },
    quotesAjaxValue: 0, //AJAX input
    perPageAjaxQuotes: 25, //AJAX response
    totalAjaxQuotes: 125, //AJAX response
    showAjaxPage: 1, //default is 1 or pagination num
    totalAjaxPages: 1, //default is 1 or depends on AJAX response
    applyQuoteFilter: function (newFilters, pageload) { //resetting the page as per the new filter
        ACC.myquotes.resultFound = 0;
        ACC.myquotes.totalPage = 1;
        ACC.myquotes.pageShowing = 1;
        let pagination = $(".quote-pagination");
        let noFilter = $(".quote-no-filter-results");
        let sortParent = $("[data-quotesort='" + newFilters.sort + "']");
        let reverse = false;
        $(".quote-sort-button").children("svg").css("opacity", .4);
        sortParent.children("svg").css("opacity", 1).children("path").eq(1);
        if (pageload || !sortParent.hasClass("reverse-sorting")) {
            $(".quote-sort-button").removeClass("reverse-sorting");
            sortParent.addClass("reverse-sorting");
        }
        else {
            reverse = true;
            $(".quote-sort-button").removeClass("reverse-sorting");
        }
        $(".quote-table").each(function (e) {
            let target = $(this);
            let qNumber = target.data("quote").toLowerCase().split("--")[0];
            let qName = target.data("job").toLowerCase().split("--")[0];
            let qStatus = target.data("status").toLowerCase();
            let qAccount = target.data("account");
            let qDay = target.data("day");
            let filterMatched = 'yes';
            let qOrder = $.inArray(target.data(newFilters.sort), (newFilters.sort == "date") ? ACC.myquotes.qSubmittedDate : (newFilters.sort == "edate") ? ACC.myquotes.qExpirationDate : (newFilters.sort == "price") ? ACC.myquotes.qTotalPrice : (newFilters.sort == "quote") ? ACC.myquotes.qNumber : ACC.myquotes.qJobName) + 1;
            qOrder = (reverse) ? ACC.myquotes.qNumber.length - qOrder + 1 : qOrder;
            if (newFilters.search != "" && qNumber.toString().search(newFilters.search) == -1 && qName.search(newFilters.search) == -1) {
                filterMatched = 'search';
            }
            else if (newFilters.status != "" && newFilters.status != qStatus) {
                filterMatched = 'status';
            }
            else if (newFilters.account.length && $.inArray(qAccount, newFilters.account) == -1) {
                filterMatched = 'account';
            }
            else if (newFilters.time != "" && newFilters.time < qDay) {
                filterMatched = 'qDay';
            }
            if (filterMatched == "yes") {
                if (ACC.myquotes.resultFound != 0 && ACC.myquotes.resultFound % ACC.myquotes.defaultPage == 0) {
                    ACC.myquotes.totalPage++;
                }
                ACC.myquotes.resultFound++;
            }
            target.css({ order: qOrder, display: "none" }).attr({ "data-filter": filterMatched, "data-order": qOrder, "data-pagenum": 0 });
        });
        if (!ACC.myquotes.resultFound) { //no results found
            noFilter.removeClass("hidden");
            pagination.addClass("hidden");
        }
        else { //result can be shown in page
            noFilter.addClass("hidden");
            pagination.addClass("hidden");
            ACC.myquotes.addingPageNum();
            ACC.myquotes.totalAjaxPages = Math.ceil(ACC.myquotes.resultFound / ACC.myquotes.perPageAjaxQuotes);
            if (ACC.myquotes.totalAjaxPages > 1) {
                $(".quote-page-num").remove();
                ACC.myquotes.createAjaxPageNumber(pagination, pageload);
            }
            else {
                $("[data-pagenum='1']").css("display", "flex");
            }
        }
        $(".quote-results-num").html(ACC.myquotes.resultFound); //updating result number
        $(".quote-page").css("opacity", 1);
        $(".quote-filter-popup-box").hide();
    },
    createAjaxPageNumber: function (pagination, pageload) {
        for (let index = 1; index <= ACC.myquotes.totalAjaxPages; index++) {
            $('<li class="quote-page-num"><button onclick="ACC.myquotes.showingPage(this, ' + index + ')">' + index + '</button></li>').insertBefore($(".quote-pagination-next"));
        }
        ACC.myquotes.showingPage(false, 1, pageload);
        // ACC.myquotes.showingAjaxPage(false, 1);  if the data is from the ajax
        pagination.removeClass("hidden");
    },
    showingAjaxPage: function (e, num) {
        let targetParent = $(e).parent("li");
        if (!e) {
            $(".quote-pagination-prev, .quote-pagination-next").removeClass("disabled");
            if (ACC.myquotes.showAjaxPage == 1) { //1st page
                $(".quote-pagination-prev").addClass("disabled");
            }
            else if (ACC.myquotes.showAjaxPage == ACC.myquotes.totalAjaxPages) { //last page
                $(".quote-pagination-next").addClass("disabled");
            }
            $(".quote-page-num").eq(ACC.myquotes.showAjaxPage - 1).addClass("active");
        }
        else if (e && !targetParent.hasClass("disabled") && !targetParent.hasClass("active")) {
            if (num == "prev") {
                ACC.myquotes.showAjaxPage--;
            }
            else if (num == "next") {
                ACC.myquotes.showAjaxPage++;
            }
            else {
                ACC.myquotes.showAjaxPage = num;
            }
            ACC.myquotes.pageScrollTop(".breadcrumb-section");
            ACC.myquotes.getShipToQuotes(false, true);
        }
    },
    addingPageNum: function () {
        let filterMatched = 0;
        for (let i = 1; i <= ACC.myquotes.qNumber.length; i++) {
            let target = $("[data-order='" + i + "']");
            if (target.attr("data-filter") == "yes") {
                filterMatched++;
                target.attr("data-pagenum", Math.ceil(filterMatched / ACC.myquotes.defaultPage))
            }
        }
    },
    showingPage: function (e, num, pageload) {
        let targetParent = $(e).parent("li");
        if (!e || (!targetParent.hasClass("disabled") && !targetParent.hasClass("active"))) {
            loading.start();
            if (num == "prev") {
                ACC.myquotes.pageShowing--;
            }
            else if (num == "next") {
                ACC.myquotes.pageShowing++;
            }
            else {
                ACC.myquotes.pageShowing = num;
            }
            $("[data-order]").css("display", "none");
            $("[data-pagenum='" + ACC.myquotes.pageShowing + "']").css("display", "flex");
            $(".quote-page-num").removeClass("active");
            $(".quote-page-num").eq(ACC.myquotes.pageShowing - 1).addClass("active");
            if (ACC.myquotes.totalPage == 1) {
                $(".quote-pagination-prev, .quote-pagination-next").addClass("disabled");
            }
            else if (ACC.myquotes.pageShowing == 1) { //1st page
                $(".quote-pagination-prev").addClass("disabled");
                $(".quote-pagination-next").removeClass("disabled");
            }
            else if (ACC.myquotes.pageShowing == ACC.myquotes.totalPage) { //last page
                $(".quote-pagination-prev").removeClass("disabled");
                $(".quote-pagination-next").addClass("disabled");
            }
            else { //any other page
                $(".quote-pagination-prev, .quote-pagination-next").removeClass("disabled");
            }
            if (!pageload) {
                ACC.myquotes.pageScrollTop(".breadcrumb-section");
                $(".quote-filter-popup-box").hide().removeClass("active");
            }
            loading.stop();
        }
    },
    resetQuoteFilter: function (reset) {
        $("[data-quotefilter]").each(function (e) {
            let target = $(this);
            if (target.is('input')) {
                target.val("");
            }
            else {
                target.prop("selectedIndex", 0);
            }
        });
        $(".quote-selected-account").each(function () {
            if ($(this).prop("checked")) {
                $(this).prop("checked", false);
            }
        });
        if (reset == 'shipto') {
            $("#shipto_account_0").prop('checked', true);
        }
        $(".from-input-label").fadeIn();
        ACC.myquotes.showAjaxPage = 1;
        ACC.myquotes.pillSelected = 'open';
        $('.quotes-pill-toggle').removeClass("active");
        $('.quotes-pill-toggle-open').addClass("active");
        ACC.myquotes.filterView = true;
        ACC.myquotes.getShipToQuotes(false);
        ACC.myquotes.quotesFilterAccountClick();
    },
    pageScrollTop: function (top, left) {
        $("html, body").animate({ scrollLeft: (left ? $(left).offset().left : 0), scrollTop: (top ? $(top).offset().top : 0) });
    },
    detilsView: function (ref, quoteId, qNumber) {
        let qTotal = $(ref).parents(".quote-table").find(".quotePrice").html();
        localStorage.setItem("qTotal" + qNumber, qTotal);
        window.location.href = ACC.config.encodedContextPath + '/my-account/my-quotes/' + qNumber;
    },
    formatter: new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        // These options are needed to round to whole numbers if that's what you want.
        minimumFractionDigits: 2, // (this suffices for whole numbers, but will print 2500.10 as $2,500.1)
        maximumFractionDigits: 2 // (causes 2500.99 to be printed as $2,501)
    }),
    detilsToatlShow: function () {
        let qTarget = $('.quote-table-entry');
        var extPrice = 0;
        if ($(".quote-table-entry").length) {
            for (let i = 0; i < qTarget.length; i++) {
                let target = qTarget.eq(i);
                let targetSt = target.data("st");
                let targetComment = target.data("comment");
                if(!targetSt && !targetComment){
                    extPrice = extPrice + Number(target.data("extprice"));
                }
                let unitPrice = Number(target.data("unitprice"));
                $(".quote-table-entry .quote-table .quote-unit-price").eq(i).html(ACC.myquotes.formatter.format(unitPrice));

                let extPriceRow = Number(target.data("extprice"));
                $(".quote-table-entry .quote-table .quote-ext-price").eq(i).html(ACC.myquotes.formatter.format(extPriceRow));

                let quantityRow = Number(target.data("quantity"));
                $(".quote-table-entry .quote-table .quote-quantity").eq(i).find("input").val(quantityRow);
            }
        }

        if($(".quote-details-data").length){
            let target = $('.quote-details-data');
            let remainingBidTotal = Number(target.data("remainingbidtotal"));
            $(".quote-remainingtotal").html(ACC.myquotes.formatter.format(remainingBidTotal));
        }

        $(".quote-detailstotal").html(ACC.myquotes.formatter.format(extPrice));
        
    },
    approveQuote: function (e, num, text, text2, msg, btnText, quoteNumber, requested, optional, noteoption, mobnoteoption) {
        let adobeText = 'Approve Full Quote for Order';
        let target = $(".quote-details-data");
        let accountManager = target.data("accountmanager");
        text2 = text2.replace("~~", accountManager);
        let modifiedQty = 0;
        let aprroveTotal = 0;
        let checkIteration = '';
        let editQtyRows = '';
        let qutoeChooseItems = $(".quote-details-data").data("isfullapproval") || $(".qutoe-choose-items").length < 4 ? '.qutoe-choose-items.web-item' : '.qutoe-choose-items:visible';
        if (num != "all") {
            num = $(".qutoe-choose-items:checked").length;
            adobeText = 'Approve ' + num + ' Items for Order';
            checkIteration = ':checked';
        }
        $(qutoeChooseItems + checkIteration).each(function () {
            let target = $(this);
            let targetParent = target.parents(".quote-table-entry");
            let targetUnitPrice = targetParent.data("unitprice");
            let targetQty = targetParent.data("quantity");
            let targetTitle = targetParent.data("itemdescription");
            let stringBreak = ACC.global.wWidth < 1024 ? 66 : 130;
            targetTitle = (targetTitle.length > stringBreak) ? targetTitle.substring(0, stringBreak) + "..." : targetTitle;
            if (targetParent.find(".js-default-entry-quantity:visible").length) {
                targetQty = targetParent.find(".js-number-input-event-bind").val();
                editQtyRows += "<div class='row b-b-grey b-l-grey b-r-gray b-t-grey-xs b-t-grey-sm f-s-14 f-s-11-xs-px f-s-11-sm-px text-left-xs text-left-sm margin0 p-y-10'><div class='col-xs-3 bold text-gray hidden-md hidden-lg'>ITEM</div><div class='col-md-8 col-xs-9 text-align-left p-l-0-xs p-l-0-sm'>" + targetTitle + "</div><div class='col-xs-3 text-gray hidden-md hidden-lg bold'>QTY</div><div class='col-md-4 col-xs-9 p-l-0'><p class='margin0 bold display-ib-xs'>Requested " + targetQty + "</p><span class='hidden-md hidden-lg'> / </span><p class='margin0 display-ib-xs'>Orig. Quoted " + Number(targetParent.data("quantity")).toFixed(0) + "</p></div></div>";
                modifiedQty++;
            }
            aprroveTotal += Number(targetUnitPrice * targetQty);
        });
        aprroveTotal = ACC.estimate.formatter.format(aprroveTotal);
        ACC.adobelinktracking.quotesView('', adobeText, 'my account: quotes: quote detail: ' + quoteNumber);
        ACC.colorbox.open("", {
            html: "<div class='row'><div class='col-md-12 marginTopBVottom30 m-b-0-xs m-b-0-sm'><p class='f-s-28 f-s-20-xs-px text-default font-Geogrotesque'>" + text + (num != "all" ? num : '') + text2 + "</p><p class='f-s-22 f-s-16-xs-px text-default font-Geogrotesque flex-center justify-center edit-quote-popover'>" + msg + ": <span class='p-l-3'>" + aprroveTotal + "</span><span class='pointer f-s-12 glyphicon glyphicon-exclamation-sign p-b-10 p-x-5 text-green m-t-neg-5' data-toggle='popover' data-content='Applicable sales tax and any additional fees will be applied at the time of invoicing.'></span></p></div><div class='col-md-12 col-xs-12 col-xs-offset-0 marginBottom30 m-y-15-xs m-y-15-sm'><label class='control-label float-left f-s-12-xs-px f-s-12-sm-px text-dark-gray'><span class='hidden-md hidden-lg'>*</span>" + requested + " #:</label><input type='text' class='form-control' name='inputPO' id='inputPO' placeholder='" + optional + "' maxlength='25' /></div><div class='col-md-12 col-xs-12 col-xs-offset-0 marginBottom30 m-b-15-xs m-b-15-sm'><label for='optionNote' class='control-label f-s-12-xs-px f-s-12-sm-px float-left text-dark-gray'><span>" + noteoption + "</span>:</label><textarea type='text' class='form-control optionNote' name='optionalNote' id='optionalNote' placeholder='Enter your comment' maxlength='200'></textarea></div><div class='col-md-12 col-xs-12 col-xs-offset-0 m-t-0-xs m-b-0-xs" + (modifiedQty ? '' : ' hidden') + "'><label class='control-label f-s-12-xs-px f-s-12-sm-px float-left text-dark-gray'>Modified quantities (" + modifiedQty + "):</label></div><div class='col-md-12 col-xs-12 col-xs-offset-0 marginBottom30 scroll-bar f-s-12 m-b-5-xs m-b-5-sm" + (modifiedQty ? '' : ' hidden') + "' style='max-height: 30vh; overflow-y: auto;'><div class='row hidden-xs hidden-sm bg-light-grey border-grey bold margin0 p-y-10 text-default'><div class='col-md-8 col-xs-7 text-align-left'>ITEM</div><div class='col-md-4 col-xs-5 p-l-0'>QTY</div></div>" + editQtyRows + "</div><div class='col-md-4 col-md-offset-4 col-xs-10 col-xs-offset-1'><button class='btn btn-primary btn-block bold-text' onclick=\"ACC.myquotes.saveSelectedItems('" + num + "','" + quoteNumber + "');\">" + btnText + "</button></div></div>",
            title: "",
            width: ACC.global.wWidth < 1024 ? 412 : 725,
            className: "approveQuotePopup text-center",
            onComplete: function () {
                $('.approveQuotePopup [data-toggle="popover"]').popover({ placement: 'top', trigger: 'hover', container: '.edit-quote-popover' });
            }
        });
    },
    messageQuote: function (e, heading, text, btnText, qSeller, quoteNumber) {
        let target = $(".quote-details-data");
        let accountManager = target.data("accountmanager");
        heading = heading.replace("~~", accountManager);
        accountManager = accountManager.replace("'", "\\'");
        qSeller = qSeller.replace("~~", accountManager);
        ACC.adobelinktracking.quotesView("", "Contact " + qSeller, "my account: quotes: quote detail: " + quoteNumber);
        ACC.colorbox.open("", {
            html: "<div class='row'><div class='col-md-12 marginTopBVottom30'><p class='f-s-28 f-s-20-xs-px text-default font-Geogrotesque'>" + heading + "</p><textarea class='form-control quote-comments' rows='8' placeholder='" + text + "'></textarea></div><div class='col-md-4 col-md-offset-4 col-xs-6 col-xs-offset-3'><button class='btn btn-primary btn-block bold-text' onclick=\"ACC.myquotes.sendQuoteComment('" + qSeller + "','" + quoteNumber + "');\">" + btnText + "</button></div></div>",
            width: "650px",
            className: "approveQuotePopup text-center"
        });
    },
    itemSelectTrigger: false,
    itemSelect: function () {
        if (!ACC.myquotes.itemSelectTrigger) {
            ACC.myquotes.itemSelectTrigger = true;
            let deviceAt = (ACC.global.wWidth < 700) ? "mob-item" : "web-item";
            let elems = $(".qutoe-choose-items." + deviceAt).length;
            let enableApproveItems = 0;
            enableApproveItems = $(".qutoe-choose-items." + deviceAt + ":checked").length;
            if (enableApproveItems == elems || !enableApproveItems) {
                $(".quotes-all-item-show").removeClass("hidden");
                $(".quotes-all-item-hide").addClass("hidden");
            }
            else {
                $(".qutoe-choose-items-num").html(enableApproveItems);
                $(".quotes-all-item-hide").removeClass("hidden");
                $(".quotes-all-item-show").addClass("hidden");
            }
            ACC.myquotes.itemSelectTrigger = false;
        }
    },
    itemsSelections: function (triggerType) {
        if (!ACC.myquotes.itemSelectTrigger) {
            loading.start();
            ACC.myquotes.itemSelectTrigger = true;
            let deviceAt = (ACC.global.wWidth < 700) ? "mob-item" : "web-item";
            let elems = $(".qutoe-choose-items." + deviceAt).length;
            for (let i = 0; i < elems; i++) {
                let target = $(".qutoe-choose-items." + deviceAt).eq(i);
                let targetChecked = target.prop("checked");
                if (triggerType == "select-all" && !targetChecked) {
                    target.prop("checked", true);
                }
                else if (triggerType == "deselect-all" && targetChecked) {
                    target.prop("checked", false);
                }
            }
            $(".quotes-all-item-show").removeClass("hidden");
            $(".quotes-all-item-hide").addClass("hidden");
            loading.stop();
            ACC.myquotes.itemSelectTrigger = false;
        }
    },
    saveSelectedItems: function (num, quoteNumber) {
        let productList = [];
        let deviceAt = (ACC.global.wWidth < 700) ? "mob-item" : "web-item";
        let quoteRef = $(".quote-details-data");
        let target = $(".quote-table-entry");
        for (let i = 0; i < target.length; i++) {
            let iNumber = target.eq(i).data("itemnumber");
            let iDeription = $.trim(target.eq(i).find(".quote-itemdescription").text());
            let iQty = Number(target.eq(i).data("quantity")).toFixed(0);
            let unitPrice = Number(target.eq(i).data("unitprice"));
            let totalPrice = Number(target.eq(i).data("extprice"));
            let uom = target.eq(i).data("uom");
            let quoteDetailId = target.eq(i).data("quotedetailid");
            let isQtyMedefied = target.eq(i).find(".js-default-entry-quantity:visible").length ? true : false;
            let modefiedQty = Number(target.eq(i).find(".js-number-input-event-bind").val()).toFixed(0);
            let quoteLineNum = target.eq(i).data("linenumber");
            iNumber = (iNumber == "") ? '-' : iNumber;
            iDeription = (iDeription == "") ? '-' : iDeription;
            iQty = (iQty == "" || !iQty) ? '1' : iQty;
            modefiedQty = (modefiedQty == "" || !modefiedQty) ? iQty : modefiedQty;
            unitPrice = (unitPrice == "") ? '0.00' : unitPrice;
            totalPrice = isQtyMedefied ? (unitPrice*modefiedQty).toFixed(3) : iQty == 1 ? unitPrice : totalPrice == "" || totalPrice == 0 ? (unitPrice*iQty).toFixed(3) : (totalPrice).toFixed(3);
            uom = (uom == "") ? '-' : uom;
            quoteDetailId = (quoteDetailId == "") ? '-' : quoteDetailId;
            if (num == "all" || target.eq(i).find("." + deviceAt + ".qutoe-choose-items").prop("checked")) {
                productList.push(iNumber + "^" + iDeription + "^" + iQty + "^" + unitPrice + "^" + uom + "^" + totalPrice + "^" + quoteDetailId + "^" + isQtyMedefied + "^" + modefiedQty + "^" + quoteLineNum);
            }
        }
        let approveData = {
            quoteId: quoteRef.attr("data-quoteid"),
            quoteNumber: quoteRef.attr("data-quotenumber"),
            itemCount: num == "all" ? "full" : num,
            productList: productList.join("|"),
            writer: quoteRef.attr("data-writer"),
            accountManager: quoteRef.data("accountmanager"),
            accountManagerEmail: quoteRef.attr("data-accountManagerEmail"),
            branchManagerEmail: quoteRef.attr("data-branchManagerEmail"),
            writerEmail: quoteRef.attr("data-writerEmail"),
            pricerEmail: quoteRef.attr("data-pricerEmail"),
            poNumber: $("#inputPO").val(),
            optionalNotes: $("#optionalNote").val(),
            quotesBr: quoteRef.data("storeid"),
            customerNumber: quoteRef.data("customernumber")
        }
        $.ajax({
            url: ACC.config.encodedContextPath + '/my-account/quoteListEmail',
            type: 'post',
            data: approveData,
            success: function (response) {
                if (response) {
                    ACC.myquotes.quotePopupSuccess();
                }
                else {
                    ACC.myquotes.quotePopupError();
                    ACC.pendo.captureEvent("APPROVEQUOTEFAIL", {'quoteNumber':quoteNumber});
                }
            },
            error: function () {
                ACC.myquotes.quotePopupError();
                ACC.pendo.captureEvent("APPROVEQUOTEFAIL", {'quoteNumber':quoteNumber});
            }
        });
        ACC.adobelinktracking.quotesView('', 'Confirm: Approval of Quote for Order', 'my account: quotes: quote detail: ' + quoteNumber + ' : confirm approval quote for order popup');
    },
    sendQuoteComment: function (qSeller, quoteNumber) {
        let quoteComments = $.trim($('.quote-comments').val().replace(/\n/g, " ").replaceAll("|", "-"));
        if (!quoteComments.length) {
            $('.quote-comments').addClass("alert-danger border-red");
            $('.quote-comments').keyup(function () {
                if ($('.quote-comments').hasClass("alert-danger")) {
                    $('.quote-comments').removeClass("alert-danger border-red");
                }
            });
        }
        else {
            let quoteRef = $(".quote-details-data");
            let commentData = {
                quoteId: quoteRef.attr("data-quoteid"),
                quoteNumber: quoteRef.attr("data-quotenumber"),
                writer: quoteRef.attr("data-writer"),
                quoteComments: quoteComments,
                accountManager: quoteRef.data("accountmanager"),
                accountManagerEmail: quoteRef.attr("data-accountManagerEmail"),
                branchManagerEmail: quoteRef.attr("data-branchManagerEmail"),
                writerEmail: quoteRef.attr("data-writerEmail"),
                pricerEmail: quoteRef.attr("data-pricerEmail"),
                quotesBr: quoteRef.data("storeid"),
                customerNumber: quoteRef.data("customernumber")
            }
            $.ajax({
                url: ACC.config.encodedContextPath + '/my-account/contactSellerEmail',
                type: 'post',
                data: commentData,
                success: function (response) {
                    if (response) {
                        ACC.colorbox.close();
                    }
                    else {
                        ACC.myquotes.quotePopupError();
                    }
                },
                error: function () {
                    ACC.myquotes.quotePopupError();
                }
            });
            ACC.adobelinktracking.quotesView('', 'Submit : Contact ' + qSeller, 'my account: quotes: quote detail: ' + quoteNumber + ' : submit contact the seller popup');
        }
    },
    quotePopupError: function () {
        ACC.colorbox.open("", {
            html: "<div class='row'><div class='col-md-12 marginTopBVottom30'><p class='f-s-28 f-s-20-xs-px text-default font-Geogrotesque'>Something went wrong</p></div><div class='col-md-4 col-md-offset-4 col-xs-6 col-xs-offset-3'><button class='btn btn-default btn-block bold-text' onclick='ACC.colorbox.close()'>Try Again</button></div></div>",
            width: "600px",
            className: "approveQuotePopup text-center"
        });
    },
    quotePopupSuccess: function () {
        ACC.colorbox.open("", {
            html: $("#quote-modal-success").html(),
            width: ACC.global.wWidth < 1024 ? 412 : 725,
            className: "quotesPopupSuccess text-center",
            onComplete: function () {
                1024 > ACC.global.wWidth ? ACC.colorbox.resizeTo(ACC.global.wWidth, 570) : ACC.colorbox.resizeTo(725, 430);
            },
            onClosed: function () {
                window.location.href = window.location.href;
            }
        });
    },
    stickeyHeaderTop: 0,
    stickeyHeader: function (e) {
        let ref = $(".quote-stickey-header");
        let refHgt = ref.outerHeight();
        let refTop = ACC.myquotes.stickeyHeaderTop;
        let wScroll = $(e).scrollTop();
        let hScroll = ($(".linktracking-footer").length) ? $(".linktracking-footer").offset().top - refHgt : ACC.global.wHeight - refHgt;
        if (wScroll < hScroll && wScroll > refTop) {
            $(".quote-details-data").css({ marginBottom: refHgt });
            ref.css({ position: "fixed", left: 0, top: 0 }).children("div").addClass("container-lg container-fluid");
        }
        else {
            $(".quote-details-data").css({ marginBottom: 0 });
            ref.removeAttr("style").children("div").removeClass("container-lg container-fluid");
        }
    },
    pillToggleSticky: function (top) {
        let ref = $(".quotes-pill-container");
        let refHeight = ref.height();
        ref.css({ minHeight: refHeight });
        if (top > ref.offset().top + refHeight + 20) {
            ref.children().addClass("quotes-pill-box");
        }
        else {
            ref.children().removeClass("quotes-pill-box");
        }
    },
    quoteHistoryPopup: function (e, qId, qQty, qUnit) {
        let ref = $(e);
        let page = $(".page-quote-detail");
        let target = $(".quote-history-popup");
        if (ref.attr("data-historypopup") == "hide") {
            ACC.myquotes.getQuoteHistory(ref, qId, qQty, qUnit, target); //AJAX quote item history 
            page.find("[data-historypopup='show']").attr("data-historypopup", "hide").removeAttr("style");
            ref.attr("data-historypopup", "show").css({ backgroundColor: "#F1F6E9" });
        }
        else {
            ref.attr("data-historypopup", "hide").removeAttr("style");
            target.slideUp(function () {
                $(this).addClass("hidden").removeClass("showing-popup");
            });
        }
    },
    getQuoteHistory: function (ref, qId, qQty, qUnit, target) {
        $.ajax({
            type: "GET",
            url: ACC.config.encodedContextPath + "/my-account/quoteApprovalHistory",
            datatype: "json",
            data: {
                quoteDetailID: qId
            },
            success: function(data) {
                let result = data.itemDetails;
                //let result = ACC.myquotes.getQuoteHistoryData;
                let refHTML = '';
                if(data && result.length){
                    for (let i = 0; i < result.length; i++) {
                        refHTML += '<li class="no-border"><span class="bold">'+ result[i].approvalDate + '</span> - ' + Number(result[i].approvedQty).toFixed(0) + ' ' + qUnit + ' (of ' + Number(qQty).toFixed(0) + ') approved for order</li>';
                    }
                    target.find("ul").html(refHTML);
                    target.addClass("showing-popup").removeClass("hidden").css({ left: (ref.offset().left - 310 < 35) ? 35 : ref.offset().left - 310, top: ref.offset().top + 44}).slideDown();
                }
                else{
                    ACC.myquotes.quotePopupError();
                }
            },
            error: function(data, b, e) {
                ACC.myquotes.quotePopupError();
            }
        });
    },
    getQuoteHistoryData: [{quoteDeatilId: '', approvalDate: '26-05-2025', approvedQty: '11.00'},{quoteDeatilId: '', approvalDate: '26-05-2025', approvedQty: 37},{quoteDeatilId: '', approvalDate: '26-05-2025', approvedQty: 17},{quoteDeatilId: '', approvalDate: '26-05-2025', approvedQty: '3.00'},{quoteDeatilId: '', approvalDate: '26-05-2025', approvedQty: 37},{quoteDeatilId: '', approvalDate: '26-05-2025', approvedQty: 17}],
    getHistoryDate: function (qDate) {
        let tempDate = qDate.split('T')[0].split('-');
        return tempDate[2] + '/' + tempDate[1] + '/' + tempDate[0].substring(2);
    },
    toggleEntries: function (e) {
        let ref = $(e);
        if (ref.hasClass("quote-entries-show")) {
            ref.removeClass("quote-entries-show");
            ref.html(ref.data("hidetext"));
            $(".quote-table-entry").removeClass("hidden");
        }
        else {
            $(".quote-table-entry").each(function (index) {
                if (index > 6) {
                    $(this).addClass("hidden");
                }
            });
            ref.html(ref.data("showtext"));
            ref.addClass("quote-entries-show");
        }
    },
    quotesPageView: function (pageName, pathingChannel, pathingPageName) {
        _AAData.page.pageName = pageName;
        _AAData.pathingChannel = pathingChannel;
        _AAData.pathingPageName = pathingPageName;
        _AAData.companyID = $("#parentUnitId").val();
    },
    quotesDetailsPDF: async function () {
        var jsPDF = window.jspdf.jsPDF;
        if (jsPDF && jsPDF.version) {
            $('#dversion').text('Version ' + jsPDF.version);
        }
        var doc = new jsPDF({ putOnlyUsedFonts: true, orientation: "portrait" });
        var posY = 4;
        let quoteNumber = $(".quote-number").text();
        let jobName = $(".quote-jobname").text();
        let accountManager = $(".quote-manager").text();
        let quoteWriter = $(".quote-writer").text();
        let hasDeliveryDetails = $("#hasDeliveryDetails").val() == 'true' ? true : false;
        let textBreak = { width: 30, length: 24 };
        let noOfDefaultLines = 2;
        doc.setDrawColor(0);
        doc.setFillColor(57, 58, 60);
        doc.rect(0, 0, 300, 20, "F");
        doc.addImage($(".quote-pdf-logo").prop("src"), 'png', 5, posY, 40, 11);
        posY += 27;

        doc.setFontSize(18);
        doc.text("Quotes Details", 5, posY);
        posY += 8;
        doc.setDrawColor(217, 217, 217);
        doc.setFillColor(238, 238, 238);
        doc.setLineWidth(0.2);
        doc.setFontSize(6);
        doc.setTextColor(153, 153, 153);
        doc.rect(5, posY, 200, 23, "FD"); //branch gray backgorund
        doc.line(70, posY, 70, posY + 23);  //branch right line
        doc.line(135, posY, 135, posY + 23);    //to right line
        posY += 6;

        doc.text("BRANCH", 8, posY);
        doc.text("TO", 73, posY);
        doc.text(hasDeliveryDetails ? $(".quote-pdf-shipto-title").text() : '', 138, posY);
        doc.setTextColor(0);
        doc.setFontSize(8);
        doc.text($(".quote-pdf-branch-address1").text(), 8, posY + 5);
        doc.text($(".quote-pdf-branch-address2").text(), 8, posY + 9);
        doc.text($(".quote-pdf-branch-address3").text(), 8, posY + ($(".quote-pdf-branch-address2").text() != "" ? 13 : 9));
        doc.text($(".quote-pdf-to-address1").text(), 73, posY + 5);
        doc.text($(".quote-pdf-to-address2").text(), 73, posY + 9);
        doc.text($(".quote-pdf-to-address3").text(), 73, posY + ($(".quote-pdf-to-address2").text() != "" ? 13 : 9));
        //doc.text(hasDeliveryDetails?$(".quote-pdf-shipto-address1").text():'', 138, posY + 5);
        doc.text(hasDeliveryDetails ? $(".quote-pdf-shipto-address2").text() : '', 138, posY + 5);
        doc.text(hasDeliveryDetails ? $(".quote-pdf-shipto-address3").text() : '', 138, posY + (hasDeliveryDetails && $(".quote-pdf-shipto-address2").text() != "" ? 9 : 5));
        posY += 23;

        doc.setTextColor(153, 153, 153);
        doc.setFontSize(6);
        doc.text("QUOTE NUMBER", 8, posY);
        doc.text("JOB NAME", 31, posY);
        doc.text("ACCOUNT MANAGER", (quoteWriter != "" ? 55 : 70), posY);
        if (quoteWriter != "") { doc.text("QUOTE WRITER", 83, posY) };
        doc.text("LAST MODIFIED", 108, posY);
        doc.text("EXPIRATION DATE", 133, posY);
        doc.text("TOTAL", 158, posY);
        doc.text("REMAINING", 183, posY);
        doc.setTextColor(0);
        doc.setFontSize(8);
        doc.text(quoteNumber, 8, posY + 5);
        if (quoteWriter != "") {
            textBreak = { width: 21, length: 14 };
        }

        //Job Name 2 line logic
        noOfDefaultLines = ACC.myquotes.pdfTextLineBreak(doc, jobName, textBreak.width, textBreak.length, 31, posY, noOfDefaultLines);
        //Account Manager 2 line logic
        noOfDefaultLines = ACC.myquotes.pdfTextLineBreak(doc, accountManager, textBreak.width, textBreak.length, (quoteWriter != "" ? 55 : 70), posY, noOfDefaultLines);
        //Quote Writer 2 line logic
        noOfDefaultLines = ACC.myquotes.pdfTextLineBreak(doc, quoteWriter, textBreak.width, textBreak.length, 83, posY, noOfDefaultLines);

        doc.text($(".quote-submitted-date").text(), 108, posY + 5);
        doc.text($(".quote-expiration-date").text(), 133, posY + 5);
        doc.setFont("helvetica", "bold");
        doc.text($(".quote-detailstotal").text(), 158, posY + 5);
        doc.text($(".quote-remainingtotal").text(), 183, posY + 5);

        tempPosY = posY - 6;
        posY += 6 + 3 * noOfDefaultLines;
        doc.setDrawColor(218, 217, 217);
        doc.setFillColor(255, 255, 255);
        doc.line(5, tempPosY, 5, posY);
        doc.line(28, tempPosY, 28, posY);
        if (quoteWriter != "") {
            doc.line(52, tempPosY, 52, posY);
            doc.line(80, tempPosY, 80, posY);
        }
        else {
            doc.line(67, tempPosY, 67, posY);
        }
        doc.line(105, tempPosY, 105, posY);
        doc.line(130, tempPosY, 130, posY);
        doc.line(155, tempPosY, 155, posY);
        doc.line(180, tempPosY, 180, posY);
        doc.line(205, tempPosY, 205, posY);
        doc.line(5, posY, 205, posY);

        posY += 6;
        doc.setFillColor(93, 93, 93);
        doc.setFont("helvetica", "normal");
        doc.rect(5, posY, 200, 10, "F");
        posY += 6;

        doc.setTextColor(255, 255, 255);
        doc.text("ITEM #", 8, posY);
        doc.text("DESCRIPTION", 30, posY);
        doc.text("QTY", 110, posY);
        doc.text("UNIT PRICE", 120, posY);
        doc.text("UOM", 145, posY);
        doc.text("EXT. PRICE", 160, posY);
        doc.text("APPROVED", 185, posY);
        posY += 12;

        doc.setTextColor(0);
        for (let i = 0; i < $(".quote-table-entry").length; i++) {
            let target = $(".quote-table-entry").eq(i);
            let targetItem = target.data('itemnumber').toString();
            let targetDescription = $.trim(target.find('.quote-itemdescription').text());
            let targetNote = $.trim(target.find('.quote-notes').text());
            let targetQuantity = target.data('quantity');
            let targetUnitprice = ACC.savedlist.formatNumberComma(target.data('unitprice'));
            let targetUOM = target.data('uom');
            let targetExtprice = ACC.savedlist.formatNumberComma(target.data('extprice'));
            let targetApproved = target.data('approved');
            let targetSt = target.data('st');
            let targetComment = target.data('comment');
            let lineBrNum = 125;
            let lineBrChr = 105;
            //console.log(i, targetItem, targetDescription, targetQuantity, targetUnitprice, targetUOM, targetExtprice, targetApproved, targetSt, targetComment);
            targetItem = (targetItem == "") ? "-" : targetItem;
            targetDescription = (targetDescription == "") ? "-" : targetDescription;
            targetQuantity = (targetQuantity == "") ? "1" : Number(targetQuantity).toFixed(0);
            targetUnitprice = (targetUnitprice == "") ? "$0.00" : "$" + targetUnitprice;
            targetUOM = (targetUOM == "") ? "-" : targetUOM;
            targetExtprice = (targetExtprice == "") ? "$0.00" : "$" + targetExtprice;

            doc.setFont("helvetica", "bold");
            if (targetSt) {
                doc.setDrawColor(217, 217, 217);
                doc.setFillColor(238, 238, 238);
                doc.rect(5, posY - 8, 200, 14, "F");
                doc.text("ST", 8, posY);
                doc.text(targetExtprice, 160, posY);
            }
            else if (targetComment) {
                doc.setFillColor(248, 248, 248);
                doc.rect(5, posY - 8, 200, 14, "F");
                doc.text("Comment", 8, posY);
            }
            else {
                //Item Number 2 line logic
                //console.log(doc.getTextWidth(targetItem));
                let textForWidth = (doc.getTextWidth(targetItem) > 20) ? targetItem.substr(0, 10) : targetItem;
                doc.text(textForWidth, 8, posY);
                targetItem = $.trim(targetItem.substr(10));
                if (targetItem != "") {
                    doc.text(targetItem, 8, posY + 3);
                }
            }

            doc.setFont("helvetica", "normal");

            if (!targetSt && !targetComment) {
                doc.text(targetQuantity, 110, posY);
                doc.text(targetUnitprice, 120, posY);
                doc.text(targetUOM, 145, posY);
                doc.text(targetExtprice, 160, posY);
                doc.text("-", 193, posY);
                if (targetApproved) {
                    doc.addImage($(".quote-pdf-check").prop("src"), 192, posY - 2, 4, 4);
                }
                lineBrNum = 75;
                lineBrChr = 54;
            }
            //Item Description  2 line logic
            while (targetDescription != "") {
                textForWidth = (doc.getTextWidth(targetDescription) > lineBrNum) ? targetDescription.substr(0, lineBrChr) + "-" : targetDescription;
                doc.text(textForWidth, 30, posY);
                //console.log(doc.getTextWidth(textForWidth));
                posY += 3;
                targetDescription = $.trim(targetDescription.substr(lineBrChr));
            }

            if (targetNote && targetNote != "") {
                doc.setFontSize(7);
                doc.setTextColor(120, 162, 147);
                posY += 1;
                doc.text("Note:", 30, posY);
                doc.setTextColor(153, 153, 153);
                let tempX = 38;
                while (targetNote != "") {
                    textForWidth = (doc.getTextWidth(targetNote) > lineBrNum) ? targetNote.substr(0, lineBrChr) + "-" : targetNote;
                    doc.text(textForWidth, tempX, posY);
                    //console.log(doc.getTextWidth(textForWidth));
                    tempX = 30;
                    posY += 3;
                    targetNote = $.trim(targetNote.substr(lineBrChr));
                }
                posY += 1;
                doc.setFontSize(8);
                doc.setTextColor(0);
            }
            doc.line(5, posY + 3, 205, posY + 3);
            posY += 11;
            if (posY > 280) { doc.addPage(); posY = 10; }
        }
        doc.setTextColor(90, 91, 93);
        doc.setFontSize(9);
        for (let i = 1; i < 3; i++) {
            posY += 5;
            let legalDisclaimer = $.trim($('.js-legal-disclaimer-' + i).text());
            while (legalDisclaimer != "") {
                let textForWidth = (doc.getTextWidth(legalDisclaimer) > 190) ? legalDisclaimer.substr(0, 180 - i * 38) + "-" : legalDisclaimer;
                doc.text(textForWidth, 5, posY);
                //console.log(i, doc.getTextWidth(textForWidth));
                posY += 5;
                legalDisclaimer = $.trim(legalDisclaimer.substr(180 - i * 38));
            }
        }
        doc.save('quotes_' + quoteNumber);
    },
    pdfTextLineBreak: function (doc, textString, width, length, posX, posY, noOfDefaultLines) {
        let textForWidth, counter = 0;
        while (textString != "") {
            textForWidth = (doc.getTextWidth(textString) > width) ? textString.substr(0, length) : textString;
            doc.text(textForWidth, posX, posY + 5);
            textString = $.trim(textString.substr(length));
            posY += 3;
            counter++;
        }
        noOfDefaultLines = noOfDefaultLines > counter ? noOfDefaultLines : counter;
        return noOfDefaultLines;
    },
    editQuote: function (e, type) {
        $(e).hide();
        $(".quote-edit-" + type).show();
        //console.log("editQuote: ", $(e).attr("class"), type);
        if (type == "request") {
            ACC.myquotes.editQuotePopup(type);
        }
        else if (type == "cancel") {
            ACC.colorbox.close();
            ACC.myquotes.enableEditQuote(type);
        }
        else {
            ACC.myquotes.disableEditQuote(type);
        }
    },
    editQuotePopup: function (type) {
        ACC.colorbox.open("<span class='f-s-28'>Modify Quote</span>", {
            html: $(".quote-edit-popup").html(),
            width: ACC.global.wWidth < 1024 ? 412 : 725,
            className: "quote-edit-popup text-center",
            onComplete: function () {
                //do nothing
            },
            onClosed: function () {
                if ($(".quote-edit-request").is(":visible")) {
                    $(".quote-edit-request").hide();
                    $(".quote-edit-start").show();
                };
            }
        });
    },
    enableEditQuote: function (type) {
        $(".quote-table-entry").each(function (e) {
            let ref = $(this);
            let target = ref.find(".quote-quantity");
            target.children(".input-group").addClass("border-primary border-radius-3 m-b-20");
            target.find(".js-number-input-event-bind").addClass("form-control b-l-green-1-imp b-r-green-1-imp f-s-20 f-s-16-xs-px f-s-16-sm-px font-Geogrotesque text-dark-gray").removeClass("border-none width-100-px text-left-xs textleft-sm").prop("disabled", false);
            target.find(".input-group-btn").removeClass("hidden");
            $(".js-edit-quote-note").removeClass("hidden");
        });
    },
    disableEditQuote: function (type) {
        $(".quote-table-entry").each(function (e) {
            let ref = $(this);
            let target = ref.find(".quote-quantity");
            let targetInput = target.find(".js-number-input-event-bind");
            target.children(".input-group").removeClass("border-primary border-radius-3 m-b-20");
            targetInput.removeClass("form-control b-l-green-1-imp b-r-green-1-imp f-s-20 f-s-16-xs-px f-s-16-sm-px font-Geogrotesque text-dark-gray").addClass("border-none width-100-px text-left-xs textleft-sm");
            targetInput.val(targetInput.data("default")).prop("disabled", true);
            target.find(".input-group-btn, .js-default-entry-quantity").addClass("hidden");
            $(".js-edit-quote-note").addClass("hidden");
        });
    },
    editQuoteQtyCheck: function (e) {
        let refParent = $(e).parents(".quote-quantity");
        let target = refParent.find(".js-number-input-event-bind");
        if (target.data('default') != target.val()) {
            refParent.find(".input-group").removeClass("m-b-20");
            refParent.find(".js-default-entry-quantity").removeClass("hidden");
        }
        else {
            refParent.find(".input-group").addClass("m-b-20");
            refParent.find(".js-default-entry-quantity").addClass("hidden");
        }
    }
};
ACC.briteverify = {

    _autoload: [
        "bindEmailValidation",
        "pointsForEquipmentFormSubmit",
        "contactUsFormSubmit",
        "leadFormSubmit",
        "requestForAccountFormSubmit",
        "emailSignUpPage",
        "siteOneHomeOwnerForm",
        "inspireForm",
        "privacyRequestFormSubmit"
    ],
    
    vaildateEmailFields: function (input, error, errorText, msg, response)
{
    var valid = false;
    if(response == "invalid" || response == "timeout" || response == "error")
    {
    ACC.formvalidation.addErrorClassForRegForm(input, error, errorText, msg);
    ACC.formvalidation.addGlobalError();
    }
    else
    {
    ACC.formvalidation.removeErrorClassForRegForm(input, error, errorText);
    valid = true;
    }
    return valid;
},
reCaptcha: function (response)
{
if (response.length == 0)
    {
$("#recaptcha-error").removeClass('hidden');
$("#recaptcha-border").addClass('recaptcha-error-border');
        }
else if($('#recaptchaChallengeAnswered').val() == 'false')
{
$("#recaptcha-error").removeClass('hidden');
$("#recaptcha-border").addClass('recaptcha-error-border');
}
        else 
        {
          $("#recaptcha-error").addClass('hidden');
          $("#recaptcha-border").removeClass('recaptcha-error-border');
        
        }
},
    
    requestForAccountFormSubmit: function ()
    {
        $('.page-requestaccount [data-toggle="tooltip"]').tooltip();
         
        $(document).find("#emailaddress").prop('type', 'email');
          $(document).find("#phoneNumber").prop('type', 'tel');
           
    },
    
    validateEmailWithBriteVerify: function (input, error, errorText, msg, value, formId)
{
   
    var briteverify= document.getElementById('briteVerifyEnable').value;
var briteverifytimeout= document.getElementById('briteVerifyTimeout').value;
if(briteverify=="true")
{
loading.start();
url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+value;
            
$.ajax({
url: url,
type: "GET",
crossDomain: true,
    timeout:briteverifytimeout,
success: function (response)
{
if(response == "invalid")
{
loading.stop();
var msg = ACC.config.emailAddressError1;
ACC.briteverify.vaildateEmailFields(input, error, errorText, msg, response);
ACC.formvalidation.addGlobalError();
} 
else
  {
//ACC.briteverify.vaildateEmailFields(input, error, errorText, msg, response.status);
if(formId != null && formId != '' && formId != undefined)
{
if(formId == '#siteOneLeadGenerationForm')
{
ewt.trackFormSubmit({name:'lead_generation_form_submit',type:'lead_generation',form:$('#siteOneLeadGenerationForm')});
}
$(formId).submit();

/* For Harscape Analytics*/
var harscapeContactPathname = window.location.pathname;

if(harscapeContactPathname == '/en/contactus/hardscapes')
	 {
digitalData.event="contact us form submit";
digitalData.eventData={
		formName:"Hardcapes"  
    }
try {
	_satellite.track("contactUsFormSubmit");
	}catch(e){} 

	 }

}
  }
},
error: function(response, textstatus, message) 
{
  if(textstatus == "timeout" || textstatus == "error") 
  {
  loading.stop();
  var msg = ACC.config.emailAddressUnable;
  ACC.briteverify.vaildateEmailFields(input, error, errorText, msg, textstatus);
  ACC.formvalidation.addGlobalError();
      } 
}
});
}
else
{
$(formId).submit();
}
},
    
    bindEmailValidation: function () 
    {
    $(document).on("focusin", "#emailFooter",function(e)
     {
$(".message").empty();
     });

    $(document).on("click", "#signUpFooter",function(e)
         {
    var briteverify= document.getElementById('briteVerifyEnable').value;

    $(".message").html("");
    if($("#emailFooter").val() == "" || $("#emailFooter").val()  == null)
    {
    $(".message").html("<div class='bg-danger'><div class='panel-body'><font color='red'>" + ERRORMSG.global.email + "</font></div></div>");
    }

    else if(briteverify=="true")
{
url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+$('#emailFooter').val();

                    loading.start();
$.ajax({
      url: url,
      type: "get",
      timeout: 5000,
      success: function (response)
      {
      if(response !="invalid")
      {
      ACC.briteverify.emailSignUpFooter($("#emailFooter").val()).always(function(){
                                    loading.stop();
                                });
      }
          else
          {
                                loading.stop();
                                $("#emailFooter").val('');
          $(".message").html("<div class='bg-danger'><div class='panel-body'><font color='red'>" + ERRORMSG.invalid.email + "</font></div></div>");
          }
      },

      error: function(response, textstatus, message)
  {
                            loading.stop();
  if(textstatus == "timeout" || textstatus == "error")
  {
$(".message").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
      }
  }
});
}
    else
    {
                    loading.start();
    ACC.briteverify.emailSignUpFooter($("#emailFooter").val()).always(function(){
                        loading.stop();
                    });
    }

        });

   
    $(document).on("submit", "#emailSignUp",function(e)
    {
        e.preventDefault(); 
        var briteverify= document.getElementById('briteVerifyEnable').value;

    $(".message").html("");
    if($("#emailFooter").val() == "" || $("#emailFooter").val()  == null)
    {
    $(".message").html("<div class='bg-danger'><div class='panel-body'><font color='red'>" + ERRORMSG.global.email + "</font></div></div>");
    }

    else if(briteverify=="true")
{
url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+$('#emailIdSignUp').val();
                    
    loading.start();
$.ajax({
      url: url,
      type: "GET",
      timeout: 5000,
      success: function (response)
      {if(response !="invalid")
      {
      ACC.briteverify.emailSignUpFooter($("#emailFooter").val()).always(function(){
                                loading.stop();
                            });
      }
          else
          {

                              loading.stop();
                            $("#emailFooter").val('');
          $(".message").html("<div class='bg-danger'><div class='panel-body'><font color='red'>" + ERRORMSG.invalid.email + "brnksy" + "</font></div></div>");
          }
      },

      error: function(response, textstatus, message)
  {
        loading.stop();
  if(textstatus == "timeout" || textstatus == "error")
  {
$(".message").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
      }
  }
});
}
    else
    {
   
                    loading.start();
    ACC.briteverify.emailSignUpFooter($("#emailFooter").val()).always(function(){
                        loading.stop();
                    });
    }
    });

    },
    
    pointsForEquipmentFormSubmit:function()
    {
    var briteverify= document.getElementById('briteVerifyEnable').value;
      $(document).find("#emailAddress").prop('type', 'email');
      $(document).find("#phoneNumber").prop('type', 'tel');
      $(document).find("#faxNumber").prop('type', 'tel');
       $(document).on('input blur', "#dealerName", function(e)
           {
        ACC.formvalidation.vaildateFields('#dealerName', '#dealerNameError', '#dealerName\\.errors', ACC.config.dealerErrorMsg);
           });
       
       $(document).on('input blur', "#dealerContactName", function(e)
    {
       ACC.formvalidation.vaildateFields('#dealerContactName', '#dealerContactNameError', '#dealerContactName\\.errors', ACC.config.enterContactName+'<div class="cl"></div><br/><br/>');
         
    });
       
       $(document).on('input blur', "#dealerAddressLine1", function(e)
      {
       ACC.formvalidation.vaildateFields('#dealerAddressLine1', '#dealerAddressLine1Error', '#dealerAddressLine1\\.errors', ACC.config.addressInfo+'<div class="cl"></div><br/><br/>');
      });
       
       $(document).on('input blur', "#emailAddress", function(e)
        {
               if(ACC.formvalidation.validateEmailPattern($("#emailAddress").val()))
        {
    ACC.formvalidation.removeErrorClassForRegForm('#emailAddress', '#emailAddressError', '#emailAddress\\.errors');
    }
    else
    {
    ACC.formvalidation.addErrorClassForRegForm('#emailAddress', '#emailAddressError', '#emailAddress\\.errors', ERRORMSG.invalid.email);
    }
       //ACC.formvalidation.vaildateFields('#emailAddress', '#emailAddressError', '#emailAddress\\.errors', 'Please enter an email address.<div class="cl"></div><br/><br/>');
        });
       $(document).on('input blur', "#dealerCity", function(e)
         {
       //  ACC.formvalidation.vaildateFields('#dealerCity', '#dealerCityError', '#dealerCity\\.errors', 'ACC.config.enterCity.<div class="cl"></div><br/><br/>');
         ACC.formvalidation.validateFieldBasedOnRegex(e,'#dealerCity', '#dealerCityError', '#dealerCity\\.errors',ACC.config.briteCityMay,ERRORMSG.global.city);
        
         });
       $(document).on('input blur', "#dealerZipCode", function(e)
        {
       if((ACC.formvalidation.validatezipcode(e, $("#dealerZipCode").val())))
       {
    ACC.formvalidation.removeErrorClassForRegForm('#dealerZipCode', '#dealerZipCodeError', '#dealerZipCode\\.errors');
     }
  else
     {
    ACC.formvalidation.addErrorClassForRegForm('#dealerZipCode', '#dealerZipCodeError', '#dealerZipCode\\.errors', ACC.config.validZip);
     }
       });
       $(document).on('input blur', "#dealerState", function(e)
         {
       ACC.formvalidation.vaildateFields('#dealerState', '#dealerStateError', '#dealerState\\.errors', ACC.config.selectState); 

         });
       
       $(document).on('input blur', "#customerContactName", function(e)
        {
        ACC.formvalidation.vaildateFields('#customerContactName', '#customerContactNameError', '#customerContactName\\.errors', ACC.config.enterFirstName+'<div class="cl"></div><br/><br/>');
        });
           
       $(document).on('input blur', "#companyName", function(e)
        {
              ACC.formvalidation.vaildateFields('#companyName', '#companyNameError', '#companyName\\.errors', ACC.config.enterCompany+'<div class="cl"></div><br/><br/>');
        });
           
       $(document).on('input blur', "#jdlAccountNumber", function(e)
        {
      //ACC.formvalidation.validateAccountNumber(e);
        ACC.formvalidation.validateAccountNumber(e,'#jdlAccountNumber', '#jdlAccountNumberError', '#jdlAccountNumber\\.errors', ACC.config.enterAccountNumber+'<div class="cl"></div><br/><br/>');
        });
           
       $(document).on('input blur', "#customerAddressLine1", function(e)
        {
       ACC.formvalidation.vaildateFields('#customerAddressLine1', '#customerAddressLine1Error', '#customerAddressLine1\\.errors', ACC.config.addressInfo+'<div class="cl"></div><br/><br/>');
        });
       
       $(document).on('input blur', "#customerCity", function(e)
        {
       //ACC.formvalidation.vaildateFields('#customerCity', '#customerCityError', '#customerCity\\.errors', 'Please enter a city.<div class="cl"></div><br/><br/>');
       ACC.formvalidation.validateFieldBasedOnRegex(e,'#customerCity', '#customerCityError', '#customerCity\\.errors',ACC.config.briteCityMay,ERRORMSG.global.city,"city");
   
        });
       
       $(document).on('input blur', "#customerZipCode", function(e)
        {
            if((ACC.formvalidation.validatezipcode(e, $("#customerZipCode").val())))
         {
        ACC.formvalidation.removeErrorClassForRegForm('#customerZipCode', '#customerZipCodeError', '#customerZipCode\\.errors');
      }
          else
      {
      ACC.formvalidation.addErrorClassForRegForm('#customerZipCode', '#customerZipCodeError', '#customerZipCode\\.errors', ACC.config.validZip);
      }
       });       
       $(document).on('input blur', "#customerState", function(e)
        {
        ACC.formvalidation.vaildateFields('#customerState', '#customerStateError', '#customerState\\.errors', ACC.config.selectState); 

        });
       
    $(document).on("blur", "#phoneNumber", function(e)
    {
    var phoneNumber = $(this).val();
    if(phoneNumber != null && phoneNumber != '' && phoneNumber != undefined)
        {
            if (!ACC.formvalidation.validatePhoneNumber(phoneNumber))
                    {
                        var msg=ACC.config.phoneNumberError;
                        ACC.formvalidation.addErrorClassForRegForm('#phoneNumber', '#phoneNumberError', '#phoneNumber\\.errors', msg);
                    }
                    else
                    {
                        ACC.formvalidation.removeErrorClassForRegForm('#phoneNumber', '#phoneNumberError', '#phoneNumber\\.errors');
                    }
        }
        else
        {
                ACC.formvalidation.addErrorClassForRegForm('#phoneNumber', '#phoneNumberError', '#phoneNumber\\.errors', ERRORMSG.global.phone);
        }
        });
   
    $(document).on("input blur", "#phoneNumber", function(e)
        {
    $("#phoneNumber").prop('type', 'tel');
         ACC.formvalidation.handlePhoneNumberOnInput('#phoneNumber', '#phoneNumberError', '#phoneNumber\\.errors');
          });
   
    $(document).on("input blur", "#faxNumber", function(e)
            {
       
             ACC.formvalidation.handlePhoneNumberOnInput('#faxNumber', '#faxNumberError', '#faxNumber\\.errors');
              });
       
    /* $(document).on('input blur', "#dateOfPurProduct"+i, function(e)
        {
    ACC.formvalidation.vaildateFields('#dateOfPurProduct'+i, '#dateOfPurProductError'+i, '#customerState\\.errors', 'Please enter date of purchase.<div class="cl"></div><br/><br/>');
     
        });
    $(document).on('input blur', "#itemDescProduct"+i, function(e)
        {
    ACC.formvalidation.vaildateFields('#itemDescProduct'+i, '#itemDescProductError'+i, '#itemDescProduct\\.errors', 'Please enter description of product.<div class="cl"></div><br/><br/>');
     
        });
    $(document).on('input blur', "#serialNumberProductError"+i, function(e)
        {
    ACC.formvalidation.vaildateFields('#serialNumberProduct'+i, '#serialNumberProductError'+i, '#serialNumberProduct\\.errors', 'Please enter serial number of product.<div class="cl"></div><br/><br/>');
     
        });
    $(document).on('input blur', "#invoiceCostProductError"+i, function(e)
         {
    ACC.formvalidation.vaildateFields('#invoiceCostProduct'+i, '#invoiceCostProductError'+i, '#invoiceCostProduct\\.errors', 'Please enter invoice cost product.<div class="cl"></div><br/><br/>');
     
    });
           
    */
    $(document).on("click", ".pointsForEquipment", function (e)
        {
        e.preventDefault();
        var status = true;
        document.getElementById('recaptchaValidator').value = grecaptcha.getResponse();
        ACC.briteverify.reCaptcha(grecaptcha.getResponse());
        if($("#dealerContactName").val() == "" || $("#dealerContactName").val() == null)
        {
        status = false;
        //$("#dealerContactNameError").html("ACC.config.enterContactName.");
        ACC.formvalidation.addErrorClassForRegForm('#dealerContactName', '#dealerContactNameError', '#dealerContactName\\.errors', ACC.config.enterContactName+'<div class="cl"></div><br/><br/>');
             
        }
        else
        {
        $("#dealerContactNameError").empty();
        }
       
        if($("#dealerName").val() == "" || $("#dealerName").val() == null)
        {
        status = false;
        //$("#dealerNameError").html("<div class='bg-danger' style='margin-top:20px;'><div class='panel-body'><font color='red'>Please enter dealer name.</font></div></div>");
        ACC.formvalidation.addErrorClassForRegForm('#dealerName', '#dealerNameError', '#dealerName\\.errors', ACC.config.dealerErrorMsg+'<div class="cl"></div><br/><br/>');
               
        }
        else
    {
    $("#dealerNameError").empty();
    }
   
       
        if($("#dealerAddressLine1").val() == "" || $("#dealerAddressLine1").val() == null)
        {
        status = false;
        //$("#dealerAddressLine1Error").html(ERRORMSG.global.address);
        ACC.formvalidation.addErrorClassForRegForm('#dealerAddressLine1', '#dealerAddressLine1Error', '#dealerAddressLine1\\.errors', ACC.config.addressInfo+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#dealerAddressLine1Error").empty();
    }
          
        if($("#phoneNumber").val() == "" || $("#phoneNumber").val() == null)
        {
        status = false;
        //$("#phoneNumberError").html(ERRORMSG.global.phone);
        ACC.formvalidation.addErrorClassForRegForm('#phoneNumber', '#phoneNumberError', '#phoneNumber\\.errors', ACC.config.validPhoneNumber+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#phoneNumberError").empty();
    }
        if($("#emailAddress").val() == "" || $("#emailAddress").val() == null)
        {
        status = false;
        //$("#emailAddressError").html(ERRORMSG.global.email);
        ACC.formvalidation.addErrorClassForRegForm('#emailAddress', '#emailAddressError', '#emailAddress\\.errors', ACC.config.dashboardValidEmail+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#emailAddressError").empty();
    }
        if($("#dealerCity").val() == "" || $("#dealerCity").val() == null)
        {
        status = false;
        //$("#dealerCityError").html(ERRORMSG.global.city);
        ACC.formvalidation.addErrorClassForRegForm('#dealerCity', '#dealerCityError', '#dealerCity\\.errors', ACC.config.enterCity+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#dealerCityError").empty();
    }
        if($("#dealerZipCode").val() == "" || $("#dealerZipCode").val() == null)
        {
        status = false;
        //$("#dealerZipCodeError").html(ERRORMSG.global.zip);
        ACC.formvalidation.addErrorClassForRegForm('#dealerZipCode', '#dealerZipCodeError', '#dealerZipCode\\.errors', ACC.config.validZipPostal+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#dealerZipCodeError").empty();
    }
       
        if($("#dealerState").val() == "" || $("#dealerState").val() == null)
        {
        status = false;
        ACC.formvalidation.addErrorClassForRegForm('#dealerState', '#dealerStateError', '#dealerState\\.errors', 'Please select a state.<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#dealerStateError").empty();
    }
       
       
        if($("#customerContactName").val() == "" || $("#customerContactName").val() == null)
        {
        status = false;
        //$("#customerContactNameError").html(ERRORMSG.global.firstname);
        ACC.formvalidation.addErrorClassForRegForm('#customerContactName', '#customerContactNameError', '#customerContactName\\.errors', ACC.config.enterFirstName+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#customerContactNameError").empty();
    }
        if($("#companyName").val() == "" || $("#companyName").val() == null)
        {
        status = false;
        //$("#companyNameError").html("ACC.config.enterCompany");
        ACC.formvalidation.addErrorClassForRegForm('#companyName', '#companyNameError', '#companyName\\.errors', ACC.config.enterCompany+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#companyNameError").empty();
    }
        if($("#jdlAccountNumber").val() == "" || $("#jdlAccountNumber").val() == null)
        {
        status = false;
        //$("#jdlAccountNumberError").html("ACC.config.enterAccountNumber);
        //ACC.formvalidation.validateAccountNumber(e);
        ACC.formvalidation.addErrorClassForRegForm('#jdlAccountNumber', '#jdlAccountNumberError', '#jdlAccountNumber\\.errors', ACC.config.enterAccountNumber+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#jdlAccountNumberError").empty();
    }
        if($("#customerAddressLine1").val() == "" || $("#customerAddressLine1").val() == null)
        {
        status = false;
        //$("#customerAddressLine1Error").html(ERRORMSG.global.address);
        ACC.formvalidation.addErrorClassForRegForm('#customerAddressLine1', '#customerAddressLine1Error', '#customerAddressLine1\\.errors', ACC.config.addressInfo+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#customerAddressLine1Error").empty();
    }
        if($("#customerCity").val() == "" || $("#customerCity").val() == null)
        {
        status = false;
        //$("#customerCityError").html(ERRORMSG.global.city);
        ACC.formvalidation.addErrorClassForRegForm('#customerCity', '#customerCityError', '#customerCity\\.errors', ACC.config.enterCity+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#customerCityError").empty();
    }
        if($("#customerZipCode").val() == "" || $("#customerZipCode").val() == null)
        {
        status = false;
        //$("#customerZipCodeError").html("<div class='bg-danger' style='margin-top:20px;'><div class='panel-body'><font color='red'>" + ERRORMSG.global.zip + "</font></div></div>");
        ACC.formvalidation.addErrorClassForRegForm('#customerZipCode', '#customerZipCodeError', '#customerCity\\.errors', ACC.config.dashboardValidZip+'<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#customerZipCodeError").empty();
    }
       
        if($("#customerState").val() == "" || $("#customerState").val() == null)
        {
        status = false;
        ACC.formvalidation.addErrorClassForRegForm('#customerState', '#customerStateError', '#customerState\\.errors', 'Please select a state.<div class="cl"></div><br/><br/>');
        }
        else
    {
    $("#customerStateError").empty();
    }
        $('div.product_info:visible').each(function(i, el){
        i=i+1;
        var dateOfPurchase=$(this).find("#dateOfPurProduct"+i).val();
        var itemDescription=$(this).find("#itemDescProduct"+i).val();
        var serialNumber=$(this).find("#serialNumberProduct"+i).val();
        var invoiceCost=$(this).find("#invoiceCostProduct"+i).val();
        if(dateOfPurchase == "" || dateOfPurchase == null)
            {
            status = false;
            //$("#dateOfPurProductError"+i).html("Please enter date of purchase.");
            ACC.formvalidation.addErrorClassForRegForm('#dateOfPurProduct'+i, '#dateOfPurProductError'+i, '#customerState\\.errors', ACC.config.purchaseDate+'<div class="cl"></div><br/><br/>');
               
           
            }
            else
        {
        $("#dateOfPurProductError"+i).empty();
        }
            if(itemDescription == "" || itemDescription== null)
            {
            status = false;
            //$("#itemDescProductError"+i).html("Please enter description of product");
            ACC.formvalidation.addErrorClassForRegForm('#itemDescProduct'+i, '#itemDescProductError'+i, '#itemDescProduct\\.errors', ACC.config.productDescription+'<div class="cl"></div><br/><br/>');
               
           
            }
            else
        {
        $("#itemDescProductError"+i).empty();
        }
                   
            if(serialNumber == "" || serialNumber == null)
            {
            status = false;
            //$("#serialNumberProductError"+i).html("Please enter serial number of product.");
            ACC.formvalidation.addErrorClassForRegForm('#serialNumberProduct'+i, '#serialNumberProductError'+i, '#serialNumberProduct\\.errors', ACC.config.serialNumber+'<div class="cl"></div><br/><br/>');
               
            }
            else
        {
        $("#serialNumberProductError"+i).empty();
        }
           
            if(invoiceCost == "" || invoiceCost == null)
            {
            status = false;
            //$("#invoiceCostProductError"+i).html("Please enter invoice cost product.");
            ACC.formvalidation.addErrorClassForRegForm('#invoiceCostProduct'+i, '#invoiceCostProductError'+i, '#invoiceCostProduct\\.errors', ACC.config.invoiceCost+'<div class="cl"></div><br/><br/>');
               
            }
            else
        {
        $("#invoiceCostProductError"+i).empty();
        }
        });
       
           
        if(status)
        {
                loading.start();
        if(briteverify=="true")
        {
        url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+$('#emailAddress').val();
        $.ajax({
                url: url,
                type: "GET",
            timeout: 5000,
            success: function (response)
            {
            if(response == "invalid")
            {
                          loading.stop();
            $("#emailAddressError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>Please enter a valid email address.</div></font></div>");   
            }
            else
            {
            if(status)
            {
            $("#siteOnePointsForEquipmentForm").submit();
            }
            }
            },
           
            error: function(response, textstatus, message) 
          {
                        loading.stop();
          if(textstatus == "timeout" || textstatus == "error") 
          {
        $("#emailAddressError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
              } 
          }
                });
        }
        else
    {
    $("#siteOnePointsForEquipmentForm").submit();
   
    }
        }
        else
    {
        /*window.scrollTo(500, 0);*/
            ACC.formvalidation.addGlobalError();
    }
        });
       
    },
    
    contactUsFormSubmit: function ()
    {
        $(document).find("#phonenumbercontact").prop('type', 'tel');
        $(document).find("#contactUsFormEmail").prop('type', 'email');
        $(document).on("input blur", "#phonenumbercontact", function(e)
        {

            ACC.formvalidation.handlePhoneNumberOnInput('#phonenumbercontact', '#errorphonenumber', '#phoneNumber\\.errors');
        });
      
        $(document).on('input blur', "#user\\#firstName", function(e)
        {
            ACC.formvalidation.validateFieldBasedOnRegex(e,'#user\\#firstName', '#errorfirstname', '#firstName\\.errors',ACC.config.nameMayInclude,ACC.config.firstName);
        });
      
        $(document).on("keypress","#streetAddress, #contact-us-city, #message", function(e) {
            if (e.which === 32 && !this.value.length)
            e.preventDefault();
        });
      
        $(document).on('input blur', "#user\\#lastName", function(e)
        {
            ACC.formvalidation.validateFieldBasedOnRegex(e,'#user\\#lastName', '#errorlastname', '#lastName\\.errors',ACC.config.nameMayInclude,ACC.config.lastName);
        });
      
        $(document).on('input blur', "#message", function(e)
        {
            ACC.formvalidation.vaildateFields('#message', '#errormessage', '#message\\.errors',ACC.config.plsEnterMsg);
        });
        $(document).on('input blur', "#reasonForContact", function(e)
        {
            ACC.formvalidation.vaildateFields('#reasonForContact', '#errorselectreason', '#reasonForContact\\.errors', ACC.config.selectReason); 
        }); 
        var oldphaseof=$('#inPhaseOf').clone().html();
        var oldproject =$('#myProject').clone().html();
	    $(document).on('change', "#reasonForContact", function(e) {
	
            if ( $('#contactusHardscapes').val()=== "false" && this.selectedIndex==2) {
                window.location.href = ACC.config.encodedContextPath + '/request-account/form';
            }
            // SE-29401 Nursery
            if ( $('#contactusHardscapes').val()=== "false" && this.selectedIndex==3) {
                window.location.href = ACC.config.encodedContextPath + '/nursery-form';
            }
            if ( $('#contactusHardscapes').val()=== "false" && this.selectedIndex==11) {
                window.location.href = ACC.config.encodedContextPath + '/contactus/hardscapes';
            }
            if($('.lightingEmailContactUs').val()==="true" && this.selectedIndex==3) {
            
                $.ajax({
                    type: "GET",
                    url: ACC.config.encodedContextPath + "/contactus/lighting/outdoor",
                    dataType: "json",
                    success: function (response)
                    {
                        console.log(response);
                        var outdoorPhaseof = response.phaseOf;
                        var outdoorProject = response.project;
                        
                        var $el = $('#inPhaseOf');
                        var $ele = $('#myProject');
                        $el.empty();
                        $ele.empty();
                        $el.append($("<option></option>").attr("value","select").text("Select"));
                        $ele.append($("<option></option>").attr("value","select").text("Select"));
                        $.each(outdoorPhaseof, function(key,value){
                            $el.append($("<option></option>").attr("value",value).text(value));
                        });
                        $.each(outdoorProject, function(key, value){
                            $ele.append($("<option></option>").attr("value",value).text(value));
                        });
                    },
                    error: function (error)
                    {
                        console.log("failed");
                    }
                });
            }
            else {
                var $el = $('#inPhaseOf');
                var $ele = $('#myProject');
                $el.empty();
                $ele.empty();
                $el.append(oldphaseof);
                $ele.append(oldproject);
            }
	    }); 
     
        $(document).on("input blur", "#contactUsFormEmail", function()
        {
      
            if(ACC.formvalidation.validateEmailPattern($("#contactUsFormEmail").val()))
            {
                ACC.formvalidation.removeErrorClassForRegForm('#contactUsFormEmail', '#erroremail', '#contactUsFormEmail\\.errors');
            }
            else
            {
                ACC.formvalidation.addErrorClassForRegForm('#contactUsFormEmail', '#erroremail', '#contactUsFormEmail\\.errors', ERRORMSG.invalid.email);
            }
        
        });


        $(document).on("input blur", "#contact-us-city", function(e)
        {
     
            if(ACC.formvalidation.vaildateFields('#contact-us-city'))
            {
    
                ACC.formvalidation.removeErrorClassForRegForm('#contact-us-city', '#errorCustomerCity', '#contact-us-city\\.errors');
                ACC.formvalidation.validateFieldBasedOnRegex(e, '#contact-us-city', '#errorCustomerCity', '#contact-us-city\\.errors', ACC.config.briteCityMay, ERRORMSG.global.city,"city");

            }
            else
            {
                ACC.formvalidation.addErrorClassForRegForm('#contact-us-city', '#errorCustomerCity', '#contact-us-city\\.errors', ERRORMSG.global.city);
            }
                   
        });
      
	  
	    if ($('#siteOneContactUsForm').length > 0) {
            $(document).on("input blur", "#streetAddress", function()
            {
                var msg = ERRORMSG.global.address;
                ACC.formvalidation.vaildateFields('#streetAddress', '#errorStreetAddress', '#streetAddress\\.errors', msg);
            });
        }
        $(document).on("blur", "#customerState", function()
        {

            if(ACC.formvalidation.vaildateFields('#customerState'))
            {
                ACC.formvalidation.removeErrorClassForRegForm('#customerState', '#errorcustomerstate', '#customerState\\.errors');
            }
            else
            {
                ACC.formvalidation.addErrorClassForRegForm('#customerState', '#errorcustomerstate', '#customerState\\.errors', ACC.config.selectState);
            }

        });
        $(document).on("click", ".contactUs", function (e)
        {
            var status = true;
            e.preventDefault();
            document.getElementById('recaptchaValidator').value = grecaptcha.getResponse();
            ACC.briteverify.reCaptcha(grecaptcha.getResponse());
        
            ACC.formvalidation.vaildateFields('#reasonForContact', '#errorselectreason', '#reasonForContact\\.errors', ACC.config.selectReason); 
            ACC.formvalidation.vaildateFields('#firstName', '#errorfirstname', '#firstName\\.errors',ERRORMSG.global.firstname);
            ACC.formvalidation.vaildateFields('#lastName', '#errorlastname', '#lastName\\.errors',ERRORMSG.global.lastname);
            if ($('#siteOneContactUsForm').length > 0) {
                ACC.formvalidation.vaildateFields('#streetAddress', '#errorStreetAddress', '#streetAddress\\.errors', ERRORMSG.global.address);
            }
            ACC.formvalidation.vaildateFields('#message', '#errormessage', '#message\\.errors', ACC.config.plsEnterMsg);
 
            if(null != $("#phonenumbercontact").val() && $("#phonenumbercontact").val() != '')
            {
                if(!ACC.formvalidation.validatePhoneNumber($("#phonenumbercontact").val()))
                {
                    status = false;
                    ACC.formvalidation.addErrorClassForRegForm('#phonenumbercontact', '#errorphonenumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
                }
                else
                {
                    ACC.formvalidation.removeErrorClassForRegForm('#phonenumbercontact', '#errorphonenumber', '#phoneNumber\\.errors');
                }
            }
            else
            {
                status = false;
                ACC.formvalidation.addErrorClassForRegForm('#phonenumbercontact', '#errorphonenumber', '#phoneNumber\\.errors', ACC.config.phoneNumber);
            }
 
            if(ACC.formvalidation.validateEmailPattern($("#contactUsFormEmail").val()))
            {
                ACC.formvalidation.removeErrorClassForRegForm('#contactUsFormEmail', '#erroremail', '#contactUsFormEmail\\.errors', ERRORMSG.invalid.email);
            }
            else
            {
                status = false;
                ACC.formvalidation.addErrorClassForRegForm('#contactUsFormEmail', '#erroremail', '#contactUsFormEmail\\.errors', ERRORMSG.invalid.email);
            }
 
            if ($('.contactus-form').length > 0) {
                if(!$(".typeOfCustomer").is(':checked')){
                    status = false;
                    $("#typeOfCustomerError").html(ACC.config.chooseCustomerType);
                }
                else{
                    $("#typeOfCustomerError").empty();
                } 
            }  
            $('*[id*=error]:visible').each(function(){
                if($(this).html() != '')
                {
                    status = false;
                }
            });
   
    
      
			var currentBaseStoreId = $('.currentBaseStoreId').val();
     
			if(currentBaseStoreId == 'US'){
            if(ACC.formvalidation.validatezipcode(e, $("#projectZipcode").val())){
                ACC.formvalidation.removeErrorClassForRegForm('#projectZipcode', '#errorprojectZipcode', '#projectZipcode\\.errors');
            }
            else{
                status = false;
                ACC.formvalidation.addErrorClassForRegForm('#projectZipcode', '#errorprojectZipcode', '#projectZipcode\\.errors', ACC.config.validZip);
            }
        
            if (ACC.formvalidation.vaildateFields('#customerState')) {
                ACC.formvalidation.removeErrorClassForRegForm('#customerState', '#errorcustomerstate', '#customerState\\.errors');
            }
            else {
                status = false;
                ACC.formvalidation.addErrorClassForRegForm('#customerState', '#errorcustomerstate', '#customerState\\.errors', ACC.config.selectState);
            }
     		}

            if (ACC.formvalidation.vaildateFields('#contact-us-city')){
                ACC.formvalidation.removeErrorClassForRegForm('#contact-us-city', '#errorCustomerCity', '#contact-us-city\\.errors');
                ACC.formvalidation.validateFieldBasedOnRegex(e, '#contact-us-city', '#errorCustomerCity', '#contact-us-city\\.errors', ACC.config.briteCityMay, ERRORMSG.global.city,"city");

            }
            else{
                status = false;
                ACC.formvalidation.addErrorClassForRegForm('#contact-us-city', '#errorCustomerCity', '#contact-us-city\\.errors', ERRORMSG.global.city);
            }
       

          
     
     
     
    
            if(status)
            {
                ACC.briteverify.validateEmailWithBriteVerify('#contactUsFormEmail', '#erroremail', '#email\\.errors', ERRORMSG.global.email, $('#contactUsFormEmail').val(), '#siteOneContactUsForm');
            }
            else
            {
                /*window.scrollTo(500, 0);*/
                ACC.formvalidation.addGlobalError();
            }
   
        });
    
    
   	    $(document).on("input blur", "#projectZipcode", function(e)
        {	
            if(ACC.formvalidation.validatezipcode(e, $("#projectZipcode").val()))
            {
                ACC.formvalidation.removeErrorClassForRegForm('#projectZipcode', '#errorprojectZipcode', '#projectZipcode\\.errors');
            }
            else
            {
                ACC.formvalidation.addErrorClassForRegForm('#projectZipcode', '#errorprojectZipcode', '#projectZipcode\\.errors',ACC.config.zipCodeError);
            }
        });
  
   
    },
    
    
    leadFormSubmit: function()
    {
    $(document).on("input blur", "#email", function(e)
{
if(ACC.formvalidation.validateEmailPattern($("#email").val()))
    {
ACC.formvalidation.removeErrorClassForRegForm('#email', '#errorEmail', '#emailaddress\\.errors');
}
else
{
ACC.formvalidation.addErrorClassForRegForm('#email', '#errorEmail', '#emailaddress\\.errors', ERRORMSG.invalid.email);
}
});
    $(document).on("input blur", "#zipCode", function(e)
    {
    if(ACC.formvalidation.validatezipcode(e, $("#zipCode").val()))
{
ACC.formvalidation.removeErrorClassForRegForm('#zipCode', '#errorZipCode', '#zipCode\\.errors');
}
else
{
ACC.formvalidation.addErrorClassForRegForm('#zipCode', '#errorZipCode', '#zipCode\\.errors', ACC.config.validZip);
}
    });
    $(document).on("input", "#leadPhone", function(e)
    {
    ACC.formvalidation.handlePhoneNumberOnInput('#leadPhone', '#errorPhone', '#phone\\.errors');
    });
   
    $(document.body).on("change","#optings",function()
        {
      if($("#optings").prop("checked") == false)
      {
    $("#optingsError").html("<font color='red'>Please check the box to confirm your interest.</font><br/>");
      }
    else
      {
    $("#optingsError").html("");
      }
        });
     
$(document).on("click",".unlockmore",function(e)
        {
var status = true;
 
var briteverify= document.getElementById('briteVerifyEnable').value;
 
var briteverifytimeout= document.getElementById('briteVerifyTimeout').value;
ACC.formvalidation.validateFieldBasedOnRegex(e,'#firstName', '#errorFirstName', '#firstName\\.errors',ACC.config.nameMayInclude,ERRORMSG.global.firstname);
ACC.formvalidation.validateFieldBasedOnRegex(e,'#lastName', '#errorLastName', '#lastName\\.errors',ACC.config.nameMayInclude,ERRORMSG.global.lastname);
ACC.formvalidation.vaildateFields('#companyName', '#errorCompanyName', '#company\\.errors', "Please enter a company name");
 
if(ACC.formvalidation.validateEmailPattern($("#email").val()))
     {
ACC.formvalidation.removeErrorClassForRegForm('#email', '#errorEmail', '#emailaddress\\.errors');
}
else
{
status = false;
ACC.formvalidation.addErrorClassForRegForm('#email', '#errorEmail', '#emailaddress\\.errors', ERRORMSG.invalid.email);
}
 
if(null != $("#leadPhone").val() && $("#leadPhone").val() != '' && !ACC.formvalidation.validatePhoneNumber($("#leadPhone").val()))
{
    status = false;
    ACC.formvalidation.addErrorClassForRegForm('#leadPhone', '#errorPhone', '#phone\\.errors', ERRORMSG.global.phone);
}
else
{
ACC.formvalidation.removeErrorClassForRegForm('#leadPhone', '#errorPhone', '#phone\\.errors');
}
 
if(ACC.formvalidation.validatezipcode(e, $("#zipCode").val()))
{
ACC.formvalidation.removeErrorClassForRegForm('#zipCode', '#errorZipCode', '#zipCode\\.errors');
}
else
{
status = false;
ACC.formvalidation.addErrorClassForRegForm('#zipCode', '#errorZipCode', '#zipCode\\.errors', ACC.config.validZip);
}
 
$("#optingsError").html("");
if(!$("#optings").is(':checked'))
{
status = false;
$("#optingsError").html("<font color='red'>Please check the box to confirm your interest.</font><br/>");
}
else
{
ACC.formvalidation.removeErrorClassForRegForm('#optings', '#optingsError', '#optings\\.errors');
}
 
$('*[id*=error]:visible').each(function() 
{
if($(this).html() != '')
{
status = false;
}
});
 
if(status) 
{
ACC.briteverify.validateEmailWithBriteVerify('#email', '#errorEmail', '#Email\\.errors', ERRORMSG.global.email, $('#email').val(), '#siteOneLeadGenerationForm');
}
else
{
ACC.formvalidation.addGlobalError();
}
 
        });
    },

    emailSignUpPage: function()
    {
        $(document).on("input blur", "#emailIdSignUp", function()
{
        if(ACC.formvalidation.validateEmailPattern($("#emailIdSignUp").val()))
    {
ACC.formvalidation.removeErrorClassForRegForm('#emailIdSignUp', '#emailErrors', '#emailIdSignUp\\.errors');
}
else
{
ACC.formvalidation.addErrorClassForRegForm('#emailIdSignUp', '#emailErrors', '#emailIdSignUp\\.errors', ERRORMSG.invalid.email);
}
        
    });
    $(document).on("click", "#signUpPage", function (e) 
{
    var status = true;
   
    if(ACC.formvalidation.validatezipcode(e,$('#zipcode').val()))
    {
    ACC.formvalidation.removeErrorClassForRegForm('#zipcode', '#errorZipcode', '#zipcode\\.errors', ACC.config.validZip);
    }
    else
    {
    status = false;
    ACC.formvalidation.addErrorClassForRegForm('#zipcode', '#errorZipcode', '#zipcode\\.errors', ACC.config.validZip);
    }
   
    if(ACC.formvalidation.validateEmailPattern($("#emailIdSignUp").val()))
    {
ACC.formvalidation.removeErrorClassForRegForm('#emailIdSignUp', '#emailErrors', '#emailIdSignUp\\.errors');
}
else
{
status = false;
ACC.formvalidation.addErrorClassForRegForm('#emailIdSignUp', '#emailErrors', '#emailIdSignUp\\.errors', ERRORMSG.invalid.email);
}
   
    $("#agreeError").html("");
    if(!$("#agree").is(':checked'))
    {
    status = false;
    $("#agreeError").html("<font color='red'>Please check the box to confirm your interest.</font><br/>");
    }
   
var briteverify= document.getElementById('briteVerifyEnable').value;
var briteverifytimeout= document.getElementById('briteVerifyTimeout').value;
   
if(status)
{
if(briteverify == "true")
    {
url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+$('#emailIdSignUp').val();

                    loading.start();
$.ajax({
      url: url,
      type: "GET",
      timeout: briteverifytimeout,
      success: function (response)
      {
      if(response !="invalid")
      {
          ewt.trackFormSubmit({name:'emailsignup _form_submit',type:'email_sign_up',form:$("#siteOneEmailSignUpForm")});
      $("#siteOneEmailSignUpForm").submit();
      }
          else
          {
                            loading.stop();
          $("#emailErrors").html("<div class='bg-danger'><div class='panel-body'><font color='red'>" + ERRORMSG.invalid.email + "</font></div></div>");
          }
      },
      
      error: function(response, textstatus, message) 
{
                      loading.stop();
  if(textstatus == "timeout" || textstatus == "error") 
  {
$("#emailErrors").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
    } 
  
}
});
    }
    else
    {
                loading.start();
                ewt.trackFormSubmit({name:'emailsignup _form_submit',type:'email_sign_up',form:$("#siteOneEmailSignUpForm")});
    $("#siteOneEmailSignUpForm").submit();
    }
}
   
   
});

    $(document).on("focusin", "#emailIdSignUp",function(e)
{
    $("#emailError").empty();
});

    },
    
    siteOneHomeOwnerForm:function()
    {
    var briteverify= document.getElementById('briteVerifyEnable').value;
   
      $(document).on("input", "#homeownerphone", function(e)
        {
      ACC.formvalidation.handlePhoneNumberOnInput('#homeownerphone', '#errorhomeownerphone', '#phone\\.errors');
        });
     
      $(document).on("blur", "#emailAddr", function()
  {
      if(ACC.formvalidation.validateEmailPattern($("#emailAddr").val()))
      {
  ACC.formvalidation.removeErrorClassForRegForm('#emailAddr', '#erroremailaddr', '#emailAddr\\.errors');
  }
  else
  {
  ACC.formvalidation.addErrorClassForRegForm('#emailAddr', '#erroremailaddr', '#emailAddr\\.errors', ERRORMSG.invalid.email);
  }
          
      });
     
      $(document).on("blur", "#customerCity", function()
      {
     
          if(ACC.formvalidation.vaildateFields('#customerCity'))
          {
    
      ACC.formvalidation.removeErrorClassForRegForm('#customerCity', '#errorcustomercity', '#customerCity\\.errors');
      }
      else
      {
      ACC.formvalidation.addErrorClassForRegForm('#customerCity', '#errorcustomercity', '#customerCity\\.errors', ERRORMSG.global.city);
      }
              
          });
     
      $(document).on("blur", "#customerState", function()
      {
     
          if(ACC.formvalidation.vaildateFields('#customerState'))
          {
      ACC.formvalidation.removeErrorClassForRegForm('#customerState', '#errorcustomerstate', '#customerState\\.errors');
      }
      else
      {
      ACC.formvalidation.addErrorClassForRegForm('#customerState', '#errorcustomerstate', '#customerState\\.errors', ACC.config.selectState);
      }
              
          });
     
      $(document).on("blur", "#serviceType", function()
      {
     
          if(ACC.formvalidation.vaildateFields('#serviceType'))
          {
      ACC.formvalidation.removeErrorClassForRegForm('#serviceType', '#errorsrevicetype', '#serviceType\\.errors');
      }
      else
      {
      ACC.formvalidation.addErrorClassForRegForm('#serviceType', '#errorsrevicetype', '#serviceType\\.errors', "Please select the type of service needed.");
      }
              
          });
     
      $(document).on("blur", "#referalsNo", function()
      {
     
          if(ACC.formvalidation.vaildateFields('#referalsNo'))
          {
      ACC.formvalidation.removeErrorClassForRegForm('#referalsNo', '#errorreferalno', '#referalsNo\\.errors');
      }
      else
      {
      ACC.formvalidation.addErrorClassForRegForm('#referalsNo', '#errorreferalno', '#referalsNo\\.errors', "Please specify the number of referrals you would like.");
      }
              
          });
     
     
      $(document).on("blur", "#customerZipCode", function(e)
      {
          if(ACC.formvalidation.validatezipcode(e,$("#customerZipCode").val()))
          {
      ACC.formvalidation.removeErrorClassForRegForm('#customerZipCode', '#errorcustomerzipcode', '#customerZipCode\\.errors');
      }
      else
      {
      ACC.formvalidation.addErrorClassForRegForm('#customerZipCode', '#errorcustomerzipcode', '#customerZipCode\\.errors', ACC.config.validZip);
      }
              
          });
   
   
    $(document).on("click", "#homeowner", function (e)
        {
        e.preventDefault();
        var status = true;
		var currentBaseStoreId = $('.currentBaseStoreId').val();
        document.getElementById('recaptchaValidator').value = grecaptcha.getResponse();
        ACC.briteverify.reCaptcha(grecaptcha.getResponse());
       
ACC.formvalidation.vaildateFields('#firstName', '#errorfirstname', '#firstName\\.errors',ACC.config.firstName);
ACC.formvalidation.vaildateFields('#lastName', '#errorlastname', '#lastName\\.errors',ACC.config.firstName); 
//ACC.formvalidation.vaildateFields('#emailAddr', '#erroremailaddr', '#emailAddr\\.errors', ERRORMSG.global.email);
ACC.formvalidation.vaildateFields('#homeownerphone', '#errorhomeownerphone', '#phone\\.errors', ACC.config.firstName);
ACC.formvalidation.vaildateFields('#customerCity', '#errorcustomercity', '#customerCity\\.errors', ERRORMSG.global.city);

ACC.formvalidation.vaildateFields('#customerZipCode', '#errorcustomerzipcode', '#customerZipCode\\.errors', ACC.config.validZip);
ACC.formvalidation.vaildateFields('#customerState', '#errorcustomerstate', '#customerState\\.errors', ACC.config.selectState);
ACC.formvalidation.vaildateFields('#serviceType', '#errorsrevicetype', '#serviceType\\.errors',ACC.config.selectService);
ACC.formvalidation.vaildateFields('#referalsNo', '#errorreferalno', '#referalsNo\\.errors',ACC.config.specifyReferrals);
 
if(null != $("#homeownerphone").val() && $("#homeownerphone").val() != '')
{
if(!ACC.formvalidation.validatePhoneNumber($("#homeownerphone").val()))
{
    status = false;
    ACC.formvalidation.addErrorClassForRegForm('#homeownerphone', '#errorhomeownerphone', '#phone\\.errors', ERRORMSG.global.phone);
}
else
{
ACC.formvalidation.removeErrorClassForRegForm('#homeownerphone', '#errorhomeownerphone', '#phone\\.errors');
}
}
else
{
status = false;
    ACC.formvalidation.addErrorClassForRegForm('#homeownerphone', '#errorhomeownerphone', '#phone\\.errors',ACC.config.phoneNumber);
}
 
if(ACC.formvalidation.validatezipcode(e, $("#customerZipCode").val()))
{
ACC.formvalidation.removeErrorClassForRegForm('#customerZipCode', '#errorcustomerzipcode', '#customerZipCode\\.errors');
}
else
{
status = false;
ACC.formvalidation.addErrorClassForRegForm('#customerZipCode', '#errorcustomerzipcode', '#customerZipCode\\.errors',ACC.config.validZip);
}
 
if(ACC.formvalidation.validateEmailPattern($("#emailAddr").val()))
      {
  ACC.formvalidation.removeErrorClassForRegForm('#emailAddr', '#erroremailaddr', '#emailAddr\\.errors');
  }
  else
  {
  status = false;
  ACC.formvalidation.addErrorClassForRegForm('#emailAddr', '#erroremailaddr', '#emailAddr\\.errors', ERRORMSG.invalid.email);
  }
 
$('*[id*=error]:visible').each(function() 
{
if($(this).html() != '')
{
status = false;
}
});
       
       
        if(status)
        {
        ACC.briteverify.validateEmailWithBriteVerify('#emailAddr', '#erroremailaddr', '#emailAddr\\.errors', ERRORMSG.global.email, $('#emailAddr').val(), '#siteOneHomeOwnerForm');
        }
        else
        {
        ACC.formvalidation.addGlobalError();
        }
        });
           
       
       
        //});
       
    },
 privacyRequestFormSubmit: function ()
    {
   
        
      $(document).on("input blur", "#phonenumbercontact", function(e)
{

     ACC.formvalidation.handlePhoneNumberOnInput('#phonenumbercontact', '#errorphonenumber', '#phoneNumber\\.errors');
});
      
     $(document).on('input blur', "#firstName,#lastName,#customerCity,#privacyRequestType,#state,#accountNumber,#emailaddress,#customerZipCode", function (e) {
         var thisId = $(this).attr('id');
         if (thisId === "firstName") {
             ACC.formvalidation.validateFieldBasedOnRegex(e, '#firstName', '#errorfirstname', '#firstName\\.errors', ACC.config.nameMayInclude, ACC.config.enterFirstName);
         }
         else if (thisId === "lastName") {
             ACC.formvalidation.validateFieldBasedOnRegex(e, '#lastName', '#errorlastname', '#lastName\\.errors', ACC.config.nameMayInclude, ACC.config.enterLastName);
         }
         else if (thisId === "customerCity") {
             ACC.formvalidation.validateFieldBasedOnRegex(e, '#customerCity', '#customerCityError', '#customerCity\\.errors', ACC.config.briteCityMay, ERRORMSG.global.city,"city");
         }
         else if (thisId === "privacyRequestType") {
             ACC.formvalidation.vaildateFields('#privacyRequestType', '#errorselectrequest', '#privacyRequestType\\.errors', ACC.config.selectRequest);
         }
         else if (thisId === "state") {
        	 ACC.formvalidation.vaildateFields('#state', '#errorcustomerstate', '#state\\.errors', ACC.config.selectState);
         }
         else if (thisId === "accountNumber") {
             ACC.formvalidation.validateAccountNumber(e, '#accountNumber', '#accountNumberError', '#accountNumber\\.errors', ACC.config.enterAccountNumber + '<div class="cl"></div><br/><br/>');
         }
         else if (thisId === "emailaddress") {
             if (ACC.formvalidation.validateEmailPattern($("#emailaddress").val())) {
                 ACC.formvalidation.removeErrorClassForRegForm('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors');
             }
             else {
                 ACC.formvalidation.addErrorClassForRegForm('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
             }
         }
         else if (thisId === "customerZipCode") {
             if ((ACC.formvalidation.validatezipcode(e, $("#customerZipCode").val()))) {
                 ACC.formvalidation.removeErrorClassForRegForm('#customerZipCode', '#customerZipCodeError', '#customerZipCode\\.errors');
             }
             else {
                 ACC.formvalidation.addErrorClassForRegForm('#customerZipCode', '#customerZipCodeError', '#customerZipCode\\.errors', ACC.config.validZip);
             }
         }

     });     
       
      
      $(document).on("change", "#state", function()
    	      {
    	     
    	          if(ACC.formvalidation.vaildateFields('#state'))
    	          {
    	      ACC.formvalidation.removeErrorClassForRegForm('#state', '#errorcustomerstate', '#state\\.errors');
    	      }
    	      else
    	      {
    	      ACC.formvalidation.addErrorClassForRegForm('#state', '#errorcustomerstate', '#state\\.errors', ACC.config.selectState);
    	      }
    	              
                  });
    function emptyValidationCcpa(id,errorId,errorText,globalMsg){
        if($(id).val() == "" || $(id).val() == null)
        {
        status = false;
        ACC.formvalidation.addErrorClassForRegForm(id, errorId, errorText, globalMsg);
        }
        else
        {
        $(errorId).empty();
        }
    }
    
    $(document).on('.page-ccpa input blur', "#firstName", function(e){
    	emptyValidationCcpa('#firstName', '#errorfirstname', '#firstName\\.errors', ACC.config.enterFirstName);
    });
    
    $(document).on('.page-ccpa input blur', "#lastName", function(e){
    	emptyValidationCcpa('#lastName', '#errorlastname', '#lastName\\.errors', ACC.config.enterLastName);
    });
    
    $(document).on("click", ".privacyRequest", function (e)
    {
    var status = true;
    e.preventDefault();
    document.getElementById('recaptchaValidator').value = grecaptcha.getResponse();
    ACC.briteverify.reCaptcha(grecaptcha.getResponse());
  
    ACC.formvalidation.vaildateFields('#privacyRequestType', '#errorselectrequest', '#privacyRequestType\\.errors', ACC.config.selectReason); 
    ACC.formvalidation.validateFieldBasedOnRegex(e,'#firstName', '#errorfirstname', '#firstName\\.errors',ACC.config.nameMayInclude,ERRORMSG.global.firstname);
    ACC.formvalidation.validateFieldBasedOnRegex(e,'#lastName', '#errorlastname', '#lastName\\.errors',ACC.config.nameMayInclude,ERRORMSG.global.lastname);
    emptyValidationCcpa('#state', '#errorcustomerstate', '#state\\.errors', ACC.config.selectState);
    emptyValidationCcpa('#firstName', '#errorfirstname', '#firstName\\.errors', ACC.config.enterFirstName);
    emptyValidationCcpa('#lastName', '#errorlastname', '#lastName\\.errors', ACC.config.enterLastName);
    emptyValidationCcpa('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
   
             

if(ACC.formvalidation.validateEmailPattern($("#emailaddress").val()))
    {
ACC.formvalidation.removeErrorClassForRegForm('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
}

 
    $('*[id*=error]:visible').each(function() 
{
if($(this).html() != '')
{
status = false;
}
});
   
   
    if(status)
    {
    ACC.briteverify.validateEmailWithBriteVerify('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.global.email, $('#emailaddress').val(), '#siteoneCCPAForm');
    }
    else
{
    /*window.scrollTo(500, 0);*/
       ACC.formvalidation.addGlobalError();
}
   
    });
   
    },
    
    inspireForm:function()
    {
    $(document).on("change","#pageSize",function()
    {
    $('#inspireForm').submit();
    });
    },
    
    enableDisableSendEmailAction :function(length, action,textstatus)
    {
   
    if((null != length && length == 0 && $('#invoiceNumber').val() != undefined) || (null != length && length == 0 && $('#orderCode').val() != undefined) || (null != length && length == 0 && $('#cartCode').val() != undefined ) || (null != length && length == 0 && $('#productcode').val() != undefined) )
{
$('#emailSubmit').removeAttr('disabled');
}
   
  
    if(null != action && action == 'disable')
{
    $('#emailSubmit').attr('disabled', 'disabled');
}
   
    if(null != action && action == 'disable')
{
    $('#signUpPage').attr('disabled', 'disabled');
}
    },
    
    sendEmails :function(emails, map)
    {
    var status = true;
   
    var emailsList = emails.split(",");
var length = emailsList.length;
   
    if(null != map)
    {
    if(Object.keys(map).length == length)
    {
    $.each(emailsList,function(i)
{
if(!map[emailsList[i]])
{
status = false;
}
});
    }
    else
    {
    status = false;
    }
    }
   
    var productcode = $('#productcode').val();
    
    var cartCode = $('#cartCode').val();
    
    var invoiceNumber=$('#invoiceNumber').val();
    
    var uid=$('#uid').val();
    
     var invoiceCode = $('#invoiceCode').val();
    
    var orderCode = $('#orderCode').val();
    
    var savedListCode=$("#savedListCode").val();
    
    var assemblyCode=$("#assemblyCode").val();
	
	var accountNumber=$("#accountNumber").val();
    
    if(status)
    {
    if(productcode!= undefined)
{
   ACC.shareproductemail.productEmail(emails,productcode);
}
if(cartCode!= undefined)
{
   ACC.sharecart.cartEmail(emails,cartCode);
}
if(invoiceNumber!= undefined)
{
   ACC.accountdashboard.sendInvoiceEmail(emails,invoiceNumber,accountNumber);
}
if(orderCode!= undefined)
{
   ACC.accountdashboard.sendOrderDetailEmail(emails,orderCode,invoiceCode,uid);
}
if(savedListCode!=undefined)
{
ACC.sharelistemail.listEmail(emails,savedListCode);
}
if(assemblyCode!=undefined)
{
ACC.sharelistemail.assemblyEmail(emails,assemblyCode);
}
    }
   
    },
    
checkToEmails:function(emails)
{
var emailsList = emails.split(",");
var length = emailsList.length;
var briteverify= document.getElementById('briteVerifyEnable').value;
var briteverifytimeout= document.getElementById('briteVerifyTimeout').value;
var status = true;
var verificationMap = new Object();
if(briteverify=="true")
{
$.each(emailsList,function(i)
{
//var email=emailsList[i]
verificationMap[emailsList[i]] = false;
url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+ emailsList[i];

                    loading.start();
$.ajax({
url: url,
type: "get",
timeout: briteverifytimeout,
success: function (response)
{
if(response == "invalid")
{
                            loading.stop();
$("#emailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressError1+"</div></font></div>");
}
else
{
verificationMap[emailsList[i]] = true;
ACC.briteverify.sendEmails(emails, verificationMap);
}
},
error: function(response, textstatus, message) 
{
  loading.stop();
  if(textstatus == "timeout" || textstatus == "error") 
  {
$("#emailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
ACC.briteverify.enableDisableSendEmailAction(null, "disable");
      } 
}
});
});
$.each(emailsList,function(i)
{
if(!verificationMap[emailsList[i]])
{
status = false;
}
});
if(status)
{
ACC.briteverify.sendEmails(emails, null);
}
}
else
{
ACC.briteverify.sendEmails(emails, null);
}
    },
    
    checkToEmailsOnKeyUp:function(emails,eventType)
{
var emailsList = emails.split(",");
var length = emailsList.length;
var briteverify= document.getElementById('briteVerifyEnable').value;
$.each(emailsList,function(i)
{
var email=emailsList[i];
if(briteverify=="true")
{
url = ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email='+email;

                    $.ajax({
url: url,
type: "get",
  timeout: 5000,
success: function (response)
{
if(response  == "invalid")
{
if("keyup"!=eventType){
$("#emailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>" + ERRORMSG.invalid.email + "</div></font></div>");
/*ACC.briteverify.enableDisableSendEmailAction(null, "disable");*/
}else{
ACC.briteverify.enableDisableSendEmailAction(length, "disable");
}
} 
else
{ 
length = length - 1;
ACC.briteverify.enableDisableSendEmailAction(length, null);
}
},
error: function(response, textstatus, message) 
  {
  if(textstatus == "timeout" || textstatus == "error") 
  {
if("keyup"!=eventType){
$("#emailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressUnable+"</div></font></div>");
}
ACC.briteverify.enableDisableSendEmailAction(null, "disable");
      } 
  }
});
}
});
    },
    emailSubscription: function(email)
    {
    var zipCode=$('#zipcode').val();
var role=$("input[name='role']:checked").val();
var data = {"email": email , "zipCode":zipCode , "role":role};
        loading.start();
$.ajax({ 
              type: "GET",
              url: ACC.config.encodedContextPath + "/emailsubscription",
              cache: false,
              data : {"email": email , "zipCode":zipCode , "role":role},
              dataType: "json",
              success: function (response) 
              {
              if(response == 'SUCCESS')
              {
              
              $.cookie("emailSignUp", "done", { expires: 90 });
                  ACC.accountdashboard.signUpSuccessPopup();
                  ewt.trackFormSubmit({name:'emailsignup _form_submit',type:'email_sign_up',form:data});
              }
              else if(response == 'ERROR')
                {
              ACC.accountdashboard.signUpFailurePopup(ACC.config.pleaseTry);
                }
              else
            {
              ACC.accountdashboard.signUpFailurePopup(ACC.config.alreadySignedError1 +" "+ response +" "+ ACC.config.alreadySignedError2);
            }
                },
                error: function (error)
                {
                ACC.accountdashboard.signUpFailurePopup(ACC.config.pleaseTry);
                }
}).always(function() {
        loading.stop();
      });
    },
    
    emailSignUpFooter: function(email)
    {
        var data = {"email": email};
    return $.ajax({
    type: "GET",
            url: ACC.config.encodedContextPath + "/emailsubscription",
            cache: false,
            data : {"email": email},
            dataType: "json",
            success: function (response) 
            {
            if(response == 'SUCCESS')
            {
            $(".message").html("<div><b>"+ACC.config.confirmationMail+"</b></div>"); 
                $.cookie("emailSignUp", "done", { expires: 90 });                
                    
                ewt.trackFormSubmit({name:'emailsignup_footer_form_submit',type:'email_sign_up_footer',form:data});
            }
            else if(response == 'ERROR')
            {
            $(".message").html("<div><b>"+ACC.config.pleaseTry+"</b></div>"); 
            }
            else
        {
            $(".message").html("<div class='sales-price'>"+ACC.config.alreadySignedError1+" "  + response + " "+ACC.config.alreadySignedError2 +"</div>");
        }
            },
            error: function (error) 
            {
            $(".message").html("<div><b>"+ACC.config.pleaseTry+"</b></div>");      
            }
            
    });
            
    }
    
    
    

}
ACC.shareproductemail = {

	_autoload: [
	    
	    "bindSharedProductEmail"
	    
	],
	
	
	
	bindSharedProductEmail: function()
    {
    	$(document).on("click", ".shareproductemail", function(e)
		{
    	    e.preventDefault();
            window.scrollTo(0,0);
    		ACC.shareproductemail.sharedproductPopup();
		});
    
      
    	$(document).on("click", "#productEmailSubmit", function()
    			{
    		$("#emailError").html("");
    		if($("#emailIdProduct").val() == "" || $("#emailIdProduct").val() == null)
    		{
    			status = false;
    			$("#emailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressError+"</div></font></div>");
    			
    		}
    		else
    		{
    	
    			ACC.briteverify.checkToEmails($("#emailIdProduct").val());
    			
    		}
	    	    		
    			});
    },
    
    
    productEmail: function(emails,productcode)
	{
        loading.start();
    	$.ajax({
         	type: "GET",
         	url: ACC.config.encodedContextPath + "/shareProductEmail/" +productcode,
         	cache: false,
         	data : {"email": emails},
         	dataType: "json",
         	success: function (response) 
         	
         	{
        		$('#colorbox').removeClass('share_By_Email_Popup');
         		ACC.global.successPopup();
         		ACC.colorbox.resizeTo(null,300);
            }
             
			}).always(function() {
                loading.stop();
            });
	},
	
	sharedproductPopup: function()
	{
        ACC.colorbox.open("", {
            html : "<div class='PopupBox'>"+
                        "<h3 class='shareEmail_heading product-headline-email'> "+ACC.config.shareByEmail+"</h3>"+
                        "<div class='margin20 share-product-email-description'>"+ACC.config.shareCartTell+"</div>"+
                        "<label for='emailIdProduct'><h5>"+ACC.config.emailTo+"</h5></label>"+
                        "<textarea class='col-md-12 col-sm-12 col-xs-12 form-control textarea' type='textarea' id='emailIdProduct' rows='5' cols='10' placeholder='"+ACC.config.enterEmail+"' ></textarea>"+
                        "<div id = 'emailError' style='margin:30px 0px'></div>"+
                        "<input id='productEmailSubmit' class='btn btn-primary btn-center margin20' type='button' value='"+ACC.config.contactUsEmail+"'>"+
                    "</div>",
            width:"450px",
            /*title: "<h4 class='hidden-md hidden-lg hidden-sm share-product-email-title headline'><span class='headline-text'>Share By Email</span></h4>",*/
            onComplete: function() {
             	$('#colorbox').addClass('share_By_Email_Popup');
            },
            onClosed: function() {
        		$('body').css("overflow-y","auto");
        		$('#colorbox').removeClass('share_By_Email_Popup');
        	}
        });
	}
};

$('.share-link').on('click',function () {
	$('body').css("overflow-y", "hidden");	
});

/*
$('#close').trigger("Close",["close", Event]);

$('#close').on("Close", function() {
	$('body').css("overflow-y", "auto");	
});*/



ACC.sharecart = {

		_autoload: [

		            "bindShareCartPopup"

		            ],
		            bindShareCartPopup: function()
		            {
		            	$('.shareCart').on('click', function()
	            		{
		            		window.scrollTo(0,0);
	            			ACC.sharecart.shareCartPopup();
	            			_AAData.popupPageName= ACC.config.emailcart;
	            			_AAData.popupChannel= ACC.config.checkoutpathingChannel;
	        			 	try {
	        				    	 _satellite.track('popupView');
	        		        } catch (e) {}
	            		});

		            	$(document).on("click", "#cartEmailSubmit", function()
            			{
		            		$("#emailError").html("");
		            		 
			        		if($("#emailIdCart").val() == "" || $("#emailIdCart").val() == null)
			        		{
			        			status = false;
			        			$("#emailError").html("<div class='bg-danger'><div class='panel-body'><font color='red'>"+ACC.config.emailAddressError+"</font></div></div>");
			        		}
			        		else
			        		{
			        			ACC.briteverify.checkToEmails($("#emailIdCart").val());
			        		}
            			});
		            	
		            },
		            
		            cartEmail: function(email,cartCode)
		            {
		            	loading.start();
		            	$.ajax({
		                    	type: "GET",
		                    	url: ACC.config.encodedContextPath + "/shareCartEmail/" + cartCode,
		                    	cache: false,
		                    	data : {"email": email},
		                    	dataType: "json",
		                    	success: function (response) 
		                    	{
		                    		$('#colorbox').removeClass('share-cart-email-box');
		                    		ACC.global.successPopup();
		                        }
							}).always(function() {
								loading.stop();
							});
		            },

		            shareCartPopup: function()
		        	{ 
		        		ACC.colorbox.open("", {
		                html : ["<div class='cartShareEmail PopupBox'>",
		                        "<h1 class='cartHeadlineEmail headline2 hidden-xs hidden-sm'>"+ACC.config.shareByEmail+"</h1>",
		                        "<div class='share-cart-email-description'>"+ACC.config.shareCartTell+"</div>",
		                        "<label for='emailIdCart' style='color:inherit; font-size:14px;'>"+ACC.config.emailTo+"</label>",
		                        "<textarea class='col-md-12 col-sm-12 col-xs-12 form-control marginBottom20 textarea' type='textarea' id='emailIdCart' rows='6' cols='10' placeholder='"+ACC.config.enterEmail+"'></textarea>",
		                        "<div class='cl'></div><div id = 'emailError'></div>",
		                        "<input id='cartEmailSubmit' class='btn btn-primary btn-center margin20' type='button' value='"+ACC.config.contactUsEmail+"'>",
		                    "</div>"].join(''),
		                    width:"430px",
		                    className:"cartEmail",
		            		close:'<span class="glyphicon glyphicon-remove" id="close"></span>',
		                    title: "<h4 class='hidden-md hidden-lg share-cart-email-title headline'><span class='headline-text'>"+ACC.config.shareByEmail+"</span></h4>",
		                    	onComplete: function() {
		                    	    $('#colorbox').addClass('share-cart-email-box');
		                    		$("body").css("overflow-y", "hidden");
		                    	},
		                    	onClosed: function() {
		                    		$('body').css("overflow-y","auto");
		                    		$('#colorbox').removeClass('share-cart-email-box');
		                    	}
		        		});
		        }
};

ACC.formvalidation = {

	_autoload: [
		"requestAccountValidations",
		"createUserValidations",
		"addressCreationValidations",
		"placeOrdersApproval"
	],

	addGlobalError: function ()
	{
		
		//var result = containsAny("div.alert", ["Please", "Por"]);
		
		

		if (($('.global-alerts > div.alert:contains("Please")').length == 0 ) && ($('.global-alerts > div.alert:contains("Por")').length == 0))
		{
			
			//$(".global-alerts").show();
			$(".breadcrumb-section").append("<div class='global-alerts container-lg container-fluid'>	<div class='alert alert-box alert-dismissable edit-user-alert'>" +
			 
			"<div class='msg alert-msg-text'>"+ACC.config.globalError+"</div></div></div>");
			$('html, body').animate({
			                scrollTop: $(".container").offset().top
			            }, 0);
			
		}
		
		else
		{
			$(".global-alerts").show();
			$('html, body').animate({
			                scrollTop: $(".container").offset().top
			            }, 0);
		}
	},

	
	addErrorClassForRegForm: function (input, error, errorText, msg)
	{
		$(error).html(msg);
		$(input).css("cssText", "background-color: #fec3c3 !important");
		$(input).css("border-color", "#fd7b7b");
		$(input).parent().css("margin-bottom", "5px");
		$(error).css("color", "#fe0303");
		$(error).css("font-weight", "normal");
		$(errorText).html('');
	},
	
	removeErrorClassForRegForm: function (input, error, errorText)
	{
		$(error).html('');
		$(input).removeAttr('style');
		$(error).removeAttr('style');
		$(input).css("background", "#ffffff");
		$(input).css("border-color", "#cccccc");
		$(input + "\\.errors").hide();
		$(errorText).html('');
	},
	
	vaildateFields: function (input, error, errorText, msg)
	{
		var valid = false;
		
	    if($(input).val()==null || $(input).val() == "" || $(input).val() =="Select")
	    {
	    	ACC.formvalidation.addErrorClassForRegForm(input, error, errorText, msg);
	    }
	    else
	    {
	    	ACC.formvalidation.removeErrorClassForRegForm(input, error, errorText);
	    	valid = true;
	    }
	    return valid;
	},

	vaildateShippingState: function (input, error, errorText, msg, stateMsg)
	{
		var valid = false;
		let isNationalShipping = ($(".isNationalShipping").length)? $(".isNationalShipping").val() : 'false';
	    if($(input).val()==null || $(input).val() == "" || $(input).val() =="Select")
	    {
	    	ACC.formvalidation.addErrorClassForRegForm(input, error, errorText, msg);
	    }
	    else if (isNationalShipping == 'false' && $(input).val() != _AAData.storeState)
		{
			ACC.formvalidation.addErrorClassForRegForm(input, error, errorText, stateMsg);
		}
		else
	    {
	    	ACC.formvalidation.removeErrorClassForRegForm(input, error, errorText);
			$('.same-shipping-state-error').hide();
	    	valid = true;
	    }
	    return valid;
	},
	
	handlePhoneNumberOnInput: function (input, error, errorText)
	{
		var val = $(input).val();
	    	if(isNaN(val)){
	         	val = val.replace(/[^0-9\.]/g,'');
	         	if(val.split('.').length>2) val =val.replace(/\.+$/,"");
	   	 }
	   	 $(input).val(val);
		
		var length = $(input).val().length;
		if(length >= 10)
    	{
			if(ACC.formvalidation.validatePhoneNumber($(input).val()))
			{	
				ACC.formvalidation.removeErrorClassForRegForm(input, error, errorText);
				if(length == 10)
				{
					var a = $(input).val();
  		    		var b = "-";
  		    		var position1 = 3;
  		    		var position2 = 7;
  		    		var output1 = [a.slice(0, position1), b, a.slice(position1)].join('');
  		    		var output2 = [output1.slice(0, position2), b, output1.slice(position2)].join('');
  		    		$(input).val(output2);
      		    	$(input).attr('maxlength', '12');
				}
				else
				{
					return true;
				}
			}
			else
			{	
				ACC.formvalidation.addErrorClassForRegForm(input, error, errorText, ACC.config.phoneNumberError);
			}
    	}
	},
	
	validatePhoneNumber: function (input)
	{
		var regex1 = new RegExp("^([0-9]{10})$");
		var regex2 = new RegExp("^([0-9]{3})(-)([0-9]{3})(-)([0-9]{4})$");
		if(regex1.test(input) || regex2.test(input))
		{
			return true;
		}
		else
		{
			 return false;
		}
	},
	
	validatezipcode: function (e, zipcode) {
		var regex1 = new RegExp("^([0-9]{5})(-)([0-9]{4})$"); // US ZIP+4 (12345-6789)
		var regex2 = new RegExp("^([0-9]{5})$"); // US Standard ZIP (12345)
		var canadaRegex = new RegExp("^[A-Za-z][0-9][A-Za-z] ?[0-9][A-Za-z][0-9]$"); // Canada (M6H 2C3 or M6H2C3)
		//var zipcode = $("#zipcode").val();
		if (zipcode == null || zipcode == "") {
			return false;
		} else {
			var keystobepassedout = "BackspaceTabDelete";
			if (keystobepassedout.indexOf(e.key) != -1) {
				return true;
			}
			var countryIsoCode = $('.currentBaseStoreId').val();
			if (countryIsoCode === "US") {
				if (regex1.test(zipcode) || regex2.test(zipcode)) {
					return true;
				}
			} else if (countryIsoCode === "CA") {
				if (canadaRegex.test(zipcode)) {
					return true;
				}
			}
			return false;
		}
	},
	validateEmailPattern: function (email)
	{
		var mailformat = new RegExp("^[a-zA-Z0-9._%'-]*@[a-zA-Z0-9.-]*(\\.[A-Za-z]{2,20})$");
		if (email == null || email == "" || email == undefined) 
		{
			 return false;
        }
		else
		{  
        	if(mailformat.test(email))
        	{
        		return true;
        	}
        	else
        	{	
        		return false;
        	}
        }
	},
	validateYearsInBusiness: function (contrYearsInBusiness){
		
		var regex1 = new RegExp("^\\s*(?=.*[0-9])\\d{0,3}(?:\\.\\d{1,2})?\\s*$");
		
		if (contrYearsInBusiness == null || contrYearsInBusiness == "" || contrYearsInBusiness == undefined) 
		{
			 return false;
        }
		else
		{ 
			if(regex1.test(contrYearsInBusiness))
        	{
        		return true;
        	}
        	else
        	{	
        		return false;
        	}
        }
	},
	
	validateAccountNumber: function (e)
	{
		var regex = new RegExp("^[0-9 -]+$");
        var radioValue = $("input[name='hasAccountNumber']:checked").val();
        if (regex.test($('#accountNumber').val())) 
        {
        	ACC.formvalidation.removeErrorClassForRegForm('#accountNumber', '#errorAccountNumber', '#accountNumber\\.errors');
            return true;
        }
        else if(radioValue == 'yes' && $('#accountNumber').val() != "" && !regex.test($('#accountNumber').val()))
        {
	        ACC.formvalidation.addErrorClassForRegForm('#accountNumber', '#errorAccountNumber', '#accountNumber\\.errors', ACC.config.accountNumberErrorMsg+'<div class="cl"></div><br/><br/>');
	        e.preventDefault();
	        return false;
        }
        else if(radioValue == 'yes' && $('#accountNumber').val() == "" && !regex.test($('#accountNumber').val()))
        {
        	ACC.formvalidation.addErrorClassForRegForm('#accountNumber', '#errorAccountNumber', '#accountNumber\\.errors', ACC.config.pleaseEnterAccountNumber+'<div class="cl"></div><br/><br/>');
	        e.preventDefault();
	        return false;
        }
	},
	
	validateFieldBasedOnRegex: function (e,input, error, errorText, msg, globalMsg, fieldType)
	{
		if(fieldType === undefined){
			var regex = new RegExp("^([A-Za-z/'-]*)$");
		} else if(fieldType == 'city') {
			var regex = new RegExp("^[a-zA-Z .-]*$");
		}
		else{
			var regex = new RegExp("^[a-zA-Z .-]*$");
		}
		
		
        if ($(input).val() != "" && regex.test($(input).val())) 
        {
        	ACC.formvalidation.removeErrorClassForRegForm(input, error, errorText);
            return true;
        }
        else if($(input).val() != "" && !regex.test($(input).val()))
        {	
        	ACC.formvalidation.addErrorClassForRegForm(input, error, errorText,msg);
 	        e.preventDefault();
 	        return false;
        }
        else
        {
	        ACC.formvalidation.addErrorClassForRegForm(input, error, errorText, globalMsg);
	        e.preventDefault();
	        return false;
        }
	},
	
	
	
	requestAccountValidations: function ()
	{
		function validateFirstAndLastName(e,id,errorId,errorText,nullErrMsg,msg, globalMsg){
		var status = '';
			if(ACC.formvalidation.vaildateFields(id,errorId,errorText,nullErrMsg)){
				status = ACC.formvalidation.validateFieldBasedOnRegex(e,id, errorId, errorText,msg ,globalMsg);
				}
			else{
				status = ACC.formvalidation.vaildateFields(id,errorId,errorText,nullErrMsg);
			}
			return status;
		}
		$("#recaptcha-border").removeClass('recaptcha-error-border');
		  if($('#recaptchaChallengeAnswered').val() == 'false')
			{
			 $("#recaptcha-error").removeClass('hidden');
			 $("#recaptcha-border").addClass('recaptcha-error-border');
			}
		$(document).on("input blur", "#companyName", function()
		{
	        var msg = ERRORMSG.global.company;
	        ACC.formvalidation.vaildateFields('#companyName', '#errorCompanyName', '#companyName\\.errors', msg);
	    });
		
		$(document).on("input blur", "#contrYearsInBusiness", function()
		{
			var contrYearsInBusiness = $(this).val();
			if(contrYearsInBusiness != null && contrYearsInBusiness != '' && contrYearsInBusiness != undefined)
		    {
		        if (!ACC.formvalidation.validateYearsInBusiness(contrYearsInBusiness))
                {
		        	var msg = strings['js.request.contryearsInBusiness.invalid'];
                    ACC.formvalidation.addErrorClassForRegForm('#contrYearsInBusiness', '#errorContrYearsInBusiness', '#contrYearsInBusiness\\.errors', msg);
                }
                else
                {
                    ACC.formvalidation.removeErrorClassForRegForm('#contrYearsInBusiness', '#errorContrYearsInBusiness', '#contrYearsInBusiness\\.errors');
                }
		    }
		    else
		    {
            	ACC.formvalidation.addErrorClassForRegForm('#contrYearsInBusiness', '#errorContrYearsInBusiness', '#contrYearsInBusiness\\.errors', strings['js.request.contryearsInBusiness.empty']);
		    }
		});
				
		$(document).on("input blur", "#contrEmpCount", function()
		{
			var msg = strings['js.request.contrempcount.empty'];
			ACC.formvalidation.vaildateFields('#contrEmpCount', '#errorContrEmpCount', '#contrEmpCount\\.errors', msg);
		});
		$(document).on("input blur", "#contrPrimaryBusiness", function()
		{
			var msg = strings['js.request.primarybusiness.empty'];
			ACC.formvalidation.vaildateFields('#contrPrimaryBusiness', '#errorContrPrimaryBusiness', '#contrPrimaryBusiness\\.errors', msg);
		});
		$(document).on("input change", "#contrPrimaryBusinessL1", function()
		{
			var msg = strings['js.request.primarybusiness.empty'];
			ACC.formvalidation.vaildateFields('#contrPrimaryBusiness', '#errorContrPrimaryBusiness', '#contrPrimaryBusiness\\.errors', msg);
		});
		
		$(document).on("input blur", "#landscapingIndustry", function()
		{
			var msg = strings['js.request.landscapingindustry.empty'];
			ACC.formvalidation.vaildateFields('#landscapingIndustry', '#errorlandscapingIndustry', '#landscapingIndustry\\.errors', msg);
		});


		$(document).on("blur", "#accountNumber", function()
		{
			var radioValue = $("input[name='hasAccountNumber']:checked").val();
			if(radioValue == 'yes')
			{
				var msg = ACC.config.pleaseEnterAccountNumber;
		        ACC.formvalidation.vaildateFields('#accountNumber', '#errorAccountNumber', '#accountNumber\\.errors', msg);
			}
		});
		
		$(document).on('input blur', "#accountNumber", function(e)
		{
			ACC.formvalidation.validateAccountNumber(e);
	    });
		
		
		$("input[name=hasAccountNumber]:radio").change(function () 
		{
			var radioValue = $("input[name='hasAccountNumber']:checked").val();
			if(radioValue == 'no')
			{
				ACC.formvalidation.removeErrorClassForRegForm('#accountNumber', '#errorAccountNumber', '#accountNumber\\.errors');
			}
		});
		
		$(document).on('input blur', "#firstName", function(e)		{	
			validateFirstAndLastName(e,'#firstName','#errorFirstName','#firstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
			
	    });
		
		
		$(document).on('input blur', "#lastName", function(e){
			validateFirstAndLastName(e,'#lastName','#errorLastName','#lastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);

	    });
		
		$(document).on('input blur', ".firstName", function(e)		{	
			validateFirstAndLastName(e,'.firstName','.errorFirstName','.firstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
			
	    });
		
		
		$(document).on('input blur', ".lastName", function(e){
			validateFirstAndLastName(e,'.lastName','.errorLastName','.lastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);

	    });
		
		$(document).on("input blur", "#addressLine1", function()
		{
	        var msg = ERRORMSG.global.address;
	        ACC.formvalidation.vaildateFields('#addressLine1', '#errorAddressLine1', '#addressLine1\\.errors', msg);
	    });
		
		$(document).on('input blur', "#city", function(e)
		{
			ACC.formvalidation.validateFieldBasedOnRegex(e,'#city', '#errorCity', '#city\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'city');
	    });
		
		$(document).on("input blur", "#state", function()
		{
	        var msg = ERRORMSG.global.state;
	        ACC.formvalidation.vaildateFields('#state', '#errorState', '#state\\.errors', msg);
	    });
		
		$(document).on("input blur", "#zipcode", function(e)
		{	
			if(ACC.formvalidation.validatezipcode(e, $("#zipcode").val()))
			{
				ACC.formvalidation.removeErrorClassForRegForm('#zipcode', '#errorZipcode', '#zipcode\\.errors');
			}
			else
			{
				ACC.formvalidation.addErrorClassForRegForm('#zipcode', '#errorZipcode', '#zipcode\\.errors',ACC.config.zipCodeError);
			}
	    });

		$(document).on("blur", "#phoneNumber", function(e)
		{
			var phoneNumber = $(this).val();
			if(phoneNumber != null && phoneNumber != '' && phoneNumber != undefined)
		    {
		        if (!ACC.formvalidation.validatePhoneNumber(phoneNumber))
                {
                    var msg= ACC.config.phoneNumberError ;
                    ACC.formvalidation.addErrorClassForRegForm('#phoneNumber', '#errorPhoneNumber', '#phoneNumber\\.errors', msg);
                }
                else
                {
                    ACC.formvalidation.removeErrorClassForRegForm('#phoneNumber', '#errorPhoneNumber', '#phoneNumber\\.errors');
                }
		    }
		    else
		    {
            	ACC.formvalidation.addErrorClassForRegForm('#phoneNumber', '#errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
		    }
	    });
		
		$(document).on("input", "#phoneNumber", function(e)
		{
			ACC.formvalidation.handlePhoneNumberOnInput('#phoneNumber', '#errorPhoneNumber', '#phoneNumber\\.errors');
	    });

		$(document).on("blur", ".companyphone", function(e)
		{
			var phoneNumber = $(this).val();
			if(phoneNumber != null && phoneNumber != '' && phoneNumber != undefined)
		    {
		        if (!ACC.formvalidation.validatePhoneNumber(phoneNumber))
                {
                    var msg= ACC.config.phoneNumberError ;
                    ACC.formvalidation.addErrorClassForRegForm('.companyphone', '.errorPhoneNumber', '.companyphone\\.errors', msg);
                }
                else
                {
                    ACC.formvalidation.removeErrorClassForRegForm('.companyphone', '.errorPhoneNumber', '.companyphone\\.errors');
                }
		    }
		    else
		    {
            	ACC.formvalidation.addErrorClassForRegForm('.companyphone', '.errorPhoneNumber', '.companyphone\\.errors', ERRORMSG.global.phone);
		    }
	    });
		
		$(document).on("input", ".companyphone", function(e)
		{
			ACC.formvalidation.handlePhoneNumberOnInput('.companyphone', '.errorPhoneNumber', '.companyphone\\.errors');
	    });
		
		$(document).on("input", "#contrYearsInBusiness", function(e)
		{
			match = (/(\d{0,3})[^.]*((?:\.\d{0,2})?)/g).exec(this.value.replace(/[^\d.]/g, ''));
			this.value = match[1] + match[2];
		});
		
		$(document).on("input blur", "#emailaddress", function(e)
		{
			ACC.formvalidation.retainValueformHomeowner();
			if(ACC.formvalidation.validateEmailPattern($("#emailaddress").val()))
		    {
				 ACC.formvalidation.removeErrorClassForRegForm('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
				 //ACC.formvalidation.validateEmailWithBriteVerifyOnBlur('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.global.email, $('#emailaddress').val(), '#siteOneRequestAccountForm');
			}
			else
			{
				 ACC.formvalidation.addErrorClassForRegForm('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
			}
		});
		
		$(document).on("input blur", ".emailaddress", function(e)
		{
			ACC.formvalidation.retainValueformContractor();
			if(ACC.formvalidation.validateEmailPattern($(".emailaddress").val()))
		    {
				 ACC.formvalidation.removeErrorClassForRegForm('.emailaddress', '.errorEmailAddress', '.emailaddress\\.errors', ERRORMSG.invalid.email);
				 //ACC.formvalidation.validateEmailWithBriteVerifyOnBlur('.emailaddress', '.errorEmailAddress', '.emailaddress\\.errors', ERRORMSG.global.email, $('.emailaddress').val(), '#siteOneRequestAccountForm');
			}
			else
			{
				 ACC.formvalidation.addErrorClassForRegForm('.emailaddress', '.errorEmailAddress', '.emailaddress\\.errors', ERRORMSG.invalid.email);
			}
		});
	
		$(document).on("click", ".requestAccountFormSubmit", function(e)
		{
			e.preventDefault();
			loading.start();
			var status = true;
			ACC.formvalidation.noAccountCreationErrorFlag = true;
			ACC.formvalidation.isEmailValidBriteVerifyFlag = true;
			document.getElementById('recaptchaValidator').value = grecaptcha.getResponse();
			ACC.briteverify.reCaptcha(grecaptcha.getResponse());
			var radioValue = $("input[name='hasAccountNumber']:checked").val();
			if(radioValue == 'yes')
			{
				var validField = ACC.formvalidation.validateAccountNumber(e);
				if(validField == false)
				{
					status = false;
				}
			}
			
			var radioValue = $("input[id='typeOfCustomer1']:checked").val();
			if(radioValue == 'Contractor')
			{
				ACC.formvalidation.vaildateFields('#contrYearsInBusiness', '#errorContrYearsInBusiness', '#contrYearsInBusiness\\.errors', strings['js.request.contryearsInBusiness.empty']);
				var msg = strings['js.request.contryearsInBusiness.invalid'];
				if(null != $("#contrYearsInBusiness").val() && $("#contrYearsInBusiness").val() != '')
				{
					if(!ACC.formvalidation.validateYearsInBusiness($("#contrYearsInBusiness").val()))
					{
			    		 status = false;
			    		 ACC.formvalidation.addErrorClassForRegForm('#contrYearsInBusiness', '#errorContrYearsInBusiness', '#contrYearsInBusiness\\.errors', msg);
					}
					else
					{
						ACC.formvalidation.removeErrorClassForRegForm('#contrYearsInBusiness', '#errorContrYearsInBusiness', '#contrYearsInBusiness\\.errors');
					}
				}
				if($("#landscapingIndustry").val() == 'select'){
					status = false;
					ACC.formvalidation.addErrorClassForRegForm('#landscapingIndustry', '#errorlandscapingIndustry', '#landscapingIndustry\\.errors', strings['js.request.landscapingindustry.empty']);
				}
				else{
					ACC.formvalidation.removeErrorClassForRegForm('#landscapingIndustry', '#errorlandscapingIndustry', '#landscapingIndustry\\.errors');
				}
				ACC.formvalidation.vaildateFields('#contrEmpCount', '#errorContrEmpCount', '#contrEmpCount\\.errors', strings['js.request.contrempcount.empty']);
				ACC.formvalidation.vaildateFields('#contrPrimaryBusiness', '#errorContrPrimaryBusiness', '#contrPrimaryBusiness\\.errors', strings['js.request.primarybusiness.empty']);
				ACC.formvalidation.vaildateFields('#companyName', '#errorCompanyName', '#companyName\\.errors', ERRORMSG.global.company);
			}
			
			var ContractorfirstName = validateFirstAndLastName(e,'#firstName','#errorFirstName','#firstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
			var ContractorlastName = validateFirstAndLastName(e,'#lastName','#errorLastName','#lastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);
			var HomeownerfirstName = validateFirstAndLastName(e,'.firstName','.errorFirstName','.firstName\\.errors',ACC.config.enterFirstName,ACC.config.nameErrorMsg, ERRORMSG.global.firstname);
			var HomeownerlastName = validateFirstAndLastName(e,'.lastName','.errorLastName','.lastName\\.errors',ACC.config.enterLastName,ACC.config.nameErrorMsg, ERRORMSG.global.lastname);
			if(radioValue == 'Contractor')
			{
				status = (ContractorfirstName && ContractorlastName);
			}
			else
			{
				status = (HomeownerfirstName && HomeownerlastName);
			}
			ACC.formvalidation.vaildateFields('#addressLine1', '#errorAddressLine1', '#addressLine1\\.errors', ERRORMSG.global.address);
			ACC.formvalidation.vaildateFields('#city', '#errorCity', '#city\\.errors',ERRORMSG.global.city);
			//ACC.formvalidation.validateFieldBasedOnRegex(e,'#city', '#errorCity', '#city\\.errors',ACC.config.cityErrorMsg,ERRORMSG.global.city, 'city');
			ACC.formvalidation.vaildateFields('#state', '#errorState', '#state\\.errors', ERRORMSG.global.state);
			
			if(null != $("#phoneNumber").val() && $("#phoneNumber").val() != '')
			{
				if(!ACC.formvalidation.validatePhoneNumber($("#phoneNumber").val()))
				{
		    		 status = false;
		    		 ACC.formvalidation.addErrorClassForRegForm('#phoneNumber', '#errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
				}
				else
				{
					ACC.formvalidation.removeErrorClassForRegForm('#phoneNumber', '#errorPhoneNumber', '#phoneNumber\\.errors');
				}
			}
			else
			{
				status = false;
				ACC.formvalidation.addErrorClassForRegForm('#phoneNumber', '#errorPhoneNumber', '#phoneNumber\\.errors', ERRORMSG.global.phone);
			}

			if(null != $(".companyphone").val() && $(".companyphone").val() != '')
			{
				if(!ACC.formvalidation.validatePhoneNumber($(".companyphone").val()))
				{
					status = false;
					ACC.formvalidation.addErrorClassForRegForm('.companyphone', '.errorPhoneNumber', '.companyphone\\.errors', ERRORMSG.global.phone);
				}
				else
				{
					ACC.formvalidation.removeErrorClassForRegForm('.companyphone', '.errorPhoneNumber', '.companyphone\\.errors');
				}
			}
			else
			{
				status = false;
				ACC.formvalidation.addErrorClassForRegForm('.companyphone', '.errorPhoneNumber', '.companyphone\\.errors', ERRORMSG.global.phone);
			}
			
			 
			if(ACC.formvalidation.validatezipcode(e, $("#zipcode").val()))
		    {
				 ACC.formvalidation.removeErrorClassForRegForm('#zipcode', '#errorZipcode', '#zipcode\\.errors');
			}
			else
			{
				 status = false;
				 ACC.formvalidation.addErrorClassForRegForm('#zipcode', '#errorZipcode', '#zipcode\\.errors', ACC.config.zipCodeError);
			}
			
			if(radioValue == 'Contractor')
			{
				if(ACC.formvalidation.validateEmailPattern($("#emailaddress").val()))
				{
					ACC.formvalidation.removeErrorClassForRegForm('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
					ACC.formvalidation.validateEmailWithBriteVerifyOnBlur('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.global.email, $('#emailaddress').val(), '#siteOneRequestAccountForm');
				}
				else
				{
					status = false;
					ACC.formvalidation.addErrorClassForRegForm('#emailaddress', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
				}
			}
			else
			{
				if(ACC.formvalidation.validateEmailPattern($(".emailaddress").val()))
				{
					ACC.formvalidation.removeErrorClassForRegForm('.emailaddress', '.errorEmailAddress', '.emailaddress\\.errors', ERRORMSG.invalid.email);
					ACC.formvalidation.validateEmailWithBriteVerifyOnBlur('.emailaddress', '.errorEmailAddress', '.emailaddress\\.errors', ERRORMSG.global.email, $('.emailaddress').val(), '#siteOneRequestAccountForm');
				}
				else
				{
					status = false;
					ACC.formvalidation.addErrorClassForRegForm('.emailaddress', '.errorEmailAddress', '.emailaddress\\.errors', ERRORMSG.invalid.email);
				}
			}
			$('*[id*=error]:visible').each(function() 
			{
				if($(this).html() != '')
				{
					status = false;
				}
			});
			if(!status)	
			{
				ACC.formvalidation.noAccountCreationErrorFlag = false;
				ACC.formvalidation.addGlobalError();
				loading.stop();
			}
		 });
		$(".requestToolTip").attr('title', ACC.config.accountNumberProvided);
	},
	statePrefix: "",
	noAccountCreationErrorFlag: true,
	isEmailValidBriteVerifyFlag: true,
	accountCreationFormSubmit: function(isEmailValid, input, error, errorText, msg, textstatus){
		grecaptcha.reset();
		if(!isEmailValid){	//BriteVerify email respose check
			ACC.briteverify.vaildateEmailFields(input, error, errorText, msg, textstatus);
			//ACC.formvalidation.addErrorClassForRegForm(input, error, errorText, msg);
			ACC.formvalidation.addGlobalError();
			loading.stop();
		}
		else if(ACC.formvalidation.noAccountCreationErrorFlag){
			let stateSelect = $("#siteOneRequestAccountForm #state option:selected");
			let stateVal = stateSelect.val().split("-");
			ACC.formvalidation.statePrefix = (stateVal.length!=1)? stateVal[0] : ACC.formvalidation.statePrefix;
			stateSelect.val(stateVal[stateVal.length-1]); //removing the US from the state to validate for melissa
			if ($("input:radio[id='typeOfCustomer2']").is(":checked")) {
			$("#siteOneRequestAccountForm #landscapingIndustry option:selected").val(false);
			}
			$.ajax({
				url: ACC.config.encodedContextPath + "/request-account/validate-address",
				method: "POST",
				data: $('#siteOneRequestAccountForm').serialize(),
				success: function (addressVerificationData) {
					ACC.address.isAddressChanged = false;
					ACC.address.isAddressVerified = true;
					stateSelect = $("#siteOneRequestAccountForm #state option:selected");
					stateVal = stateSelect.val().split("-");
					if(ACC.formvalidation.statePrefix != "" && stateVal.length == 1){
						stateSelect.val(ACC.formvalidation.statePrefix + "-" + stateVal[0]); //restoring the State value
					}

					if ((addressVerificationData.isAddressValid && !addressVerificationData.isAddressCorrected) || addressVerificationData.status.errorCode == '404') {
						ACC.formvalidation.validateEmailInHybrisResponse();
					}
					else {
						loading.stop();
						$.colorbox({
							html: ACC.formvalidation.createReqPopupContent(addressVerificationData),
							maxWidth: "100%",
							width: "550px",
							maxHeight: "100%",
							overflow: "auto",
							opacity: 0.7,
							title: false,
							className: "invalidOriginalAddress",
							close: '<span class="icon-close"></span>'
						});
					}
				}
			});
		}
	},
	validateEmailInHybrisResponse:function(){
		$.ajax({
		    url : ACC.config.encodedContextPath + "/request-account/isEmailAlreadyExists",
		    method:"POST",
		    data:$('#siteOneRequestAccountForm').serialize(),	
		    success: function(response) {
		        if(response != null && response == true){ // existing email
		            $('.RTA_wrapper, .businessDetails, .retailDetails').hide();
		            $('.business-fill-icon, .branch-icon, .branch-fill-icon, .confirmation-icon, .next_goback_wrapper').addClass('hidden');
        			$('.business-success-icon, .branch-success-icon, .confirmation-fill-icon, .shop_siteone_wrap, .verification-container, .verification-container-step4').removeClass('hidden');
		            ACC.formvalidation.analyticsDataSet(false);
					loading.stop();
		        }
				else {
		            ACC.accountdashboard.homeBranchSelection();
		        }
		    }
		});
	},
	validateEmailWithBriteVerifyOnBlur: function (input, error, errorText, msg, value, formId) {
		var briteverify = document.getElementById('briteVerifyEnable').value;
		var briteverifytimeout = document.getElementById('briteVerifyTimeout').value;
		var msgAjax = msg;
		var responseAjax = "";
		if (briteverify == "true") {
			$.ajax({
				url: ACC.config.encodedContextPath + '/request-account/briteVerifyValidate?email=' + value,
				type: "GET",
				crossDomain: true,
				timeout: briteverifytimeout,
				success: function (response) {
					if (response == "invalid") {
						ACC.formvalidation.isEmailValidBriteVerifyFlag = false;
						msgAjax = ACC.config.emailAddressError1;
						responseAjax = response;
					}
					if(formId == "#siteOneRequestAccountForm"){ //request account
						ACC.formvalidation.accountCreationFormSubmit(ACC.formvalidation.isEmailValidBriteVerifyFlag, input, error, errorText, msgAjax, responseAjax);
					}
					else{ //self serve
						ACC.accountdashboard.selfServeFormSubmit(ACC.formvalidation.isEmailValidBriteVerifyFlag, input, error, errorText, msgAjax, responseAjax);
					}
				},
				error: function (response, textstatus, message) {
					if (textstatus == "timeout" || textstatus == "error") {
						ACC.formvalidation.isEmailValidBriteVerifyFlag = false;
						msgAjax = ACC.config.emailAddressUnable;
						responseAjax = textstatus;
					}
					if(formId == "#siteOneRequestAccountForm"){ //request account
						ACC.formvalidation.accountCreationFormSubmit(ACC.formvalidation.isEmailValidBriteVerifyFlag, input, error, errorText, msgAjax, responseAjax);
					}
					else{ //self serve
						ACC.accountdashboard.selfServeFormSubmit(ACC.formvalidation.isEmailValidBriteVerifyFlag, input, error, errorText, msgAjax, responseAjax);
					}
				}
			});
		}
	},
	createUserValidations : function ()
	{
		$(document).find("#user\\.phonenumber").prop('type', 'tel');
		$(document).find("#user\\.email").prop('type', 'email');
		$(document).on("input focus", "#user\\.phonenumber", function(e)
      	{	
			ACC.formvalidation.handlePhoneNumberOnInput('#user\\.phonenumber', '#errorPhoneNumber', '#user\\.phonenumber\\.errors');
      	});
		
		$(document).on("input blur", "#user\\.title", function()
		{
	        var msg = ERRORMSG.global.title;
	        ACC.formvalidation.vaildateFields('#user\\.title', '#errortitle', '#title\\.errors', msg);
	    });

		$(document).on("input blur", "#user\\.firstName", function(e)
		{
	        var msg = ERRORMSG.global.firstname;
	        ACC.formvalidation.validateFieldBasedOnRegex(e,'#user\\.firstName', '#errorFirstName', '#firstName\\.errors',ACC.config.nameErrorMsg,msg);
	     	 
	    });
				
		$(document).on("input blur", "#user\\.lastName", function(e)
		{
	        var msg = ERRORMSG.global.lastname;
	        ACC.formvalidation.validateFieldBasedOnRegex(e,'#user\\.lastName', '#errorLastName', '#lastName\\.errors',ACC.config.nameErrorMsg,msg);
	    });
	
		$(document).on("input focus", "#user\\.email", function()
		{
						if(ACC.formvalidation.validateEmailPattern($("#user\\.email").val()))
		    {
				 ACC.formvalidation.removeErrorClassForRegForm('#user\\.email', '#errorEmailAddress', '#emailaddress\\.errors');
				 ACC.formvalidation.removeErrorClassForRegForm('#user\\.email', '#email\\.errors', '#emailaddress\\.errors');
			}
			else
			{
				 ACC.formvalidation.addErrorClassForRegForm('#user\\.email', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
			}
	    });
		
		
		$(document).on("input blur", "#user\\.unit\\.title", function()
		{
	        var msg = ACC.config.selectShipTo;
	        ACC.formvalidation.vaildateFields('#user\\.unit\\.title', '#errorparentunit', '#parentunit\\.errors', msg);
	    });
		
		$(document).on("click", ".createUserSubmit", function(e)
		{
			e.preventDefault();
			var status = true;
			
			var validateEmail = true;
			if(window.location.pathname.indexOf("/edit") != -1)
			{
				validateEmail = false;
			}

			ACC.formvalidation.vaildateFields('#user\\.title', '#errortitle', '#title\\.errors', ACC.config.selectTitle);
			ACC.formvalidation.validateFieldBasedOnRegex(e,'#user\\.firstName', '#errorFirstName', '#firstName\\.errors',ACC.config.nameMay,ERRORMSG.global.firstname);
			ACC.formvalidation.validateFieldBasedOnRegex(e,'#user\\.lastName', '#errorLastName', '#lastName\\.errors',ACC.config.nameMay,ERRORMSG.global.lastname);
			
			if(validateEmail)
			{
				if(ACC.formvalidation.validateEmailPattern($("#user\\.email").val()))
			    {
					 ACC.formvalidation.removeErrorClassForRegForm('#user\\.email', '#errorEmailAddress', '#emailaddress\\.errors');
					 ACC.formvalidation.removeErrorClassForRegForm('#user\\.email', '#email\\.errors', '#emailaddress\\.errors');
				}
				else
				{
					 status = false;
					 ACC.formvalidation.addErrorClassForRegForm('#user\\.email', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.invalid.email);
				}
			}
			
			ACC.formvalidation.vaildateFields('#user\\.unit\\.title', '#errorparentunit', '#parentunit\\.errors', ERRORMSG.global.parentunit);
			
	        if (!ACC.formvalidation.validatePhoneNumber($("#user\\.phonenumber").val()))  
	        {
	        	status = false;
	        	ACC.formvalidation.addErrorClassForRegForm('#user\\.phonenumber', '#errorPhoneNumber', '#user\\.phonenumber\\.errors', ERRORMSG.global.phone);
	        }
	        else
	        {
	        	ACC.formvalidation.removeErrorClassForRegForm('#user\\.phonenumber', '#errorPhoneNumber', '#user\\.phonenumber\\.errors');
	        }
	        
	        
			$('*[id*=error]:visible').each(function() 
			{
				/*if($(this).html() != '' &&  $(this).html().toLowerCase().indexOf("An account already exists") == 0)*/
				if($(this).html() != '')
				{
					status = false;
				}
			});
			
			if(status)	
			{
				if($("#placeOrdersApproval").length)
				{ //if not the old scenario
                    ACC.formvalidation.ordersApproval(); // Checking Orders Approval
                }
				if(validateEmail)
				{
					ACC.briteverify.validateEmailWithBriteVerify('#user\\.email', '#errorEmailAddress', '#emailaddress\\.errors', ERRORMSG.global.email, $('#user\\.email').val(), '#siteOneCreateUserForm');
				}
				else
				{
					
					$('#siteOneCreateUserForm').submit();
				}
			}
			else
			{
				ACC.formvalidation.addGlobalError();
			}
		});				
					
	},
	retainValueformContractor: function () {
		$("#firstName").val($(".firstName").val());
		$("#lastName").val($(".lastName").val());
		$("#emailaddress").val($(".emailaddress").val());
		$(".companyphone").val($("#phoneNumber").val());
	},
	retainValueformHomeowner: function () {
		$(".firstName").val($("#firstName").val());
		$(".lastName").val($("#lastName").val());
		$(".emailaddress").val($("#emailaddress").val());
		$("#phoneNumber").val($(".companyphone").val());
	},
	createReqPopupContent: function(addressVerificationData) {
		var popupContent;
		if (!addressVerificationData.isAddressValid) {
			popupContent = "<p class='m-b-15'>" + ACC.config.veryfyAddressError + "</p><button class='btn btn-default btn-block' onclick='ACC.colorbox.close()'>" + ACC.config.editAddress + "</button>";
		}
		else if (addressVerificationData.isAddressCorrected) {
			popupContent = "<form id='addressSuggestionForm' class='row addressSuggestionradio' style='width:450px;'><div class='col-md-6 col-xs-12 no-padding-xs'><label class='colored-radio bold flex-center'><input type='radio' value='originalAddress' name='address.addressSuggestionOption'/><span class='m-t-5'>" + ACC.config.originalAddress + "</span></label><div class='cl'></div><div class='pad-lft-25 marginTop10'><p class='m-b-0'>" + $("#siteOneRequestAccountForm #addressLine1").val() + "</p>";
			if ($("#siteOneRequestAccountForm #addressLine2").val() != "") {
				popupContent += "<p class='m-b-0'>" + $("#siteOneRequestAccountForm #addressLine2").val() + "</p>";
			}
			popupContent += "<p class='m-b-0'>" + $("#siteOneRequestAccountForm #city").val() + "</p><p class='m-b-0'>" + $("#siteOneRequestAccountForm #state option:selected").text() + "</p><p class='m-b-0'>" + $("#siteOneRequestAccountForm #zipcode").val() + "</p></div></div>";
			popupContent += "<div class='col-md-6 col-xs-12 m-t-20-xs no-padding-xs'><label class='colored-radio bold flex-center'><input type='radio' value='suggestedAddress' checked='checked'  name='address.addressSuggestionOption'/><span class='m-t-5'>" + ACC.config.suggestedAddress + "</span></label><div class='cl'></div>";
			popupContent += "<div class='pad-lft-25 marginTop10'><p class='m-b-0'>" + addressVerificationData.street + "</p>";
			popupContent += "<p class='m-b-0'>" + addressVerificationData.street2 + "</p>";
			popupContent += "<p class='m-b-0'>" + addressVerificationData.city + "</p>";
			popupContent += "<p class='m-b-0'>" + addressVerificationData.state + "</p>";
			popupContent += "<p class='m-b-0 hidden'>" + addressVerificationData.county + "</p>";
			popupContent += "<p class='m-b-0'>" + addressVerificationData.zipcode + "</p></div></div>";
			popupContent += "<div class='cl'></div><div class='col-md-offset-2 col-md-4 col-sm-6 col-xs-4 margin-top-20 m-t-10-xs'><div class='btn btn-primary btn-block' onclick='ACC.formvalidation.suggestedValidReqAddressSubmit(\"" + addressVerificationData.street + "\",\"" + addressVerificationData.street2 + "\",\"" + addressVerificationData.city + "\",\"" + addressVerificationData.state + "\",\"" + addressVerificationData.zipcode + "\")'>" + ACC.config.save + "</div></div><div class='col-md-4 col-sm-6 col-xs-4 margin-top-20 m-t-10-xs'><div class='btn btn-default btn-block' onclick='ACC.colorbox.close()'>" + ACC.config.cancel + "</div></div></form>";
		}
		return popupContent;
	},
	suggestedValidReqAddressSubmit: function(line1, line2, city, state, zip) {
		if ($("input[name='address\\.addressSuggestionOption']:checked").val() == "suggestedAddress") {
			$("#siteOneRequestAccountForm #addressLine1").val(line1);
			$("#siteOneRequestAccountForm #addressLine2").val(line2);
			$("#siteOneRequestAccountForm #city").val(city);
			$("#siteOneRequestAccountForm #state").val("US-" + state);
			$("#siteOneRequestAccountForm #zipcode").val(zip);
		}
		ACC.colorbox.close();
		loading.start();
		ACC.formvalidation.validateEmailInHybrisResponse();
	},
	analyticsDataSet: function(isSuccess, from) {
		let uuid = $(".application-uuid").val();
		_AAData.pathingChannel = "company service";
		_AAData.pathingPageName = "company service: online account request confirmation";
		_AAData.eventType = "acct-request-confirmation";
		_AAData.accountType = "Account type requested -Homeowner/Retail or Contractor";
		_AAData.applicationuuid = (isSuccess && $.trim(uuid) != "") ? uuid : "";
		try {
			_satellite.track('acct-create-confirmation');
			_satellite.track('pageload');
	
		} catch (e) { }
		$(window).scrollTop(0);
	},
	placeOrdersApproval: function(){
		if($("#placeOrdersWithApproval").val() == "false"){	//Place Orders
			$("#placeOrders").prop("checked", true);
		}
		else if($("#placeOrdersWithApproval").val() == "true"){	//Place Orders with Approval
			$("#placeOrdersApproval").prop("checked", true);
		}
		else {	//Cannot Place Orders
			$("#placeOrdersCanNot").prop("checked", true);
		}
		 
	},
	ordersApproval: function(){
		if($("#placeOrdersApproval").prop("checked")){	//Order with approval
			$("[id='Place orders']").prop("checked", false);
			$("#placeOrdersWithApproval").val("true");
		}
		else{	//without approval
			$("[id='Place orders']").prop("checked", ($("#placeOrders").prop("checked")?true:false));
			$("#placeOrdersWithApproval").val("false");
		}
		$("#placeOrdersApproval").prop("checked", false);
		$("#placeOrders").prop("checked", false);
		$("#placeOrdersCanNot").prop("checked", false);
	}
};
var captcha_onclick = function(response) {
	if (recaptcha.length == 0)
    {
	 $("#recaptcha-error").removeClass('hidden');
	 $("#recaptcha-border").addClass('recaptcha-error-border');
    }
    else 
    {
      $("#recaptcha-error").addClass('hidden');
      $("#recaptcha-border").removeClass('recaptcha-error-border');
        
    }
};
ACC.monthlyflyer = {
	_autoload: [
		"receiveMessage"
		
	],

	receiveMessage : function() {
		jQuery.receiveMessage(monthlyFlyerRecieveMessageHandler, 'https://www.siteonecatalog.com');
		
 	}
	
}
function monthlyFlyerRecieveMessageHandler(theMessage){	
		console.log("theMessage"+theMessage.data.action);
	    switch (theMessage.data.action)
	    {
	        case 'quickview':
	            // Call to your function to open your quickview window
	            //yourFunctionToOpenYourQuickViewWindow(theMessage.pid, theMessage.bookcode,theMessage.pagelabel));
				var productCode = theMessage.data.pid;

                loading.start();
                ACC.colorbox.open("",{
                    href: ACC.config.encodedContextPath + "/p/" + productCode + "/quickView",
                    maxWidth:"100%",
                    width:"621px",
                    overflow:"hidden",
                    initialWidth :"380px",
                    onComplete:function(){
                        loading.stop();
                    }
                });

				break;
	        default:
	            alert('Unexpected Message:' + theMessage.data.action);
	            break;
	    }
	}
ACC.sharelistemail = {

	_autoload: [
	    "bindShareListEmail"
	],
	
	bindShareListEmail: function()
    {	
    	$(document).on("click", "#sharelistemail, #shareassemblyemail", function()
		{
    		dataValueArray = [];
			if($(this).attr("id")==="sharelistemail"){
				ACC.sharelistemail.shareEmailListPopup();
			}
			else{
				ACC.sharelistemail.shareListPopup();
			}
    		
    		if ($('.page-detailsSavedListPage').length > 0){
				        _AAData.popupPageName= ACC.config.emaillistpathingPageName;
				        _AAData.popupChannel= ACC.config.myaccountpathingChannel;
			 	try {
				    	 _satellite.track('popupView');
		        } catch (e) {} 
    		}
    		if ($('.page-detailsAssemblyPage').length > 0){
    			_AAData.popupPageName= ACC.config.emailassemblypathingPageName;
    			_AAData.popupChannel= ACC.config.myaccountpathingChannel;
			 	try {
				    	 _satellite.track('popupView');
		        } catch (e) {} 
    		}
		});
    
    	$(document).on("click", ".share-list-email-box #listEmailSubmit, .share-list-email-box #assemblyEmailSubmit", function()
		{
    		$(".share-list-email-box #emailError").html("");
    		if($(".share-list-email-box #users").val() == "" || $(".share-list-email-box #users").val() == null)
    		{
    			status = false;
    			$("#emailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.emailAddressError+"</div></font></div>");
    		}
    		else
    		{
	    			
    			digitalData.eventData={
   					 shareMedium:"Email",
   					}
	   			 try {
	   					_satellite.track("emailList");
   				}catch(e){}	
   				
    	    ACC.briteverify.checkToEmails(($(".share-list-email-box #users").val()).toString());
    		
    		}
		});
		
    	$(document).on("click", "#shareListEmailSubmit",function(e){
			digitalData.eventData={
				shareMedium:"Email",
			   }
			try {
				   _satellite.track("emailList");
		   }catch(e){}	
		   
			ACC.briteverify.checkToEmails($("#listEmailIdCart").val());

		});

		$(document).on("input", "#listEmailIdCart",function(e){
			if($(this).val() !=""){
				var emailArray=$(this).val().split(',').filter(function(entry) { return entry.trim() != ''; });				
				$(".no-of-emails").text(emailArray.length);
				if(emailArray.length>10){
					$("#emailError").html("<div class='bg-danger'><font color='red'><div class='panel-body'>"+ACC.config.maxEmail+"</div></font></div>");
					$(this).addClass("border-red");
					$("#shareListEmailSubmit").attr("disabled","disabled");
				}
				else{
					$("#emailError").html("");
					$(this).removeClass("border-red");
					$("#shareListEmailSubmit").removeAttr("disabled");

				}
				
			}
			else{
				$(".no-of-emails").text(ACC.config.listMinEmails);
			}
		})
		
    },
    
    
    listEmail: function(emails,savedlistcode)
	{	
		var isListPrice=$(".js-share-retail-price-btn").is(':checked')?true:false;
		var isYourPrice=$(".js-share-your-price-btn").is(':checked')?true:false;
		loading.start();
    	$.ajax({
         	type: "GET",
         	url: ACC.config.encodedContextPath + "/shareListEmail/" +savedlistcode,
         	cache: false,
         	data : {
				 	"email": emails,
					"rprice":isListPrice,
					"cprice":isYourPrice
					},
         	dataType: "json",
         	success: function (response) 
         	
         	{	
         	    $('#colorbox').removeClass('share-list-email-box share-list-email-popup');
         		ACC.global.successPopup();
            }
             
			}).always(function() {
				loading.stop();
			});
	},
	shareEmailListPopup: function(){
		var greenTickIcon="<span class='flex-center'><svg xmlns='http://www.w3.org/2000/svg' width='25' height='25' viewBox='0 0 34 34'><defs><style>.share-email-g,.share-email-circle2{fill:none;}.share-email-g{stroke-width:4px;}.share-email-circle1{stroke:none;}</style></defs>  <g transform='translate(-851 -522)'>       <path class='email-list-path' fill='#e0e0e0' d='M5.349,76.863.231,71.633a.817.817,0,0,1,0-1.138l1.114-1.138a.776.776,0,0,1,1.114,0L5.906,72.88l7.385-7.546a.776.776,0,0,1,1.114,0l1.114,1.138a.817.817,0,0,1,0,1.138L6.463,76.863a.776.776,0,0,1-1.114,0Z' transform='translate(860 467.902)'></path>       <g class='share-email-g' stroke='#e0e0e0' transform='translate(851 522)'>          <circle class='share-email-circle1' cx='17' cy='17' r='17'></circle>          <circle class='share-email-circle2' cx='17' cy='17' r='15.5'></circle>       </g>    </g> </svg>     </span>"
		        		ACC.colorbox.open("", {
		                html : ["<div class='PopupBox'>",
		                        "<div class='share-cart-email-description'>"+ACC.config.shareListToTell+"</div>",
		                        "<div class='margin20'>     <p class='bold marginBottom10 font-size-14'>"+ACC.config.include+"</p>"+     "<div class='flex justify-between flex-dir-column-xs'>         <div class='bold flex-center margin-bot-10-xs share-cart-price-buttons'>"+"<input id='list-email-retail-checkbox-btn' class='list-email-checkbox share-cart-retail-price js-share-retail-price-btn' type='checkbox'>	<label class='bold flex-center email-price-label' for='list-email-retail-checkbox-btn' type='checkbox'>"+greenTickIcon+"<span class='pad-lft-10'>"+ACC.config.retailPrice+"</span></label></div>         <div class='bold flex-center share-cart-price-buttons'>"+"<input id='list-email-csp-checkbox-btn' class='list-email-checkbox share-cart-your-price js-share-your-price-btn' type='checkbox'>	<label class='bold flex-center email-price-label' for='list-email-csp-checkbox-btn' type='checkbox'>"+greenTickIcon+"<span class='pad-lft-10'>"+ACC.config.emailyourPrice+"<span></label></div>     </div> </div>",
								"<label for='listEmailIdCart' class='flex marginBottom10 justify-between' style='color:inherit; font-size:14px;'>"+"<span class='bold'>"+ACC.config.sendTo+"</span>"+"<span class='italic-text'>"+"<span class='no-of-emails bold'>"+ACC.config.listMinEmails+"</span>&nbsp;"+ACC.config.of+"&nbsp;<span class='bold'>"+ACC.config.listMaxEmails+"</span>&nbsp;"+ACC.config.emails+"</span>"+"</label>",
								"<textarea class='col-md-12 col-sm-12 col-xs-12 form-control marginBottom20 textarea' type='textarea' id='listEmailIdCart' rows='4' cols='10' placeholder='"+ACC.config.enterEmail+"'></textarea>",
		                        "<div class='cl'></div><div id = 'emailError'></div>",
		                        "<input id='shareListEmailSubmit' class='btn share-email-submit btn-primary btn-center margin20' type='button' value='"+ACC.config.contactUsEmail+"'>",
		                    "</div>"].join(''),
		                    width:"600px",
							height:"auto",
							title: ACC.config.shareByEmail,
							
								onComplete: function() {
									$("#cboxTitle").addClass("share-email-list-title");
									$('#colorbox').addClass('share-list-email-popup');
								},
								onClosed: function() {
									$('body').css("overflow-y","auto");
									$('#colorbox').removeClass('share-list-email-popup');
								}
						});

	},
	shareListPopup: function()
	{ 
		ACC.colorbox.open("", {
        html : ["<form:form  commandName='siteoneShareSavedListForm' id='siteoneEmailSavedListForm'>",
    			"<form:hidden path='code' id='code' value="+$("#savedListCode").val()+"/>",
        		"<div class='PopupBox'>",
                "<h1 class='headline2'>"+ACC.config.shareByEmail+"</h1>",
                "<div class='margin20 share-list-email-description'>"+ACC.config.shareCartTell+"</div>",
                "<div id = 'emailError'></div>",
                "<label for='emailIdList'><h5>"+ACC.config.emailTo+"</h5></label>",
                "<div class='textBox'>",
       		 	"<div class='cl'></div>",
                "<input class='inputTextBox form-control' type='text' onkeydown='return (event.keyCode!=13);' required='required'/>",
                "<ul id='listEmailValues'></ul>",
                "<input id='listEmailSubmit' class='btn btn-primary btn-center margin20 emailListDetailBtn' type='button' value='"+ACC.config.contactUsEmail+"'>",
                "<form:hidden path='users' id='users' value=''/>",
                "</div>",
            "</div>"].join(''),
            width:"600px",
            height:"auto",
            title: "",
            	onComplete: function() {
            		$('#colorbox').addClass('share-list-email-box');
            	},
            	onClosed: function() {
            		$('body').css("overflow-y","auto");
            	    $('#colorbox').removeClass('share-list-email-box');
            	}
		});
	},
	
	assemblyEmail: function(emails,assemblycode)
	{
		loading.start();
		$.ajax({
	     	type: "GET",
	     	url: ACC.config.encodedContextPath + "/shareAssemblyEmail/" +assemblycode,
	     	cache: false,
	     	data : {"email": emails},
	     	dataType: "json",
	     	success: function (response) 
	        {
                $('#colorbox').removeClass('share-list-email-box');
	     		ACC.global.successPopup();
	        }
	         
			}).always(function(){
				loading.stop();
			});
	},

	
	
};

$('#sharelistemail , #shareassemblyemail').click(function() {
	$('body').css("overflow-y", "hidden");	
});

$(document).on('keyup','.share-list-email-box .inputTextBox',function(){
	var users = $(".share-list-email-box .inputTextBox").val();
	
	if ($(".share-list-email-box .inputTextBox").val().length >= 2){
		$(".share-list-email-box #listEmailValues").addClass('listValuesActive');
	
	 console.log()
	 $.ajax({
	        url : ACC.config.encodedContextPath + "/savedList/getShareListUsers?searchType=Email&searchTerm="+users,
	        method : "GET",
	        success :function(response)
	        {
       		$(".share-list-email-box #listEmailValues").empty();
       		$(".share-list-email-box .listValuesActive").css("cssText", "display: inline !important;");
       		 if(response.length!=0){
       			  	$.each(response,function(index,repo){
	        		console.log(repo);
	        		$(".share-list-email-box #listEmailValues").append(`<li data-id='${repo.text}' data-value='${repo.value}'class='fstResultItem'>${repo.value}</li>`);
		        });
       		 }
	                
       		 else{
       				$(".share-list-email-box #listEmailValues").append(`<li> No results </li>`);
       			 }
	        	
	       }
	 });
	}
});

var dataValueArray = [];
$(document).on("click", ".share-list-email-box #listEmailValues li",function(e){
    let dataValue = $(this).attr("data-value");
    if(dataValue!=undefined && dataValue!="") {
	if(jQuery.inArray(dataValue, dataValueArray) == -1) {
		dataValueArray.push(dataValue);
		console.log(dataValueArray)
	  $(".share-list-email-box #users").val(dataValueArray);
		var dataValueFiltered = dataValue.replace('.', "").replace('@', "");
		$(".share-list-email-box .textBox").prepend(`<div class="selecteduserList fstChoiceItem" id="${dataValueFiltered}">${dataValue}</div>`);
		$(".share-list-email-box .selecteduserList").addClass("removeuser");
		$('.share-list-email-box #fstResultItem').fadeOut();
		var x= document.getElementById(dataValueFiltered);
		$(x).click(function(){
			 $(this).closest(".share-list-email-box .selecteduserList").remove();
			 dataValueArray.splice($.inArray(dataValue, dataValueArray), 1);
			 $(".share-list-email-box #users").val(dataValueArray);
		});
		
		 $('.share-list-email-box #listEmailValues li:contains('+dataValue+')').remove();
		 $(".share-list-email-box .inputTextBox").click(function(){
			$('.share-list-email-box #listEmailValues li').remove();
			$(".share-list-email-box .inputTextBox").val('');
		});

		var select = $(".share-list-email-box #listEmailValues li").val();
	    if(select>=0){
	    	$(".share-list-email-box .listValuesActive").css("cssText", "display: inline !important;");
	    }else{
	    	$(".share-list-email-box .listValuesActive").css("cssText", "display: none !important;");
	    }
	}
    }
});  




ACC.invoicepage = {

	_autoload: [
	    "getInvoiceCSV",
	    "getinvoicedaterange",
	    "bindShipToInvoiceOverlay",
	    "getOrderPagination",
	    "bindShipToOrderOverlay",
	    "getUserPagination",
	    "bindShipToPopupValue",
	    "getEwalletPagination"
	    ],

		bindShipToPopupValue:function(){
			$(document).on('click','#cboxWrapper #sortOptions1',function(){
				var sortType1 = $("#cboxWrapper #sortOptions1").val();
			  sessionStorage.setItem('selectedDropdownValueSession',sortType1);
			});
		},
		
		
		getInvoiceCSV:function(){
		if($("body").hasClass("page-invoicelistingpage")){
				$.cookie("accountPageId", "invoicespage", { path: '/' });
				sessionStorage.setItem("activeTab", "invoicesTab");
		}	
		if(sessionStorage.getItem("selectedInvoiceSession")){
		 $( ".ship-TosInvoice-Selected").val(sessionStorage.getItem("selectedInvoiceSession"));
		}
		sessionStorage.removeItem('selectedInvoiceSession');
		var currentTab = sessionStorage.getItem("activeTab");
		if (currentTab) $(".orders-tabs-container").find("[data-active='" + currentTab + "']").addClass("active-account-tab").removeClass("tab-font-color");
		sessionStorage.removeItem("activeTab");
		
		var searchParam = $("#search-invoice").val();
		var dateFrom= $("#dateFrom").val();
		var dateTo= $("#dateTo").val();
		var invoiceShiptos = $("#shipToSelected_inv").val();
		var viewpagination =$("#pageSizeInvoice1").val();
		
		
		$.each($(".invoice-pagination .pagination li a"), function(i, aTag){
			$(aTag).prop('href',$(aTag).prop('href')+"&invoiceShiptos="+invoiceShiptos+"&searchParam="+searchParam+"&dateFrom="+dateFrom+"&dateTo="+dateTo+"&pagesize="+viewpagination);
		});
		//$(".invoice-pagination .pagination li a").prop('href',$(".invoice-pagination .pagination li a").prop('href')+"&invoiceShiptos="+invoiceShiptos+"&searchParam="+searchParam+"&dateFrom="+dateFrom+"&dateTo="+dateTo+"&pagesize="+viewpagination);
		
		
		$(document).on("click", ".downloadCSV", function()
				{
					var unitId=$(this).data('unitid');
					var totalResults=$(this).data('total-results');
					var searchParam="";var dateFrom="";var dateTo="";var sort="";var invoiceShiptos=""; var invoiceShipTo="";
			        var href= ACC.config.encodedContextPath + "/my-account/invoicesCSV/"+unitId;
			        var createcsv= $(this).attr("id");
			        
			        searchParam = ACC.invoicepage.getParamForInvoiceCSV('searchParam');
			        dateFrom=ACC.invoicepage.getParamForInvoiceCSV('dateFrom');
			        dateTo=ACC.invoicepage.getParamForInvoiceCSV('dateTo');
			        sort=ACC.invoicepage.getParamForInvoiceCSV('sort');
			        invoiceShiptos=ACC.invoicepage.getParamForInvoiceCSV('invoiceShiptos');
			        if(invoiceShiptos)
			        	{
			         invoiceShipTo = invoiceShiptos.replace(/\+/g," ");
			        	}
			        if(searchParam===undefined && dateFrom===undefined && dateTo===undefined && sort===undefined){
			        	href=href+'?sort=byDate'+'&totalresults='+totalResults+'&createcsv='+createcsv;
			        }
			        else{
				        if(sort===undefined){
				        	sort="byDate";
				        }
			        href=href+'?invoiceShiptos='+ invoiceShipTo +'&searchParam='+searchParam+'&dateFrom='+dateFrom+'&dateTo='+dateTo+'&sort='+sort+'&totalresults='+totalResults+'&createcsv='+createcsv;
			        }
			        $(this).attr('href',href);
			        
			    });
	},
	getEwalletPagination:function(){
		if(sessionStorage.getItem("selectedewalletSession")){
			 $( ".ship-ToseWallet-Selected").val(sessionStorage.getItem("selectedewalletSession"));
			}
			
			
		
		
		var searchParam = $("#ewallet-page-card").val();
			var viewpagination =$("#pageSizeeWallet1").val();
			var shiptounit = $("#shipToSelected_eWallet").val();
		
			 
			$.each($(".ewallet-pagination .pagination li a"), function(i, aTag){
				$(aTag).prop('href',$(aTag).prop('href')+"&shiptounit="+shiptounit+"&searchParam="+searchParam+"&pagesize="+viewpagination);
			});
		
	},
	getOrderPagination:function(){
		if(sessionStorage.getItem("selectedOrderSession")){
			 $( ".ship-TosOrder-Selected").val(sessionStorage.getItem("selectedOrderSession"));
			}
			
					var searchParam = $("#searchOrderHistory").val();
		var dateSort= $("#dateSort").val();
		var accountShiptos = $("#shipToSelected_order").val();
		var viewpagination =$("#pageSizeOrder1").val();
		var paymentType=$("#paymentType").val();
			
			$.each($(".order-pagination .pagination li a"), function(i, aTag){
				$(aTag).prop('href',$(aTag).prop('href')+"&accountShiptos="+accountShiptos+"&searchParam="+searchParam+"&paymentType="+paymentType+"&dateSort="+dateSort+"&pagesize="+viewpagination);
			});
	
	},
	getUserPagination:function(){
	if(sessionStorage.getItem("selecteduserSession")){
		 $( ".ship-TosUser-Selected").val(sessionStorage.getItem("selecteduserSession"));
		}
		
		
	var searchParam = $("#manager-user-voice").val();
	var viewpagination =$("#pageSizeManagerUser1").val();
	var shiptounit = $("#shipToSelected_user").val();
	var adminCheck = $('#admin_User').val();
	
	if(document.getElementById('admin_User').checked) {
		 $('#admin_User').prop('checked', true);
		$.each($(".user-pagination .pagination li a"), function(i, aTag){
			$(aTag).prop('href',$(aTag).prop('href')+"&shiptounit="+shiptounit+"&searchParam="+searchParam+"&pagesize="+viewpagination+'&filterAdmin=true');
		});
	}else{
   	 $('#admin_User').prop('checked', false);
   	$.each($(".user-pagination .pagination li a"), function(i, aTag){
		$(aTag).prop('href',$(aTag).prop('href')+"&shiptounit="+shiptounit+"&searchParam="+searchParam+"&pagesize="+viewpagination+'&filterAdmin=false');
	});
	}
},
	getParamForInvoiceCSV: function getUrlParameter(sParam) {
	    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
	        sURLVariables = sPageURL.split('&'),
	        sParameterName,
	        i;
	
	    for (i = 0; i < sURLVariables.length; i++) {
	        sParameterName = sURLVariables[i].split('=');
	
	        if (sParameterName[0] === sParam) {
	            return sParameterName[1] === undefined ? true : sParameterName[1];
	        }
	    }
	  },
	  
	  
	  getinvoicedaterange:function(){
		  
			$(document).on("click", ".blue-text", function()
					{
						var datarange=$(this).attr("title");
				        var href= ACC.config.encodedContextPath + '/my-account/invoices/'+($("#unitUid").val()).trim();
				        
				        href=href+'?datarange='+datarange;
				        $(".blue-text").attr('href',href);
				        
				    });
		},
		invoiceSortBy: function (sort) {
			if (sessionStorage.getItem("sInvoice") == "desc" && sessionStorage.getItem("sInvoiceField") == sort) {
				sessionStorage.setItem("sInvoice", "asc");
				sessionStorage.removeItem("sInvoiceField");
				$('#invoicesearchForm').find("input#sort-direction").val("asc");
			}
			else {
				sessionStorage.setItem("sInvoice", "desc");
				sessionStorage.setItem("sInvoiceField", sort);
				$('#invoicesearchForm').find("input#sort-direction").val("desc");
			}
			var sortDirection = $("#sort-direction").val();
			$('#invoicesearchForm').find("input#sortinvoice").val(sort);
			$('#invoicesearchForm').find("input#sort-direction").val(sortDirection);
			$('#invoicesearchForm').submit();
			$('$search-invoice').text($('$search-invoice-id').val());
		},
		invoiceSortFilterApply: function () {
			let checkedVal = $("[name='filter-sort']:checked").val();
			ACC.invoicepage.invoiceSortBy(checkedVal);
			ACC.myquotes.filterPopup('hide', 500, '.invoice-filter-popup');
		},
	  bindShipToInvoiceOverlay: function() { 
		  
			$(document).on('click','#cboxContent #ShipToInvoice_popup', function(){ 
				 
				 var unitId= $(this).siblings("#ship-toId").val()+"_US"; 
				 var name= $(this).parents(".shipTo-border").children(".zeropadding").eq(1).find("a").text();
				if($(".invoice-shiptopopup").length > 0){
					if ($(".ship-TosInvoice option").eq(0).val() == (unitId)
							|| $(".ship-TosInvoice option").eq(1)
									.val() == (unitId)
							|| $(".ship-TosInvoice option").eq(2)
									.val() == (unitId)
							|| $(".ship-TosInvoice option").eq(3)
									.val() == (unitId)
						    || $(".ship-TosInvoice option").eq(4)
					                .val() == (unitId)
							) {
							}else{
								$(".ship-TosInvoice option").eq(3).val(unitId).text(name);
							}
					 		$(".ship-TosInvoice").val(unitId);
					 		ACC.colorbox.close();
					 		
					 		
					 		return false;
						}
	               
			});
			
			
			$('.ship-TosInvoice').on('click',function(){
				if($(".ship-TosInvoice").val() == "shipToopenPopupNew"){
					$(this).val('');
				}
			});
			
			$(document).on('change', 'body.page-invoicelistingpage .ship-TosInvoice', function () {	
			 
				var selectedInvoice = $(this).val();
				
					sessionStorage.setItem('selectedInvoiceSession',selectedInvoice);
					// previous = $(this).val();	
		    //}).on('change',function(e){
				
		    	var dateFromPopup =$("#dateFrom").data('datefrom');
                var dateToPopup =$("#dateTo").data('dateto');
               
					var currentSelect = $(".ship-TosInvoice");
					var data = {
							dateFromPopup:dateFromPopup,
							dateToPopup:dateToPopup
						}
					
					var $form = $("#sortForm1");
					if (!ACC.paginationsort.downUpPressed)
					{
						var searchParam = $("#search-invoice").val();
						var dateFrom= $("#dateFrom").val();
						var dateTo= $("#dateTo").val();
						var viewpagination =$("#pageSizeInvoice1").val();
						var invoiceShiptos = $("#shipToSelected_inv").val();
						var searchParam = $("#search-ship-to").val();
						$form.find("input#search-shipto").val(searchParam);
						$form.find("input#shipToSelected_inv").val(invoiceShiptos);
					$form.find("input#search-invoicenew").val(searchParam);
					$form.find("input#dateFromnew").val(dateFrom);
					$form.find("input#dateTonew").val(dateTo);
					$form.find("input#ViewPaginationInvoice").val(viewpagination);
					$form.find("input#invoiceShiptos").val(invoiceShiptos);
					//if($(".ship-TosInvoice").val() != "shipToopenPopupNew"){
						
					//}												
					}
					
					
					if("shipToopenPopupNew" != $(".ship-TosInvoice").val()){
						if (!ACC.paginationsort.downUpPressed){
							$form.submit();
						}
						ACC.paginationsort.downUpPressed = false;
					}else if($(".ship-TosInvoice").val() == "shipToopenPopupNew"){
						removeShipToSortbySessionValue();
						var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-invoice/'+($("#unitUid").val()).trim()+'?searchParam=';	
						 $.ajax({
					            url: shipToPopupURL,
					            data:data,
					            method: "GET",		
					            success: function(searchPageData) {
					                ACC.colorbox.open('Search or Select a Ship-To', {
					                    html: searchPageData,
					                    width: '800px',
					                    className:"shipto-popup-mb invoice-shiptopopup",
					                    overlayClose: false,
					                    onComplete: function(e) {
					                    	sessionStorage.removeItem('selectedInvoiceSession');
					                    	$(".ship-TosInvoice").val('shipToopenPopupNew');
					        				
					        				checkShipToPopUpInvoice();
					        				$(document).on('click keyup', '#search-ship-to-popup-invoice', function(){
					                    		checkShipToPopUpInvoice();
					                    	});
					                    },
					                    onClosed: function() {
					                    	sessionStorage.setItem('selectedInvoiceSession',"All");
				        					location.reload(true);
				                    		window.location.href= ACC.config.encodedContextPath + '/my-account/invoices/'+($("#unitUid").val()).trim()+'?invoiceShiptos=All&viewtype=All&searchParam=&dateFrom='+ ($("#dateFrom").val()).trim()+'&dateTo='+($("#dateTo").val()).trim()+'&pagesize=25&sort=byDate';
				        				
					                    }
					                });
					            }
					        });
					}
		    });
			
			$(document).on('change', 'body.page-invoicelistingpage .sortSelect.js-page-sort', function () {	
					
					var $form = $("#sortForm1");
					if (!ACC.paginationsort.downUpPressed)
					{
						var searchParam = $("#search-invoice").val();
						var dateFrom= $("#dateFrom").val();
						var dateTo= $("#dateTo").val();
						var viewpagination =$("#pageSizeInvoice1").val();
						var invoiceShiptos = $("#shipToSelected_inv").val();
						var searchParam = $("#search-ship-to").val();
						$form.find("input#search-shipto").val(searchParam);
						$form.find("input#shipToSelected_inv").val(invoiceShiptos);
					$form.find("input#search-invoicenew").val(searchParam);
					$form.find("input#dateFromnew").val(dateFrom);
					$form.find("input#dateTonew").val(dateTo);
					$form.find("input#ViewPaginationInvoice").val(viewpagination);
					$form.find("input#invoiceShiptos").val(invoiceShiptos);
					$form.submit();											
					}
					
						ACC.paginationsort.downUpPressed = false;
			});
			
			/*$(document).on('click','.responsive-table-cell a',function(){				
				sessionStorage.removeItem('selectedInvoiceSession');
			});*/
			
			
					
					$(document).on("click", "#cboxWrapper .account-orderhistory-pagination-invoice a",function(e){
						 var dateFromPopup =$("#dateFrom").data('datefrom');
                         var dateToPopup =$("#dateTo").data('dateto');
						var page='';
						previous = $(this).value;
									e.preventDefault();	
									if($(this).attr('rel') == "prev"){
										page = $(this).parents("ul").find("li.active").text().split("(")[0]-2
										}
										else if($(this).attr('rel') == "next"){
										    page = $(this).parents("ul").find("li.active").text().split("(")[0]
										}
										else{
										page= $(this).text().trim()-1;
										}
									var data = {
											searchParam : ($("#search-ship-to-popup-invoice-new").val()).trim(),
											viewtype : 'All',
											page : page,
											dateFromPopup:dateFromPopup,
											dateToPopup:dateToPopup,
											sort : $("#sortShipToInvoice").val()
										}
									var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-invoice/'+($("#unitUid").val()).trim();
									var currentSelect = $(".ship-TosInvoice");
									var poupClass = $("#cboxOverlay").prop("class");
										$.ajax({
											url : shipToPopupURL,
											method : "GET",
											data : data,
											success : function(searchPageData) {
												ACC.colorbox.open('Search or Select a Ship-To', {
													html : searchPageData,
													width : '800px',
													className : poupClass,
													overlayClose : false,
													onComplete:function(){
														$(".ship-TosInvoice").val('shipToopenPopupNew');
								        				
								        				retrieveShipToSortbySessionValue();
								        				checkShipToPopUpInvoice();
													},
													onClosed: function() {
														
														sessionStorage.setItem('selectedInvoiceSession',"All");
							        					location.reload(true);
							                    		window.location.href= ACC.config.encodedContextPath + '/my-account/invoices/'+($("#unitUid").val()).trim()+'?invoiceShiptos=All&viewtype=All&searchParam=&dateFrom='+ ($("#dateFrom").val()).trim()+'&dateTo='+($("#dateTo").val()).trim()+'&pagesize=25&sort=byDate';
							        				
								                    }
												});
											}
										});
									
							});
					
				 
				$(document).on("blur", "#cboxWrapper #search-ship-to-popup-invoice",function(e) {
					 removeShipToSortbySessionValue();
					 var dateFromPopup =$("#dateFrom").data('datefrom');
                     var dateToPopup =$("#dateTo").data('dateto');
						 	var key = e.which;
						 	 previous = $(this).value;
						    
									var data = {
											searchParam : ($("#search-ship-to-popup-invoice").val()).trim(),
											dateFromPopup:dateFromPopup,
											dateToPopup:dateToPopup	
										}
									var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-invoice/'+($("#unitUid").val()).trim();
									var currentSelect = $(".ship-TosInvoice");
									var poupClass = $("#cboxOverlay").prop("class");
										$.ajax({
											url : shipToPopupURL,
											method : "GET",
											data : data,
											success : function(searchPageData) {
												ACC.colorbox.open('Search or Select a Ship-To', {
													html : searchPageData,
													width : '800px',
													className : poupClass,
													overlayClose : false,
													onComplete:function(){
													 	$(".ship-TosInvoice").val('shipToopenPopupNew');
								        				
								        				checkShipToPopUpInvoice();
								                    
													},
													onClosed: function() {
														
														sessionStorage.setItem('selectedInvoiceSession',"All");
							        					location.reload(true);
							                    		window.location.href= ACC.config.encodedContextPath + '/my-account/invoices/'+($("#unitUid").val()).trim()+'?invoiceShiptos=All&viewtype=All&searchParam=&dateFrom='+ ($("#dateFrom").val()).trim()+'&dateTo='+($("#dateTo").val()).trim()+'&pagesize=25&sort=byDate';
							        				
								                    }
												});
											}
										});
									
							});	
					
					
					
					
					
					
							$(document).on("change", "#cboxWrapper .shipToInvoicePagePopup #sortOptions1", function(e) {
								var sortItem = $("#cboxWrapper #sortOptions1").val();
                                var dateFromPopup =$("#dateFrom").data('datefrom');
                                var dateToPopup =$("#dateTo").data('dateto');
								var data = {
									searchParam : ($("#search-ship-to-popup-invoice-new").val()).trim(),
									viewtype : 'All',
									sort : sortItem,
									dateFromPopup:dateFromPopup,
									dateToPopup:dateToPopup
								}
								var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-invoice/'+($("#unitUid").val()).trim();
								var poupClass = $("#cboxOverlay").prop("class");
								var currentSelect = $(".ship-TosInvoice");
								$.ajax({
									url : shipToPopupURL,
									method : "GET",
									data : data,
									success : function(searchPageData) {
										ACC.colorbox.open('Search or Select a Ship-To', {
											html : searchPageData,
											width : '800px',
											className : $("#cboxOverlay").prop("class"),
											overlayClose : false,
											onComplete:function(){
											 	$(".ship-TosInvoice").val('shipToopenPopupNew');
						        				
						        				retrieveShipToSortbySessionValue();
						        				checkShipToPopUpInvoice();
						                    
											},
											onClosed: function() {
												sessionStorage.setItem('selectedInvoiceSession',"All");
					        					location.reload(true);
					                    		window.location.href= ACC.config.encodedContextPath + '/my-account/invoices/'+($("#unitUid").val()).trim()+'?invoiceShiptos=All&viewtype=All&searchParam=&dateFrom='+($("#dateFrom").val()).trim()+'&dateTo='+($("#dateTo").val()).trim()+'&pagesize=25&sort=byDate';
					        				
						                    }
										});
									}
								});

							});
			
			 
		 		
		},
		
		bindShipToOrderOverlay:function(){
			
			$(document).on('click','#cboxContent #ShipToOrder_popup', function(){ 
				 
				 var unitId= $(this).siblings("#ship-toId").val()+"_US"; 
				 var name= $(this).parents(".shipTo-border").children(".zeropadding").eq(1).find("a").text();
				if($(".invoice-shiptopopup").length > 0){
					if ($(".ship-TosOrder option").eq(0).val() == (unitId)
							|| $(".ship-TosOrder option").eq(1)
									.val() == (unitId)
							|| $(".ship-TosOrder option").eq(2)
									.val() == (unitId)
							|| $(".ship-TosOrder option").eq(3)
									.val() == (unitId)
						    || $(".ship-TosOrder option").eq(4)
					                .val() == (unitId)
							) {
							}else{
								$(".ship-TosOrder option").eq(3).val(unitId).text(name);
							}
					 		$(".ship-TosOrder").val(unitId);
					 		ACC.colorbox.close();
					 		
					 		
					 		return false;
						}
	               
			});
			
			
			$('.ship-TosOrder').on('click',function(){
				if($(".ship-TosOrder").val() == "shipToopenPopupNew"){
					$(this).val('');
				}
			});
			
			$(document).on('change', 'body.page-accountOrdersPage .ship-TosOrder', function () {	
			 
				var selectedOrder = $(this).val();
				
					sessionStorage.setItem('selectedOrderSession',selectedOrder);
					 //previous = $(this).val();	
		    //}).on('change',function(e){
				
					var dateSort= $("#dateSort").val();
					var paymentType=$("#paymentTypeOrder").val();
              
					var currentSelect = $(".ship-TosOrder");
					var data = {
							dateSort:dateSort,
							paymentType:paymentType
						}
					
					var $form = $("#sortForm1");
					if (!ACC.paginationsort.downUpPressed)
					{
						var searchParam = $("#searchOrderHistory").val();
						var dateSort= $("#dateSort").val();
						var viewpagination =$("#pageSizeOrder1").val();
						var accountShiptos = $("#shipToSelected_order").val();
						var searchParam = $("#search-ship-to").val();
						var paymentType= $("#paymentTypeOrder").val();
						$form.find("input#search-shipto").val(searchParam);
						$form.find("input#shipToSelected_order").val(accountShiptos);
					$form.find("input#search-ordernew").val(searchParam);
					$form.find("input#dateSortOrder").val(dateSort);
					$form.find("input#ViewPaginationOrder").val(viewpagination);
					$form.find("input#accountShiptos").val(accountShiptos);
					$form.find("input#paymentTypeOrder").val(paymentType);
					
					//if($(".ship-TosInvoice").val() != "shipToopenPopupNew"){
						
					//}												
					}
					
					
					if("shipToopenPopupNew" != $(".ship-TosOrder").val()){
						if (!ACC.paginationsort.downUpPressed){
							$form.submit();
						}
						ACC.paginationsort.downUpPressed = false;
					}else if($(".ship-TosOrder").val() == "shipToopenPopupNew"){
						let searchVal = ($("#search-ship-to-popup-order").length)?($("#search-ship-to-popup-order").val()).trim():"";
						var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-orders/'+($("#unitUid").val()).trim()+'?searchParam='+searchVal;	
						removeShipToSortbySessionValue();
						$.ajax({
					            url: shipToPopupURL,
					            data:data,
					            method: "GET",		
					            success: function(searchPageData) {
					                ACC.colorbox.open('Search or Select a Ship-To', {
					                    html: searchPageData,
					                    width: '800px',
					                    className:"shipto-popup-mb invoice-shiptopopup",
					                    overlayClose: false,
					                    onComplete: function(e) {
					                    	sessionStorage.removeItem('selectedOrderSession');
					                    	$(".ship-TosOrder").val('shipToopenPopupNew');
					        				
					        				checkShipToPopUpOrder();
					        				$(document).on('click keyup', '#search-ship-to-popup-order', function(){
					                    		checkShipToPopUpOrder();
					                    	});
					                    },
					                    onClosed: function() {
					                    	sessionStorage.setItem('selectedOrderSession','All');
				        					location.reload(true);
				        					window.location.href= ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateSort='+($("#dateSort").val()).trim()+'&paymentType=ALL&pagesize=25&sort=byDate';
				        				
					                    }
					                });
					            }
					        });
					}
		    });
			
			$(document).on('change', 'body.page-accountOrdersPage .sortSelect.js-page-sort', function () {	
					
					var $form = $("#sortForm1");
					if (!ACC.paginationsort.downUpPressed)
					{
						var searchParam = $("#searchOrderHistory").val();
						var dateSort= $("#dateSort").val();
						var viewpagination =$("#pageSizeOrder1").val();
						var accountShiptos = $("#shipToSelected_order").val();
						var searchParam = $("#search-ship-to").val();
						$form.find("input#search-shipto").val(searchParam);
						$form.find("input#shipToSelected_order").val(accountShiptos);
					$form.find("input#search-ordernew").val(searchParam);
					$form.find("input#dateSortOrder").val(dateSort);
					$form.find("input#ViewPaginationOrder").val(viewpagination);
					$form.find("input#accountShiptos").val(accountShiptos);
					$form.submit();											
					}
					
						ACC.paginationsort.downUpPressed = false;
			});
			
			/*$(document).on('click','.responsive-table-cell a',function(){				
				sessionStorage.removeItem('selectedInvoiceSession');
			});*/
			
			
					
					$(document).on("click", "#cboxWrapper .account-orderhistory-pagination-order a",function(e){
						var dateSortPopup= $("#dateSort").val();
						var page='';
						previous = $(this).value;
									e.preventDefault();	
									if($(this).attr('rel') == "prev"){
										page = $(this).parents("ul").find("li.active").text().split("(")[0]-2
										}
										else if($(this).attr('rel') == "next"){
										    page = $(this).parents("ul").find("li.active").text().split("(")[0]
										}
										else{
										page= $(this).text().trim()-1;
										}
									var data = {
											searchParam : ($("#search-ship-to-popup-order-new").val()).trim(),
											viewtype : 'All',
											page : page,
											dateSortPopup:dateSortPopup,
											sort : ($("#sortOptions1").length)?$("#sortOptions1").val() : $("#sortShipToOrder").val()
										}
									var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-orders/'+($("#unitUid").val()).trim() + '?paymentType=ALL';
									var currentSelect = $(".ship-TosOrder");
									var poupClass = $("#cboxOverlay").prop("class");
										$.ajax({
											url : shipToPopupURL,
											method : "GET",
											data : data,
											success : function(searchPageData) {
												ACC.colorbox.open('Search or Select a Ship-To', {
													html : searchPageData,
													width : '800px',
													className : poupClass,
													overlayClose : false,
													onComplete:function(){
														$(".ship-TosOrder").val('shipToopenPopupNew');
								        				
								        				retrieveShipToSortbySessionValue();
								        				checkShipToPopUpOrder();
													},
													onClosed: function() {
														sessionStorage.setItem('selectedOrderSession','All');
							        					location.reload(true);
							        					window.location.href= ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateSort='+($("#dateSort").val()).trim()+'&paymentType=ALL&pagesize=25&sort=byDate';
							        				
								                    }
												});
											}
										});
									
							});
					
				 
				$(document).on("blur", "#cboxWrapper #search-ship-to-popup-order",function(e) {
					 var dateSortPopup =$("#dateSort").data('datesort');
						 	var key = e.which;
						 	 previous = $(this).value;
						    
									var data = {
											searchParam : ($("#search-ship-to-popup-order").val()).trim(),
											dateSortPopup:dateSortPopup	
										}
									var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-orders/'+($("#unitUid").val()).trim() + '?paymentType=ALL';
									var currentSelect = $(".ship-TosOrder");
									removeShipToSortbySessionValue();
									var poupClass = $("#cboxOverlay").prop("class");
										$.ajax({
											url : shipToPopupURL,
											method : "GET",
											data : data,
											success : function(searchPageData) {
												ACC.colorbox.open('Search or Select a Ship-To', {
													html : searchPageData,
													width : '800px',
													className : poupClass,
													overlayClose : false,
													onComplete:function(){
													 	$(".ship-TosOrder").val('shipToopenPopupNew');
								        												        				
								        				checkShipToPopUpOrder();
								                    
													},
													onClosed: function() {
														
														sessionStorage.setItem('selectedOrderSession','All');
							        					location.reload(true);
							        					window.location.href= ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateSort='+($("#dateSort").val()).trim()+'&paymentType=ALL&pagesize=25&sort=byDate';
							        				
								                    }
												});
											}
										});
									
							});	
					
					
					
					
					
					
							$(document).on("change", "#cboxWrapper .shipToOrderPagePopup #sortOptions1", function(e) {
								var sortItem = $("#cboxWrapper #sortOptions1").val();
                               var dateSortPopup =$("#dateSort").data('datesort');
								var data = {
									searchParam : ($("#search-ship-to-popup-order").val()).trim(),
									viewtype : 'All',
									sort : sortItem,
									dateSortPopup:dateSortPopup
								}
								var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-orders/'+($("#unitUid").val()).trim() + '?paymentType=ALL';
								var poupClass = $("#cboxOverlay").prop("class");
								var currentSelect = $(".ship-TosOrder");
								$.ajax({
									url : shipToPopupURL,
									method : "GET",
									data : data,
									success : function(searchPageData) {
										ACC.colorbox.open('Search or Select a Ship-To', {
											html : searchPageData,
											width : '800px',
											className : $("#cboxOverlay").prop("class"),
											overlayClose : false,
											onComplete:function(){
											 	$(".ship-TosOrder").val('shipToopenPopupNew');
						        				
						        				retrieveShipToSortbySessionValue();
						        				checkShipToPopUpOrder();
						                    
											},
											onClosed: function() {
												sessionStorage.setItem('selectedOrderSession','All');
					        					location.reload(true);
					        					//window.location.href= ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateSort='+($("#dateSort").val()).trim()+'&paymentType=ALL&pagesize=25&sort=byDate';
					        				
												
						                    }
										});
									}
								});

							});
		
		},
		
		invmoreShipTos: function(){

			var data = {
							dateFromPopup:$("#dateFrom").val(),
							dateToPopup:$("#dateTo").val()
						}
					let searchVal = ($("#search-ship-to-popup-order").length)?($("#search-ship-to-popup-order").val()).trim():"";
						var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-invoice/'+($("#unitUid").val()).trim()+'?searchParam='+searchVal;	
						removeShipToSortbySessionValue();
						var wShiptoPopup = '800px';
						var shipToPopupTitle = 'Search or Select a Ship-To';
						if(ACC.global.wWidth < 500){
							wShiptoPopup = '95%';
							shipToPopupTitle = 'Ship-to';
						}
						$.ajax({
					            url: shipToPopupURL,
					            data:data,
					            method: "GET",		
					            success: function(searchPageData) {
					                ACC.colorbox.open(shipToPopupTitle, {
					                    html: searchPageData,
					                    width: wShiptoPopup,
					                    className:"shipto-popup-order-mb invoice-shiptopopup",
					                    overlayClose: false,
					                    onComplete: function(e) {
					                    	//sessionStorage.removeItem('selectedOrderSession');
					                    	$(".ship-TosOrder").val('shipToopenPopupNew');

					        				checkShipToPopUpOrder();
					        				$(document).on('click keyup', '#search-ship-to-popup-order', function(){
					                    		checkShipToPopUpOrder();
					                    	});
					                    },
					                    onClosed: function() {
					                    	//sessionStorage.setItem('selectedOrderSession','All');
				        					location.reload(true);
				        					//window.location.href= ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateSort='+($("#dateSort").val()).trim()+'&paymentType=ALL&pagesize=25&sort=byDate';

					                    }
					                });
					            }
					        });	

		},
		invshipToAppBtn: function() {
			var currentSelect = $("input[name='shipToAc-m']:checked").val();
			if (ACC.global.wWidth > 1023) {
				currentSelect = $("input[name='shipToAc']:checked").val();
			}
			if(!currentSelect || currentSelect =="" || currentSelect == "All"){
				let unitId =  $("#sessionShipToId").length && $("#sessionShipToId").val() != "" ? $("#sessionShipToId").val() : $("#parentUnitId").length ? $("#parentUnitId").val() : "";
				unitId = !unitId || unitId == "" ? $("#unitId").val() : unitId;
				window.location.href = ACC.config.encodedContextPath + "/my-account/invoices/" + $.trim(unitId);
			}
			else{
				var $form = $("#invoicesearchForm");
				var searchParam = $("#search-invoice").val();
				var dateFrom = $("#dateFrom").val();
				var dateTo = $("#dateTo").val();
				var viewpagination = $("#pageSizeInvoice1").val();
				var searchParam = $("#search-ship-to").val();
				$form.find("input#search-shipto").val(searchParam);
				$form.find("input#search-invoicenew").val(searchParam);
				$form.find("input#dateFromnew").val(dateFrom);
				$form.find("input#dateTonew").val(dateTo);
				$form.find("input#ViewPaginationInvoice").val(viewpagination);
				$form.find("input#invShipTo").val(currentSelect);
				$form.submit();
			}
		},

		invShipToPopUpOnblur: function(){
			if(ACC.global.wWidth > 1023){
			ACC.invoicepage.invShipToNewPopUpAjax();
			}
		},

		invmoreShipToSearch: function(){
			ACC.invoicepage.invShipToNewPopUpAjax(true);
		},

		invmoreShipToClear: function(){
			$("input[name='sortByRadio']").prop('checked', false);
			$("#search-ship-to-popup-invoice-new").val('');
		},

		invshipToURLRadio: function(){
			var redURL = $("input[name='shiptoURL']:checked").val();
			window.location.href = redURL;
		},

		invShipToNewPopUpAjax: function(shortBy=false){

		var sortParam;

		if(shortBy == true){
			sortParam = $("input[name='sortByRadio']:checked").val();
			sessionStorage.setItem('selectedRadioValueSession',sortParam);
		}
		var wShiptoPopup = '800px';
		var shipToPopupTitle = 'Search or Select a Ship-To';
		if(ACC.global.wWidth < 500){
			wShiptoPopup = '95%';
			shipToPopupTitle = 'Ship-to';
		}

		var data = {
							searchParam : ($("#search-ship-to-popup-invoice-new").val()).trim(),
							dateFromPopup:$("#dateFrom").val(),
							dateToPopup:$("#dateTo").val(),
							sort:sortParam
						}
		let searchVal = ($("#search-ship-to-popup-order").length)?($("#search-ship-to-popup-order").val()).trim():"";
		var shipToPopupURL = ACC.config.encodedContextPath + '/my-account/all-ship-to-popup-invoice/'+($("#unitUid").val()).trim()+ '?paymentType=ALL';
		var poupClass = $("#cboxOverlay").prop("class");
		$.ajax({
			url : shipToPopupURL,
			method : "GET",
			data : data,
			success : function(searchPageData) {
			ACC.colorbox.open(shipToPopupTitle, {
			html : searchPageData,
			width : wShiptoPopup,
			className : poupClass,
			overlayClose : false,
			onComplete:function(){
				$(".ship-TosOrder").val('shipToopenPopupNew');
				checkShipToPopUpOrder();
				var getShortByRadio = sessionStorage.getItem("selectedRadioValueSession");
				if(getShortByRadio){
					$("input[name='sortByRadio'][value='"+getShortByRadio+"']").prop('checked', true);
					sessionStorage.removeItem("selectedRadioValueSession");
				}

			},
			onClosed: function() {

					sessionStorage.setItem('selectedOrderSession','All');
					location.reload(true);
					//window.location.href= ACC.config.encodedContextPath + '/my-account/orders/'+($("#unitUid").val()).trim()+'?accountShiptos=All&viewtype=All&searchParam=&dateSort='+($("#dateSort").val()).trim()+'&paymentType=ALL&pagesize=25&sort=byDate';

				}
			});
			}
			});
	}
	  
	  
};

function checkShipToPopUpInvoice(){
	var searchShipToPopupInvoiceVal = $('#search-ship-to-popup-invoice').val();
	disableShipToSearch(searchShipToPopupInvoiceVal);
}

function checkShipToPopUpOrder(){
	var searchShipToPopupOrderVal = $('#search-ship-to-popup-order').val();
	disableShipToSearch(searchShipToPopupOrderVal);
}

function disableShipToSearch(searchShipToVal){
	if (typeof searchShipToVal !== 'undefined') {
		if (searchShipToVal.size == 0 || searchShipToVal == '') {
			$('button[id="shipToSearchBoxButton"]').attr('disabled', 'disabled');
		}
		else {
			$('button[id="shipToSearchBoxButton"]').removeAttr("disabled");
		}
	}
}

function retrieveShipToSortbySessionValue() {
	if(sessionStorage.getItem("selectedDropdownValueSession")){
		$("#cboxWrapper .sortSelectSpan").val(sessionStorage.getItem("selectedDropdownValueSession"));
	}
}

function removeShipToSortbySessionValue() {
	sessionStorage.removeItem("selectedDropdownValueSession");
}

$( document ).ready(function() {
	var dataCount=$("#filterCount").val();

	if(null == dataCount || dataCount <= 0){
		$(".invoice-filter select").prop("disabled", true);
		$(".pageSizeDropDown  select").prop("disabled", true);
		$(".bia-sort-filters-container  select").prop("disabled", true);
		$(".ewallet_changes  select").prop("disabled", true);
		$("#shipToSelected_inv").prop("disabled", false);
		$("#shipToSelected_user").prop("disabled", false);
		$(".ship-TosOrder").prop("disabled", false); 
		$(".bia-show-filter").prop("disabled", false);
		$(".ship-ToseWallet").prop("disabled", false);
	}
});
ACC.calculator = {
    _autoload: [
		"removeView",
        "updateView"
	],

    removeView: function() {
       if( $('.materialsCalculators').is(":Visible") != true)
       {
            $('.materialsCalculators').remove();
       }
       if( $('.mobile-materialCal-wrapper').is(":Visible") != true)
       {
            $('.mobile-materialCal-wrapper').remove();
       }
    },
    flagStoneCalculator: function() {  
    if($(".flagStoneCalculate").hasClass("disabled") == false){
        var LengthMultiplier = 1;
        var WidthMultiplier = 1;
        var ThicknessValue = 1;
        if( $('.materialsCalculators').is(":Visible") == true)
        {    
            if ($('#lengthUnitDropdown').val() == '1'){
                LengthMultiplier = 12;
            }
            if ($('#widthUnitDropdown').val() == '1'){
                 WidthMultiplier = 12;
            }
            ThicknessValue = $('#select-option').val();
        } 
        else{
            if ($('.lengthUnitDropdown').val() == 'feet'){
                LengthMultiplier = 12;
            }
            if ($('.widthUnitDropdown').val() == 'feet'){
                 WidthMultiplier = 12;
            }
            ThicknessValue = $('.depthUnitDropdown').val();
        }
        
        const length = $('.length').val() * LengthMultiplier;
        const width = $('.width').val() * WidthMultiplier;
        const thickness = ThicknessValue;
     
        //  Calculate square feet
        const sqInches = length * width;
        var divisorMin;
        var  divisorMax;
    
        if (thickness == 1){
            divisorMin = 120;
            divisorMax = 120;
        }
        else{
            divisorMin = 70;
            divisorMax = 70;
        }
        const sqFeet = sqInches * (1/144);
        const flagstoneRange = [(sqFeet/divisorMax).toFixed(1), (sqFeet/divisorMin).toFixed(1)];
        const cuInches = length * width * thickness;
        const squareFeet = document.getElementsByClassName('squareFeet')[0];
        const estimatedTons = document.getElementsByClassName('estimatedTons')[0];
        digitalData.eventData = {
        	"linkName": "Calculate",
        	"linktype": "",
        	"onClickPageName": "content: project calculators: Flag Stone Calculator Page"
        }
        try {
        	_satellite.track('linkClicks');
        } catch (e) { }
        _AAData.projectCalculator = {};
        if(flagstoneRange[0]===flagstoneRange[1]){
            squareFeet.innerText = sqFeet.toFixed(1);
            estimatedTons.innerText = flagstoneRange[0];
            _AAData.projectCalculator.calculatorMeasurements = 'sq.ft: ' + sqFeet.toFixed(1) + ' | tons: ' + flagstoneRange[0];
        }
        else{
            squareFeet.innerText = sqFeet.toFixed(1);
            estimatedTons.innerText = flagstoneRange[0] + " - " + flagstoneRange[1];
            _AAData.projectCalculator.calculatorMeasurements = 'sq.ft: ' + sqFeet.toFixed(1) + ' | tons: ' + flagstoneRange[0] + ' - ' + flagstoneRange[1];
        }
    }
    },
     CalculateFlagstone: function () {
  

  const pageName = $(".pagename").val() || "";

  const thickness = parseFloat($('#thickness').val()) || 1;
  const length = ACC.calculator.cleanFormattedNumber($('#length').val());
  const width = ACC.calculator.cleanFormattedNumber($('#width').val());

    const lengthUnit = $('#length')
      .closest('#projectCalcInput')
      .find('.toggle-unit.active')
      .data('unit')
      
    
    const widthUnit = $('#width')
      .closest('#projectCalcInput')
      .find('.toggle-unit.active')
      .data('unit')
      
      
    const lengthInFeet = lengthUnit === 'inches' ? length /12 : length
    const widthInFeet = widthUnit === 'inches' ? width /12 : width

    const areaSqFt = lengthInFeet * widthInFeet
    const areaSqIn = areaSqFt * 144
    const areaSqYd = areaSqFt / 9

    const areaUnit = $('.areaDropdownBtn').val() || 'sqft'
    const volumeUnit = $('.volumeDropdownBtn').val() || 'cbft'
    const weightUnit = $('.weightDropdownBtn').val() || 'pnds'  

    const format = ACC.calculator.formatNumber
    let thicknessFt,volumeCubicFeet,volumeCuFt,volumeCuYd,volumeCuIn,tons,lbs;
    if (pageName === 'Stone Walls Calculator Page') {
        thicknessFt=(thickness==3)?(8/12):parseFloat(thickness)
     volumeCubicFeet = areaSqFt * thicknessFt;
     volumeCuFt=parseFloat(volumeCubicFeet.toFixed(2))
      volumeCuYd = volumeCuFt / 27;
      volumeCuIn = volumeCuFt * 1728;

     lbs = volumeCuYd * 2700;  
     tons = lbs / 2000;
   }else{
    volumeCuFt = areaSqFt * (thickness / 12);
    volumeCuYd = volumeCuFt / 27;
    volumeCuIn = areaSqIn * thickness;

	lbs = volumeCuYd * 3564;  
	tons = lbs / 2000;
   
   }

    const areaMap = {
      sqft: format(areaSqFt),
      sqin: format(areaSqIn),
      sqyd: format(areaSqYd)
    }
    const volumeMap = {
      cbft: format(volumeCuFt),
      cbyd: format(volumeCuYd),
      cbin:format(volumeCuIn)
    }
    const weightMap = {
      pnds: format(lbs),
      tns: format(tons)
    }

    $('#areaDropdown #value').css('font-size', '40px').html(areaMap[areaUnit] || '0')
    $('#volumeDropdown #value').css('font-size', '40px').html(volumeMap[volumeUnit] || '0')
    $('#weightDropdown #value').css('font-size', '40px').html(weightMap[weightUnit] || '0')
  },
  
 cleanFormattedNumber : function (num) {
  if (!num) return 0;

  if (typeof num === "string") {
    num = num.replace(/,/g, "").trim();
  }

  const parsed = parseFloat(num);
  return isNaN(parsed) ? 0 : parsed;
},

 formatNumber : function(num) {
  const parsed = parseFloat(num);

  if (parsed === 0) return '0';

 
  if (parsed >= 0.001 && parsed <= 9999999) {
    return parsed % 1 ===0 ? parsed.toLocaleString()
    : parsed.toLocaleString(undefined, {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  }

 
  return parsed.toExponential(2)
    .replace('e+', ' x 10<sup>')
    .replace('e-', ' x 10<sup>-') + '</sup>';
},
    stoneWallsCalculator: function () {
        if ($(".stoneWallCalculate").hasClass("disabled") == false) {
            var thickness = $('#select-option').val();
            var height = $('#height').val();
            var heightUnit = $('#heightUnit').val();
            var width = $('#width').val();
            var widthUnit = $('#widthUnit').val();

            var heightInFeet = ACC.calculator.convertToFeet(height, heightUnit);
            var widthInFeet = ACC.calculator.convertToFeet(width, widthUnit);

            var area = heightInFeet * widthInFeet;
            var weightMapping = {
                1: 160,
                2: 175,
                3: 135
            };
            var stoneWeightPerCubicFoot = weightMapping[thickness] || 0;
            var totalWeightTons = (area * stoneWeightPerCubicFoot) / 2000;
            if($('#materialsCalculators').length) {
                ACC.calculator.adjustFontSizeAndText(area.toFixed(2), 'squareFeet');
                ACC.calculator.adjustFontSizeAndText(totalWeightTons.toFixed(2), 'weightInTons');
            } else {
                document.getElementsByClassName('squareFeet')[0].innerText = area.toFixed(2);
                document.getElementsByClassName('weightInTons')[0].innerText = totalWeightTons.toFixed(2);
            }
            digitalData.eventData = {
                "linkName": "Calculate",
                "linktype": "",
                "onClickPageName": "content: project calculators: Stone Walls Calculator Page"
              }
              try {
                _satellite.track('linkClicks');
              } catch (e) { }
            _AAData.projectCalculator = {};
            _AAData.projectCalculator.calculatorMeasurements = 'sq.ft: ' + area.toFixed(2) + ' | tons: ' + totalWeightTons.toFixed(2);
        }
    },
    convertToFeet: function(value, unit) {
        switch(unit) {
            case 'inches':
                return value / 12;
            case 'feet':
                return value;
            case 'yards':
                return value * 3;
            default:
                return 0;
        }
    },
    roadbaseFillCalculator: function () {
        if ($(".roadBasefillCalculate").hasClass("disabled") == false) {
            var LengthMultiplier = 1;
            var WidthMultiplier = 1;
            var DepthMultiplier = 1;
            if ($('.materialsCalculators').is(":Visible") == true) {
                if ($('#lengthUnitDropdown').val() == '1') {
                    LengthMultiplier = 12;
                }
                if ($('#widthUnitDropdown').val() == '1') {
                    WidthMultiplier = 12;
                }
                if ($('#depthUnitDropdown').val() == '1') {
                    DepthMultiplier = 12;
                }
            } else {
                if ($('.lengthUnitDropdown').val() == 'feet') {
                    LengthMultiplier = 12;
                }
                if ($('.widthUnitDropdown').val() == 'feet') {
                    WidthMultiplier = 12;
                }
                if ($('.depthUnitDropdown').val() == 'feet') {
                    DepthMultiplier = 12;
                }
            }
            const length = $('.length').val() * LengthMultiplier;
            const width = $('.width').val() * WidthMultiplier;
            const thickness = $('.depth').val() * DepthMultiplier;

            const cuInches = length * width * thickness;
            const cuFeet = (length / 12) * (width / 12) * (thickness / 12);
            const sqFeet = (length / 12) * (width / 12);
            const cuYards = cuFeet * (1 / 27);
            const lbsOfFill = cuYards * 2565.415;
            const lbsOfFillMax = lbsOfFill * 1.4;
            const tonsOfFill = (lbsOfFill / 2000).toFixed(1);
            const tonsOfFillMax = (tonsOfFill * 1.06).toFixed(1);
            const estimatedTons = (tonsOfFill === tonsOfFillMax) ? tonsOfFill : tonsOfFill + ' - ' + tonsOfFillMax;
            if($('#materialsCalculators').length) {
                ACC.calculator.adjustFontSizeAndText(sqFeet.toFixed(2), 'squareFeet');
                ACC.calculator.adjustFontSizeAndText(estimatedTons, 'estimatedTons');
            } else {
                document.getElementsByClassName('squareFeet')[0].innerText = sqFeet.toFixed(2);
                document.getElementsByClassName('estimatedTons')[0].innerText = estimatedTons;
            }
            digitalData.eventData = {
                "linkName": "Calculate",
                "linktype": "",
                "onClickPageName": "content: project calculators: Road Basefill Calculator Page"
              }
              try {
                _satellite.track('linkClicks');
              } catch (e) { }
            _AAData.projectCalculator = {};
            _AAData.projectCalculator.calculatorMeasurements = 'sq.ft: ' + sqFeet.toFixed(2) + ' | tons: ' + estimatedTons;
        }
    },
    decorativeRockCalculator: function () {
        if ($(".decorativeRockCalculate").hasClass("disabled") == false) {
            var LengthMultiplier = 1;
            var WidthMultiplier = 1;
            var DepthMultiplier = 1;
            if ($('.materialsCalculators').is(":Visible") == true) {
                if ($('#lengthUnitDropdown').val() == '1') {
                    LengthMultiplier = 12;
                }
                if ($('#widthUnitDropdown').val() == '1') {
                    WidthMultiplier = 12;
                }
                if ($('#depthUnitDropdown').val() == '1') {
                    DepthMultiplier = 12;
                }
            } else {
                if ($('.lengthUnitDropdown').val() == 'feet') {
                    LengthMultiplier = 12;
                }
                if ($('.widthUnitDropdown').val() == 'feet') {
                    WidthMultiplier = 12;
                }
                if ($('.depthUnitDropdown').val() == 'feet') {
                    DepthMultiplier = 12;
                }
            }

            const length = $('.length').val() * LengthMultiplier;
            const width = $('.width').val() * WidthMultiplier;
            const thickness = $('.depth').val() * DepthMultiplier;

            const cuFeet = (length / 12) * (width / 12) * (thickness / 12);
            const sqFeet = (length / 12) * (width / 12);
            const tonnage = (cuFeet / 21.6).toFixed(1);
            const estimatedTons = (tonnage * 1.15).toFixed(1) + ' - ' + (tonnage * 1.25).toFixed(1);
            if($('#materialsCalculators').length) {
                ACC.calculator.adjustFontSizeAndText(sqFeet.toFixed(2), 'squareFeet');
                ACC.calculator.adjustFontSizeAndText(estimatedTons, 'estimatedTons');
            } else {
                document.getElementsByClassName('squareFeet')[0].innerText = sqFeet.toFixed(2);
                document.getElementsByClassName('estimatedTons')[0].innerText = estimatedTons;
            }
            digitalData.eventData = {
                "linkName": "Calculate",
                "linktype": "",
                "onClickPageName": "content: project calculators: Decorative Rock Calculator Page"
            }
            try {
            	_satellite.track('linkClicks');
          	} catch (e) { }
            _AAData.projectCalculator = {};
            _AAData.projectCalculator.calculatorMeasurements = 'sq.ft: ' + sqFeet.toFixed(2) + ' | tons: ' + estimatedTons;
        }
    },
    topSoilCalculator: function() {  
        if($(".topSoilCalculate").hasClass("disabled") == false){
            var LengthMultiplier = 1;
            var WidthMultiplier = 1;
            var DepthMultiplier = 1;
            if( $('.materialsCalculators').is(":Visible") == true)
            { 
            if ($('#lengthUnitDropdown').val() == '1'){
                LengthMultiplier = 12;
            }
            if ($('#widthUnitDropdown').val() == '1'){
                 WidthMultiplier = 12;
            }
            if ($('#depthUnitDropdown').val() == '1'){
                DepthMultiplier = 12;
            }
        }else{
            if ($('.lengthUnitDropdown').val() == 'feet'){
                LengthMultiplier = 12;
            }
            if ($('.widthUnitDropdown').val() == 'feet'){
                 WidthMultiplier = 12;
            }
            if ($('.depthUnitDropdown').val() == 'feet'){
                DepthMultiplier = 12;
            }
        }
            
        const length = $('.length').val() * LengthMultiplier;
        const width = $('.width').val() * WidthMultiplier;
        const thickness = $('.depth').val() * DepthMultiplier;
        //  Calculate square feet
        const cuInches = length * width * thickness;
        const cuFeet = (length/12) * (width/12) * (thickness/12);
        const cuYards =  (cuFeet * (1/27)).toFixed(1);

        const squareFeet = document.getElementsByClassName('squareFeet')[0];
        const estimatedTons = document.getElementsByClassName('estimatedTons')[0];

        var topsoilMultiplier = $('#select-option').val();
        if( $('#mob-flagstone-option').is(":Visible") == true){
           topsoilMultiplier = $('#mob-flagstone-option').val();
        }
		_AAData.projectCalculator = {};
        if(topsoilMultiplier > -1){
            const materialWeight = cuYards * topsoilMultiplier;
            if(materialWeight > 2000){
                const tonnage = (materialWeight/2000).toFixed(1);
                squareFeet.innerText = cuYards;
                estimatedTons.innerText = tonnage;
                _AAData.projectCalculator.calculatorMeasurements = 'cu.ft: ' + cuYards + ' | tons: ' + tonnage;
            }
            else{
                squareFeet.innerText = cuYards;
                estimatedTons.innerText = materialWeight;
                _AAData.projectCalculator.calculatorMeasurements = 'cu.ft: ' + cuYards + ' | tons: ' + materialWeight;
            }
        }
        else{
            squareFeet.innerText = cuYards;
            estimatedTons.innerText = 0.0;
            _AAData.projectCalculator.calculatorMeasurements = 'cu.ft: ' + cuYards + ' | tons: 0.0';
        }
        digitalData.eventData = {
                "linkName": "Calculate",
                "linktype": "",
                "onClickPageName": "content: project calculators: Top Soil Calculator Page"
      	}
      	try {
        	_satellite.track('linkClicks');
      	} catch (e) { }
        }
        },
        barkMulchBedCalculator: function () {
            if ($(".barkMulchBedCalculate").hasClass("disabled") == false) {
                var LengthMultiplier = 1;
                var WidthMultiplier = 1;
                var DepthMultiplier = 1;
                if ($('.materialsCalculators').is(":Visible") == true) {
                    if ($('#lengthUnitDropdown').val() == '1') {
                        LengthMultiplier = 12;
                    }
                    if ($('#widthUnitDropdown').val() == '1') {
                        WidthMultiplier = 12;
                    }
                    if ($('#depthUnitDropdown').val() == '1') {
                        DepthMultiplier = 12;
                    }
                } else {
                    if ($('.lengthUnitDropdown').val() == 'feet') {
                        LengthMultiplier = 12;
                    }
                    if ($('.widthUnitDropdown').val() == 'feet') {
                        WidthMultiplier = 12;
                    }
                    if ($('.depthUnitDropdown').val() == 'feet') {
                        DepthMultiplier = 12;
                    }
                }
                const length = $('.length').val() * LengthMultiplier;
                const width = $('.width').val() * WidthMultiplier;
                const thickness = $('.depth').val() * DepthMultiplier;
    
                const cuInches = length * width * thickness;
                const cuFeet = (length / 12) * (width / 12) * (thickness / 12);
                const cuYards = ((cuFeet * (1 / 27)) * 1.1).toFixed(1);
                document.getElementsByClassName('cubicYards')[0].innerText = cuYards;
                var mulchMultiplier = $('#select-option').val();
                if ($('#mob-barkmulch-option').is(":Visible") == true) {
                    mulchMultiplier = $('#mob-barkmulch-option').val();
                }
                _AAData.projectCalculator = {};
                if(mulchMultiplier > -1) {
                    const materialWeight = cuYards * mulchMultiplier;
                    const estimatedTons = document.getElementsByClassName('estimatedTons')[0];
                    if (materialWeight > 2000) {
                        const tonnage = (materialWeight / 2000).toFixed(1);
                        estimatedTons.innerText = tonnage;
                        _AAData.projectCalculator.calculatorMeasurements = 'cu.yd: ' + cuYards + ' | tons: ' + tonnage;
                    } else {
                        estimatedTons.innerText = materialWeight.toFixed(1);
                        _AAData.projectCalculator.calculatorMeasurements = 'cu.yd: ' + cuYards + ' | tons: ' + materialWeight.toFixed(1);
                    }
                }
                digitalData.eventData = {
	                "linkName": "Calculate",
	                "linktype": "",
	                "onClickPageName": "content: project calculators: Bark Mulch Calculator Page"
	            }
	            try {
	            	_satellite.track('linkClicks');
	            } catch (e) { }
            }
        },
    validateAndCalculate: function(input) {
        const $input = $(input);
        let value = $input.val();
        value = value.replace(/\s+[^\s]+$/, '');
        const regex = /^\d{0,4}(\.\d{0,2})?$/;
        if(!regex.test(value)) {
            value = value.substring(0, value.length - 1);
        }
        $input.val(value);
    },
    restrictInput: function(event) {
        const allowedKeys = ['Backspace', 'Tab', 'ArrowLeft', 'ArrowRight', 'Delete', 'Enter', '.'];
        if(allowedKeys.includes(event.key) || /[0-9]/.test(event.key)) {
            return true;
        }
        event.preventDefault();
        return false;
    },
    handleSuffix: function(input, add) {
        const $input = $(input);
        const suffix = $input.data('suffix');
        let value = $input.val().trim();
        if(add) {
            if(value && !value.endsWith(' ' + suffix)) {
                $input.val(value + ' ' + suffix);
            }
        } else {
            if(value.endsWith(' ' + suffix)) {
                $input.val(value.slice(0, -suffix.length - 1).trim());
            }
        }
    },
    calculateVoltageAtLastFixture: function(resistance, runLength, totalVA, voltageTap) {
        const loadCurrent = totalVA / voltageTap;
        const voltageDrop = (2 * loadCurrent * resistance * runLength / 1000);
        return voltageTap - voltageDrop;
    },
    barChart: null,
    selectedAWG: "6 AWG",
    isDesktopView: true,
    voltageDropCalculator: function () {
        var resistanceValue = $("#guage").val();
        var selGuageValue = $("#guage").text() || "6 AWG";
        if($(".mobile-materialCal-wrapper").is(":visible")) {
            selGuageValue = $("#guage option:selected").text();
            ACC.calculator.isDesktopView = false;
        }
        var voltageTap = $("#voltageTap").val();
        var lengthValue = $("#lengthValue").val().replace(/\s+[^\s]+$/, '');
        var totalVA = $("#totalVA").val().replace(/\s+[^\s]+$/, '');
        if (!resistanceValue || !voltageTap || (lengthValue.trim() == "" || parseFloat(lengthValue.trim()) == 0) || totalVA.trim() == "" || parseFloat(totalVA.trim()) == 0) {
            document.getElementsByClassName('voltageDropVal')[0].innerText = "0.00v";
            document.getElementsByClassName('voltageDropPctVal')[0].innerText = "0.00%";
            document.getElementsByClassName('voltageAtLastFixtureVal')[0].innerText = "0.00v";
            $(".status-section").children().addClass("hidden");
            $('.chart-container').addClass('hidden');
            return;
        }
        var loadCurrent = totalVA / voltageTap;
        var voltageDrop = (2 * loadCurrent * resistanceValue * lengthValue / 1000);
        var voltageDropPercentage = (voltageDrop / voltageTap) * 100;
        var voltageAtLastFixture = voltageTap - voltageDrop;
        document.getElementsByClassName('voltageDropVal')[0].innerText = voltageDrop.toFixed(2) + "v";
        document.getElementsByClassName('voltageDropPctVal')[0].innerText = voltageDropPercentage.toFixed(2) + "%";
        document.getElementsByClassName('voltageAtLastFixtureVal')[0].innerText = voltageAtLastFixture.toFixed(2) + "v";
        $(".low-voltage-msg").addClass("hidden");
        if (voltageAtLastFixture.toFixed(2) >= 10.5) {
            $(".good").removeClass("hidden").siblings().addClass("hidden");
        } else if (voltageAtLastFixture.toFixed(2) >= 10 && voltageAtLastFixture.toFixed(2) < 10.5) {
            $(".ok").removeClass("hidden").siblings().addClass("hidden");
        } else {
            $(".low").removeClass("hidden").siblings().addClass("hidden");
            $(".low-voltage-msg").removeClass("hidden");
        }
        ACC.calculator.renderBarGraph(selGuageValue.trim());
    },
    getAWGRange: function(selectedAWG) {
        const awgList = ["6 AWG","8 AWG","10 AWG","12 AWG","14 AWG","16 AWG","18 AWG","20 AWG"];
        const index = awgList.indexOf(selectedAWG);
        if(index === -1) return [];
        let start = Math.max(0, index - 2);
        let end = Math.min(awgList.length, start + 5);
        if(end - start < 5) {
            start = Math.max(0, end - 5);
        }
        return awgList.slice(start, end);
    },
    initializeBarChart: function() {
        const chartData = {
            labels: [],
            datasets: [{
                data: [],
                backgroundColor: [],
                borderColor: [],
                hoverBackgroundColor: [],
                borderWidth: 1,
                borderRadius: 5,
                borderSkipped: false,
                barThickness: 31
            }]
        };
        const options = {
            indexAxis: 'y',
            scales: {
                x: {
                    min: (ACC.calculator.isDesktopView) ? 8.5 : 8,
                    max: 11.5,
                    grid: {
                        color: function(context) {
                            if(context.tick.value === 8) {
                                return 'transparent';
                            }
                            return '#999999';
                        },
                        borderDash: [5, 5],
                        drawBorder: false,
                        drawOnChartArea: true,
                        drawTicks: false,
                        z: 1
                    },
                    ticks: {
                        stepSize: 0.5,
                        color: '#414244',
                        padding: 15,
                        callback: function(value) {
                            if (value < 8.5) return "";
                            return (value % 1 === 0) ? value + 'V' : value.toFixed(1) + 'V';
                        },
                        font : {
                            family: 'Arial',
                            size: ACC.calculator.isDesktopView ? 14 : 12,
                            weight: 400
                        }
                    },
                    offset: true
                },
                y: {
                    grid: {
                        drawBorder: false,
                        drawOnChartArea: false,
                        drawTicks: false,
                        borderDash: [5, 5]
                    },
                    ticks: {
                        font: {
                            family: 'Arial',
                            size: ACC.calculator.isDesktopView ? 16 : 14,
                            weight: function(context) {
                                if(ACC.calculator.isDesktopView) {
                                    return context.tick.label == ACC.calculator.selectedAWG ? 700 : 400;
                                } else {
                                    return context.tick.label == (ACC.calculator.selectedAWG).split(" ")[0] ? 'bold' : 400;
                                }  
                            }
                        }
                    }
                }
            },
            plugins: {
                tooltip: { enabled: false },
                legend: { display: false },
                datalabels: {
                    color: '#FFF',
                    anchor: 'end',
                    align: 'start',
                    formatter: (value) => (value.z < 0 ? '<0' : value.z) + 'V',
                    font: {
                        family: 'Arial',
                        size: 14,
                        weight: 400
                    }
                    /* ,offset: function(context) {
                        const value = context.dataset.data[context.dataIndex];
                        return !ACC.calculator.isDesktopView && value.z < 8.5 ? -1 : 2;
                    } */
                }
            },
            animation: {duration: 0},
            responsive: true,
            maintainAspectRatio: false/* ,
            elements: {
                bar: {
                    borderRadius: 5,
                    borderSkipped: false
                }
            } */
        };
        Chart.register(ChartDataLabels);
        const ctx = document.getElementById('wireGuageComparisonChart').getContext('2d');
        ACC.calculator.barChart = new Chart(ctx, {
            type: 'bar',
            data: chartData,
            options: options,
            plugins: [{
                beforeDraw: function (chart) {
                    const ctx = chart.ctx;
                    const xAxis = chart.scales.x;
                    const yAxis = chart.scales.y;
                    ctx.save();
                    ctx.fillStyle = '#999999';
                    xAxis.ticks.forEach((value, index) => {
                        if (value.value >= 8.5) {
                            var x = xAxis.getPixelForTick(index);
                            var y = xAxis.bottom - 35;
                            ctx.beginPath();
                            ctx.moveTo(x - 3, y);
                            ctx.lineTo(x + 3, y);
                            ctx.lineTo(x, y - 7);
                            ctx.closePath();
                            ctx.fill();
                        }
                    });
                    ctx.restore();

                    chart.data.datasets[0].data.forEach((value, index) => {
                        const y = yAxis.getPixelForValue(index);
                        const barWidth = xAxis.width;
                        const barHeight = chart.getDatasetMeta(0).data[index].height;
                        const barX = xAxis.left;
                        const barY = y - barHeight / 2;
                        ctx.fillStyle = '#F1F2F2';
                        ctx.fillRect(barX, barY, barWidth, barHeight);
                    });
                }
            }]
        });
    },
    updateBarChart: function (newLabels, newData, newColors) {
        ACC.calculator.barChart.data.labels = newLabels;
        ACC.calculator.barChart.data.datasets[0].data = newData.map((value, index) => {
            return {
                x: (value < 0) ? (ACC.calculator.isDesktopView ? 8.4 : 8.3)
                    : ((value > 11.5) ? 11.75 : ((value >= 0 && value <= 8.5) ? 8.5 : value)),
                y: index,
                z: value
            }
        });
        ACC.calculator.barChart.data.datasets[0].backgroundColor = newColors;
        ACC.calculator.barChart.data.datasets[0].borderColor = newColors;
        ACC.calculator.barChart.data.datasets[0].hoverBackgroundColor = newColors;
        ACC.calculator.barChart.update();
    },
    renderBarGraph: function(selectedAWG) {
        $('.chart-container').removeClass('hidden');
        var voltageTap = $("#voltageTap").val() || "";
        var lengthValue = $("#lengthValue").val().replace(/\s+[^\s]+$/, '') || "";
        var totalVA = $("#totalVA").val().replace(/\s+[^\s]+$/, '') || "";
        const awgResistanceObj = {
            "6 AWG": 0.3951,
            "8 AWG": 0.6282,
            "10 AWG": 0.9989,
            "12 AWG": 1.588,
            "14 AWG": 2.525,
            "16 AWG": 4.016,
            "18 AWG": 6.385,
            "20 AWG": 10.15
        }
        const awgRange = ACC.calculator.getAWGRange(selectedAWG);
        const awgData = {};
        for(const awg of awgRange) {
            const resistance = awgResistanceObj[awg];
            awgData[awg] = ACC.calculator.calculateVoltageAtLastFixture(resistance, lengthValue, totalVA, voltageTap).toFixed(2);
        }
        const awgLabels = ACC.calculator.isDesktopView ? Object.keys(awgData) : Object.keys(awgData).map(item => item.split(" ")[0]);
        const voltageData = Object.values(awgData);
        const barColors = voltageData.map(voltage => {
            if(voltage >= 10.5) {
                return '#77A12E';
            } else if(voltage >=10 && voltage < 10.5) {
                return '#EF8700';
            } else if(voltage >= 8.5 && voltage < 10){
                return '#E40101';
            } else if(voltage < 8.5 && voltage >= 0) {
                return '#5A5B5D';
            } else {
                return '#999999';
            }
        });
        ACC.calculator.selectedAWG = selectedAWG;
        ACC.calculator.updateBarChart(awgLabels, voltageData, barColors);
    },
    formatNumberInput: function(input) {
        const originalValue = input.value;
        const selectionStart = input.selectionStart;
        let value = originalValue.replace(/,/g, '');
        const hasDecimal = value.includes('.');
        let [integerPart, decimalPart] = value.split('.');
        if(integerPart.length > 9) {
            integerPart = integerPart.substring(0, 9);
        }
        if(integerPart.length + (decimalPart ? decimalPart.length : 0) > 9) {
            if(decimalPart) {
                decimalPart = decimalPart.substring(0, 9 - integerPart.length);
            }
        }
        if(parseFloat(integerPart + '.' + (decimalPart || '0')) < 9999999.99) {
            if(decimalPart && decimalPart.length > 2) {
                decimalPart = decimalPart.substring(0, 2);
            }
        }
        let formattedInteger = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        let formattedValue = hasDecimal ? formattedInteger + '.' + (decimalPart || '') : formattedInteger;
        if(formattedValue.length > 11){
        formattedValue = formattedValue.toString().replace(/\.$/, '');
        }
        input.value = formattedValue;
        const commasBeforeCursor = (originalValue.slice(0, selectionStart).match(/,/g) || []).length;
        const commasAfterFormat = (formattedValue.slice(0, selectionStart).match(/,/g) || []).length;
        const cursorPosition = selectionStart + (commasAfterFormat - commasBeforeCursor);
        input.setSelectionRange(cursorPosition, cursorPosition);
        const valueWithoutCommas = integerPart + (decimalPart ? '.' + decimalPart : '');
        $(input).attr('value', valueWithoutCommas);
    },
    updateWrapSection: function(selectedWrap) {
        ACC.calculator.updateFields(selectedWrap);
        ACC.calculator.checkAndCalculateLength();
		ACC.calculator.updateImageForTypeOfWrap(selectedWrap);
        $("#inputFields").find('input').val('');
        $("#inputFields").find('input').attr('value', '');
        $(".totalLength").text('0.00 ft');
    },
    updateFields: function(type) {
        $(".wrap-fields").addClass('hidden');
        $("." + type).removeClass('hidden');
    },
    dropdownToggleConvertion: function(unit) {
        let height = ACC.calculator.convertToFeet(parseFloat($('.inputField .height').attr('value')) || 0, $(".inputField .height").next('#projectCalcBtnGroup').find('.active').data('unit'));
        let width = ACC.calculator.convertToFeet(parseFloat($('.inputField .width').attr('value')) || 0, $(".inputField .width").next('#projectCalcBtnGroup').find('.active').data('unit'));
        let depth = ACC.calculator.convertToFeet(parseFloat($('.inputField .depth').attr('value')) || 0, $(".inputField .depth").next('#projectCalcBtnGroup').find('.active').data('unit'));
         let mobileFlag = $('.mobilebarkMulchCalc').hasClass('mob');
        let squareFeet = height * width;
		let cubicFeet = squareFeet * depth;
	    let pageName = $(".pagename").val();
        let Pounds;
        if (pageName == "Bark Mulch Calculator Page") {
            Pounds = (height / 3) * (width / 3)* (depth / 3) * 410;
        }
        if (pageName == "Top Soil Calculator Page") {
            Pounds = (height / 3) * (width / 3) * (depth / 3) * 2100;
            
        }
        if (pageName == "Road Basefill Calculator Page") {
            Pounds = (height / 3) * (width / 3) * (depth / 3) * 2650;
        }
        if (pageName == "Decorative Rock Calculator Page") {
            Pounds = (height / 3) * (width / 3) * (depth / 3) * 2800;
        }

        if(unit == ''){
            dropdown1 = $('.areaDropdownButton').val();
            dropdown2 = $('.volumeDropdownButton').val(); 
            dropdown3 = $('.weightDropdownButton').val();
            val1 = ACC.calculator.conversinofcal(height,width,depth,dropdown1);
            val2 = ACC.calculator.conversinofcal(height,width,depth,dropdown2);
            val3 = ACC.calculator.conversinofcal(height,width,depth,dropdown3);
            $('#areaDropdownComponent #value').css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(val1));
            $('#volumeDropdownComponent #value') .css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(val2));
            $('#weightDropdownComponent #value') .css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(val3));

        }
        else{
            switch(unit) {
                case 'squarefeet':
                    const squarefeet =height * width;
                    $('#areaDropdownComponent #value').css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(squarefeet));
                    break;
                case 'squareinches':
                    const squareinches =( height * width) * 144;
                    $('#areaDropdownComponent #value').css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(squareinches));
                    break;
                case 'squareyards':
                    const squareyards =( height * width) / 9;
                    $('#areaDropdownComponent #value').css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(squareyards));
                    break;
                case 'cubicfeet':
                    const cubicfeet = height * width * depth;
                    $('#volumeDropdownComponent #value').css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(cubicfeet));
                    break;
                case 'cubicyards':
                    const cubicyards =(height * width * depth) / 27;
                    $('#volumeDropdownComponent #value').css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(cubicyards));
                    break;
                case 'pounds':
                    $('#weightDropdownComponent #value').css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(Pounds));
                    break;
                case 'tons':
                    const tonVal = Pounds/2000;
                    $('#weightDropdownComponent #value').css('font-size',mobileFlag ? '25pt': '40px').html(ACC.calculator.formatTotalLengthCal(tonVal));
                    break;
            }
        }
    },
    conversinofcal: function(height,width,depth,unit){
        let pageName = $(".pagename").val();
        let Pounds;
        if (pageName == "Bark Mulch Calculator Page") {
            Pounds = (height / 3) * (width / 3)* (depth / 3) * 410;
        }
        if (pageName == "Top Soil Calculator Page") {
            Pounds = (height / 3) * (width / 3) * (depth / 3) * 2100;
        }
        if (pageName == "Road Basefill Calculator Page") {
            Pounds = (height / 3) * (width / 3) * (depth / 3) * 2650;
        }
        if (pageName == "Decorative Rock Calculator Page") {
            Pounds = (height / 3) * (width / 3) * (depth / 3) * 2800;
        }
        switch(unit) {
            case 'squarefeet':
                return height * width;
            case 'squareinches':
                return (height * width) * 144;
            case 'squareyards':
                return ( height * width) / 9;
            case 'cubicfeet':
                return height * width * depth;
            case 'cubicyards':
                return (height * width * depth) / 27;
            case 'pounds':
                return Pounds;
            case 'tons':
                return Pounds/2000;
        }
    },
     formatTotalLengthCal: function(num) {
        const hasDecimal = num % 1 !== 0;
        let lengthStr;
        let totalDigits;
        let formattedLength;
        if(hasDecimal){
            lengthStr =Math.abs(num).toFixed(2);
            totalDigits = lengthStr.replace('.', '').length;
            formattedLength = parseFloat(lengthStr).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }
        else{
            totalDigits =  Math.abs(num).toString().length;
            formattedLength = parseFloat(num).toLocaleString();
            
        }
            if(totalDigits <= 7) {
            return formattedLength;
            } else if(totalDigits > 7 & totalDigits <= 9) {
                return formattedLength;
            } else if(totalDigits > 9) {
                const scientificNotation = num.toExponential(2).replace('e+', ' x 10<sup>') + '</sup>';
            return scientificNotation;
            }
    },
    checkAndCalculateLength: function() {
        let allFieldsFilled = true;
        const $activeFields = $(".wrap-fields:not(.hidden) input");
        $activeFields.each(function() {
            if($(this).val() === "" || parseFloat($(this).val().trim()) == 0) {
                allFieldsFilled = false;
            }
        });
        if(allFieldsFilled) {
            ACC.calculator.calculateLength();
        } else {
            let mobileFlag = $('.totalLength').hasClass('mob');
            $('.totalLength').css('font-size', mobileFlag ? '40px' : '32pt').text('0.00 ft');
        }
    },
    calculateLength: function() {
        let totalLength = 0;
        const wrapType = $("#typeOfWrap").val();
        if(wrapType === 'tree') {
            const height = ACC.calculator.convertToFeet(parseFloat($('.tree .height').attr('value')) || 0, $('.tree .height').closest('.hl-input-section').find('.active').data('unit'));
            const width = ACC.calculator.convertToFeet(parseFloat($('.tree .width').attr('value')) || 0, $('.tree .width').closest('.hl-input-section').find('.active').data('unit'));
            totalLength = height * width * 4.23;
        } else if(wrapType === 'canopy') {
            const height = ACC.calculator.convertToFeet(parseFloat($('.canopy .height').attr('value')) || 0, $('.canopy .height').closest('.hl-input-section').find('.active').data('unit'));
            const width = ACC.calculator.convertToFeet(parseFloat($('.canopy .width').attr('value')) || 0, $('.canopy .width').closest('.hl-input-section').find('.active').data('unit'));
            totalLength = height * width * 3.14;
        } else if(wrapType === 'trunk') {
            const height = ACC.calculator.convertToFeet(parseFloat($('.trunk .height').attr('value')) || 0, $('.trunk .height').closest('.hl-input-section').find('.active').data('unit'));
            const circumference = ACC.calculator.convertToFeet(parseFloat($('.trunk .circumference').attr('value')) || 0, $('.trunk .circumference').closest('.hl-input-section').find('.active').data('unit'));
            const spacing = ACC.calculator.convertToFeet(parseFloat($('.trunk .spacing').attr('value')) || 0, $('.trunk .spacing').closest('.hl-input-section').find('.active').data('unit'));
            totalLength = (height * circumference) / spacing;
        } else if(wrapType === 'branch') {
            const branches = parseFloat($('.branch .branches').attr('value')) || 0;
            const branchLength = ACC.calculator.convertToFeet(parseFloat($('.branch .length').attr('value')) || 0, $('.branch .length').closest('.hl-input-section').find('.active').data('unit'));
            const branchDiameter = ACC.calculator.convertToFeet(parseFloat($('.branch .diameter').attr('value')) || 0, $('.branch .diameter').closest('.hl-input-section').find('.active').data('unit'));
            const spacing = ACC.calculator.convertToFeet(parseFloat($('.branch .spacing').attr('value')) || 0, $('.branch .spacing').closest('.hl-input-section').find('.active').data('unit'));
            totalLength = (branches * branchLength * branchDiameter * 3.14) / spacing;
        }
        ACC.calculator.formatTotalLength(totalLength);
    },
    updateImageForTypeOfWrap: function(type) {
        const imageFileObj = {
            'tree': 'tree-christmas.png',
            'canopy': 'tree-canopy.png',
            'trunk': 'tree-trunk.png',
            'branch': 'tree-branch.png'
        };
        $('.typeOfWrapImage').attr('src', '/_ui/responsive/theme-lambda/images/' + imageFileObj[type]);
        $('.typeOfWrapImage').removeClass().addClass('typeOfWrapImage ' + type);
    },
    formatTotalLength: function(length) {
        const lengthStr = length.toFixed(2);
        const totalDigits = lengthStr.replace('.', '').length;
        let formattedLength = parseFloat(lengthStr).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        let mobileFlag = $('.totalLength').hasClass('mob');
        if(totalDigits <= 7) {
           $('.totalLength') .css('font-size', mobileFlag ? '40px': '32pt').text(formattedLength + ' ft');
        } else if(totalDigits > 7 & totalDigits <= 9) {
            $('.totalLength') .css('font-size', mobileFlag ? '35px' : '26pt').text(formattedLength + ' ft');
        } else if(totalDigits > 9) {
            const scientificNotation = length.toExponential(2).replace('e+', ' x 10<sup>') + '</sup> ft';
            $('.totalLength') .css('font-size', mobileFlag ? '35px' : '32pt').html(scientificNotation);
        }
    },
    adjustFontSizeAndText: function (text, className) {
        var element = $('.' + className).eq(0);
        var numDigits = text.replace(/[.-]/g, "").length;
        var fontSize;
        if(numDigits > 9) {
            fontSize = '30px';
        } else if (numDigits >= 8) {
            fontSize = '40px';
        } else if (numDigits >= 6) {
            fontSize = '50px';
        } else {
            fontSize = '64px';
        }
        element.css('font-size', fontSize);
        element.text(text);
    },
    currentMode: "dimensions",
    currentLayout: "square",
    savedValues: {
        length: '',
        width: '',
        sqft: '',
        spacing: ''
    },
    updateView: function () {
        if ($(".page-plantSpacingPage").length && $(".page-plantSpacingPage").is(":visible")) {
            const isRow = ACC.calculator.currentLayout === "row";
            if (isRow) {
                $(".modeButtons").addClass("hidden");
            } else {
                $(".modeButtons").removeClass("hidden");
            }
            $("#field-length, #field-width, #field-sqft, #field-spacing").addClass("hidden");
            if (isRow) {
                $("#field-length, #field-spacing").removeClass("hidden");
                $(".length").val('');
                $(".width").val('');
                $(".spacing").val('');
                $(".sqft").val('');
                $('.plantCount').text('');
                $('.plants').text('');
                $(".start-position").text('');
            } else {
                if (ACC.calculator.currentMode === "dimensions") {
                    $("#field-length, #field-width, #field-spacing").removeClass("hidden");
                    $(".length").val(ACC.calculator.savedValues.length);
                    $(".width").val(ACC.calculator.savedValues.width);
                    $(".spacing").val(ACC.calculator.savedValues.spacing);
                } else {
                    $("#field-sqft, #field-spacing").removeClass("hidden");
                    $(".sqft").val(ACC.calculator.savedValues.sqft);
                    $(".spacing").val(ACC.calculator.savedValues.spacing);
                }
            }
            const layoutLabel = {
                "square": "Square<br>Spacing",
                "triangular": "Triangular<br>Spacing",
                "row": "Row / Hedge"
            };
            if ($(".layout-heading").hasClass("mob") && ACC.calculator.currentLayout === 'row') {
                $(".layout-heading").html("Row");
            } else {
                $(".layout-heading").html(layoutLabel[ACC.calculator.currentLayout]);
            }
            $('.typeOfLayout').attr('src', '/_ui/responsive/theme-lambda/images/layout_' + ACC.calculator.currentLayout + '.png');
            ACC.calculator.checkAndCalculatePlants();
        }
    },
    convertToInches: function(value, unit) {
        switch(unit) {
            case 'inches':
                return value;
            case 'feet':
                return value * 12;
            case 'area':
                return value * 144;
            default:
                return 0;
        }
    },
    checkAndCalculatePlants: function () {
        let allFieldsFilled = true;
        const $activeFields = $(".field:not(.hidden) input");
        $activeFields.each(function () {
            if ($(this).val() === "" || parseFloat($(this).val().trim()) == 0) {
                allFieldsFilled = false;
            }
        });
        if (allFieldsFilled) {
            ACC.calculator.calculatePlants();
        } else {
            $('.plantCount').text('');
            $('.plants').text('');
            $(".start-position").text('');
        }
    },
    calculatePlants: function () {
        let nTotal = 0;
        let rowStartPoint = 0;
        const spacing = ACC.calculator.convertToInches(parseFloat($(".spacing").attr('value')) || 0, $('.spacing').closest('.hl-input-section').find('.active').data('unit'));
        if (ACC.calculator.currentLayout === "row") {
            const length = ACC.calculator.convertToInches(parseFloat($(".length").attr('value')) || 0, $('.length').closest('.hl-input-section').find('.active').data('unit'));
            nTotal = Math.floor(length / spacing) + 1;
            const extraLengthSpace = length - (nTotal - 1) * spacing;
            const offset = extraLengthSpace / 2;
            rowStartPoint = parseFloat(offset) + Number(spacing / 2);
        } else if (ACC.calculator.currentMode === "dimensions") {
            const length = ACC.calculator.convertToInches(parseFloat($(".length").attr('value')) || 0, $('.length').closest('.hl-input-section').find('.active').data('unit'));
            const width = ACC.calculator.convertToInches(parseFloat($(".width").attr('value')) || 0, $('.width').closest('.hl-input-section').find('.active').data('unit'));
            if (ACC.calculator.currentLayout === "square") {
                const nL = Math.floor(length / spacing) + 1;
                const nW = Math.floor(width / spacing) + 1;
                nTotal = nL * nW;
                const extraLengthSpace = length - (nL - 1) * spacing;
                const extraWidthSpace = width - (nW - 1) * spacing;
                const offset = Math.min(extraLengthSpace, extraWidthSpace) / 2;
                rowStartPoint = parseFloat(offset) + Number(spacing / 2);
            } else if (ACC.calculator.currentLayout === "triangular") {
                const sV = (spacing * Math.sqrt(3)/2);
                const nL = Math.floor(length / spacing) + 1;
                const nW = Math.floor(width / sV) + 1;
                nTotal = Math.ceil(nL * (nW / 2) + (nL - 1) * (nW / 2));
                const extraLengthSpace = (length - (nL - 1) * spacing);
                const extraWidthSpace = (width - (nW - 1) * sV);
                const offset =  Math.min(extraLengthSpace, extraWidthSpace) / 2;
                rowStartPoint = parseFloat(offset) + Number(spacing / 2);
            }
        } else {
            const sqft = ACC.calculator.convertToInches(parseFloat($(".sqft").attr('value')) || 0, "area");
            if (ACC.calculator.currentLayout === "square") {
                const sL = Math.sqrt(sqft);
                const nS = Math.floor(sL/ spacing) + 1;
                nTotal = nS * nS;
                const extraSpace = sL - (nS - 1) * spacing;
                const offset = extraSpace / 2;
                rowStartPoint = parseFloat(offset) + Number(spacing / 2);
            } else if (ACC.calculator.currentLayout === "triangular") {
                const sL = Math.sqrt(sqft);
                const nRow = Math.floor(sL / spacing) + 1;
                const nRows = Math.floor(sL / (spacing * Math.sqrt(3)/2)) + 1;
                nTotal = nRow * nRows;
                const extraSpace = sL - (nRow - 1) * spacing;
                const offset = extraSpace / 2;
                rowStartPoint = parseFloat(offset) + Number(spacing / 2);
            }
        }
        ACC.calculator.formatPlantCount(nTotal);
        $(".plants").text(nTotal > 1 ? "plants" : "plant");
        if($(".start-position").hasClass("mob")) {
            $(".start-position").text(`Start ${rowStartPoint.toFixed(2)}" from the edge.`);
        } else {
            $(".start-position").text(`Start the first row ${rowStartPoint.toFixed(2)}" from the edge.`);
        }
    },
    formatPlantCount: function(count) {
        const plantCountStr = count.toFixed(2);
        const totalDigits = plantCountStr.replace('.', '').length;
        let formattedPlantCount = parseFloat(plantCountStr).toLocaleString();
        let mobileFlag = $('.plantCount').hasClass('mob');
        if(totalDigits <= 7) {
           $('.plantCount').css('font-size', mobileFlag ? '40px': '40pt').text(formattedPlantCount);
        } else if(totalDigits > 7 & totalDigits <= 9) {
            $('.plantCount').css('font-size', mobileFlag ? '35px' : '32pt').text(formattedPlantCount);
        } else if(totalDigits > 9) {
            const scientificNotation = count.toExponential(2).replace('e+', ' x 10<sup>') + '</sup>';
            $('.plantCount').css('font-size', mobileFlag ? '35px' : '32pt').html(scientificNotation);
        }
    },
    handleModeButtonClick: function (button) {
        if (!$(button).hasClass("active")) {
            $(".modeButtons button").removeClass("active");
            $(button).addClass("active");
            ACC.calculator.currentMode = $(button).data("mode");
            if (ACC.calculator.currentLayout !== "row") {
                ACC.calculator.currentLayout = "square";
                $(".layoutButtons button").removeClass("active");
                $('.layoutButtons button[data-layout="square"]').addClass("active");
            }
            ACC.calculator.savedValues.length = '';
            ACC.calculator.savedValues.width = '';
            ACC.calculator.savedValues.sqft = '';
            ACC.calculator.savedValues.spacing = '';
            $(".length").val(ACC.calculator.savedValues.length);
            $(".width").val(ACC.calculator.savedValues.width);
            $(".sqft").val(ACC.calculator.savedValues.sqft);
            $(".spacing").val(ACC.calculator.savedValues.spacing);
            ACC.calculator.updateView();
        }
    },
    handleLayoutButtonClick: function (button) {
        if (!$(button).hasClass("active")) {
            const selectedLayout = $(button).data("layout");
            if (ACC.calculator.currentLayout === "row") {
                ACC.calculator.savedValues.length = '';
                ACC.calculator.savedValues.width = '';
                ACC.calculator.savedValues.sqft = '';
                ACC.calculator.savedValues.spacing = '';
                $(".length").val(ACC.calculator.savedValues.length);
                $(".width").val(ACC.calculator.savedValues.width);
                $(".sqft").val(ACC.calculator.savedValues.sqft);
                $(".spacing").val(ACC.calculator.savedValues.spacing);
            } else {
                if (selectedLayout !== "row") {
                    ACC.calculator.savedValues.length = $(".length").val();
                    ACC.calculator.savedValues.width = $(".width").val();
                    ACC.calculator.savedValues.sqft = $(".sqft").val();
                    ACC.calculator.savedValues.spacing = $(".spacing").val();
                }
            }
            $(".layoutButtons button").removeClass("active");
            $(button).addClass("active");
            ACC.calculator.currentLayout = selectedLayout;
            ACC.calculator.updateView();
        }
    },
    flagStoneMandatoryCheck: function() {
        if( $('.materialsCalculators').is(":Visible") == true)
        { 
        if($('.length').val() != '' && $('.width').val() != '' && $('#select-option').val() != ''){
            $(".flagStoneCalculate").removeClass("disabled");
        }
        else{
            $(".flagStoneCalculate").addClass("disabled");
        }
    }
    else{
        if($('.length').val() != '' && $('.width').val() != '' && $('.depthUnitDropdown').val() != null){
            $(".flagStoneCalculate").removeClass("disabled");
        }
        else{
            $(".flagStoneCalculate").addClass("disabled");
        }
    }
    },
    topSoilMandatoryCheck: function() {
        if($('.length').val() != '' && $('.width').val() != '' && $('.depth').val() != ''){
            $(".topSoilCalculate").removeClass("disabled");
        }
        else{
            $(".topSoilCalculate").addClass("disabled");
        }
    },
    roadBaseFillMandatoryCheck: function() {
        if($('.length').val() != '' && $('.width').val() != '' && $('.depth').val() != ''){
            $(".roadBasefillCalculate").removeClass("disabled");
        }
        else{
            $(".roadBasefillCalculate").addClass("disabled");
        }
    },
    decorativeRockMandatoryCheck: function() {
        if($('.length').val() != '' && $('.width').val() != '' && $('.depth').val() != ''){
            $(".decorativeRockCalculate").removeClass("disabled");
        }
        else{
            $(".decorativeRockCalculate").addClass("disabled");
        }
    },
    stoneWallsMandatoryCheck: function () {
        if ($('#height').val() != '' && $('#width').val() != '') {
            $(".stoneWallCalculate").removeClass("disabled");
        } else {
            $(".stoneWallCalculate").addClass("disabled");
        }
    },
    barkMulchMandatoryCheck: function() {
        if ($('.length').val() != '' && $('.width').val() != '' && $('.depth').val() != '') {
            $(".barkMulchBedCalculate").removeClass("disabled");
        } else {
            $(".barkMulchBedCalculate").addClass("disabled");
        }
    }
};

$(".mob-matcal-options").change(function() {
    var option = $(this).find('option:selected');
    window.location.href = option.data("url");
});
function dropdownToggle() {
    
    // select the main dropdown button element
    var dropdown = $(this).parent().parent().prev();
    // change the CONTENT of the button based on the content of selected option
    dropdown.html($(this).html() + '&nbsp;</i><span class="glyphicon glyphicon-chevron-down"></span>');
    
}
$(document).ready(function(){
    $('.dropdown-menu-cal a, .dropdown-menu-voltagedrop a, .dropdown-menu-hl a,.dropdown-menu-fs a').on('click', dropdownToggle);
   
      $("#tableMenu a").on('click', function(e) {
        e.preventDefault();
        $('#tableMenu li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        var valueflag = $(this).data('value');
        $('#select-option').val(valueflag);
        ACC.calculator.flagStoneMandatoryCheck();
        ACC.calculator.topSoilMandatoryCheck();
        ACC.calculator.barkMulchMandatoryCheck();
      });
    
      $("#tableMenuoptionlength a").on('click', function(e) {
        e.preventDefault();
        $('#tableMenuoptionlength li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        var valuelengthflag = $(this).data('value');
        $('.lengthUnitDropdown').val(valuelengthflag);
      });
      $("#tableMenuoptionwidth a").on('click', function(e) {
        e.preventDefault();
        $('#tableMenuoptionwidth li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        var valuewidthflag = $(this).data('value');
        $('.widthUnitDropdown').val(valuewidthflag);
      });
      $("#tableMenuoptiondepth a").on('click', function(e) {
        e.preventDefault();
        $('#tableMenuoptiondepth li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        var valuedepthflag = $(this).data('value');
        $('.depthUnitDropdown').val(valuedepthflag);
      });
      $("#tableMenuoptionheight a").on('click', function(e) {
        e.preventDefault();
        $('#tableMenuoptionheight li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        var valueheightflag = $(this).data('value');
        $('.heightUnitDropdown').val(valueheightflag);
      });
        $(".toggle-unit").on("click", function () {
  const $btn = $(this);
  const $group = $btn.closest("#projectCalcBtnGroup");

  $group.find(".toggle-unit").removeClass("active");
  $btn.addClass("active");

  if ($("#flagStoneCalc").is(":visible")) {
    ACC.calculator.CalculateFlagstone();
  }
    });
      $("#guageListDropdown a").on('click', function(e) {
        e.preventDefault();
        $('#guageListDropdown li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        var selectedValue = $(this).data('value');
        $('#guage').val(selectedValue);
        ACC.calculator.voltageDropCalculator();
      });
      $("#voltageTapListDropdown a").on('click', function(e) {
        e.preventDefault();
        $('#voltageTapListDropdown li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        var selectedValue = $(this).data('value');
        $('#voltageTap').val(selectedValue);
        ACC.calculator.voltageDropCalculator();
      });
    if ($(".page-voltageDropCalculatorPage").length && $(".page-voltageDropCalculatorPage").is(":visible")) {
        ACC.calculator.voltageDropCalculator();
        ACC.calculator.initializeBarChart();
    }
    $("#typeOfWrapDropdown a").on('click', function(e) {
        e.preventDefault();
        $('#typeOfWrapDropdown li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        var selectedValue = $(this).data('type');
        $("#typeOfWrap").val(selectedValue);
        ACC.calculator.updateWrapSection(selectedValue);
      });
      $('#inputFields').on('click', '.toggle-unit', function() {
        const $button = $(this);
        const $inputGroup = $button.closest('.hl-input-section');
        $inputGroup.find('.toggle-unit').removeClass('active');
        $button.addClass('active');
        if(!$button.hasClass('mob')) {
            const unit = $button.data('unit');
            const $input =$inputGroup.find('input');
            const fieldName = $input.attr('class').split(' ')[2];
            $input.attr('placeholder', `Enter ${fieldName} in ${unit}`);
        }
        if($(".page-holidayLightingCalculatorPage").length && $(".page-holidayLightingCalculatorPage").is(":visible")) {
            ACC.calculator.checkAndCalculateLength();
        } else if($(".page-plantSpacingPage ").length && $(".page-plantSpacingPage").is(":visible")) {
            const unit = $button.data('unit');
            const $input =$inputGroup.find('input');
            const fieldName = $input.attr('class').split(' ')[2];
            ACC.calculator.handleSuffix($input, false);
            $input.data('suffix', $button.data('unit'));
            ACC.calculator.handleSuffix($input, true);
            if($button.hasClass('mob')) {
              $input.attr('placeholder', `${fieldName.charAt(0).toUpperCase() + fieldName.slice(1)} in ${unit}`);  
            }
            ACC.calculator.checkAndCalculatePlants();
        }
      });
      $('#thicknessDropdown a').on('click', function (e) {
    e.preventDefault()
     $('#thicknessDropdown li').removeClass('selected')
    $(this).parent('li').addClass('selected')
    var selectedValue = $(this).data('value')
    $('#thickness').val(selectedValue)
    ACC.calculator.CalculateFlagstone('');
  })
  $('#MenuoptionVolume a').on('click', function (e) {
    e.preventDefault()
    $('#MenuoptionVolume li').removeClass('selected')
    $(this).parent('li').addClass('selected')
    $('#MenuoptionVolume li span').addClass('hidden')
    $(this).parent('li').find('span').removeClass('hidden')
    $('#MenuoptionVolume li a').addClass('m-l-15')
    $(this).parent('li').find('a').removeClass('m-l-15')
    var selectedValue = $(this).data('value')
    $('.volumeDropdownBtn').val(selectedValue)
     $('.inputField .length').attr('data-dropdownmetric', selectedValue)
    ACC.calculator.CalculateFlagstone('');
  })
  $('#Menuoptionarea a').on('click', function (e) {
    e.preventDefault()
    $('#Menuoptionarea li').removeClass('selected')
    $(this).parent('li').addClass('selected')
    $('#Menuoptionarea li span').addClass('hidden')
    $(this).parent('li').find('span').removeClass('hidden')
    $('#Menuoptionarea li a').addClass('m-l-15')
    $(this).parent('li').find('a').removeClass('m-l-15')
    var selectedValue = $(this).data('value')
    $('.areaDropdownBtn').val(selectedValue)
    $('.inputField .length').attr('data-dropdownmetric', selectedValue)
    ACC.calculator.CalculateFlagstone('');
  })
  $('#Menuoptionweight a').on('click', function (e) {
    e.preventDefault()
    $('#Menuoptionweight li').removeClass('selected')
    $(this).parent('li').addClass('selected')
    $('#Menuoptionweight li span').addClass('hidden')
    $(this).parent('li').find('span').removeClass('hidden')
    $('#Menuoptionweight li a').addClass('m-l-15')
    $(this).parent('li').find('a').removeClass('m-l-15')
    var selectedValue = $(this).data('value')
    $('.weightDropdownBtn').val(selectedValue)
     $('.inputField .width').attr('data-dropdownmetric', selectedValue)
    ACC.calculator.CalculateFlagstone('');
  })

      //BarkMuch
     $("#tableMenuoptionVolume a").on('click', function (e) {
        e.preventDefault();
        $('#tableMenuoptionVolume li').removeClass('selected');
        $(this).parent('li').addClass('selected');
        $("#tableMenuoptionVolume li span").addClass("hidden");
        $(this).parent("li").find("span").removeClass("hidden");
        $("#tableMenuoptionVolume li a").addClass("m-l-15");
        $(this).parent("li").find("a").removeClass("m-l-15");
        var valuedepthflag = $(this).data('value');
        $('.volumeDropdownButton').val(valuedepthflag);
        $('.inputField .width').attr("data-dropdownmetric", valuedepthflag);
    });
    $("#tableMenuoptionarea a").on('click', function (e) {
        e.preventDefault();
        $('#tableMenuoptionarea li').removeClass('selected');
        $(this).parent('li').addClass('selected');
         $("#tableMenuoptionarea li span").addClass("hidden");
        $(this).parent("li").find("span").removeClass("hidden");
        $("#tableMenuoptionarea li a").addClass("m-l-15");
        $(this).parent("li").find("a").removeClass("m-l-15");
        var valuedepthflag = $(this).data('value');
        $('.areaDropdownButton').val(valuedepthflag);
        $('.inputField .height').attr("data-dropdownmetric", valuedepthflag);
    });
      $("#tableMenuoptionweight a").on('click', function (e) {
        e.preventDefault();
        $('#tableMenuoptionweight li').removeClass('selected');
        $(this).parent('li').addClass('selected');
         $("#tableMenuoptionweight li span").addClass("hidden");
        $(this).parent("li").find("span").removeClass("hidden");
        $("#tableMenuoptionweight li a").addClass("m-l-15");
        $(this).parent("li").find("a").removeClass("m-l-15");
        var valuedepthflag = $(this).data('value');
        $('.weightDropdownButton').val(valuedepthflag);
        $('.inputField .depth').attr("data-dropdownmetric", valuedepthflag);
    });
});
ACC.addtocartaction = {

}

$(document).ready(function ()
{
	with (ACC.addtocartaction)
	{

	}
});


ACC.listaddtocartaction = {

}

$(document).ready(function ()
{
	with (ACC.listaddtocartaction)
	{

	}
});


ACC.listorderformaction = {

}

$(document).ready(function ()
{
	with (ACC.listorderformaction)
	{

	}
});


ACC.listpickupinstoreaction = {

}

$(document).ready(function ()
{
	with (ACC.listpickupinstoreaction)
	{

	}
});


ACC.pickupinstoreaction = {

}

$(document).ready(function ()
{
	with (ACC.pickupinstoreaction)
	{

	}
});


ACC.shareonsocialnetworkaction = {

}

$(document).ready(function ()
{
	with (ACC.shareonsocialnetworkaction)
	{

	}
});


ACC.viewstoreaction = {

}

$(document).ready(function ()
{
    with (ACC.viewstoreaction)
    {

    }
});
ACC.PDPBulkCalculator = {
    _autoload: [
        "bindRadioBtnInputHandler",
        "bindInputButtonHandler",
        "bindShapesClickHandler",
        "bindSubmitClickHandler"
    ],

    resetBulkCalculator: function() {
        // Reset radio button and show/hide elements
        $("#measurements").prop("checked", true);
        $("#sqftGroup").hide();
        $("#calculatorButtons, #calculatorImages, #measurementsGroup").show();
        // Reset all number inputs
        $("#show-bulk-calculator input[type='text']").val("");
        $("#show-bulk-calculator input[type='text']").attr("value", "");
        $(".qty-warning-message").addClass("hidden");
        // Reset text and add ellipsis class to specific elements
        ACC.PDPBulkCalculator.resetCalculatorDetails();
        // Reset product quantity to 1
        $("#show-bulk-calculator input[name='productPostPLPQty']").val(1);
        $("#calculatorAddToCart .js-pdp-add-to-cart").val(1);
    },
    
    // CLOSE-CALCULATOR-ICON
    closeCalculator: function() {
        $("#calculatorButtons #icons").removeClass("active").first().addClass("active");
        $("#calculatorButtons #1").first().trigger("click");
        $("#calculatorInputs input:visible").attr("value", "");
        $("#calculatorInputs input:visible").val("").siblings(".metricLabel").css("visibility", "hidden");
        $('#calculator-overlay').fadeOut(400);
        $('#show-bulk-calculator .footer').css({ right: "0" }).animate({ right: "-100%" }, 400);
        $('#show-bulk-calculator').css({ right: "0" }).animate({ right: "-100%" }, 400, function () {
            $('body').removeClass('no-scroll');
            ACC.PDPBulkCalculator.resetBulkCalculator();
        });
    },

    resetCalculatorDetails: function() {
        const elementsToReset = [
            "subTotalValue", "extraWasteValue", "totalCubicYards",
            "roundsToValue", "area", "weightValue",
            "finalCubicYards", "finalTotal"
        ];
        elementsToReset.forEach(id => {
            const $element = $(`#${id}`);
            $element.text("");
            // Add 'ellipsis' class only if the id is not 'finalCubicYards' or 'finalTotal'
            if (id !== "finalCubicYards" && id !== "finalTotal") {
                $element.addClass("ellipsis");
            }
        });
        $("#disclaimer").addClass("hidden");
        $("#calculatorAddToCart > button").attr("disabled", "disabled");
    },

    bindRadioBtnInputHandler: function() {
        $("#calculatorMenu input").on("change", function () {
            ACC.PDPBulkCalculator.resetCalculatorDetails();
            $("#calculatorInputs input:visible").attr("value", "");
            $("#calculatorInputs input:visible").val("").siblings(".metricLabel").css("visibility", "hidden");
            $("depthValue").attr("value", "");
            $("depthValue").val("");
            if (this.id === "sqft") {
                $("#calculatorButtons").hide();
                $("#calculatorImages").hide();
                $("#measurementsGroup").hide();
                $("#sqftGroup").show();
                $("#areaInput").show();
            } else {
                $("#sqftGroup").hide();
                $("#calculatorButtons").show();
                $("#calculatorImages").show();
                $("#measurementsGroup").show();
            }
        });
    },

    bindInputButtonHandler: function() {
        $(".buttons").on("click", "button", function () {
            $(this).siblings().removeClass("selected");
            $(this).addClass("selected");
            const input = $(this).parent().siblings("input");
            const currentInputValue = parseFloat(input.attr("value"));
            const targetContainer = input.attr('id') !== 'depthValue' ? input.closest('.input') : input.closest('.input-container');
            if ($(this).text().trim() === "in") {
                input.data("suffix", "inches");
                let calculatedValue = (parseFloat((currentInputValue * 12).toFixed(2)).toString().replace(/,/g,'') || '');
                if(!isNaN(calculatedValue) && calculatedValue.trim() !== "") {
                    const parts = calculatedValue.split('.');
                    const formatted = Number(parts[0]).toLocaleString();
                    input.val(parts.length > 1 ? `${formatted}.${parts[1]}` : formatted);
                }
                input.attr("value", parseFloat((currentInputValue * 12).toFixed(2)) || '');
                targetContainer.find(".metricLabel").text("inches");
                targetContainer.find(".metricLabel").css("left", (125 + parseInt((input.val().length * 8.2))) + "px");
            } else {
                if (input.closest("#sqftGroup").is(':visible')) {
                    input.data("suffix", "square feet");
                    targetContainer.find(".metricLabel").text("square feet");
                } else {
                    input.data("suffix", "feet");
                    targetContainer.find(".metricLabel").text("feet");
                }
                let calculatedValue = (parseFloat((currentInputValue / 12).toFixed(2)).toString().replace(/,/g,'') || '');
                if(!isNaN(calculatedValue) && calculatedValue.trim() !== "") {
                    const parts = calculatedValue.split('.');
                    const formatted = Number(parts[0]).toLocaleString();
                    input.val(parts.length > 1 ? `${formatted}.${parts[1]}` : formatted);
                }
                input.attr("value", parseFloat((currentInputValue / 12).toFixed(2)) || '');
                targetContainer.find(".metricLabel").css("left", (125 + parseInt((input.val().length * 8.2))) + "px");
            }
        });
    },

    bindShapesClickHandler: function() {
        $("#calculatorButtons > div").on("click", function (event) {
            const id = event.target.id;
            const $lengthInput = $("#lengthInput");
            const $widthInput = $("#widthInput");
            const $heightInput = $("#heightInput");
            const $sideInput = $("#sideInput");
            const $diameterInput = $("#diameterInput");
            const $sideA = $("#sideA");
            const $sideB = $("#sideB");
        
            const $image = $(`#calculatorImages svg#${id}`);
            const elementsToReset = [
                "subTotalValue", "extraWasteValue", "totalCubicYards",
                "roundsToValue", "area", "weightValue",
                "finalCubicYards", "finalTotal"
            ];
            elementsToReset.forEach(id => {
                const $element = $(`#${id}`);
                $element.text("");
                if (id !== "finalCubicYards" && id !== "finalTotal") {
                    $element.addClass("ellipsis");
                }
            });
            $("#disclaimer").addClass("hidden");
            $("#calculatorAddToCart > button").attr("disabled", "disabled");
            $("#depthValue").val("").siblings(".metricLabel").css("visibility", "hidden");
            $("#calculatorInputs input:visible").val("").siblings(".metricLabel").css("visibility", "hidden");
        
            if (id && $image.length && $(this).length) {
                $(".active").removeClass("active");
                $(this).addClass("active");
                $image.addClass("active");
                if (["1", "3", "6", "8"].includes(id)) {
                    $lengthInput.addClass("active");
                    $widthInput.addClass("active");
                } else if (id === "2") {
                    $diameterInput.addClass("active");
                } else if (id === "4") {
                    $sideA.addClass("active");
                    $sideB.addClass("active");
                    $heightInput.addClass("active");
                } else if (["5", "7"].includes(id)) {
                    $sideInput.addClass("active");
                }
            }
        });
    },
    formatTotal: function(totalVal, element) {
        const totalValStr = parseFloat(totalVal).toFixed(2);
        const totalDigits = totalValStr.replace('.', '').length;
        let formattedTotVal = parseFloat(totalValStr).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        let elementFlag = element === '#finalCubicYards' ? true : false;
        if(totalDigits <= 7) {
           $(element) .css('font-size', '36px').text(elementFlag ? formattedTotVal : ('$' + formattedTotVal));
        } else if(totalDigits > 7 & totalDigits <= 9) {
            $(element) .css('font-size', '32px').text(elementFlag ? formattedTotVal : ('$' + formattedTotVal));
        } else if(totalDigits > 9) {
            const scientificNotation = elementFlag ? parseFloat(totalVal).toExponential(2).replace('e+', ' x 10<sup>') + '</sup>' : ('$' + parseFloat(totalVal).toExponential(2).replace('e+', ' x 10<sup>') + '</sup>');
            $(element) .css('font-size', '36px').html(scientificNotation);
        }
    },
    formatSubTotals: function(subTotalVal) {
        const totalValStr = parseFloat(subTotalVal).toFixed(2);
        const totalDigits = totalValStr.replace('.', '').length;
        let formattedTotVal = parseFloat(totalValStr).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        if(totalDigits <= 9) {
            return formattedTotVal;
         } else if(totalDigits > 9) {
             const scientificNotation =  parseFloat(subTotalVal).toExponential(2).replace('e+', ' x 10<sup>') + '</sup>';
             return scientificNotation;
         }
    },
    bindSubmitClickHandler: function() {
        $("#calculatorAddToCart").on("click", "button", function(e) {
            $("#addToCartSection button").trigger("click");
        });
    }
};

$(document).ready(function () {
    // Show the "Bulk Calculator" button only if the product code is eligible
    if($(".linktracking-breadcrumb").length){
        (() => {
            let currentCategoryNumber = $(".linktracking-breadcrumb").last()[0].href.split("/").pop();
            const shouldShowBulkCalcButton = [
                //"sh1428113",
                "sh1226",
                "sh1227100",
                "sh1227101",
                "sh1520",
                "sh1521",
                "sh1517110",
                "sh1517117",
                "sh1517115",
                "sh1517123"
            ].indexOf(currentCategoryNumber) !== -1;
            if (shouldShowBulkCalcButton && $("#productSelect").length && !$("#productSelect button").hasClass("js-login-to-buy")
                && $(".bulkCalculatorType").length && $(".bulkCalculatorType").val() !== "" && $(".sellableUomsFlag").val() == "false") {
                if ($(".intervalQtyInfo").is(':visible') || $(".minQtyInfo").is(':visible')) {
                    $(".showBulkCalculatorEntrypoint").addClass("hidden");
                } else {
                    $(".showBulkCalculatorEntrypoint").removeClass("hidden");
                }
            } else {
                $(".showBulkCalculatorEntrypoint").addClass("hidden");
            }
        })();
    }

    $("#showBulkCalculator, #showBulkCalculatorMob").on("click", function (e) {
        $("#show-bulk-calculator input[name='productPostPLPQty']").attr("type", "hidden");
        $('#calculator-overlay').fadeIn(400); // Fade in the dark background
        $('#show-bulk-calculator').css({ right: "-100%" }).animate({ right: "0" }, 400, function () {
            $('#calculatorButtons #icons:first').addClass('active');
        });
        $('#show-bulk-calculator .footer').css({ right: "-100%" }).animate({ right: "0" }, 400);

        $("#lengthSuffix").text("feet");
        $("#pdpBulkAddWasteCost input").prop("checked", true);
        $("#signinId-hidecsp + #show-bulk-calculator").remove();
        $("#sqftGroup").hide();

        // Set unit of measure
        var uomValue = $(".product-uomMeasure").val() || '';
        var unitOfMeasure = uomValue.toLowerCase().includes('ton') ? 'tons' : 'cubic yards';

        // Update all .lineitem labels except the last two
        $(".lineitem:not(:last-child):not(:nth-last-child(2)) label").text(unitOfMeasure);

        // Update the specified element with all caps text
        $("#finalCubicYardsLabel").text(unitOfMeasure);

        function updateButtonState(productPrice) {
            let $button = $("#show-bulk-calculator .footer button");
            if (productPrice < 1) {
                $button.prop('disabled', true);
            } else {
                $button.prop('disabled', false);
            }
        }

        function extractProductPrice() {
            var extractPrice = function () {
                var price = '';
                let isAnonymous = $(".loggedInFlag").val();
                if (isAnonymous == "true") {
                    if ($('.trackRetailPrice').length && $('.trackRetailPrice').val() !== '') {
                        price = $('.trackRetailPrice').val();
                    }
                } else {
                    if ($('.trackCSP').length && $('.trackCSP').val() !== '') {
                        price = $('.trackCSP').val();
                    }
                }
                /* if ($('.quoteUom-CustomerPrice').length) {
                    price = $('.quoteUom-CustomerPrice').val();
                } else if ($('.quoteUom-Price').length) {
                    price = $('.quoteUom-Price').val();
                } else if ($('.uom-dropdown-option .custom-dropdown-label').length) {
                    price = $('.uom-dropdown-option .custom-dropdown-label').first().text().split('/')[0].trim();
                } else if ($('.multipleUomItem .multipleUomItemYourPrice').length) {
                    price = $('.multipleUomItem .multipleUomItemYourPrice').first().text().trim();
                } else if ($('.price').length) {
                    price = $('.price').first().text().trim();
                } else if ($(".yourPriceValue .bulk-price").length) {
                    price = $(".yourPriceValue .bulk-price").last().text().trim();
                } */
                return price;
            };

            var cleanPrice = function (priceString) {
                var cleaned = priceString.replace(/[^\d.]/g, '');
                return parseFloat(cleaned) || 0;
            };

            var extractedPrice = extractPrice();
            return cleanPrice(extractedPrice);
        }

        let productPrice = extractProductPrice();
        if (productPrice < 1) {
            updateButtonState(productPrice);
        }

        /* let loggedIn = $('.loginstatus').val() == '';
        let $button = $("#show-bulk-calculator #addToCartSection button");
        if (loggedIn) {
            $button.prop('disabled', true);
        } else {
            $button.prop('disabled', false);
        } */

        $("#calculatorAddToCart").html($("#productSelect").html());
        $("#calculatorAddToCart > button").attr("class", "btn btn-primary btn-block bulkAddtoCart");
        $("#calculatorAddToCart > button").attr("disabled", "disabled");
    });

    // tracking logic
   let clickCount = 0;
    $(document).on('click','#showBulkCalculator',function(){
     clickCount++
    digitalData.eventData = {
           linktype: "",
           linkName: "Bulk Materials Calculator",
           onClickPageName:$(".siteonepagename").val(),
           clickCount:clickCount
           }
           try {
               _satellite.track("linkClicks");
                if($('#materialsCalculators').is(":visible")){
                _AAData={ 
                        "page":{
                        "pageName" : 'content: bulk materials calculator'
                        },
                        "pathingChannel": "content",
                        "pathingPageName": 'content: bulk materials calculator',
                        eventType: ""

                        }
                        try {
                        _satellite.track('pageload');
                            } catch(e) { }
                
               }
               } catch (e) { }   

              
   });
     
(function () {
    // Recalculate totals with input change and debounce
    let debounceTimeout;

    $(".input input").on("input", function () {
        clearTimeout(debounceTimeout);

        const isAnyInputEmpty = $("#calculatorInputs input:visible").toArray().some(input => !input.value.trim());
        if (isAnyInputEmpty) {
            ACC.PDPBulkCalculator.resetCalculatorDetails();
        }

        const $this = $(this);
        const inputValue = $this.val();
        const metricLabel = $this.siblings(".metricLabel");
        const isNotEmpty = inputValue.length > 0;

        // Update metric type (inches/feet)
        const suffix = $this.data("suffix") || "";
        metricLabel.text(suffix);

        // Toggle metric label visibility
        metricLabel.css("visibility", isNotEmpty ? "visible" : "hidden");

        // Adjust metric label position based on input length
        metricLabel.css("left", `${125 + (inputValue.length * 8.2)}px`);

        // Validate inputs and run recalculation with debounce
        const areAllInputsFilled = $("#calculatorInputs input:visible").toArray().every(input => input.value.trim());
        if (!areAllInputsFilled) return;

        debounceTimeout = setTimeout(recalculate, 200); // Run recalculation after debouncing
    });
})();

function recalculate() {
    function getValueOrDefault(selector) {
        const value = $(selector).attr("value");
        const suffix = $(selector).data("suffix");
        return (value ? (suffix === "feet" || suffix === "square feet" ? parseFloat(value) : parseFloat(value) / 12) : 0);
    }

    const length = getValueOrDefault("#lengthValue");
    const width = getValueOrDefault("#widthValue");
    const depth = getValueOrDefault("#depthValue");
    const area = getValueOrDefault("#areaValue");
    const diameter = getValueOrDefault("#diameterValue");
    const side = getValueOrDefault("#sideValue");
    const sideA = getValueOrDefault("#sideAValue");
    const sideB = getValueOrDefault("#sideBValue");
    const height = getValueOrDefault("#heightValue");

    const fetchActiveShape = () => {
        const activeShape = parseInt($("#calculatorButtons .active div")[0].id) - 1;
        const shapes = [
            "rectangle",
            "circle",
            "rightTrangle",
            "trapezoid",
            "square",
            "oval",
            "equilTriangle",
            "parrallelogram",
        ];
        return shapes[activeShape];
    };

    const calculateRecVolume = (area, depth) => {
        return parseFloat(((area * depth) / 27).toFixed(2));
    };

    const calculateWaste = (volume) => {
        const shouldCalculateWaste = $("#pdpBulkAddWasteCost input").is(":checked");
        if (shouldCalculateWaste) {
            const waste = (volume * 0.10).toFixed(2);
            return parseFloat(waste);
        }
        return 0;
    };

    const getTotalCubicYards = (volume, waste) => {
        const total = (volume + waste).toFixed(2)
        return parseFloat(total);
    };

    const roundUpToWhole = (materialEstimate) => {
        return Math.ceil(materialEstimate);
    };

    const calculateWeight = (weight) => {
        const averageWeightFactors = {
            //sh1428113:410,
            sh1226: 410, // barkandmulch
            sh1211113: 2100, // topsoil
            sh1517110: 2700, // stonewalls
            sh1227100:2100,
            sh1227101:2100,
            sh1520:2650,
            sh1521:2800,
            sh1517121: 2800, //decrock
            sh1517117: 2700, // stonewalls
            sh1517115: 3564, // flagstone
            sh1517111: 3000, // sand & crusher run
            sh1517123: 3000 // river rock
        };
        const categoryCode = $(".linktracking-breadcrumb").last()[0].href.split("/").pop();
        const averageWeightFactor = averageWeightFactors[categoryCode];
        const pounds = weight * averageWeightFactor;
        let calculatedWeight = parseFloat((pounds / 2000).toFixed(2));
        return calculatedWeight;
    };

    const getCircleArea = () => {
        const step1 = diameter / 2;
        const step2 = step1 * step1;
        const step3 = 3.1416 * step2;
        return step3.toFixed(2);
    };

    const getTrapezoidArea = () => {
        const step1 = sideA + sideB;
        const step2 = step1 / 2;
        const step3 = height * step2;
        return step3.toFixed(2);
    };

    const getOvalArea = () => {
        const step1 = length / 2;
        const step2 = width / 2;
        const step3 = 3.1416 * step1 * step2;
        return step3.toFixed(2);
    };

    const getEqlTrnArea = () => {
        const step1 = side * side;
        const step2 = step1 * 0.433;
        return step2.toFixed(2);
    };

    function extractProductPrice() {
        var extractPrice = function () {
            var price = '';
            let isAnonymous = $(".loggedInFlag").val();
            if (isAnonymous == "true") {
                if ($('.trackRetailPrice').length && $('.trackRetailPrice').val() !== '') {
                    price = $('.trackRetailPrice').val();
                }
            } else {
                if ($('.trackCSP').length && $('.trackCSP').val() !== '') {
                    price = $('.trackCSP').val();
                }
            }
            /* if ($('.quoteUom-CustomerPrice').length) {
                price = $('.quoteUom-CustomerPrice').val();
            } else if ($('.quoteUom-Price').length) {
                price = $('.quoteUom-Price').val();
            } else if ($('.uom-dropdown-option .custom-dropdown-label').length) {
                price = $('.uom-dropdown-option .custom-dropdown-label').first().text().split('/')[0].trim();
            } else if ($('.multipleUomItem .multipleUomItemYourPrice').length) {
                price = $('.multipleUomItem .multipleUomItemYourPrice').first().text().trim();
            } else if ($('.price').length) {
                price = $('.price').first().text().trim();
            } else if ($(".yourPriceValue .bulk-price").length) {
                price = $(".yourPriceValue .bulk-price").last().text().trim();
            } */
            return price;
        };

        var cleanPrice = function (priceString) {
            var cleaned = priceString.replace(/[^\d.]/g, '');
            return parseFloat(cleaned) || 0;
        };

        var extractedPrice = extractPrice();
        return cleanPrice(extractedPrice);
    }

    function autoCalculate(volume = 0, waste = 0, totalCubicYards = 1, totalCubicYardsRounded = 1, area = 0, tons = 0) {
        // Helper function to format numbers
        const formatNumber = (num) => {
            // Convert to number and limit decimal places
            let formatted = parseFloat(num);
            // Check if it's a valid number
            if (isNaN(formatted)) return 0;
            // If number is too large, cap it
            //if (formatted > 99999) formatted = 99999;
            // If number is too small, floor at 0
            //if (formatted < 0) formatted = 0;
            // Format to max 2 decimal places
            return formatted.toFixed(2);
        };

        let productPrice = (extractProductPrice());
        const visibleInputs = $("#calculatorInputs input:visible");

        // Validate visible inputs
        if (visibleInputs.length === 0 || visibleInputs.toArray().some(input => isNaN(parseFloat(input.value.trim())))) {
            ["#subTotalValue", "#extraWasteValue", "#totalCubicYards", "#roundsToValue", "#area", "#weightValue"]
                .forEach(selector => $(selector).addClass("ellipsis").text(""));
            $("#finalCubicYards").text("");
            $("#finalTotal").text("");
            $(".pdp-bulk-sidebar input[name='pdpAddtoCartInput']").val("");
            return;
        }

        if ($("#calculatorDisplay .ellipsis").length > 0) {
            $("#calculatorDisplay .ellipsis").removeClass("ellipsis");
            $("#disclaimer").removeClass("hidden");
            if(!$("#productSelect button").is(":disabled")) {
                $("#calculatorAddToCart > button").removeAttr("disabled");
            }
        }

        const calcWaste = $("#pdpBulkAddWasteCost input").is(":checked");
        var uomValue = $(".product-uomMeasure").val() || '';

        const weightST = tons;
        const weightWaste = tons * .10;
        const weightTotal =  tons + (tons * .10);
        const weightRoundsTo =  Math.ceil(tons + (tons * .10));
        const weightLastValue =  tons;
        const valueToUse = uomValue.toLowerCase().includes('ton');
        const volumeInCubicYards = volume;
        // Format all numeric values
        volume = formatNumber(valueToUse ? weightST : formatNumber(volume));
        waste = formatNumber(valueToUse ? weightWaste : formatNumber(waste));
        totalCubicYards = formatNumber(valueToUse ? weightTotal : formatNumber(totalCubicYards));
        totalCubicYardsRounded = formatNumber(valueToUse ? (calcWaste ? weightRoundsTo : Math.ceil(tons)) : totalCubicYardsRounded);
        area = formatNumber(area);
        tons = formatNumber(tons);
        
        // Update DOM values with formatted numbers
        $("#subTotalValue").html(ACC.PDPBulkCalculator.formatSubTotals(volume));
        $("#extraWasteValue").html(ACC.PDPBulkCalculator.formatSubTotals(calcWaste ? waste : "0.00"));
        $("#totalCubicYards").html(ACC.PDPBulkCalculator.formatSubTotals(calcWaste ? totalCubicYards : (totalCubicYards - waste)));
        $("#roundsToValue").html(ACC.PDPBulkCalculator.formatSubTotals(totalCubicYardsRounded));
        $("#area").html(ACC.PDPBulkCalculator.formatSubTotals(area));

        $('.line-item-label').last().text(valueToUse ? "Volume" : "Weight");
        $("#weightValue").html(ACC.PDPBulkCalculator.formatSubTotals(valueToUse ? (calcWaste ? (volumeInCubicYards + (volumeInCubicYards * .10)) : volumeInCubicYards) : (calcWaste ? weightTotal : tons)));
        $('#weightValue + label').text(valueToUse ? "cubic yards" : "tons");

        ACC.PDPBulkCalculator.formatTotal(totalCubicYardsRounded, '#finalCubicYards');
        // Calculate final total with formatted numbers
        const finalTotal = (productPrice * totalCubicYardsRounded);
        ACC.PDPBulkCalculator.formatTotal(finalTotal, '#finalTotal');
        $("#customerSpecificPrice").text(finalTotal);

        let finalQuantityInput = parseInt(totalCubicYardsRounded) > 99999 ? 99999 : (parseInt(totalCubicYardsRounded) < 1 ? 1 : parseInt(totalCubicYardsRounded));
        if (parseInt(totalCubicYardsRounded) > 99999) {
            $(".qty-warning-message").removeClass("hidden");
            $("#calculatorAddToCart > button").attr("disabled", "disabled");
        } else {
            if (parseInt(totalCubicYardsRounded) > 0) {
                if(!$("#productSelect button").is(":disabled")) {
                    $("#calculatorAddToCart > button").removeAttr("disabled");
                }
            } else {
                $("#calculatorAddToCart > button").attr("disabled", "disabled");
            }
            $(".qty-warning-message").addClass("hidden");
        }
        $('input#qty.qty.js-qty-selector-input').val(finalQuantityInput).trigger('change');
        $("input[name='pdpAddtoCartInput']").val(finalQuantityInput).trigger('change');
        $("#cboxLoadedContent .customerSpecificPrice .atc-price-analytics").text(finalTotal);
    }

    if ($("#calculatorInputs input:visible")[0].id === 'areaValue') {
        const areaForSqFt = area;
        const volumeForSqFt = calculateRecVolume(areaForSqFt, depth);
        const wasteForSqFt = calculateWaste(volumeForSqFt);
        const totalCubicYardsForSqFt = getTotalCubicYards(volumeForSqFt, wasteForSqFt);
        const totalCubicYardsRoundedForSqFt = roundUpToWhole(totalCubicYardsForSqFt);
        const tonsForSqFt = calculateWeight(volumeForSqFt);
        autoCalculate(volumeForSqFt, wasteForSqFt, totalCubicYardsForSqFt, totalCubicYardsRoundedForSqFt, areaForSqFt, tonsForSqFt);
        return;
    } else {
        switch (fetchActiveShape()) {
            case "rectangle":
                const areaRec = length * width;
                const volumeForRec = calculateRecVolume(areaRec, depth);
                const wasteExtraRec = calculateWaste(volumeForRec);
                const totalCubicYardsRec = getTotalCubicYards(volumeForRec, wasteExtraRec);
                const totalCubicYardsRoundedRec = roundUpToWhole(totalCubicYardsRec);
                const tonsRec = calculateWeight(volumeForRec);
                autoCalculate(volumeForRec, wasteExtraRec, totalCubicYardsRec, totalCubicYardsRoundedRec, areaRec, tonsRec);
                break;
            case "circle":
                const areaCircle = getCircleArea();
                const volumeForCir = calculateRecVolume(areaCircle, depth);
                const wasteExtraCir = calculateWaste(volumeForCir);
                const totalCubicYardsCir = getTotalCubicYards(volumeForCir, wasteExtraCir);
                const totalCubicYardsRoundedCir = roundUpToWhole(totalCubicYardsCir);
                const tonsCircle = calculateWeight(volumeForCir);
                autoCalculate(volumeForCir, wasteExtraCir, totalCubicYardsCir, totalCubicYardsRoundedCir, areaCircle, tonsCircle)
                break;
            case "rightTrangle":
                const areaRtTriangle = (length * width) / 2;
                const volumeForRtTriangle = calculateRecVolume(areaRtTriangle, depth);
                const wasteExtraRtTriangle = calculateWaste(volumeForRtTriangle);
                const totalCubicYardsRtTriangle = getTotalCubicYards(volumeForRtTriangle, wasteExtraRtTriangle);
                const totalCubicYardsRoundedRtTriangle = roundUpToWhole(totalCubicYardsRtTriangle);
                const tonsRtTriangle = calculateWeight(volumeForRtTriangle);
                autoCalculate(volumeForRtTriangle, wasteExtraRtTriangle, totalCubicYardsRtTriangle, totalCubicYardsRoundedRtTriangle, areaRtTriangle, tonsRtTriangle)
                break;
            case "trapezoid":
                const areaTrpzd = getTrapezoidArea();
                const volumeForTrpzd = calculateRecVolume(areaTrpzd, depth);
                const wasteExtraTrpzd = calculateWaste(volumeForTrpzd);
                const totalCubicYardsTrpzd = getTotalCubicYards(volumeForTrpzd, wasteExtraTrpzd);
                const totalCubicYardsRoundedTrpzd = roundUpToWhole(totalCubicYardsTrpzd);
                const tonsTrpzd = calculateWeight(volumeForTrpzd);
                autoCalculate(volumeForTrpzd, wasteExtraTrpzd, totalCubicYardsTrpzd, totalCubicYardsRoundedTrpzd, areaTrpzd, tonsTrpzd);
                break;
            case "square":
                const areaSquare = side * side;
                const volumeForSquare = calculateRecVolume(areaSquare, depth);
                const wasteExtraSquare = calculateWaste(volumeForSquare);
                const totalCubicYardsSquare = getTotalCubicYards(volumeForSquare, wasteExtraSquare);
                const totalCubicYardsRoundedSquare = roundUpToWhole(totalCubicYardsSquare);
                const tonsSquare = calculateWeight(volumeForSquare)
                autoCalculate(volumeForSquare, wasteExtraSquare, totalCubicYardsSquare, totalCubicYardsRoundedSquare, areaSquare, tonsSquare);
                break;
            case "oval":
                const areaOval = getOvalArea();
                const volumeForOval = calculateRecVolume(areaOval, depth);
                const wasteExtraOval = calculateWaste(volumeForOval);
                const totalCubicYardsOval = getTotalCubicYards(volumeForOval, wasteExtraOval)
                const totalCubicYardsRoundedOval = roundUpToWhole(totalCubicYardsOval);
                const tonsOval = calculateWeight(volumeForOval)
                autoCalculate(volumeForOval, wasteExtraOval, totalCubicYardsOval, totalCubicYardsRoundedOval, areaOval, tonsOval)
                break;
            case "equilTriangle":
                const areaEqlTrn = getEqlTrnArea();
                const volumeForEqlTrn = calculateRecVolume(areaEqlTrn, depth);
                const wasteExtraEqlTrn = calculateWaste(volumeForEqlTrn);
                const totalCubicYardsEqlTrn = getTotalCubicYards(volumeForEqlTrn, wasteExtraEqlTrn);
                const totalCubicYardsRoundedEqlTrn = roundUpToWhole(totalCubicYardsEqlTrn);
                const tonsEqlTrn = calculateWeight(volumeForEqlTrn);
                autoCalculate(volumeForEqlTrn, wasteExtraEqlTrn, totalCubicYardsEqlTrn, totalCubicYardsRoundedEqlTrn, areaEqlTrn, tonsEqlTrn);
                break;
            case "parrallelogram":
                const areaPllgrm = length * width;
                const volumeForPllgrm = calculateRecVolume(areaPllgrm, depth);
                const wasteExtraPllgrm = calculateWaste(volumeForPllgrm);
                const totalCubicYardsPllgrm = getTotalCubicYards(volumeForPllgrm, wasteExtraPllgrm);
                const totalCubicYardsRoundedPllgrm = roundUpToWhole(totalCubicYardsPllgrm);
                const tonsPllgrm = calculateWeight(volumeForPllgrm);
                autoCalculate(volumeForPllgrm, wasteExtraPllgrm, totalCubicYardsPllgrm, totalCubicYardsRoundedPllgrm, areaPllgrm, tonsPllgrm);
                break;
            default:
                break;
        }
    }
}


// close calculator icon
$("#closeBulkCalculator").click(ACC.PDPBulkCalculator.closeCalculator);

// calculator background
$('#calculator-overlay').click(function (e) {
    if (!$(e.target).closest('#show-bulk-calculator').length) {
        ACC.PDPBulkCalculator.closeCalculator();
    }
});

// add to cart click
$('#showAddtoCart').click(function (e) {
    ACC.PDPBulkCalculator.closeCalculator();
});

// waste feature
$("#pdpBulkAddWasteCost input").on("change", function () {
    recalculate();
});

// tooltip
$("#pdpBulkTooltip").on("mouseenter", (event) => {
    event.stopPropagation();
    $('#tooltip').css({ display: "block" });
}).on("mouseleave", (event) => {
    event.stopPropagation();
    $('#tooltip').css({ display: "none" }); // Hide the tooltip when mouse leaves
});
});
$(document).ready(function() {
	const CONVERSIONS = {
		INCHES_PER_FOOT: 12,
		SQUARE_INCHES_PER_SQUARE_FOOT: 144,
		POUNDS_PER_TON: 2000,
		GENERAL_WEIGHT: 410,
		MATERIAL_WEIGHTS: {
			flagstone: 132,
			deckRock: 2800,
			stoneWalls: 2700,
			roadbaseFill: 2650
		}
	};


	const pageType = {
		isFlagstone: location.href.includes("projectcalculators/flagstone"),
		isDeckRock: location.href.includes("projectcalculators/decorativerock"),
		isStonewalls: location.href.includes("projectcalculators/stonewalls"),
		isBarkmulch: location.href.includes("projectcalculators/barkmulch"),
		isTopsoil: location.href.includes("projectcalculators/topsoil"),
		isRoadbaseFill: location.href.includes("projectcalculators/roadbasefill")
	};

	const formatNumber = (num) => {
		// Convert to number and limit decimal places
		let formatted = parseFloat(num);
		// Check if it's a valid number
		if (isNaN(formatted)) return 0;
		// If number is too large, cap it
		if (formatted > 999999999) formatted = 999999999;
		// If number is too small, floor at 0
		if (formatted < 0) formatted = 0;
		// Format to max 2 decimal places
		return parseFloat(formatted.toFixed(2));
	};


	function setupDropdown(type) {
		const buttonClass = `${type}Dropdown`;
		$(`.${buttonClass}Button`).on('click', () => {
			$(`.${buttonClass}ButtonContent`).toggle();
		});
		$(`.${buttonClass}Option`).on('click', () => {
			$(`.${buttonClass}ButtonContent`).toggle();
		});
	}

	['area', 'volume', 'weight'].forEach(setupDropdown);

	function updateDropdownButton(type, text, value) {
		$(`.${type}DropdownButton`)
			.first()
			.contents()
			.first()
			.replaceWith(text);
		$(`.${type}DropdownButton`).data('value', value);
	}

	function getAreaAsSqFt(dontUpdateInput) {
		const visableInputs = $("#columnOne input:visible").slice(0, 2);
		let area = 1;

		visableInputs.each(function() {
			const value = parseFloat($(this).val());
			if (!isNaN(value)) {
				area *= value;
			}
		});

		if (!dontUpdateInput) {
			$("#areaDropdownComponent input").val(formatNumber(area));
		}

		return area;
	}

	function getVolumeWithDepthAsCubicFeet() {
		const visableInputs = $("#columnOne input:visible");
		let area = 1;

		visableInputs.each(function() {
			const value = parseFloat($(this).val());
			if (!isNaN(value)) {
				area *= value;
			}
		});

		return area;
	}

	function calculateThickness(newThickness, newLabel) {
		const area = getAreaAsSqFt();

		// Validate area input
		if (isNaN(area) || area <= 0) {
			console.error("Invalid area value");
			return;
		}

		// calulates volume on input
		const calculateNewVolume = () => {
			let multiplier = newThickness;
			if (pageType.isFlagstone) {
				multiplier = parseFloat(newThickness) / 12;
			} else if (pageType.isDeckRock || pageType.isRoadbaseFill) {
				const _m = parseFloat((parseFloat($("#depth").val()).toFixed()));
				multiplier = _m;
			}
			const volume = parseFloat((area * multiplier).toFixed(2));
			return volume;
		};
		const newVolume = calculateNewVolume();

		// calulates weight on input
		const calculateNewWeight = (__newVolume) => {
			let multiplier = 132;
			if (pageType.isStonewalls) {
				multiplier = 2700;
			}
			if (pageType.isDeckRock) {
				multiplier = 2800;
			}
			if (pageType.isRoadbaseFill) {
				multiplier = 2650;
			}
			if (pageType.isFlagstone) {
				multiplier = 3564;
			}
			if (pageType.isTopsoil) {
				multiplier = 2100;
			}
			if (pageType.isBarkmulch) {
				multiplier = 410;
			}

			const weight = parseFloat((__newVolume * multiplier).toFixed(2));
			const results = {
				pnds: Math.ceil(weight),
				tons: parseFloat((weight / 2000).toFixed(2))
			};
			const currentWeightMetric = $("#weightDropdownComponent button").data("value");
			return results[currentWeightMetric]
		};

		// Update UI components with calculated values
		$("#volumeDropdownComponent input").val(formatNumber(newVolume));
		$("#weightDropdownComponent input").val(formatNumber(calculateNewWeight(newVolume)));
		if (newLabel) {
			$("#thicknessDropdownComponent button").text(newLabel).data("value", newThickness);
			$("#thicknessDropdownComponent input").val(newThickness);
		}
	}

	$(".thicknessDropdownOption").on('click', function(e) {
		function resetNewDropdowns(calculateThickness) {
			$('.areaDropdownButton').data('value', 'sqft').text("SQUARE FEET");
			$('.volumeDropdownButton').data('value', 'cbft').text("CUBIC FEET");
			$('.weightDropdownButton').data('value', 'pnds').text("POUNDS");

			$("#areaDropdownComponent input").val("");
			$("#volumeDropdownComponent input").val("");
			$("#weightDropdownComponent input").val("");

			$(".volumeDropdownOption").first().siblings().removeClass("selected").end().addClass("selected");
			$(".weightDropdownOption").first().siblings().removeClass("selected").end().addClass("selected");

			calculateThickness()
		}

		e.preventDefault();
		const $ThicknessOption = $(this);
		const thickness = $ThicknessOption.data("value")
		const label = $ThicknessOption.text()
		resetNewDropdowns(() => {
			calculateThickness(thickness, label);
		});
		$ThicknessOption.siblings().removeClass("selected").end().addClass("selected");
	});

	// Square Feet Dropdwon
	$(".areaDropdownOption1").on("click", function() {
		const $areaOption = $(this);
		const $input = $("#areaDropdownComponent input");
		const selectedMetric = $areaOption.attr("data-value");
		const previousMetric = $(".areaDropdownButton").attr("data-value");
		const currentArea = parseFloat($("#height").val()) * parseFloat($("#width").val())

		let convertedValue
		if (previousMetric === "sqft") {
			convertedValue = selectedMetric === "sqin" ? currentArea * 144 : selectedMetric === "sqft" ? currentArea : currentArea / 9;
		} else if (previousMetric === "sqin" && selectedMetric === "sqyd") {
			convertedValue = currentArea / 1296;
		} else {
			convertedValue = currentArea * 1296;
		}

		const isAnyInputEmpty = $("#columnOne input").toArray().some(input => $(input).val().trim() === "");
		if (isAnyInputEmpty) {
			return
		}
		$("#areaDropdownComponent #value").html(formatNumber(convertedValue));
		$input.val(selectedMetric === "sqft" ? currentArea : parseFloat(convertedValue.toFixed(2)));
		$areaOption.addClass("selected").siblings().removeClass("selected");
		updateDropdownButton("area", $areaOption.text(), selectedMetric);
	});

	// Cubic Yards Dropdwon
	$(".volumeDropdownOption1").on("click", function() {
		const $volumeOption = $(this);
		const $input = $("#volumeDropdownComponent #value");
		const $button = $("#volumeDropdownComponent button");
		const inputValue = parseFloat($input.text());
		const selectedMetric = $volumeOption.attr("data-value");
		const $area = getAreaAsSqFt(true);
		const currentArea = parseFloat($("#height").val()) * parseFloat($("#width").val()) * parseFloat($("#depth").val());
		let convertedValue;
		if (selectedMetric === "cbyd") {
			convertedValue = parseFloat((currentArea/ 27).toFixed(2));
		} else {
			if (selectedMetric === "cbft") {
				convertedValue = currentArea;
			}
		}

		const isAnyInputEmpty = $("#columnOne input").toArray().some(input => $(input).val().trim() === "");
		if (isAnyInputEmpty) {
			return
		}

		// Update input value and selected option

		$volumeOption.addClass("selected").siblings().removeClass("selected");
		$("#volumeDropdownComponent #value").html(formatNumber(convertedValue));
		// Update dropdown button
		updateDropdownButton("volume", $volumeOption.text(), selectedMetric);
	});

	// Pounds Dropdwon
	$(".weightDropdownOption1").on("click", function() {
		function calculateWeight(volume, metric) {
			if (pageType.isFlagstone) {
				return metric === "tns" ?
					volume * CONVERSIONS.MATERIAL_WEIGHTS.flagstone / CONVERSIONS.POUNDS_PER_TON :
					volume * CONVERSIONS.MATERIAL_WEIGHTS.flagstone;
			}
			if (pageType.isStonewalls) {
				return metric === "tns" ?
					volume * CONVERSIONS.MATERIAL_WEIGHTS.stoneWalls / CONVERSIONS.POUNDS_PER_TON :
					volume * CONVERSIONS.MATERIAL_WEIGHTS.stoneWalls;
			}
			if (pageType.isDeckRock) {
				return metric === "tns" ?
					volume * CONVERSIONS.MATERIAL_WEIGHTS.deckRock / CONVERSIONS.POUNDS_PER_TON :
					volume * CONVERSIONS.MATERIAL_WEIGHTS.deckRock;
			}
			if (pageType.isRoadbaseFill) {
				return metric === "tns" ?
					volume * CONVERSIONS.MATERIAL_WEIGHTS.roadbaseFill / CONVERSIONS.POUNDS_PER_TON :
					volume * CONVERSIONS.MATERIAL_WEIGHTS.roadbaseFill;
			}
			return 0
		}


		function coversionCheck() {
			const volumeInput = $("#volumeDropdownComponent #value");
			const volume = parseFloat(volumeInput.text());

			const isInCubicYrds = $("#volumeDropdownComponent button").data().value === "cbyd";
			if (isInCubicYrds) {
				return parseInt(volume * 27);
			}

			return volume;
		}
		let pageName = $(".pagename").val();
		const $WeightOption = $(this);
		const $weightInput = $("#weightDropdownComponent #value");

		//const $button = $("#weightDropdownComponent button");
		// const inputValue = parseFloat($weightInput.text());
		const selectedMetric = $WeightOption.attr("data-value");
		const currentyards = parseFloat($("#height").val() / 3) * parseFloat($("#width").val() / 3) * parseFloat($("#depth").val()) / 3;
		let Pounds;

		if (pageName == "Bark Mulch Calculator Page") {
			Pounds = currentyards * 410;
		}
		if (pageName == "Top Soil Calculator Page") {
			Pounds = currentyards * 2100;
		}
		if (selectedMetric == "tns") {
			tons = Pounds / 2000;
			convertedValue = tons;
		}
		else {
			convertedValue = Pounds;
		}
		$("#weightDropdownComponent #value").html(formatNumber(convertedValue));

		$WeightOption.siblings().removeClass("selected").end().addClass("selected");
		updateDropdownButton('weight', $WeightOption.text(), selectedMetric);
	});

	// inputs
	$("#height, #width, #depth").on("keydown", function(e) {
		// Allow numpad keys (96-105), control keys, and delete
		if (
			(e.which >= 96 && e.which <= 105) || // Numpad numbers
			$.inArray(e.which, [8, 9, 13, 37, 38, 39, 40, 46]) !== -1 || // Control keys and delete
			e.which === 110 || // Numpad decimal point
			e.which === 190 // Decimal point (.)
		) {
			return; // Allow these keys
		}

		// Disallow the 'e' character
		const char = String.fromCharCode(e.which);
		if (char === 'e' || char === 'E') {
			e.preventDefault();
		}

		// Ensure only numeric input and decimal point (for non-numpad keys)
		if (!/^[0-9.]$/.test(char) || (char === '.' && $(this).val().includes('.'))) {
			e.preventDefault();
		}
	});

	function validateInputs($input) {
		let value = $input.val();

		// Remove any non-numeric characters except decimal point
		value = value.replace(/[^0-9.]/g, '');

		// Remove leading zeros
		value = value.replace(/^0+(?=\d)/, '');

		// Limit to 9 digits total
		if (value.length > 9) {
			value = value.slice(0, 9);
		}

		// Prevent negative numbers by removing minus signs
		value = value.replace(/-/g, '');

		// Update input value with sanitized value
		$input.val(value);
		return value;
	}
	//Barkmuch and Toip
	

	$("#projectCalcInput button").on("click", function() {
		const $Button = $(this)//specific button in/ft
	    const $inputGroup = $Button.closest('#projectCalcInput');
		
		const metric = $Button.data('metric');
		const input = $(`#${metric}`);
		const currentSuffix = $Button.data('suffix');
		const unit = $Button.data('unit');
 		const $input = $inputGroup.find('input');
		ACC.calculator.handleSuffix($input, false);
        $input.data('suffix', $Button.data('unit'));
        ACC.calculator.handleSuffix($input, true);
        const fieldName = $input.attr('class').split(' ')[1];
        $input.attr('placeholder', `Enter ${fieldName} in ${unit}`);
		input.attr("data-metric", currentSuffix);
		$Button.attr("data-previous");
		$Button.siblings().removeClass('active').end().addClass('active');
		
	});
	
	$("#projectCalcBtnGroup button").on("click", function() {
		ACC.calculator.dropdownToggleConvertion('');
	});
	function onChangeofftandin(previousSuffix, currentSuffix, metric, formValue) {
		let pageName = $(".pagename").val();
		if (metric == 'height') {
			heightInInches = formValue;
		}
		if (metric == 'width') {
			widthInInches = formValue;
		}
		if (metric == 'depth') {
			depthInInches = formValue;
		}

		const area = heightInInches * widthInInches;
		const Volume = area * depthInInches;
		let Pounds;
		if (pageName == "Bark Mulch Calculator Page") {
			Pounds = ((heightInInches / 3) * (widthInInches / 3) * (depthInInches / 3)) * 410;
		}
		if (pageName == "Top Soil Calculator Page") {
			Pounds = ((heightInInches / 3) * (widthInInches / 3) * (depthInInches / 3)) * 2100;
		}
		$("#areaDropdownComponent #value").html(formatNumber(area));
		$("#volumeDropdownComponent #value").html(formatNumber(Volume));
		$("#weightDropdownComponent #value").html(formatNumber(Pounds));
	}

	// Initialize default values
	$('.areaDropdownButton').data('value', 'sqft');
	$('.volumeDropdownButton').data('value', 'cbft');
	$('.weightDropdownButton').data('value', 'pnds');
});
ACC.project = {
    _autoload: [
        ["bindPageEvents", $('.page-projectDashboard').length > 0]
    ],
    expandCheckMannual: false,
    biddingRequesting: false,
    hiddenRequesting: false,
    favoriteRequesting: false,
    biddingAjax: false,
    hiddenAjax: false,
    favoriteAjax: false,
    bindPageEvents: function (e) {
        $('[data-toggle="popover"]').popover({
            placement: "top",
            trigger: "hover",
            parent: ".js-manage-drf"
        });
        $(".project-accordion-button").on("click", function () { ACC.project.isAllExpand() });
        ACC.project.getProject(true);
    },
    getProject: function (load) {
        $.ajax({
            type: 'POST',
            url: ACC.config.encodedContextPath + '/projectservices/project-dashboard',
            data: {
                pageSize: '50',
                page: '1',
                sortBy: 'pr.ProjectNumber'
            },
            success: function (response) {
                if (response) {
                    ACC.project.createProject(load, response.info);
                }
                else {
                    ACC.myquotes.quotePopupError();
                }
            },
            error: function (response) {
                ACC.myquotes.quotePopupError();
            }
        });
    },
    createProject: function (load, response) {
        let projectHTML = "";
        for (let i = 0; i < response.length; i++) {
            projectHTML += '<div class="col-md-12 p-y-25 p-x-20 b-b-grey"><div class="row"><div class="col-xs-8 text-green"><a class="text-green font-Geogrotesque no-text-decoration" href="' + ACC.config.encodedContextPath + '/projectservices/dashboard/' + response[i].projectID + '">' + response[i].projectName + '</a> <span class="badge bg-white border-primary m-l-5 border-radius-3 border-red f-s-12 f-w-700 text-default hidden">Quote Only</span></div><div class="col-xs-4 text-right"><div class="btn-group" role="group" aria-label="..."><button type="button" class="btn btn-primary btn-small btn-bold m-x-10 hidden">Priced Materials Ready</button><button type="button" class="btn btn-grey btn-small btn-iconlink border-radius-3-imp m-r-10 text-green ' + (response[i].isHiddenFromDashboard ? 'selected' : '') + '" onclick="ACC.project.hiddenProject(this)" data-prid="' + response[i].projectID + '" data-value="' + (response[i].isHiddenFromDashboard ? 'open' : 'close') + '" data-toggle="popover" data-content="' + (response[i].isHiddenFromDashboard ? 'Show this Project' : 'Hide this Project') + '" ><span class="glyphicon glyphicon-eye-close f-s-12 ' + (response[i].isHiddenFromDashboard ? 'hidden' : '') + '"></span><span class="glyphicon glyphicon-eye-open f-s-12 ' + (response[i].isHiddenFromDashboard ? '' : 'hidden') + '"></span></button><button type="button" class="btn btn-grey btn-small btn-iconlink border-radius-3-imp text-green ' + (response[i].isFavorite ? 'selected' : '') + '" onclick="ACC.project.favoriteProject(this)" data-prid="' + response[i].projectID + '" data-value="' + (response[i].isFavorite ? 'up' : 'down') + '" data-toggle="popover" data-content="' + (response[i].isFavorite ? 'Remove from Favorite' : 'Make a Favorite') + '" ><span class="glyphicon glyphicon-thumbs-up f-s-12"></span></button></div></div></div><div class="row m-t-5 m-b-10 flex-center text-default f-s-12"><div class="col-xs-9"><div class="row"><div class="col-xs-2">Plan Name:</div><div class="col-xs-10 bold">' + response[i].planName + '</div></div><div class="row"><div class="col-xs-2">Address:</div><div class="col-xs-10 bold">' + response[i].cityStateZip + '</div></div></div><div class="col-xs-3 p-t-5 text-right"><div class="form-group m-b-0">Bidding<label class="radio-inline m-l-10"><span class="colored-radio"><input onchange="ACC.project.biddingProject(this)" type="radio" name="inlineRadioOptions' + response[i].projectID + '" id="inlineRadio' + response[i].projectID + '_1" data-alert="Are you sure you want to request a bid for this project?" data-prid="' + response[i].projectID + '" value="yes" ' + (response[i].isBidding ? 'checked' : '') + '>Yes</span></label><label class="radio-inline"><span class="colored-radio"><input onchange="ACC.project.biddingProject(this)" type="radio" name="inlineRadioOptions' + response[i].projectID + '" id="inlineRadio' + response[i].projectID + '_2" data-alert="Are you sure you want to cancel the bid for this project?" data-prid="' + response[i].projectID + '" value="no" ' + (response[i].isBidding ? '' : 'checked') + '>No</span></label></div></div></div><div class="row flex-center text-default f-s-12"><div class="col-xs-6 p-r-0"><div class="row margin0 bg-light-gray p-y-5 l-h-15  border-radius-3"><div class="col-xs-4">Bid Date: <span class="bold">' + response[i].bidDate + '</span></div><div class="col-xs-4">Due Date: <span class="bold">' + response[i].projectDueDate + '</span></div><div class="col-xs-4 padding0">Submitted Date: <span class="bold">' + response[i].createdOn + '</span></div></div></div><div class="col-xs-2 l-h-15"><span class="bg-lightgreen p-y-5 p-x-10 border-radius-3 text-align-center display-block">PS Number: <span class="bold">' + response[i].projectNumber + '</span></span></div><div class="col-xs-2 l-h-15 padding0"><span class="bg-lightgreen p-y-5 p-x-10 border-radius-3 text-align-center display-block">Project Status: <span class="bold">' + response[i].projectStatus + '</span></span></div><div class="col-xs-2 text-right"><a href="' + ACC.config.encodedContextPath + '/projectservices/dashboard/' + response[i].projectID + '" class="btn btn-default btn-block btn-small btn-bold">View Project Info</a></div></div></div>';
        }
        $(".js-project-data-holder").html(projectHTML);
        $('.js-project-data-holder [data-toggle="popover"]').popover({
            placement: "top",
            trigger: "hover"
        });
    },
    expandCheck: function (e) {
        if (!ACC.project.expandCheckMannual) {
            let ref = $(e);
            let refStatus = ref.prop('checked');
            let targetText = refStatus ? 'close' : 'open';
            $('.project-accordion-' + targetText).trigger("onclick");
        }
    },
    isAllExpand: function () {
        ACC.project.expandCheckMannual = true;
        let openedAccordian = $(".project-accordion-open").length;
        let closedAccordian = $(".project-accordion-close").length;
        let expendCheck = $(".circle-radio-input");
        if (!closedAccordian && !expendCheck.prop("checked")) {
            expendCheck.prop("checked", true);
        }
        else {
            expendCheck.prop("checked", false);
        }
        ACC.project.expandCheckMannual = false;
    },
    clearFilter: function () {
        let statusChange;
        $(".project-group-item-check:checked").each(function () {
            statusChange = true;
            $(this).prop("checked", false);
        });
        if (statusChange) {
            ACC.project.filterOptionsStatus();
        }
    },
    filterOptionsCheck: function (e, num, cat, type) {
        ACC.project.filterOptionsStatus();
    },
    filterOptionsStatus: function () {
        let optionLength = $(".project-group-item-check:checked").length;
        if (optionLength > 1) {
            $(".project-filter-s").show();
        }
        else {
            $(".project-filter-s").hide();
        }
        $(".project-filter-num").html(optionLength);
    },
    biddingProject: function (e, currentStatus) {
        if (!ACC.project.biddingRequesting) {
            ACC.project.biddingRequesting = true;
            let ref = $(e);
            let refName = ref.attr("name");
            let refValue = ref.val();
            let refAlert = ref.data("alert");
            let refPrId = ref.data("prid");
            $('[name="' + refName + '"]').prop("disabled", true);
            ACC.colorbox.open(refAlert, {
                html: '<div class="row p-t-20"><div class="col-xs-6 text-right"><button class="btn btn-default btn-block border-radius-3-imp bold-text" onclick="ACC.colorbox.close()">Go Back</button></div><div class="col-xs-6"><button class="btn btn-primary btn-block border-radius-3-imp bold-text" onclick="ACC.project.biddingProjectRequest(this,\'' + refValue + '\',\'' + refPrId + '\',\'' + refName + '\')">Yes</button></div></div>',
                width: 500,
                className: "project-bid-popup text-align-center",
                escKey: false,
                overlayClose: false,
                onComplete: function () {
                    //setTimeout($.colorbox.resize, 500);
                    $(".project-bid-popup #cboxContent").addClass("border-radius-3");
                },
                onClosed: function () {
                    if (!ACC.project.biddingAjax) {
                        $('[name="' + refName + '"]').each(function () {
                            let tempRef = $(this);
                            if (tempRef.val() != refValue) {
                                tempRef.prop("checked", true);
                            }
                            tempRef.prop("disabled", false);
                        });
                        ACC.project.biddingRequesting = false;
                    }
                }
            });
        }
    },
    biddingProjectRequest: function (e, val, prid, refName) {
        ACC.project.biddingAjax = true;
        ACC.colorbox.close();
        $.ajax({
            type: 'GET',
            url: ACC.config.encodedContextPath + '/projectservices/project-bidding',
            dataType: "json",
            data: { "projectId": prid, "isBidding": (val == 'yes' ? true : false) },
            success: function (response) {
                if (response == "success") {
                    ACC.project.biddingProjectToast(refName);
                }
                else {
                    ACC.myquotes.quotePopupError();
                }
            },
            error: function () {
                ACC.myquotes.quotePopupError();
            }
        });
    },
    biddingProjectToast: function (refName) {
        let targetNum = ACC.global.toastShow('success', ['Updating', 'Updated'], ['fadeInUp', 'fadeOutUp']);
        let target = $("#js-toast-" + (targetNum));
        setTimeout(function () {
            ACC.global.toastActions(target, 2, 'success');
            ACC.project.biddingAjax = false;
        }, 2000);
        setTimeout(function () {
            ACC.global.toastActions(target, 3, 'success');
        }, 4000);
        $('[name="' + refName + '"]').prop("disabled", false);
        ACC.project.biddingRequesting = false;
    },
    hiddenProject: function (e) {
        if (!ACC.project.hiddenRequesting) {
            ACC.project.hiddenRequesting = true;
            let ref = $(e);
            let refValue = ref.data("value");
            let refPrId = ref.data("prid");
            ref.addClass("disabled").prop("disabled", true);
            ACC.project.hiddenAjax = true;
            let targetNum = ACC.global.toastShow('success', ['Updating', 'Updated'], ['fadeInUp', 'fadeOutUp']);
            $.ajax({
                type: 'GET',
                url: ACC.config.encodedContextPath + '/projectservices/project-hidden',
                dataType: "json",
                data: { "projectId": refPrId, "isHidden": (refValue == 'close' ? true : false) },
                success: function (response) {
                    if (response == "success") {
                        ACC.project.hiddenProjectToast(ref, refValue, targetNum);
                    }
                    else {
                        //ACC.project.hiddenProjectToast(ref, refValue, targetNum);
                        ACC.myquotes.quotePopupError();
                        let target = $("#js-toast-" + (targetNum));
                        ACC.global.toastActions(target, 4);
                        ref.removeClass("disabled").prop("disabled", false);
                        ACC.project.hiddenRequesting = false;
                    }
                },
                error: function () {
                    ACC.myquotes.quotePopupError();
                    let target = $("#js-toast-" + (targetNum));
                    ACC.global.toastActions(target, 4);
                    ref.removeClass("disabled").prop("disabled", false);
                    ACC.project.hiddenRequesting = false;
                }
            });
        }
    },
    hiddenProjectToast: function (ref, refValue, targetNum) {
        ACC.project.hiddenAjax = false;
        let target = $("#js-toast-" + (targetNum));
        ACC.global.toastActions(target, 2, 'success');
        setTimeout(function () {
            ACC.global.toastActions(target, 3, 'success');
        }, 4000);
        refValue = refValue == 'close' ? 'open' : 'close';
        ref.attr('data-content', (refValue == 'close' ? 'Hide this Project' : 'Show this Project'));
        ref.removeClass("disabled selected").addClass(refValue == 'open' ? 'selected' : '').prop("disabled", false).data("value", refValue).children('.glyphicon').addClass('hidden');
        ref.children('.glyphicon-eye-' + refValue).removeClass('hidden');
        ACC.project.hiddenRequesting = false;
    },
    favoriteProject: function (e) {
        if (!ACC.project.favoriteRequesting) {
            ACC.project.favoriteRequesting = true;
            let ref = $(e);
            let refValue = ref.data("value");
            let refPrId = ref.data("prid");
            ref.addClass("disabled").prop("disabled", true);
            ACC.project.favoriteAjax = true;
            let targetNum = ACC.global.toastShow('success', ['Updating', 'Updated'], ['fadeInUp', 'fadeOutUp']);
            $.ajax({
                type: 'GET',
                url: ACC.config.encodedContextPath + '/projectservices/project-favorite',
                dataType: "json",
                data: { "projectId": refPrId, "isFav": (refValue == 'up' ? false : true) },
                success: function (response) {
                    if (response == "success") {
                        ACC.project.favoriteProjectToast(ref, refValue, targetNum);
                    }
                    else {
                        //ACC.project.favoriteProjectToast(ref, refValue, targetNum);
                        ACC.myquotes.quotePopupError();
                        let target = $("#js-toast-" + (targetNum));
                        ACC.global.toastActions(target, 4);
                        ref.removeClass("disabled").prop("disabled", false);
                        ACC.project.favoriteRequesting = false;
                    }
                },
                error: function () {
                    ACC.myquotes.quotePopupError();
                    let target = $("#js-toast-" + (targetNum));
                    ACC.global.toastActions(target, 4);
                    ref.removeClass("disabled").prop("disabled", false);
                    ACC.project.favoriteRequesting = false;
                }
            });
        }
    },
    favoriteProjectToast: function (ref, refValue, targetNum) {
        ACC.project.favoriteAjax = false;
        let target = $("#js-toast-" + (targetNum));
        ACC.global.toastActions(target, 2, 'success');
        setTimeout(function () {
            ACC.global.toastActions(target, 3, 'success');
        }, 4000);
        refValue = refValue == 'up' ? 'down' : 'up';
        ref.attr('data-content', (refValue == 'up' ? 'Remove from Favorite' : 'Make a Favorite'));
        ref.removeClass("disabled selected").addClass(refValue == 'up' ? 'selected' : '').prop("disabled", false).data("value", refValue).children('.glyphicon');
        ACC.project.favoriteRequesting = false;
    }
}
